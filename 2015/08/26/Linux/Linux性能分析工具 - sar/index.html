<!DOCTYPE HTML>
<html>

<head>
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="bookmark" type="image/x-icon" href="/bitbug_favicon_64s.ico" />
	<link rel="shortcut icon" href="/bitbug_favicon_64s.ico">
	
	    <title>
    Cultoy
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="maywzh" />
    
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('https://i.loli.net/2020/03/02/mYeD6WLp3kOy1qw.png') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

	    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="https://cdn.jsdelivr.net/gh/jquery/jquery@1.11.3/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ajlkn/jquery.scrollex@0.2.1/jquery.scrollex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/maywzh/jquery.scrolly@0.0.1/dist/jquery.scrolly.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ajlkn/skel@3.0.1/dist/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<meta name="generator" content="Hexo 5.1.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_okaidia.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->

<body class="is-loading">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">MAYWZH</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special">
	<ul class="menu links">
		<!-- Homepage  主页  -->
		<li>
			<a href="/" rel="nofollow">Home</a>
		</li>
		<!-- categories_name  分类   -->
		
		<li class="active">
			<a href="#s1">Category</a>
			<ul class="submenu">
				<li>
					<a class="category-link" href="/categories/DevOps/">DevOps</a></li><li><a class="category-link" href="/categories/uncategorized/">uncategorized</a></li><li><a class="category-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></li><li><a class="category-link" href="/categories/%E5%88%B7%E9%A2%98/">刷题</a></li><li><a class="category-link" href="/categories/%E5%9D%91/">坑</a></li><li><a class="category-link" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></li><li><a class="category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li><a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li><a class="category-link" href="/categories/%E6%96%B9%E6%B3%95%E8%AE%BA/">方法论</a></li><li><a class="category-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></li><li><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li><a class="category-link" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a></li><li><a class="category-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a></li><li><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
			</ul>
		</li>
		
		<!-- archives  归档   -->
		
		<li class="active">
			<a href="#s1">Archive</a>
			<ul class="submenu">
				<li>
					<a class="archive-link" href="/archives/2020/">2020</a></li><li><a class="archive-link" href="/archives/2019/">2019</a></li><li><a class="archive-link" href="/archives/2018/">2018</a></li><li><a class="archive-link" href="/archives/2017/">2017</a></li><li><a class="archive-link" href="/archives/2016/">2016</a></li><li><a class="archive-link" href="/archives/2015/">2015</a>
			</ul>
		</li>
		

		<!-- Pages 自定义   -->
		
		<li>
			<a href="/tags/" title="Tags">
				Tags
			</a>
		</li>
		
		<li>
			<a href="/about/" title="About">
				About
			</a>
		</li>
		


	</ul>
	<!-- icons 图标   -->
	<ul class="icons">
		
		<li>
			<a title="search" href="https://io.maywzh.com" target="_blank" rel="noopener">
				<i class="icon fa fa-search"></i>
			</a>
		</li>
		
		
		<li>
			<a title="twitter" href="https://twitter.com/maywzh" target="_blank" rel="noopener">
				<i class="icon fa fa-twitter"></i>
			</a>
		</li>
		
		<li>
			<a title="github" href="https://github.com/maywzh" target="_blank" rel="noopener">
				<i class="icon fa fa-github"></i>
			</a>
		</li>
		
	</ul>
</nav>

        <div id="main">
            <div class="post_page_title_img"
                style="height: 25rem;background-image: url(https://i.loli.net/2020/08/23/83MVATdal4hJLNU.png);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;">
                    <h2>Linux 性能分析工具 - sar</h2>
                </a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <p>sar 是 System Activity Reporter（系统活动情况报告）的缩写。sar 工具将对系统当前的状态进行取样，然后通过计算数据和比例来表达系统的当前运行状态。它的特点是可以连续对系统取样，获得大量的取样数据；取样数据和分析的结果都可以存入文件，所需的负载很小。sar 是目前 Linux 上最为全面的系统性能分析工具之一，可以从 14 个大方面对系统的活动进行报告，包括文件的读写情况、系统调用的使用情况、串口、CPU 效率、内存使用状况、进程活动及 IPC 有关的活动等，使用也是较为复杂。</p>
<p>sar 是查看操作系统报告指标的各种工具中，最为普遍和方便的；它有两种用法；</p>
<ol>
<li>追溯过去的统计数据（默认）</li>
<li>周期性的查看当前数据</li>
</ol>
<a id="more"></a>
<h2><span id="安装">安装 </span></h2><p> 有的 linux 系统下，默认可能没有安装这个包，使用 <code>apt-get</code> 来安装；</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">apt-get</span> <span class="token function">install</span> sysstat<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>安装完毕，将性能收集工具的开关打开：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">vim</span> /etc/default/sysstat
<span class="token assign-left variable">ENABLED</span><span class="token operator">=</span><span class="token string">"true"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>启动这个工具来收集系统性能数据：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ /etc/init.d/sysstat start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2><span id="用法">用法 </span></h2><h3><span id="参数"> 参数</span></h3><ul>
<li>-A 汇总所有的报告</li>
<li>-a 报告文件读写使用情况</li>
<li>-B 报告附加的缓存的使用情况</li>
<li>-b 报告缓存的使用情况</li>
<li>-c 报告系统调用的使用情况</li>
<li>-d 报告磁盘的使用情况</li>
<li>-g 报告串口的使用情况</li>
<li>-h 报告关于 buffer 使用的统计数据</li>
<li>-m 报告 IPC 消息队列和信号量的使用情况</li>
<li>-n 报告命名 cache 的使用情况</li>
<li>-p 报告调页活动的使用情况</li>
<li>-q 报告运行队列和交换队列的平均长度</li>
<li>-R 报告进程的活动情况</li>
<li>-r 报告没有使用的内存页面和硬盘块</li>
<li>-u 报告 CPU 的利用率</li>
<li>-v 报告进程、i 节点、文件和锁表状态</li>
<li>-w 报告系统交换活动状况</li>
<li>-y 报告 TTY 设备活动状况</li>
</ul>
<h3><span id="追溯过去的统计数据-f">追溯过去的统计数据 -f</span></h3><p>默认情况下，sar 从最近的 0 点 0 分开始显示数据；如果想继续查看一天前的报告；可以查看保存在 /var/log/sysstat/ 下的 sa 日志； 使用 sar 工具查看:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$sar</span> -f /var/log/sysstat/sa28 <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token function">head</span> sar -r -f
/var/log/sysstat/sa28<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3><span id="查看-cpu-使用率-u">查看 CPU 使用率 -u</span></h3><p><code>sar -u</code> : 显示的 cpu 使用率等信息</p>
<p>可以看到这台机器使用了虚拟化技术，有相应的时间消耗； 各列的指标分别是:</p>
<ul>
<li><p><code>%user</code> 用户模式下消耗的 CPU 时间的比例；</p>
</li>
<li><p><code>%nice</code> 通过 nice 改变了进程调度优先级的进程，在用户模式下消耗的 CPU 时间的比例</p>
</li>
<li><p><code>%system</code> 系统模式下消耗的 CPU 时间的比例；</p>
</li>
<li><p><code>%iowait</code> CPU 等待磁盘 I/O 导致空闲状态消耗的时间比例；</p>
</li>
<li><p><code>%steal</code> 利用 Xen 等操作系统虚拟化技术，等待其它虚拟 CPU 计算占用的时间比例；</p>
</li>
<li><p><code>%idle</code> CPU 空闲时间比例；</p>
</li>
</ul>
<h3><span id="查看平均负载-q">查看平均负载 -q</span></h3><p><code>sar -q</code>: 查看平均负载</p>
<p>指定 -q 后，就能查看运行队列中的进程数、系统上的进程大小、平均负载等；与其它命令相比，它能查看各项指标随时间变化的情况；</p>
<ul>
<li><code>runq-sz</code>：运行队列的长度（等待运行的进程数）</li>
<li><code>plist-sz</code>：进程列表中进程（processes）和线程（threads）的数量</li>
<li><code>ldavg-1</code>：最后 1 分钟的系统平均负载 ldavg-5：过去 5 分钟的系统平均负载</li>
<li><code>ldavg-15</code>：过去 15 分钟的系统平均负载</li>
</ul>
<h3><span id="查看内存使用状况-r">查看内存使用状况 -r</span></h3><p><code>sar -r</code>： 可查看物理内存使用状况；</p>
<ul>
<li><code>kbmemfree</code>：这个值和 free 命令中的 free 值基本一致, 所以它不包括 buffer 和 cache 的空间.</li>
<li><code>kbmemused</code>：这个值和 free 命令中的 used 值基本一致, 所以它包括 buffer 和 cache 的空间.</li>
<li><code>%memused</code>：物理内存使用率，这个值是 kbmemused 和内存总量 (不包括 swap) 的一个百分比.</li>
<li><code>kbbuffers</code>和<code>kbcached</code>：这两个值就是 free 命令中的 buffer 和 cache.</li>
<li><code>kbcommit</code>：保证当前系统所需要的内存, 即为了确保不溢出而需要的内存(RAM+swap).</li>
<li><code>%commit</code>：这个值是 kbcommit 与内存总量 (包括 swap) 的一个百分比.</li>
</ul>
<h3><span id="查看页面交换发生状况-w">查看页面交换发生状况 -W</span></h3><p><code>sar -W</code>：查看页面交换发生状况</p>
<p>页面发生交换时，服务器的吞吐量会大幅下降；服务器状况不良时，如果怀疑因为内存不足而导致了页面交换的发生，可以使用这个命令来确认是否发生了大量的交换；</p>
<ul>
<li><code>pswpin/s</code>：每秒系统换入的交换页面（swap page）数量</li>
<li><code>pswpout/s</code>：每秒系统换出的交换页面（swap page）数量</li>
</ul>
<h3><span id="综合分析">综合分析 </span></h3><p> 要判断系统瓶颈问题，有时需几个 sar 命令选项结合起来；</p>
<ul>
<li>怀疑 CPU 存在瓶颈，可用 <code>sar -u</code> 和 <code>sar -q</code> 等来查看</li>
<li>怀疑内存存在瓶颈，可用<code>sar -B</code>、<code>sar -r</code> 和 <code>sar -W</code> 等来查看</li>
<li>怀疑 I/O 存在瓶颈，可用 <code>sar -b</code>、<code>sar -u</code> 和 <code>sar -d</code> 等来查看</li>
</ul>

            </div>
            <!-- Post Comments -->
            
        </div>
        <!-- Copyright 版权 start -->
        <div id="copyright">
    <ul>
        <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
        <li>Theme: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
        <!-- <li><a href="">鄂ICP备2020015912号-1</a></li> -->
    </ul>
    
    <span id="busuanzi_container_site_pv"> 2020 </span>
    
</div>
    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>





</html>