<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç‰›å®¢ä¸­å‡ ç§è¯­è¨€çš„è¾“å…¥è¾“å‡ºå§¿åŠ¿</title>
      <link href="/2020/04/06/%E5%88%B7%E9%A2%98/%E7%89%9B%E5%AE%A2%E4%B8%AD%E5%87%A0%E7%A7%8D%E8%AF%AD%E8%A8%80%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%A7%BF%E5%8A%BFmd/"/>
      <url>/2020/04/06/%E5%88%B7%E9%A2%98/%E7%89%9B%E5%AE%A2%E4%B8%AD%E5%87%A0%E7%A7%8D%E8%AF%AD%E8%A8%80%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%A7%BF%E5%8A%BFmd/</url>
      
        <content type="html"><![CDATA[<p>æœ‰äº›å‘çˆ¹å…¬å¸è€ƒè¯•å±…ç„¶è¦è‡ªå·±å¤„ç†è¾“å…¥è¾“å‡º ï¼Œå“ã€‚ã€‚ã€‚ã€‚</p><p>æ€»ç»“ä¸€æ³¢è‡ªå·±å¸¸ç”¨çš„Pythonã€Javaã€Golangçš„è¾“å…¥è¾“å‡ºæŠ€å·§ã€‚</p><a id="more"></a><h2 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h2><h3 id="70-Common-è¾“å…¥è¾“å‡º"><a href="#70-Common-è¾“å…¥è¾“å‡º" class="headerlink" title="70% Common è¾“å…¥è¾“å‡º"></a>70% Common è¾“å…¥è¾“å‡º</h3><p>è¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼Œè¾“å…¥ä¸€ä¸ªçŸ©é˜µç±»å‹</p><h4 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> m, n <span class="keyword">int</span></span><br><span class="line">fmt.Scanln(&amp;m, &amp;n)</span><br><span class="line"><span class="keyword">var</span> hash [][]<span class="keyword">int</span> = <span class="built_in">make</span>([][]<span class="keyword">int</span>, m)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; m; i++ &#123;</span><br><span class="line">hash[i] = <span class="built_in">make</span>([]<span class="keyword">int</span>, n)</span><br><span class="line"><span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">fmt.Scan(&amp;hash[i][j])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(hash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IODemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">int</span> m = sc.nextInt(), n = sc.nextInt();</span><br><span class="line">        <span class="keyword">int</span> m1 = sc.nextInt(), n1 = sc.nextInt();</span><br><span class="line">      <span class="keyword">int</span>[][] map = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">      <span class="keyword">float</span>[][] fmap = <span class="keyword">new</span> <span class="keyword">float</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                map[i][j] = sc.nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                fmap[i][j] = sc.nextFloat();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sc.close();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                System.out.println(map[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m, n = map(int, input().strip().split())</span><br><span class="line">dray = [[<span class="number">0</span>]*n]*n</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">    dray[i] = map(int, input().strip().split())</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹äººå®¶Pythonå¤„ç†çš„å¤šèˆ’æœï¼Œé™¤äº†è¦æš´åŠ›è®¡ç®—çš„æ—¶å€™ï¼Œä¸€èˆ¬é¦–é€‰Pythonã€‚ğŸ˜</p><h3 id="90-Common-å­—ç¬¦ä¸²è½¬æ•´æ•°"><a href="#90-Common-å­—ç¬¦ä¸²è½¬æ•´æ•°" class="headerlink" title="90% Common å­—ç¬¦ä¸²è½¬æ•´æ•°"></a>90% Common å­—ç¬¦ä¸²è½¬æ•´æ•°</h3><p>è¾“å…¥çš„æ•°æ®ä»¥æŸä¸ªå­—ç¬¦åˆ†å‰²,å¹¶è½¬åŒ–ä¸ºæ•´æ•°orå°æ•°</p><h4 id="Go-1"><a href="#Go-1" class="headerlink" title="Go"></a>Go</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;bufio&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    input := bufio.NewScanner(os.Stdin)</span><br><span class="line">    <span class="keyword">for</span> input.Scan() &#123;</span><br><span class="line">        a := strings.Split(input.Text(), <span class="string">&quot;,&quot;</span>)</span><br><span class="line">        a0, _ := strconv.Atoi(a[<span class="number">0</span>])</span><br><span class="line">        a1, _ := strconv.Atoi(a[<span class="number">1</span>])</span><br><span class="line">        fmt.Println(a0 + a1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IO2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        String s = sc.next();</span><br><span class="line">        String[] ss = s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ss.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> thenum = Integer.parseInt(ss[i]);</span><br><span class="line">            System.out.println(thenum);</span><br><span class="line">            sum += thenum;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        sc.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">st = intput()</span><br><span class="line">ist = int(st)</span><br></pre></td></tr></table></figure><h2 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h2><h3 id="Go-2"><a href="#Go-2" class="headerlink" title="Go"></a>Go</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%v     å€¼çš„é»˜è®¤æ ¼å¼ã€‚</span><br><span class="line">%+v   ç±»ä¼¼%vï¼Œä½†è¾“å‡ºç»“æ„ä½“æ—¶ä¼šæ·»åŠ å­—æ®µå</span><br><span class="line">%#vã€€ ç›¸åº”å€¼çš„Goè¯­æ³•è¡¨ç¤º </span><br><span class="line">%T    ç›¸åº”å€¼çš„ç±»å‹çš„Goè¯­æ³•è¡¨ç¤º </span><br><span class="line">%%    ç™¾åˆ†å·,å­—é¢ä¸Šçš„%,éå ä½ç¬¦å«ä¹‰</span><br><span class="line">%b     äºŒè¿›åˆ¶è¡¨ç¤º </span><br><span class="line">%c     ç›¸åº”Unicodeç ç‚¹æ‰€è¡¨ç¤ºçš„å­—ç¬¦ </span><br><span class="line">%d     åè¿›åˆ¶è¡¨ç¤º </span><br><span class="line">%o     å…«è¿›åˆ¶è¡¨ç¤º </span><br><span class="line">%q     å•å¼•å·å›´ç»•çš„å­—ç¬¦å­—é¢å€¼ï¼Œç”±Goè¯­æ³•å®‰å…¨åœ°è½¬ä¹‰ </span><br><span class="line">%x     åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå­—æ¯å½¢å¼ä¸ºå°å†™ a-f </span><br><span class="line">%X     åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå­—æ¯å½¢å¼ä¸ºå¤§å†™ A-F </span><br><span class="line">%U     Unicodeæ ¼å¼ï¼š123ï¼Œç­‰åŒäº &quot;U+007B&quot;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// æ——æ ‡ã€å®½åº¦ã€ç²¾åº¦ã€ç´¢å¼•</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;|%0+- #[1]*.[2]*[3]d|%0+- #[1]*.[2]*[4]d|\n&quot;</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">32</span>, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ®ç‚¹å‹ç²¾åº¦</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;|%f|%8.4f|%8.f|%.4f|%.f|\n&quot;</span>, <span class="number">3.2</span>, <span class="number">3.2</span>, <span class="number">3.2</span>, <span class="number">3.2</span>, <span class="number">3.2</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;|%.3f|%.3g|\n&quot;</span>, <span class="number">12.345678</span>, <span class="number">12.345678</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;|%.2f|\n&quot;</span>, <span class="number">12.345678</span>+<span class="number">12.345678i</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²ç²¾åº¦</span></span><br><span class="line">s := <span class="string">&quot;ä½ å¥½ä¸–ç•Œï¼&quot;</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;|%s|%8.2s|%8.s|%.2s|%.s|\n&quot;</span>, s, s, s, s, s)</span><br><span class="line">fmt.Printf(<span class="string">&quot;|%x|%8.2x|%8.x|%.2x|%.x|\n&quot;</span>, s, s, s, s, s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦å¼•å·å­—ç¬¦ä¸²</span></span><br><span class="line">s1 := <span class="string">&quot;Hello ä¸–ç•Œ!&quot;</span>       <span class="comment">// CanBackquote</span></span><br><span class="line">s2 := <span class="string">&quot;Hello\nä¸–ç•Œ!&quot;</span>      <span class="comment">// !CanBackquote</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, s1)  <span class="comment">// åŒå¼•å·</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%#q\n&quot;</span>, s1) <span class="comment">// åå¼•å·æˆåŠŸ</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%#q\n&quot;</span>, s2) <span class="comment">// åå¼•å·å¤±è´¥</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%+q\n&quot;</span>, s2) <span class="comment">// ä»…åŒ…å« ASCII å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Unicode ç ç‚¹</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%U, %#U\n&quot;</span>, <span class="string">&#x27;å¥½&#x27;</span>, <span class="string">&#x27;å¥½&#x27;</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%U, %#U\n&quot;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å£ç±»å‹å°†è¾“å‡ºå…¶å†…éƒ¨åŒ…å«çš„å€¼</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">age  <span class="keyword">int</span></span><br><span class="line">&#125;&#123;<span class="string">&quot;AAA&quot;</span>, <span class="number">20</span>&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%v\n&quot;</span>, i)  <span class="comment">// åªè¾“å‡ºå­—æ®µå€¼</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%+v\n&quot;</span>, i) <span class="comment">// åŒæ—¶è¾“å‡ºå­—æ®µå</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, i) <span class="comment">// Go è¯­æ³•æ ¼å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç±»å‹</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">|+0032   |+0064   |</span><br><span class="line">|3.200000|  3.2000|       3|3.2000|3|</span><br><span class="line">|12.346|12.3|</span><br><span class="line">|(12.35+12.35i)|</span><br><span class="line">|ä½ å¥½ä¸–ç•Œï¼|      ä½ å¥½|        |ä½ å¥½||</span><br><span class="line">|e4bda0e5a5bde4b896e7958cefbc81|    e4bd|        |e4bd||</span><br><span class="line">&quot;Hello ä¸–ç•Œ!&quot;</span><br><span class="line">&#96;Hello ä¸–ç•Œ!&#96;</span><br><span class="line">&quot;Hello\nä¸–ç•Œ!&quot;</span><br><span class="line">&quot;Hello\n\u4e16\u754c!&quot;</span><br><span class="line">U+597D, U+597D &#39;å¥½&#39;</span><br><span class="line">U+000A, U+000A</span><br><span class="line">&#123;AAA 20&#125;</span><br><span class="line">&#123;name:AAA age:20&#125;</span><br><span class="line">struct &#123; name string; age int &#125;&#123;name:&quot;AAA&quot;, age:20&#125;</span><br><span class="line">struct &#123; name string; age int &#125;</span><br></pre></td></tr></table></figure><h3 id="Java-2"><a href="#Java-2" class="headerlink" title="Java"></a>Java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IO3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*** è¾“å‡ºå­—ç¬¦ä¸² ***/</span></span><br><span class="line">        <span class="comment">// %sè¡¨ç¤ºè¾“å‡ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å°†åé¢çš„å­—ç¬¦ä¸²æ›¿æ¢æ¨¡å¼ä¸­çš„%s</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%s&quot;</span>, <span class="number">1212</span>);</span><br><span class="line">        <span class="comment">// %nè¡¨ç¤ºæ¢è¡Œ</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%s%n&quot;</span>, <span class="string">&quot;end line&quot;</span>);</span><br><span class="line">        <span class="comment">// è¿˜å¯ä»¥æ”¯æŒå¤šä¸ªå‚æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%s = %s%n&quot;</span>, <span class="string">&quot;Name&quot;</span>, <span class="string">&quot;Zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">// %Så°†å­—ç¬¦ä¸²ä»¥å¤§å†™å½¢å¼è¾“å‡º</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%S = %s%n&quot;</span>, <span class="string">&quot;Name&quot;</span>, <span class="string">&quot;Zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">// æ”¯æŒå¤šä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥åœ¨%sä¹‹é—´æ’å…¥å˜é‡ç¼–å·ï¼Œ1$è¡¨ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ3$è¡¨ç¤ºç¬¬3ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$s = %3$s %2$s%n&quot;</span>, <span class="string">&quot;Name&quot;</span>, <span class="string">&quot;san&quot;</span>, <span class="string">&quot;Zhang&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*** è¾“å‡ºbooleanç±»å‹ ***/</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;true = %b; false = &quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;%b%n&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*** è¾“å‡ºæ•´æ•°ç±»å‹ ***/</span></span><br><span class="line">        Integer iObj = <span class="number">342</span>;</span><br><span class="line">        <span class="comment">// %dè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º10è¿›åˆ¶æ•´æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%d; %d; %d%n&quot;</span>, -<span class="number">500</span>, <span class="number">2343L</span>, iObj);</span><br><span class="line">        <span class="comment">// %oè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º8è¿›åˆ¶æ•´æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%o; %o; %o%n&quot;</span>, -<span class="number">500</span>, <span class="number">2343L</span>, iObj);</span><br><span class="line">        <span class="comment">// %xè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º16è¿›åˆ¶æ•´æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%x; %x; %x%n&quot;</span>, -<span class="number">500</span>, <span class="number">2343L</span>, iObj);</span><br><span class="line">        <span class="comment">// %Xè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º16è¿›åˆ¶æ•´æ•°ï¼Œå¹¶ä¸”å­—æ¯å˜æˆå¤§å†™å½¢å¼</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%X; %X; %X%n&quot;</span>, -<span class="number">500</span>, <span class="number">2343L</span>, iObj);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*** è¾“å‡ºæµ®ç‚¹ç±»å‹ ***/</span></span><br><span class="line">        Double dObj = <span class="number">45.6d</span>;</span><br><span class="line">        <span class="comment">// %eè¡¨ç¤ºä»¥ç§‘å­¦æŠ€æœ¯æ³•è¾“å‡ºæµ®ç‚¹æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%e; %e; %e%n&quot;</span>, -<span class="number">756.403f</span>, <span class="number">7464.232641d</span>, dObj);</span><br><span class="line">        <span class="comment">// %Eè¡¨ç¤ºä»¥ç§‘å­¦æŠ€æœ¯æ³•è¾“å‡ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¸ºå¤§å†™å½¢å¼</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%E; %E; %E%n&quot;</span>, -<span class="number">756.403f</span>, <span class="number">7464.232641d</span>, dObj);</span><br><span class="line">        <span class="comment">// %fè¡¨ç¤ºä»¥åè¿›åˆ¶æ ¼å¼åŒ–è¾“å‡ºæµ®ç‚¹æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%f; %f; %f%n&quot;</span>, -<span class="number">756.403f</span>, <span class="number">7464.232641d</span>, dObj);</span><br><span class="line">        <span class="comment">// è¿˜å¯ä»¥é™åˆ¶å°æ•°ç‚¹åçš„ä½æ•°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%.1f; %.3f; %f%n&quot;</span>, -<span class="number">756.403f</span>, <span class="number">7464.232641d</span>, dObj);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*** è¾“å‡ºæ—¥æœŸç±»å‹ ***/</span></span><br><span class="line">        <span class="comment">// %tè¡¨ç¤ºæ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ç±»å‹ï¼Œ%Tæ˜¯æ—¶é—´æ—¥æœŸçš„å¤§å†™å½¢å¼ï¼Œåœ¨%tä¹‹åç”¨ç‰¹å®šçš„å­—æ¯è¡¨ç¤ºä¸åŒçš„è¾“å‡ºæ ¼å¼</span></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">long</span> dataL = date.getTime();</span><br><span class="line">        <span class="comment">// æ ¼å¼åŒ–å¹´æœˆæ—¥</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨yè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„å¹´ä»½ï¼ˆ2ä½æ•°çš„å¹´ï¼Œå¦‚99ï¼‰</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨mè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½ï¼Œ%tä¹‹åç”¨dè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æ—¥å·</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$ty-%1$tm-%1$td; %2$ty-%2$tm-%2$td%n&quot;</span>, date, dataL);</span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Yè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„å¹´ä»½ï¼ˆ4ä½æ•°çš„å¹´ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Bè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½çš„å®Œæ•´åï¼Œ %tä¹‹åç”¨bè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½çš„ç®€ç§°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tY-%1$tB-%1$td; %2$tY-%2$tb-%2$td%n&quot;</span>, date, dataL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»¥ä¸‹æ˜¯å¸¸è§çš„æ—¥æœŸç»„åˆ</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Dè¡¨ç¤ºä»¥ &quot;%tm/%td/%ty&quot;æ ¼å¼åŒ–æ—¥æœŸ</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tD%n&quot;</span>, date);</span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Fè¡¨ç¤ºä»¥&quot;%tY-%tm-%td&quot;æ ¼å¼åŒ–æ—¥æœŸ</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tF%n&quot;</span>, date);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*** è¾“å‡ºæ—¶é—´ç±»å‹ ***/</span></span><br><span class="line">        <span class="comment">// è¾“å‡ºæ—¶åˆ†ç§’</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Hè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ—¶ï¼ˆ24è¿›åˆ¶ï¼‰ï¼Œ%tä¹‹åç”¨Iè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ—¶ï¼ˆ12è¿›åˆ¶ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Mè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„åˆ†ï¼Œ%tä¹‹åç”¨Sè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ç§’</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tH:%1$tM:%1$tS; %2$tI:%2$tM:%2$tS%n&quot;</span>, date, dataL);</span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Lè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ç§’ä¸­çš„æ¯«ç§’</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tH:%1$tM:%1$tS %1$tL%n&quot;</span>, date);</span><br><span class="line">        <span class="comment">// %tä¹‹åpè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ä¸Šåˆæˆ–ä¸‹åˆä¿¡æ¯</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tH:%1$tM:%1$tS %1$tL %1$tp%n&quot;</span>, date);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»¥ä¸‹æ˜¯å¸¸è§çš„æ—¶é—´ç»„åˆ</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Rè¡¨ç¤ºä»¥&quot;%tH:%tM&quot;æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tR%n&quot;</span>, date);</span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Tè¡¨ç¤ºä»¥&quot;%tH:%tM:%tS&quot;æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tT%n&quot;</span>, date);</span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨rè¡¨ç¤ºä»¥&quot;%tI:%tM:%tS %Tp&quot;æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tr%n&quot;</span>, date);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*** è¾“å‡ºæ˜ŸæœŸ ***/</span></span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨Aè¡¨ç¤ºå¾—åˆ°æ˜ŸæœŸå‡ çš„å…¨ç§°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tF %1$tA%n&quot;</span>, date);</span><br><span class="line">        <span class="comment">// %tä¹‹åç”¨aè¡¨ç¤ºå¾—åˆ°æ˜ŸæœŸå‡ çš„ç®€ç§°</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tF %1$ta%n&quot;</span>, date);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºæ—¶é—´æ—¥æœŸçš„å®Œæ•´ä¿¡æ¯</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;%1$tc%n&quot;</span>, date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1212end line</span><br><span class="line">Name &#x3D; Zhangsan</span><br><span class="line">NAME &#x3D; Zhangsan</span><br><span class="line">Name &#x3D; Zhang san</span><br><span class="line">true &#x3D; true; false &#x3D; false</span><br><span class="line">-500; 2343; 342</span><br><span class="line">37777777014; 4447; 526</span><br><span class="line">fffffe0c; 927; 156</span><br><span class="line">FFFFFE0C; 927; 156</span><br><span class="line">-7.564030e+02; 7.464233e+03; 4.560000e+01</span><br><span class="line">-7.564030E+02; 7.464233E+03; 4.560000E+01</span><br><span class="line">-756.403015; 7464.232641; 45.600000</span><br><span class="line">-756.4; 7464.233; 45.600000</span><br><span class="line">20-09-06; 20-09-06</span><br><span class="line">2020-September-06; 2020-Sep-06</span><br><span class="line">09&#x2F;06&#x2F;20</span><br><span class="line">2020-09-06</span><br><span class="line">18:03:51; 06:03:51</span><br><span class="line">18:03:51 273</span><br><span class="line">18:03:51 273 pm</span><br><span class="line">18:03</span><br><span class="line">18:03:51</span><br><span class="line">06:03:51 PM</span><br><span class="line">2020-09-06 Sunday</span><br><span class="line">2020-09-06 Sun</span><br><span class="line">Sun Sep 06 18:03:51 CST 2020</span><br></pre></td></tr></table></figure><h3 id="Python-2"><a href="#Python-2" class="headerlink" title="Python"></a>Python</h3><div class="table-container"><table><thead><tr><th>è½¬æ¢è¯´æ˜ç¬¦</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>%dã€%i</td><td>è½¬æ¢ä¸ºå¸¦ç¬¦å·çš„åè¿›åˆ¶æ•´æ•°</td></tr><tr><td>%o</td><td>è½¬æ¢ä¸ºå¸¦ç¬¦å·çš„å…«è¿›åˆ¶æ•´æ•°</td></tr><tr><td>%xã€%X</td><td>è½¬æ¢ä¸ºå¸¦ç¬¦å·çš„åå…­è¿›åˆ¶æ•´æ•°</td></tr><tr><td>%e</td><td>è½¬åŒ–ä¸ºç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆe å°å†™ï¼‰</td></tr><tr><td>%E</td><td>è½¬åŒ–ä¸ºç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆE å¤§å†™ï¼‰</td></tr><tr><td>%fã€%F</td><td>è½¬åŒ–ä¸ºåè¿›åˆ¶æµ®ç‚¹æ•°</td></tr><tr><td>%g</td><td>æ™ºèƒ½é€‰æ‹©ä½¿ç”¨ %f æˆ– %e æ ¼å¼</td></tr><tr><td>%G</td><td>æ™ºèƒ½é€‰æ‹©ä½¿ç”¨ %F æˆ– %E æ ¼å¼</td></tr><tr><td>%c</td><td>æ ¼å¼åŒ–å­—ç¬¦åŠå…¶ ASCII ç </td></tr><tr><td>%r</td><td>ä½¿ç”¨ repr() å‡½æ•°å°†è¡¨è¾¾å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</td></tr><tr><td>%s</td><td>ä½¿ç”¨ str() å‡½æ•°å°†è¡¨è¾¾å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</td></tr></tbody></table></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># å ä½ç¬¦</span><br><span class="line">name &#x3D; &quot;maywzhçš„ç½‘ç«™&quot;</span><br><span class="line">age &#x3D; 8</span><br><span class="line">url &#x3D; &quot;https:&#x2F;&#x2F;maywzh.com&quot;</span><br><span class="line">print(&quot;%så·²ç»%då²äº†ï¼Œå®ƒçš„ç½‘å€æ˜¯%sã€‚&quot; % (name, age, url))</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šå®½åº¦</span><br><span class="line">n &#x3D; 1234567</span><br><span class="line">print(&quot;n(10):%10d.&quot; % n)</span><br><span class="line">print(&quot;n(5):%5d.&quot; % n)</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;c.biancheng.net&#x2F;python&#x2F;&quot;</span><br><span class="line">print(&quot;url(35):%35s.&quot; % url)</span><br><span class="line">print(&quot;url(20):%20s.&quot; % url)</span><br><span class="line"></span><br><span class="line">#å¯¹é½æ–¹å¼</span><br><span class="line">n &#x3D; 123456</span><br><span class="line"># %09d è¡¨ç¤ºæœ€å°å®½åº¦ä¸º9ï¼Œå·¦è¾¹è¡¥0</span><br><span class="line">print(&quot;n(09):%09d&quot; % n)</span><br><span class="line"># %+9d è¡¨ç¤ºæœ€å°å®½åº¦ä¸º9ï¼Œå¸¦ä¸Šç¬¦å·</span><br><span class="line">print(&quot;n(+9):%+9d&quot; % n)</span><br><span class="line">f &#x3D; 140.5</span><br><span class="line"># %-+010f è¡¨ç¤ºæœ€å°å®½åº¦ä¸º10ï¼Œå·¦å¯¹é½ï¼Œå¸¦ä¸Šç¬¦å·</span><br><span class="line">print(&quot;f(-+0):%-+010f&quot; % f)</span><br><span class="line">s &#x3D; &quot;Hello&quot;</span><br><span class="line"># %-10s è¡¨ç¤ºæœ€å°å®½åº¦ä¸º10ï¼Œå·¦å¯¹é½</span><br><span class="line">print(&quot;s(-10):%-10s.&quot; % s)</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šå°æ•°ç²¾åº¦</span><br><span class="line">f &#x3D; 3.141592653</span><br><span class="line"># æœ€å°å®½åº¦ä¸º8ï¼Œå°æ•°ç‚¹åä¿ç•™3ä½</span><br><span class="line">print(&quot;%8.3f&quot; % f)</span><br><span class="line"># æœ€å°å®½åº¦ä¸º8ï¼Œå°æ•°ç‚¹åä¿ç•™3ä½ï¼Œå·¦è¾¹è¡¥0</span><br><span class="line">print(&quot;%08.3f&quot; % f)</span><br><span class="line"># æœ€å°å®½åº¦ä¸º8ï¼Œå°æ•°ç‚¹åä¿ç•™3ä½ï¼Œå·¦è¾¹è¡¥0ï¼Œå¸¦ç¬¦å·</span><br><span class="line">print(&quot;%+08.3f&quot; % f)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ·é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Go </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„ä¸Šä¸‹æ–‡ä¸Context</title>
      <link href="/2020/01/19/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B8%8EContext/"/>
      <url>/2020/01/19/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B8%8EContext/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šä¸‹æ–‡ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> æ˜¯ç”¨æ¥è®¾ç½®æˆªæ­¢æ—¥æœŸã€åŒæ­¥ä¿¡å·ï¼Œä¼ é€’è¯·æ±‚ç›¸å…³å€¼çš„ç»“æ„ä½“ã€‚ä¸Šä¸‹æ–‡ä¸ Goroutine æœ‰æ¯”è¾ƒå¯†åˆ‡çš„å…³ç³»ã€‚<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> æ˜¯ Go è¯­è¨€ä¸­ç‹¬ç‰¹çš„è®¾è®¡ï¼Œåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­æˆ‘ä»¬å¾ˆå°‘è§åˆ°ç±»ä¼¼çš„æ¦‚å¿µã€‚</p><a id="more"></a><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> æ˜¯ Go è¯­è¨€åœ¨ 1.7 ç‰ˆæœ¬ä¸­å¼•å…¥æ ‡å‡†åº“çš„æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†å››ä¸ªéœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ol><li><p><code>Deadline</code> â€” è¿”å› <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> è¢«å–æ¶ˆçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå·¥ä½œçš„æˆªæ­¢æ—¥æœŸï¼›</p></li><li><p><code>Done</code> â€” è¿”å›ä¸€ä¸ª Channelï¼Œè¿™ä¸ª Channel ä¼šåœ¨å½“å‰å·¥ä½œå®Œæˆæˆ–è€…ä¸Šä¸‹æ–‡è¢«å–æ¶ˆä¹‹åå…³é—­ï¼Œå¤šæ¬¡è°ƒç”¨ <code>Done</code> æ–¹æ³•ä¼šè¿”å›åŒä¸€ä¸ª Channelï¼›</p></li><li><p>```<br>Err</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">â€” è¿”å›</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">`context.Context`</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ç»“æŸçš„åŸå› ï¼Œå®ƒåªä¼šåœ¨</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Done</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="code">    </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">   è¿”å›çš„ Channel è¢«å…³é—­æ—¶æ‰ä¼šè¿”å›éç©ºçš„å€¼ï¼›</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">   1. å¦‚æœ [`context.Context`](https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154) è¢«å–æ¶ˆï¼Œä¼šè¿”å› `Canceled` é”™è¯¯ï¼›</span></span><br><span class="line"><span class="code">   2. å¦‚æœ [`context.Context`](https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154) è¶…æ—¶ï¼Œä¼šè¿”å› `DeadlineExceeded` é”™è¯¯ï¼›</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">4. `Value` â€” ä» [`context.Context`](https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154) ä¸­è·å–é”®å¯¹åº”çš„å€¼ï¼Œå¯¹äºåŒä¸€ä¸ªä¸Šä¸‹æ–‡æ¥è¯´ï¼Œå¤šæ¬¡è°ƒç”¨ `Value` å¹¶ä¼ å…¥ç›¸åŒçš„ `Key` ä¼šè¿”å›ç›¸åŒçš„ç»“æœï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥ä¼ é€’è¯·æ±‚ç‰¹å®šçš„æ•°æ®ï¼›</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">```go</span></span><br><span class="line"><span class="code">type Context interface &#123;</span></span><br><span class="line"><span class="code">Deadline() (deadline time.Time, ok bool)</span></span><br><span class="line"><span class="code">Done() &lt;-chan struct&#123;&#125;</span></span><br><span class="line"><span class="code">Err() error</span></span><br><span class="line"><span class="code">Value(key interface&#123;&#125;) interface&#123;&#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br></pre></td></tr></table></figure></li></ol><p><a href="https://github.com/golang/go/tree/master/src/context"><code>context</code></a> åŒ…ä¸­æä¾›çš„ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L208-L210"><code>context.Background</code></a>ã€<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L216-L218"><code>context.TODO</code></a>ã€<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L232-L236"><code>context.WithDeadline</code></a> å’Œ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L513-L521"><code>context.WithValue</code></a> å‡½æ•°ä¼šè¿”å›å®ç°è¯¥æ¥å£çš„ç§æœ‰ç»“æ„ä½“ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è¯¦ç»†ä»‹ç»å®ƒä»¬çš„å·¥ä½œåŸç†ã€‚</p><h2 id="è®¾è®¡åŸç†"><a href="#è®¾è®¡åŸç†" class="headerlink" title="è®¾è®¡åŸç†"></a>è®¾è®¡åŸç†</h2><p>åœ¨ Goroutine æ„æˆçš„æ ‘å½¢ç»“æ„ä¸­å¯¹ä¿¡å·è¿›è¡ŒåŒæ­¥ä»¥å‡å°‘è®¡ç®—èµ„æºçš„æµªè´¹æ˜¯ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> çš„æœ€å¤§ä½œç”¨ã€‚Go æœåŠ¡çš„æ¯ä¸€ä¸ªè¯·æ±‚çš„éƒ½æ˜¯é€šè¿‡å•ç‹¬çš„ Goroutine å¤„ç†çš„ï¼ŒHTTP/RPC è¯·æ±‚çš„å¤„ç†å™¨ä¼šå¯åŠ¨æ–°çš„ Goroutine è®¿é—®æ•°æ®åº“å’Œå…¶ä»–æœåŠ¡ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåˆ›å»ºå¤šä¸ª Goroutine æ¥å¤„ç†ä¸€æ¬¡è¯·æ±‚ï¼Œè€Œ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> çš„ä½œç”¨å°±æ˜¯åœ¨ä¸åŒ Goroutine ä¹‹é—´åŒæ­¥è¯·æ±‚ç‰¹å®šæ•°æ®ã€å–æ¶ˆä¿¡å·ä»¥åŠå¤„ç†è¯·æ±‚çš„æˆªæ­¢æ—¥æœŸã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-context-usage.png" alt="golang-context-usage"></p><p>æ¯ä¸€ä¸ª <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> éƒ½ä¼šä»æœ€é¡¶å±‚çš„ Goroutine ä¸€å±‚ä¸€å±‚ä¼ é€’åˆ°æœ€ä¸‹å±‚ã€‚<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> å¯ä»¥åœ¨ä¸Šå±‚ Goroutine æ‰§è¡Œå‡ºç°é”™è¯¯æ—¶ï¼Œå°†ä¿¡å·åŠæ—¶åŒæ­¥ç»™ä¸‹å±‚ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-without-context.png" alt="golang-without-context"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æœ€ä¸Šå±‚çš„ Goroutine å› ä¸ºæŸäº›åŸå› æ‰§è¡Œå¤±è´¥æ—¶ï¼Œä¸‹å±‚çš„ Goroutine ç”±äºæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªä¿¡å·æ‰€ä»¥ä¼šç»§ç»­å·¥ä½œï¼›ä½†æ˜¯å½“æˆ‘ä»¬æ­£ç¡®åœ°ä½¿ç”¨ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> æ—¶ï¼Œå°±å¯ä»¥åœ¨ä¸‹å±‚åŠæ—¶åœæ‰æ— ç”¨çš„å·¥ä½œä»¥å‡å°‘é¢å¤–èµ„æºçš„æ¶ˆè€—ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-with-context.png" alt="golang-with-context"></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç ç‰‡æ®µäº†è§£ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> æ˜¯å¦‚ä½•å¯¹ä¿¡å·è¿›è¡ŒåŒæ­¥çš„ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´ä¸º 1s çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘ä¸Šä¸‹æ–‡ä¼ å…¥ <code>handle</code> å‡½æ•°ï¼Œè¯¥æ–¹æ³•ä¼šä½¿ç”¨ 500ms çš„æ—¶é—´å¤„ç†ä¼ å…¥çš„ã€è¯·æ±‚ã€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx, cancel := context.WithTimeout(context.Background(), <span class="number">1</span>*time.Second)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> handle(ctx, <span class="number">500</span>*time.Millisecond)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">fmt.Println(<span class="string">&quot;main&quot;</span>, ctx.Err())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(ctx context.Context, duration time.Duration)</span></span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">fmt.Println(<span class="string">&quot;handle&quot;</span>, ctx.Err())</span><br><span class="line"><span class="keyword">case</span> &lt;-time.After(duration):</span><br><span class="line">fmt.Println(<span class="string">&quot;process request with&quot;</span>, duration)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿‡æœŸæ—¶é—´å¤§äºå¤„ç†æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„æ—¶é—´å¤„ç†è¯¥ã€è¯·æ±‚ã€ï¼Œè¿è¡Œä¸Šè¿°ä»£ç ä¼šæ‰“å°å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„å†…å®¹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> run context.<span class="keyword">go</span></span><br><span class="line">process request with <span class="number">500</span>ms</span><br><span class="line">main context deadline exceeded</span><br></pre></td></tr></table></figure><p><code>handle</code> å‡½æ•°æ²¡æœ‰è¿›å…¥è¶…æ—¶çš„ <code>select</code> åˆ†æ”¯ï¼Œä½†æ˜¯ <code>main</code> å‡½æ•°çš„ <code>select</code> å´ä¼šç­‰å¾… <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> çš„è¶…æ—¶å¹¶æ‰“å°å‡º <code>main context deadline exceeded</code>ã€‚</p><p>å¦‚æœæˆ‘ä»¬å°†å¤„ç†ã€è¯·æ±‚ã€æ—¶é—´å¢åŠ è‡³ 1500msï¼Œæ•´ä¸ªç¨‹åºéƒ½ä¼šå› ä¸ºä¸Šä¸‹æ–‡çš„è¿‡æœŸè€Œè¢«ä¸­æ­¢ï¼Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> run context.<span class="keyword">go</span></span><br><span class="line">main context deadline exceeded</span><br><span class="line">handle context deadline exceeded</span><br></pre></td></tr></table></figure><p>ç›¸ä¿¡è¿™ä¸¤ä¸ªä¾‹å­èƒ½å¤Ÿå¸®åŠ©å„ä½è¯»è€…ç†è§£ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> çš„ä½¿ç”¨æ–¹æ³•å’Œè®¾è®¡åŸç† â€” å¤šä¸ª Goroutine åŒæ—¶è®¢é˜… <code>ctx.Done()</code> ç®¡é“ä¸­çš„æ¶ˆæ¯ï¼Œä¸€æ—¦æ¥æ”¶åˆ°å–æ¶ˆä¿¡å·å°±ç«‹åˆ»åœæ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„å·¥ä½œã€‚</p><h2 id="é»˜è®¤ä¸Šä¸‹æ–‡"><a href="#é»˜è®¤ä¸Šä¸‹æ–‡" class="headerlink" title="é»˜è®¤ä¸Šä¸‹æ–‡"></a>é»˜è®¤ä¸Šä¸‹æ–‡</h2><p><a href="https://github.com/golang/go/tree/master/src/context"><code>context</code></a> åŒ…ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•è¿˜æ˜¯ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L208-L210"><code>context.Background</code></a>ã€<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L216-L218"><code>context.TODO</code></a>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›é¢„å…ˆåˆå§‹åŒ–å¥½çš„ç§æœ‰å˜é‡ <code>background</code> å’Œ <code>todo</code>ï¼Œå®ƒä»¬ä¼šåœ¨åŒä¸€ä¸ª Go ç¨‹åºä¸­è¢«å¤ç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> background</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TODO</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªç§æœ‰å˜é‡éƒ½æ˜¯é€šè¿‡ <code>new(emptyCtx)</code> è¯­å¥åˆå§‹åŒ–çš„ï¼Œå®ƒä»¬æ˜¯æŒ‡å‘ç§æœ‰ç»“æ„ä½“ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L171"><code>context.emptyCtx</code></a> çš„æŒ‡é’ˆï¼Œè¿™æ˜¯æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„ä¸Šä¸‹æ–‡ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyCtx <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Err</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç° <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L171"><code>context.emptyCtx</code></a> é€šè¿‡è¿”å› <code>nil</code> å®ç°äº† <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> æ¥å£ï¼Œå®ƒæ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„åŠŸèƒ½ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-context-hierarchy.png" alt="golang-context-hierarchy"></p><p><strong>å›¾ 6-4 Context å±‚çº§å…³ç³»</strong></p><p>ä»æºä»£ç æ¥çœ‹ï¼Œ<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L208-L210"><code>context.Background</code></a> å’Œ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L216-L218"><code>context.TODO</code></a> å‡½æ•°å…¶å®ä¹Ÿåªæ˜¯äº’ä¸ºåˆ«åï¼Œæ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚å®ƒä»¬åªæ˜¯åœ¨ä½¿ç”¨å’Œè¯­ä¹‰ä¸Šç¨æœ‰ä¸åŒï¼š</p><ul><li><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L208-L210"><code>context.Background</code></a> æ˜¯ä¸Šä¸‹æ–‡çš„é»˜è®¤å€¼ï¼Œæ‰€æœ‰å…¶ä»–çš„ä¸Šä¸‹æ–‡éƒ½åº”è¯¥ä»å®ƒè¡ç”Ÿï¼ˆDerivedï¼‰å‡ºæ¥ï¼›</li><li><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L216-L218"><code>context.TODO</code></a> åº”è¯¥åªåœ¨ä¸ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªç§ä¸Šä¸‹æ–‡æ—¶ä½¿ç”¨ï¼›</li></ul><p>åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœå½“å‰å‡½æ•°æ²¡æœ‰ä¸Šä¸‹æ–‡ä½œä¸ºå…¥å‚ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L208-L210"><code>context.Background</code></a> ä½œä¸ºèµ·å§‹çš„ä¸Šä¸‹æ–‡å‘ä¸‹ä¼ é€’ã€‚</p><h2 id="å–æ¶ˆä¿¡å·"><a href="#å–æ¶ˆä¿¡å·" class="headerlink" title="å–æ¶ˆä¿¡å·"></a>å–æ¶ˆä¿¡å·</h2><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L232-L236"><code>context.WithCancel</code></a> å‡½æ•°èƒ½å¤Ÿä» <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L62-L154"><code>context.Context</code></a> ä¸­è¡ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­ä¸Šä¸‹æ–‡å¹¶è¿”å›ç”¨äºå–æ¶ˆè¯¥ä¸Šä¸‹æ–‡çš„å‡½æ•°ï¼ˆCancelFuncï¼‰ã€‚ä¸€æ—¦æˆ‘ä»¬æ‰§è¡Œè¿”å›çš„å–æ¶ˆå‡½æ•°ï¼Œå½“å‰ä¸Šä¸‹æ–‡ä»¥åŠå®ƒçš„å­ä¸Šä¸‹æ–‡éƒ½ä¼šè¢«å–æ¶ˆï¼Œæ‰€æœ‰çš„ Goroutine éƒ½ä¼šåŒæ­¥æ”¶åˆ°è¿™ä¸€å–æ¶ˆä¿¡å·ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-01-20-15795072700927-golang-parent-cancel-context.png" alt="golang-parent-cancel-context"></p><p>æˆ‘ä»¬ç›´æ¥ä» <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L232-L236"><code>context.WithCancel</code></a> å‡½æ•°çš„å®ç°æ¥çœ‹å®ƒåˆ°åº•åšäº†ä»€ä¹ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span> &#123;</span><br><span class="line">c := newCancelCtx(parent)</span><br><span class="line">propagateCancel(parent, &amp;c)</span><br><span class="line"><span class="keyword">return</span> &amp;c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">true</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L239-L241"><code>context.newCancelCtx</code></a> å°†ä¼ å…¥çš„ä¸Šä¸‹æ–‡åŒ…è£…æˆç§æœ‰ç»“æ„ä½“ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L341-L348"><code>context.cancelCtx</code></a>ï¼›</li><li><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L247-L283"><code>context.propagateCancel</code></a> ä¼šæ„å»ºçˆ¶å­ä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³è”ï¼Œå½“çˆ¶ä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶ï¼Œå­ä¸Šä¸‹æ–‡ä¹Ÿä¼šè¢«å–æ¶ˆï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">propagateCancel</span><span class="params">(parent Context, child canceler)</span></span> &#123;</span><br><span class="line">done := parent.Done()</span><br><span class="line"><span class="keyword">if</span> done == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="comment">// çˆ¶ä¸Šä¸‹æ–‡ä¸ä¼šè§¦å‘å–æ¶ˆä¿¡å·</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-done:</span><br><span class="line">child.cancel(<span class="literal">false</span>, parent.Err()) <span class="comment">// çˆ¶ä¸Šä¸‹æ–‡å·²ç»è¢«å–æ¶ˆ</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p, ok := parentCancelCtx(parent); ok &#123;</span><br><span class="line">p.mu.Lock()</span><br><span class="line"><span class="keyword">if</span> p.err != <span class="literal">nil</span> &#123;</span><br><span class="line">child.cancel(<span class="literal">false</span>, p.err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p.children[child] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">p.mu.Unlock()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-parent.Done():</span><br><span class="line">child.cancel(<span class="literal">false</span>, parent.Err())</span><br><span class="line"><span class="keyword">case</span> &lt;-child.Done():</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°æ€»å…±ä¸çˆ¶ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¸‰ç§ä¸åŒçš„æƒ…å†µï¼š</p><ol><li><p>å½“ <code>parent.Done() == nil</code>ï¼Œä¹Ÿå°±æ˜¯ <code>parent</code> ä¸ä¼šè§¦å‘å–æ¶ˆäº‹ä»¶æ—¶ï¼Œå½“å‰å‡½æ•°ä¼šç›´æ¥è¿”å›ï¼›</p></li><li><p>å½“</p></li></ol>   <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">child</span></span><br></pre></td></tr></table></figure><p>   çš„ç»§æ‰¿é“¾åŒ…å«å¯ä»¥å–æ¶ˆçš„ä¸Šä¸‹æ–‡æ—¶ï¼Œä¼šåˆ¤æ–­</p>   <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">parent</span></span><br></pre></td></tr></table></figure><p>   æ˜¯å¦å·²ç»è§¦å‘äº†å–æ¶ˆä¿¡å·ï¼›</p><ul><li>å¦‚æœå·²ç»è¢«å–æ¶ˆï¼Œ<code>child</code> ä¼šç«‹åˆ»è¢«å–æ¶ˆï¼›</li><li>å¦‚æœæ²¡æœ‰è¢«å–æ¶ˆï¼Œ<code>child</code> ä¼šè¢«åŠ å…¥ <code>parent</code> çš„ <code>children</code> åˆ—è¡¨ä¸­ï¼Œç­‰å¾… <code>parent</code> é‡Šæ”¾å–æ¶ˆä¿¡å·ï¼›</li></ul><ol><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹</p><ol><li>è¿è¡Œä¸€ä¸ªæ–°çš„ Goroutine åŒæ—¶ç›‘å¬ <code>parent.Done()</code> å’Œ <code>child.Done()</code> ä¸¤ä¸ª Channel</li><li>åœ¨ <code>parent.Done()</code> å…³é—­æ—¶è°ƒç”¨ <code>child.cancel</code> å–æ¶ˆå­ä¸Šä¸‹æ–‡ï¼›</li></ol></li></ol><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L247-L283"><code>context.propagateCancel</code></a> çš„ä½œç”¨æ˜¯åœ¨ <code>parent</code> å’Œ <code>child</code> ä¹‹é—´åŒæ­¥å–æ¶ˆå’Œç»“æŸçš„ä¿¡å·ï¼Œä¿è¯åœ¨ <code>parent</code> è¢«å–æ¶ˆæ—¶ï¼Œ<code>child</code> ä¹Ÿä¼šæ”¶åˆ°å¯¹åº”çš„ä¿¡å·ï¼Œä¸ä¼šå‘ç”ŸçŠ¶æ€ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L341-L348"><code>context.cancelCtx</code></a> å®ç°çš„å‡ ä¸ªæ¥å£æ–¹æ³•ä¹Ÿæ²¡æœ‰å¤ªå¤šå€¼å¾—åˆ†æçš„åœ°æ–¹ï¼Œè¯¥ç»“æ„ä½“æœ€é‡è¦çš„æ–¹æ³•æ˜¯ <code>cancel</code>ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå…³é—­ä¸Šä¸‹æ–‡ä¸­çš„ Channel å¹¶å‘æ‰€æœ‰çš„å­ä¸Šä¸‹æ–‡åŒæ­¥å–æ¶ˆä¿¡å·ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cancelCtx)</span> <span class="title">cancel</span><span class="params">(removeFromParent <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">c.mu.Lock()</span><br><span class="line"><span class="keyword">if</span> c.err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.mu.Unlock()</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.err = err</span><br><span class="line"><span class="keyword">if</span> c.done == <span class="literal">nil</span> &#123;</span><br><span class="line">c.done = closedchan</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">close</span>(c.done)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> child := <span class="keyword">range</span> c.children &#123;</span><br><span class="line">child.cancel(<span class="literal">false</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">c.children = <span class="literal">nil</span></span><br><span class="line">c.mu.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> removeFromParent &#123;</span><br><span class="line">removeChild(c.Context, c)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº† <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L232-L236"><code>context.WithCancel</code></a> ä¹‹å¤–ï¼Œ<a href="https://github.com/golang/go/tree/master/src/context"><code>context</code></a> åŒ…ä¸­çš„å¦å¤–ä¸¤ä¸ªå‡½æ•° <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L427-L450"><code>context.WithDeadline</code></a> å’Œ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L496-L498"><code>context.WithTimeout</code></a> ä¹Ÿéƒ½èƒ½åˆ›å»ºå¯ä»¥è¢«å–æ¶ˆçš„è®¡æ—¶å™¨ä¸Šä¸‹æ–‡ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L455-L460"><code>context.timerCtx</code></a>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> WithDeadline(parent, time.Now().Add(timeout))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, d time.Time)</span> <span class="params">(Context, CancelFunc)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> cur, ok := parent.Deadline(); ok &amp;&amp; cur.Before(d) &#123;</span><br><span class="line"><span class="keyword">return</span> WithCancel(parent)</span><br><span class="line">&#125;</span><br><span class="line">c := &amp;timerCtx&#123;</span><br><span class="line">cancelCtx: newCancelCtx(parent),</span><br><span class="line">deadline:  d,</span><br><span class="line">&#125;</span><br><span class="line">propagateCancel(parent, c)</span><br><span class="line">dur := time.Until(d)</span><br><span class="line"><span class="keyword">if</span> dur &lt;= <span class="number">0</span> &#123;</span><br><span class="line">c.cancel(<span class="literal">true</span>, DeadlineExceeded) <span class="comment">// å·²ç»è¿‡äº†æˆªæ­¢æ—¥æœŸ</span></span><br><span class="line"><span class="keyword">return</span> c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">false</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br><span class="line">c.mu.Lock()</span><br><span class="line"><span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line"><span class="keyword">if</span> c.err == <span class="literal">nil</span> &#123;</span><br><span class="line">c.timer = time.AfterFunc(dur, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">c.cancel(<span class="literal">true</span>, DeadlineExceeded)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">true</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L427-L450"><code>context.WithDeadline</code></a> æ–¹æ³•åœ¨åˆ›å»º <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L455-L460"><code>context.timerCtx</code></a> çš„è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­äº†çˆ¶ä¸Šä¸‹æ–‡çš„æˆªæ­¢æ—¥æœŸä¸å½“å‰æ—¥æœŸï¼Œå¹¶é€šè¿‡ <a href="https://github.com/golang/go/blob/001fe7f33f1d7aed9e3a047bd8e784bdc103c28c/src/time/sleep.go#L155-L165"><code>time.AfterFunc</code></a> åˆ›å»ºå®šæ—¶å™¨ï¼Œå½“æ—¶é—´è¶…è¿‡äº†æˆªæ­¢æ—¥æœŸåä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L472-L484"><code>context.timerCtx.cancel</code></a> æ–¹æ³•åŒæ­¥å–æ¶ˆä¿¡å·ã€‚</p><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L455-L460"><code>context.timerCtx</code></a> ç»“æ„ä½“å†…éƒ¨ä¸ä»…é€šè¿‡åµŒå…¥äº†<a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L341-L348"><code>context.cancelCtx</code></a> ç»“æ„ä½“ç»§æ‰¿äº†ç›¸å…³çš„å˜é‡å’Œæ–¹æ³•ï¼Œè¿˜é€šè¿‡æŒæœ‰çš„å®šæ—¶å™¨ <code>timer</code> å’Œæˆªæ­¢æ—¶é—´ <code>deadline</code> å®ç°äº†å®šæ—¶å–æ¶ˆè¿™ä¸€åŠŸèƒ½ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> timerCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">cancelCtx</span><br><span class="line">timer *time.Timer <span class="comment">// Under cancelCtx.mu.</span></span><br><span class="line"></span><br><span class="line">deadline time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *timerCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> c.deadline, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *timerCtx)</span> <span class="title">cancel</span><span class="params">(removeFromParent <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">c.cancelCtx.cancel(<span class="literal">false</span>, err)</span><br><span class="line"><span class="keyword">if</span> removeFromParent &#123;</span><br><span class="line">removeChild(c.cancelCtx.Context, c)</span><br><span class="line">&#125;</span><br><span class="line">c.mu.Lock()</span><br><span class="line"><span class="keyword">if</span> c.timer != <span class="literal">nil</span> &#123;</span><br><span class="line">c.timer.Stop()</span><br><span class="line">c.timer = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">c.mu.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L472-L484"><code>context.timerCtx.cancel</code></a> æ–¹æ³•ä¸ä»…è°ƒç”¨äº† <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L391-L416"><code>context.cancelCtx.cancel</code></a>ï¼Œè¿˜ä¼šåœæ­¢æŒæœ‰çš„å®šæ—¶å™¨å‡å°‘ä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚</p><h2 id="ä¼ å€¼æ–¹æ³•"><a href="#ä¼ å€¼æ–¹æ³•" class="headerlink" title="ä¼ å€¼æ–¹æ³•"></a>ä¼ å€¼æ–¹æ³•</h2><p>åœ¨æœ€åæˆ‘ä»¬éœ€è¦äº†è§£å¦‚ä½•ä½¿ç”¨ä¸Šä¸‹æ–‡ä¼ å€¼ï¼Œ<a href="https://github.com/golang/go/tree/master/src/context"><code>context</code></a> åŒ…ä¸­çš„ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L513-L521"><code>context.WithValue</code></a> å‡½æ•°èƒ½ä»çˆ¶ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ªå­ä¸Šä¸‹æ–‡ï¼Œä¼ å€¼çš„å­ä¸Šä¸‹æ–‡ä½¿ç”¨ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L525-L528"><code>context.valueCtx</code></a> ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> key == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;nil key&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !reflectlite.TypeOf(key).Comparable() &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;key is not comparable&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;valueCtx&#123;parent, key, val&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L525-L528"><code>context.valueCtx</code></a> ç»“æ„ä½“ä¼šå°†é™¤äº† <code>Value</code> ä¹‹å¤–çš„ <code>Err</code>ã€<code>Deadline</code> ç­‰æ–¹æ³•ä»£ç†åˆ°çˆ¶ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒåªä¼šå“åº” <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L549-L554"><code>context.valueCtx.Value</code></a> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> valueCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">Context</span><br><span class="line">key, val <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">if</span> c.key == key &#123;</span><br><span class="line"><span class="keyword">return</span> c.val</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> c.Context.Value(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L525-L528"><code>context.valueCtx</code></a> ä¸­å­˜å‚¨çš„é”®å€¼å¯¹ä¸ <a href="https://github.com/golang/go/blob/df2999ef43ea49ce1578137017949c0ee660608a/src/context/context.go#L549-L554"><code>context.valueCtx.Value</code></a> æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°ä¸åŒ¹é…ï¼Œå°±ä¼šä»çˆ¶ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾è¯¥é”®å¯¹åº”çš„å€¼ç›´åˆ°åœ¨æŸä¸ªçˆ¶ä¸Šä¸‹æ–‡ä¸­è¿”å› <code>nil</code> æˆ–è€…æŸ¥æ‰¾åˆ°å¯¹åº”çš„å€¼ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Go è¯­è¨€ä¸­çš„ <a href="https://github.com/golang/go/blob/71bbffbc48d03b447c73da1f54ac57350fc9b36a/src/context/context.go#L62-L154"><code>context.Context</code></a> çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯åœ¨å¤šä¸ª Goroutine ç»„æˆçš„æ ‘ä¸­åŒæ­¥å–æ¶ˆä¿¡å·ä»¥å‡å°‘å¯¹èµ„æºçš„æ¶ˆè€—å’Œå ç”¨ï¼Œè™½ç„¶å®ƒä¹Ÿæœ‰ä¼ å€¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬è¿˜æ˜¯å¾ˆå°‘ç”¨åˆ°ã€‚</p><p>åœ¨çœŸæ­£ä½¿ç”¨ä¼ å€¼çš„åŠŸèƒ½æ—¶æˆ‘ä»¬ä¹Ÿåº”è¯¥éå¸¸è°¨æ…ï¼Œä½¿ç”¨ <a href="https://github.com/golang/go/blob/71bbffbc48d03b447c73da1f54ac57350fc9b36a/src/context/context.go#L62-L154"><code>context.Context</code></a> è¿›è¡Œä¼ é€’å‚æ•°è¯·æ±‚çš„æ‰€æœ‰å‚æ•°ä¸€ç§éå¸¸å·®çš„è®¾è®¡ï¼Œæ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ä¼ é€’è¯·æ±‚å¯¹åº”ç”¨æˆ·çš„è®¤è¯ä»¤ç‰Œä»¥åŠç”¨äºè¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªçš„è¯·æ±‚ IDã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://golang.org/pkg/context/">Package context Â· Golang</a></li><li><a href="https://blog.golang.org/context">Go Concurrency Patterns: Context</a></li><li><a href="https://www.sohamkamani.com/blog/golang/2018-06-17-golang-using-context-cancellation/">Using context cancellation in Go</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„åå°„</title>
      <link href="/2020/01/18/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%8F%8D%E5%B0%84/"/>
      <url>/2020/01/18/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<p>åå°„æ˜¯ Go è¯­è¨€æ¯”è¾ƒé‡è¦çš„ç‰¹æ€§ã€‚è™½ç„¶åœ¨å¤§å¤šæ•°çš„åº”ç”¨å’ŒæœåŠ¡ä¸­å¹¶ä¸å¸¸è§ï¼Œä½†æ˜¯å¾ˆå¤šæ¡†æ¶éƒ½ä¾èµ– Go è¯­è¨€çš„åå°„æœºåˆ¶å®ç°ç®€åŒ–ä»£ç çš„é€»è¾‘ã€‚å› ä¸º Go è¯­è¨€çš„è¯­æ³•å…ƒç´ å¾ˆå°‘ã€è®¾è®¡ç®€å•ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ç‰¹åˆ«å¼ºçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä½†æ˜¯ Go è¯­è¨€çš„ <a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> åŒ…èƒ½å¤Ÿå¼¥è¡¥å®ƒåœ¨è¯­æ³•ä¸Šçš„ä¸€äº›åŠ£åŠ¿ã€‚</p><a id="more"></a><p><a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> å®ç°äº†è¿è¡Œæ—¶çš„åå°„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè®©ç¨‹åºæ“ä½œä¸åŒç±»å‹çš„å¯¹è±¡ã€‚åå°„åŒ…ä¸­æœ‰ä¸¤å¯¹éå¸¸é‡è¦çš„å‡½æ•°å’Œç±»å‹ï¼Œ<a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> èƒ½è·å–ç±»å‹ä¿¡æ¯ï¼Œ<a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> èƒ½è·å–æ•°æ®çš„è¿è¡Œæ—¶è¡¨ç¤ºï¼Œå¦å¤–ä¸¤ä¸ªç±»å‹æ˜¯ <code>Type</code> å’Œ <code>Value</code>ï¼Œå®ƒä»¬ä¸å‡½æ•°æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/ed6U9csrRv57onb.png" alt="golang-reflection"></p><p>ç±»å‹ <code>Type</code> æ˜¯åå°„åŒ…å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> å‡½æ•°è·å–ä»»æ„å˜é‡çš„çš„ç±»å‹ï¼Œ<code>Type</code> æ¥å£ä¸­å®šä¹‰äº†ä¸€äº›æœ‰è¶£çš„æ–¹æ³•ï¼Œ<code>MethodByName</code> å¯ä»¥è·å–å½“å‰ç±»å‹å¯¹åº”æ–¹æ³•çš„å¼•ç”¨ã€<code>Implements</code> å¯ä»¥åˆ¤æ–­å½“å‰ç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Type <span class="keyword">interface</span> &#123;</span><br><span class="line">        Align() <span class="keyword">int</span></span><br><span class="line">        FieldAlign() <span class="keyword">int</span></span><br><span class="line">        Method(<span class="keyword">int</span>) Method</span><br><span class="line">        MethodByName(<span class="keyword">string</span>) (Method, <span class="keyword">bool</span>)</span><br><span class="line">        NumMethod() <span class="keyword">int</span></span><br><span class="line">        ...</span><br><span class="line">        Implements(u Type) <span class="keyword">bool</span></span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå°„åŒ…ä¸­ <code>Value</code> çš„ç±»å‹ä¸ <code>Type</code> ä¸åŒï¼Œå®ƒè¢«å£°æ˜æˆäº†ç»“æ„ä½“ã€‚è¿™ä¸ªç»“æ„ä½“æ²¡æœ‰å¯¹å¤–æš´éœ²çš„å­—æ®µï¼Œä½†æ˜¯æä¾›äº†è·å–æˆ–è€…å†™å…¥æ•°æ®çš„æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Value <span class="keyword">struct</span> &#123;</span><br><span class="line">        <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Addr</span><span class="params">()</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Bool</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Bytes</span><span class="params">()</span> []<span class="title">byte</span></span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åå°„åŒ…ä¸­çš„æ‰€æœ‰æ–¹æ³•åŸºæœ¬éƒ½æ˜¯å›´ç»•ç€ <code>Type</code> å’Œ <code>Value</code> è¿™ä¸¤ä¸ªç±»å‹è®¾è®¡çš„ã€‚æˆ‘ä»¬é€šè¿‡ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a>ã€<a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> å¯ä»¥å°†ä¸€ä¸ªæ™®é€šçš„å˜é‡è½¬æ¢æˆã€åå°„ã€åŒ…ä¸­æä¾›çš„ <code>Type</code> å’Œ <code>Value</code>ï¼Œéšåå°±å¯ä»¥ä½¿ç”¨åå°„åŒ…ä¸­çš„æ–¹æ³•å¯¹å®ƒä»¬è¿›è¡Œå¤æ‚çš„æ“ä½œã€‚</p><h2 id="ä¸‰å¤§æ³•åˆ™"><a href="#ä¸‰å¤§æ³•åˆ™" class="headerlink" title="ä¸‰å¤§æ³•åˆ™"></a>ä¸‰å¤§æ³•åˆ™</h2><p>è¿è¡Œæ—¶åå°„æ˜¯ç¨‹åºåœ¨è¿è¡ŒæœŸé—´æ£€æŸ¥å…¶è‡ªèº«ç»“æ„çš„ä¸€ç§æ–¹å¼ã€‚åå°„å¸¦æ¥çš„çµæ´»æ€§æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œåå°„ä½œä¸ºä¸€ç§å…ƒç¼–ç¨‹æ–¹å¼å¯ä»¥å‡å°‘é‡å¤ä»£ç ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ol><li>ä» <code>interface&#123;&#125;</code> å˜é‡å¯ä»¥åå°„å‡ºåå°„å¯¹è±¡ï¼›</li><li>ä»åå°„å¯¹è±¡å¯ä»¥è·å– <code>interface&#123;&#125;</code> å˜é‡ï¼›</li><li>è¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œå…¶å€¼å¿…é¡»å¯è®¾ç½®ï¼›</li></ol><h3 id="ç¬¬ä¸€æ³•åˆ™"><a href="#ç¬¬ä¸€æ³•åˆ™" class="headerlink" title="ç¬¬ä¸€æ³•åˆ™"></a>ç¬¬ä¸€æ³•åˆ™</h3><p>åå°„çš„ç¬¬ä¸€æ³•åˆ™æ˜¯æˆ‘ä»¬èƒ½å°† Go è¯­è¨€çš„ <code>interface&#123;&#125;</code> å˜é‡è½¬æ¢æˆåå°„å¯¹è±¡ã€‚å¾ˆå¤šè¯»è€…å¯èƒ½ä¼šå¯¹è¿™ä»¥æ³•åˆ™äº§ç”Ÿå›°æƒ‘ â€”â€” ä¸ºä»€ä¹ˆæ˜¯ä» <code>interface&#123;&#125;</code> å˜é‡åˆ°åå°„å¯¹è±¡ï¼Ÿå½“æˆ‘ä»¬æ‰§è¡Œ <code>reflect.ValueOf(1)</code> æ—¶ï¼Œè™½ç„¶çœ‹èµ·æ¥æ˜¯è·å–äº†åŸºæœ¬ç±»å‹ <code>int</code> å¯¹åº”çš„åå°„ç±»å‹ï¼Œä½†æ˜¯ç”±äº <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a>ã€<a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> ä¸¤ä¸ªæ–¹æ³•çš„å…¥å‚éƒ½æ˜¯ <code>interface&#123;&#125;</code> ç±»å‹ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ç±»å‹è½¬æ¢ã€‚</p><p>åœ¨<a href="http://draveness.me/golang-function-call">å‡½æ•°è°ƒç”¨</a>ä¸€èŠ‚ä¸­æ›¾ç»ä»‹ç»è¿‡ï¼ŒGo è¯­è¨€çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯å€¼ä¼ é€’çš„ï¼Œå˜é‡ä¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶è¿›è¡Œç±»å‹è½¬æ¢ã€‚åŸºæœ¬ç±»å‹ <code>int</code> ä¼šè½¬æ¢æˆ <code>interface&#123;&#125;</code> ç±»å‹ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç¬¬ä¸€æ¡æ³•åˆ™æ˜¯ã€ä»æ¥å£åˆ°åå°„å¯¹è±¡ã€ã€‚</p><p>ä¸Šé¢æåˆ°çš„ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> å’Œ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> å‡½æ•°å°±èƒ½å®Œæˆè¿™é‡Œçš„è½¬æ¢ï¼Œå¦‚æœæˆ‘ä»¬è®¤ä¸º Go è¯­è¨€çš„ç±»å‹å’Œåå°„ç±»å‹å¤„äºä¸¤ä¸ªä¸åŒçš„ã€ä¸–ç•Œã€ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°å°±æ˜¯è¿æ¥è¿™ä¸¤ä¸ªä¸–ç•Œçš„æ¡¥æ¢ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/4itVukPmpZM73dg.png" alt="golang-interface-to-reflection"></p><p><strong>æ¥å£åˆ°åå°„å¯¹è±¡</strong></p><p>æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ä¾‹å­ç®€å•ä»‹ç»è¿™ä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨ï¼Œ<a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> è·å–äº†å˜é‡ <code>author</code> çš„ç±»å‹ï¼Œ<a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> è·å–äº†å˜é‡çš„å€¼ <code>draven</code>ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“äº†ä¸€ä¸ªå˜é‡çš„ç±»å‹å’Œå€¼ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€çŸ¥é“äº†è¿™ä¸ªå˜é‡çš„å…¨éƒ¨ä¿¡æ¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">author := <span class="string">&quot;draven&quot;</span></span><br><span class="line">fmt.Println(<span class="string">&quot;TypeOf author:&quot;</span>, reflect.TypeOf(author))</span><br><span class="line">fmt.Println(<span class="string">&quot;ValueOf author:&quot;</span>, reflect.ValueOf(author))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">TypeOf author: <span class="keyword">string</span></span><br><span class="line">ValueOf author: draven</span><br></pre></td></tr></table></figure><p>æœ‰äº†å˜é‡çš„ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Method</code> æ–¹æ³•è·å¾—ç±»å‹å®ç°çš„æ–¹æ³•ï¼Œé€šè¿‡ <code>Field</code> è·å–ç±»å‹åŒ…å«çš„å…¨éƒ¨å­—æ®µã€‚å¯¹äºä¸åŒçš„ç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•è·å–ç›¸å…³ä¿¡æ¯ï¼š</p><ul><li>ç»“æ„ä½“ï¼šè·å–å­—æ®µçš„æ•°é‡å¹¶é€šè¿‡ä¸‹æ ‡å’Œå­—æ®µåè·å–å­—æ®µ <code>StructField</code>ï¼›</li><li>å“ˆå¸Œè¡¨ï¼šè·å–å“ˆå¸Œè¡¨çš„ <code>Key</code> ç±»å‹ï¼›</li><li>å‡½æ•°æˆ–æ–¹æ³•ï¼šè·å–å…¥å‚å’Œè¿”å›å€¼çš„ç±»å‹ï¼›</li><li>â€¦</li></ul><p>æ€»è€Œè¨€ä¹‹ï¼Œä½¿ç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> å’Œ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> èƒ½å¤Ÿè·å– Go è¯­è¨€ä¸­çš„å˜é‡å¯¹åº”çš„åå°„å¯¹è±¡ã€‚ä¸€æ—¦è·å–äº†åå°„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°è·Ÿå½“å‰ç±»å‹ç›¸å…³æ•°æ®å’Œæ“ä½œï¼Œå¹¶å¯ä»¥ä½¿ç”¨è¿™äº›è¿è¡Œæ—¶è·å–çš„ç»“æ„æ‰§è¡Œæ–¹æ³•ã€‚</p><h3 id="ç¬¬äºŒæ³•åˆ™"><a href="#ç¬¬äºŒæ³•åˆ™" class="headerlink" title="ç¬¬äºŒæ³•åˆ™"></a>ç¬¬äºŒæ³•åˆ™</h3><p>åå°„çš„ç¬¬äºŒæ³•åˆ™æ˜¯æˆ‘ä»¬å¯ä»¥ä»åå°„å¯¹è±¡å¯ä»¥è·å– <code>interface&#123;&#125;</code> å˜é‡ã€‚æ—¢ç„¶èƒ½å¤Ÿå°†æ¥å£ç±»å‹çš„å˜é‡è½¬æ¢æˆåå°„å¯¹è±¡ï¼Œé‚£ä¹ˆä¸€å®šéœ€è¦å…¶ä»–æ–¹æ³•å°†åå°„å¯¹è±¡è¿˜åŸæˆæ¥å£ç±»å‹çš„å˜é‡ï¼Œ<a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> ä¸­çš„ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L992-L994"><code>reflect.Value.Interface</code></a> æ–¹æ³•å°±èƒ½å®Œæˆè¿™é¡¹å·¥ä½œï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/bvghG2u3EILPRrx.png" alt="golang-reflection-to-interface"></p><p><strong>åå°„å¯¹è±¡åˆ°æ¥å£</strong></p><p>ä¸è¿‡è°ƒç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L992-L994"><code>reflect.Value.Interface</code></a> æ–¹æ³•åªèƒ½è·å¾— <code>interface&#123;&#125;</code> ç±»å‹çš„å˜é‡ï¼Œå¦‚æœæƒ³è¦å°†å…¶è¿˜åŸæˆæœ€åŸå§‹çš„çŠ¶æ€è¿˜éœ€è¦ç»è¿‡å¦‚ä¸‹æ‰€ç¤ºçš„æ˜¾å¼ç±»å‹è½¬æ¢ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v := reflect.ValueOf(<span class="number">1</span>)</span><br><span class="line">v.Interface().(<span class="keyword">int</span>)</span><br></pre></td></tr></table></figure><p>ä»åå°„å¯¹è±¡åˆ°æ¥å£å€¼çš„è¿‡ç¨‹å°±æ˜¯ä»æ¥å£å€¼åˆ°åå°„å¯¹è±¡çš„é•œé¢è¿‡ç¨‹ï¼Œä¸¤ä¸ªè¿‡ç¨‹éƒ½éœ€è¦ç»å†ä¸¤æ¬¡è½¬æ¢ï¼š</p><ul><li>ä»æ¥å£å€¼åˆ°åå°„å¯¹è±¡ï¼š<ul><li>ä»åŸºæœ¬ç±»å‹åˆ°æ¥å£ç±»å‹çš„ç±»å‹è½¬æ¢ï¼›</li><li>ä»æ¥å£ç±»å‹åˆ°åå°„å¯¹è±¡çš„è½¬æ¢ï¼›</li></ul></li><li>ä»åå°„å¯¹è±¡åˆ°æ¥å£å€¼ï¼š<ul><li>åå°„å¯¹è±¡è½¬æ¢æˆæ¥å£ç±»å‹ï¼›</li><li>é€šè¿‡æ˜¾å¼ç±»å‹è½¬æ¢å˜æˆåŸå§‹ç±»å‹ï¼›</li></ul></li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/WUurJpdtQ9fTa7Z.png" alt="golang-bidirectional-reflection"><strong>æ¥å£å’Œåå°„å¯¹è±¡çš„åŒå‘è½¬æ¢</strong></p><p>å½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„å˜é‡éƒ½éœ€è¦ç±»å‹è½¬æ¢è¿™ä¸€è¿‡ç¨‹ã€‚å¦‚æœå˜é‡æœ¬èº«å°±æ˜¯ <code>interface&#123;&#125;</code> ç±»å‹ï¼Œé‚£ä¹ˆå®ƒä¸éœ€è¦ç±»å‹è½¬æ¢ï¼Œå› ä¸ºç±»å‹è½¬æ¢è¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬éƒ½æ˜¯éšå¼çš„ï¼Œæ‰€ä»¥æˆ‘ä¸å¤ªéœ€è¦å…³å¿ƒå®ƒï¼Œåªæœ‰åœ¨æˆ‘ä»¬éœ€è¦å°†åå°„å¯¹è±¡è½¬æ¢å›åŸºæœ¬ç±»å‹æ—¶æ‰éœ€è¦æ˜¾å¼çš„è½¬æ¢æ“ä½œã€‚</p><h3 id="ç¬¬ä¸‰æ³•åˆ™"><a href="#ç¬¬ä¸‰æ³•åˆ™" class="headerlink" title="ç¬¬ä¸‰æ³•åˆ™"></a>ç¬¬ä¸‰æ³•åˆ™</h3><p>Go è¯­è¨€åå°„çš„æœ€åä¸€æ¡æ³•åˆ™æ˜¯ä¸å€¼æ˜¯å¦å¯ä»¥è¢«æ›´æ”¹æœ‰å…³ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ–°ä¸€ä¸ª <code>reflect.Value</code>ï¼Œé‚£ä¹ˆå®ƒæŒæœ‰çš„å€¼ä¸€å®šæ˜¯å¯ä»¥è¢«æ›´æ–°çš„ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">1</span></span><br><span class="line">v := reflect.ValueOf(i)</span><br><span class="line">v.SetInt(<span class="number">10</span>)</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run reflect.<span class="keyword">go</span></span><br><span class="line"><span class="built_in">panic</span>: reflect: reflect.flag.mustBeAssignable using unaddressable value</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">reflect.flag.mustBeAssignableSlow(<span class="number">0x82</span>, <span class="number">0x1014c0</span>)</span><br><span class="line">/usr/local/<span class="keyword">go</span>/src/reflect/value.<span class="keyword">go</span>:<span class="number">247</span> +<span class="number">0x180</span></span><br><span class="line">reflect.flag.mustBeAssignable(...)</span><br><span class="line">/usr/local/<span class="keyword">go</span>/src/reflect/value.<span class="keyword">go</span>:<span class="number">234</span></span><br><span class="line">reflect.Value.SetInt(<span class="number">0x100dc0</span>, <span class="number">0x414020</span>, <span class="number">0x82</span>, <span class="number">0x1840</span>, <span class="number">0xa</span>, <span class="number">0x0</span>)</span><br><span class="line">/usr/local/<span class="keyword">go</span>/src/reflect/value.<span class="keyword">go</span>:<span class="number">1606</span> +<span class="number">0x40</span></span><br><span class="line">main.main()</span><br><span class="line">/tmp/sandbox590309925/prog.<span class="keyword">go</span>:<span class="number">11</span> +<span class="number">0xe0</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ä¼šå¯¼è‡´ç¨‹åºå´©æºƒå¹¶æŠ¥å‡º <code>reflect: reflect.flag.mustBeAssignable using unaddressable value</code> é”™è¯¯ï¼Œä»”ç»†æ€è€ƒä¸€ä¸‹å°±èƒ½å¤Ÿå‘ç°å‡ºé”™çš„åŸå› ï¼ŒGo è¯­è¨€çš„<a href="http://draveness.me/golang-function-call">å‡½æ•°è°ƒç”¨</a>éƒ½æ˜¯ä¼ å€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„åå°„å¯¹è±¡è·Ÿæœ€å¼€å§‹çš„å˜é‡æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ‰€ä»¥ç›´æ¥å¯¹å®ƒä¿®æ”¹ä¼šå¯¼è‡´å´©æºƒã€‚</p><p>æƒ³è¦ä¿®æ”¹åŸæœ‰çš„å˜é‡åªèƒ½é€šè¿‡å¦‚ä¸‹çš„æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">1</span></span><br><span class="line">v := reflect.ValueOf(&amp;i)</span><br><span class="line">v.Elem().SetInt(<span class="number">10</span>)</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run reflect.<span class="keyword">go</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><ol><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> å‡½æ•°è·å–å˜é‡æŒ‡é’ˆï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L788-L821"><code>reflect.Value.Elem</code></a> æ–¹æ³•è·å–æŒ‡é’ˆæŒ‡å‘çš„å˜é‡ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L1600-L1616"><code>reflect.Value.SetInt</code></a> æ–¹æ³•æ›´æ–°å˜é‡çš„å€¼ï¼š</li></ol><p>ç”±äº Go è¯­è¨€çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å…ˆè·å–æŒ‡é’ˆå¯¹åº”çš„ <code>reflect.Value</code>ï¼Œå†é€šè¿‡ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L788-L821"><code>reflect.Value.Elem</code></a> æ–¹æ³•è¿‚å›çš„æ–¹å¼å¾—åˆ°å¯ä»¥è¢«è®¾ç½®çš„å˜é‡ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">1</span></span><br><span class="line">v := &amp;i</span><br><span class="line">*v = <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸èƒ½ç›´æ¥æ“ä½œ <code>i</code> å˜é‡ä¿®æ”¹å…¶æŒæœ‰çš„å€¼ï¼Œæˆ‘ä»¬å°±åªèƒ½è·å– <code>i</code> å˜é‡æ‰€åœ¨åœ°å€å¹¶ä½¿ç”¨ <code>*v</code> ä¿®æ”¹æ‰€åœ¨åœ°å€ä¸­å­˜å‚¨çš„æ•´æ•°ã€‚</p><h2 id="ç±»å‹å’Œå€¼"><a href="#ç±»å‹å’Œå€¼" class="headerlink" title="ç±»å‹å’Œå€¼"></a>ç±»å‹å’Œå€¼</h2><p>Go è¯­è¨€çš„ <code>interface&#123;&#125;</code> ç±»å‹åœ¨è¯­è¨€å†…éƒ¨æ˜¯é€šè¿‡ <code>emptyInterface</code> è¿™ä¸ªç»“ä½“æ¥è¡¨ç¤ºçš„ï¼Œå…¶ä¸­çš„ <code>rtype</code> å­—æ®µç”¨äºè¡¨ç¤ºå˜é‡çš„ç±»å‹ï¼Œå¦ä¸€ä¸ª <code>word</code> å­—æ®µæŒ‡å‘å†…éƒ¨å°è£…çš„æ•°æ®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyInterface <span class="keyword">struct</span> &#123;</span><br><span class="line">typ  *rtype</span><br><span class="line">word unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äºè·å–å˜é‡ç±»å‹çš„ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> å‡½æ•°å°†ä¼ å…¥çš„å˜é‡éšå¼è½¬æ¢æˆ <code>emptyInterface</code> ç±»å‹å¹¶è·å–å…¶ä¸­å­˜å‚¨çš„ç±»å‹ä¿¡æ¯ <code>rtype</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TypeOf</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Type</span></span> &#123;</span><br><span class="line">eface := *(*emptyInterface)(unsafe.Pointer(&amp;i))</span><br><span class="line"><span class="keyword">return</span> toType(eface.typ)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">toType</span><span class="params">(t *rtype)</span> <span class="title">Type</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>rtype</code> å°±æ˜¯ä¸€ä¸ªå®ç°äº† <code>Type</code> æ¥å£çš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬èƒ½åœ¨ <a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> åŒ…ä¸­æ‰¾åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L752-L758"><code>reflect.rtype.String</code></a> æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è·å–å½“å‰ç±»å‹çš„åç§°ç­‰ä¿¡æ¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rtype)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">s := t.nameOff(t.str).name()</span><br><span class="line"><span class="keyword">if</span> t.tflag&amp;tflagExtraStar != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> s[<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> å‡½æ•°çš„å®ç°åŸç†å…¶å®å¹¶ä¸å¤æ‚ï¼Œå®ƒåªæ˜¯å°†ä¸€ä¸ª <code>interface&#123;&#125;</code> å˜é‡è½¬æ¢æˆäº†å†…éƒ¨çš„ <code>emptyInterface</code> è¡¨ç¤ºï¼Œç„¶åä»ä¸­è·å–ç›¸åº”çš„ç±»å‹ä¿¡æ¯ã€‚</p><p>ç”¨äºè·å–æ¥å£å€¼ <code>Value</code> çš„å‡½æ•° <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œåœ¨è¯¥å‡½æ•°ä¸­æˆ‘ä»¬å…ˆè°ƒç”¨äº† <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L2779-L2783"><code>reflect.escapes</code></a> å‡½æ•°ä¿è¯å½“å‰å€¼é€ƒé€¸åˆ°å †ä¸Šï¼Œç„¶åé€šè¿‡ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L140-L152"><code>reflect.unpackEface</code></a> æ–¹æ³•ä»æ¥å£ä¸­è·å– <code>Value</code> ç»“æ„ä½“ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValueOf</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Value</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> i == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> Value&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">escapes(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> unpackEface(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unpackEface</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Value</span></span> &#123;</span><br><span class="line">e := (*emptyInterface)(unsafe.Pointer(&amp;i))</span><br><span class="line">t := e.typ</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> Value&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">f := flag(t.Kind())</span><br><span class="line"><span class="keyword">if</span> ifaceIndir(t) &#123;</span><br><span class="line">f |= flagIndir</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Value&#123;t, e.word, f&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L140-L152"><code>reflect.unpackEface</code></a> å‡½æ•°ä¼šå°†ä¼ å…¥çš„æ¥å£è½¬æ¢æˆ <code>emptyInterface</code> ç»“æ„ä½“ï¼Œç„¶åå°†å…·ä½“ç±»å‹å’ŒæŒ‡é’ˆåŒ…è£…æˆ <code>Value</code> ç»“æ„ä½“å¹¶è¿”å›ã€‚</p><p><a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/type.go#L1365-L1368"><code>reflect.TypeOf</code></a> å’Œ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> å‡½æ•°çš„å®ç°éƒ½å¾ˆç®€å•ã€‚æˆ‘ä»¬å·²ç»åˆ†æäº†è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°ï¼Œç°åœ¨éœ€è¦äº†è§£ç¼–è¯‘å™¨åœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰åšäº†å“ªäº›å·¥ä½œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">20</span></span><br><span class="line">_ = reflect.TypeOf(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> build -gcflags=<span class="string">&quot;-S -N&quot;</span> main.<span class="keyword">go</span></span><br><span class="line">...</span><br><span class="line">MOVQ$<span class="number">20</span>, <span class="string">&quot;&quot;</span>..autotmp_20+<span class="number">56</span>(SP) <span class="comment">// autotmp = 20</span></span><br><span class="line">LEAQ<span class="keyword">type</span>.<span class="keyword">int</span>(SB), AX           <span class="comment">// AX = type.int(SB)</span></span><br><span class="line">MOVQAX, <span class="string">&quot;&quot;</span>..autotmp_19+<span class="number">280</span>(SP) <span class="comment">// autotmp_19+280(SP) = type.int(SB)</span></span><br><span class="line">LEAQ<span class="string">&quot;&quot;</span>..autotmp_20+<span class="number">56</span>(SP), CX  <span class="comment">// CX = 20</span></span><br><span class="line">MOVQCX, <span class="string">&quot;&quot;</span>..autotmp_19+<span class="number">288</span>(SP) <span class="comment">// autotmp_19+288(SP) = 20</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢è¿™æ®µæˆªå–çš„æ±‡ç¼–è¯­è¨€ï¼Œæˆ‘ä»¬å‘ç°åœ¨å‡½æ•°è°ƒç”¨ä¹‹å‰å·²ç»å‘ç”Ÿäº†ç±»å‹è½¬æ¢ï¼Œä¸Šè¿°æŒ‡ä»¤å°† <code>int</code> ç±»å‹çš„å˜é‡è½¬æ¢æˆäº†å ç”¨ 16 å­—èŠ‚ <code>autotmp_19+280(SP) ~ autotmp_19+288(SP)</code> çš„æ¥å£ï¼Œä¸¤ä¸ª <code>LEAQ</code> æŒ‡ä»¤åˆ†åˆ«è·å–äº†ç±»å‹çš„æŒ‡é’ˆ <code>type.int(SB)</code> ä»¥åŠå˜é‡ <code>i</code> æ‰€åœ¨çš„åœ°å€ã€‚</p><p>å½“æˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ªå˜é‡è½¬æ¢æˆåå°„å¯¹è±¡æ—¶ï¼ŒGo è¯­è¨€ä¼šåœ¨ç¼–è¯‘æœŸé—´å®Œæˆç±»å‹è½¬æ¢çš„å·¥ä½œï¼Œå°†å˜é‡çš„ç±»å‹å’Œå€¼è½¬æ¢æˆäº† <code>interface&#123;&#125;</code> å¹¶ç­‰å¾…è¿è¡ŒæœŸé—´ä½¿ç”¨ <a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> åŒ…è·å–æ¥å£ä¸­å­˜å‚¨çš„ä¿¡æ¯ã€‚</p><h2 id="æ›´æ–°å˜é‡"><a href="#æ›´æ–°å˜é‡" class="headerlink" title="æ›´æ–°å˜é‡"></a>æ›´æ–°å˜é‡</h2><p>å½“æˆ‘ä»¬æƒ³è¦æ›´æ–°ä¸€ä¸ª <code>reflect.Value</code>ï¼Œå°±éœ€è¦è°ƒç”¨ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L1525-L1538"><code>reflect.Value.Set</code></a> æ–¹æ³•æ›´æ–°åå°„å¯¹è±¡ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L232-L236"><code>reflect.flag.mustBeAssignable</code></a> å’Œ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L214-L218"><code>reflect.flag.mustBeExported</code></a> åˆ†åˆ«æ£€æŸ¥å½“å‰åå°„å¯¹è±¡æ˜¯å¦æ˜¯å¯ä»¥è¢«è®¾ç½®çš„ä»¥åŠå­—æ®µæ˜¯å¦æ˜¯å¯¹å¤–å…¬å¼€çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Set</span><span class="params">(x Value)</span></span> &#123;</span><br><span class="line">v.mustBeAssignable()</span><br><span class="line">x.mustBeExported()</span><br><span class="line"><span class="keyword">var</span> target unsafe.Pointer</span><br><span class="line"><span class="keyword">if</span> v.kind() == Interface &#123;</span><br><span class="line">target = v.ptr</span><br><span class="line">&#125;</span><br><span class="line">x = x.assignTo(<span class="string">&quot;reflect.Set&quot;</span>, v.typ, target)</span><br><span class="line">typedmemmove(v.typ, v.ptr, x.ptr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L1525-L1538"><code>reflect.Value.Set</code></a> æ–¹æ³•ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L2370-L2404"><code>reflect.Value.assignTo</code></a> å¹¶è¿”å›ä¸€ä¸ªæ–°çš„åå°„å¯¹è±¡ï¼Œè¿™ä¸ªè¿”å›çš„åå°„å¯¹è±¡æŒ‡é’ˆå°±ä¼šç›´æ¥è¦†ç›–åŸå§‹çš„åå°„å˜é‡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">assignTo</span><span class="params">(context <span class="keyword">string</span>, dst *rtype, target unsafe.Pointer)</span> <span class="title">Value</span></span> &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> directlyAssignable(dst, v.typ):</span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> Value&#123;dst, v.ptr, fl&#125;</span><br><span class="line"><span class="keyword">case</span> implements(dst, v.typ):</span><br><span class="line"><span class="keyword">if</span> v.Kind() == Interface &amp;&amp; v.IsNil() &#123;</span><br><span class="line"><span class="keyword">return</span> Value&#123;dst, <span class="literal">nil</span>, flag(Interface)&#125;</span><br><span class="line">&#125;</span><br><span class="line">x := valueInterface(v, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">if</span> dst.NumMethod() == <span class="number">0</span> &#123;</span><br><span class="line">*(*<span class="keyword">interface</span>&#123;&#125;)(target) = x</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ifaceE2I(dst, x, target)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Value&#123;dst, target, flagIndir | flag(Interface)&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">panic</span>(context + <span class="string">&quot;: value of type &quot;</span> + v.typ.String() + <span class="string">&quot; is not assignable to type &quot;</span> + dst.String())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L2370-L2404"><code>reflect.Value.assignTo</code></a> ä¼šæ ¹æ®å½“å‰å’Œè¢«è®¾ç½®çš„åå°„å¯¹è±¡ç±»å‹åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Value</code> ç»“æ„ä½“ï¼š</p><ul><li>å¦‚æœä¸¤ä¸ªåå°„å¯¹è±¡çš„ç±»å‹æ˜¯å¯ä»¥è¢«ç›´æ¥æ›¿æ¢ï¼Œå°±ä¼šç›´æ¥å°†ç›®æ ‡åå°„å¯¹è±¡è¿”å›ï¼›</li><li>å¦‚æœå½“å‰åå°„å¯¹è±¡æ˜¯æ¥å£å¹¶ä¸”ç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œå°±ä¼šå°†ç›®æ ‡å¯¹è±¡ç®€å•åŒ…è£…æˆæ¥å£å€¼ï¼›</li></ul><p>åœ¨å˜é‡æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œ<a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L2370-L2404"><code>reflect.Value.assignTo</code></a> è¿”å›çš„ <code>reflect.Value</code> ä¸­çš„æŒ‡é’ˆä¼šè¦†ç›–å½“å‰åå°„å¯¹è±¡ä¸­çš„æŒ‡é’ˆå®ç°å˜é‡çš„æ›´æ–°ã€‚</p><h2 id="å®ç°åè®®"><a href="#å®ç°åè®®" class="headerlink" title="å®ç°åè®®"></a>å®ç°åè®®</h2><p><a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> åŒ…è¿˜ä¸ºæˆ‘ä»¬æä¾›äº† <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L1430-L1438"><code>reflect.rtypes.Implements</code></a> æ–¹æ³•å¯ä»¥ç”¨äºåˆ¤æ–­æŸäº›ç±»å‹æ˜¯å¦éµå¾ªç‰¹å®šçš„æ¥å£ã€‚åœ¨ Go è¯­è¨€ä¸­è·å–ç»“æ„ä½“çš„åå°„ç±»å‹ <code>reflect.Type</code> è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œä½†æ˜¯æƒ³è¦è·å¾—æ¥å£çš„ç±»å‹å°±éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reflect.TypeOf((*&lt;<span class="keyword">interface</span>&gt;)(<span class="literal">nil</span>)).Elem()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­åœ¨ä»‹ç»å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦åˆ¤æ–­å¦‚ä¸‹ä»£ç ä¸­çš„ <code>CustomError</code> æ˜¯å¦å®ç°äº† Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ <code>error</code> æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CustomError <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*CustomError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">typeOfError := reflect.TypeOf((*error)(<span class="literal">nil</span>)).Elem()</span><br><span class="line">customErrorPtr := reflect.TypeOf(&amp;CustomError&#123;&#125;)</span><br><span class="line">customError := reflect.TypeOf(CustomError&#123;&#125;)</span><br><span class="line"></span><br><span class="line">fmt.Println(customErrorPtr.Implements(typeOfError)) <span class="comment">// #=&gt; true</span></span><br><span class="line">fmt.Println(customError.Implements(typeOfError)) <span class="comment">// #=&gt; false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœæ­£å¦‚æˆ‘ä»¬åœ¨<a href="https://draveness.me/golang/docs/part2-foundation/ch04-basic/golang-interface/">æ¥å£</a>ä¸€èŠ‚ä¸­ä»‹ç»çš„ï¼š</p><ul><li><code>CustomError</code> ç±»å‹å¹¶æ²¡æœ‰å®ç° <code>error</code> æ¥å£ï¼›</li><li><code>*CustomError</code> æŒ‡é’ˆç±»å‹å®ç°äº† <code>error</code> æ¥å£ï¼›</li></ul><p>æŠ›å¼€ä¸Šè¿°çš„æ‰§è¡Œç»“æœä¸è°ˆï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L1430-L1438"><code>reflect.rtypes.Implements</code></a> æ–¹æ³•çš„å·¥ä½œåŸç†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rtype)</span> <span class="title">Implements</span><span class="params">(u Type)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> u == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;reflect: nil type passed to Type.Implements&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> u.Kind() != Interface &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;reflect: non-interface type passed to Type.Implements&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> implements(u.(*rtype), t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L1430-L1438"><code>reflect.rtypes.Implements</code></a> æ–¹æ³•ä¼šæ£€æŸ¥ä¼ å…¥çš„ç±»å‹æ˜¯ä¸æ˜¯æ¥å£ï¼Œå¦‚æœä¸æ˜¯æ¥å£æˆ–è€…æ˜¯ç©ºå€¼å°±ä¼šç›´æ¥ panic ä¸­æ­¢å½“å‰ç¨‹åºã€‚åœ¨å‚æ•°æ²¡æœ‰é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°æ–¹æ³•ä¼šè°ƒç”¨ç§æœ‰å‡½æ•° <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L1461-L1543"><code>reflect.implements</code></a> åˆ¤æ–­ç±»å‹ä¹‹é—´æ˜¯å¦æœ‰å®ç°å…³ç³»ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">implements</span><span class="params">(T, V *rtype)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">t := (*interfaceType)(unsafe.Pointer(T))</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(t.methods) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">v := V.uncommon()</span><br><span class="line">i := <span class="number">0</span></span><br><span class="line">vmethods := v.methods()</span><br><span class="line"><span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="keyword">int</span>(v.mcount); j++ &#123;</span><br><span class="line">tm := &amp;t.methods[i]</span><br><span class="line">tmName := t.nameOff(tm.name)</span><br><span class="line">vm := vmethods[j]</span><br><span class="line">vmName := V.nameOff(vm.name)</span><br><span class="line"><span class="keyword">if</span> vmName.name() == tmName.name() &amp;&amp; V.typeOff(vm.mtyp) == t.typeOff(tm.typ) &#123;</span><br><span class="line"><span class="keyword">if</span> i++; i &gt;= <span class="built_in">len</span>(t.methods) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ¥å£ä¸­ä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œå°±æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªç©ºçš„æ¥å£ï¼Œä»»æ„ç±»å‹éƒ½è‡ªåŠ¨å®ç°è¯¥æ¥å£ï¼Œè¿™æ—¶å°±ä¼šç›´æ¥è¿”å› <code>true</code>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/kUQRuvsaTMynx5q.png" alt="golang-type-implements-interface"></p><p><strong>ç±»å‹å®ç°æ¥å£</strong></p><p>åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œç”±äºæ–¹æ³•éƒ½æ˜¯æŒ‰ç…§å­—æ¯åºå­˜å‚¨çš„ï¼Œ<a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L1461-L1543"><code>reflect.implements</code></a> ä¼šç»´æŠ¤ä¸¤ä¸ªç”¨äºéå†æ¥å£å’Œç±»å‹æ–¹æ³•çš„ç´¢å¼• <code>i</code> å’Œ <code>j</code> åˆ¤æ–­ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£ï¼Œå› ä¸ºæœ€å¤šåªä¼šè¿›è¡Œ <code>n</code> æ¬¡æ¯”è¾ƒï¼ˆç±»å‹çš„æ–¹æ³•æ•°é‡ï¼‰ï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n)</code>ã€‚</p><h2 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h2><p>ä½œä¸ºä¸€é—¨é™æ€è¯­è¨€ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é€šè¿‡ <a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> åŒ…åˆ©ç”¨åå°„åœ¨è¿è¡ŒæœŸé—´æ‰§è¡Œæ–¹æ³•ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œä¸‹é¢çš„åå‡ è¡Œä»£ç å°±ä½¿ç”¨åå°„æ¥æ‰§è¡Œ <code>Add(0, 1)</code> å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> a + b &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := reflect.ValueOf(Add)</span><br><span class="line"><span class="keyword">if</span> v.Kind() != reflect.Func &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">t := v.Type()</span><br><span class="line">argv := <span class="built_in">make</span>([]reflect.Value, t.NumIn())</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> argv &#123;</span><br><span class="line"><span class="keyword">if</span> t.In(i).Kind() != reflect.Int &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">argv[i] = reflect.ValueOf(i)</span><br><span class="line">&#125;</span><br><span class="line">result := v.Call(argv)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(result) != <span class="number">1</span> || result[<span class="number">0</span>].Kind() != reflect.Int &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(result[<span class="number">0</span>].Int()) <span class="comment">// #=&gt; 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é€šè¿‡ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> è·å–å‡½æ•° <code>Add</code> å¯¹åº”çš„åå°„å¯¹è±¡ï¼›</li><li>æ ¹æ®åå°„å¯¹è±¡ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L979-L985"><code>reflect.rtype.NumIn</code></a> æ–¹æ³•è¿”å›çš„å‚æ•°ä¸ªæ•°åˆ›å»º <code>argv</code> æ•°ç»„ï¼›</li><li>å¤šæ¬¡è°ƒç”¨ <a href="https://github.com/golang/go/blob/52c4488471ed52085a29e173226b3cbd2bf22b20/src/reflect/value.go#L2316-L2328"><code>reflect.ValueOf</code></a> å‡½æ•°é€ä¸€è®¾ç½® <code>argv</code> æ•°ç»„ä¸­çš„å„ä¸ªå‚æ•°ï¼›</li><li>è°ƒç”¨åå°„å¯¹è±¡ <code>Add</code> çš„ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L318-L322"><code>reflect.Value.Call</code></a> æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°åˆ—è¡¨ï¼›</li><li>è·å–è¿”å›å€¼æ•°ç»„ã€éªŒè¯æ•°ç»„çš„é•¿åº¦ä»¥åŠç±»å‹å¹¶æ‰“å°å…¶ä¸­çš„æ•°æ®ï¼›</li></ol><p>ä½¿ç”¨åå°„æ¥è°ƒç”¨æ–¹æ³•éå¸¸å¤æ‚ï¼ŒåŸæœ¬åªéœ€è¦ä¸€è¡Œä»£ç å°±èƒ½å®Œæˆçš„å·¥ä½œï¼Œç°åœ¨éœ€è¦åå‡ è¡Œä»£ç æ‰èƒ½å®Œæˆï¼Œä½†è¿™ä¹Ÿæ˜¯åœ¨é™æ€è¯­è¨€ä¸­ä½¿ç”¨åŠ¨æ€ç‰¹æ€§éœ€è¦ä»˜å‡ºçš„æˆæœ¬ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Call</span><span class="params">(in []Value)</span> []<span class="title">Value</span></span> &#123;</span><br><span class="line">v.mustBe(Func)</span><br><span class="line">v.mustBeExported()</span><br><span class="line"><span class="keyword">return</span> v.call(<span class="string">&quot;Call&quot;</span>, in)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L318-L322"><code>reflect.Value.Call</code></a> æ–¹æ³•æ˜¯è¿è¡Œæ—¶è°ƒç”¨æ–¹æ³•çš„å…¥å£ï¼Œå®ƒé€šè¿‡ä¸¤ä¸ª <code>MustBe</code> å¼€å¤´çš„æ–¹æ³•ç¡®å®šäº†å½“å‰åå°„å¯¹è±¡çš„ç±»å‹æ˜¯å‡½æ•°ä»¥åŠå¯è§æ€§ï¼Œéšåè°ƒç”¨ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L339-L501"><code>reflect.Value.call</code></a> å®Œæˆæ–¹æ³•è°ƒç”¨ï¼Œè¿™ä¸ªç§æœ‰æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¼šåˆ†æˆä»¥ä¸‹çš„å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æ£€æŸ¥è¾“å…¥å‚æ•°ä»¥åŠç±»å‹çš„åˆæ³•æ€§ï¼›</li><li>å°†ä¼ å…¥çš„ <code>reflect.Value</code> å‚æ•°æ•°ç»„è®¾ç½®åˆ°æ ˆä¸Šï¼›</li><li>é€šè¿‡å‡½æ•°æŒ‡é’ˆå’Œè¾“å…¥å‚æ•°è°ƒç”¨å‡½æ•°ï¼›</li><li>ä»æ ˆä¸Šè·å–å‡½æ•°çš„è¿”å›å€¼ï¼›</li></ol><p>æˆ‘ä»¬å°†æŒ‰ç…§ä¸Šé¢çš„é¡ºåºåˆ†æä½¿ç”¨ <a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> è¿›è¡Œå‡½æ•°è°ƒç”¨çš„å‡ ä¸ªè¿‡ç¨‹ã€‚</p><h3 id="å‚æ•°æ£€æŸ¥"><a href="#å‚æ•°æ£€æŸ¥" class="headerlink" title="å‚æ•°æ£€æŸ¥"></a>å‚æ•°æ£€æŸ¥</h3><p>å‚æ•°æ£€æŸ¥æ˜¯é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•çš„ç¬¬ä¸€æ­¥ï¼Œåœ¨å‚æ•°æ£€æŸ¥æœŸé—´æˆ‘ä»¬ä¼šä»åå°„å¯¹è±¡ä¸­å–å‡ºå½“å‰çš„å‡½æ•°æŒ‡é’ˆ <code>unsafe.Pointer</code>ï¼Œå¦‚æœè¯¥å‡½æ•°æŒ‡é’ˆæ˜¯æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/value.go#L612-L645"><code>reflect.methodReceiver</code></a> å‡½æ•°è·å–æ–¹æ³•çš„æ¥å—è€…å’Œå‡½æ•°æŒ‡é’ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">call</span><span class="params">(op <span class="keyword">string</span>, in []Value)</span> []<span class="title">Value</span></span> &#123;</span><br><span class="line">t := (*funcType)(unsafe.Pointer(v.typ))</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> v.flag&amp;flagMethod != <span class="number">0</span> &#123;</span><br><span class="line">rcvr = v</span><br><span class="line">rcvrtype, t, fn = methodReceiver(op, v, <span class="keyword">int</span>(v.flag)&gt;&gt;flagMethodShift)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">n := t.NumIn()</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(in) &lt; n &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;reflect: Call with too few input arguments&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(in) &gt; n &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;reflect: Call with too many input arguments&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> xt, targ := in[i].Type(), t.In(i); !xt.AssignableTo(targ) &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;reflect: &quot;</span> + op + <span class="string">&quot; using &quot;</span> + xt.String() + <span class="string">&quot; as type &quot;</span> + targ.String())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°æ–¹æ³•ä¸­ï¼Œä¸Šè¿°æ–¹æ³•è¿˜ä¼šæ£€æŸ¥ä¼ å…¥å‚æ•°çš„ä¸ªæ•°ä»¥åŠå‚æ•°çš„ç±»å‹ä¸å‡½æ•°ç­¾åä¸­çš„ç±»å‹æ˜¯å¦å¯ä»¥åŒ¹é…ï¼Œä»»ä½•å‚æ•°çš„ä¸åŒ¹é…éƒ½ä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºçš„å´©æºƒä¸­æ­¢ã€‚</p><h3 id="å‡†å¤‡å‚æ•°"><a href="#å‡†å¤‡å‚æ•°" class="headerlink" title="å‡†å¤‡å‚æ•°"></a>å‡†å¤‡å‚æ•°</h3><p>å½“æˆ‘ä»¬å·²ç»å¯¹å½“å‰æ–¹æ³•çš„å‚æ•°å®ŒæˆéªŒè¯ä¹‹åï¼Œå°±ä¼šè¿›å…¥å‡½æ•°è°ƒç”¨çš„ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œä¸ºå‡½æ•°è°ƒç”¨å‡†å¤‡å‚æ•°ï¼Œåœ¨å‰é¢çš„ç« èŠ‚<a href="https://draveness.me/golang/basic/golang-function-call.html">å‡½æ•°è°ƒç”¨</a>ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ Go è¯­è¨€çš„å‡½æ•°è°ƒç”¨æƒ¯ä¾‹ï¼Œå‡½æ•°æˆ–è€…æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½ä¼šè¢«ä¾æ¬¡æ”¾ç½®åˆ°æ ˆä¸Šã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">nout := t.NumOut()</span><br><span class="line">frametype, _, retOffset, _, framePool := funcLayout(t, rcvrtype)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> args unsafe.Pointer</span><br><span class="line"><span class="keyword">if</span> nout == <span class="number">0</span> &#123;</span><br><span class="line">args = framePool.Get().(unsafe.Pointer)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">args = unsafe_New(frametype)</span><br><span class="line">&#125;</span><br><span class="line">off := <span class="keyword">uintptr</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> rcvrtype != <span class="literal">nil</span> &#123;</span><br><span class="line">storeRcvr(rcvr, args)</span><br><span class="line">off = ptrSize</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> in &#123;</span><br><span class="line">targ := t.In(i).(*rtype)</span><br><span class="line">a := <span class="keyword">uintptr</span>(targ.align)</span><br><span class="line">off = (off + a - <span class="number">1</span>) &amp;^ (a - <span class="number">1</span>)</span><br><span class="line">n := targ.size</span><br><span class="line">...</span><br><span class="line">addr := add(args, off, <span class="string">&quot;n &gt; 0&quot;</span>)</span><br><span class="line">v = v.assignTo(<span class="string">&quot;reflect.Value.Call&quot;</span>, targ, addr)</span><br><span class="line">*(*unsafe.Pointer)(addr) = v.ptr</span><br><span class="line">off += n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>é€šè¿‡ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L2975-L3048"><code>reflect.funcLayout</code></a> å‡½æ•°è®¡ç®—å½“å‰å‡½æ•°éœ€è¦çš„å‚æ•°å’Œè¿”å›å€¼çš„æ ˆå¸ƒå±€ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªå‚æ•°å’Œè¿”å›å€¼æ‰€å çš„ç©ºé—´å¤§å°ï¼›</p></li><li><p>å¦‚æœå½“å‰å‡½æ•°æœ‰è¿”å›å€¼ï¼Œéœ€è¦ä¸ºå½“å‰å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼åˆ†é…ä¸€ç‰‡å†…å­˜ç©ºé—´ <code>args</code>ï¼›</p></li><li><p>å¦‚æœå½“å‰å‡½æ•°æ˜¯æ–¹æ³•ï¼Œéœ€è¦å‘å°†æ–¹æ³•çš„æ¥å—è€…æ‹·è´åˆ° <code>args</code> å†…å­˜ä¸­ï¼›</p></li><li><p>å°†æ‰€æœ‰å‡½æ•°çš„å‚æ•°æŒ‰ç…§é¡ºåºä¾æ¬¡æ‹·è´åˆ°å¯¹åº”</p></li></ol>   <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">args</span></span><br></pre></td></tr></table></figure><p>   å†…å­˜ä¸­</p><ol><li>ä½¿ç”¨ <a href="https://github.com/golang/go/blob/4e8d27068df52eb372dc2ba7e929e47850934805/src/reflect/type.go#L2975-L3048"><code>reflect.funcLayout</code></a> è¿”å›çš„å‚æ•°è®¡ç®—å‚æ•°åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼›</li><li>å°†å‚æ•°æ‹·è´åˆ°å†…å­˜ç©ºé—´ä¸­ï¼›</li></ol><p>å‡†å¤‡å‚æ•°çš„è¿‡ç¨‹æ˜¯è®¡ç®—å„ä¸ªå‚æ•°å’Œè¿”å›å€¼å ç”¨çš„å†…å­˜ç©ºé—´å¹¶å°†æ‰€æœ‰çš„å‚æ•°éƒ½æ‹·è´å†…å­˜ç©ºé—´å¯¹åº”çš„ä½ç½®çš„è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹ä¼šè€ƒè™‘å‡½æ•°å’Œæ–¹æ³•ã€è¿”å›å€¼æ•°é‡ä»¥åŠå‚æ•°ç±»å‹å¸¦æ¥çš„å·®å¼‚ã€‚</p><h3 id="è°ƒç”¨å‡½æ•°"><a href="#è°ƒç”¨å‡½æ•°" class="headerlink" title="è°ƒç”¨å‡½æ•°"></a>è°ƒç”¨å‡½æ•°</h3><p>å‡†å¤‡å¥½è°ƒç”¨å‡½æ•°éœ€è¦çš„å…¨éƒ¨å‚æ•°ä¹‹åï¼Œå°±ä¼šé€šè¿‡ä»¥ä¸‹çš„ä»£ç æ‰§è¡Œå‡½æ•°æŒ‡é’ˆäº†ã€‚æˆ‘ä»¬ä¼šå‘è¯¥å‡½æ•°ä¼ å…¥æ ˆç±»å‹ã€å‡½æ•°æŒ‡é’ˆã€å‚æ•°å’Œè¿”å›å€¼çš„å†…å­˜ç©ºé—´ã€æ ˆçš„å¤§å°ä»¥åŠè¿”å›å€¼çš„åç§»é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call(frametype, fn, args, <span class="keyword">uint32</span>(frametype.size), <span class="keyword">uint32</span>(retOffset))</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æœŸé—´è¢«é“¾æ¥åˆ° <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L489-L526"><code>runtime.reflectcall</code></a> è¿™ä¸ªç”¨æ±‡ç¼–å®ç°çš„å‡½æ•°ä¸Šï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸ä¼šåˆ†æè¯¥å‡½æ•°çš„å…·ä½“å®ç°ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œäº†è§£å…¶å®ç°åŸç†ã€‚</p><h3 id="å¤„ç†è¿”å›å€¼"><a href="#å¤„ç†è¿”å›å€¼" class="headerlink" title="å¤„ç†è¿”å›å€¼"></a>å¤„ç†è¿”å›å€¼</h3><p>å½“å‡½æ•°è°ƒç”¨ç»“æŸä¹‹åï¼Œå°±ä¼šå¼€å§‹å¤„ç†å‡½æ•°çš„è¿”å›å€¼ï¼š</p><ul><li>å¦‚æœå‡½æ•°æ²¡æœ‰ä»»ä½•è¿”å›å€¼ï¼Œä¼šç›´æ¥æ¸…ç©º <code>args</code> ä¸­çš„å…¨éƒ¨å†…å®¹æ¥é‡Šæ”¾å†…å­˜ç©ºé—´ï¼›</li><li>å¦‚æœå½“å‰å‡½æ•°æœ‰è¿”å›å€¼ï¼›<ol><li>å°† <code>args</code> ä¸­ä¸è¾“å…¥å‚æ•°æœ‰å…³çš„å†…å­˜ç©ºé—´æ¸…ç©ºï¼›</li><li>åˆ›å»ºä¸€ä¸ª <code>nout</code> é•¿åº¦çš„åˆ‡ç‰‡ç”¨äºä¿å­˜ç”±åå°„å¯¹è±¡æ„æˆçš„è¿”å›å€¼æ•°ç»„ï¼›</li><li>ä»å‡½æ•°å¯¹è±¡ä¸­è·å–è¿”å›å€¼çš„ç±»å‹å’Œå†…å­˜å¤§å°ï¼Œå°† <code>args</code> å†…å­˜ä¸­çš„æ•°æ®è½¬æ¢æˆ <code>reflect.Value</code> ç±»å‹å¹¶å­˜å‚¨åˆ°åˆ‡ç‰‡ä¸­ï¼›</li></ol></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ret []Value</span><br><span class="line"><span class="keyword">if</span> nout == <span class="number">0</span> &#123;</span><br><span class="line">typedmemclr(frametype, args)</span><br><span class="line">framePool.Put(args)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">typedmemclrpartial(frametype, args, <span class="number">0</span>, retOffset)</span><br><span class="line">ret = <span class="built_in">make</span>([]Value, nout)</span><br><span class="line">off = retOffset</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; nout; i++ &#123;</span><br><span class="line">tv := t.Out(i)</span><br><span class="line">a := <span class="keyword">uintptr</span>(tv.Align())</span><br><span class="line">off = (off + a - <span class="number">1</span>) &amp;^ (a - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> tv.Size() != <span class="number">0</span> &#123;</span><br><span class="line">fl := flagIndir | flag(tv.Kind())</span><br><span class="line">ret[i] = Value&#123;tv.common(), add(args, off, <span class="string">&quot;tv.Size() != 0&quot;</span>), fl&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret[i] = Zero(tv)</span><br><span class="line">&#125;</span><br><span class="line">off += tv.Size()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”± <code>reflect.Value</code> æ„æˆçš„ <code>ret</code> æ•°ç»„ä¼šè¢«è¿”å›åˆ°ä¸Šå±‚ï¼Œåˆ°è¿™é‡Œä¸ºæ­¢ä½¿ç”¨åå°„å®ç°å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹å°±ç»“æŸäº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Go è¯­è¨€çš„ <a href="https://golang.org/pkg/reflect/"><code>reflect</code></a> åŒ…ä¸ºæˆ‘ä»¬æä¾›çš„å¤šç§èƒ½åŠ›ï¼ŒåŒ…æ‹¬å¦‚ä½•ä½¿ç”¨åå°„æ¥åŠ¨æ€ä¿®æ”¹å˜é‡ã€åˆ¤æ–­ç±»å‹æ˜¯å¦å®ç°äº†æŸäº›æ¥å£ä»¥åŠåŠ¨æ€è°ƒç”¨æ–¹æ³•ç­‰åŠŸèƒ½ï¼Œé€šè¿‡å¯¹åå°„åŒ…ä¸­æ–¹æ³•åŸç†çš„åˆ†æèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ä¹‹å‰çœ‹èµ·æ¥æ¯”è¾ƒæ€ªå¼‚ã€ä»¤äººå›°æƒ‘çš„ç°è±¡ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://blog.golang.org/laws-of-reflection">The Laws of Reflection</a></li><li><a href="https://github.com/golang/go/commit/3d1699ea787f38be6088f9a098d6e08dafca9387">runtime: new itab lookup table</a></li><li><p><a href="https://github.com/golang/go/issues/20505">runtime: need a better itab table</a></p></li><li><p><a href="https://golang.org/pkg/reflect/">Package reflect</a></p></li><li><p><a href="https://blog.golang.org/laws-of-reflection">The Laws of Reflection</a> </p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„select</title>
      <link href="/2020/01/17/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84select/"/>
      <url>/2020/01/17/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84select/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¤š C è¯­è¨€æˆ–è€… Unix å¼€å‘è€…å¬åˆ° <code>select</code> æƒ³åˆ°çš„éƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œè°ˆåˆ° I/O æ¨¡å‹æ—¶æœ€ç»ˆå¤§éƒ½ä¼šæåˆ°åŸºäº <code>select</code>ã€<code>poll</code> å’Œ <code>epoll</code> ç­‰å‡½æ•°æ„å»ºçš„ IO å¤šè·¯å¤ç”¨æ¨¡å‹ã€‚Go è¯­è¨€çš„ <code>select</code> ä¸ C è¯­è¨€ä¸­çš„ <code>select</code> æœ‰ç€æ¯”è¾ƒç›¸ä¼¼çš„åŠŸèƒ½ã€‚æœ¬èŠ‚ä¼šä»‹ç» Go è¯­è¨€ <code>select</code> å¸¸è§çš„ç°è±¡ã€æ•°æ®ç»“æ„ä»¥åŠå››ç§ä¸åŒæƒ…å†µä¸‹çš„å®ç°åŸç†ã€‚</p><a id="more"></a><p>C è¯­è¨€ä¸­çš„ <code>select</code> å…³é”®å­—å¯ä»¥åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å¯è¯»æˆ–è€…å¯å†™çš„çŠ¶æ€ï¼ŒGo è¯­è¨€ä¸­çš„ <code>select</code> å…³é”®å­—ä¹Ÿèƒ½å¤Ÿè®© Goroutine åŒæ—¶ç­‰å¾…å¤šä¸ª Channel çš„å¯è¯»æˆ–è€…å¯å†™ï¼Œåœ¨å¤šä¸ªæ–‡ä»¶æˆ–è€… Channel å‘ç”ŸçŠ¶æ€æ”¹å˜ä¹‹å‰ï¼Œ<code>select</code> ä¼šä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹æˆ–è€… Goroutineã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-01-19-15794018429532-Golang-Select-Channels.png" alt="Golang-Select-Channels"></p><p><strong>å›¾ 5-5 Select å’Œ Channels</strong></p><p><code>select</code> æ˜¯ä¸€ç§ä¸ <code>switch</code> ç›¸ä¼¼çš„æ§åˆ¶ç»“æ„ï¼Œä¸ <code>switch</code> ä¸åŒçš„æ˜¯ï¼Œ<code>select</code> ä¸­è™½ç„¶ä¹Ÿæœ‰å¤šä¸ª <code>case</code>ï¼Œä½†æ˜¯è¿™äº› <code>case</code> ä¸­çš„è¡¨è¾¾å¼å¿…é¡»éƒ½æ˜¯ <a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-channel/">Channel</a> çš„æ”¶å‘æ“ä½œã€‚ä¸‹é¢çš„ä»£ç å°±å±•ç¤ºäº†ä¸€ä¸ªåŒ…å« Channel æ”¶å‘æ“ä½œçš„ <code>select</code> ç»“æ„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(c, quit <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">x, y := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> c &lt;- x:</span><br><span class="line">x, y = y, x+y</span><br><span class="line"><span class="keyword">case</span> &lt;-quit:</span><br><span class="line">fmt.Println(<span class="string">&quot;quit&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ§åˆ¶ç»“æ„ä¼šç­‰å¾… <code>c &lt;- x</code> æˆ–è€… <code>&lt;-quit</code> ä¸¤ä¸ªè¡¨è¾¾å¼ä¸­ä»»æ„ä¸€ä¸ªçš„è¿”å›ã€‚æ— è®ºå“ªä¸€ä¸ªè¡¨è¾¾å¼è¿”å›éƒ½ä¼šç«‹åˆ»æ‰§è¡Œ <code>case</code> ä¸­çš„ä»£ç ï¼Œå½“ <code>select</code> ä¸­çš„ä¸¤ä¸ª <code>case</code> åŒæ—¶è¢«è§¦å‘æ—¶ï¼Œå°±ä¼šéšæœºé€‰æ‹©ä¸€ä¸ª <code>case</code> æ‰§è¡Œã€‚</p><h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><p>å½“æˆ‘ä»¬åœ¨ Go è¯­è¨€ä¸­ä½¿ç”¨ <code>select</code> æ§åˆ¶ç»“æ„æ—¶ï¼Œä¼šé‡åˆ°ä¸¤ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š</p><ol><li><code>select</code> èƒ½åœ¨ Channel ä¸Šè¿›è¡Œéé˜»å¡çš„æ”¶å‘æ“ä½œï¼›</li><li><code>select</code> åœ¨é‡åˆ°å¤šä¸ª Channel åŒæ—¶å“åº”æ—¶ä¼šéšæœºæŒ‘é€‰ <code>case</code> æ‰§è¡Œï¼›</li></ol><p>è¿™ä¸¤ä¸ªç°è±¡æ˜¯å­¦ä¹  <code>select</code> æ—¶ç»å¸¸ä¼šé‡åˆ°çš„ï¼Œæˆ‘ä»¬æ¥æ·±å…¥äº†è§£å…·ä½“çš„åœºæ™¯å¹¶åˆ†æè¿™ä¸¤ä¸ªç°è±¡èƒŒåçš„è®¾è®¡åŸç†ã€‚</p><h3 id="éé˜»å¡çš„æ”¶å‘"><a href="#éé˜»å¡çš„æ”¶å‘" class="headerlink" title="éé˜»å¡çš„æ”¶å‘"></a>éé˜»å¡çš„æ”¶å‘</h3><p>åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>select</code> è¯­å¥ä¼šé˜»å¡å½“å‰ Goroutine å¹¶ç­‰å¾…å¤šä¸ª Channel ä¸­çš„ä¸€ä¸ªè¾¾åˆ°å¯ä»¥æ”¶å‘çš„çŠ¶æ€ã€‚ä½†æ˜¯å¦‚æœ <code>select</code> æ§åˆ¶ç»“æ„ä¸­åŒ…å« <code>default</code> è¯­å¥ï¼Œé‚£ä¹ˆè¿™ä¸ª <code>select</code> è¯­å¥åœ¨æ‰§è¡Œæ—¶ä¼šé‡åˆ°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å½“å­˜åœ¨å¯ä»¥æ”¶å‘çš„ Channel æ—¶ï¼Œç›´æ¥å¤„ç†è¯¥ Channel å¯¹åº”çš„ <code>case</code>ï¼›</li><li>å½“ä¸å­˜åœ¨å¯ä»¥æ”¶å‘çš„ Channel æ˜¯ï¼Œæ‰§è¡Œ <code>default</code> ä¸­çš„è¯­å¥ï¼›</li></ol><p>å½“æˆ‘ä»¬è¿è¡Œä¸‹é¢çš„ä»£ç æ—¶å°±ä¸ä¼šé˜»å¡å½“å‰çš„ Goroutineï¼Œå®ƒä¼šç›´æ¥æ‰§è¡Œ <code>default</code> ä¸­çš„ä»£ç å¹¶è¿”å›ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> i := &lt;-ch:</span><br><span class="line"><span class="built_in">println</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">println</span>(<span class="string">&quot;default&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line"><span class="keyword">default</span></span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬ç¨å¾®æƒ³ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç° Go è¯­è¨€è®¾è®¡çš„è¿™ä¸ªç°è±¡å°±éå¸¸åˆç†ã€‚<code>select</code> çš„ä½œç”¨å°±æ˜¯åŒæ—¶ç›‘å¬å¤šä¸ª <code>case</code> æ˜¯å¦å¯ä»¥æ‰§è¡Œï¼Œå¦‚æœå¤šä¸ª Channel éƒ½ä¸èƒ½æ‰§è¡Œï¼Œé‚£ä¹ˆè¿è¡Œ <code>default</code> ä¸­çš„ä»£ç ä¹Ÿæ˜¯ç†æ‰€å½“ç„¶çš„ã€‚</p><p>éé˜»å¡çš„ Channel å‘é€å’Œæ¥æ”¶æ“ä½œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬ä¸å¸Œæœ›å‘ Channel å‘é€æ¶ˆæ¯æˆ–è€…ä» Channel ä¸­æ¥æ”¶æ¶ˆæ¯ä¼šé˜»å¡å½“å‰ Goroutineï¼Œæˆ‘ä»¬åªæ˜¯æƒ³çœ‹çœ‹ Channel çš„å¯è¯»æˆ–è€…å¯å†™çŠ¶æ€ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">errCh := <span class="built_in">make</span>(<span class="keyword">chan</span> error, <span class="built_in">len</span>(tasks))</span><br><span class="line">wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">wg.Add(<span class="built_in">len</span>(tasks))</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> tasks &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        <span class="keyword">if</span> err := tasks[i].Run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            errCh &lt;- err</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> err := &lt;-errCh:</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒåˆ°åº•å¤šå°‘ä¸ªä»»åŠ¡æ‰§è¡Œå¤±è´¥äº†ï¼Œåªå…³å¿ƒæ˜¯å¦å­˜åœ¨è¿”å›é”™è¯¯çš„ä»»åŠ¡ï¼Œæœ€åçš„ <code>select</code> è¯­å¥å°±èƒ½å¾ˆå¥½åœ°å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ç„¶è€Œä½¿ç”¨ <code>select</code> çš„è¯­æ³•ä¸æ˜¯æœ€åŸå§‹çš„è®¾è®¡ï¼Œå®ƒåœ¨æœ€åˆç‰ˆæœ¬ä½¿ç”¨ <code>x, ok := &lt;-c</code> çš„è¯­æ³•å®ç°éé˜»å¡çš„æ”¶å‘ï¼Œä»¥ä¸‹æ˜¯ä¸éé˜»å¡æ”¶å‘çš„ç›¸å…³æäº¤ï¼š</p><ol><li><a href="https://github.com/golang/go/commit/79fbbe37a76502e6f5f9647d2d82bab953ab1546#diff-fb0a5ae9dd70f0a43038d55c0204fdff">select default</a> æäº¤æ”¯æŒäº† <code>select</code> è¯­å¥ä¸­çš„ <code>default</code> æƒ…å†µï¼›</li><li><a href="https://github.com/golang/go/commit/5038792837355abde32f2e9549ef132fc5ffbd16">gc: special case code for single-op blocking and non-blocking selects</a> æäº¤å¼•å…¥äº†åŸºäº <code>select</code> çš„éé˜»å¡æ”¶å‘çš„ç‰¹æ€§ã€‚</li><li><a href="https://github.com/golang/go/commit/cb584707af2d8803adba88fd9692e665ecd2f059">gc: remove non-blocking send, receive syntax</a> æäº¤å°† <code>x, ok := &lt;-c</code> è¯­æ³•åˆ é™¤ï¼›</li><li><a href="https://github.com/golang/go/commit/8bf34e335686816f7fe7e28614b2c7a3e04e9e7c">gc, runtime: replace closed(c) with x, ok := &lt;-c</a> æäº¤ä½¿ç”¨ <code>x, ok := &lt;-c</code> è¯­æ³•æ›¿ä»£ <code>closed(c)</code> è¯­æ³•åˆ¤æ–­ Channel çš„å…³é—­çŠ¶æ€ï¼›</li></ol><p>æˆ‘ä»¬å¯ä»¥ä»ä¸Šé¢çš„å‡ ä¸ªæäº¤ä¸­çœ‹åˆ°éé˜»å¡æ”¶å‘ä»æœ€åˆåˆ°ç°åœ¨çš„æ¼”å˜ã€‚</p><h3 id="éšæœºæ‰§è¡Œ"><a href="#éšæœºæ‰§è¡Œ" class="headerlink" title="éšæœºæ‰§è¡Œ"></a>éšæœºæ‰§è¡Œ</h3><p>å¦ä¸€ä¸ªä½¿ç”¨ <code>select</code> é‡åˆ°çš„æƒ…å†µæ˜¯åŒæ—¶æœ‰å¤šä¸ª <code>case</code> å°±ç»ªæ—¶ï¼Œ<code>select</code> ä¼šé€‰æ‹©é‚£ä¸ª <code>case</code> æ‰§è¡Œçš„é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç å¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> time.Tick(<span class="number">1</span> * time.Second) &#123;</span><br><span class="line">ch &lt;- <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ch:</span><br><span class="line"><span class="built_in">println</span>(<span class="string">&quot;case1&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> &lt;-ch:</span><br><span class="line"><span class="built_in">println</span>(<span class="string">&quot;case2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">case1</span><br><span class="line">case2</span><br><span class="line">case1</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç è¾“å‡ºçš„ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>select</code> åœ¨é‡åˆ°å¤šä¸ª <code>&lt;-ch</code> åŒæ—¶æ»¡è¶³å¯è¯»æˆ–è€…å¯å†™æ¡ä»¶æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ä¸ª <code>case</code> æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚</p><p>è¿™ä¸ªè®¾è®¡æ˜¯åœ¨åå¤šå¹´å‰è¢« <a href="https://github.com/golang/go/commit/cb9b1038db77198c2b0961634cf161258af2374d">select</a> æäº¤å¼•å…¥å¹¶ä¸€ç›´ä¿ç•™åˆ°ç°åœ¨çš„ï¼Œè™½ç„¶ä¸­é—´ç»å†è¿‡ä¸€äº›ä¿®æ”¹<a href="https://draveness.me/golang/docs/part2-foundation/ch05-keyword/golang-select/#fn:6">6</a>ï¼Œä½†æ˜¯è¯­ä¹‰ä¸€ç›´éƒ½æ²¡æœ‰æ”¹å˜ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¸¤ä¸ª <code>case</code> éƒ½æ˜¯åŒæ—¶æ»¡è¶³æ‰§è¡Œæ¡ä»¶çš„ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ç…§é¡ºåºä¾æ¬¡åˆ¤æ–­ï¼Œé‚£ä¹ˆåé¢çš„æ¡ä»¶æ°¸è¿œéƒ½ä¼šå¾—ä¸åˆ°æ‰§è¡Œï¼Œè€Œéšæœºçš„å¼•å…¥å°±æ˜¯ä¸ºäº†é¿å…é¥¥é¥¿é—®é¢˜çš„å‘ç”Ÿã€‚</p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p><code>select</code> åœ¨ Go è¯­è¨€çš„æºä»£ç ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ç»“æ„ä½“ï¼Œä½†æ˜¯ <code>select</code> æ§åˆ¶ç»“æ„ä¸­çš„ <code>case</code> å´ä½¿ç”¨ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L28-L34"><code>runtime.scase</code></a> ç»“æ„ä½“æ¥è¡¨ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> scase <span class="keyword">struct</span> &#123;</span><br><span class="line">c           *hchan</span><br><span class="line">elem        unsafe.Pointer</span><br><span class="line">kind        <span class="keyword">uint16</span></span><br><span class="line">pc          <span class="keyword">uintptr</span></span><br><span class="line">releasetime <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºéé»˜è®¤çš„ <code>case</code> ä¸­éƒ½ä¸ Channel çš„å‘é€å’Œæ¥æ”¶æœ‰å…³ï¼Œæ‰€ä»¥ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L28-L34"><code>runtime.scase</code></a> ç»“æ„ä½“ä¸­ä¹ŸåŒ…å«ä¸€ä¸ª <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L32-L51"><code>runtime.hchan</code></a> ç±»å‹çš„å­—æ®µå­˜å‚¨ <code>case</code> ä¸­ä½¿ç”¨çš„ Channelï¼›é™¤æ­¤ä¹‹å¤–ï¼Œ<code>elem</code> æ˜¯æ¥æ”¶æˆ–è€…å‘é€æ•°æ®çš„å˜é‡åœ°å€ã€<code>kind</code> è¡¨ç¤º <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L28-L34"><code>runtime.scase</code></a> çš„ç§ç±»ï¼Œæ€»å…±åŒ…å«ä»¥ä¸‹å››ç§ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">caseNil = <span class="literal">iota</span></span><br><span class="line">caseRecv</span><br><span class="line">caseSend</span><br><span class="line">caseDefault</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™å››ç§å¸¸é‡åˆ†åˆ«è¡¨ç¤ºä¸åŒç±»å‹çš„ <code>case</code>ï¼Œç›¸ä¿¡å®ƒä»¬çš„å‘½åå·²ç»èƒ½å¤Ÿå……åˆ†å¸®åŠ©æˆ‘ä»¬ç†è§£å®ƒä»¬çš„ä½œç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸ä¸€ä¸€ä»‹ç»äº†ã€‚</p><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><p><code>select</code> è¯­å¥åœ¨ç¼–è¯‘æœŸé—´ä¼šè¢«è½¬æ¢æˆ <code>OSELECT</code> èŠ‚ç‚¹ã€‚æ¯ä¸€ä¸ª <code>OSELECT</code> èŠ‚ç‚¹éƒ½ä¼šæŒæœ‰ä¸€ç»„ <code>OCASE</code> èŠ‚ç‚¹ï¼Œå¦‚æœ <code>OCASE</code> çš„æ‰§è¡Œæ¡ä»¶æ˜¯ç©ºï¼Œé‚£å°±æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ª <code>default</code> èŠ‚ç‚¹:</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-01-18-15793463657473-golang-oselect-and-ocases.png" alt="golang-oselect-and-ocases"></p><p><strong>å›¾ 5-7 OSELECT å’Œå¤šä¸ª OCASE</strong></p><p>ä¸Šå›¾å±•ç¤ºçš„å°±æ˜¯ <code>select</code> è¯­å¥åœ¨ç¼–è¯‘æœŸé—´çš„ç»“æ„ï¼Œæ¯ä¸€ä¸ª <code>OCASE</code> æ—¢åŒ…å«æ‰§è¡Œæ¡ä»¶ä¹ŸåŒ…å«æ»¡è¶³æ¡ä»¶åæ‰§è¡Œçš„ä»£ç ã€‚</p><p>ç¼–è¯‘å™¨åœ¨ä¸­é—´ä»£ç ç”ŸæˆæœŸé—´ä¼šæ ¹æ® <code>select</code> ä¸­ <code>case</code> çš„ä¸åŒå¯¹æ§åˆ¶è¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œè¿™ä¸€è¿‡ç¨‹éƒ½å‘ç”Ÿåœ¨ <a href="https://github.com/golang/go/blob/c729116332ffb66a21dd587e3ee003cb8d0b16fe/src/cmd/compile/internal/gc/select.go#L108-L370"><code>cmd/compile/internal/gc.walkselectcases</code></a> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¼šåˆ†å››ç§æƒ…å†µä»‹ç»å¤„ç†çš„è¿‡ç¨‹å’Œç»“æœï¼š</p><ol><li><code>select</code> ä¸å­˜åœ¨ä»»ä½•çš„ <code>case</code>ï¼›</li><li><code>select</code> åªå­˜åœ¨ä¸€ä¸ª <code>case</code>ï¼›</li><li><code>select</code> å­˜åœ¨ä¸¤ä¸ª <code>case</code>ï¼Œå…¶ä¸­ä¸€ä¸ª <code>case</code> æ˜¯ <code>default</code>ï¼›</li><li><code>select</code> å­˜åœ¨å¤šä¸ª <code>case</code>ï¼›</li></ol><p>ä¸Šè¿°çš„å››ç§æƒ…å†µä¸ä»…ä¼šæ¶‰åŠç¼–è¯‘å™¨çš„é‡å†™å’Œä¼˜åŒ–ï¼Œè¿˜ä¼šæ¶‰åŠ Go è¯­è¨€çš„è¿è¡Œæ—¶æœºåˆ¶ï¼Œæˆ‘ä»¬ä¼šä»ç¼–è¯‘æœŸé—´å’Œè¿è¡Œæ—¶ä¸¤æ–¹é¢åˆ†æä¸Šè¿°æƒ…å†µã€‚</p><h3 id="ç›´æ¥é˜»å¡"><a href="#ç›´æ¥é˜»å¡" class="headerlink" title="ç›´æ¥é˜»å¡"></a>ç›´æ¥é˜»å¡</h3><p>é¦–å…ˆä»‹ç»çš„æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å½“ <code>select</code> ç»“æ„ä¸­ä¸åŒ…å«ä»»ä½• <code>case</code> æ—¶ç¼–è¯‘å™¨æ˜¯å¦‚ä½•è¿›è¡Œå¤„ç†çš„ï¼Œæˆ‘ä»¬æˆªå– <a href="https://github.com/golang/go/blob/c729116332ffb66a21dd587e3ee003cb8d0b16fe/src/cmd/compile/internal/gc/select.go#L108-L370"><code>cmd/compile/internal/gc.walkselectcases</code></a> å‡½æ•°çš„å‰å‡ è¡Œä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walkselectcases</span><span class="params">(cases *Nodes)</span> []*<span class="title">Node</span></span> &#123;</span><br><span class="line">n := cases.Len()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> []*Node&#123;mkcall(<span class="string">&quot;block&quot;</span>, <span class="literal">nil</span>, <span class="literal">nil</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç éå¸¸ç®€å•å¹¶ä¸”å®¹æ˜“ç†è§£ï¼Œå®ƒç›´æ¥å°†ç±»ä¼¼ <code>select &#123;&#125;</code> çš„ç©ºè¯­å¥è½¬æ¢æˆè°ƒç”¨ <a href="https://github.com/golang/go/blob/c112289ee4141ebc31db50328c355b01278b987b/src/runtime/select.go#L104-L106"><code>runtime.block</code></a> å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">block</span><span class="params">()</span></span> &#123;</span><br><span class="line">gopark(<span class="literal">nil</span>, <span class="literal">nil</span>, waitReasonSelectNoCases, traceEvGoStop, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/c112289ee4141ebc31db50328c355b01278b987b/src/runtime/select.go#L104-L106"><code>runtime.block</code></a> å‡½æ•°çš„å®ç°éå¸¸ç®€å•ï¼Œå®ƒä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/c112289ee4141ebc31db50328c355b01278b987b/src/runtime/proc.go#L287-L305"><code>runtime.gopark</code></a> è®©å‡ºå½“å‰ Goroutine å¯¹å¤„ç†å™¨çš„ä½¿ç”¨æƒï¼Œä¼ å…¥çš„ç­‰å¾…åŸå› æ˜¯ <code>waitReasonSelectNoCases</code>ã€‚</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œç©ºçš„ <code>select</code> è¯­å¥ä¼šç›´æ¥é˜»å¡å½“å‰çš„ Goroutineï¼Œå¯¼è‡´ Goroutine è¿›å…¥æ— æ³•è¢«å”¤é†’çš„æ°¸ä¹…ä¼‘çœ çŠ¶æ€ã€‚</p><h3 id="å•ä¸€ç®¡é“"><a href="#å•ä¸€ç®¡é“" class="headerlink" title="å•ä¸€ç®¡é“"></a>å•ä¸€ç®¡é“</h3><p>å¦‚æœå½“å‰çš„ <code>select</code> æ¡ä»¶åªåŒ…å«ä¸€ä¸ª <code>case</code>ï¼Œé‚£ä¹ˆå°±ä¼šå°† <code>select</code> æ”¹å†™æˆ <code>if</code> æ¡ä»¶è¯­å¥ã€‚ä¸‹é¢å±•ç¤ºäº†åŸå§‹çš„ <code>select</code> è¯­å¥å’Œè¢«æ”¹å†™ã€ä¼˜åŒ–åçš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¹å†™å‰</span></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v, ok &lt;-ch: <span class="comment">// case ch &lt;- v</span></span><br><span class="line">    ...    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¹å†™å</span></span><br><span class="line"><span class="keyword">if</span> ch == <span class="literal">nil</span> &#123;</span><br><span class="line">    block()</span><br><span class="line">&#125;</span><br><span class="line">v, ok := &lt;-ch <span class="comment">// case ch &lt;- v</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/c729116332ffb66a21dd587e3ee003cb8d0b16fe/src/cmd/compile/internal/gc/select.go#L108-L370"><code>cmd/compile/internal/gc.walkselectcases</code></a> åœ¨å¤„ç†å•æ“ä½œ <code>select</code> è¯­å¥æ—¶ï¼Œä¼šæ ¹æ® Channel çš„æ”¶å‘æƒ…å†µç”Ÿæˆä¸åŒçš„è¯­å¥ã€‚å½“ <code>case</code> ä¸­çš„ Channel æ˜¯ç©ºæŒ‡é’ˆæ—¶ï¼Œå°±ä¼šç›´æ¥æŒ‚èµ·å½“å‰ Goroutine å¹¶æ°¸ä¹…ä¼‘çœ ã€‚</p><h3 id="éé˜»å¡æ“ä½œ"><a href="#éé˜»å¡æ“ä½œ" class="headerlink" title="éé˜»å¡æ“ä½œ"></a>éé˜»å¡æ“ä½œ</h3><p>å½“ <code>select</code> ä¸­ä»…åŒ…å«ä¸¤ä¸ª <code>case</code>ï¼Œå¹¶ä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ <code>default</code> æ—¶ï¼ŒGo è¯­è¨€çš„ç¼–è¯‘å™¨å°±ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€æ¬¡éé˜»å¡çš„æ”¶å‘æ“ä½œã€‚<a href="https://github.com/golang/go/blob/c729116332ffb66a21dd587e3ee003cb8d0b16fe/src/cmd/compile/internal/gc/select.go#L108-L370"><code>cmd/compile/internal/gc.walkselectcases</code></a> å‡½æ•°ä¼šå¯¹è¿™ç§æƒ…å†µå•ç‹¬å¤„ç†ï¼Œä¸è¿‡åœ¨æ­£å¼ä¼˜åŒ–ä¹‹å‰ï¼Œè¯¥å‡½æ•°ä¼šå°† <code>case</code> ä¸­çš„æ‰€æœ‰ Channel éƒ½è½¬æ¢æˆæŒ‡å‘ Channel çš„åœ°å€ã€‚æˆ‘ä»¬ä¼šåˆ†åˆ«ä»‹ç»éé˜»å¡å‘é€å’Œéé˜»å¡æ¥æ”¶æ—¶ï¼Œç¼–è¯‘å™¨è¿›è¡Œçš„ä¸åŒä¼˜åŒ–ã€‚</p><h4 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h4><p>é¦–å…ˆæ˜¯ Channel çš„å‘é€è¿‡ç¨‹ï¼Œå½“ <code>case</code> ä¸­è¡¨è¾¾å¼çš„ç±»å‹æ˜¯ <code>OSEND</code> æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ <code>if/else</code> è¯­å¥å’Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L662-L664"><code>runtime.selectnbsend</code></a> å‡½æ•°æ”¹å†™ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> ch &lt;- i:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> selectnbsend(ch, i) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­æœ€é‡è¦çš„å°±æ˜¯ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L662-L664"><code>runtime.selectnbsend</code></a> å‡½æ•°ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†å‘ Channel éé˜»å¡åœ°å‘é€æ•°æ®çš„èƒ½åŠ›ã€‚æˆ‘ä»¬åœ¨ <a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-channel/">Channel</a> ä¸€èŠ‚ä»‹ç»äº†å‘ Channel å‘é€æ•°æ®çš„ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L157-L278"><code>runtime.chansend</code></a> å‡½æ•°åŒ…å«ä¸€ä¸ª <code>block</code> å‚æ•°ï¼Œè¯¥å‚æ•°ä¼šå†³å®šè¿™ä¸€æ¬¡çš„å‘é€æ˜¯ä¸æ˜¯é˜»å¡çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectnbsend</span><span class="params">(c *hchan, elem unsafe.Pointer)</span> <span class="params">(selected <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> chansend(c, elem, <span class="literal">false</span>, getcallerpc())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬å‘ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L157-L278"><code>runtime.chansend</code></a> å‡½æ•°ä¼ å…¥äº† <code>false</code>ï¼Œæ‰€ä»¥å“ªæ€•æ˜¯ä¸å­˜åœ¨æ¥æ”¶æ–¹æˆ–è€…ç¼“å†²åŒºç©ºé—´ä¸è¶³éƒ½ä¸ä¼šé˜»å¡å½“å‰ Goroutine è€Œæ˜¯ä¼šç›´æ¥è¿”å›ã€‚</p><h4 id="æ¥æ”¶"><a href="#æ¥æ”¶" class="headerlink" title="æ¥æ”¶"></a>æ¥æ”¶</h4><p>ç”±äºä» Channel ä¸­æ¥æ”¶æ•°æ®å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå€¼ï¼Œæ‰€ä»¥æ¥å—æ•°æ®çš„æƒ…å†µä¼šæ¯”å‘é€ç¨æ˜¾å¤æ‚ï¼Œä¸è¿‡æ”¹å†™çš„å¥—è·¯æ˜¯å·®ä¸å¤šçš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¹å†™å‰</span></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v &lt;- ch: <span class="comment">// case v, ok &lt;- ch:</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¹å†™å</span></span><br><span class="line"><span class="keyword">if</span> selectnbrecv(&amp;v, ch) &#123; <span class="comment">// if selectnbrecv2(&amp;v, &amp;ok, ch) &#123;</span></span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›å€¼æ•°é‡ä¸åŒä¼šå¯¼è‡´ä½¿ç”¨å‡½æ•°çš„ä¸åŒï¼Œä¸¤ä¸ªç”¨äºéé˜»å¡æ¥æ”¶æ¶ˆæ¯çš„å‡½æ•° <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L683-L686"><code>runtime.selectnbrecv</code></a> å’Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L705-L709"><code>runtime.selectnbrecv2</code></a> åªæ˜¯å¯¹ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L448-L579"><code>runtime.chanrecv</code></a> è¿”å›å€¼çš„å¤„ç†ç¨æœ‰ä¸åŒï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectnbrecv</span><span class="params">(elem unsafe.Pointer, c *hchan)</span> <span class="params">(selected <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">selected, _ = chanrecv(c, elem, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectnbrecv2</span><span class="params">(elem unsafe.Pointer, received *<span class="keyword">bool</span>, c *hchan)</span> <span class="params">(selected <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">selected, *received = chanrecv(c, elem, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ¥æ”¶æ–¹ä¸éœ€è¦ï¼Œæ‰€ä»¥ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L683-L686"><code>runtime.selectnbrecv</code></a> ä¼šç›´æ¥å¿½ç•¥è¿”å›çš„å¸ƒå°”å€¼ï¼Œè€Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L705-L709"><code>runtime.selectnbrecv2</code></a> ä¼šå°†å¸ƒå°”å€¼å›ä¼ ç»™è°ƒç”¨æ–¹ã€‚ä¸ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L157-L278"><code>runtime.chansend</code></a> ä¸€æ ·ï¼Œ<a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L448-L579"><code>runtime.chanrecv</code></a> ä¹Ÿæä¾›äº†ä¸€ä¸ª <code>block</code> å‚æ•°ç”¨äºæ§åˆ¶è¿™ä¸€æ¬¡æ¥æ”¶æ˜¯å¦é˜»å¡ã€‚</p><h3 id="å¸¸è§æµç¨‹"><a href="#å¸¸è§æµç¨‹" class="headerlink" title="å¸¸è§æµç¨‹"></a>å¸¸è§æµç¨‹</h3><p>åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨å¦‚ä¸‹çš„æµç¨‹å¤„ç† <code>select</code> è¯­å¥ï¼š</p><ol><li>å°†æ‰€æœ‰çš„ <code>case</code> è½¬æ¢æˆåŒ…å« Channel ä»¥åŠç±»å‹ç­‰ä¿¡æ¯çš„ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L28-L34"><code>runtime.scase</code></a> ç»“æ„ä½“ï¼›</li><li>è°ƒç”¨è¿è¡Œæ—¶å‡½æ•° <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> ä»å¤šä¸ªå‡†å¤‡å°±ç»ªçš„ Channel ä¸­é€‰æ‹©ä¸€ä¸ªå¯æ‰§è¡Œçš„ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L28-L34"><code>runtime.scase</code></a> ç»“æ„ä½“ï¼›</li><li>é€šè¿‡ <code>for</code> å¾ªç¯ç”Ÿæˆä¸€ç»„ <code>if</code> è¯­å¥ï¼Œåœ¨è¯­å¥ä¸­åˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯è¢«é€‰ä¸­çš„ <code>case</code></li></ol><p>ä¸€ä¸ªåŒ…å«ä¸‰ä¸ª <code>case</code> çš„æ­£å¸¸ <code>select</code> è¯­å¥å…¶å®ä¼šè¢«å±•å¼€æˆå¦‚ä¸‹æ‰€ç¤ºçš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­å¤„ç†çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">selv := [<span class="number">3</span>]scase&#123;&#125;</span><br><span class="line">order := [<span class="number">6</span>]<span class="keyword">uint16</span></span><br><span class="line"><span class="keyword">for</span> i, cas := <span class="keyword">range</span> cases &#123;</span><br><span class="line">    c := scase&#123;&#125;</span><br><span class="line">    c.kind = ...</span><br><span class="line">    c.elem = ...</span><br><span class="line">    c.c = ...</span><br><span class="line">&#125;</span><br><span class="line">chosen, revcOK := selectgo(selv, order, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">if</span> chosen == <span class="number">0</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> chosen == <span class="number">1</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> chosen == <span class="number">2</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å±•å¼€åçš„ä»£ç ç‰‡æ®µä¸­æœ€é‡è¦çš„å°±æ˜¯ç”¨äºé€‰æ‹©å¾…æ‰§è¡Œ <code>case</code> çš„è¿è¡Œæ—¶å‡½æ•° <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œ æ‰€ä»¥è¿™é‡Œåˆ†ä¸¤éƒ¨åˆ†åˆ†æå®ƒçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><ol><li>æ‰§è¡Œä¸€äº›å¿…è¦çš„åˆå§‹åŒ–æ“ä½œå¹¶ç¡®å®š <code>case</code> çš„å¤„ç†é¡ºåºï¼›</li><li>åœ¨å¾ªç¯ä¸­æ ¹æ® <code>case</code> çš„ç±»å‹åšå‡ºä¸åŒçš„å¤„ç†ï¼›</li></ol><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p><a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> å‡½æ•°é¦–å…ˆä¼šè¿›è¡Œæ‰§è¡Œå¿…è¦çš„åˆå§‹åŒ–æ“ä½œå¹¶å†³å®šå¤„ç† <code>case</code> çš„ä¸¤ä¸ªé¡ºåº â€” è½®è¯¢é¡ºåº <code>pollOrder</code> å’ŒåŠ é”é¡ºåº <code>lockOrder</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectgo</span><span class="params">(cas0 *scase, order0 *<span class="keyword">uint16</span>, ncases <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">cas1 := (*[<span class="number">1</span> &lt;&lt; <span class="number">16</span>]scase)(unsafe.Pointer(cas0))</span><br><span class="line">order1 := (*[<span class="number">1</span> &lt;&lt; <span class="number">17</span>]<span class="keyword">uint16</span>)(unsafe.Pointer(order0))</span><br><span class="line"></span><br><span class="line">scases := cas1[:ncases:ncases]</span><br><span class="line">pollorder := order1[:ncases:ncases]</span><br><span class="line">lockorder := order1[ncases:][:ncases:ncases]</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> scases &#123;</span><br><span class="line">cas := &amp;scases[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; ncases; i++ &#123;</span><br><span class="line">j := fastrandn(<span class="keyword">uint32</span>(i + <span class="number">1</span>))</span><br><span class="line">pollorder[i] = pollorder[j]</span><br><span class="line">pollorder[j] = <span class="keyword">uint16</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ® Channel çš„åœ°å€æ’åºç¡®å®šåŠ é”é¡ºåº</span></span><br><span class="line">...</span><br><span class="line">sellock(scases, lockorder)</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½®è¯¢é¡ºåº <code>pollOrder</code> å’ŒåŠ é”é¡ºåº <code>lockOrder</code> åˆ†åˆ«æ˜¯é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼ç¡®è®¤çš„ï¼š</p><ul><li>è½®è¯¢é¡ºåºï¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/383b447e0da5bd1fcdc2439230b5a1d3e3402117/src/runtime/stubs.go#L114-L118"><code>runtime.fastrandn</code></a> å‡½æ•°å¼•å…¥éšæœºæ€§ï¼›</li><li>åŠ é”é¡ºåºï¼šæŒ‰ç…§ Channel çš„åœ°å€æ’åºåç¡®å®šåŠ é”é¡ºåºï¼›</li></ul><p>éšæœºçš„è½®è¯¢é¡ºåºå¯ä»¥é¿å… Channel çš„é¥¥é¥¿é—®é¢˜ï¼Œä¿è¯å…¬å¹³æ€§ï¼›è€Œæ ¹æ® Channel çš„åœ°å€é¡ºåºç¡®å®šåŠ é”é¡ºåºèƒ½å¤Ÿé¿å…æ­»é”çš„å‘ç”Ÿã€‚è¿™æ®µä»£ç æœ€åè°ƒç”¨çš„ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L45-L54"><code>runtime.sellock</code></a> å‡½æ•°ä¼šæŒ‰ç…§ä¹‹å‰ç”Ÿæˆçš„åŠ é”é¡ºåºé”å®š <code>select</code> è¯­å¥ä¸­åŒ…å«æ‰€æœ‰çš„ Channelã€‚</p><h4 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h4><p>å½“æˆ‘ä»¬ä¸º <code>select</code> è¯­å¥é”å®šäº†æ‰€æœ‰ Channel ä¹‹åå°±ä¼šè¿›å…¥ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> å‡½æ•°çš„ä¸»å¾ªç¯ï¼Œå®ƒä¼šåˆ†ä¸‰ä¸ªé˜¶æ®µæŸ¥æ‰¾æˆ–è€…ç­‰å¾…æŸä¸ª Channel å‡†å¤‡å°±ç»ªï¼š</p><ol><li>æŸ¥æ‰¾æ˜¯å¦å·²ç»å­˜åœ¨å‡†å¤‡å°±ç»ªçš„ Channelï¼Œå³å¯ä»¥æ‰§è¡Œæ”¶å‘æ“ä½œï¼›</li><li>å°†å½“å‰ Goroutine åŠ å…¥ Channel å¯¹åº”çš„æ”¶å‘é˜Ÿåˆ—ä¸Šå¹¶ç­‰å¾…å…¶ä»– Goroutine çš„å”¤é†’ï¼›</li><li>å½“å‰ Goroutine è¢«å”¤é†’ä¹‹åæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ Channel å¹¶è¿›è¡Œå¤„ç†ï¼›</li></ol><p><a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> å‡½æ•°ä¼šæ ¹æ®ä¸åŒæƒ…å†µé€šè¿‡ <code>goto</code> è·³è½¬åˆ°å‡½æ•°å†…éƒ¨çš„ä¸åŒæ ‡ç­¾æ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ul><li><code>bufrecv</code>ï¼šå¯ä»¥ä»ç¼“å†²åŒºè¯»å–æ•°æ®ï¼›</li><li><code>bufsend</code>ï¼šå¯ä»¥å‘ç¼“å†²åŒºå†™å…¥æ•°æ®ï¼›</li><li><code>recv</code>ï¼šå¯ä»¥ä»ä¼‘çœ çš„å‘é€æ–¹è·å–æ•°æ®ï¼›</li><li><code>send</code>ï¼šå¯ä»¥å‘ä¼‘çœ çš„æ¥æ”¶æ–¹å‘é€æ•°æ®ï¼›</li><li><code>rclose</code>ï¼šå¯ä»¥ä»å…³é—­çš„ Channel è¯»å– EOFï¼›</li><li><code>sclose</code>ï¼šå‘å…³é—­çš„ Channel å‘é€æ•°æ®ï¼›</li><li><code>retc</code>ï¼šç»“æŸè°ƒç”¨å¹¶è¿”å›ï¼›</li></ul><p>æˆ‘ä»¬å…ˆæ¥åˆ†æå¾ªç¯æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼ŒæŸ¥æ‰¾å·²ç»å‡†å¤‡å°±ç»ªçš„ Channelã€‚å¾ªç¯ä¼šéå†æ‰€æœ‰çš„ <code>case</code> å¹¶æ‰¾åˆ°éœ€è¦è¢«å”¤èµ·çš„ <a href="https://github.com/golang/go/blob/cfe3cd903f018dec3cb5997d53b1744df4e53909/src/runtime/runtime2.go#L342-L368"><code>runtime.sudog</code></a> ç»“æ„ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¼šæ ¹æ® <code>case</code> çš„å››ç§ç±»å‹åˆ†åˆ«å¤„ç†ï¼š</p><ol><li><p>```<br>caseNil</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ï¼šå½“å‰</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>case</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">   ä¸åŒ…å« Channelï¼›</span><br><span class="line"></span><br><span class="line">   - è¿™ç§ `case` ä¼šè¢«è·³è¿‡ï¼›</span><br><span class="line"></span><br><span class="line">2. ```</span><br><span class="line">   caseRecv</span><br></pre></td></tr></table></figure><p>ï¼šå½“å‰</p></li></ol>   <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br></pre></td></tr></table></figure><p>   ä¼šä» Channel ä¸­æ¥æ”¶æ•°æ®ï¼›</p><ul><li>å¦‚æœå½“å‰ Channel çš„ <code>sendq</code> ä¸Šæœ‰ç­‰å¾…çš„ Goroutineï¼Œå°±ä¼šè·³åˆ° <code>recv</code> æ ‡ç­¾å¹¶ä»ç¼“å†²åŒºè¯»å–æ•°æ®åå°†ç­‰å¾… Goroutine ä¸­çš„æ•°æ®æ”¾å…¥åˆ°ç¼“å†²åŒºä¸­ç›¸åŒçš„ä½ç½®ï¼›</li><li>å¦‚æœå½“å‰ Channel çš„ç¼“å†²åŒºä¸ä¸ºç©ºï¼Œå°±ä¼šè·³åˆ° <code>bufrecv</code> æ ‡ç­¾å¤„ä»ç¼“å†²åŒºè·å–æ•°æ®ï¼›</li><li>å¦‚æœå½“å‰ Channel å·²ç»è¢«å…³é—­ï¼Œå°±ä¼šè·³åˆ° <code>rclose</code> åšä¸€äº›æ¸…é™¤çš„æ”¶å°¾å·¥ä½œï¼›</li></ul><ol><li><p>```<br>caseSend</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ï¼šå½“å‰</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>case</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">   ä¼šå‘ Channel å‘é€æ•°æ®ï¼›</span><br><span class="line"></span><br><span class="line">   - å¦‚æœå½“å‰ Channel å·²ç»è¢«å…³ï¼Œé—­å°±ä¼šç›´æ¥è·³åˆ° `sclose` æ ‡ç­¾ï¼Œè§¦å‘ `panic` å°è¯•ä¸­æ­¢ç¨‹åºï¼›</span><br><span class="line">   - å¦‚æœå½“å‰ Channel çš„ `recvq` ä¸Šæœ‰ç­‰å¾…çš„ Goroutineï¼Œå°±ä¼šè·³åˆ° `send` æ ‡ç­¾å‘ Channel å‘é€æ•°æ®ï¼›</span><br><span class="line">   - å¦‚æœå½“å‰ Channel çš„ç¼“å†²åŒºå­˜åœ¨ç©ºé—²ä½ç½®ï¼Œå°±ä¼šå°†å¾…å‘é€çš„æ•°æ®å­˜å…¥ç¼“å†²åŒºï¼›</span><br><span class="line"></span><br><span class="line">4. ```</span><br><span class="line">   caseDefault</span><br></pre></td></tr></table></figure><p>ï¼šå½“å‰</p></li></ol>   <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br></pre></td></tr></table></figure><p>   ä¸º</p>   <figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span></span><br></pre></td></tr></table></figure><p>   è¯­å¥ï¼›</p><ul><li>è¡¨ç¤ºå‰é¢çš„æ‰€æœ‰ <code>case</code> éƒ½æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè¿™é‡Œä¼šè§£é”æ‰€æœ‰ Channel å¹¶è¿”å›ï¼Œæ„å‘³ç€å½“å‰ <code>select</code> ç»“æ„ä¸­çš„æ”¶å‘éƒ½æ˜¯éé˜»å¡çš„ï¼›</li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-01-18-15793463657488-golang-runtime-selectgo.png" alt="golang-runtime-selectgo"></p><p><strong>å›¾ 5-8 è¿è¡Œæ—¶ selectgo å‡½æ•°</strong></p><p>ç¬¬ä¸€é˜¶æ®µçš„ä¸»è¦èŒè´£æ˜¯æŸ¥æ‰¾æ‰€æœ‰ <code>case</code> ä¸­ Channel æ˜¯å¦æœ‰å¯ä»¥ç«‹åˆ»è¢«å¤„ç†çš„æƒ…å†µã€‚æ— è®ºæ˜¯åœ¨åŒ…å«ç­‰å¾…çš„ Goroutine è¿˜æ˜¯ç¼“å†²åŒºä¸­å­˜åœ¨æ•°æ®ï¼Œåªè¦æ»¡è¶³æ¡ä»¶å°±ä¼šç«‹åˆ»å¤„ç†ï¼Œå¦‚æœä¸èƒ½ç«‹åˆ»æ‰¾åˆ°æ´»è·ƒçš„ Channel å°±ä¼šè¿›å…¥å¾ªç¯çš„ä¸‹ä¸€é˜¶æ®µï¼ŒæŒ‰ç…§éœ€è¦å°†å½“å‰çš„ Goroutine åŠ å…¥åˆ° Channel çš„ <code>sendq</code> æˆ–è€… <code>recvq</code> é˜Ÿåˆ—ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectgo</span><span class="params">(cas0 *scase, order0 *<span class="keyword">uint16</span>, ncases <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">gp = getg()</span><br><span class="line">nextp = &amp;gp.waiting</span><br><span class="line"><span class="keyword">for</span> _, casei := <span class="keyword">range</span> lockorder &#123;</span><br><span class="line">casi = <span class="keyword">int</span>(casei)</span><br><span class="line">cas = &amp;scases[casi]</span><br><span class="line">c = cas.c</span><br><span class="line">sg := acquireSudog()</span><br><span class="line">sg.g = gp</span><br><span class="line">sg.c = c</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> cas.kind &#123;</span><br><span class="line"><span class="keyword">case</span> caseRecv:</span><br><span class="line">c.recvq.enqueue(sg)</span><br><span class="line"><span class="keyword">case</span> caseSend:</span><br><span class="line">c.sendq.enqueue(sg)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gopark(selparkcommit, <span class="literal">nil</span>, waitReasonSelect, traceEvGoBlockSelect, <span class="number">1</span>)</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†å°†å½“å‰ Goroutine å¯¹åº”çš„ <a href="https://github.com/golang/go/blob/cfe3cd903f018dec3cb5997d53b1744df4e53909/src/runtime/runtime2.go#L342-L368"><code>runtime.sudog</code></a> ç»“æ„ä½“åŠ å…¥é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿™äº› <a href="https://github.com/golang/go/blob/cfe3cd903f018dec3cb5997d53b1744df4e53909/src/runtime/runtime2.go#L342-L368"><code>runtime.sudog</code></a> ç»“æ„ä½“éƒ½ä¼šè¢«ä¸²æˆé“¾è¡¨é™„ç€åœ¨ Goroutine ä¸Šã€‚åœ¨å…¥é˜Ÿä¹‹åä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/c112289ee4141ebc31db50328c355b01278b987b/src/runtime/proc.go#L287-L305"><code>runtime.gopark</code></a> å‡½æ•°æŒ‚èµ·å½“å‰ Goroutine ç­‰å¾…è°ƒåº¦å™¨çš„å”¤é†’ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-01-19-15794018429558-Golang-Select-Waiting.png" alt="Golang-Select-Waiting"></p><p><strong>å›¾ 5-9 Goroutine ä¸Šç­‰å¾…æ”¶å‘çš„ sudog é“¾è¡¨</strong></p><p>ç­‰åˆ° <code>select</code> ä¸­çš„ä¸€äº› Channel å‡†å¤‡å°±ç»ªä¹‹åï¼Œå½“å‰ Goroutine å°±ä¼šè¢«è°ƒåº¦å™¨å”¤é†’ã€‚è¿™æ—¶ä¼šç»§ç»­æ‰§è¡Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> å‡½æ•°çš„ç¬¬ä¸‰é˜¶æ®µï¼Œä» <a href="https://github.com/golang/go/blob/cfe3cd903f018dec3cb5997d53b1744df4e53909/src/runtime/runtime2.go#L342-L368"><code>runtime.sudog</code></a> ç»“æ„ä½“ä¸­è·å–æ•°æ®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectgo</span><span class="params">(cas0 *scase, order0 *<span class="keyword">uint16</span>, ncases <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">sg = (*sudog)(gp.param)</span><br><span class="line">gp.param = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">casi = <span class="number">-1</span></span><br><span class="line">cas = <span class="literal">nil</span></span><br><span class="line">sglist = gp.waiting</span><br><span class="line"><span class="keyword">for</span> _, casei := <span class="keyword">range</span> lockorder &#123;</span><br><span class="line">k = &amp;scases[casei]</span><br><span class="line"><span class="keyword">if</span> sg == sglist &#123;</span><br><span class="line">casi = <span class="keyword">int</span>(casei)</span><br><span class="line">cas = k</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> k.kind == caseSend &#123;</span><br><span class="line">c.sendq.dequeueSudoG(sglist)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">c.recvq.dequeueSudoG(sglist)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sgnext = sglist.waitlink</span><br><span class="line">sglist.waitlink = <span class="literal">nil</span></span><br><span class="line">releaseSudog(sglist)</span><br><span class="line">sglist = sgnext</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c = cas.c</span><br><span class="line"><span class="keyword">goto</span> retc</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ¬¡éå†å…¨éƒ¨ <code>case</code> æ—¶ï¼Œæˆ‘ä»¬ä¼šå…ˆè·å–å½“å‰ Goroutine æ¥æ”¶åˆ°çš„å‚æ•° <code>sudog</code> ç»“æ„ï¼Œæˆ‘ä»¬ä¼šä¾æ¬¡å¯¹æ¯”æ‰€æœ‰ <code>case</code> å¯¹åº”çš„ <code>sudog</code> ç»“æ„æ‰¾åˆ°è¢«å”¤é†’çš„ <code>case</code>ï¼Œè·å–è¯¥ <code>case</code> å¯¹åº”çš„ç´¢å¼•å¹¶è¿”å›ã€‚</p><p>ç”±äºå½“å‰çš„ <code>select</code> ç»“æ„æ‰¾åˆ°äº†ä¸€ä¸ª <code>case</code> æ‰§è¡Œï¼Œé‚£ä¹ˆå‰©ä¸‹ <code>case</code> ä¸­æ²¡æœ‰è¢«ç”¨åˆ°çš„ <code>sudog</code> å°±ä¼šè¢«å¿½ç•¥å¹¶ä¸”é‡Šæ”¾æ‰ã€‚ä¸ºäº†ä¸å½±å“ Channel çš„æ­£å¸¸ä½¿ç”¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å°†è¿™äº›åºŸå¼ƒçš„ <code>sudog</code> ä» Channel ä¸­å‡ºé˜Ÿã€‚</p><p>å½“æˆ‘ä»¬åœ¨å¾ªç¯ä¸­å‘ç°ç¼“å†²åŒºä¸­æœ‰å…ƒç´ æˆ–è€…ç¼“å†²åŒºæœªæ»¡æ—¶å°±ä¼šé€šè¿‡ <code>goto</code> å…³é”®å­—è·³è½¬åˆ° <code>bufrecv</code> å’Œ <code>bufsend</code> ä¸¤ä¸ªä»£ç æ®µï¼Œè¿™ä¸¤æ®µä»£ç çš„æ‰§è¡Œè¿‡ç¨‹éƒ½å¾ˆç®€å•ï¼Œå®ƒä»¬åªæ˜¯å‘ Channel ä¸­å‘é€æ•°æ®æˆ–è€…ä»ç¼“å†²åŒºä¸­è·å–æ–°æ•°æ®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bufrecv:</span><br><span class="line">recvOK = <span class="literal">true</span></span><br><span class="line">qp = chanbuf(c, c.recvx)</span><br><span class="line"><span class="keyword">if</span> cas.elem != <span class="literal">nil</span> &#123;</span><br><span class="line">typedmemmove(c.elemtype, cas.elem, qp)</span><br><span class="line">&#125;</span><br><span class="line">typedmemclr(c.elemtype, qp)</span><br><span class="line">c.recvx++</span><br><span class="line"><span class="keyword">if</span> c.recvx == c.dataqsiz &#123;</span><br><span class="line">c.recvx = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">c.qcount--</span><br><span class="line">selunlock(scases, lockorder)</span><br><span class="line"><span class="keyword">goto</span> retc</span><br><span class="line"></span><br><span class="line">bufsend:</span><br><span class="line">typedmemmove(c.elemtype, chanbuf(c, c.sendx), cas.elem)</span><br><span class="line">c.sendx++</span><br><span class="line"><span class="keyword">if</span> c.sendx == c.dataqsiz &#123;</span><br><span class="line">c.sendx = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">c.qcount++</span><br><span class="line">selunlock(scases, lockorder)</span><br><span class="line"><span class="keyword">goto</span> retc</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨ç¼“å†²åŒºè¿›è¡Œçš„æ“ä½œå’Œç›´æ¥è°ƒç”¨ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L157-L278"><code>runtime.chansend</code></a> å’Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L448-L579"><code>runtime.chanrecv</code></a> å‡½æ•°å·®ä¸å¤šï¼Œä¸Šè¿°ä¸¤ä¸ªè¿‡ç¨‹åœ¨æ‰§è¡Œç»“æŸä¹‹åéƒ½ä¼šç›´æ¥è·³åˆ° <code>retc</code> å­—æ®µã€‚</p><p>ä¸¤ä¸ªç›´æ¥å¯¹ Channel æ”¶å‘çš„æƒ…å†µä¼šè°ƒç”¨ Channel è¿è¡Œæ—¶å‡½æ•° <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L286-L317"><code>runtime.send</code></a> å’Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L594-L635"><code>runtime.recv</code></a>ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¼šç›´æ¥ä¸å¤„äºä¼‘çœ çŠ¶æ€çš„ Goroutine æ‰“äº¤é“ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">recv:</span><br><span class="line">recv(c, sg, cas.elem, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; selunlock(scases, lockorder) &#125;, <span class="number">2</span>)</span><br><span class="line">recvOK = <span class="literal">true</span></span><br><span class="line"><span class="keyword">goto</span> retc</span><br><span class="line"></span><br><span class="line">send:</span><br><span class="line">send(c, sg, cas.elem, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; selunlock(scases, lockorder) &#125;, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">goto</span> retc</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¦‚æœå‘å…³é—­çš„ Channel å‘é€æ•°æ®æˆ–è€…ä»å…³é—­çš„ Channel ä¸­æ¥æ”¶æ•°æ®ï¼Œæƒ…å†µå°±ç¨å¾®æœ‰ä¸€ç‚¹å¤æ‚äº†ï¼š</p><ul><li>ä»ä¸€ä¸ªå…³é—­ Channel ä¸­æ¥æ”¶æ•°æ®ä¼šç›´æ¥æ¸…é™¤ Channel ä¸­çš„ç›¸å…³å†…å®¹ï¼›</li><li>å‘ä¸€ä¸ªå…³é—­çš„ Channel å‘é€æ•°æ®å°±ä¼šç›´æ¥ <code>panic</code> é€ æˆç¨‹åºå´©æºƒï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rclose:</span><br><span class="line">selunlock(scases, lockorder)</span><br><span class="line">recvOK = <span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span> cas.elem != <span class="literal">nil</span> &#123;</span><br><span class="line">typedmemclr(c.elemtype, cas.elem)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">goto</span> retc</span><br><span class="line"></span><br><span class="line">sclose:</span><br><span class="line">selunlock(scases, lockorder)</span><br><span class="line"><span class="built_in">panic</span>(plainError(<span class="string">&quot;send on closed channel&quot;</span>))</span><br></pre></td></tr></table></figure><p>æ€»ä½“æ¥çœ‹ï¼Œ<code>select</code> è¯­å¥ä¸­çš„ Channel æ”¶å‘æ“ä½œå’Œç›´æ¥æ“ä½œ Channel æ²¡æœ‰å¤ªå¤šå‡ºå…¥ï¼Œåªæ˜¯ç”±äº <code>select</code> å¤šå‡ºäº† <code>default</code> å…³é”®å­—æ‰€ä»¥ä¼šæ”¯æŒéé˜»å¡çš„æ”¶å‘ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹ <code>select</code> ç»“æ„çš„æ‰§è¡Œè¿‡ç¨‹ä¸å®ç°åŸç†ï¼Œé¦–å…ˆåœ¨ç¼–è¯‘æœŸé—´ï¼ŒGo è¯­è¨€ä¼šå¯¹ <code>select</code> è¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¼šæ ¹æ® <code>select</code> ä¸­ <code>case</code> çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ä¼˜åŒ–è·¯å¾„ï¼š</p><ol><li><p>ç©ºçš„ <code>select</code> è¯­å¥ä¼šè¢«è½¬æ¢æˆ <a href="https://github.com/golang/go/blob/c112289ee4141ebc31db50328c355b01278b987b/src/runtime/select.go#L104-L106"><code>runtime.block</code></a> å‡½æ•°çš„è°ƒç”¨ï¼Œç›´æ¥æŒ‚èµ·å½“å‰ Goroutineï¼›</p></li><li><p>å¦‚æœ</p></li></ol>   <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br></pre></td></tr></table></figure><p>   è¯­å¥ä¸­åªåŒ…å«ä¸€ä¸ª</p>   <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br></pre></td></tr></table></figure><p>   ï¼Œå°±ä¼šè¢«è½¬æ¢æˆ</p>   <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ch == nil &#123; <span class="keyword">block </span>&#125;<span class="comment">; n;</span></span><br></pre></td></tr></table></figure><p>   è¡¨è¾¾å¼ï¼›</p><ul><li>é¦–å…ˆåˆ¤æ–­æ“ä½œçš„ Channel æ˜¯ä¸æ˜¯ç©ºçš„ï¼›</li><li>ç„¶åæ‰§è¡Œ <code>case</code> ç»“æ„ä¸­çš„å†…å®¹ï¼›</li></ul><ol><li><p>å¦‚æœ <code>select</code> è¯­å¥ä¸­åªåŒ…å«ä¸¤ä¸ª <code>case</code> å¹¶ä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ <code>default</code>ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L683-L686"><code>runtime.selectnbrecv</code></a> å’Œ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/chan.go#L662-L664"><code>runtime.selectnbsend</code></a> éé˜»å¡åœ°æ‰§è¡Œæ”¶å‘æ“ä½œï¼›</p></li><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> å‡½æ•°è·å–æ‰§è¡Œ <code>case</code> çš„ç´¢å¼•ï¼Œå¹¶é€šè¿‡å¤šä¸ª <code>if</code> è¯­å¥æ‰§è¡Œå¯¹åº” <code>case</code> ä¸­çš„ä»£ç ï¼›</p></li></ol><p>åœ¨ç¼–è¯‘å™¨å·²ç»å¯¹ <code>select</code> è¯­å¥è¿›è¡Œä¼˜åŒ–ä¹‹åï¼ŒGo è¯­è¨€ä¼šåœ¨è¿è¡Œæ—¶æ‰§è¡Œç¼–è¯‘æœŸé—´å±•å¼€çš„ <a href="https://github.com/golang/go/blob/d1969015b4ac29be4f518b94817d3f525380639d/src/runtime/select.go#L118-L497"><code>runtime.selectgo</code></a> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šæŒ‰ç…§ä»¥ä¸‹çš„æµç¨‹æ‰§è¡Œï¼š</p><ol><li><p>éšæœºç”Ÿæˆä¸€ä¸ªéå†çš„è½®è¯¢é¡ºåº <code>pollOrder</code> å¹¶æ ¹æ® Channel åœ°å€ç”Ÿæˆé”å®šé¡ºåº <code>lockOrder</code>ï¼›</p></li><li><p>æ ¹æ®</p></li></ol>   <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pollOrder</span></span><br></pre></td></tr></table></figure><p>   éå†æ‰€æœ‰çš„</p>   <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br></pre></td></tr></table></figure><p>   æŸ¥çœ‹æ˜¯å¦æœ‰å¯ä»¥ç«‹åˆ»å¤„ç†çš„ Channelï¼›</p><ol><li>å¦‚æœå­˜åœ¨å°±ç›´æ¥è·å– <code>case</code> å¯¹åº”çš„ç´¢å¼•å¹¶è¿”å›ï¼›</li><li>å¦‚æœä¸å­˜åœ¨å°±ä¼šåˆ›å»º <a href="https://github.com/golang/go/blob/cfe3cd903f018dec3cb5997d53b1744df4e53909/src/runtime/runtime2.go#L342-L368"><code>runtime.sudog</code></a> ç»“æ„ä½“ï¼Œå°†å½“å‰ Goroutine åŠ å…¥åˆ°æ‰€æœ‰ç›¸å…³ Channel çš„æ”¶å‘é˜Ÿåˆ—ï¼Œå¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/c112289ee4141ebc31db50328c355b01278b987b/src/runtime/proc.go#L287-L305"><code>runtime.gopark</code></a> æŒ‚èµ·å½“å‰ Goroutine ç­‰å¾…è°ƒåº¦å™¨çš„å”¤é†’ï¼›</li></ol><ol><li>å½“è°ƒåº¦å™¨å”¤é†’å½“å‰ Goroutine æ—¶å°±ä¼šå†æ¬¡æŒ‰ç…§ <code>lockOrder</code> éå†æ‰€æœ‰çš„ <code>case</code>ï¼Œä»ä¸­æŸ¥æ‰¾éœ€è¦è¢«å¤„ç†çš„ <a href="https://github.com/golang/go/blob/cfe3cd903f018dec3cb5997d53b1744df4e53909/src/runtime/runtime2.go#L342-L368"><code>runtime.sudog</code></a> ç»“æ„å¯¹åº”çš„ç´¢å¼•ï¼›</li></ol><p><code>select</code> å…³é”®å­—æ˜¯ Go è¯­è¨€ç‰¹æœ‰çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒçš„å®ç°åŸç†æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å‡½æ•°çš„é€šåŠ›åˆä½œã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://man7.org/linux/man-pages/man2/select.2.html">SELECT(2) Â· Linux</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„å¹¶å‘åŸç†</title>
      <link href="/2020/01/16/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%B9%B6%E5%8F%91%E5%8E%9F%E7%90%86/"/>
      <url>/2020/01/16/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%B9%B6%E5%8F%91%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>Goè¯­è¨€æ˜¯ä¸ºå¹¶å‘è€Œç”Ÿçš„è¯­è¨€ï¼ŒGoè¯­è¨€æ˜¯ä¸ºæ•°ä¸å¤šçš„åœ¨è¯­è¨€å±‚é¢å®ç°å¹¶å‘çš„è¯­è¨€ï¼›ä¹Ÿæ­£æ˜¯Goè¯­è¨€çš„å¹¶å‘ç‰¹æ€§ï¼Œå¸å¼•äº†å…¨çƒæ— æ•°çš„å¼€å‘è€…ã€‚</p><a id="more"></a><h1 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h1><p><strong>å¹¶å‘(concurrency)</strong>ï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä»»åŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…è¢«æ‰§è¡Œã€‚æˆ‘ä»¬ä¸å¿…careè¿™äº›ä»»åŠ¡åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹æ˜¯å¦æ˜¯åŒæ—¶æ‰§è¡Œï¼Œå¯èƒ½åŒæ—¶æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼Œæˆ‘ä»¬åªå…³å¿ƒåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå“ªæ€•æ˜¯å¾ˆçŸ­çš„æ—¶é—´ï¼ˆä¸€ç§’æˆ–è€…ä¸¤ç§’ï¼‰æ˜¯å¦æ‰§è¡Œè§£å†³äº†ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šä»»åŠ¡ã€‚</p><p><strong>å¹¶è¡Œ(parallellism)ï¼š</strong>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä»»åŠ¡åœ¨åŒä¸€æ—¶åˆ»è¢«åŒæ—¶æ‰§è¡Œã€‚</p><p>å¹¶å‘è¯´çš„æ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè€Œå¹¶è¡Œï¼Œå¼ºè°ƒçš„æ˜¯ç‰©ç†è¿è¡ŒçŠ¶æ€ã€‚å¹¶å‘â€œåŒ…å«â€å¹¶è¡Œã€‚</p><p>ï¼ˆè¯¦æƒ…è¯·è§ï¼šRob Pike çš„<a href="https://talks.golang.org/2012/concurrency.slide#1">PPT</a>ï¼‰</p><h1 id="Goçš„CSPå¹¶å‘æ¨¡å‹"><a href="#Goçš„CSPå¹¶å‘æ¨¡å‹" class="headerlink" title="Goçš„CSPå¹¶å‘æ¨¡å‹"></a>Goçš„CSPå¹¶å‘æ¨¡å‹</h1><p>Goå®ç°äº†ä¸¤ç§å¹¶å‘å½¢å¼ã€‚ç¬¬ä¸€ç§æ˜¯å¤§å®¶æ™®éè®¤çŸ¥çš„ï¼šå¤šçº¿ç¨‹å…±äº«å†…å­˜ã€‚å…¶å®å°±æ˜¯Javaæˆ–è€…C++ç­‰è¯­è¨€ä¸­çš„å¤šçº¿ç¨‹å¼€å‘ã€‚å¦å¤–ä¸€ç§æ˜¯Goè¯­è¨€ç‰¹æœ‰çš„ï¼Œä¹Ÿæ˜¯Goè¯­è¨€æ¨èçš„ï¼šCSPï¼ˆcommunicating sequential processesï¼‰å¹¶å‘æ¨¡å‹ã€‚</p><p>CSPå¹¶å‘æ¨¡å‹æ˜¯åœ¨1970å¹´å·¦å³æå‡ºçš„æ¦‚å¿µï¼Œå±äºæ¯”è¾ƒæ–°çš„æ¦‚å¿µï¼Œä¸åŒäºä¼ ç»Ÿçš„å¤šçº¿ç¨‹é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼ŒCSPè®²ç©¶çš„æ˜¯â€œä»¥é€šä¿¡çš„æ–¹å¼æ¥å…±äº«å†…å­˜â€ã€‚</p><p>è¯·è®°ä½ä¸‹é¢è¿™å¥è¯ï¼š<br><strong>Do not communicate by sharing memory; instead, share memory by communicating.</strong><br>â€œä¸è¦ä»¥å…±äº«å†…å­˜çš„æ–¹å¼æ¥é€šä¿¡ï¼Œç›¸åï¼Œè¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ã€‚â€</p><p>æ™®é€šçš„çº¿ç¨‹å¹¶å‘æ¨¡å‹ï¼Œå°±æ˜¯åƒJavaã€C++ã€æˆ–è€…Pythonï¼Œä»–ä»¬çº¿ç¨‹é—´é€šä¿¡éƒ½æ˜¯é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼æ¥è¿›è¡Œçš„ã€‚éå¸¸å…¸å‹çš„æ–¹å¼å°±æ˜¯ï¼Œåœ¨è®¿é—®å…±äº«æ•°æ®ï¼ˆä¾‹å¦‚æ•°ç»„ã€Mapã€æˆ–è€…æŸä¸ªç»“æ„ä½“æˆ–å¯¹è±¡ï¼‰çš„æ—¶å€™ï¼Œé€šè¿‡é”æ¥è®¿é—®ï¼Œå› æ­¤ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ï¼Œè¡ç”Ÿå‡ºä¸€ç§æ–¹ä¾¿æ“ä½œçš„æ•°æ®ç»“æ„ï¼Œå«åšâ€œçº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„â€ã€‚ä¾‹å¦‚Javaæä¾›çš„åŒ…â€java.util.concurrentâ€ä¸­çš„æ•°æ®ç»“æ„ã€‚Goä¸­ä¹Ÿå®ç°äº†ä¼ ç»Ÿçš„çº¿ç¨‹å¹¶å‘æ¨¡å‹ã€‚</p><p>Goçš„CSPå¹¶å‘æ¨¡å‹ï¼Œæ˜¯é€šè¿‡<code>goroutine</code>å’Œ<code>channel</code>æ¥å®ç°çš„ã€‚</p><ul><li><code>goroutine</code> æ˜¯Goè¯­è¨€ä¸­å¹¶å‘çš„æ‰§è¡Œå•ä½ã€‚æœ‰ç‚¹æŠ½è±¡ï¼Œå…¶å®å°±æ˜¯å’Œä¼ ç»Ÿæ¦‚å¿µä¸Šçš„â€çº¿ç¨‹â€œç±»ä¼¼ï¼Œå¯ä»¥ç†è§£ä¸ºâ€çº¿ç¨‹â€œã€‚</li><li><code>channel</code>æ˜¯Goè¯­è¨€ä¸­å„ä¸ªå¹¶å‘ç»“æ„ä½“(<code>goroutine</code>)ä¹‹å‰çš„é€šä¿¡æœºåˆ¶ã€‚ é€šä¿—çš„è®²ï¼Œå°±æ˜¯å„ä¸ª<code>goroutine</code>ä¹‹é—´é€šä¿¡çš„â€ç®¡é“â€œï¼Œæœ‰ç‚¹ç±»ä¼¼äºLinuxä¸­çš„ç®¡é“ã€‚</li></ul><p>ç”Ÿæˆä¸€ä¸ª<code>goroutine</code>çš„æ–¹å¼éå¸¸çš„ç®€å•ï¼šGoä¸€ä¸‹ï¼Œå°±ç”Ÿæˆäº†ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go f()<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>é€šä¿¡æœºåˆ¶<code>channel</code>ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä¼ æ•°æ®ç”¨<code>channel &lt;- data</code>ï¼Œå–æ•°æ®ç”¨<code>&lt;-channel</code>ã€‚</p><p>åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¼ æ•°æ®<code>channel &lt;- data</code>å’Œå–æ•°æ®<code>&lt;-channel</code>å¿…ç„¶ä¼šæˆå¯¹å‡ºç°ï¼Œå› ä¸ºè¿™è¾¹ä¼ ï¼Œé‚£è¾¹å–ï¼Œä¸¤ä¸ª<code>goroutine</code>ä¹‹é—´æ‰ä¼šå®ç°é€šä¿¡ã€‚</p><p>è€Œä¸”ä¸ç®¡ä¼ è¿˜æ˜¯å–ï¼Œå¿…é˜»å¡ï¼Œç›´åˆ°å¦å¤–çš„<code>goroutine</code>ä¼ æˆ–è€…å–ä¸ºæ­¢ã€‚</p><p>æœ‰ä¸¤ä¸ª<code>goroutine</code>ï¼Œå…¶ä¸­ä¸€ä¸ªå‘èµ·äº†å‘<code>channel</code>ä¸­å‘èµ·äº†ä¼ å€¼æ“ä½œã€‚ï¼ˆ<code>goroutine</code>ä¸ºçŸ©å½¢ï¼Œ<code>channel</code>ä¸ºç®­å¤´ï¼‰</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/send.png" alt="img"></p><p>å·¦è¾¹çš„<code>goroutine</code>å¼€å§‹é˜»å¡ï¼Œç­‰å¾…æœ‰äººæ¥æ”¶ã€‚</p><p>è¿™æ—¶å€™ï¼Œå³è¾¹çš„<code>goroutine</code>å‘èµ·äº†æ¥æ”¶æ“ä½œã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/accept.png" alt="img"></p><p>å³è¾¹çš„<code>goroutine</code>ä¹Ÿå¼€å§‹é˜»å¡ï¼Œç­‰å¾…åˆ«äººä¼ é€ã€‚</p><p>è¿™æ—¶å€™ï¼Œä¸¤è¾¹<code>goroutine</code>éƒ½å‘ç°äº†å¯¹æ–¹ï¼Œäºæ˜¯ä¸¤ä¸ª<code>goroutine</code>å¼€å§‹ä¸€ä¼ ï¼Œä¸€æ”¶ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/communicate.png" alt="img"></p><p>è¿™ä¾¿æ˜¯Golang CSPå¹¶å‘æ¨¡å‹æœ€åŸºæœ¬çš„å½¢å¼ã€‚</p><h1 id="Goå¹¶å‘æ¨¡å‹çš„å®ç°åŸç†"><a href="#Goå¹¶å‘æ¨¡å‹çš„å®ç°åŸç†" class="headerlink" title="Goå¹¶å‘æ¨¡å‹çš„å®ç°åŸç†"></a>Goå¹¶å‘æ¨¡å‹çš„å®ç°åŸç†</h1><p>æˆ‘ä»¬å…ˆä»çº¿ç¨‹è®²èµ·ï¼Œæ— è®ºè¯­è¨€å±‚é¢ä½•ç§å¹¶å‘æ¨¡å‹ï¼Œåˆ°äº†æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œä¸€å®šæ˜¯ä»¥çº¿ç¨‹çš„å½¢æ€å­˜åœ¨çš„ã€‚è€Œæ“ä½œç³»ç»Ÿæ ¹æ®èµ„æºè®¿é—®æƒé™çš„ä¸åŒï¼Œä½“ç³»æ¶æ„å¯åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼›å†…æ ¸ç©ºé—´ä¸»è¦æ“ä½œè®¿é—®CPUèµ„æºã€I/Oèµ„æºã€å†…å­˜èµ„æºç­‰ç¡¬ä»¶èµ„æºï¼Œä¸ºä¸Šå±‚åº”ç”¨ç¨‹åºæä¾›æœ€åŸºæœ¬çš„åŸºç¡€èµ„æºï¼Œç”¨æˆ·ç©ºé—´å‘¢å°±æ˜¯ä¸Šå±‚åº”ç”¨ç¨‹åºçš„å›ºå®šæ´»åŠ¨ç©ºé—´ï¼Œç”¨æˆ·ç©ºé—´ä¸å¯ä»¥ç›´æ¥è®¿é—®èµ„æºï¼Œå¿…é¡»é€šè¿‡â€œç³»ç»Ÿè°ƒç”¨â€ã€â€œåº“å‡½æ•°â€æˆ–â€œShellè„šæœ¬â€æ¥è°ƒç”¨å†…æ ¸ç©ºé—´æä¾›çš„èµ„æºã€‚</p><p>æˆ‘ä»¬ç°åœ¨çš„è®¡ç®—æœºè¯­è¨€ï¼Œå¯ä»¥ç‹­ä¹‰çš„è®¤ä¸ºæ˜¯ä¸€ç§â€œè½¯ä»¶â€ï¼Œå®ƒä»¬ä¸­æ‰€è°“çš„â€œçº¿ç¨‹â€ï¼Œå¾€å¾€æ˜¯ç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œå’Œæ“ä½œç³»ç»Ÿæœ¬èº«å†…æ ¸æ€çš„çº¿ç¨‹ï¼ˆç®€ç§°KSEï¼‰ï¼Œè¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><p>çº¿ç¨‹æ¨¡å‹çš„å®ç°ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><h3 id="ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹"><a href="#ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹" class="headerlink" title="ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹"></a>ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/yonghutai.png" alt="img"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œå¤šä¸ªç”¨æˆ·æ€çš„çº¿ç¨‹å¯¹åº”ç€ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œç¨‹åºçº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€åˆ‡æ¢æˆ–è€…åŒæ­¥ç­‰çº¿ç¨‹å·¥ä½œå¿…é¡»è‡ªèº«æ¥å®Œæˆã€‚</p><h3 id="å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹"><a href="#å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹" class="headerlink" title="å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹"></a>å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/neiheji.png" alt="img"></p><p>è¿™ç§æ¨¡å‹ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸çº¿ç¨‹ï¼Œæ‰€æœ‰çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€åˆ‡æ¢ã€åŒæ­¥ç­‰æ“ä½œï¼Œéƒ½ç”±å†…æ ¸æ¥å®Œæˆã€‚C++å°±æ˜¯è¿™ç§ã€‚</p><h3 id="ä¸¤çº§çº¿ç¨‹æ¨¡å‹"><a href="#ä¸¤çº§çº¿ç¨‹æ¨¡å‹" class="headerlink" title="ä¸¤çº§çº¿ç¨‹æ¨¡å‹"></a>ä¸¤çº§çº¿ç¨‹æ¨¡å‹</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/liangji.png" alt="img"></p><p>è¿™ç§æ¨¡å‹æ˜¯ä»‹äºç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹å’Œå†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ä¹‹é—´çš„ä¸€ç§çº¿ç¨‹æ¨¡å‹ã€‚è¿™ç§æ¨¡å‹çš„å®ç°éå¸¸å¤æ‚ï¼Œå’Œå†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ç±»ä¼¼ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯¹åº”å¤šä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œä½†æ˜¯è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¸å’Œå†…æ ¸çº¿ç¨‹ä¸€ä¸€å¯¹åº”ï¼›è¿™ç§çº¿ç¨‹æ¨¡å‹ä¼šå…ˆåˆ›å»ºå¤šä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œç„¶åç”¨è‡ªèº«çš„ç”¨æˆ·çº§çº¿ç¨‹å»å¯¹åº”åˆ›å»ºçš„å¤šä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œè‡ªèº«çš„ç”¨æˆ·çº§çº¿ç¨‹éœ€è¦æœ¬èº«ç¨‹åºå»è°ƒåº¦ï¼Œå†…æ ¸çº§çš„çº¿ç¨‹äº¤ç»™æ“ä½œç³»ç»Ÿå†…æ ¸å»è°ƒåº¦ã€‚</p><p>Goè¯­è¨€çš„çº¿ç¨‹æ¨¡å‹å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸¤çº§çº¿ç¨‹æ¨¡å‹ã€‚æš‚ä¸”å«å®ƒâ€œMPGâ€æ¨¡å‹å§ã€‚</p><h2 id="Goçº¿ç¨‹å®ç°æ¨¡å‹MPG"><a href="#Goçº¿ç¨‹å®ç°æ¨¡å‹MPG" class="headerlink" title="Goçº¿ç¨‹å®ç°æ¨¡å‹MPG"></a>Goçº¿ç¨‹å®ç°æ¨¡å‹MPG</h2><p><code>M</code>æŒ‡çš„æ˜¯<code>Machine</code>ï¼Œä¸€ä¸ª<code>M</code>ç›´æ¥å…³è”äº†ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ã€‚<br><code>P</code>æŒ‡çš„æ˜¯â€processorâ€ï¼Œä»£è¡¨äº†<code>M</code>æ‰€éœ€çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¹Ÿæ˜¯å¤„ç†ç”¨æˆ·çº§ä»£ç é€»è¾‘çš„å¤„ç†å™¨ã€‚<br><code>G</code>æŒ‡çš„æ˜¯<code>Goroutine</code>ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ã€‚</p><p>ä¸‰è€…å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/GMPrelation.png" alt="img"></p><p>ä»¥ä¸Šè¿™ä¸ªå›¾è®²çš„æ˜¯ä¸¤ä¸ªçº¿ç¨‹(å†…æ ¸çº¿ç¨‹)çš„æƒ…å†µã€‚ä¸€ä¸ªMä¼šå¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä¸€ä¸ªMä¹Ÿä¼šè¿æ¥ä¸€ä¸ªä¸Šä¸‹æ–‡Pï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡Pç›¸å½“äºä¸€ä¸ªâ€œå¤„ç†å™¨â€ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡è¿æ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªGoroutineã€‚P(Processor)çš„æ•°é‡æ˜¯åœ¨å¯åŠ¨æ—¶è¢«è®¾ç½®ä¸ºç¯å¢ƒå˜é‡GOMAXPROCSçš„å€¼ï¼Œæˆ–è€…é€šè¿‡è¿è¡Œæ—¶è°ƒç”¨å‡½æ•°<code>runtime.GOMAXPROCS()</code>è¿›è¡Œè®¾ç½®ã€‚Processoræ•°é‡å›ºå®šæ„å‘³ç€ä»»æ„æ—¶åˆ»åªæœ‰å›ºå®šæ•°é‡çš„çº¿ç¨‹åœ¨è¿è¡Œgoä»£ç ã€‚Goroutineä¸­å°±æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œå¹¶å‘çš„ä»£ç ã€‚å›¾ä¸­Pæ­£åœ¨æ‰§è¡Œçš„<code>Goroutine</code>ä¸ºè“è‰²çš„ï¼›å¤„äºå¾…æ‰§è¡ŒçŠ¶æ€çš„<code>Goroutine</code>ä¸ºç°è‰²çš„ï¼Œç°è‰²çš„<code>Goroutine</code>å½¢æˆäº†ä¸€ä¸ªé˜Ÿåˆ—<code>runqueues</code></p><p>ä¸‰è€…å…³ç³»çš„å®è§‚çš„å›¾ä¸ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/total.png" alt="img"></p><h4 id="æŠ›å¼ƒP-Processor"><a href="#æŠ›å¼ƒP-Processor" class="headerlink" title="æŠ›å¼ƒP(Processor)"></a>æŠ›å¼ƒP(Processor)</h4><p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆä¸€å®šéœ€è¦ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ç›´æ¥é™¤å»ä¸Šä¸‹æ–‡ï¼Œè®©<code>Goroutine</code>çš„<code>runqueues</code>æŒ‚åˆ°Mä¸Šå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¡Œï¼Œéœ€è¦ä¸Šä¸‹æ–‡çš„ç›®çš„ï¼Œæ˜¯è®©æˆ‘ä»¬å¯ä»¥ç›´æ¥æ”¾å¼€å…¶ä»–çº¿ç¨‹ï¼Œå½“é‡åˆ°å†…æ ¸çº¿ç¨‹é˜»å¡çš„æ—¶å€™ã€‚</p><p>ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­å°±æ˜¯ç³»ç»Ÿè°ƒç”¨<code>sysall</code>ï¼Œä¸€ä¸ªçº¿ç¨‹è‚¯å®šä¸èƒ½åŒæ—¶æ‰§è¡Œä»£ç å’Œç³»ç»Ÿè°ƒç”¨è¢«é˜»å¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ­¤çº¿ç¨‹Méœ€è¦æ”¾å¼ƒå½“å‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒPï¼Œä»¥ä¾¿å¯ä»¥è®©å…¶ä»–çš„<code>Goroutine</code>è¢«è°ƒåº¦æ‰§è¡Œã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/giveupP.png" alt="img"></p><p>å¦‚ä¸Šå›¾å·¦å›¾æ‰€ç¤ºï¼ŒM0ä¸­çš„G0æ‰§è¡Œäº†syscallï¼Œç„¶åå°±åˆ›å»ºäº†ä¸€ä¸ªM1(ä¹Ÿæœ‰å¯èƒ½æœ¬èº«å°±å­˜åœ¨ï¼Œæ²¡åˆ›å»º)ï¼Œï¼ˆè½¬å‘å³å›¾ï¼‰ç„¶åM0ä¸¢å¼ƒäº†Pï¼Œç­‰å¾…syscallçš„è¿”å›å€¼ï¼ŒM1æ¥å—äº†Pï¼Œå°†Â·ç»§ç»­æ‰§è¡Œ<code>Goroutine</code>é˜Ÿåˆ—ä¸­çš„å…¶ä»–<code>Goroutine</code>ã€‚</p><p>å½“ç³»ç»Ÿè°ƒç”¨syscallç»“æŸåï¼ŒM0ä¼šâ€œå·â€ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¦‚æœä¸æˆåŠŸï¼ŒM0å°±æŠŠå®ƒçš„Gouroutine G0æ”¾åˆ°ä¸€ä¸ªå…¨å±€çš„runqueueä¸­ï¼Œç„¶åè‡ªå·±æ”¾åˆ°çº¿ç¨‹æ± æˆ–è€…è½¬å…¥ä¼‘çœ çŠ¶æ€ã€‚å…¨å±€runqueueæ˜¯å„ä¸ªPåœ¨è¿è¡Œå®Œè‡ªå·±çš„æœ¬åœ°çš„Goroutine runqueueåç”¨æ¥æ‹‰å–æ–°goroutineçš„åœ°æ–¹ã€‚Pä¹Ÿä¼šå‘¨æœŸæ€§çš„æ£€æŸ¥è¿™ä¸ªå…¨å±€runqueueä¸Šçš„goroutineï¼Œå¦åˆ™ï¼Œå…¨å±€runqueueä¸Šçš„goroutineså¯èƒ½å¾—ä¸åˆ°æ‰§è¡Œè€Œé¥¿æ­»ã€‚</p><h4 id="å‡è¡¡çš„åˆ†é…å·¥ä½œ"><a href="#å‡è¡¡çš„åˆ†é…å·¥ä½œ" class="headerlink" title="å‡è¡¡çš„åˆ†é…å·¥ä½œ"></a>å‡è¡¡çš„åˆ†é…å·¥ä½œ</h4><p>æŒ‰ç…§ä»¥ä¸Šçš„è¯´æ³•ï¼Œä¸Šä¸‹æ–‡Pä¼šå®šæœŸçš„æ£€æŸ¥å…¨å±€çš„goroutine é˜Ÿåˆ—ä¸­çš„goroutineï¼Œä»¥ä¾¿è‡ªå·±åœ¨æ¶ˆè´¹æ‰è‡ªèº«Goroutineé˜Ÿåˆ—çš„æ—¶å€™æœ‰äº‹å¯åšã€‚å‡å¦‚å…¨å±€goroutineé˜Ÿåˆ—ä¸­çš„goroutineä¹Ÿæ²¡äº†å‘¢ï¼Ÿå°±ä»å…¶ä»–è¿è¡Œçš„ä¸­çš„Pçš„runqueueé‡Œå·ã€‚</p><p>æ¯ä¸ªPä¸­çš„<code>Goroutine</code>ä¸åŒå¯¼è‡´ä»–ä»¬è¿è¡Œçš„æ•ˆç‡å’Œæ—¶é—´ä¹Ÿä¸åŒï¼Œåœ¨ä¸€ä¸ªæœ‰å¾ˆå¤šPå’ŒMçš„ç¯å¢ƒä¸­ï¼Œä¸èƒ½è®©ä¸€ä¸ªPè·‘å®Œè‡ªèº«çš„<code>Goroutine</code>å°±æ²¡äº‹å¯åšäº†ï¼Œå› ä¸ºæˆ–è®¸å…¶ä»–çš„Pæœ‰å¾ˆé•¿çš„<code>goroutine</code>é˜Ÿåˆ—è¦è·‘ï¼Œå¾—éœ€è¦å‡è¡¡ã€‚<br>è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>Goçš„åšæ³•å€’ä¹Ÿç›´æ¥ï¼Œä»å…¶ä»–Pä¸­å·ä¸€åŠï¼</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i6448038.github.io/img/csp/stealwork.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„å“ˆå¸Œè¡¨</title>
      <link href="/2020/01/13/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8/"/>
      <url>/2020/01/13/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å®ç°äº†å“ˆå¸Œè¡¨è¿™ç§ æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ Javaçš„Mapï¼ŒPythonçš„Setï¼ŒJavaçš„ Objectç­‰ç­‰ã€‚ä½†ä»–ä»¬çš„åº•å±‚åŸç†éƒ½æœ‰æ‰€ä¸åŒã€‚å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º<code>O(n)</code>ã€‚å®ƒæ ¹æ®é”®ç›´æ¥è®¿é—®å†…å­˜å­˜å‚¨ä½ç½®ã€‚æˆ‘ä»¬ç»“åˆå“ˆå¸Œè¡¨çš„åŸç†æ¢ç´¢ä¸€ä¸‹Goä¸­çš„å“ˆå¸Œâ€”â€”Mapã€‚</p><a id="more"></a><h2 id="å“ˆå¸ŒåŸç†"><a href="#å“ˆå¸ŒåŸç†" class="headerlink" title="å“ˆå¸ŒåŸç†"></a>å“ˆå¸ŒåŸç†</h2><p>å“ˆå¸Œè¡¨æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„æœ€é‡è¦æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œè¿™ä¸ä»…å› ä¸ºå®ƒ <code>O(1)</code> çš„è¯»å†™æ€§èƒ½éå¸¸ä¼˜ç§€ï¼Œè¿˜å› ä¸ºå®ƒæä¾›äº†é”®å€¼ä¹‹é—´çš„æ˜ å°„ã€‚æƒ³è¦å®ç°ä¸€ä¸ªæ€§èƒ½ä¼˜å¼‚çš„å“ˆå¸Œè¡¨ï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹ â€”â€” å“ˆå¸Œå‡½æ•°å’Œå†²çªè§£å†³æ–¹æ³•ã€‚</p><p>å®ç°å“ˆå¸Œè¡¨çš„å…³é”®ç‚¹åœ¨äºå¦‚ä½•é€‰æ‹©å“ˆå¸Œå‡½æ•°ï¼Œå“ˆå¸Œå‡½æ•°çš„é€‰æ‹©åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šèƒ½å¤Ÿå†³å®šå“ˆå¸Œè¡¨çš„è¯»å†™æ€§èƒ½ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œå“ˆå¸Œå‡½æ•°åº”è¯¥èƒ½å¤Ÿå°†ä¸åŒé”®æ˜ å°„åˆ°ä¸åŒçš„ç´¢å¼•ä¸Šï¼Œè¿™è¦æ±‚<strong>å“ˆå¸Œå‡½æ•°è¾“å‡ºèŒƒå›´å¤§äºè¾“å…¥èŒƒå›´</strong>ï¼Œä½†æ˜¯ç”±äºé”®çš„æ•°é‡ä¼šè¿œè¿œå¤§äºæ˜ å°„çš„èŒƒå›´ï¼Œæ‰€ä»¥åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ªç†æƒ³çš„ç»“æœæ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/4keU1Kiw6AqtWM3.png" alt="perfect-hash-function"></p><p>æ¯”è¾ƒå®é™…çš„æ–¹å¼æ˜¯è®©å“ˆå¸Œå‡½æ•°çš„ç»“æœèƒ½å¤Ÿå°½å¯èƒ½çš„å‡åŒ€åˆ†å¸ƒï¼Œç„¶åé€šè¿‡å·¥ç¨‹ä¸Šçš„æ‰‹æ®µè§£å†³å“ˆå¸Œç¢°æ’çš„é—®é¢˜ï¼Œä½†æ˜¯å“ˆå¸Œçš„ç»“æœä¸€å®šè¦å°½å¯èƒ½å‡åŒ€ï¼Œç»“æœä¸å‡åŒ€çš„å“ˆå¸Œå‡½æ•°ä¼šé€ æˆæ›´å¤šçš„å†²çªå¹¶å¯¼è‡´æ›´å·®çš„è¯»å†™æ€§èƒ½ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/VepMsj8D2Q7rgPF.png" alt="bad-hash-function"></p><p>åœ¨ä¸€ä¸ªä½¿ç”¨ç»“æœè¾ƒä¸ºå‡åŒ€çš„å“ˆå¸Œå‡½æ•°ä¸­ï¼Œå“ˆå¸Œçš„å¢åˆ æ”¹æŸ¥éƒ½éœ€è¦ <code>O(1)</code> çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†æ˜¯éå¸¸ä¸å‡åŒ€çš„å“ˆå¸Œå‡½æ•°ä¼šå¯¼è‡´æ‰€æœ‰çš„æ“ä½œéƒ½ä¼šå ç”¨æœ€å·® <code>O(n)</code> çš„å¤æ‚åº¦ï¼Œæ‰€ä»¥åœ¨å“ˆå¸Œè¡¨ä¸­ä½¿ç”¨å¥½çš„å“ˆå¸Œå‡½æ•°æ˜¯è‡³å…³é‡è¦çš„ã€‚</p><h3 id="å†²çªè§£å†³"><a href="#å†²çªè§£å†³" class="headerlink" title="å†²çªè§£å†³"></a>å†²çªè§£å†³</h3><p>å°±åƒæˆ‘ä»¬ä¹‹å‰æ‰€æåˆ°çš„ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œå“ˆå¸Œå‡½æ•°è¾“å…¥çš„èŒƒå›´ä¸€å®šä¼šè¿œè¿œå¤§äºè¾“å‡ºçš„èŒƒå›´ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ä¸€å®šä¼šé‡åˆ°å†²çªï¼Œå“ªæ€•æˆ‘ä»¬ä½¿ç”¨äº†å®Œç¾çš„å“ˆå¸Œå‡½æ•°ï¼Œå½“è¾“å…¥çš„é”®è¶³å¤Ÿå¤šæœ€ç»ˆä¹Ÿä¼šé€ æˆå†²çªã€‚</p><p>ç„¶è€Œæˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°å¾€å¾€éƒ½æ˜¯ä¸å®Œç¾çš„ï¼Œè¾“å‡ºçš„èŒƒå›´æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥ä¸€å®šä¼šå‘ç”Ÿå“ˆå¸Œç¢°æ’ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€äº›æ–¹æ³•æ¥è§£å†³å“ˆå¸Œç¢°æ’çš„é—®é¢˜ï¼Œå¸¸è§æ–¹æ³•çš„å°±æ˜¯å¼€æ”¾å¯»å€æ³•å’Œæ‹‰é“¾æ³•ã€‚</p><h4 id="å¼€æ”¾å¯»å€æ³•"><a href="#å¼€æ”¾å¯»å€æ³•" class="headerlink" title="å¼€æ”¾å¯»å€æ³•"></a>å¼€æ”¾å¯»å€æ³•</h4><p><a href="https://en.wikipedia.org/wiki/Open_addressing">å¼€æ”¾å¯»å€æ³•</a>æ˜¯ä¸€ç§åœ¨å“ˆå¸Œè¡¨ä¸­è§£å†³å“ˆå¸Œç¢°æ’çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å¯¹æ•°ç»„ä¸­çš„å…ƒç´ ä¾æ¬¡æ¢æµ‹å’Œæ¯”è¾ƒä»¥åˆ¤æ–­ç›®æ ‡é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­</strong>ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¼€æ”¾å¯»å€æ³•æ¥å®ç°å“ˆå¸Œè¡¨ï¼Œé‚£ä¹ˆåœ¨æ”¯æ’‘å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„å°±æ˜¯æ•°ç»„ï¼Œä¸è¿‡å› ä¸ºæ•°ç»„çš„é•¿åº¦æœ‰é™ï¼Œå­˜å‚¨ <code>(author, draven)</code> è¿™ä¸ªé”®å€¼å¯¹æ—¶ä¼šä»å¦‚ä¸‹çš„ç´¢å¼•å¼€å§‹éå†ï¼š</p><p>å½“æˆ‘ä»¬å‘å½“å‰å“ˆå¸Œè¡¨å†™å…¥æ–°çš„æ•°æ®æ—¶å‘ç”Ÿäº†å†²çªï¼Œå°±ä¼šå°†é”®å€¼å¯¹å†™å…¥åˆ°ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºçš„ä½ç½®ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/y2R9jbHzApUl5KN.png" alt="open-addressing-and-set"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“ Key3 ä¸å·²ç»å­˜å…¥å“ˆå¸Œè¡¨ä¸­çš„ä¸¤ä¸ªé”®å€¼å¯¹ Key1 å’Œ Key2 å‘ç”Ÿå†²çªæ—¶ï¼ŒKey3 ä¼šè¢«å†™å…¥ Key2 åé¢çš„ç©ºé—²å†…å­˜ä¸­ï¼›å½“æˆ‘ä»¬å†å»è¯»å– Key3 å¯¹åº”çš„å€¼æ—¶å°±ä¼šå…ˆå¯¹é”®è¿›è¡Œå“ˆå¸Œå¹¶å–æ¨¡ï¼Œè¿™ä¼šå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ° Key1ï¼Œå› ä¸º Key1 ä¸æˆ‘ä»¬æœŸæœ›çš„é”® Key3 ä¸åŒ¹é…ï¼Œæ‰€ä»¥ä¼šç»§ç»­æŸ¥æ‰¾åé¢çš„å…ƒç´ ï¼Œç›´åˆ°å†…å­˜ä¸ºç©ºæˆ–è€…æ‰¾åˆ°ç›®æ ‡å…ƒç´ ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/473thb6OaIZz9Sg.png" alt="open-addressing-and-get"></p><p>å½“éœ€è¦æŸ¥æ‰¾æŸä¸ªé”®å¯¹åº”çš„å€¼æ—¶ï¼Œå°±ä¼šä»ç´¢å¼•çš„ä½ç½®å¼€å§‹å¯¹æ•°ç»„è¿›è¡Œçº¿æ€§æ¢æµ‹ï¼Œæ‰¾åˆ°ç›®æ ‡é”®å€¼å¯¹æˆ–è€…ç©ºå†…å­˜å°±æ„å‘³ç€è¿™ä¸€æ¬¡æŸ¥è¯¢æ“ä½œçš„ç»“æŸã€‚</p><p>å¼€æ”¾å¯»å€æ³•ä¸­å¯¹æ€§èƒ½å½±å“æœ€å¤§çš„å°±æ˜¯<strong>è£…è½½å› å­</strong>ï¼Œå®ƒæ˜¯æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ä¸æ•°ç»„å¤§å°çš„æ¯”å€¼ï¼Œéšç€è£…è½½å› å­çš„å¢åŠ ï¼Œçº¿æ€§æ¢æµ‹çš„å¹³å‡ç”¨æ—¶å°±ä¼šé€æ¸å¢åŠ ï¼Œè¿™ä¼šåŒæ—¶å½±å“å“ˆå¸Œè¡¨çš„è¯»å†™æ€§èƒ½ï¼Œå½“è£…è½½ç‡è¶…è¿‡ 70% ä¹‹åï¼Œå“ˆå¸Œè¡¨çš„æ€§èƒ½å°±ä¼šæ€¥å‰§ä¸‹é™ï¼Œè€Œä¸€æ—¦è£…è½½ç‡è¾¾åˆ° 100%ï¼Œæ•´ä¸ªå“ˆå¸Œè¡¨å°±ä¼šå®Œå…¨å¤±æ•ˆï¼Œè¿™æ—¶æŸ¥æ‰¾å’Œæ’å…¥ä»»æ„å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ ğ‘‚(ğ‘›)O(n) çš„ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦éå†æ•°ç»„ä¸­å…¨éƒ¨çš„å…ƒç´ ï¼Œæ‰€ä»¥åœ¨å®ç°å“ˆå¸Œè¡¨æ—¶ä¸€å®šè¦æ—¶åˆ»å…³æ³¨è£…è½½å› å­çš„å˜åŒ–ã€‚</p><h4 id="æ‹‰é“¾æ³•"><a href="#æ‹‰é“¾æ³•" class="headerlink" title="æ‹‰é“¾æ³•"></a>æ‹‰é“¾æ³•</h4><p>ä¸å¼€æ”¾åœ°å€æ³•ç›¸æ¯”ï¼Œæ‹‰é“¾æ³•æ˜¯å“ˆå¸Œè¡¨ä¸­æœ€å¸¸è§çš„å®ç°æ–¹æ³•ï¼Œå¤§å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€éƒ½ç”¨æ‹‰é“¾æ³•å®ç°å“ˆå¸Œè¡¨ï¼Œå®ƒçš„å®ç°æ¯”è¾ƒå¼€æ”¾åœ°å€æ³•ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯å¹³å‡æŸ¥æ‰¾çš„é•¿åº¦ä¹Ÿæ¯”è¾ƒçŸ­ï¼Œå„ä¸ªç”¨äºå­˜å‚¨èŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯åŠ¨æ€ç”³è¯·çš„ï¼Œå¯ä»¥èŠ‚çœæ¯”è¾ƒå¤šçš„å­˜å‚¨ç©ºé—´ã€‚</p><p>å®ç°æ‹‰é“¾æ³•ä¸€èˆ¬ä¼šä½¿ç”¨æ•°ç»„åŠ ä¸Šé“¾è¡¨ï¼Œä¸è¿‡æœ‰ä¸€äº›è¯­è¨€ä¼šåœ¨æ‹‰é“¾æ³•çš„å“ˆå¸Œä¸­å¼•å…¥çº¢é»‘æ ‘ä»¥ä¼˜åŒ–æ€§èƒ½ï¼ˆä¾‹å¦‚Java 1.8çš„ <code>LinkedHashMap</code>ï¼‰ï¼Œæ‹‰é“¾æ³•ä¼šä½¿ç”¨é“¾è¡¨æ•°ç»„ä½œä¸ºå“ˆå¸Œåº•å±‚çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒçœ‹æˆä¸€ä¸ªå¯ä»¥æ‰©å±•çš„ã€äºŒç»´æ•°ç»„ã€ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/xVQlw6abu2vjZAz.png" alt="separate-chaing-and-set"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªé”®å€¼å¯¹ <code>(Key6, Value6)</code> å†™å…¥å“ˆå¸Œè¡¨æ—¶ï¼Œé”®å€¼å¯¹ä¸­çš„é”® <code>Key6</code> éƒ½ä¼šå…ˆç»è¿‡ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå“ˆå¸Œå‡½æ•°è¿”å›çš„å“ˆå¸Œä¼šå¸®åŠ©æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ¡¶ï¼Œå’Œå¼€æ”¾åœ°å€æ³•ä¸€æ ·ï¼Œé€‰æ‹©æ¡¶çš„æ–¹å¼å°±æ˜¯ç›´æ¥å¯¹å“ˆå¸Œè¿”å›çš„ç»“æœå–æ¨¡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index := hash(<span class="string">&quot;Key6&quot;</span>) % array.<span class="built_in">len</span></span><br></pre></td></tr></table></figure><p>é€‰æ‹©äº† 2 å·æ¡¶ä¹‹åå°±å¯ä»¥éå†å½“å‰æ¡¶ä¸­çš„é“¾è¡¨äº†ï¼Œåœ¨éå†é“¾è¡¨çš„è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ol><li>æ‰¾åˆ°é”®ç›¸åŒçš„é”®å€¼å¯¹ â€”â€” æ›´æ–°é”®å¯¹åº”çš„å€¼ï¼›</li><li>æ²¡æœ‰æ‰¾åˆ°é”®ç›¸åŒçš„é”®å€¼å¯¹ â€”â€” åœ¨é“¾è¡¨çš„æœ«å°¾è¿½åŠ æ–°é”®å€¼å¯¹ï¼›</li></ol><p>å°†é”®å€¼å¯¹å†™å…¥å“ˆå¸Œä¹‹åï¼Œè¦é€šè¿‡æŸä¸ªé”®åœ¨å…¶ä¸­è·å–æ˜ å°„çš„å€¼ï¼Œå°±ä¼šç»å†å¦‚ä¸‹çš„è¿‡ç¨‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/e1ykREfm7TXKPJF.png" alt="separate-chaing-and-get"></p><p>Key11 å±•ç¤ºäº†ä¸€ä¸ªé”®åœ¨å“ˆå¸Œè¡¨ä¸­ä¸å­˜åœ¨çš„ä¾‹å­ï¼Œå½“å“ˆå¸Œè¡¨å‘ç°å®ƒå‘½ä¸­ 4 å·æ¡¶æ—¶ï¼Œå®ƒä¼šä¾æ¬¡éå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œç„¶è€Œéå†åˆ°é“¾è¡¨çš„æœ«å°¾ä¹Ÿæ²¡æœ‰æ‰¾åˆ°æœŸæœ›çš„é”®ï¼Œæ‰€ä»¥å“ˆå¸Œè¡¨ä¸­æ²¡æœ‰è¯¥é”®å¯¹åº”çš„å€¼ã€‚</p><p>åœ¨ä¸€ä¸ªæ€§èƒ½æ¯”è¾ƒå¥½çš„å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯ä¸€ä¸ªæ¡¶ä¸­éƒ½åº”è¯¥æœ‰ 0~1 ä¸ªå…ƒç´ ï¼Œæœ‰æ—¶ä¼šæœ‰ 2~3 ä¸ªï¼Œå¾ˆå°‘ä¼šè¶…è¿‡è¿™ä¸ªæ•°é‡ï¼Œè®¡ç®—å“ˆå¸Œã€å®šä½æ¡¶å’Œéå†é“¾è¡¨ä¸‰ä¸ªè¿‡ç¨‹æ˜¯å“ˆå¸Œè¡¨è¯»å†™æ“ä½œçš„ä¸»è¦å¼€é”€ï¼Œä½¿ç”¨æ‹‰é“¾æ³•å®ç°çš„å“ˆå¸Œä¹Ÿæœ‰è£…è½½å› å­è¿™ä¸€æ¦‚å¿µï¼š</p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">è£…è½½å› å­ :</span>=<span class="string"> å…ƒç´ æ•°é‡ / æ¡¶æ•°é‡</span></span><br></pre></td></tr></table></figure><p>ä¸å¼€æ”¾åœ°å€æ³•ä¸€æ ·ï¼Œæ‹‰é“¾æ³•çš„è£…è½½å› å­è¶Šå¤§ï¼Œå“ˆå¸Œçš„è¯»å†™æ€§èƒ½å°±è¶Šå·®ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨æ‹‰é“¾æ³•çš„å“ˆå¸Œè¡¨è£…è½½å› å­éƒ½ä¸ä¼šè¶…è¿‡ 1ï¼Œå½“å“ˆå¸Œè¡¨çš„è£…è½½å› å­è¾ƒå¤§æ—¶å°±ä¼šè§¦å‘å“ˆå¸Œçš„æ‰©å®¹ï¼Œåˆ›å»ºæ›´å¤šçš„æ¡¶æ¥å­˜å‚¨å“ˆå¸Œä¸­çš„å…ƒç´ ï¼Œä¿è¯æ€§èƒ½ä¸ä¼šå‡ºç°ä¸¥é‡çš„ä¸‹é™ã€‚å¦‚æœæœ‰ 1000 ä¸ªæ¡¶çš„å“ˆå¸Œè¡¨å­˜å‚¨äº† 10000 ä¸ªé”®å€¼å¯¹ï¼Œå®ƒçš„æ€§èƒ½æ˜¯ä¿å­˜ 1000 ä¸ªé”®å€¼å¯¹çš„ 1/10ï¼Œä½†æ˜¯ä»ç„¶æ¯”åœ¨é“¾è¡¨ä¸­ç›´æ¥è¯»å†™å¥½ 1000 å€ã€‚</p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>Go è¯­è¨€è¿è¡Œæ—¶åŒæ—¶ä½¿ç”¨äº†å¤šä¸ªæ•°æ®ç»“æ„ç»„åˆè¡¨ç¤ºå“ˆå¸Œè¡¨ï¼Œå…¶ä¸­ä½¿ç”¨ <a href="https://github.com/golang/go/blob/ed15e82413c7b16e21a493f5a647f68b46e965ee/src/runtime/map.go#L115-L129"><code>hmap</code></a> ç»“æ„ä½“æ¥è¡¨ç¤ºå“ˆå¸Œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç»“æ„ä½“å†…éƒ¨çš„å­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">count     <span class="keyword">int</span></span><br><span class="line">flags     <span class="keyword">uint8</span></span><br><span class="line">B         <span class="keyword">uint8</span></span><br><span class="line">noverflow <span class="keyword">uint16</span></span><br><span class="line">hash0     <span class="keyword">uint32</span></span><br><span class="line"></span><br><span class="line">buckets    unsafe.Pointer</span><br><span class="line">oldbuckets unsafe.Pointer</span><br><span class="line">nevacuate  <span class="keyword">uintptr</span></span><br><span class="line"></span><br><span class="line">extra *mapextra</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>count</code> è¡¨ç¤ºå½“å‰å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ æ•°é‡ï¼›</li><li><code>B</code> è¡¨ç¤ºå½“å‰å“ˆå¸Œè¡¨æŒæœ‰çš„ <code>buckets</code> æ•°é‡ï¼Œä½†æ˜¯å› ä¸ºå“ˆå¸Œè¡¨ä¸­æ¡¶çš„æ•°é‡éƒ½ 2 çš„å€æ•°ï¼Œæ‰€ä»¥è¯¥å­—æ®µä¼šå­˜å‚¨å¯¹æ•°ï¼Œä¹Ÿå°±æ˜¯ <code>len(buckets) == 2^B</code>ï¼›</li><li><code>hash0</code> æ˜¯å“ˆå¸Œçš„ç§å­ï¼Œå®ƒèƒ½ä¸ºå“ˆå¸Œå‡½æ•°çš„ç»“æœå¼•å…¥éšæœºæ€§ï¼Œè¿™ä¸ªå€¼åœ¨åˆ›å»ºå“ˆå¸Œè¡¨æ—¶ç¡®å®šï¼Œå¹¶åœ¨è°ƒç”¨å“ˆå¸Œå‡½æ•°æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼›</li><li><code>oldbuckets</code> æ˜¯å“ˆå¸Œåœ¨æ‰©å®¹æ—¶ç”¨äºä¿å­˜ä¹‹å‰ <code>buckets</code> çš„å­—æ®µï¼Œå®ƒçš„å¤§å°æ˜¯å½“å‰ <code>buckets</code> çš„ä¸€åŠï¼›</li></ol><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2019-12-30-15777168478811-hmap-and-buckets.png" alt="hmap-and-buckets"></p><p><strong>å›¾ 3-12 å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„</strong></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºå“ˆå¸Œè¡¨ <code>hmap</code> çš„æ¡¶å°±æ˜¯ <code>bmap</code>ï¼Œæ¯ä¸€ä¸ª <code>bmap</code> éƒ½èƒ½å­˜å‚¨ 8 ä¸ªé”®å€¼å¯¹ï¼Œå½“å“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„æ•°æ®è¿‡å¤šï¼Œå•ä¸ªæ¡¶æ— æ³•è£…æ»¡æ—¶å°±ä¼šä½¿ç”¨ <code>extra.overflow</code> ä¸­æ¡¶å­˜å‚¨æº¢å‡ºçš„æ•°æ®ã€‚ä¸Šè¿°ä¸¤ç§ä¸åŒçš„æ¡¶åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå°†å®ƒä»¬åˆ†åˆ«ç§°ä¸ºæ­£å¸¸æ¡¶å’Œæº¢å‡ºæ¡¶ï¼Œä¸Šå›¾ä¸­é»„è‰²çš„ <code>bmap</code> å°±æ˜¯æ­£å¸¸æ¡¶ï¼Œç»¿è‰²çš„ <code>bmap</code> æ˜¯æº¢å‡ºæ¡¶ï¼Œæº¢å‡ºæ¡¶æ˜¯åœ¨ Go è¯­è¨€è¿˜ä½¿ç”¨ C è¯­è¨€å®ç°æ—¶å°±ä½¿ç”¨çš„è®¾è®¡ï¼Œç”±äºå®ƒèƒ½å¤Ÿå‡å°‘æ‰©å®¹çš„é¢‘ç‡æ‰€ä»¥ä¸€ç›´ä½¿ç”¨è‡³ä»Šã€‚</p><p>è¿™ä¸ªæ¡¶çš„ç»“æ„ä½“ <code>bmap</code> åœ¨ Go è¯­è¨€æºä»£ç ä¸­çš„å®šä¹‰åªåŒ…å«ä¸€ä¸ªç®€å•çš„ <code>tophash</code> å­—æ®µï¼Œ<code>tophash</code> å­˜å‚¨äº†é”®çš„å“ˆå¸Œçš„é«˜ 8 ä½ï¼Œé€šè¿‡æ¯”è¾ƒä¸åŒé”®çš„å“ˆå¸Œçš„é«˜ 8 ä½å¯ä»¥å‡å°‘è®¿é—®é”®å€¼å¯¹æ¬¡æ•°ä»¥æé«˜æ€§èƒ½ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line">tophash [bucketCnt]<span class="keyword">uint8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>bmap</code> ç»“æ„ä½“å…¶å®ä¸æ­¢åŒ…å« <code>tophash</code> å­—æ®µï¼Œç”±äºå“ˆå¸Œè¡¨ä¸­å¯èƒ½å­˜å‚¨ä¸åŒç±»å‹çš„é”®å€¼å¯¹å¹¶ä¸” Go è¯­è¨€ä¹Ÿä¸æ”¯æŒæ³›å‹ï¼Œæ‰€ä»¥é”®å€¼å¯¹å æ®çš„å†…å­˜ç©ºé—´å¤§å°åªèƒ½åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ¨å¯¼ï¼Œè¿™äº›å­—æ®µåœ¨è¿è¡Œæ—¶ä¹Ÿéƒ½æ˜¯é€šè¿‡è®¡ç®—å†…å­˜åœ°å€çš„æ–¹å¼ç›´æ¥è®¿é—®çš„ï¼Œæ‰€ä»¥å®ƒçš„å®šä¹‰ä¸­å°±æ²¡æœ‰åŒ…å«è¿™äº›å­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½æ ¹æ®ç¼–è¯‘æœŸé—´çš„ <a href="https://github.com/golang/go/blob/be64a19d99918c843f8555aad580221207ea35bc/src/cmd/compile/internal/gc/reflect.go#L82-L187"><code>cmd/compile/internal/gc.bmap</code></a> å‡½æ•°å¯¹å®ƒçš„ç»“æ„é‡å»ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line">    topbits  [<span class="number">8</span>]<span class="keyword">uint8</span></span><br><span class="line">    keys     [<span class="number">8</span>]keytype</span><br><span class="line">    values   [<span class="number">8</span>]valuetype</span><br><span class="line">    pad      <span class="keyword">uintptr</span></span><br><span class="line">    overflow <span class="keyword">uintptr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå“ˆå¸Œè¡¨å­˜å‚¨çš„æ•°æ®é€æ¸å¢å¤šï¼Œæˆ‘ä»¬ä¼šå¯¹å“ˆå¸Œè¡¨è¿›è¡Œæ‰©å®¹æˆ–è€…ä½¿ç”¨é¢å¤–çš„æ¡¶å­˜å‚¨æº¢å‡ºçš„æ•°æ®ï¼Œä¸ä¼šè®©å•ä¸ªæ¡¶ä¸­çš„æ•°æ®è¶…è¿‡ 8 ä¸ªï¼Œä¸è¿‡æº¢å‡ºæ¡¶åªæ˜¯ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆï¼Œåˆ›å»ºè¿‡å¤šçš„æº¢å‡ºæ¡¶æœ€ç»ˆä¹Ÿä¼šå¯¼è‡´å“ˆå¸Œçš„æ‰©å®¹ã€‚</p><p>ä» Go è¯­è¨€å“ˆå¸Œçš„å®šä¹‰ä¸­å°±å¯ä»¥å‘ç°ï¼Œå®ƒæ¯”å‰é¢ä¸¤èŠ‚æåˆ°çš„æ•°ç»„å’Œåˆ‡ç‰‡å¤æ‚å¾—å¤šï¼Œç»“æ„ä½“ä¸­ä¸ä»…åŒ…å«å¤§é‡å­—æ®µï¼Œè¿˜ä½¿ç”¨äº†è¾ƒå¤šçš„å¤æ‚ç»“æ„ï¼Œåœ¨åé¢çš„å°èŠ‚ä¸­æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»ä¸åŒå­—æ®µçš„ä½œç”¨ã€‚</p><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>æ—¢ç„¶å·²ç»ä»‹ç»äº†å¸¸è§å“ˆå¸Œè¡¨çš„åŸºæœ¬åŸç†å’Œå®ç°æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥å¼€å§‹åˆ†æ Go è¯­è¨€ä¸­å“ˆå¸Œè¡¨çš„å®ç°ï¼Œé¦–å…ˆè¦åˆ†æçš„å°±æ˜¯åœ¨ Go è¯­è¨€ä¸­åˆå§‹åŒ–å“ˆå¸Œçš„ä¸¤ç§æ–¹æ³• â€” é€šè¿‡å­—é¢é‡å’Œè¿è¡Œæ—¶ã€‚</p><h3 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h3><p>ç›®å‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€åŸºæœ¬éƒ½æ”¯æŒä½¿ç”¨å­—é¢é‡çš„æ–¹å¼åˆå§‹åŒ–å“ˆå¸Œï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ <code>key: value</code> çš„è¯­æ³•æ¥è¡¨ç¤ºé”®å€¼å¯¹ï¼ŒGo è¯­è¨€ä¸­ä¹Ÿä¸ä¾‹å¤–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hash := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="string">&quot;1&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;3&quot;</span>: <span class="number">4</span>,</span><br><span class="line"><span class="string">&quot;5&quot;</span>: <span class="number">6</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦åœ¨åˆå§‹åŒ–å“ˆå¸Œæ—¶å£°æ˜é”®å€¼å¯¹çš„ç±»å‹ï¼Œè¿™ç§ä½¿ç”¨å­—é¢é‡åˆå§‹åŒ–çš„æ–¹å¼æœ€ç»ˆéƒ½ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L768-L873"><code>cmd/compile/internal/gc.maplit</code></a> å‡½æ•°åˆå§‹åŒ–ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ <a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L768-L873"><code>cmd/compile/internal/gc.maplit</code></a> å‡½æ•°åˆå§‹åŒ–å“ˆå¸Œçš„è¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maplit</span><span class="params">(n *Node, m *Node, init *Nodes)</span></span> &#123;</span><br><span class="line">a := nod(OMAKE, <span class="literal">nil</span>, <span class="literal">nil</span>)</span><br><span class="line">a.Esc = n.Esc</span><br><span class="line">a.List.Set2(typenod(n.Type), nodintconst(<span class="keyword">int64</span>(n.List.Len())))</span><br><span class="line">litas(m, a, init)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stat, dyn []*Node</span><br><span class="line"><span class="keyword">for</span> _, r := <span class="keyword">range</span> n.List.Slice() &#123;</span><br><span class="line">stat = <span class="built_in">append</span>(stat, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(stat) &gt; <span class="number">25</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">addMapEntries(m, stat, init)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ æ•°é‡å°‘äºæˆ–è€…ç­‰äº 25 ä¸ªæ—¶ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥è°ƒç”¨ <code>addMapEntries</code> å°†å­—é¢é‡åˆå§‹åŒ–çš„ç»“æ„ä½“è½¬æ¢æˆä»¥ä¸‹çš„ä»£ç ï¼Œå°†æ‰€æœ‰çš„é”®å€¼å¯¹ä¸€æ¬¡åŠ å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hash := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">hash[<span class="string">&quot;1&quot;</span>] = <span class="number">2</span></span><br><span class="line">hash[<span class="string">&quot;3&quot;</span>] = <span class="number">4</span></span><br><span class="line">hash[<span class="string">&quot;5&quot;</span>] = <span class="number">6</span></span><br></pre></td></tr></table></figure><p>è¿™ç§åˆå§‹åŒ–çš„æ–¹å¼ä¸å‰é¢ä¸¤èŠ‚åˆ†æçš„<a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array/">æ•°ç»„</a>å’Œ<a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice/">åˆ‡ç‰‡</a>çš„å‡ ä¹å®Œå…¨ç›¸åŒï¼Œç”±æ­¤çœ‹æ¥é›†åˆç±»å‹çš„åˆå§‹åŒ–åœ¨ Go è¯­è¨€ä¸­æœ‰ç€ç›¸åŒçš„å¤„ç†æ–¹å¼å’Œé€»è¾‘ã€‚</p><p>ä¸€æ—¦å“ˆå¸Œè¡¨ä¸­å…ƒç´ çš„æ•°é‡è¶…è¿‡äº† 25 ä¸ªï¼Œå°±ä¼šåœ¨ç¼–è¯‘æœŸé—´åˆ›å»ºä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨é”®å’Œå€¼çš„ä¿¡æ¯ï¼Œè¿™äº›é”®å€¼å¯¹ä¼šé€šè¿‡ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„ for å¾ªç¯åŠ å…¥ç›®æ ‡çš„å“ˆå¸Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hash := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>, <span class="number">26</span>)</span><br><span class="line">vstatk := []<span class="keyword">string</span>&#123;<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, ... ï¼Œ <span class="string">&quot;26&quot;</span>&#125;</span><br><span class="line">vstatv := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, ... , <span class="number">26</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(vstak); i++ &#123;</span><br><span class="line">    hash[vstatk[i]] = vstatv[i]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå±•å¼€çš„ä¸¤ä¸ªåˆ‡ç‰‡ <code>vstatk</code> å’Œ <code>vstatv</code> è¿˜ä¼šè¢«ç¼–è¾‘å™¨ç»§ç»­å±•å¼€ï¼Œå…·ä½“çš„å±•å¼€æ–¹å¼å¯ä»¥é˜…è¯»ä¸Šä¸€èŠ‚äº†è§£<a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice/">åˆ‡ç‰‡çš„åˆå§‹åŒ–</a>ï¼Œä¸è¿‡æ— è®ºä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œä½¿ç”¨å­—é¢é‡åˆå§‹åŒ–çš„è¿‡ç¨‹éƒ½ä¼šä½¿ç”¨ Go è¯­è¨€ä¸­çš„å…³é”®å­— <code>make</code> æ¥åˆ›å»ºæ–°çš„å“ˆå¸Œå¹¶é€šè¿‡æœ€åŸå§‹çš„ <code>[]</code> è¯­æ³•å‘å“ˆå¸Œè¿½åŠ å…ƒç´ ã€‚</p><h3 id="è¿è¡Œæ—¶"><a href="#è¿è¡Œæ—¶" class="headerlink" title="è¿è¡Œæ—¶"></a>è¿è¡Œæ—¶</h3><p>æ— è®º <code>make</code> æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œåªè¦æˆ‘ä»¬ä½¿ç”¨ <code>make</code> åˆ›å»ºå“ˆå¸Œï¼ŒGo è¯­è¨€ç¼–è¯‘å™¨éƒ½ä¼šåœ¨<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-typecheck/">ç±»å‹æ£€æŸ¥</a>æœŸé—´å°†å®ƒä»¬è½¬æ¢æˆå¯¹ <a href="https://github.com/golang/go/blob/dcd3b2c173b77d93be1c391e3b5f932e0779fb1f/src/runtime/map.go#L303-L336"><code>runtime.makemap</code></a> çš„è°ƒç”¨ï¼Œä½¿ç”¨å­—é¢é‡æ¥åˆå§‹åŒ–å“ˆå¸Œä¹Ÿåªæ˜¯è¯­è¨€æä¾›çš„è¾…åŠ©å·¥å…·ï¼Œæœ€åè°ƒç”¨çš„éƒ½æ˜¯ <a href="https://github.com/golang/go/blob/dcd3b2c173b77d93be1c391e3b5f932e0779fb1f/src/runtime/map.go#L303-L336"><code>runtime.makemap</code></a>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makemap</span><span class="params">(t *maptype, hint <span class="keyword">int</span>, h *hmap)</span> *<span class="title">hmap</span></span> &#123;</span><br><span class="line">mem, overflow := math.MulUintptr(<span class="keyword">uintptr</span>(hint), t.bucket.size)</span><br><span class="line"><span class="keyword">if</span> overflow || mem &gt; maxAlloc &#123;</span><br><span class="line">hint = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> h == <span class="literal">nil</span> &#123;</span><br><span class="line">h = <span class="built_in">new</span>(hmap)</span><br><span class="line">&#125;</span><br><span class="line">h.hash0 = fastrand()</span><br><span class="line"></span><br><span class="line">B := <span class="keyword">uint8</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> overLoadFactor(hint, B) &#123;</span><br><span class="line">B++</span><br><span class="line">&#125;</span><br><span class="line">h.B = B</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> h.B != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">var</span> nextOverflow *bmap</span><br><span class="line">h.buckets, nextOverflow = makeBucketArray(t, h.B, <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> nextOverflow != <span class="literal">nil</span> &#123;</span><br><span class="line">h.extra = <span class="built_in">new</span>(mapextra)</span><br><span class="line">h.extra.nextOverflow = nextOverflow</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¼šåˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>è®¡ç®—å“ˆå¸Œå ç”¨çš„å†…å­˜æ˜¯å¦æº¢å‡ºæˆ–è€…è¶…å‡ºèƒ½åˆ†é…çš„æœ€å¤§å€¼ï¼›</li><li>è°ƒç”¨ <code>fastrand</code> è·å–ä¸€ä¸ªéšæœºçš„å“ˆå¸Œç§å­ï¼›</li><li>æ ¹æ®ä¼ å…¥çš„ <code>hint</code> è®¡ç®—å‡ºéœ€è¦çš„æœ€å°éœ€è¦çš„æ¡¶çš„æ•°é‡ï¼›</li><li>ä½¿ç”¨ <a href="https://github.com/golang/go/blob/dcd3b2c173b77d93be1c391e3b5f932e0779fb1f/src/runtime/map.go#L344-L387"><code>runtime.makeBucketArray</code></a> åˆ›å»ºç”¨äºä¿å­˜æ¡¶çš„æ•°ç»„ï¼›</li></ol><p><a href="https://github.com/golang/go/blob/dcd3b2c173b77d93be1c391e3b5f932e0779fb1f/src/runtime/map.go#L344-L387"><code>runtime.makeBucketArray</code></a> å‡½æ•°ä¼šæ ¹æ®ä¼ å…¥çš„ <code>B</code> è®¡ç®—å‡ºçš„éœ€è¦åˆ›å»ºçš„æ¡¶æ•°é‡åœ¨å†…å­˜ä¸­åˆ†é…ä¸€ç‰‡è¿ç»­çš„ç©ºé—´ç”¨äºå­˜å‚¨æ•°æ®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeBucketArray</span><span class="params">(t *maptype, b <span class="keyword">uint8</span>, dirtyalloc unsafe.Pointer)</span> <span class="params">(buckets unsafe.Pointer, nextOverflow *bmap)</span></span> &#123;</span><br><span class="line">base := bucketShift(b)</span><br><span class="line">nbuckets := base</span><br><span class="line"><span class="keyword">if</span> b &gt;= <span class="number">4</span> &#123;</span><br><span class="line">nbuckets += bucketShift(b - <span class="number">4</span>)</span><br><span class="line">sz := t.bucket.size * nbuckets</span><br><span class="line">up := roundupsize(sz)</span><br><span class="line"><span class="keyword">if</span> up != sz &#123;</span><br><span class="line">nbuckets = up / t.bucket.size</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buckets = newarray(t.bucket, <span class="keyword">int</span>(nbuckets))</span><br><span class="line"><span class="keyword">if</span> base != nbuckets &#123;</span><br><span class="line">nextOverflow = (*bmap)(add(buckets, base*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">last := (*bmap)(add(buckets, (nbuckets<span class="number">-1</span>)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">last.setoverflow(t, (*bmap)(buckets))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> buckets, nextOverflow</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ¡¶çš„æ•°é‡å°äº$2^4$ æ—¶ï¼Œç”±äºæ•°æ®è¾ƒå°‘ã€ä½¿ç”¨æº¢å‡ºæ¡¶çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¿™æ—¶å°±ä¼šçœç•¥åˆ›å»ºçš„è¿‡ç¨‹ä»¥å‡å°‘é¢å¤–å¼€é”€ï¼›å½“æ¡¶çš„æ•°é‡å¤šäº$2^4$æ—¶ï¼Œå°±ä¼šé¢å¤–åˆ›å»º$2^{B-4}$ä¸ªæº¢å‡ºæ¡¶ï¼Œæ ¹æ®ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬èƒ½ç¡®å®šåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ­£å¸¸æ¡¶å’Œæº¢å‡ºæ¡¶åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œåªæ˜¯è¢« <code>hmap</code> ä¸­çš„ä¸åŒå­—æ®µå¼•ç”¨ï¼Œå½“æº¢å‡ºæ¡¶æ•°é‡è¾ƒå¤šæ—¶ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/921ceadd2997f2c0267455e13f909df044234805/src/runtime/malloc.go#L1164"><code>runtime.newobject</code></a> åˆ›å»ºæ–°çš„æº¢å‡ºæ¡¶ã€‚</p><h2 id="è¯»å†™æ“ä½œ"><a href="#è¯»å†™æ“ä½œ" class="headerlink" title="è¯»å†™æ“ä½œ"></a>è¯»å†™æ“ä½œ</h2><p>å“ˆå¸Œè¡¨ä½œä¸ºä¸€ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦åˆ†æå®ƒçš„å¸¸è§æ“ä½œï¼Œé¦–å…ˆå°±éœ€è¦äº†è§£å…¶è¯»å†™æ“ä½œçš„å®ç°åŸç†ï¼Œè®¿é—®å“ˆå¸Œè¡¨ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ä¸‹æ ‡æˆ–è€…éå†ä¸¤ç§æ–¹å¼è¿›è¡Œçš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_ = hash[key]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> hash &#123;</span><br><span class="line">    <span class="comment">// k, v</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹å¼è™½ç„¶éƒ½èƒ½è¯»å–å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®ï¼Œä½†æ˜¯ä½¿ç”¨çš„å‡½æ•°å’Œåº•å±‚çš„åŸç†å®Œå…¨ä¸åŒï¼Œå‰è€…éœ€è¦çŸ¥é“å“ˆå¸Œçš„é”®å¹¶ä¸”ä¸€æ¬¡åªèƒ½è·å–å•ä¸ªé”®å¯¹åº”çš„å€¼ï¼Œè€Œåè€…å¯ä»¥éå†å“ˆå¸Œä¸­çš„å…¨éƒ¨é”®å€¼å¯¹ï¼Œè®¿é—®æ•°æ®æ—¶ä¹Ÿä¸éœ€è¦é¢„å…ˆçŸ¥é“å“ˆå¸Œçš„é”®ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼šä»‹ç»å‰ä¸€ç§è®¿é—®æ–¹å¼ï¼Œç¬¬äºŒç§è®¿é—®æ–¹å¼ä¼šåœ¨ <code>range</code> ä¸€èŠ‚ä¸­è¯¦ç»†åˆ†æã€‚</p><p>æ•°æ®ç»“æ„çš„å†™ä¸€èˆ¬æŒ‡çš„éƒ½æ˜¯å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹ï¼Œå¢åŠ å’Œä¿®æ”¹å­—æ®µéƒ½ä½¿ç”¨ç´¢å¼•å’Œèµ‹å€¼è¯­å¥ï¼Œè€Œåˆ é™¤å­—å…¸ä¸­çš„æ•°æ®éœ€è¦ä½¿ç”¨å…³é”®å­— <code>delete</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hash[key] = value</span><br><span class="line">hash[key] = newValue</span><br><span class="line"><span class="built_in">delete</span>(hash, key)</span><br></pre></td></tr></table></figure><p>é™¤äº†è¿™äº›æ“ä½œä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šåˆ†æå“ˆå¸Œçš„æ‰©å®¹è¿‡ç¨‹ï¼Œè¿™èƒ½å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£å“ˆå¸Œæ˜¯å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨çš„ã€‚</p><h3 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h3><p>åœ¨ç¼–è¯‘çš„<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-typecheck/">ç±»å‹æ£€æŸ¥</a>æœŸé—´ï¼Œ<code>hash[key]</code> ä»¥åŠç±»ä¼¼çš„æ“ä½œéƒ½ä¼šè¢«è½¬æ¢æˆå¯¹å“ˆå¸Œçš„ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L1089"><code>OINDEXMAP</code></a> æ“ä½œï¼Œ<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-ir-ssa/">ä¸­é—´ä»£ç ç”Ÿæˆ</a>é˜¶æ®µä¼šåœ¨ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L439-L1532"><code>cmd/compile/internal/gc.walkexpr</code></a> å‡½æ•°ä¸­å°†è¿™äº› <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L1089"><code>OINDEXMAP</code></a> æ“ä½œè½¬æ¢æˆå¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v     := hash[key] <span class="comment">// =&gt; v     := *mapaccess1(maptype, hash, &amp;key)</span></span><br><span class="line">v, ok := hash[key] <span class="comment">// =&gt; v, ok := mapaccess2(maptype, hash, &amp;key)</span></span><br></pre></td></tr></table></figure><p>èµ‹å€¼è¯­å¥å·¦ä¾§æ¥å—å‚æ•°çš„ä¸ªæ•°ä¼šå†³å®šä½¿ç”¨çš„è¿è¡Œæ—¶æ–¹æ³•ï¼š</p><ol><li>å½“æ¥å—å‚æ•°ä»…ä¸ºä¸€ä¸ªæ—¶ï¼Œä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L394-L450"><code>runtime.mapaccess1</code></a>ï¼Œè¯¥å‡½æ•°ä»…ä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘ç›®æ ‡å€¼çš„æŒ‡é’ˆï¼›</li><li>å½“æ¥å—ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L452-L508"><code>runtime.mapaccess2</code></a>ï¼Œé™¤äº†è¿”å›ç›®æ ‡å€¼ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šè¿”å›ä¸€ä¸ªç”¨äºè¡¨ç¤ºå½“å‰é”®å¯¹åº”çš„å€¼æ˜¯å¦å­˜åœ¨çš„å¸ƒå°”å€¼ï¼š</li></ol><p><a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L394-L450"><code>runtime.mapaccess1</code></a> å‡½æ•°ä¼šå…ˆé€šè¿‡å“ˆå¸Œè¡¨è®¾ç½®çš„å“ˆå¸Œå‡½æ•°ã€ç§å­è·å–å½“å‰é”®å¯¹åº”çš„å“ˆå¸Œï¼Œå†é€šè¿‡ <code>bucketMask</code> å’Œ <code>add</code> å‡½æ•°æ‹¿åˆ°è¯¥é”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶åºå·å’Œå“ˆå¸Œæœ€ä¸Šé¢çš„ 8 ä½æ•°å­—ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapaccess1</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">alg := t.key.alg</span><br><span class="line">hash := alg.hash(key, <span class="keyword">uintptr</span>(h.hash0))</span><br><span class="line">m := bucketMask(h.B)</span><br><span class="line">b := (*bmap)(add(h.buckets, (hash&amp;m)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">top := tophash(hash)</span><br><span class="line">bucketloop:</span><br><span class="line"><span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line"><span class="keyword">break</span> bucketloop</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">k := add(unsafe.Pointer(b), dataOffset+i*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line"><span class="keyword">if</span> alg.equal(key, k) &#123;</span><br><span class="line">v := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="keyword">uintptr</span>(t.keysize)+i*<span class="keyword">uintptr</span>(t.valuesize))</span><br><span class="line"><span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>bucketloop</code> å¾ªç¯ä¸­ï¼Œå“ˆå¸Œä¼šä¾æ¬¡éå†æ­£å¸¸æ¡¶å’Œæº¢å‡ºæ¡¶ä¸­çš„æ•°æ®ï¼Œå®ƒä¼šæ¯”è¾ƒè¿™ 8 ä½æ•°å­—å’Œæ¡¶ä¸­å­˜å‚¨çš„ <code>tophash</code>ï¼Œæ¯ä¸€ä¸ªæ¡¶éƒ½å­˜å‚¨é”®å¯¹åº”çš„ <code>tophash</code>ï¼Œæ¯ä¸€æ¬¡è¯»å†™æ“ä½œéƒ½ä¼šä¸æ¡¶ä¸­æ‰€æœ‰çš„ <code>tophash</code> è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºé€‰æ‹©æ¡¶åºå·çš„æ˜¯å“ˆå¸Œçš„æœ€ä½å‡ ä½ï¼Œè€Œç”¨äºåŠ é€Ÿè®¿é—®çš„æ˜¯å“ˆå¸Œçš„é«˜ 8 ä½ï¼Œè¿™ç§è®¾è®¡èƒ½å¤Ÿå‡å°‘åŒä¸€ä¸ªæ¡¶ä¸­æœ‰å¤§é‡ç›¸ç­‰ <code>tophash</code> çš„æ¦‚ç‡ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/ZHbqORLj6hmgN2K.png" alt="hashtable-mapaccess"></p><p><strong>å›¾ 3-13 è®¿é—®å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®</strong></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸€ä¸ªæ¡¶éƒ½æ˜¯ä¸€æ•´ç‰‡çš„å†…å­˜ç©ºé—´ï¼Œå½“å‘ç°æ¡¶ä¸­çš„ <code>tophash</code> ä¸ä¼ å…¥é”®çš„ <code>tophash</code> åŒ¹é…ä¹‹åï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æŒ‡é’ˆå’Œåç§»é‡è·å–å“ˆå¸Œä¸­å­˜å‚¨çš„é”® <code>keys[0]</code> å¹¶ä¸ <code>key</code> æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ç›¸åŒå°±ä¼šè·å–ç›®æ ‡å€¼çš„æŒ‡é’ˆ <code>values[0]</code> å¹¶è¿”å›ã€‚</p><p>å¦ä¸€ä¸ªåŒæ ·ç”¨äºè®¿é—®å“ˆå¸Œè¡¨ä¸­æ•°æ®çš„ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L452-L508"><code>runtime.mapaccess2</code></a> åªæ˜¯åœ¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L394-L450"><code>runtime.mapaccess1</code></a> çš„åŸºç¡€ä¸Šå¤šè¿”å›äº†ä¸€ä¸ªæ ‡è¯†é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨çš„å¸ƒå°”å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapaccess2</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="params">(unsafe.Pointer, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">bucketloop:</span><br><span class="line"><span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line"><span class="keyword">break</span> bucketloop</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">k := add(unsafe.Pointer(b), dataOffset+i*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line"><span class="keyword">if</span> alg.equal(key, k) &#123;</span><br><span class="line">v := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="keyword">uintptr</span>(t.keysize)+i*<span class="keyword">uintptr</span>(t.valuesize))</span><br><span class="line"><span class="keyword">return</span> v, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="number">0</span>]), <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>v, ok := hash[k]</code> çš„å½¢å¼è®¿é—®å“ˆå¸Œè¡¨ä¸­å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¿™ä¸ªå¸ƒå°”å€¼æ›´å‡†ç¡®åœ°çŸ¥é“å½“ <code>v == nil</code> æ—¶ï¼Œ<code>v</code> åˆ°åº•æ˜¯å“ˆå¸Œä¸­å­˜å‚¨çš„å…ƒç´ è¿˜æ˜¯è¡¨ç¤ºè¯¥é”®å¯¹åº”çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨è®¿é—®å“ˆå¸Œæ—¶ï¼Œæ›´æ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹å¼å…ˆåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚</p><p>ä¸Šé¢çš„è¿‡ç¨‹å…¶å®æ˜¯åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè®¿é—®å“ˆå¸Œè¡¨ä¸­å…ƒç´ æ—¶çš„è¡¨ç°ï¼Œç„¶è€Œä¸æ•°ç»„ä¸€æ ·ï¼Œå“ˆå¸Œè¡¨å¯èƒ½ä¼šåœ¨è£…è½½å› å­è¿‡é«˜æˆ–è€…æº¢å‡ºæ¡¶è¿‡å¤šæ—¶è¿›è¡Œæ‰©å®¹ï¼Œå“ˆå¸Œè¡¨çš„æ‰©å®¹å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­çš„è¿‡ç¨‹ï¼Œåœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­ä¿è¯å“ˆå¸Œçš„è®¿é—®æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„è¯é¢˜ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå…¶å®ä¹Ÿçœç•¥äº†ç›¸å…³çš„ä»£ç ï¼Œä¸è¿‡ä¼šåœ¨ä¸‹é¢å±•å¼€ä»‹ç»ã€‚</p><h3 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h3><p>å½“å½¢å¦‚ <code>hash[k]</code> çš„è¡¨è¾¾å¼å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å·¦ä¾§æ—¶ï¼Œè¯¥è¡¨è¾¾å¼ä¹Ÿä¼šåœ¨ç¼–è¯‘æœŸé—´è½¬æ¢æˆè°ƒç”¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L571-L683"><code>runtime.mapassign</code></a> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L394-L450"><code>runtime.mapaccess1</code></a> æ¯”è¾ƒç›¸ä¼¼ï¼Œæˆ‘ä»¬å°†è¯¥å…¶åˆ†æˆå‡ ä¸ªéƒ¨åˆ†åˆ†æï¼Œé¦–å…ˆæ˜¯å‡½æ•°ä¼šæ ¹æ®ä¼ å…¥çš„é”®æ‹¿åˆ°å¯¹åº”çš„å“ˆå¸Œå’Œæ¡¶ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapassign</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">alg := t.key.alg</span><br><span class="line">hash := alg.hash(key, <span class="keyword">uintptr</span>(h.hash0))</span><br><span class="line"></span><br><span class="line">h.flags ^= hashWriting</span><br><span class="line"></span><br><span class="line">again:</span><br><span class="line">bucket := hash &amp; bucketMask(h.B)</span><br><span class="line">b := (*bmap)(unsafe.Pointer(<span class="keyword">uintptr</span>(h.buckets) + bucket*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">top := tophash(hash)</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡éå†æ¯”è¾ƒæ¡¶ä¸­å­˜å‚¨çš„ <code>tophash</code> å’Œé”®çš„å“ˆå¸Œï¼Œå¦‚æœæ‰¾åˆ°äº†ç›¸åŒç»“æœå°±ä¼šè·å–ç›®æ ‡ä½ç½®çš„åœ°å€å¹¶è¿”å›ï¼Œå…¶ä¸­ <code>inserti</code> è¡¨ç¤ºç›®æ ‡å…ƒç´ çš„åœ¨æ¡¶ä¸­çš„ç´¢å¼•ï¼Œ<code>insertk</code> å’Œ <code>val</code> åˆ†åˆ«è¡¨ç¤ºé”®å€¼å¯¹çš„åœ°å€ï¼Œè·å¾—ç›®æ ‡åœ°å€ä¹‹åä¼šç›´æ¥é€šè¿‡ç®—æœ¯è®¡ç®—è¿›è¡Œå¯»å€è·å¾—é”®å€¼å¯¹ <code>k</code> å’Œ <code>val</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inserti *<span class="keyword">uint8</span></span><br><span class="line"><span class="keyword">var</span> insertk unsafe.Pointer</span><br><span class="line"><span class="keyword">var</span> val unsafe.Pointer</span><br><span class="line">bucketloop:</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line"><span class="keyword">if</span> isEmpty(b.tophash[i]) &amp;&amp; inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">inserti = &amp;b.tophash[i]</span><br><span class="line">insertk = add(unsafe.Pointer(b), dataOffset+i*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line">val = add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="keyword">uintptr</span>(t.keysize)+i*<span class="keyword">uintptr</span>(t.valuesize))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line"><span class="keyword">break</span> bucketloop</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">k := add(unsafe.Pointer(b), dataOffset+i*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line"><span class="keyword">if</span> !alg.equal(key, k) &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">val = add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="keyword">uintptr</span>(t.keysize)+i*<span class="keyword">uintptr</span>(t.valuesize))</span><br><span class="line"><span class="keyword">goto</span> done</span><br><span class="line">&#125;</span><br><span class="line">ovf := b.overflow(t)</span><br><span class="line"><span class="keyword">if</span> ovf == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">b = ovf</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°çš„ for å¾ªç¯ä¸­ä¼šä¾æ¬¡éå†æ­£å¸¸æ¡¶å’Œæº¢å‡ºæ¡¶ä¸­å­˜å‚¨çš„æ•°æ®ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šä¾æ¬¡åˆ¤æ–­ <code>tophash</code> æ˜¯å¦ç›¸ç­‰ã€<code>key</code> æ˜¯å¦ç›¸ç­‰ï¼Œéå†ç»“æŸåä¼šä»å¾ªç¯ä¸­è·³å‡ºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2019-12-30-15777168478823-hashtable-overflow-bucket.png" alt="hashtable-overflow-bucket"></p><p>å¦‚æœå½“å‰æ¡¶å·²ç»æ»¡äº†ï¼Œå“ˆå¸Œä¼šè°ƒç”¨ <code>newoverflow</code> å‡½æ•°åˆ›å»ºæ–°æ¡¶æˆ–è€…ä½¿ç”¨ <code>hmap</code> é¢„å…ˆåœ¨ <code>noverflow</code> ä¸­åˆ›å»ºå¥½çš„æ¡¶æ¥ä¿å­˜æ•°æ®ï¼Œæ–°åˆ›å»ºçš„æ¡¶ä¸ä»…ä¼šè¢«è¿½åŠ åˆ°å·²æœ‰æ¡¶çš„æœ«å°¾ï¼Œè¿˜ä¼šå¢åŠ å“ˆå¸Œè¡¨çš„ <code>noverflow</code> è®¡æ•°å™¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">newb := h.newoverflow(t, b)</span><br><span class="line">inserti = &amp;newb.tophash[<span class="number">0</span>]</span><br><span class="line">insertk = add(unsafe.Pointer(newb), dataOffset)</span><br><span class="line">val = add(insertk, bucketCnt*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">typedmemmove(t.key, insertk, key)</span><br><span class="line">*inserti = top</span><br><span class="line">h.count++</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line"><span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰é”®å€¼å¯¹åœ¨å“ˆå¸Œä¸­ä¸å­˜åœ¨ï¼Œå“ˆå¸Œä¸ºæ–°é”®å€¼å¯¹è§„åˆ’å­˜å‚¨çš„å†…å­˜åœ°å€ï¼Œé€šè¿‡ <code>typedmemmove</code> å°†é”®ç§»åŠ¨åˆ°å¯¹åº”çš„å†…å­˜ç©ºé—´ä¸­å¹¶è¿”å›é”®å¯¹åº”å€¼çš„åœ°å€ <code>val</code>ï¼Œå¦‚æœå½“å‰é”®å€¼å¯¹åœ¨å“ˆå¸Œä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿”å›ç›®æ ‡åŒºåŸŸçš„å†…å­˜åœ°å€ã€‚å“ˆå¸Œå¹¶ä¸ä¼šåœ¨ <code>mapassign</code> è¿™ä¸ªè¿è¡Œæ—¶å‡½æ•°ä¸­å°†å€¼æ‹·è´åˆ°æ¡¶ä¸­ï¼Œè¯¥å‡½æ•°åªä¼šè¿”å›å†…å­˜åœ°å€ï¼ŒçœŸæ­£çš„èµ‹å€¼æ“ä½œæ˜¯åœ¨ç¼–è¯‘æœŸé—´æ’å…¥çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00018</span> (+<span class="number">5</span>) CALL runtime.mapassign_fast64(SB)</span><br><span class="line"><span class="number">00020</span> (<span class="number">5</span>) MOVQ <span class="number">24</span>(SP), DI               ;; DI = &amp;value</span><br><span class="line"><span class="number">00026</span> (<span class="number">5</span>) LEAQ <span class="keyword">go</span>.<span class="keyword">string</span>.<span class="string">&quot;88&quot;</span>(SB), AX   ;; AX = &amp;<span class="string">&quot;88&quot;</span></span><br><span class="line"><span class="number">00027</span> (<span class="number">5</span>) MOVQ AX, (DI)                 ;; *DI = AX</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map_fast64.go#L92-L180"><code>runtime.mapassign_fast64</code></a> ä¸ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L571-L683"><code>runtime.mapassign</code></a> å‡½æ•°çš„å®ç°å·®ä¸å¤šï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯åé¢çš„ä¸‰è¡Œä»£ç ï¼Œ<code>24(SP)</code> å°±æ˜¯è¯¥å‡½æ•°è¿”å›çš„å€¼åœ°å€ï¼Œæˆ‘ä»¬é€šè¿‡ <code>LEAQ</code> æŒ‡ä»¤å°†å­—ç¬¦ä¸²çš„åœ°å€å­˜å‚¨åˆ°å¯„å­˜å™¨ <code>AX</code> ä¸­ï¼Œ<code>MOVQ</code> æŒ‡ä»¤å°†å­—ç¬¦ä¸² <code>&quot;88&quot;</code> å­˜å‚¨åˆ°äº†ç›®æ ‡åœ°å€ä¸Šå®Œæˆäº†è¿™æ¬¡å“ˆå¸Œçš„å†™å…¥ã€‚</p><h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><p>æˆ‘ä»¬åœ¨ä»‹ç»å“ˆå¸Œçš„å†™å…¥è¿‡ç¨‹æ—¶çœç•¥äº†æ‰©å®¹æ“ä½œï¼Œéšç€å“ˆå¸Œè¡¨ä¸­å…ƒç´ çš„é€æ¸å¢åŠ ï¼Œå“ˆå¸Œçš„æ€§èƒ½ä¼šé€æ¸æ¶åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´å¤šçš„æ¡¶å’Œæ›´å¤§çš„å†…å­˜ä¿è¯å“ˆå¸Œçš„è¯»å†™æ€§èƒ½ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapassign</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> !h.growing() &amp;&amp; (overLoadFactor(h.count+<span class="number">1</span>, h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) &#123;</span><br><span class="line">hashGrow(t, h)</span><br><span class="line"><span class="keyword">goto</span> again</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L571-L683"><code>runtime.mapassign</code></a> å‡½æ•°ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µå‘ç”Ÿæ—¶è§¦å‘å“ˆå¸Œçš„æ‰©å®¹ï¼š</p><ol><li>è£…è½½å› å­å·²ç»è¶…è¿‡ 6.5ï¼›</li><li>å“ˆå¸Œä½¿ç”¨äº†å¤ªå¤šæº¢å‡ºæ¡¶ï¼›</li></ol><p>ä¸è¿‡ç”±äº Go è¯­è¨€å“ˆå¸Œçš„æ‰©å®¹ä¸æ˜¯ä¸€ä¸ªåŸå­çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L571-L683"><code>runtime.mapassign</code></a> å‡½æ•°è¿˜éœ€è¦åˆ¤æ–­å½“å‰å“ˆå¸Œæ˜¯å¦å·²ç»å¤„äºæ‰©å®¹çŠ¶æ€ï¼Œé¿å…äºŒæ¬¡æ‰©å®¹é€ æˆæ··ä¹±ã€‚</p><p>æ ¹æ®è§¦å‘çš„æ¡ä»¶ä¸åŒæ‰©å®¹çš„æ–¹å¼åˆ†æˆä¸¤ç§ï¼Œå¦‚æœè¿™æ¬¡æ‰©å®¹æ˜¯æº¢å‡ºçš„æ¡¶å¤ªå¤šå¯¼è‡´çš„ï¼Œé‚£ä¹ˆè¿™æ¬¡æ‰©å®¹å°±æ˜¯ç­‰é‡æ‰©å®¹ <code>sameSizeGrow</code>ï¼Œ<code>sameSizeGrow</code> æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µä¸‹å‘ç”Ÿçš„æ‰©å®¹ï¼Œå½“æˆ‘ä»¬æŒç»­å‘å“ˆå¸Œä¸­æ’å…¥æ•°æ®å¹¶å°†å®ƒä»¬å…¨éƒ¨åˆ é™¤æ—¶ï¼Œå¦‚æœå“ˆå¸Œè¡¨ä¸­çš„æ•°æ®é‡æ²¡æœ‰è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¼šä¸æ–­ç§¯ç´¯æº¢å‡ºæ¡¶é€ æˆç¼“æ…¢çš„å†…å­˜æ³„æ¼ã€‚<a href="https://github.com/golang/go/commit/9980b70cb460f27907a003674ab1b9bea24a847c">runtime: limit the number of map overflow buckets</a> å¼•å…¥äº† <code>sameSizeGrow</code> é€šè¿‡é‡ç”¨å·²æœ‰çš„å“ˆå¸Œæ‰©å®¹æœºåˆ¶ï¼Œä¸€æ—¦å“ˆå¸Œä¸­å‡ºç°äº†è¿‡å¤šçš„æº¢å‡ºæ¡¶ï¼Œå®ƒå°±ä¼šåˆ›å»ºæ–°æ¡¶ä¿å­˜æ•°æ®ï¼Œåƒåœ¾å›æ”¶ä¼šæ¸…ç†è€çš„æº¢å‡ºæ¡¶å¹¶é‡Šæ”¾å†…å­˜ã€‚</p><p>æ‰©å®¹çš„å…¥å£æ˜¯ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1017-L1058"><code>runtime.hashGrow</code></a> å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hashGrow</span><span class="params">(t *maptype, h *hmap)</span></span> &#123;</span><br><span class="line">bigger := <span class="keyword">uint8</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> !overLoadFactor(h.count+<span class="number">1</span>, h.B) &#123;</span><br><span class="line">bigger = <span class="number">0</span></span><br><span class="line">h.flags |= sameSizeGrow</span><br><span class="line">&#125;</span><br><span class="line">oldbuckets := h.buckets</span><br><span class="line">newbuckets, nextOverflow := makeBucketArray(t, h.B+bigger, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">h.B += bigger</span><br><span class="line">h.flags = flags</span><br><span class="line">h.oldbuckets = oldbuckets</span><br><span class="line">h.buckets = newbuckets</span><br><span class="line">h.nevacuate = <span class="number">0</span></span><br><span class="line">h.noverflow = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">h.extra.oldoverflow = h.extra.overflow</span><br><span class="line">h.extra.overflow = <span class="literal">nil</span></span><br><span class="line">h.extra.nextOverflow = nextOverflow</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å“ˆå¸Œåœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/dcd3b2c173b77d93be1c391e3b5f932e0779fb1f/src/runtime/map.go#L344-L387"><code>runtime.makeBucketArray</code></a> åˆ›å»ºä¸€ç»„æ–°æ¡¶å’Œé¢„åˆ›å»ºçš„æº¢å‡ºæ¡¶ï¼Œéšåå°†åŸæœ‰çš„æ¡¶æ•°ç»„è®¾ç½®åˆ° <code>oldbuckets</code> ä¸Šå¹¶å°†æ–°çš„ç©ºæ¡¶è®¾ç½®åˆ° <code>buckets</code> ä¸Šï¼Œæº¢å‡ºæ¡¶ä¹Ÿä½¿ç”¨äº†ç›¸åŒçš„é€»è¾‘è¿›è¡Œæ›´æ–°ï¼Œä¸‹å›¾å±•ç¤ºäº†è§¦å‘æ‰©å®¹åçš„å“ˆå¸Œï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/OkjylzLq4FM57n3.png" alt="hashtable-hashgrow"></p><p>æˆ‘ä»¬åœ¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1017-L1058"><code>runtime.hashGrow</code></a> ä¸­è¿˜çœ‹ä¸å‡ºæ¥ç­‰é‡æ‰©å®¹å’Œç¿»å€æ‰©å®¹çš„å¤ªå¤šåŒºåˆ«ï¼Œç­‰é‡æ‰©å®¹åˆ›å»ºçš„æ–°æ¡¶æ•°é‡åªæ˜¯å’Œæ—§æ¡¶ä¸€æ ·ï¼Œè¯¥å‡½æ•°ä¸­åªæ˜¯åˆ›å»ºäº†æ–°çš„æ¡¶ï¼Œå¹¶æ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œæ‹·è´å’Œè½¬ç§»ï¼Œå“ˆå¸Œè¡¨çš„æ•°æ®è¿ç§»çš„è¿‡ç¨‹åœ¨æ˜¯ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1128-L1240"><code>runtime.evacuate</code></a> å‡½æ•°ä¸­å®Œæˆçš„ï¼Œå®ƒä¼šå¯¹ä¼ å…¥æ¡¶ä¸­çš„å…ƒç´ è¿›è¡Œã€å†åˆ†é…ã€ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evacuate</span><span class="params">(t *maptype, h *hmap, oldbucket <span class="keyword">uintptr</span>)</span></span> &#123;</span><br><span class="line">b := (*bmap)(add(h.oldbuckets, oldbucket*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">newbit := h.noldbuckets()</span><br><span class="line"><span class="keyword">if</span> !evacuated(b) &#123;</span><br><span class="line"><span class="keyword">var</span> xy [<span class="number">2</span>]evacDst</span><br><span class="line">x := &amp;xy[<span class="number">0</span>]</span><br><span class="line">x.b = (*bmap)(add(h.buckets, oldbucket*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">x.k = add(unsafe.Pointer(x.b), dataOffset)</span><br><span class="line">x.v = add(x.k, bucketCnt*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line"></span><br><span class="line">y := &amp;xy[<span class="number">1</span>]</span><br><span class="line">y.b = (*bmap)(add(h.buckets, (oldbucket+newbit)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">y.k = add(unsafe.Pointer(y.b), dataOffset)</span><br><span class="line">y.v = add(y.k, bucketCnt*<span class="keyword">uintptr</span>(t.keysize))</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1128-L1240"><code>runtime.evacuate</code></a> å‡½æ•°ä¼šå°†ä¸€ä¸ªæ—§æ¡¶ä¸­çš„æ•°æ®åˆ†æµåˆ°ä¸¤ä¸ªæ–°æ¡¶ï¼Œæ‰€ä»¥å®ƒä¼šåˆ›å»ºä¸¤ä¸ªç”¨äºä¿å­˜åˆ†é…ä¸Šä¸‹æ–‡çš„ <code>evacDst</code> ç»“æ„ä½“ï¼Œè¿™ä¸¤ä¸ªç»“æ„ä½“åˆ†åˆ«æŒ‡å‘äº†ä¸€ä¸ªæ–°æ¡¶ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/F1VxHTbfNpuQl4o.png" alt="hashtable-evacuate-destination"></p><p>å¦‚æœè¿™æ˜¯ä¸€ç­‰é‡æ‰©å®¹ï¼Œæ—§æ¡¶ä¸æ–°æ¡¶ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ‰€ä»¥ä¸¤ä¸ª <code>evacDst</code> ç»“æ„ä½“åªä¼šåˆå§‹åŒ–ä¸€ä¸ªï¼Œå½“å“ˆå¸Œè¡¨çš„å®¹é‡ç¿»å€æ—¶ï¼Œæ¯ä¸ªæ—§æ¡¶çš„å…ƒç´ ä¼šéƒ½è¢«åˆ†æµåˆ°æ–°åˆ›å»ºçš„ä¸¤ä¸ªæ¡¶ä¸­ï¼Œæˆ‘ä»¬ä»”ç»†åˆ†æä¸€ä¸‹åˆ†æµå…ƒç´ çš„é€»è¾‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line">k := add(unsafe.Pointer(b), dataOffset)</span><br><span class="line">v := add(k, bucketCnt*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; bucketCnt; i, k, v = i+<span class="number">1</span>, add(k, <span class="keyword">uintptr</span>(t.keysize)), add(v, <span class="keyword">uintptr</span>(t.valuesize)) &#123;</span><br><span class="line">top := b.tophash[i]</span><br><span class="line">k2 := k</span><br><span class="line"><span class="keyword">var</span> useY <span class="keyword">uint8</span></span><br><span class="line">hash := t.key.alg.hash(k2, <span class="keyword">uintptr</span>(h.hash0))</span><br><span class="line"><span class="keyword">if</span> hash&amp;newbit != <span class="number">0</span> &#123;</span><br><span class="line">useY = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">b.tophash[i] = evacuatedX + useY</span><br><span class="line">dst := &amp;xy[useY]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst.i == bucketCnt &#123;</span><br><span class="line">dst.b = h.newoverflow(t, dst.b)</span><br><span class="line">dst.i = <span class="number">0</span></span><br><span class="line">dst.k = add(unsafe.Pointer(dst.b), dataOffset)</span><br><span class="line">dst.v = add(dst.k, bucketCnt*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line">&#125;</span><br><span class="line">dst.b.tophash[dst.i&amp;(bucketCnt<span class="number">-1</span>)] = top</span><br><span class="line">typedmemmove(t.key, dst.k, k)</span><br><span class="line">typedmemmove(t.elem, dst.v, v)</span><br><span class="line">dst.i++</span><br><span class="line">dst.k = add(dst.k, <span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line">dst.v = add(dst.v, <span class="keyword">uintptr</span>(t.valuesize))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªä½¿ç”¨å“ˆå¸Œå‡½æ•°æ˜¯ä¸èƒ½å®šä½åˆ°å…·ä½“æŸä¸€ä¸ªæ¡¶çš„ï¼Œå“ˆå¸Œå‡½æ•°åªä¼šè¿”å›å¾ˆé•¿çš„å“ˆå¸Œï¼Œä¾‹å¦‚ï¼š<code>b72bfae3f3285244c4732ce457cca823bc189e0b</code>ï¼Œæˆ‘ä»¬è¿˜éœ€ä¸€äº›æ–¹æ³•å°†å“ˆå¸Œæ˜ å°„åˆ°å…·ä½“çš„æ¡¶ä¸Šï¼Œåœ¨å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨å–æ¨¡æˆ–è€…ä½æ“ä½œæ¥è·å–æ¡¶çš„ç¼–å·ï¼Œå‡å¦‚å½“å‰å“ˆå¸Œä¸­åŒ…å« 4 ä¸ªæ¡¶ï¼Œé‚£ä¹ˆå®ƒçš„æ¡¶æ©ç å°±æ˜¯ <code>0b11(3)</code>ï¼Œä½¿ç”¨ä½æ“ä½œå°±ä¼šå¾—åˆ° 3ï¼Œ æˆ‘ä»¬å°±ä¼šåœ¨ 3 å·æ¡¶ä¸­å­˜å‚¨è¯¥æ•°æ®ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xb72bfae3f3285244c4732ce457cca823bc189e0b</span> &amp; 0b11 <span class="comment">#=&gt; 0</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ–°çš„å“ˆå¸Œè¡¨æœ‰ 8 ä¸ªæ¡¶ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŸæ¥ç»è¿‡æ¡¶æ©ç  <code>0b11</code> ç»“æœä¸º 3 çš„æ•°æ®ä¼šå› ä¸ºæ¡¶æ©ç å¢åŠ äº†ä¸€ä½ç¼–ç¨‹ <code>0b111</code> è€Œåˆ†æµåˆ°æ–°çš„ 3 å·å’Œ 7 å·æ¡¶ï¼Œæ‰€æœ‰æ•°æ®ä¹Ÿéƒ½ä¼šè¢« <code>typedmemmove</code> æ‹·è´åˆ°ç›®æ ‡æ¡¶ä¸­ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/dWYKxN8PgSXV1fE.png" alt="hashtable-bucket-evacuate"></p><p><a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1128-L1240"><code>runtime.evacuate</code></a> æœ€åä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1242-L1264"><code>runtime.advanceEvacuationMark</code></a> å¢åŠ å“ˆå¸Œçš„ <code>nevacuate</code> è®¡æ•°å™¨ï¼Œåœ¨æ‰€æœ‰çš„æ—§æ¡¶éƒ½è¢«åˆ†æµåæ¸…ç©ºå“ˆå¸Œçš„ <code>oldbuckets</code> å’Œ <code>oldoverflow</code> å­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">advanceEvacuationMark</span><span class="params">(h *hmap, t *maptype, newbit <span class="keyword">uintptr</span>)</span></span> &#123;</span><br><span class="line">h.nevacuate++</span><br><span class="line">stop := h.nevacuate + <span class="number">1024</span></span><br><span class="line"><span class="keyword">if</span> stop &gt; newbit &#123;</span><br><span class="line">stop = newbit</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> h.nevacuate != stop &amp;&amp; bucketEvacuated(t, h, h.nevacuate) &#123;</span><br><span class="line">h.nevacuate++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> h.nevacuate == newbit &#123; <span class="comment">// newbit == # of oldbuckets</span></span><br><span class="line">h.oldbuckets = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">if</span> h.extra != <span class="literal">nil</span> &#123;</span><br><span class="line">h.extra.oldoverflow = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">h.flags &amp;^= sameSizeGrow</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰åœ¨åˆ†æå“ˆå¸Œè¡¨è®¿é—®å‡½æ•° <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L394-L450"><code>runtime.mapaccess1</code></a> æ—¶å…¶å®çœç•¥äº†æ‰©å®¹æœŸé—´è·å–é”®å€¼å¯¹çš„é€»è¾‘ï¼Œå½“å“ˆå¸Œè¡¨çš„ <code>oldbuckets</code> å­˜åœ¨æ—¶ï¼Œå°±ä¼šå…ˆå®šä½åˆ°æ—§æ¡¶å¹¶åœ¨è¯¥æ¡¶æ²¡æœ‰è¢«åˆ†æµæ—¶ä»ä¸­è·å–é”®å€¼å¯¹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapaccess1</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">alg := t.key.alg</span><br><span class="line">hash := alg.hash(key, <span class="keyword">uintptr</span>(h.hash0))</span><br><span class="line">m := bucketMask(h.B)</span><br><span class="line">b := (*bmap)(add(h.buckets, (hash&amp;m)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line"><span class="keyword">if</span> c := h.oldbuckets; c != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">m &gt;&gt;= <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">oldb := (*bmap)(add(c, (hash&amp;m)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line"><span class="keyword">if</span> !evacuated(oldb) &#123;</span><br><span class="line">b = oldb</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">bucketloop:</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ—§æ¡¶ä¸­è¿˜æ²¡æœ‰è¢« <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1128-L1240"><code>runtime.evacuate</code></a> å‡½æ•°åˆ†æµï¼Œå…¶ä¸­è¿˜ä¿å­˜ç€æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ•°æ®ï¼Œä¼šæ›¿ä»£æ–°åˆ›å»ºçš„ç©ºæ¡¶æä¾›æ•°æ®ã€‚</p><p>æˆ‘ä»¬åœ¨ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L571-L683"><code>runtime.mapassign</code></a> å‡½æ•°ä¸­ä¹Ÿçœç•¥äº†ä¸€æ®µé€»è¾‘ï¼Œå½“å“ˆå¸Œè¡¨æ­£åœ¨å¤„äºæ‰©å®¹çŠ¶æ€æ—¶ï¼Œæ¯æ¬¡å‘å“ˆå¸Œè¡¨å†™å…¥å€¼æ—¶éƒ½ä¼šè§¦å‘ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1104-L1113"><code>runtime.growWork</code></a> å¯¹å“ˆå¸Œè¡¨çš„å†…å®¹è¿›è¡Œå¢é‡æ‹·è´ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapassign</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">again:</span><br><span class="line">bucket := hash &amp; bucketMask(h.B)</span><br><span class="line"><span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">growWork(t, h, bucket)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶é™¤äº†å†™å…¥æ“ä½œä¹‹å¤–ï¼Œåˆ é™¤æ“ä½œä¹Ÿä¼šåœ¨å“ˆå¸Œè¡¨æ‰©å®¹æœŸé—´è§¦å‘ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1104-L1113"><code>runtime.growWork</code></a>ï¼Œè§¦å‘çš„æ–¹å¼å’Œä»£ç ä¸è¿™é‡Œçš„é€»è¾‘å‡ ä¹å®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è®¡ç®—å½“å‰å€¼æ‰€åœ¨çš„æ¡¶ï¼Œç„¶åå¯¹è¯¥æ¡¶ä¸­çš„å…ƒç´ è¿›è¡Œæ‹·è´ã€‚</p><p>æˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹å“ˆå¸Œè¡¨çš„æ‰©å®¹è®¾è®¡å’ŒåŸç†ï¼Œå“ˆå¸Œåœ¨å­˜å‚¨å…ƒç´ è¿‡å¤šæ—¶ä¼šè§¦å‘æ‰©å®¹æ“ä½œï¼Œæ¯æ¬¡éƒ½ä¼šå°†æ¡¶çš„æ•°é‡ç¿»å€ï¼Œæ•´ä¸ªæ‰©å®¹è¿‡ç¨‹å¹¶ä¸æ˜¯åŸå­çš„ï¼Œè€Œæ˜¯é€šè¿‡ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L1104-L1113"><code>runtime.growWork</code></a> å¢é‡è§¦å‘çš„ï¼Œåœ¨æ‰©å®¹æœŸé—´è®¿é—®å“ˆå¸Œè¡¨æ—¶ä¼šä½¿ç”¨æ—§æ¡¶ï¼Œå‘å“ˆå¸Œè¡¨å†™å…¥æ•°æ®æ—¶ä¼šè§¦å‘æ—§æ¡¶å…ƒç´ çš„åˆ†æµï¼›é™¤äº†è¿™ç§æ­£å¸¸çš„æ‰©å®¹ä¹‹å¤–ï¼Œä¸ºäº†è§£å†³å¤§é‡å†™å…¥ã€åˆ é™¤é€ æˆçš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå“ˆå¸Œå¼•å…¥äº† <code>sameSizeGrow</code> è¿™ä¸€æœºåˆ¶ï¼Œåœ¨å‡ºç°è¾ƒå¤šæº¢å‡ºæ¡¶æ—¶ä¼šå¯¹å“ˆå¸Œè¿›è¡Œã€å†…å­˜æ•´ç†ã€å‡å°‘å¯¹ç©ºé—´çš„å ç”¨ã€‚</p><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>å¦‚æœæƒ³è¦åˆ é™¤å“ˆå¸Œä¸­çš„å…ƒç´ ï¼Œå°±éœ€è¦ä½¿ç”¨ Go è¯­è¨€ä¸­çš„ <code>delete</code> å…³é”®å­—ï¼Œè¿™ä¸ªå…³é”®å­—çš„å”¯ä¸€ä½œç”¨å°±æ˜¯å°†æŸä¸€ä¸ªé”®å¯¹åº”çš„å…ƒç´ ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œæ— è®ºæ˜¯è¯¥é”®å¯¹åº”çš„å€¼æ˜¯å¦å­˜åœ¨ï¼Œè¿™ä¸ªå†…å»ºçš„å‡½æ•°éƒ½ä¸ä¼šè¿”å›ä»»ä½•çš„ç»“æœã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/j8GoTZ4Ob6cV5Aa.png" alt="hashtable-delete"></p><p>åœ¨ç¼–è¯‘æœŸé—´ï¼Œ<code>delete</code> å…³é”®å­—ä¼šè¢«è½¬æ¢æˆæ“ä½œä¸º <code>ODELETE</code> çš„èŠ‚ç‚¹ï¼Œè€Œ <code>ODELETE</code> ä¼šè¢« <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L439-L1532">cmd/compile/internal/gc.walkexpr</a> è½¬æ¢æˆ <code>mapdelete</code> å‡½æ•°ç°‡ä¸­çš„ä¸€ä¸ªï¼ŒåŒ…æ‹¬ <code>mapdelete</code>ã€<code>mapdelete_faststr</code>ã€<code>mapdelete_fast32</code> å’Œ <code>mapdelete_fast64</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walkexpr</span><span class="params">(n *Node, init *Nodes)</span> *<span class="title">Node</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line"><span class="keyword">case</span> ODELETE:</span><br><span class="line">init.AppendNodes(&amp;n.Ninit)</span><br><span class="line">map_ := n.List.First()</span><br><span class="line">key := n.List.Second()</span><br><span class="line">map_ = walkexpr(map_, init)</span><br><span class="line">key = walkexpr(key, init)</span><br><span class="line"></span><br><span class="line">t := map_.Type</span><br><span class="line">fast := mapfast(t)</span><br><span class="line"><span class="keyword">if</span> fast == mapslow &#123;</span><br><span class="line">key = nod(OADDR, key, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line">n = mkcall1(mapfndel(mapdelete[fast], t), <span class="literal">nil</span>, init, typename(t), map_, key)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›å‡½æ•°çš„å®ç°å…¶å®å·®ä¸å¤šï¼Œæˆ‘ä»¬æ¥åˆ†æå…¶ä¸­çš„ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L685-L791"><code>runtime.mapdelete</code></a> å‡½æ•°ï¼Œå“ˆå¸Œè¡¨çš„åˆ é™¤é€»è¾‘ä¸å†™å…¥é€»è¾‘éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯è§¦å‘å“ˆå¸Œçš„åˆ é™¤éœ€è¦ä½¿ç”¨å…³é”®å­—ï¼Œå¦‚æœåœ¨åˆ é™¤æœŸé—´é‡åˆ°äº†å“ˆå¸Œè¡¨çš„æ‰©å®¹ï¼Œå°±ä¼šå¯¹å³å°†æ“ä½œçš„æ¡¶è¿›è¡Œåˆ†æµï¼Œåˆ†æµç»“æŸä¹‹åä¼šæ‰¾åˆ°æ¡¶ä¸­çš„ç›®æ ‡å…ƒç´ å®Œæˆé”®å€¼å¯¹çš„åˆ é™¤å·¥ä½œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapdelete</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">growWork(t, h, bucket)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">search:</span><br><span class="line"><span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line"><span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line"><span class="keyword">break</span> search</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">k := add(unsafe.Pointer(b), dataOffset+i*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line">k2 := k</span><br><span class="line"><span class="keyword">if</span> !alg.equal(key, k2) &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">*(*unsafe.Pointer)(k) = <span class="literal">nil</span></span><br><span class="line">v := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="keyword">uintptr</span>(t.keysize)+i*<span class="keyword">uintptr</span>(t.valuesize))</span><br><span class="line">*(*unsafe.Pointer)(v) = <span class="literal">nil</span></span><br><span class="line">b.tophash[i] = emptyOne</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…¶å®åªéœ€è¦çŸ¥é“ <code>delete</code> å…³é”®å­—åœ¨ç¼–è¯‘æœŸé—´ç»è¿‡<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-typecheck/">ç±»å‹æ£€æŸ¥</a>å’Œ<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-ir-ssa/">ä¸­é—´ä»£ç ç”Ÿæˆ</a>é˜¶æ®µè¢«è½¬æ¢æˆ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L685-L791"><code>runtime.mapdelete</code></a> å‡½æ•°ç°‡ä¸­çš„ä¸€å‘˜å°±å¯ä»¥ï¼Œç”¨äºå¤„ç†åˆ é™¤é€»è¾‘çš„å‡½æ•°ä¸å“ˆå¸Œè¡¨çš„ <a href="https://github.com/golang/go/blob/36f30ba289e31df033d100b2adb4eaf557f05a34/src/runtime/map.go#L571-L683"><code>runtime.mapassign</code></a> å‡ ä¹å®Œå…¨ç›¸åŒï¼Œä¸å¤ªéœ€è¦åˆ»æ„å…³æ³¨ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Go è¯­è¨€ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³å“ˆå¸Œç¢°æ’çš„é—®é¢˜å®ç°äº†å“ˆå¸Œè¡¨ï¼Œå®ƒçš„è®¿é—®ã€å†™å…¥å’Œåˆ é™¤ç­‰æ“ä½œéƒ½åœ¨ç¼–è¯‘æœŸé—´è½¬æ¢æˆäº†è¿è¡Œæ—¶çš„å‡½æ•°æˆ–è€…æ–¹æ³•ã€‚</p><p>å“ˆå¸Œåœ¨æ¯ä¸€ä¸ªæ¡¶ä¸­å­˜å‚¨é”®å¯¹åº”å“ˆå¸Œçš„å‰ 8 ä½ï¼Œå½“å¯¹å“ˆå¸Œè¿›è¡Œæ“ä½œæ—¶ï¼Œè¿™äº› <code>tophash</code> å°±æˆä¸ºäº†ä¸€çº§ç¼“å­˜å¸®åŠ©å“ˆå¸Œå¿«é€Ÿéå†æ¡¶ä¸­å…ƒç´ ï¼Œæ¯ä¸€ä¸ªæ¡¶éƒ½åªèƒ½å­˜å‚¨ 8 ä¸ªé”®å€¼å¯¹ï¼Œä¸€æ—¦å½“å‰å“ˆå¸Œçš„æŸä¸ªæ¡¶è¶…å‡º 8 ä¸ªï¼Œæ–°çš„é”®å€¼å¯¹å°±ä¼šè¢«å­˜å‚¨åˆ°å“ˆå¸Œçš„æº¢å‡ºæ¡¶ä¸­ã€‚</p><p>éšç€é”®å€¼å¯¹æ•°é‡çš„å¢åŠ ï¼Œæº¢å‡ºæ¡¶çš„æ•°é‡å’Œå“ˆå¸Œçš„è£…è½½å› å­ä¹Ÿä¼šé€æ¸å‡é«˜ï¼Œè¶…è¿‡ä¸€å®šèŒƒå›´å°±ä¼šè§¦å‘æ‰©å®¹ï¼Œæ‰©å®¹ä¼šå°†æ¡¶çš„æ•°é‡ç¿»å€ï¼Œå…ƒç´ å†åˆ†é…çš„è¿‡ç¨‹ä¹Ÿæ˜¯åœ¨è°ƒç”¨å†™æ“ä½œæ—¶å¢é‡è¿›è¡Œçš„ï¼Œä¸ä¼šé€ æˆæ€§èƒ½çš„ç¬æ—¶å·¨å¤§æŠ–åŠ¨ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/#fnref:5">Separate Chaining: Concept, Advantages &amp; Disadvantages</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„æ¥å£</title>
      <link href="/2020/01/11/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E6%8E%A5%E5%8F%A3/"/>
      <url>/2020/01/11/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<p>Go è¯­è¨€ä¸­çš„æ¥å£å°±æ˜¯ä¸€ç»„æ–¹æ³•çš„ç­¾åï¼Œå®ƒæ˜¯ Go è¯­è¨€çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä½¿ç”¨æ¥å£èƒ½å¤Ÿè®©æˆ‘ä»¬æ›´å¥½åœ°ç»„ç»‡å¹¶å†™å‡ºæ˜“äºæµ‹è¯•çš„ä»£ç ï¼Œç„¶è€Œå¾ˆå¤šå·¥ç¨‹å¸ˆå¯¹ Go çš„æ¥å£äº†è§£éƒ½éå¸¸æœ‰é™ï¼Œä¹Ÿä¸æ¸…æ¥šå…¶åº•å±‚çš„å®ç°åŸç†ï¼Œè¿™æˆä¸ºäº†å¼€å‘é«˜æ€§èƒ½æœåŠ¡çš„æœ€å¤§é˜»ç¢ã€‚</p><p>æœ¬èŠ‚ä¼šä»‹ç»ä½¿ç”¨æ¥å£æ—¶é‡åˆ°çš„ä¸€äº›å¸¸è§é—®é¢˜ä»¥åŠå®ƒçš„è®¾è®¡ä¸å®ç°ï¼ŒåŒ…æ‹¬æ¥å£çš„ç±»å‹è½¬æ¢ã€ç±»å‹æ–­è¨€ä»¥åŠåŠ¨æ€æ´¾å‘æœºåˆ¶ï¼Œå¸®åŠ©å„ä½è¯»è€…æ›´å¥½åœ°ç†è§£æ¥å£ç±»å‹ã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæ¥å£æ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­å¤šä¸ªç»„ä»¶å…±äº«çš„è¾¹ç•Œï¼Œä¸åŒçš„ç»„ä»¶èƒ½å¤Ÿåœ¨è¾¹ç•Œä¸Šäº¤æ¢ä¿¡æ¯ã€‚æ¥å£çš„æœ¬è´¨å°±æ˜¯å¼•å…¥ä¸€ä¸ªæ–°çš„ä¸­é—´å±‚ï¼Œè°ƒç”¨æ–¹å¯ä»¥é€šè¿‡æ¥å£ä¸å…·ä½“å®ç°åˆ†ç¦»ï¼Œè§£é™¤ä¸Šä¸‹æ¸¸çš„è€¦åˆï¼Œä¸Šå±‚çš„æ¨¡å—ä¸å†éœ€è¦ä¾èµ–ä¸‹å±‚çš„å…·ä½“æ¨¡å—ï¼Œåªéœ€è¦ä¾èµ–ä¸€ä¸ªçº¦å®šå¥½çš„æ¥å£ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/3T9UIE5lVObWHPA.png" alt="golang-interface"></p><p>è¿™ç§é¢å‘æ¥å£çš„ç¼–ç¨‹æ–¹å¼æœ‰ç€éå¸¸å¼ºå¤§çš„ç”Ÿå‘½åŠ›ï¼Œæ— è®ºæ˜¯åœ¨æ¡†æ¶è¿˜æ˜¯æ“ä½œç³»ç»Ÿä¸­æˆ‘ä»¬éƒ½èƒ½å¤Ÿæ‰¾åˆ°æ¥å£çš„èº«å½±ã€‚å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆPortable Operating System Interfaceï¼ŒPOSIX)å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå®ƒå®šä¹‰äº†åº”ç”¨ç¨‹åºæ¥å£å’Œå‘½ä»¤è¡Œç­‰æ ‡å‡†ï¼Œä¸ºè®¡ç®—æœºè½¯ä»¶å¸¦æ¥äº†å¯ç§»æ¤æ€§ â€” åªè¦æ“ä½œç³»ç»Ÿå®ç°äº† POSIXï¼Œè®¡ç®—æœºè½¯ä»¶å°±å¯ä»¥ç›´æ¥åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚</p><p>é™¤äº†è§£è€¦æœ‰ä¾èµ–å…³ç³»çš„ä¸Šä¸‹æ¸¸ï¼Œæ¥å£è¿˜èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬éšè—åº•å±‚å®ç°ï¼Œå‡å°‘å…³æ³¨ç‚¹ã€‚ã€ŠSICPã€‹ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p><blockquote><p>ä»£ç å¿…é¡»èƒ½å¤Ÿè¢«äººé˜…è¯»ï¼Œåªæ˜¯æœºå™¨æ°å¥½å¯ä»¥æ‰§è¡Œã€‚</p></blockquote><p>äººèƒ½å¤ŸåŒæ—¶å¤„ç†çš„ä¿¡æ¯éå¸¸æœ‰é™ï¼Œå®šä¹‰è‰¯å¥½çš„æ¥å£èƒ½å¤Ÿéš”ç¦»åº•å±‚çš„å®ç°ï¼Œè®©æˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨å½“å‰çš„ä»£ç ç‰‡æ®µä¸­ã€‚SQL å°±æ˜¯æ¥å£çš„ä¸€ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ SQL è¯­å¥æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå…¶å®ä¸éœ€è¦å…³å¿ƒåº•å±‚æ•°æ®åº“çš„å…·ä½“å®ç°ï¼Œæˆ‘ä»¬åªåœ¨ä¹ SQL è¿”å›çš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/m4MfiP7ypZVzA1n.png" alt="sql-and-databases"></p><p>è®¡ç®—æœºç§‘å­¦ä¸­çš„æ¥å£æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œä½†æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­æ¥å£çš„æ¦‚å¿µå°±æ›´åŠ å…·ä½“ã€‚Go è¯­è¨€ä¸­çš„æ¥å£æ˜¯ä¸€ç§å†…ç½®çš„ç±»å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„æ–¹æ³•çš„ç­¾åï¼Œè¿™ä¸€å°èŠ‚ä¼šå…ˆä»‹ç» Go è¯­è¨€æ¥å£çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µä»¥åŠå¸¸è§é—®é¢˜ï¼Œä¸ºä¹‹åä»‹ç»å®ç°åŸç†åšä¸€äº›é“ºå«ã€‚</p><h3 id="éšå¼æ¥å£"><a href="#éšå¼æ¥å£" class="headerlink" title="éšå¼æ¥å£"></a>éšå¼æ¥å£</h3><p>å¾ˆå¤šé¢å‘å¯¹è±¡è¯­è¨€éƒ½æœ‰æ¥å£è¿™ä¸€æ¦‚å¿µï¼Œä¾‹å¦‚ Java å’Œ C#ã€‚Java çš„æ¥å£ä¸ä»…å¯ä»¥å®šä¹‰æ–¹æ³•ç­¾åï¼Œè¿˜å¯ä»¥å®šä¹‰å˜é‡ï¼Œè¿™äº›å®šä¹‰çš„å˜é‡å¯ä»¥ç›´æ¥åœ¨å®ç°æ¥å£çš„ç±»ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String hello = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å®šä¹‰äº†ä¸€ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³• <code>sayHello</code> å’Œä¸€ä¸ªä¼šæ³¨å…¥åˆ°å®ç°ç±»çš„å˜é‡ <code>hello</code>ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ<code>MyInterfaceImpl</code> å°±å®ç°äº† <code>MyInterface</code> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterfaceImpl</span> <span class="keyword">implements</span> <span class="title">MyInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(MyInterface.hello);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Java ä¸­çš„ç±»å¿…é¡»é€šè¿‡ä¸Šè¿°æ–¹å¼æ˜¾å¼åœ°å£°æ˜å®ç°çš„æ¥å£ï¼Œä½†æ˜¯åœ¨ Go è¯­è¨€ä¸­å®ç°æ¥å£å°±ä¸éœ€è¦ä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹åœ¨ Go è¯­è¨€ä¸­å¦‚ä½•å®šä¹‰æ¥å£ã€‚å®šä¹‰æ¥å£éœ€è¦ä½¿ç”¨ <code>interface</code> å…³é”®å­—ï¼Œåœ¨æ¥å£ä¸­æˆ‘ä»¬åªèƒ½å®šä¹‰æ–¹æ³•ç­¾åï¼Œä¸èƒ½åŒ…å«æˆå‘˜å˜é‡ï¼Œä¸€ä¸ªå¸¸è§çš„ Go è¯­è¨€æ¥å£æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªç±»å‹éœ€è¦å®ç° <code>error</code> æ¥å£ï¼Œé‚£ä¹ˆå®ƒåªéœ€è¦å®ç° <code>Error() string</code> æ–¹æ³•ï¼Œä¸‹é¢çš„ <code>RPCError</code> ç»“æ„ä½“å°±æ˜¯ <code>error</code> æ¥å£çš„ä¸€ä¸ªå®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RPCError <span class="keyword">struct</span> &#123;</span><br><span class="line">Code    <span class="keyword">int64</span></span><br><span class="line">Message <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *RPCError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%s, code=%d&quot;</span>, e.Message, e.Code)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°ä¸Šè¿°ä»£ç æ ¹æœ¬å°±æ²¡æœ‰ <code>error</code> æ¥å£çš„å½±å­ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸGo è¯­è¨€ä¸­<strong>æ¥å£çš„å®ç°éƒ½æ˜¯éšå¼çš„</strong>ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç° <code>Error() string</code> æ–¹æ³•å®ç°äº† <code>error</code> æ¥å£ã€‚Go è¯­è¨€å®ç°æ¥å£çš„æ–¹å¼ä¸ Java å®Œå…¨ä¸åŒï¼š</p><ul><li>åœ¨ Java ä¸­ï¼šå®ç°æ¥å£éœ€è¦æ˜¾å¼çš„å£°æ˜æ¥å£å¹¶å®ç°æ‰€æœ‰æ–¹æ³•ï¼›</li><li>åœ¨ Go ä¸­ï¼šå®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•å°±éšå¼çš„å®ç°äº†æ¥å£ï¼›</li></ul><p>æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿° <code>RPCError</code> ç»“æ„ä½“æ—¶å¹¶ä¸å…³å¿ƒå®ƒå®ç°äº†å“ªäº›æ¥å£ï¼ŒGo è¯­è¨€åªä¼šåœ¨ä¼ é€’å‚æ•°ã€è¿”å›å‚æ•°ä»¥åŠå˜é‡èµ‹å€¼æ—¶æ‰ä¼šå¯¹æŸä¸ªç±»å‹æ˜¯å¦å®ç°æ¥å£è¿›è¡Œæ£€æŸ¥ï¼Œè¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­æ¥æ¼”ç¤ºå‘ç”Ÿæ¥å£ç±»å‹æ£€æŸ¥çš„æ—¶æœºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> rpcErr error = NewRPCError(<span class="number">400</span>, <span class="string">&quot;unknown err&quot;</span>) <span class="comment">// typecheck1</span></span><br><span class="line">err := AsErr(rpcErr) <span class="comment">// typecheck2</span></span><br><span class="line"><span class="built_in">println</span>(err) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRPCError</span><span class="params">(code <span class="keyword">int64</span>, msg <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;RPCError&#123; <span class="comment">// typecheck3</span></span><br><span class="line">Code:    code,</span><br><span class="line">Message: msg,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AsErr</span><span class="params">(err error)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Go è¯­è¨€ä¼š<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/">ç¼–è¯‘æœŸé—´</a>å¯¹ä»£ç è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œä¸Šè¿°ä»£ç æ€»å…±è§¦å‘äº†ä¸‰æ¬¡ç±»å‹æ£€æŸ¥ï¼š</p><ol><li>å°† <code>*RPCError</code> ç±»å‹çš„å˜é‡èµ‹å€¼ç»™ <code>error</code> ç±»å‹çš„å˜é‡ <code>rpcErr</code>ï¼›</li><li>å°† <code>*RPCError</code> ç±»å‹çš„å˜é‡ <code>rpcErr</code> ä¼ é€’ç»™ç­¾åä¸­å‚æ•°ç±»å‹ä¸º <code>error</code> çš„ <code>AsErr</code> å‡½æ•°ï¼›</li><li>å°† <code>*RPCError</code> ç±»å‹çš„å˜é‡ä»å‡½æ•°ç­¾åçš„è¿”å›å€¼ç±»å‹ä¸º <code>error</code> çš„ <code>NewRPCError</code> å‡½æ•°ä¸­è¿”å›ï¼›</li></ol><p>ä»ç±»å‹æ£€æŸ¥çš„è¿‡ç¨‹æ¥çœ‹ï¼Œç¼–è¯‘å™¨ä»…åœ¨éœ€è¦æ—¶æ‰å¯¹ç±»å‹è¿›è¡Œæ£€æŸ¥ï¼Œç±»å‹å®ç°æ¥å£æ—¶åªéœ€è¦å®ç°æ¥å£ä¸­çš„å…¨éƒ¨æ–¹æ³•ï¼Œä¸éœ€è¦åƒ Java ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ä¸€æ ·æ˜¾å¼å£°æ˜ã€‚</p><h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><p>æ¥å£ä¹Ÿæ˜¯ Go è¯­è¨€ä¸­çš„ä¸€ç§ç±»å‹ï¼Œå®ƒèƒ½å¤Ÿå‡ºç°åœ¨å˜é‡çš„å®šä¹‰ã€å‡½æ•°çš„å…¥å‚å’Œè¿”å›å€¼ä¸­å¹¶å¯¹å®ƒä»¬è¿›è¡Œçº¦æŸï¼Œä¸è¿‡ Go è¯­è¨€ä¸­æœ‰ä¸¤ç§ç•¥å¾®ä¸åŒçš„æ¥å£ï¼Œä¸€ç§æ˜¯å¸¦æœ‰ä¸€ç»„æ–¹æ³•çš„æ¥å£ï¼Œå¦ä¸€ç§æ˜¯ä¸å¸¦ä»»ä½•æ–¹æ³•çš„ <code>interface&#123;&#125;</code>ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/9myUgL3BKMN4hnw.png" alt="golang-different-interface"></p><p>Go è¯­è¨€ä½¿ç”¨ <code>iface</code> ç»“æ„ä½“è¡¨ç¤ºç¬¬ä¸€ç§æ¥å£ï¼Œä½¿ç”¨ <code>eface</code> ç»“æ„ä½“è¡¨ç¤ºç¬¬äºŒç§ç©ºæ¥å£ï¼Œä¸¤ç§æ¥å£è™½ç„¶éƒ½ä½¿ç”¨ <code>interface</code> å£°æ˜ï¼Œä½†æ˜¯ç”±äºåè€…åœ¨ Go è¯­è¨€ä¸­éå¸¸å¸¸è§ï¼Œæ‰€ä»¥åœ¨å®ç°æ—¶ä½¿ç”¨äº†ç‰¹æ®Šçš„ç±»å‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ C è¯­è¨€ä¸­çš„ <code>void *</code> ä¸åŒï¼Œ<code>interface&#123;&#125;</code> ç±»å‹<strong>ä¸æ˜¯ä»»æ„ç±»å‹</strong>ï¼Œå¦‚æœæˆ‘ä»¬å°†ç±»å‹è½¬æ¢æˆäº† <code>interface&#123;&#125;</code> ç±»å‹ï¼Œè¿™è¾¹å˜é‡åœ¨è¿è¡ŒæœŸé—´çš„ç±»å‹ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œè·å–å˜é‡ç±»å‹æ—¶å°±ä¼šå¾—åˆ° <code>interface&#123;&#125;</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">type</span> Test <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">v := Test&#123;&#125;</span><br><span class="line">Print(v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Print</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"><span class="built_in">println</span>(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°ä¸æ¥å—ä»»æ„ç±»å‹çš„å‚æ•°ï¼Œåªæ¥å— <code>interface&#123;&#125;</code> ç±»å‹çš„å€¼ï¼Œåœ¨è°ƒç”¨ <code>Print</code> å‡½æ•°æ—¶ä¼šå¯¹å‚æ•° <code>v</code> è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå°†åŸæ¥çš„ <code>Test</code> ç±»å‹è½¬æ¢æˆ <code>interface&#123;&#125;</code> ç±»å‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æœ¬èŠ‚åé¢ä»‹ç»ç±»å‹è½¬æ¢çš„è¿‡ç¨‹å’ŒåŸç†ã€‚</p><h3 id="æŒ‡é’ˆå’Œæ¥å£"><a href="#æŒ‡é’ˆå’Œæ¥å£" class="headerlink" title="æŒ‡é’ˆå’Œæ¥å£"></a>æŒ‡é’ˆå’Œæ¥å£</h3><p>åœ¨ Go è¯­è¨€ä¸­åŒæ—¶ä½¿ç”¨æŒ‡é’ˆå’Œæ¥å£æ—¶ä¼šå‘ç”Ÿä¸€äº›è®©äººå›°æƒ‘çš„é—®é¢˜ï¼Œæ¥å£åœ¨å®šä¹‰ä¸€ç»„æ–¹æ³•æ—¶æ²¡æœ‰å¯¹å®ç°çš„æ¥æ”¶è€…åšé™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šçœ‹åˆ°ã€ä¸€ä¸ªç±»å‹ã€å®ç°æ¥å£çš„ä¸¤ç§æ–¹å¼ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/5PDUBJtxu28VZlO.png" alt="golang-interface-and-pointer"></p><p>è¿™æ˜¯å› ä¸ºç»“æ„ä½“ç±»å‹å’ŒæŒ‡é’ˆç±»å‹æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå°±åƒæˆ‘ä»¬ä¸èƒ½å‘ä¸€ä¸ªæ¥å—æŒ‡é’ˆçš„å‡½æ•°ä¼ é€’ç»“æ„ä½“ï¼Œåœ¨å®ç°æ¥å£æ—¶è¿™ä¸¤ç§ç±»å‹ä¹Ÿä¸èƒ½åˆ’ç­‰å·ã€‚ä½†æ˜¯ä¸Šå›¾ä¸­çš„ä¸¤ç§å®ç°ä¸å¯ä»¥åŒæ—¶å­˜åœ¨ï¼ŒGo è¯­è¨€çš„ç¼–è¯‘å™¨ä¼šåœ¨ç»“æ„ä½“ç±»å‹å’ŒæŒ‡é’ˆç±»å‹éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•æ—¶æŠ¥é”™ â€”â€” <code>method redeclared</code>ã€‚</p><p>å¯¹ <code>Cat</code> ç»“æ„ä½“æ¥è¯´ï¼Œå®ƒåœ¨å®ç°æ¥å£æ—¶å¯ä»¥é€‰æ‹©æ¥å—è€…çš„ç±»å‹ï¼Œå³ç»“æ„ä½“æˆ–è€…ç»“æ„ä½“æŒ‡é’ˆï¼Œåœ¨åˆå§‹åŒ–æ—¶ä¹Ÿå¯ä»¥åˆå§‹åŒ–æˆç»“æ„ä½“æˆ–è€…æŒ‡é’ˆã€‚ä¸‹é¢çš„ä»£ç æ€»ç»“äº†å¦‚ä½•ä½¿ç”¨ç»“æ„ä½“ã€ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æ„ä½“ã€ç»“æ„ä½“æŒ‡é’ˆåˆå§‹åŒ–å˜é‡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Duck <span class="keyword">interface</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c  Cat)</span> <span class="title">Quack</span></span> &#123;&#125;  <span class="comment">// ä½¿ç”¨ç»“æ„ä½“å®ç°æ¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span> <span class="title">Quack</span></span> &#123;&#125;  <span class="comment">// ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d Duck = Cat&#123;&#125;      <span class="comment">// ä½¿ç”¨ç»“æ„ä½“åˆå§‹åŒ–å˜é‡</span></span><br><span class="line"><span class="keyword">var</span> d Duck = &amp;Cat&#123;&#125;     <span class="comment">// ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆåˆå§‹åŒ–å˜é‡</span></span><br></pre></td></tr></table></figure><p>å®ç°æ¥å£çš„ç±»å‹å’Œåˆå§‹åŒ–è¿”å›çš„ç±»å‹ä¸¤ä¸ªç»´åº¦ç»„æˆäº†å››ç§æƒ…å†µï¼Œè¿™å››ç§æƒ…å†µå¹¶ä¸éƒ½èƒ½é€šè¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥ï¼š</p><div class="table-container"><table><thead><tr><th></th><th>ç»“æ„ä½“å®ç°æ¥å£</th><th>ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£</th></tr></thead><tbody><tr><td>ç»“æ„ä½“åˆå§‹åŒ–å˜é‡</td><td>é€šè¿‡</td><td>ä¸é€šè¿‡</td></tr><tr><td>ç»“æ„ä½“æŒ‡é’ˆåˆå§‹åŒ–å˜é‡</td><td>é€šè¿‡</td><td>é€šè¿‡</td></tr></tbody></table></div><p>å››ç§ä¸­åªæœ‰ã€ä½¿ç”¨æŒ‡é’ˆå®ç°æ¥å£ï¼Œä½¿ç”¨ç»“æ„ä½“åˆå§‹åŒ–å˜é‡ã€æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå…¶ä»–çš„ä¸‰ç§æƒ…å†µéƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚å½“å®ç°æ¥å£çš„ç±»å‹å’Œåˆå§‹åŒ–å˜é‡æ—¶è¿”å›çš„ç±»å‹æ—¶ç›¸åŒæ—¶ï¼Œä»£ç é€šè¿‡ç¼–è¯‘æ˜¯ç†æ‰€åº”å½“çš„ï¼š</p><ul><li>æ–¹æ³•æ¥å—è€…å’Œåˆå§‹åŒ–ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ï¼›</li><li>æ–¹æ³•æ¥å—è€…å’Œåˆå§‹åŒ–ç±»å‹éƒ½æ˜¯ç»“æ„ä½“æŒ‡é’ˆï¼›</li></ul><p>è€Œå‰©ä¸‹çš„ä¸¤ç§æ–¹å¼ä¸ºä»€ä¹ˆä¸€ç§èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œå¦ä¸€ç§æ— æ³•é€šè¿‡ç¼–è¯‘å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•çš„æ¥å—è€…æ˜¯ç»“æ„ä½“ï¼Œè€Œåˆå§‹åŒ–çš„å˜é‡æ˜¯ç»“æ„ä½“æŒ‡é’ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span> <span class="title">Quack</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;meow&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c Duck = &amp;Cat&#123;&#125;</span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½œä¸ºæŒ‡é’ˆçš„ <code>&amp;Cat&#123;&#125;</code> å˜é‡èƒ½å¤Ÿ<strong>éšå¼åœ°è·å–</strong>åˆ°æŒ‡å‘çš„ç»“æ„ä½“ï¼Œæ‰€ä»¥èƒ½åœ¨ç»“æ„ä½“ä¸Šè°ƒç”¨ <code>Walk</code> å’Œ <code>Quack</code> æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™é‡Œçš„è°ƒç”¨ç†è§£æˆ C è¯­è¨€ä¸­çš„ <code>d-&gt;Walk()</code> å’Œ <code>d-&gt;Speak()</code>ï¼Œå®ƒä»¬éƒ½ä¼šå…ˆè·å–æŒ‡å‘çš„ç»“æ„ä½“å†æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°ä»£ç ä¸­æ–¹æ³•çš„æ¥å—è€…å’Œåˆå§‹åŒ–çš„ç±»å‹è¿›è¡Œäº¤æ¢ï¼Œä»£ç å°±æ— æ³•é€šè¿‡ç¼–è¯‘äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Duck <span class="keyword">interface</span> &#123;</span><br><span class="line">Quack()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span> <span class="title">Quack</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;meow&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c Duck = Cat&#123;&#125;</span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> build <span class="keyword">interface</span>.<span class="keyword">go</span></span><br><span class="line">./<span class="keyword">interface</span>.<span class="keyword">go</span>:<span class="number">20</span>:<span class="number">6</span>: cannot use Cat literal (<span class="keyword">type</span> Cat) as <span class="keyword">type</span> Duck in assignment:</span><br><span class="line">Cat does not implement Duck (Quack method has pointer receiver)</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šæé†’æˆ‘ä»¬ï¼š<code>Cat</code> ç±»å‹æ²¡æœ‰å®ç° <code>Duck</code> æ¥å£ï¼Œ<code>Quack</code> æ–¹æ³•çš„æ¥å—è€…æ˜¯æŒ‡é’ˆã€‚è¿™ä¸¤ä¸ªæŠ¥é”™å¯¹äºåˆšåˆšæ¥è§¦ Go è¯­è¨€çš„å¼€å‘è€…æ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦çŸ¥é“ Go è¯­è¨€åœ¨<a href="https://draveness.me/golang/docs/part2-foundation/ch04-basic/golang-function-call/">ä¼ é€’å‚æ•°</a>æ—¶éƒ½æ˜¯ä¼ å€¼çš„ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/4dSzOu7GJYiXxfP.png" alt="golang-interface-method-receive"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ— è®ºä¸Šè¿°ä»£ç ä¸­åˆå§‹åŒ–çš„å˜é‡ <code>c</code> æ˜¯ <code>Cat&#123;&#125;</code> è¿˜æ˜¯ <code>&amp;Cat&#123;&#125;</code>ï¼Œä½¿ç”¨ <code>c.Quack()</code> è°ƒç”¨æ–¹æ³•æ—¶éƒ½ä¼šå‘ç”Ÿå€¼æ‹·è´ï¼š</p><ul><li>ä¸Šå›¾å·¦ä¾§ï¼Œå¯¹äº <code>&amp;Cat&#123;&#125;</code> æ¥è¯´ï¼Œè¿™æ„å‘³ç€æ‹·è´ä¸€ä¸ªæ–°çš„ <code>&amp;Cat&#123;&#125;</code> æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆä¸åŸæ¥çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªç›¸åŒå¹¶ä¸”å”¯ä¸€çš„ç»“æ„ä½“ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¯ä»¥éšå¼çš„å¯¹å˜é‡è§£å¼•ç”¨ï¼ˆdereferenceï¼‰è·å–æŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“ï¼›</li><li>ä¸Šå›¾å³ä¾§ï¼Œå¯¹äº <code>Cat&#123;&#125;</code> æ¥è¯´ï¼Œè¿™æ„å‘³ç€ <code>Quack</code> æ–¹æ³•ä¼šæ¥å—ä¸€ä¸ªå…¨æ–°çš„ <code>Cat&#123;&#125;</code>ï¼Œå› ä¸ºæ–¹æ³•çš„å‚æ•°æ˜¯ <code>*Cat</code>ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ— ä¸­ç”Ÿæœ‰åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆï¼›å³ä½¿ç¼–è¯‘å™¨å¯ä»¥åˆ›å»ºæ–°æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„ä¹Ÿä¸æ˜¯æœ€åˆè°ƒç”¨è¯¥æ–¹æ³•çš„ç»“æ„ä½“ï¼›</li></ul><p>ä¸Šé¢çš„åˆ†æè§£é‡Šäº†æŒ‡é’ˆç±»å‹çš„ç°è±¡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æŒ‡é’ˆå®ç°æ¥å£æ—¶ï¼Œåªæœ‰æŒ‡é’ˆç±»å‹çš„å˜é‡æ‰ä¼šå®ç°è¯¥æ¥å£ï¼›å½“æˆ‘ä»¬ä½¿ç”¨ç»“æ„ä½“å®ç°æ¥å£æ—¶ï¼ŒæŒ‡é’ˆç±»å‹å’Œç»“æ„ä½“ç±»å‹éƒ½ä¼šå®ç°è¯¥æ¥å£ã€‚å½“ç„¶è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä¸€å¾‹ä½¿ç”¨ç»“æ„ä½“å®ç°æ¥å£ï¼Œè¿™ä¸ªé—®é¢˜åœ¨å®é™…å·¥ç¨‹ä¸­ä¹Ÿæ²¡é‚£ä¹ˆé‡è¦ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªæƒ³è§£é‡Šç°è±¡èƒŒåçš„åŸå› ã€‚</p><h3 id="nil-å’Œ-non-nil"><a href="#nil-å’Œ-non-nil" class="headerlink" title="nil å’Œ non-nil"></a>nil å’Œ non-nil</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­ç†è§£<strong>ã€Go è¯­è¨€çš„æ¥å£ç±»å‹ä¸æ˜¯ä»»æ„ç±»å‹ã€</strong>è¿™ä¸€å¥è¯ï¼Œä¸‹é¢çš„ä»£ç åœ¨ <code>main</code> å‡½æ•°ä¸­åˆå§‹åŒ–äº†ä¸€ä¸ª <code>*TestStruct</code> ç»“æ„ä½“æŒ‡é’ˆï¼Œç”±äºæŒ‡é’ˆçš„é›¶å€¼æ˜¯ <code>nil</code>ï¼Œæ‰€ä»¥å˜é‡ <code>s</code> åœ¨åˆå§‹åŒ–ä¹‹åä¹Ÿæ˜¯ <code>nil</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestStruct <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NilOrNot</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> v == <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s *TestStruct</span><br><span class="line">fmt.Println(s == <span class="literal">nil</span>)      <span class="comment">// #=&gt; true</span></span><br><span class="line">fmt.Println(NilOrNot(s))   <span class="comment">// #=&gt; false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹ä¸Šè¿°ä»£ç æ‰§è¡Œçš„ç»“æœï¼š</p><ul><li>å°†ä¸Šè¿°å˜é‡ä¸ <code>nil</code> æ¯”è¾ƒä¼šè¿”å› <code>true</code>ï¼›</li><li>å°†ä¸Šè¿°å˜é‡ä¼ å…¥ <code>NilOrNot</code> æ–¹æ³•å¹¶ä¸ <code>nil</code> æ¯”è¾ƒä¼šè¿”å› <code>false</code>ï¼›</li></ul><p>å‡ºç°ä¸Šè¿°ç°è±¡çš„åŸå› æ˜¯ â€”â€” è°ƒç”¨ <code>NilOrNot</code> å‡½æ•°æ—¶å‘ç”Ÿäº†<strong>éšå¼çš„ç±»å‹è½¬æ¢</strong>ï¼Œé™¤äº†å‘æ–¹æ³•ä¼ å…¥å‚æ•°ä¹‹å¤–ï¼Œå˜é‡çš„èµ‹å€¼ä¹Ÿä¼šè§¦å‘éšå¼ç±»å‹è½¬æ¢ã€‚åœ¨ç±»å‹è½¬æ¢æ—¶ï¼Œ<code>*TestStruct</code> ç±»å‹ä¼šè½¬æ¢æˆ <code>interface&#123;&#125;</code> ç±»å‹ï¼Œè½¬æ¢åçš„å˜é‡ä¸ä»…åŒ…å«è½¬æ¢å‰çš„å˜é‡ï¼Œè¿˜åŒ…å«å˜é‡çš„ç±»å‹ä¿¡æ¯ <code>TestStruct</code>ï¼Œæ‰€ä»¥è½¬æ¢åçš„å˜é‡ä¸ <code>nil</code> ä¸ç›¸ç­‰ã€‚</p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»æºä»£ç å’Œæ±‡ç¼–æŒ‡ä»¤å±‚é¢ä»‹ç»æ¥å£çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</p><p>Go è¯­è¨€æ ¹æ®æ¥å£ç±»å‹ã€æ˜¯å¦åŒ…å«ä¸€ç»„æ–¹æ³•ã€å¯¹ç±»å‹åšäº†ä¸åŒçš„å¤„ç†ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>iface</code> ç»“æ„ä½“è¡¨ç¤ºåŒ…å«æ–¹æ³•çš„æ¥å£ï¼›ä½¿ç”¨ <code>eface</code> ç»“æ„ä½“è¡¨ç¤ºä¸åŒ…å«ä»»ä½•æ–¹æ³•çš„ <code>interface&#123;&#125;</code> ç±»å‹ï¼Œ<code>eface</code> ç»“æ„ä½“åœ¨ Go è¯­è¨€çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> eface <span class="keyword">struct</span> &#123; <span class="comment">// 16 bytes</span></span><br><span class="line">_type *_type</span><br><span class="line">data  unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº <code>interface&#123;&#125;</code> ç±»å‹ä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒçš„ç»“æ„ä¹Ÿç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼ŒåªåŒ…å«æŒ‡å‘åº•å±‚æ•°æ®å’Œç±»å‹çš„ä¸¤ä¸ªæŒ‡é’ˆã€‚ä»ä¸Šè¿°ç»“æ„æˆ‘ä»¬ä¹Ÿèƒ½æ¨æ–­å‡º â€” Go è¯­è¨€ä¸­çš„ä»»æ„ç±»å‹éƒ½å¯ä»¥è½¬æ¢æˆ <code>interface&#123;&#125;</code> ç±»å‹ã€‚</p><p>å¦ä¸€ä¸ªç”¨äºè¡¨ç¤ºæ¥å£çš„ç»“æ„ä½“å°±æ˜¯ <code>iface</code>ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­æœ‰æŒ‡å‘åŸå§‹æ•°æ®çš„æŒ‡é’ˆ <code>data</code>ï¼Œä¸è¿‡æ›´é‡è¦çš„æ˜¯ <code>itab</code> ç±»å‹çš„ <code>tab</code> å­—æ®µã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> &#123; <span class="comment">// 16 bytes</span></span><br><span class="line">tab  *itab</span><br><span class="line">data unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¯¦ç»†åˆ†æ Go è¯­è¨€æ¥å£ä¸­çš„è¿™ä¸¤ä¸ªç±»å‹ï¼Œå³ <code>_type</code> å’Œ <code>itab</code>ã€‚</p><h3 id="ç±»å‹ç»“æ„ä½“"><a href="#ç±»å‹ç»“æ„ä½“" class="headerlink" title="ç±»å‹ç»“æ„ä½“"></a>ç±»å‹ç»“æ„ä½“</h3><p><code>_type</code> æ˜¯ Go è¯­è¨€ç±»å‹çš„è¿è¡Œæ—¶è¡¨ç¤ºã€‚ä¸‹é¢æ˜¯è¿è¡Œæ—¶åŒ…ä¸­çš„ç»“æ„ä½“ï¼Œç»“æ„ä½“åŒ…å«äº†å¾ˆå¤šå…ƒä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šç±»å‹çš„å¤§å°ã€å“ˆå¸Œã€å¯¹é½ä»¥åŠç§ç±»ç­‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> _type <span class="keyword">struct</span> &#123;</span><br><span class="line">size       <span class="keyword">uintptr</span></span><br><span class="line">ptrdata    <span class="keyword">uintptr</span></span><br><span class="line">hash       <span class="keyword">uint32</span></span><br><span class="line">tflag      tflag</span><br><span class="line">align      <span class="keyword">uint8</span></span><br><span class="line">fieldAlign <span class="keyword">uint8</span></span><br><span class="line">kind       <span class="keyword">uint8</span></span><br><span class="line">equal      <span class="function"><span class="keyword">func</span><span class="params">(unsafe.Pointer, unsafe.Pointer)</span> <span class="title">bool</span></span></span><br><span class="line">gcdata     *<span class="keyword">byte</span></span><br><span class="line">str        nameOff</span><br><span class="line">ptrToThis  typeOff</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>size</code> å­—æ®µå­˜å‚¨äº†ç±»å‹å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä¸ºå†…å­˜ç©ºé—´çš„åˆ†é…æä¾›ä¿¡æ¯ï¼›</li><li><code>hash</code> å­—æ®µèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç¡®å®šç±»å‹æ˜¯å¦ç›¸ç­‰ï¼›</li><li><code>equal</code> å­—æ®µç”¨äºåˆ¤æ–­å½“å‰ç±»å‹çš„å¤šä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œè¯¥å­—æ®µæ˜¯ä¸ºäº†å‡å°‘ Go è¯­è¨€äºŒè¿›åˆ¶åŒ…å¤§å°ä» <code>typeAlg</code> ç»“æ„ä½“ä¸­è¿ç§»è¿‡æ¥çš„ï¼›</li></ul><p>æˆ‘ä»¬åªéœ€è¦å¯¹ <code>_type</code> ç»“æ„ä½“ä¸­çš„å­—æ®µæœ‰ä¸€ä¸ªå¤§ä½“çš„æ¦‚å¿µï¼Œä¸éœ€è¦è¯¦ç»†ç†è§£æ‰€æœ‰å­—æ®µçš„ä½œç”¨å’Œæ„ä¹‰ã€‚</p><h3 id="itab-ç»“æ„ä½“"><a href="#itab-ç»“æ„ä½“" class="headerlink" title="itab ç»“æ„ä½“"></a>itab ç»“æ„ä½“</h3><p><code>itab</code> ç»“æ„ä½“æ˜¯æ¥å£ç±»å‹çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸€ä¸ª <code>itab</code> éƒ½å  32 å­—èŠ‚çš„ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶çœ‹æˆæ¥å£ç±»å‹å’Œå…·ä½“ç±»å‹çš„ç»„åˆï¼Œå®ƒä»¬åˆ†åˆ«ç”¨ <code>inter</code> å’Œ <code>_type</code> ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123; <span class="comment">// 32 bytes</span></span><br><span class="line">inter *interfacetype</span><br><span class="line">_type *_type</span><br><span class="line">hash  <span class="keyword">uint32</span></span><br><span class="line">_     [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line">fun   [<span class="number">1</span>]<span class="keyword">uintptr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº† <code>inter</code> å’Œ <code>_type</code> ä¸¤ä¸ªç”¨äºè¡¨ç¤ºç±»å‹çš„å­—æ®µä¹‹å¤–ï¼Œä¸Šè¿°ç»“æ„ä½“ä¸­çš„å¦å¤–ä¸¤ä¸ªå­—æ®µä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨ï¼š</p><ul><li><code>hash</code> æ˜¯å¯¹ <code>_type.hash</code> çš„æ‹·è´ï¼Œå½“æˆ‘ä»¬æƒ³å°† <code>interface</code> ç±»å‹è½¬æ¢æˆå…·ä½“ç±»å‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å­—æ®µå¿«é€Ÿåˆ¤æ–­ç›®æ ‡ç±»å‹å’Œå…·ä½“ç±»å‹ <code>_type</code> æ˜¯å¦ä¸€è‡´ï¼›</li><li><code>fun</code> æ˜¯ä¸€ä¸ªåŠ¨æ€å¤§å°çš„æ•°ç»„ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºåŠ¨æ€æ´¾å‘çš„è™šå‡½æ•°è¡¨ï¼Œå­˜å‚¨äº†ä¸€ç»„å‡½æ•°æŒ‡é’ˆã€‚è™½ç„¶è¯¥å˜é‡è¢«å£°æ˜æˆå¤§å°å›ºå®šçš„æ•°ç»„ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶ä¼šé€šè¿‡åŸå§‹æŒ‡é’ˆè·å–å…¶ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥ <code>fun</code> æ•°ç»„ä¸­ä¿å­˜çš„å…ƒç´ æ•°é‡æ˜¯ä¸ç¡®å®šçš„ï¼›</li></ul><p>æˆ‘ä»¬ä¼šåœ¨ç±»å‹æ–­è¨€ä¸­ä»‹ç» <code>hash</code> å­—æ®µçš„ä½¿ç”¨ï¼Œåœ¨åŠ¨æ€æ´¾å‘ä¸€èŠ‚ä¸­ä»‹ç» <code>fun</code> æ•°ç»„ä¸­å­˜å‚¨çš„å‡½æ•°æŒ‡é’ˆæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚</p><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»äº†è§£äº†æ¥å£åœ¨è¿è¡Œæ—¶çš„æ•°æ®ç»“æ„ï¼Œæ¥ä¸‹æ¥ä¼šé€šè¿‡å‡ ä¸ªä¾‹å­æ¥æ·±å…¥ç†è§£æ¥å£ç±»å‹æ˜¯å¦‚ä½•åˆå§‹åŒ–å’Œä¼ é€’çš„ï¼Œè¿™é‡Œä¼šä»‹ç»åœ¨å®ç°æ¥å£æ—¶ä½¿ç”¨æŒ‡é’ˆç±»å‹å’Œç»“æ„ä½“ç±»å‹çš„åŒºåˆ«ã€‚è¿™ä¸¤ç§ä¸åŒçš„æ¥å£å®ç°æ–¹å¼ä¼šå¯¼è‡´ Go è¯­è¨€ç¼–è¯‘å™¨ç”Ÿæˆä¸åŒçš„æ±‡ç¼–ä»£ç ï¼Œå¸¦æ¥æ‰§è¡Œè¿‡ç¨‹ä¸Šçš„ä¸€äº›å·®å¼‚ã€‚</p><h3 id="æŒ‡é’ˆç±»å‹"><a href="#æŒ‡é’ˆç±»å‹" class="headerlink" title="æŒ‡é’ˆç±»å‹"></a>æŒ‡é’ˆç±»å‹</h3><p>é¦–å…ˆæˆ‘ä»¬å›åˆ°è¿™ä¸€èŠ‚å¼€å¤´æåˆ°çš„ <code>Duck</code> æ¥å£çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>//go:noinline</code> æŒ‡ä»¤ç¦æ­¢ <code>Quack</code> æ–¹æ³•çš„å†…è”ç¼–è¯‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Duck <span class="keyword">interface</span> &#123;</span><br><span class="line">Quack()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:noinline</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span> <span class="title">Quack</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">println</span>(c.Name + <span class="string">&quot; meow&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c Duck = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ç¼–è¯‘å™¨å°†ä¸Šè¿°ä»£ç ç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€ï¼Œåˆ æ‰å…¶ä¸­ä¸€äº›å¯¹ç†è§£æ¥å£åŸç†æ— ç”¨çš„æŒ‡ä»¤å¹¶ä¿ç•™ä¸èµ‹å€¼è¯­å¥ <code>var c Duck = &amp;Cat&#123;Name: &quot;grooming&quot;&#125;</code> ç›¸å…³çš„ä»£ç ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ‹†åˆ†æˆä¸‰éƒ¨åˆ†åˆ†æï¼š</p><ol><li>ç»“æ„ä½“ <code>Cat</code> çš„åˆå§‹åŒ–ï¼›</li><li>èµ‹å€¼è§¦å‘çš„ç±»å‹è½¬æ¢è¿‡ç¨‹ï¼›</li><li>è°ƒç”¨æ¥å£çš„æ–¹æ³• <code>Quack()</code>ï¼›</li></ol><p>æˆ‘ä»¬å…ˆæ¥åˆ†æç»“æ„ä½“ <code>Cat</code> çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LEAQ<span class="keyword">type</span>.<span class="string">&quot;&quot;</span>.Cat(SB), AX                ;; AX = &amp;<span class="keyword">type</span>.<span class="string">&quot;&quot;</span>.Cat</span><br><span class="line">MOVQAX, (SP)                           ;; SP = &amp;<span class="keyword">type</span>.<span class="string">&quot;&quot;</span>.Cat</span><br><span class="line">CALLruntime.newobject(SB)              ;; SP + <span class="number">8</span> = &amp;Cat&#123;&#125;</span><br><span class="line">MOVQ<span class="number">8</span>(SP), DI                          ;; DI = &amp;Cat&#123;&#125;</span><br><span class="line">MOVQ$<span class="number">8</span>, <span class="number">8</span>(DI)                          ;; StringHeader(DI.Name).Len = <span class="number">8</span></span><br><span class="line">LEAQ<span class="keyword">go</span>.<span class="keyword">string</span>.<span class="string">&quot;grooming&quot;</span>(SB), AX       ;; AX = &amp;<span class="string">&quot;grooming&quot;</span></span><br><span class="line">MOVQAX, (DI)                           ;; StringHeader(DI.Name).Data = &amp;<span class="string">&quot;grooming&quot;</span></span><br></pre></td></tr></table></figure><ol><li>è·å– <code>Cat</code> ç»“æ„ä½“ç±»å‹æŒ‡é’ˆå¹¶å°†å…¶ä½œä¸ºå‚æ•°æ”¾åˆ°æ ˆä¸Šï¼›</li><li>é€šè¿‡ <code>CALL</code> æŒ‡å®šè°ƒç”¨ <a href="https://github.com/golang/go/blob/5042317d6919d4c84557e04be35130430e8d1dd4/src/runtime/malloc.go#L1162-L1164"><code>runtime.newobject</code></a> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šä»¥ <code>Cat</code> ç»“æ„ä½“ç±»å‹æŒ‡é’ˆä½œä¸ºå…¥å‚ï¼Œåˆ†é…ä¸€ç‰‡æ–°çš„å†…å­˜ç©ºé—´å¹¶å°†æŒ‡å‘è¿™ç‰‡å†…å­˜ç©ºé—´çš„æŒ‡é’ˆè¿”å›åˆ° SP+8 ä¸Šï¼›</li><li>SP+8 ç°åœ¨å­˜å‚¨äº†ä¸€ä¸ªæŒ‡å‘ <code>Cat</code> ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬å°†æ ˆä¸Šçš„æŒ‡é’ˆæ‹·è´åˆ°å¯„å­˜å™¨ <code>DI</code> ä¸Šæ–¹ä¾¿æ“ä½œï¼›</li><li>ç”±äº <code>Cat</code> ä¸­åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ <code>Name</code> å˜é‡ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¼šåˆ†åˆ«å°†å­—ç¬¦ä¸²åœ°å€ <code>&amp;&quot;grooming&quot;</code> å’Œå­—ç¬¦ä¸²é•¿åº¦ <code>8</code> è®¾ç½®åˆ°ç»“æ„ä½“ä¸Šï¼Œæœ€åä¸‰è¡Œæ±‡ç¼–æŒ‡ä»¤ç­‰ä»·äº <code>cat.Name = &quot;grooming&quot;</code>ï¼›</li></ol><p>å­—ç¬¦ä¸²åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºå…¶å®å°±æ˜¯æŒ‡é’ˆåŠ ä¸Šå­—ç¬¦ä¸²é•¿åº¦ï¼Œåœ¨å‰é¢çš„ç« èŠ‚<a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-string/">å­—ç¬¦ä¸²</a>å·²ç»ä»‹ç»è¿‡å®ƒçš„åº•å±‚è¡¨ç¤ºå’Œå®ç°åŸç†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œè¦çœ‹ä¸€ä¸‹åˆå§‹åŒ–ä¹‹åçš„ <code>Cat</code> ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºæ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-new-struct-pointer.png" alt="golang-new-struct-pointe"></p><p>å› ä¸º <code>Cat</code> ç»“æ„ä½“çš„å®šä¹‰ä¸­åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œå­—ç¬¦ä¸²åœ¨ Go è¯­è¨€ä¸­æ€»å…±å  16 å­—èŠ‚ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª <code>Cat</code> ç»“æ„ä½“çš„å¤§å°éƒ½æ˜¯ 16 å­—èŠ‚ã€‚åˆå§‹åŒ– <code>Cat</code> ç»“æ„ä½“ä¹‹åå°±è¿›å…¥äº†å°† <code>*Cat</code> è½¬æ¢æˆ <code>Duck</code> ç±»å‹çš„è¿‡ç¨‹äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LEAQ<span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck(SB), AX    ;; AX = *itab(<span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck)</span><br><span class="line">MOVQDI, (SP)                           ;; SP = AX</span><br></pre></td></tr></table></figure><p>ç±»å‹è½¬æ¢çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œ<code>Duck</code> ä½œä¸ºä¸€ä¸ªåŒ…å«æ–¹æ³•çš„æ¥å£ï¼Œå®ƒåœ¨åº•å±‚ä½¿ç”¨ <code>iface</code> ç»“æ„ä½“è¡¨ç¤ºã€‚<code>iface</code> ç»“æ„ä½“åŒ…å«ä¸¤ä¸ªå­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆï¼Œå¦ä¸€ä¸ªæ˜¯è¡¨ç¤ºæ¥å£å’Œç»“æ„ä½“å…³ç³»çš„ <code>tab</code> å­—æ®µï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ä¸Šä¸€æ®µä»£ç  SP+8 åˆå§‹åŒ–äº† <code>Cat</code> ç»“æ„ä½“æŒ‡é’ˆï¼Œè¿™æ®µä»£ç åªæ˜¯å°†ç¼–è¯‘æœŸé—´ç”Ÿæˆçš„ <code>itab</code> ç»“æ„ä½“æŒ‡é’ˆå¤åˆ¶åˆ° SP ä¸Šï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-struct-pointer-to-iface.png" alt="golang-struct-pointer-to-iface"></p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šå‘ç° SP ~ SP+16 å…±åŒç»„æˆäº† <code>iface</code> ç»“æ„ä½“ï¼Œè€Œæ ˆä¸Šçš„è¿™ä¸ª <code>iface</code> ç»“æ„ä½“ä¹Ÿæ˜¯ <code>Quack</code> æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå…¥å‚ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL    <span class="string">&quot;&quot;</span>.(*Cat).Quack(SB)                ;; SP.Quack()</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¼šç›´æ¥é€šè¿‡ <code>CALL</code> æŒ‡ä»¤å®Œæˆæ–¹æ³•çš„è°ƒç”¨ï¼Œç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ â€”â€” ä¸ºä»€ä¹ˆåœ¨ä»£ç ä¸­æˆ‘ä»¬è°ƒç”¨çš„æ˜¯ <code>Duck.Quack</code> ä½†ç”Ÿæˆçš„æ±‡ç¼–æ˜¯ <code>*Cat.Quack</code> å‘¢ï¼ŸGo è¯­è¨€çš„ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸€äº›éœ€è¦åŠ¨æ€æ´¾å‘çš„æ–¹æ³•è°ƒç”¨æ”¹å†™æˆå¯¹ç›®æ ‡æ–¹æ³•çš„ç›´æ¥è°ƒç”¨ï¼Œä»¥å‡å°‘æ€§èƒ½çš„é¢å¤–å¼€é”€ã€‚å¦‚æœåœ¨è¿™é‡Œç¦ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œå°±ä¼šçœ‹åˆ°åŠ¨æ€æ´¾å‘çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢åˆ†ææ¥å£çš„åŠ¨æ€æ´¾å‘ä»¥åŠæ€§èƒ½ä¸Šçš„é¢å¤–å¼€é”€ã€‚</p><h3 id="ç»“æ„ä½“ç±»å‹"><a href="#ç»“æ„ä½“ç±»å‹" class="headerlink" title="ç»“æ„ä½“ç±»å‹"></a>ç»“æ„ä½“ç±»å‹</h3><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç»§ç»­ä¿®æ”¹ä¸Šä¸€èŠ‚ä¸­çš„ä»£ç ï¼Œä½¿ç”¨ç»“æ„ä½“ç±»å‹å®ç° <code>Duck</code> æ¥å£å¹¶åˆå§‹åŒ–ç»“æ„ä½“ç±»å‹çš„å˜é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Duck <span class="keyword">interface</span> &#123;</span><br><span class="line">Quack()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:noinline</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span> <span class="title">Quack</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">println</span>(c.Name + <span class="string">&quot; meow&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c Duck = Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åœ¨åˆå§‹åŒ–å˜é‡æ—¶ä½¿ç”¨æŒ‡é’ˆç±»å‹ <code>&amp;Cat&#123;Name: &quot;grooming&quot;&#125;</code> ä¹Ÿèƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œä¸è¿‡ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å’Œä¸Šä¸€èŠ‚ä¸­çš„å‡ ä¹å®Œå…¨ç›¸åŒï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±ä¸åˆ†æè¿™ä¸ªæƒ…å†µäº†ã€‚</p><p>ç¼–è¯‘ä¸Šè¿°çš„ä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸ºäº†ä»£ç æ›´å®¹æ˜“ç†è§£å’Œåˆ†æï¼Œè¿™é‡Œçš„æ±‡ç¼–æŒ‡ä»¤ä¾ç„¶ç»è¿‡äº†åˆ å‡ï¼Œä¸è¿‡ä¸ä¼šå½±å“å…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ä¸ä¸Šä¸€èŠ‚ä¸€æ ·ï¼Œæˆ‘ä»¬å°†æ±‡ç¼–ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>åˆå§‹åŒ– <code>Cat</code> ç»“æ„ä½“ï¼›</li><li>å®Œæˆä» <code>Cat</code> åˆ° <code>Duck</code> æ¥å£çš„ç±»å‹è½¬æ¢ï¼›</li><li>è°ƒç”¨æ¥å£çš„ <code>Quack</code> æ–¹æ³•ï¼›</li></ol><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸Šè¿°æ±‡ç¼–ä»£ç ä¸­ç”¨äºåˆå§‹åŒ– <code>Cat</code> ç»“æ„ä½“çš„éƒ¨åˆ†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XORPS   X0, X0                          ;; X0 = <span class="number">0</span></span><br><span class="line">MOVUPS  X0, <span class="string">&quot;&quot;</span>..autotmp_1+<span class="number">32</span>(SP)        ;; StringHeader(SP+<span class="number">32</span>).Data = <span class="number">0</span></span><br><span class="line">LEAQ    <span class="keyword">go</span>.<span class="keyword">string</span>.<span class="string">&quot;grooming&quot;</span>(SB), AX    ;; AX = &amp;<span class="string">&quot;grooming&quot;</span></span><br><span class="line">MOVQ    AX, <span class="string">&quot;&quot;</span>..autotmp_1+<span class="number">32</span>(SP)        ;; StringHeader(SP+<span class="number">32</span>).Data = AX</span><br><span class="line">MOVQ    $<span class="number">8</span>, <span class="string">&quot;&quot;</span>..autotmp_1+<span class="number">40</span>(SP)        ;; StringHeader(SP+<span class="number">32</span>).Len =<span class="number">8</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µæ±‡ç¼–æŒ‡ä»¤ä¼šåœ¨æ ˆä¸Šåˆå§‹åŒ– <code>Cat</code> ç»“æ„ä½“ï¼Œè€Œä¸Šä¸€èŠ‚çš„ä»£ç åœ¨å †ä¸Šç”³è¯·äº† 16 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œæ ˆä¸Šåªæœ‰ä¸€ä¸ªæŒ‡å‘ <code>Cat</code> çš„æŒ‡é’ˆã€‚</p><p>åˆå§‹åŒ–ç»“æ„ä½“åå°±è¿›å…¥ç±»å‹è½¬æ¢çš„é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šå°† <code>go.itab.&quot;&quot;.Cat,&quot;&quot;.Duck</code> çš„åœ°å€å’ŒæŒ‡å‘ <code>Cat</code> ç»“æ„ä½“çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¸€å¹¶ä¼ å…¥ <a href="https://github.com/golang/go/blob/0c5d545ccdd01403d6ce865fb03774a6aff6032c/src/runtime/iface.go#L398-L411"><code>runtime.convT2I</code></a> å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LEAQ<span class="keyword">go</span>.itab.<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck(SB), AX     ;; AX = &amp;(<span class="keyword">go</span>.itab.<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck)</span><br><span class="line">MOVQAX, (SP)                           ;; SP = AX</span><br><span class="line">LEAQ<span class="string">&quot;&quot;</span>..autotmp_1+<span class="number">32</span>(SP), AX           ;; AX = &amp;(SP+<span class="number">32</span>) = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line">MOVQAX, <span class="number">8</span>(SP)                          ;; SP + <span class="number">8</span> = AX</span><br><span class="line">CALLruntime.convT2I(SB)                ;; runtime.convT2I(SP, SP+<span class="number">8</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¼šè·å– <code>itab</code> ä¸­å­˜å‚¨çš„ç±»å‹ï¼Œæ ¹æ®ç±»å‹çš„å¤§å°ç”³è¯·ä¸€ç‰‡å†…å­˜ç©ºé—´å¹¶å°† <code>elem</code> æŒ‡é’ˆä¸­çš„å†…å®¹æ‹·è´åˆ°ç›®æ ‡çš„å†…å­˜ç©ºé—´ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convT2I</span><span class="params">(tab *itab, elem unsafe.Pointer)</span> <span class="params">(i iface)</span></span> &#123;</span><br><span class="line">t := tab._type</span><br><span class="line">x := mallocgc(t.size, t, <span class="literal">true</span>)</span><br><span class="line">typedmemmove(t, x, elem)</span><br><span class="line">i.tab = tab</span><br><span class="line">i.data = x</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/0c5d545ccdd01403d6ce865fb03774a6aff6032c/src/runtime/iface.go#L398-L411"><code>runtime.convT2I</code></a> ä¼šè¿”å›ä¸€ä¸ª <code>iface</code> ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å« <code>itab</code> æŒ‡é’ˆå’Œ <code>Cat</code> å˜é‡ã€‚å½“å‰å‡½æ•°è¿”å›ä¹‹åï¼Œ<code>main</code> å‡½æ•°çš„æ ˆä¸Šä¼šåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-struct-to-iface.png" alt="golang-struct-to-iface"></p><p>SP å’Œ SP+8 ä¸­å­˜å‚¨çš„ <code>itab</code> å’Œ <code>Cat</code> æŒ‡é’ˆå°±æ˜¯ <a href="https://github.com/golang/go/blob/0c5d545ccdd01403d6ce865fb03774a6aff6032c/src/runtime/iface.go#L398-L411"><code>runtime.convT2I</code></a> å‡½æ•°çš„å…¥å‚ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½äº SP+16ï¼Œæ˜¯ä¸€ä¸ªå  16 å­—èŠ‚å†…å­˜ç©ºé—´çš„ <code>iface</code> ç»“æ„ä½“ï¼ŒSP+32 å­˜å‚¨çš„å°±æ˜¯åœ¨æ ˆä¸Šçš„ <code>Cat</code> ç»“æ„ä½“ï¼Œå®ƒä¼šåœ¨ <a href="https://github.com/golang/go/blob/0c5d545ccdd01403d6ce865fb03774a6aff6032c/src/runtime/iface.go#L398-L411"><code>runtime.convT2I</code></a> æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ‹·è´åˆ°å †ä¸Šã€‚</p><p>åœ¨æœ€åï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä»¥ä¸‹çš„æŒ‡ä»¤è°ƒç”¨ <code>Cat</code> å®ç°çš„æ¥å£æ–¹æ³• <code>Quack()</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MOVQ<span class="number">16</span>(SP), AX ;; AX = &amp;(<span class="keyword">go</span>.itab.<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck)</span><br><span class="line">MOVQ<span class="number">24</span>(SP), CX ;; CX = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line">MOVQ<span class="number">24</span>(AX), AX ;; AX = AX.fun[<span class="number">0</span>] = Cat.Quack</span><br><span class="line">MOVQCX, (SP)   ;; SP = CX</span><br><span class="line">CALLAX         ;; CX.Quack()</span><br></pre></td></tr></table></figure><p>è¿™å‡ ä¸ªæ±‡ç¼–æŒ‡ä»¤è¿˜æ˜¯éå¸¸å¥½ç†è§£çš„ï¼Œ<code>MOVQ 24(AX), AX</code> æ˜¯æœ€å…³é”®çš„æŒ‡ä»¤ï¼Œå®ƒä» <code>itab</code> ç»“æ„ä½“ä¸­å–å‡º <code>Cat.Quack</code> æ–¹æ³•æŒ‡é’ˆä½œä¸º <code>CALL</code> æŒ‡ä»¤è°ƒç”¨æ—¶çš„å‚æ•°ã€‚æ¥å£å˜é‡çš„ç¬¬ 24 å­—èŠ‚æ˜¯ <code>itab.fun</code> æ•°ç»„å¼€å§‹çš„ä½ç½®ï¼Œç”±äº <code>Duck</code> æ¥å£åªåŒ…å«ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ <code>itab.fun[0]</code> ä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‡å‘ <code>Quack</code> æ–¹æ³•çš„æŒ‡é’ˆäº†ã€‚</p><h2 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h2><p>ä¸Šä¸€èŠ‚ä»‹ç»æ˜¯å¦‚ä½•æŠŠå…·ä½“ç±»å‹è½¬æ¢æˆæ¥å£ç±»å‹ï¼Œè€Œè¿™ä¸€èŠ‚ä»‹ç»çš„æ˜¯å¦‚ä½•å°†ä¸€ä¸ªæ¥å£ç±»å‹è½¬æ¢æˆå…·ä½“ç±»å‹ã€‚æœ¬èŠ‚ä¼šæ ¹æ®æ¥å£ä¸­æ˜¯å¦å­˜åœ¨æ–¹æ³•åˆ†ä¸¤ç§æƒ…å†µä»‹ç»ç±»å‹æ–­è¨€çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><h3 id="éç©ºæ¥å£"><a href="#éç©ºæ¥å£" class="headerlink" title="éç©ºæ¥å£"></a>éç©ºæ¥å£</h3><p>é¦–å…ˆåˆ†ææ¥å£ä¸­åŒ…å«æ–¹æ³•çš„æƒ…å†µï¼Œ<code>Duck</code> æ¥å£ä¸€ä¸ªéç©ºçš„æ¥å£ï¼Œæˆ‘ä»¬æ¥åˆ†æä» <code>Duck</code> è½¬æ¢å› <code>Cat</code> ç»“æ„ä½“çš„è¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c Duck = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line"><span class="keyword">switch</span> c.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> *Cat:</span><br><span class="line">cat := c.(*Cat)</span><br><span class="line">cat.Quack()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–æŒ‡ä»¤åˆ†æˆä¸¤éƒ¨åˆ†åˆ†æï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å˜é‡çš„åˆå§‹åŒ–ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»å‹æ–­è¨€ï¼Œç¬¬ä¸€éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000</span> TEXT<span class="string">&quot;&quot;</span>.main(SB), ABIInternal, $<span class="number">32</span><span class="number">-0</span></span><br><span class="line">...</span><br><span class="line"><span class="number">00029</span> XORPSX0, X0</span><br><span class="line"><span class="number">00032</span> MOVUPSX0, <span class="string">&quot;&quot;</span>..autotmp_4+<span class="number">8</span>(SP)</span><br><span class="line"><span class="number">00037</span> LEAQ<span class="keyword">go</span>.<span class="keyword">string</span>.<span class="string">&quot;grooming&quot;</span>(SB), AX</span><br><span class="line"><span class="number">00044</span> MOVQAX, <span class="string">&quot;&quot;</span>..autotmp_4+<span class="number">8</span>(SP)</span><br><span class="line"><span class="number">00049</span> MOVQ$<span class="number">8</span>, <span class="string">&quot;&quot;</span>..autotmp_4+<span class="number">16</span>(SP)</span><br></pre></td></tr></table></figure><p>0037 ~ 0049 ä¸‰ä¸ªæŒ‡ä»¤åˆå§‹åŒ–äº† <code>Duck</code> å˜é‡ï¼Œ<code>Cat</code> ç»“æ„ä½“åˆå§‹åŒ–åœ¨ SP+8 ~ SP+24 ä¸Šã€‚å› ä¸º Go è¯­è¨€çš„ç¼–è¯‘å™¨åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œæ‰€ä»¥ä»£ç ä¸­æ²¡æœ‰<code>iface</code> çš„æ„å»ºè¿‡ç¨‹ï¼Œä¸è¿‡å¯¹äºè¿™ä¸€èŠ‚è¦ä»‹ç»çš„ç±»å‹æ–­è¨€å’Œè½¬æ¢æ²¡æœ‰å¤ªå¤šçš„å½±å“ã€‚ä¸‹é¢è¿›å…¥ç±»å‹è½¬æ¢çš„éƒ¨åˆ†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00058</span> CMPL  <span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck+<span class="number">16</span>(SB), $<span class="number">593696792</span>  </span><br><span class="line">                                        ;; <span class="keyword">if</span> (c.tab.hash != <span class="number">593696792</span>) &#123;</span><br><span class="line"><span class="number">00068</span> JEQ   <span class="number">80</span>                          ;;      </span><br><span class="line"><span class="number">00070</span> MOVQ  <span class="number">24</span>(SP), BP                  ;;      BP = SP+<span class="number">24</span></span><br><span class="line"><span class="number">00075</span> ADDQ  $<span class="number">32</span>, SP                     ;;      SP += <span class="number">32</span></span><br><span class="line"><span class="number">00079</span> RET                               ;;      <span class="keyword">return</span></span><br><span class="line">                                        ;; &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">00080</span> LEAQ  <span class="string">&quot;&quot;</span>..autotmp_4+<span class="number">8</span>(SP), AX     ;;      AX = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line"><span class="number">00085</span> MOVQ  AX, (SP)                    ;;      SP = AX</span><br><span class="line"><span class="number">00089</span> CALL  <span class="string">&quot;&quot;</span>.(*Cat).Quack(SB)         ;;      SP.Quack()</span><br><span class="line"><span class="number">00094</span> JMP   <span class="number">70</span>                          ;;      ...</span><br><span class="line">                                        ;;      BP = SP+<span class="number">24</span></span><br><span class="line">                                        ;;      SP += <span class="number">32</span></span><br><span class="line">                                        ;;      <span class="keyword">return</span></span><br><span class="line">                                        ;; &#125;</span><br></pre></td></tr></table></figure><p>switchè¯­å¥ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤ä¼šå°†ç›®æ ‡ç±»å‹çš„ <code>hash</code> ä¸æ¥å£å˜é‡ä¸­çš„ <code>itab.hash</code> è¿›è¡Œæ¯”è¾ƒï¼š</p><ul><li>å¦‚æœä¸¤è€…ç›¸ç­‰æ„å‘³ç€å˜é‡çš„å…·ä½“ç±»å‹æ˜¯</li></ul>  <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cat</span></span><br></pre></td></tr></table></figure><p>  ï¼Œæˆ‘ä»¬ä¼šè·³è½¬åˆ° 0080 æ‰€åœ¨çš„åˆ†æ”¯å®Œæˆç±»å‹è½¬æ¢ã€‚</p><ol><li>è·å– SP+8 å­˜å‚¨çš„ <code>Cat</code> ç»“æ„ä½“æŒ‡é’ˆï¼›</li><li>å°†ç»“æ„ä½“æŒ‡é’ˆæ‹·è´åˆ°æ ˆé¡¶ï¼›</li><li>è°ƒç”¨ <code>Quack</code> æ–¹æ³•ï¼›</li><li>æ¢å¤å‡½æ•°çš„æ ˆå¹¶è¿”å›ï¼›</li></ol><ul><li>å¦‚æœæ¥å£ä¸­å­˜åœ¨çš„å…·ä½“ç±»å‹ä¸æ˜¯ <code>Cat</code>ï¼Œå°±ä¼šç›´æ¥æ¢å¤æ ˆæŒ‡é’ˆå¹¶è¿”å›åˆ°è°ƒç”¨æ–¹ï¼›</li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-interface-to-struct.png" alt="golang-interface-to-struct"></p><p>ä¸Šå›¾å±•ç¤ºäº†è°ƒç”¨ <code>Quack</code> æ–¹æ³•æ—¶çš„å †æ ˆæƒ…å†µï¼Œå…¶ä¸­ <code>Cat</code> ç»“æ„ä½“å­˜å‚¨åœ¨ SP+8 ~ SP+24 ä¸Šï¼Œ<code>Cat</code> æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆé¡¶å¹¶æŒ‡å‘ä¸Šè¿°ç»“æ„ä½“ã€‚</p><h3 id="ç©ºæ¥å£"><a href="#ç©ºæ¥å£" class="headerlink" title="ç©ºæ¥å£"></a>ç©ºæ¥å£</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ç©ºæ¥å£ç±»å‹ <code>interface&#123;&#125;</code> è¿›è¡Œç±»å‹æ–­è¨€æ—¶ï¼Œå¦‚æœä¸å…³é—­ Go è¯­è¨€ç¼–è¯‘å™¨çš„ä¼˜åŒ–é€‰é¡¹ï¼Œç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ˜¯å·®ä¸å¤šçš„ã€‚ç¼–è¯‘å™¨ä¼šçœç•¥å°† <code>Cat</code> ç»“æ„ä½“è½¬æ¢æˆ <code>eface</code> çš„è¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">interface</span>&#123;&#125; = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line"><span class="keyword">switch</span> c.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> *Cat:</span><br><span class="line">cat := c.(*Cat)</span><br><span class="line">cat.Quack()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç¦ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä¸Šè¿°ä»£ç ä¼šåœ¨ç±»å‹æ–­è¨€æ—¶å°±ä¸æ˜¯ç›´æ¥è·å–å˜é‡ä¸­å…·ä½“ç±»å‹çš„ <code>_type</code>ï¼Œè€Œæ˜¯ä» <code>eface._type</code> ä¸­è·å–ï¼Œæ±‡ç¼–æŒ‡ä»¤ä»ç„¶ä¼šä½¿ç”¨ç›®æ ‡ç±»å‹çš„ <code>hash</code> å­—æ®µä¸å˜é‡çš„ç±»å‹æ¯”è¾ƒã€‚</p><h2 id="åŠ¨æ€æ´¾å‘"><a href="#åŠ¨æ€æ´¾å‘" class="headerlink" title="åŠ¨æ€æ´¾å‘"></a>åŠ¨æ€æ´¾å‘</h2><p>åŠ¨æ€æ´¾å‘ï¼ˆDynamic dispatchï¼‰æ˜¯åœ¨è¿è¡ŒæœŸé—´é€‰æ‹©å…·ä½“å¤šæ€æ“ä½œï¼ˆæ–¹æ³•æˆ–è€…å‡½æ•°ï¼‰æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ä¸€ç§åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­å¸¸è§çš„ç‰¹æ€§ã€‚Go è¯­è¨€è™½ç„¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä½†æ˜¯æ¥å£çš„å¼•å…¥ä¸ºå®ƒå¸¦æ¥äº†åŠ¨æ€æ´¾å‘è¿™ä¸€ç‰¹æ€§ï¼Œè°ƒç”¨æ¥å£ç±»å‹çš„æ–¹æ³•æ—¶ï¼Œå¦‚æœç¼–è¯‘æœŸé—´ä¸èƒ½ç¡®è®¤æ¥å£çš„ç±»å‹ï¼ŒGo è¯­è¨€ä¼šåœ¨è¿è¡ŒæœŸé—´å†³å®šå…·ä½“è°ƒç”¨è¯¥æ–¹æ³•çš„å“ªä¸ªå®ç°ã€‚</p><p>åœ¨å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ä¸­ï¼Œ<code>main</code> å‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡ <code>Quack</code> æ–¹æ³•ï¼š</p><ol><li>ç¬¬ä¸€æ¬¡ä»¥ <code>Duck</code> æ¥å£ç±»å‹çš„èº«ä»½è°ƒç”¨ï¼Œè°ƒç”¨æ—¶éœ€è¦ç»è¿‡è¿è¡Œæ—¶çš„åŠ¨æ€æ´¾å‘ï¼›</li><li>ç¬¬äºŒæ¬¡ä»¥ <code>*Cat</code> å…·ä½“ç±»å‹çš„èº«ä»½è°ƒç”¨ï¼Œç¼–è¯‘æœŸå°±ä¼šç¡®å®šè°ƒç”¨çš„å‡½æ•°ï¼š</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c Duck = &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line">c.Quack()</span><br><span class="line">c.(*Cat).Quack()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºç¼–è¯‘å™¨ä¼˜åŒ–å½±å“äº†æˆ‘ä»¬å¯¹åŸå§‹æ±‡ç¼–æŒ‡ä»¤çš„ç†è§£ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ç¼–è¯‘å‚æ•° <code>-N</code> å…³é—­ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚å¦‚æœä¸æŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šå¯¹ä»£ç è¿›è¡Œé‡å†™ï¼Œä¸æœ€åˆç”Ÿæˆçš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸€äº›åå·®ï¼Œä¾‹å¦‚ï¼š</p><ul><li>å› ä¸ºæ¥å£ç±»å‹ä¸­çš„ <code>tab</code> å‚æ•°å¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥ä¼˜åŒ–ä» <code>Cat</code> è½¬æ¢åˆ° <code>Duck</code> çš„è¿‡ç¨‹ï¼›</li><li>å› ä¸ºå˜é‡çš„å…·ä½“ç±»å‹æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥åˆ é™¤ä» <code>Duck</code> æ¥å£ç±»å‹è½¬æ¢åˆ° <code>*Cat</code> å…·ä½“ç±»å‹æ—¶å¯èƒ½ä¼šå‘ç”Ÿ <code>panic</code> çš„åˆ†æ”¯ï¼›</li><li>â€¦</li></ul><p>åœ¨å…·ä½“åˆ†æè°ƒç”¨ <code>Quack</code> æ–¹æ³•çš„ä¸¤ç§å§¿åŠ¿ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ <code>Cat</code> ç»“æ„ä½“ç©¶ç«Ÿæ˜¯å¦‚ä½•åˆå§‹åŒ–çš„ï¼Œä»¥åŠåˆå§‹åŒ–å®Œæˆåçš„æ ˆä¸Šæœ‰å“ªäº›æ•°æ®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LEAQ<span class="keyword">type</span>.<span class="string">&quot;&quot;</span>.Cat(SB), AX                </span><br><span class="line">MOVQAX, (SP)</span><br><span class="line">CALLruntime.newobject(SB)              ;; SP + <span class="number">8</span> = <span class="built_in">new</span>(Cat)</span><br><span class="line">MOVQ<span class="number">8</span>(SP), DI                          ;; DI = SP + <span class="number">8</span></span><br><span class="line">MOVQDI, <span class="string">&quot;&quot;</span>..autotmp_2+<span class="number">32</span>(SP)           ;; SP + <span class="number">32</span> = DI</span><br><span class="line">MOVQ$<span class="number">8</span>, <span class="number">8</span>(DI)                          ;; StringHeader(cat).Len = <span class="number">8</span></span><br><span class="line">LEAQ<span class="keyword">go</span>.<span class="keyword">string</span>.<span class="string">&quot;grooming&quot;</span>(SB), AX       ;; AX = &amp;<span class="string">&quot;grooming&quot;</span></span><br><span class="line">MOVQAX, (DI)                           ;; StringHeader(cat).Data = AX</span><br><span class="line">MOVQ<span class="string">&quot;&quot;</span>..autotmp_2+<span class="number">32</span>(SP), AX           ;; AX = &amp;Cat&#123;...&#125;</span><br><span class="line">MOVQAX, <span class="string">&quot;&quot;</span>..autotmp_1+<span class="number">40</span>(SP)           ;; SP + <span class="number">40</span> = &amp;Cat&#123;...&#125;</span><br><span class="line">LEAQ<span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck(SB), CX    ;; CX = &amp;<span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck</span><br><span class="line">MOVQCX, <span class="string">&quot;&quot;</span>.c+<span class="number">48</span>(SP)                    ;; iface(c).tab = SP + <span class="number">48</span> = CX</span><br><span class="line">MOVQAX, <span class="string">&quot;&quot;</span>.c+<span class="number">56</span>(SP)                    ;; iface(c).data = SP + <span class="number">56</span> = AX</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„åˆå§‹åŒ–è¿‡ç¨‹å…¶å®å’Œä¸Šä¸¤èŠ‚ä¸­çš„è¿‡ç¨‹æ²¡æœ‰å¤ªå¤šçš„å·®åˆ«ï¼Œå®ƒå…ˆåˆå§‹åŒ–äº† <code>Cat</code> ç»“æ„ä½“æŒ‡é’ˆï¼Œå†å°† <code>Cat</code> å’Œ <code>tab</code> æ‰“åŒ…æˆäº†ä¸€ä¸ª <code>iface</code> ç±»å‹çš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹åˆå§‹åŒ–ç»“æŸåçš„æ ˆæƒ…å†µï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/KWUkzZ8r4b2CH3p.png" alt="stack-after-initialize"></p><p><strong>å›¾ 4-14 æ¥å£ç±»å‹åˆå§‹åŒ–åçš„æ ˆ</strong></p><ul><li>SP æ˜¯ <code>Cat</code> ç±»å‹ï¼Œå®ƒä¹Ÿæ˜¯è¿è¡Œæ—¶ <a href="https://github.com/golang/go/blob/5042317d6919d4c84557e04be35130430e8d1dd4/src/runtime/malloc.go#L1162-L1164"><code>runtime.newobject</code></a> æ–¹æ³•çš„å‚æ•°ï¼›</li><li>SP+8 æ˜¯ <a href="https://github.com/golang/go/blob/5042317d6919d4c84557e04be35130430e8d1dd4/src/runtime/malloc.go#L1162-L1164"><code>runtime.newobject</code></a> æ–¹æ³•çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘å †ä¸Šçš„ <code>Cat</code> ç»“æ„ä½“çš„æŒ‡é’ˆï¼›</li><li>SP+32ã€SP+40 æ˜¯å¯¹ SP+8 çš„æ‹·è´ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆéƒ½ä¼šæŒ‡å‘æ ˆä¸Šçš„ <code>Cat</code> ç»“æ„ä½“ï¼›</li><li>SP+48 ~ SP+64 æ˜¯æ¥å£å˜é‡ <code>iface</code> ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«äº† <code>tab</code> ç»“æ„ä½“æŒ‡é’ˆå’Œ <code>*Cat</code> æŒ‡é’ˆï¼›</li></ul><p>åˆå§‹åŒ–è¿‡ç¨‹ç»“æŸä¹‹åï¼Œæˆ‘ä»¬è¿›å…¥åˆ°äº†åŠ¨æ€æ´¾å‘çš„è¿‡ç¨‹ï¼Œ<code>c.Quack()</code> è¯­å¥å±•å¼€çš„æ±‡ç¼–æŒ‡ä»¤ä¼šåœ¨è¿è¡Œæ—¶ç¡®å®šå‡½æ•°æŒ‡é’ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MOVQ<span class="string">&quot;&quot;</span>.c+<span class="number">48</span>(SP), AX                    ;; AX = iface(c).tab</span><br><span class="line">MOVQ<span class="number">24</span>(AX), AX                         ;; AX = iface(c).tab.fun[<span class="number">0</span>] = Cat.Quack</span><br><span class="line">MOVQ<span class="string">&quot;&quot;</span>.c+<span class="number">56</span>(SP), CX                    ;; CX = iface(c).data</span><br><span class="line">MOVQCX, (SP)                           ;; SP = CX = &amp;Cat&#123;...&#125;</span><br><span class="line">CALLAX                                 ;; SP.Quack()</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å¯ä»¥åˆ†æˆä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>ä»æ¥å£å˜é‡ä¸­è·å–äº†ä¿å­˜ <code>Cat.Quack</code> æ–¹æ³•æŒ‡é’ˆçš„ <code>tab.func[0]</code>ï¼›</li><li>æ¥å£å˜é‡åœ¨ä¸­çš„æ•°æ®ä¼šè¢«æ‹·è´åˆ°æ ˆé¡¶ï¼›</li><li>æ–¹æ³•æŒ‡é’ˆä¼šè¢«æ‹·è´åˆ°å¯„å­˜å™¨ä¸­å¹¶é€šè¿‡æ±‡ç¼–æŒ‡ä»¤ <code>CALL</code> è§¦å‘ï¼š</li></ol><p>å¦ä¸€ä¸ªè°ƒç”¨ <code>Quack</code> æ–¹æ³•çš„è¯­å¥ <code>c.(*Cat).Quack()</code> ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤çœ‹èµ·æ¥ä¼šæœ‰ä¸€äº›å¤æ‚ï¼Œä½†æ˜¯ä»£ç å‰åŠéƒ¨åˆ†éƒ½æ˜¯åœ¨åšç±»å‹è½¬æ¢ï¼Œå°†æ¥å£ç±»å‹è½¬æ¢æˆ <code>*Cat</code> ç±»å‹ï¼Œåªæœ‰æœ€åä¸¤è¡Œä»£ç æ‰æ˜¯å‡½æ•°è°ƒç”¨ç›¸å…³çš„æŒ‡ä»¤ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MOVQ<span class="string">&quot;&quot;</span>.c+<span class="number">56</span>(SP), AX                    ;; AX = iface(c).data = &amp;Cat&#123;...&#125;</span><br><span class="line">MOVQ<span class="string">&quot;&quot;</span>.c+<span class="number">48</span>(SP), CX                    ;; CX = iface(c).tab</span><br><span class="line">LEAQ<span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck(SB), DX    ;; DX = &amp;&amp;<span class="keyword">go</span>.itab.*<span class="string">&quot;&quot;</span>.Cat,<span class="string">&quot;&quot;</span>.Duck</span><br><span class="line">CMPQCX, DX                             ;; CMP(CX, DX)</span><br><span class="line">JEQ<span class="number">163</span></span><br><span class="line">JMP<span class="number">201</span></span><br><span class="line">MOVQAX, <span class="string">&quot;&quot;</span>..autotmp_3+<span class="number">24</span>(SP)           ;; SP+<span class="number">24</span> = &amp;Cat&#123;...&#125;</span><br><span class="line">MOVQAX, (SP)                           ;; SP = &amp;Cat&#123;...&#125;</span><br><span class="line">CALL<span class="string">&quot;&quot;</span>.(*Cat).Quack(SB)                ;; SP.Quack()</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„å‡ è¡Œä»£ç åªæ˜¯å°† <code>Cat</code> æŒ‡é’ˆæ‹·è´åˆ°äº†æ ˆé¡¶å¹¶è°ƒç”¨ <code>Quack</code> æ–¹æ³•ã€‚è¿™ä¸€æ¬¡è°ƒç”¨çš„å‡½æ•°æŒ‡é’ˆåœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šäº†ï¼Œæ‰€ä»¥è¿è¡Œæ—¶å°±ä¸éœ€è¦åŠ¨æ€æŸ¥æ‰¾æ–¹æ³•çš„å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MOVQ<span class="string">&quot;&quot;</span>.c+<span class="number">48</span>(SP), AX                    ;; AX = iface(c).tab</span><br><span class="line">MOVQ<span class="number">24</span>(AX), AX                         ;; AX = iface(c).tab.fun[<span class="number">0</span>] = Cat.Quack</span><br><span class="line">MOVQ<span class="string">&quot;&quot;</span>.c+<span class="number">56</span>(SP), CX                    ;; CX = iface(c).data</span><br></pre></td></tr></table></figure><p>ä¸¤æ¬¡æ–¹æ³•è°ƒç”¨å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤å·®å¼‚å°±æ˜¯åŠ¨æ€æ´¾å‘å¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œè¿™äº›é¢å¤–å¼€é”€åœ¨æœ‰ä½å»¶æ—¶ã€é«˜ååé‡éœ€æ±‚çš„æœåŠ¡ä¸­æ˜¯ä¸èƒ½è¢«å¿½è§†çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸€ä¸‹äº§ç”Ÿçš„é¢å¤–æ±‡ç¼–æŒ‡ä»¤å¯¹æ€§èƒ½é€ æˆçš„å½±å“ã€‚</p><h4 id="åŸºå‡†æµ‹è¯•"><a href="#åŸºå‡†æµ‹è¯•" class="headerlink" title="åŸºå‡†æµ‹è¯•"></a>åŸºå‡†æµ‹è¯•</h4><p>ä¸‹é¢ä»£ç ä¸­çš„ä¸¤ä¸ªæ–¹æ³• <code>BenchmarkDirectCall</code> å’Œ <code>BenchmarkDynamicDispatch</code> åˆ†åˆ«ä¼šè°ƒç”¨ç»“æ„ä½“æ–¹æ³•å’Œæ¥å£æ–¹æ³•ï¼Œåœ¨æ¥å£ä¸Šè°ƒç”¨æ–¹æ³•æ—¶ä¼šä½¿ç”¨åŠ¨æ€æ´¾å‘æœºåˆ¶ï¼Œæˆ‘ä»¬ä»¥ç›´æ¥è°ƒç”¨ä½œä¸ºåŸºå‡†åˆ†æåŠ¨æ€æ´¾å‘å¸¦æ¥äº†å¤šå°‘é¢å¤–å¼€é”€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDirectCall</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">c := &amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line"><span class="comment">// MOVQAX, &quot;&quot;.c+24(SP)</span></span><br><span class="line"><span class="comment">// MOVQAX, (SP)</span></span><br><span class="line"><span class="comment">// CALL&quot;&quot;.(*Cat).Quack(SB)</span></span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDynamicDispatch</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">c := Duck(&amp;Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line"><span class="comment">// MOVQ&quot;&quot;.d+56(SP), AX</span></span><br><span class="line"><span class="comment">// MOVQ24(AX), AX</span></span><br><span class="line"><span class="comment">// MOVQ&quot;&quot;.d+64(SP), CX</span></span><br><span class="line"><span class="comment">// MOVQCX, (SP)</span></span><br><span class="line"><span class="comment">// CALLAX</span></span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿ç”¨ 1 ä¸ª CPU è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæ¯ä¸€ä¸ªåŸºå‡†æµ‹è¯•éƒ½ä¼šè¢«æ‰§è¡Œ 3 æ¬¡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> test -gcflags=-N -benchmem -test.count=<span class="number">3</span> -test.cpu=<span class="number">1</span> -test.benchtime=<span class="number">1</span>s -bench=.</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: github.com/golang/playground</span><br><span class="line">BenchmarkDirectCall      <span class="number">500000000</span>         <span class="number">3.11</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDirectCall      <span class="number">500000000</span>         <span class="number">2.94</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDirectCall      <span class="number">500000000</span>         <span class="number">3.04</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDynamicDispatch <span class="number">500000000</span>         <span class="number">3.40</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDynamicDispatch <span class="number">500000000</span>         <span class="number">3.79</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDynamicDispatch <span class="number">500000000</span>         <span class="number">3.55</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br></pre></td></tr></table></figure><ul><li>è°ƒç”¨ç»“æ„ä½“æ–¹æ³•æ—¶ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨éœ€è¦ <code>~3.03ns</code>ï¼›</li><li>ä½¿ç”¨åŠ¨æ€æ´¾å‘æ—¶ï¼Œæ¯ä¸€è°ƒç”¨éœ€è¦ <code>~3.58ns</code>ï¼›</li></ul><p>åœ¨å…³é—­ç¼–è¯‘å™¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä»ä¸Šé¢çš„æ•°æ®æ¥çœ‹ï¼ŒåŠ¨æ€æ´¾å‘ç”Ÿæˆçš„æŒ‡ä»¤ä¼šå¸¦æ¥ <code>~18%</code> å·¦å³çš„é¢å¤–æ€§èƒ½å¼€é”€ã€‚</p><p>è¿™äº›æ€§èƒ½å¼€é”€åœ¨ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿä¸­ä¸ä¼šå¸¦æ¥å¤ªå¤šçš„å½±å“ã€‚ä¸€ä¸ªé¡¹ç›®ä¸å¯èƒ½åªä½¿ç”¨åŠ¨æ€æ´¾å‘ï¼Œè€Œä¸”å¦‚æœæˆ‘ä»¬å¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–åï¼ŒåŠ¨æ€æ´¾å‘çš„é¢å¤–å¼€é”€ä¼šé™ä½è‡³ <code>~5%</code>ï¼Œè¿™å¯¹åº”ç”¨æ€§èƒ½çš„æ•´ä½“å½±å“å°±æ›´å°äº†ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨æ¥å£å¸¦æ¥çš„å¥½å¤„ç›¸æ¯”ï¼ŒåŠ¨æ€æ´¾å‘çš„é¢å¤–å¼€é”€å¾€å¾€å¯ä»¥å¿½ç•¥ã€‚</p><p>ä¸Šé¢çš„æ€§èƒ½æµ‹è¯•å»ºç«‹åœ¨å®ç°å’Œè°ƒç”¨æ–¹æ³•çš„éƒ½æ˜¯ç»“æ„ä½“æŒ‡é’ˆä¸Šï¼Œå½“æˆ‘ä»¬å°†ç»“æ„ä½“æŒ‡é’ˆæ¢æˆç»“æ„ä½“åˆä¼šæœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDirectCall</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">c := Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line"><span class="comment">// MOVQAX, (SP)</span></span><br><span class="line"><span class="comment">// MOVQ$8, 8(SP)</span></span><br><span class="line"><span class="comment">// CALL&quot;&quot;.Cat.Quack(SB)</span></span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDynamicDispatch</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">c := Duck(Cat&#123;Name: <span class="string">&quot;grooming&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line"><span class="comment">// MOVQ16(SP), AX</span></span><br><span class="line"><span class="comment">// MOVQ24(SP), CX</span></span><br><span class="line"><span class="comment">// MOVQAX, &quot;&quot;.d+32(SP)</span></span><br><span class="line"><span class="comment">// MOVQCX, &quot;&quot;.d+40(SP)</span></span><br><span class="line"><span class="comment">// MOVQ&quot;&quot;.d+32(SP), AX</span></span><br><span class="line"><span class="comment">// MOVQ24(AX), AX</span></span><br><span class="line"><span class="comment">// MOVQ&quot;&quot;.d+40(SP), CX</span></span><br><span class="line"><span class="comment">// MOVQCX, (SP)</span></span><br><span class="line"><span class="comment">// CALLAX</span></span><br><span class="line">c.Quack()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é‡æ–°æ‰§è¡Œç›¸åŒçš„åŸºå‡†æµ‹è¯•æ—¶ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> test -gcflags=-N -benchmem -test.count=<span class="number">3</span> -test.cpu=<span class="number">1</span> -test.benchtime=<span class="number">1</span>s .</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: github.com/golang/playground</span><br><span class="line">BenchmarkDirectCall      <span class="number">500000000</span>         <span class="number">3.15</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDirectCall      <span class="number">500000000</span>         <span class="number">3.02</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDirectCall      <span class="number">500000000</span>         <span class="number">3.09</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDynamicDispatch <span class="number">200000000</span>         <span class="number">6.92</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDynamicDispatch <span class="number">200000000</span>         <span class="number">6.91</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br><span class="line">BenchmarkDynamicDispatch <span class="number">200000000</span>         <span class="number">7.10</span> ns/op       <span class="number">0</span> B/op       <span class="number">0</span> allocs/op</span><br></pre></td></tr></table></figure><p>ç›´æ¥è°ƒç”¨æ–¹æ³•éœ€è¦æ¶ˆè€—æ—¶é—´çš„å¹³å‡å€¼å’Œä½¿ç”¨æŒ‡é’ˆå®ç°æ¥å£æ—¶å·®ä¸å¤šï¼Œçº¦ä¸º <code>~3.09ns</code>ï¼Œè€Œä½¿ç”¨åŠ¨æ€æ´¾å‘è°ƒç”¨æ–¹æ³•å´éœ€è¦ <code>~6.98ns</code> ç›¸æ¯”ç›´æ¥è°ƒç”¨é¢å¤–æ¶ˆè€—äº† <code>~125%</code> çš„æ—¶é—´ï¼Œä»ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡ºåè€…çš„é¢å¤–å¼€é”€ä¼šé«˜å¾ˆå¤šã€‚</p><div class="table-container"><table><thead><tr><th></th><th>ç›´æ¥è°ƒç”¨</th><th>åŠ¨æ€æ´¾å‘</th></tr></thead><tbody><tr><td>æŒ‡é’ˆ</td><td>~3.03ns</td><td>~3.58ns</td></tr><tr><td>ç»“æ„ä½“</td><td>~3.09ns</td><td>~6.98ns</td></tr></tbody></table></div><p>ä»ä¸Šè¿°è¡¨æ ¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ç»“æ„ä½“æ¥å®ç°æ¥å£å¸¦æ¥çš„å¼€é”€ä¼šå¤§äºä½¿ç”¨æŒ‡é’ˆå®ç°ï¼Œè€ŒåŠ¨æ€æ´¾å‘åœ¨ç»“æ„ä½“ä¸Šçš„è¡¨ç°éå¸¸å·®ï¼Œè¿™ä¹Ÿæé†’æˆ‘ä»¬åº”å½“å°½é‡é¿å…ä½¿ç”¨ç»“æ„ä½“ç±»å‹å®ç°æ¥å£ã€‚</p><p>ä½¿ç”¨ç»“æ„ä½“å¸¦æ¥çš„å·¨å¤§æ€§èƒ½å·®å¼‚ä¸åªæ˜¯æ¥å£å¸¦æ¥çš„é—®é¢˜ï¼Œå¸¦æ¥æ€§èƒ½é—®é¢˜ä¸»è¦å› ä¸º Go è¯­è¨€åœ¨å‡½æ•°è°ƒç”¨æ—¶æ˜¯ä¼ å€¼çš„ï¼ŒåŠ¨æ€æ´¾å‘çš„è¿‡ç¨‹åªæ˜¯æ”¾å¤§äº†å‚æ•°æ‹·è´å¸¦æ¥çš„å½±å“ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é‡æ–°å›é¡¾ä¸€ä¸‹æœ¬èŠ‚ä»‹ç»çš„å†…å®¹ï¼Œæˆ‘ä»¬åœ¨å¼€å¤´ç®€å•ä»‹ç»äº†ä½¿ç”¨ Go è¯­è¨€æ¥å£çš„å¸¸è§é—®é¢˜ï¼Œä¾‹å¦‚ä½¿ç”¨ä¸åŒç±»å‹å®ç°æ¥å£å¸¦æ¥çš„å·®å¼‚ã€å‡½æ•°è°ƒç”¨æ—¶å‘ç”Ÿçš„éšå¼ç±»å‹è½¬æ¢ï¼›æˆ‘ä»¬è¿˜åˆ†æäº†æ¥å£çš„ç±»å‹è½¬æ¢ã€ç±»å‹æ–­è¨€ä»¥åŠåŠ¨æ€æ´¾å‘æœºåˆ¶ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.tapirgames.com/blog/golang-interface-implementation">How Interfaces Work in Go</a></li><li><a href="https://golang.org/doc/effective_go.html#interfaces_and_types">Interfaces and other types Â· Effective Go</a></li><li><a href="https://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go">How to use interfaces in Go</a></li><li><a href="https://research.swtch.com/interfaces">Go Data Structures: Interfaces</a></li><li><a href="https://en.wikipedia.org/wiki/Duck_typing">Duck typing Â· Wikipedia</a></li><li><a href="http://www.robelle.com/smugbook/posix.html">What is POSIX?</a></li><li><a href="https://github.com/teh-cmc/go-internals/blob/master/chapter2_interfaces/README.md">Chapter II: Interfaces</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„è°ƒåº¦å™¨</title>
      <link href="/2020/01/10/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6/"/>
      <url>/2020/01/10/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>Go è¯­è¨€åœ¨å¹¶å‘ç¼–ç¨‹æ–¹é¢æœ‰å¼ºå¤§çš„èƒ½åŠ›ï¼Œè¿™ç¦»ä¸å¼€è¯­è¨€å±‚é¢å¯¹å¹¶å‘ç¼–ç¨‹çš„æ”¯æŒã€‚æœ¬èŠ‚ä¼šä»‹ç» Go è¯­è¨€è¿è¡Œæ—¶è°ƒåº¦å™¨çš„å®ç°åŸç†ï¼Œå…¶ä¸­åŒ…å«è°ƒåº¦å™¨çš„è®¾è®¡ä¸å®ç°åŸç†ã€æ¼”å˜è¿‡ç¨‹ä»¥åŠä¸è¿è¡Œæ—¶è°ƒåº¦ç›¸å…³çš„æ•°æ®ç»“æ„ã€‚</p><a id="more"></a><p>è°ˆåˆ° Go è¯­è¨€è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬ç»•ä¸å¼€çš„æ˜¯æ“ä½œç³»ç»Ÿã€è¿›ç¨‹ä¸çº¿ç¨‹è¿™äº›æ¦‚å¿µï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦æ—¶çš„æœ€åŸºæœ¬å•å…ƒï¼Œè€Œ Linux åœ¨è°ƒåº¦å™¨å¹¶ä¸åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹çš„è°ƒåº¦ï¼Œå®ƒä»¬åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šä¹Ÿæœ‰ä¸åŒçš„å®ç°ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°çš„å®ç°ä¸­çº¿ç¨‹éƒ½å±äºè¿›ç¨‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/Xl2LyF1jMsRbIPY.png" alt="process-and-threads"></p><p>å¤šä¸ªçº¿ç¨‹å¯ä»¥å±äºåŒä¸€ä¸ªè¿›ç¨‹å¹¶å…±äº«å†…å­˜ç©ºé—´ã€‚å› ä¸ºå¤šçº¿ç¨‹ä¸éœ€è¦åˆ›å»ºæ–°çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿä¸éœ€è¦å†…å­˜ç®¡ç†å•å…ƒå¤„ç†ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ä¹Ÿæ­£æ˜¯åŸºäºå…±äº«çš„å†…å­˜è¿›è¡Œçš„ï¼Œä¸é‡é‡çº§çš„è¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹æ˜¾å¾—æ¯”è¾ƒè½»é‡ã€‚</p><p>è™½ç„¶çº¿ç¨‹æ¯”è¾ƒè½»é‡ï¼Œä½†æ˜¯åœ¨è°ƒåº¦æ—¶ä¹Ÿæœ‰æ¯”è¾ƒå¤§çš„é¢å¤–å¼€é”€ã€‚æ¯ä¸ªçº¿ç¨‹ä¼šéƒ½å ç”¨ 1 å…†ä»¥ä¸Šçš„å†…å­˜ç©ºé—´ï¼Œåœ¨å¯¹çº¿ç¨‹è¿›è¡Œåˆ‡æ¢æ—¶ä¸æ­¢ä¼šæ¶ˆè€—è¾ƒå¤šçš„å†…å­˜ï¼Œæ¢å¤å¯„å­˜å™¨ä¸­çš„å†…å®¹è¿˜éœ€è¦å‘æ“ä½œç³»ç»Ÿç”³è¯·æˆ–è€…é”€æ¯å¯¹åº”çš„èµ„æºï¼Œæ¯ä¸€æ¬¡çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éƒ½éœ€è¦æ¶ˆè€— ~1us å·¦å³çš„æ—¶é—´ï¼Œä½†æ˜¯ Go è°ƒåº¦å™¨å¯¹ Goroutine çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çº¦ä¸º ~0.2usï¼Œå‡å°‘äº† 80% çš„é¢å¤–å¼€é”€ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/sxOWUSy4Qq6PENo.png" alt="goroutines-on-thread"></p><p>Go è¯­è¨€çš„è°ƒåº¦å™¨é€šè¿‡ä½¿ç”¨ä¸ CPU æ•°é‡ç›¸ç­‰çš„çº¿ç¨‹å‡å°‘çº¿ç¨‹é¢‘ç¹åˆ‡æ¢çš„å†…å­˜å¼€é”€ï¼ŒåŒæ—¶åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œé¢å¤–å¼€é”€æ›´ä½çš„ Goroutine æ¥é™ä½æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„è´Ÿè½½ã€‚</p><h2 id="è®¾è®¡åŸç†"><a href="#è®¾è®¡åŸç†" class="headerlink" title="è®¾è®¡åŸç†"></a>è®¾è®¡åŸç†</h2><p>ä»Šå¤©çš„ Go è¯­è¨€è°ƒåº¦å™¨æœ‰ç€ä¼˜å¼‚çš„æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å›å¤´çœ‹ Go è¯­è¨€çš„ 0.x ç‰ˆæœ¬çš„è°ƒåº¦å™¨å°±ä¼šå‘ç°æœ€åˆçš„è°ƒåº¦å™¨ä¸ä»…å®ç°éå¸¸ç®€é™‹ï¼Œä¹Ÿæ— æ³•æ”¯æ’‘é«˜å¹¶å‘çš„æœåŠ¡ã€‚è°ƒåº¦å™¨ç»è¿‡å‡ ä¸ªå¤§ç‰ˆæœ¬çš„è¿­ä»£æ‰æœ‰ä»Šå¤©çš„ä¼˜å¼‚æ€§èƒ½ï¼Œå‡ ä¸ªä¸åŒç‰ˆæœ¬çš„è°ƒåº¦å™¨å¼•å…¥äº†ä¸åŒçš„æ”¹è¿›ï¼Œä¹Ÿå­˜åœ¨ä¸åŒçš„ç¼ºé™·:</p><ul><li><p>å•çº¿ç¨‹è°ƒåº¦å™¨ <code>0.x</code></p><ul><li>åªåŒ…å« 40 å¤šè¡Œä»£ç ï¼›</li></ul></li><li><p>ç¨‹åºä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªæ´»è·ƒçº¿ç¨‹ï¼Œç”± G-M æ¨¡å‹ç»„æˆï¼›</p></li><li><p>å¤šçº¿ç¨‹è°ƒåº¦å™¨ <code>1.0</code></p><ul><li><p>å…è®¸è¿è¡Œå¤šçº¿ç¨‹çš„ç¨‹åºï¼›</p></li><li><p>å…¨å±€é”å¯¼è‡´ç«äº‰ä¸¥é‡ï¼›</p></li></ul></li><li><p>ä»»åŠ¡çªƒå–è°ƒåº¦å™¨ <code>1.1</code></p><ul><li><p>å¼•å…¥äº†å¤„ç†å™¨ Pï¼Œæ„æˆäº†ç›®å‰çš„ <strong>G-M-P</strong> æ¨¡å‹ï¼›</p></li><li><p>åœ¨å¤„ç†å™¨ P çš„åŸºç¡€ä¸Šå®ç°äº†åŸºäº<strong>å·¥ä½œçªƒå–</strong>çš„è°ƒåº¦å™¨ï¼›</p></li></ul></li><li><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒGoroutine ä¸ä¼šè®©å‡ºçº¿ç¨‹ï¼Œè¿›è€Œé€ æˆé¥¥é¥¿é—®é¢˜ï¼›</p><ul><li>æ—¶é—´è¿‡é•¿çš„åƒåœ¾å›æ”¶ï¼ˆStop-the-worldï¼ŒSTWï¼‰ä¼šå¯¼è‡´ç¨‹åºé•¿æ—¶é—´æ— æ³•å·¥ä½œï¼›</li></ul></li><li><p>æŠ¢å å¼è°ƒåº¦å™¨ <code>1.2 ~ è‡³ä»Š</code></p><ul><li>åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦å™¨ - 1.2 ~ 1.13</li><li>é€šè¿‡ç¼–è¯‘å™¨åœ¨å‡½æ•°è°ƒç”¨æ—¶æ’å…¥<strong>æŠ¢å æ£€æŸ¥</strong>æŒ‡ä»¤ï¼Œåœ¨å‡½æ•°è°ƒç”¨æ—¶æ£€æŸ¥å½“å‰ Goroutine æ˜¯å¦å‘èµ·äº†æŠ¢å è¯·æ±‚ï¼Œå®ç°åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦ï¼›<ul><li>Goroutine å¯èƒ½ä¼šå› ä¸ºåƒåœ¾å›æ”¶å’Œå¾ªç¯é•¿æ—¶é—´å ç”¨èµ„æºå¯¼è‡´ç¨‹åºæš‚åœï¼›</li></ul></li></ul></li><li><p>åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦å™¨ - 1.14 ~ è‡³ä»Š</p><ul><li>å®ç°<strong>åŸºäºä¿¡å·çš„çœŸæŠ¢å å¼è°ƒåº¦</strong>ï¼›<ul><li>åƒåœ¾å›æ”¶åœ¨æ‰«ææ ˆæ—¶ä¼šè§¦å‘æŠ¢å è°ƒåº¦ï¼›</li></ul></li><li>æŠ¢å çš„æ—¶é—´ç‚¹ä¸å¤Ÿå¤šï¼Œè¿˜ä¸èƒ½è¦†ç›–å…¨éƒ¨çš„è¾¹ç¼˜æƒ…å†µï¼›</li></ul></li><li><p>éå‡åŒ€å­˜å‚¨è®¿é—®è°ƒåº¦å™¨<code>ææ¡ˆ</code></p><ul><li>å¯¹è¿è¡Œæ—¶çš„å„ç§èµ„æºè¿›è¡Œåˆ†åŒºï¼›</li><li>å®ç°éå¸¸å¤æ‚ï¼Œåˆ°ä»Šå¤©è¿˜æ²¡æœ‰æä¸Šæ—¥ç¨‹ï¼›</li></ul></li></ul><p>é™¤äº†å¤šçº¿ç¨‹ã€ä»»åŠ¡çªƒå–å’ŒæŠ¢å å¼è°ƒåº¦å™¨ä¹‹å¤–ï¼ŒGo è¯­è¨€ç¤¾åŒºç›®å‰è¿˜æœ‰ä¸€ä¸ªéå‡åŒ€å­˜å‚¨è®¿é—®ï¼ˆNon-uniform memory accessï¼ŒNUMAï¼‰è°ƒåº¦å™¨çš„ææ¡ˆï¼ŒGo è¯­è¨€åœ¨æœªæ¥ä¹Ÿæœ‰å®ç°è¯¥ææ¡ˆçš„å¯èƒ½ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¾æ¬¡ä»‹ç»ä¸åŒç‰ˆæœ¬è°ƒåº¦å™¨çš„å®ç°åŸç†ä»¥åŠæœªæ¥å¯èƒ½ä¼šå®ç°çš„è°ƒåº¦å™¨ææ¡ˆã€‚</p><h3 id="å•çº¿ç¨‹è°ƒåº¦å™¨"><a href="#å•çº¿ç¨‹è°ƒåº¦å™¨" class="headerlink" title="å•çº¿ç¨‹è°ƒåº¦å™¨"></a>å•çº¿ç¨‹è°ƒåº¦å™¨</h3><p>0.x ç‰ˆæœ¬è°ƒåº¦å™¨åªåŒ…å«è¡¨ç¤º Goroutine çš„ G å’Œè¡¨ç¤ºçº¿ç¨‹çš„ M ä¸¤ç§ç»“æ„ï¼Œå…¨å±€ä¹Ÿåªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://github.com/golang/go/commit/96824000ed89d13665f6f24ddc10b3bf812e7f47">clean up scheduler</a> æäº¤ä¸­æ‰¾åˆ°å•çº¿ç¨‹è°ƒåº¦å™¨çš„æºä»£ç ï¼Œåœ¨è¿™æ—¶ Go è¯­è¨€çš„<a href="https://github.com/golang/go/blob/96824000ed89d13665f6f24ddc10b3bf812e7f47/src/runtime/proc.c">è°ƒåº¦å™¨</a>è¿˜æ˜¯ç”± C è¯­è¨€å®ç°çš„ï¼Œè°ƒåº¦å‡½æ•° <a href="https://github.com/golang/go/blob/96824000ed89d13665f6f24ddc10b3bf812e7f47/src/runtime/proc.c#L340"><code>runtime.schedule</code></a> ä¹ŸåªåŒ…å« 40 å¤šè¡Œä»£ç  ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scheduler</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">G* gp;</span><br><span class="line">lock(&amp;sched);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(gosave(&amp;m-&gt;sched))&#123;</span><br><span class="line">lock(&amp;sched);</span><br><span class="line">gp = m-&gt;curg;</span><br><span class="line"><span class="keyword">switch</span>(gp-&gt;status)&#123;</span><br><span class="line"><span class="keyword">case</span> Grunnable:</span><br><span class="line"><span class="keyword">case</span> Grunning:</span><br><span class="line">gp-&gt;status = Grunnable;</span><br><span class="line">gput(gp);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">notewakeup(&amp;gp-&gt;stopped);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gp = nextgandunlock();</span><br><span class="line">noteclear(&amp;gp-&gt;stopped);</span><br><span class="line">gp-&gt;status = Grunning;</span><br><span class="line">m-&gt;curg = gp;</span><br><span class="line">g = gp;</span><br><span class="line">gogo(&amp;gp-&gt;sched);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°ä¼šéµå¾ªå¦‚ä¸‹çš„è¿‡ç¨‹è°ƒåº¦ Goroutineï¼š</p><ol><li>è·å–è°ƒåº¦å™¨çš„å…¨å±€é”ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/96824000ed89d13665f6f24ddc10b3bf812e7f47/src/runtime/rt0_amd64.s#L69"><code>runtime.gosave</code></a> ä¿å­˜æ ˆå¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/96824000ed89d13665f6f24ddc10b3bf812e7f47/src/runtime/proc.c#L315"><code>runtime.nextgandunlock</code></a> è·å–ä¸‹ä¸€ä¸ªéœ€è¦è¿è¡Œçš„ Goroutine å¹¶è§£é”è°ƒåº¦å™¨ï¼›</li><li>ä¿®æ”¹å…¨å±€çº¿ç¨‹ <code>m</code> ä¸Šè¦æ‰§è¡Œçš„ Goroutineï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/96824000ed89d13665f6f24ddc10b3bf812e7f47/src/runtime/rt0_amd64.s#L69"><code>runtime.gogo</code></a> å‡½æ•°è¿è¡Œæœ€æ–°çš„ Goroutineï¼›</li></ol><p>è™½ç„¶è¿™ä¸ªå•çº¿ç¨‹è°ƒåº¦å™¨çš„å”¯ä¸€ä¼˜ç‚¹å°±æ˜¯<strong>èƒ½è¿è¡Œ</strong>ï¼Œä½†æ˜¯è¿™æ¬¡æäº¤å·²ç»åŒ…å«äº† G å’Œ M ä¸¤ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå»ºç«‹äº† Go è¯­è¨€è°ƒåº¦å™¨çš„æ¡†æ¶ã€‚</p><h3 id="å¤šçº¿ç¨‹è°ƒåº¦å™¨"><a href="#å¤šçº¿ç¨‹è°ƒåº¦å™¨" class="headerlink" title="å¤šçº¿ç¨‹è°ƒåº¦å™¨"></a>å¤šçº¿ç¨‹è°ƒåº¦å™¨</h3><p>Go è¯­è¨€åœ¨ 1.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒæ—¶å°±æ”¯æŒäº†å¤šçº¿ç¨‹çš„è°ƒåº¦å™¨ï¼Œä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬å‡ ä¹ä¸å¯ç”¨çš„è°ƒåº¦å™¨ç›¸æ¯”ï¼ŒGo è¯­è¨€å›¢é˜Ÿåœ¨è¿™ä¸€é˜¶æ®µå®ç°äº†ä»ä¸å¯ç”¨åˆ°å¯ç”¨çš„è·¨è¶Šã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://github.com/golang/go/blob/go1.0.1/src/pkg/runtime/proc.c"><code>pkg/runtime/proc.c</code></a> æ–‡ä»¶ä¸­æ‰¾åˆ° 1.0.1 ç‰ˆæœ¬çš„è°ƒåº¦å™¨ï¼Œå¤šçº¿ç¨‹ç‰ˆæœ¬çš„è°ƒåº¦å‡½æ•° <a href="https://github.com/golang/go/blob/go1.0.1/src/pkg/runtime/proc.c#L838"><code>runtime.schedule</code></a> åŒ…å« 70 å¤šè¡Œä»£ç ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¿ç•™äº†è¯¥å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">schedule</span><span class="params">(G *gp)</span> </span>&#123;</span><br><span class="line">schedlock();</span><br><span class="line"><span class="keyword">if</span>(gp != nil) &#123;</span><br><span class="line">gp-&gt;m = nil;</span><br><span class="line">uint32 v = runtimeÂ·xadd(&amp;runtimeÂ·sched.atomic, <span class="number">-1</span>&lt;&lt;mcpuShift);</span><br><span class="line"><span class="keyword">if</span>(atomic_mcpu(v) &gt; maxgomaxprocs)</span><br><span class="line">runtimeÂ·<span class="keyword">throw</span>(<span class="string">&quot;negative mcpu in scheduler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(gp-&gt;status)&#123;</span><br><span class="line"><span class="keyword">case</span> Grunning:</span><br><span class="line">gp-&gt;status = Grunnable;</span><br><span class="line">gput(gp);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> ...:</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">gp = nextgandunlock();</span><br><span class="line">gp-&gt;status = Grunning;</span><br><span class="line">m-&gt;curg = gp;</span><br><span class="line">gp-&gt;m = m;</span><br><span class="line">runtimeÂ·gogo(&amp;gp-&gt;sched, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä½“çš„é€»è¾‘ä¸å•çº¿ç¨‹è°ƒåº¦å™¨æ²¡æœ‰å¤ªå¤šåŒºåˆ«ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¨‹åºä¸­å¯èƒ½åŒæ—¶å­˜åœ¨å¤šä¸ªæ´»è·ƒçº¿ç¨‹ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹è°ƒåº¦å™¨å¼•å…¥äº† <code>GOMAXPROCS</code> å˜é‡å¸®åŠ©æˆ‘ä»¬çµæ´»æ§åˆ¶ç¨‹åºä¸­çš„æœ€å¤§å¤„ç†å™¨æ•°ï¼Œå³æ´»è·ƒçº¿ç¨‹æ•°ã€‚</p><p>å¤šçº¿ç¨‹è°ƒåº¦å™¨çš„ä¸»è¦é—®é¢˜æ˜¯è°ƒåº¦æ—¶çš„é”ç«äº‰ä¼šä¸¥é‡æµªè´¹èµ„æºï¼Œ<a href="http://golang.org/s/go11sched">Scalable Go Scheduler Design Doc</a> ä¸­å¯¹è°ƒåº¦å™¨åšçš„æ€§èƒ½æµ‹è¯•å‘ç° 14% çš„æ—¶é—´éƒ½èŠ±è´¹åœ¨ <a href="https://github.com/golang/go/blob/2fffba7fe19690e038314d17a117d6b87979c89f/src/pkg/runtime/os_linux.h#L9"><code>runtime.futex</code></a> ä¸Šï¼Œè¯¥è°ƒåº¦å™¨æœ‰ä»¥ä¸‹é—®é¢˜éœ€è¦è§£å†³ï¼š</p><ol><li>è°ƒåº¦å™¨å’Œé”æ˜¯å…¨å±€èµ„æºï¼Œæ‰€æœ‰çš„è°ƒåº¦çŠ¶æ€éƒ½æ˜¯ä¸­å¿ƒåŒ–å­˜å‚¨çš„ï¼Œé”ç«äº‰é—®ä¸¥é‡ï¼›</li><li>çº¿ç¨‹éœ€è¦ç»å¸¸äº’ç›¸ä¼ é€’å¯è¿è¡Œçš„ Goroutineï¼Œå¼•å…¥äº†å¤§é‡çš„å»¶è¿Ÿï¼›</li><li>æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦å¤„ç†å†…å­˜ç¼“å­˜ï¼Œå¯¼è‡´å¤§é‡çš„å†…å­˜å ç”¨å¹¶å½±å“æ•°æ®å±€éƒ¨æ€§ï¼ˆData localityï¼‰ï¼›</li><li>ç³»ç»Ÿè°ƒç”¨é¢‘ç¹é˜»å¡å’Œè§£é™¤é˜»å¡æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œå¢åŠ äº†é¢å¤–å¼€é”€ï¼›</li></ol><p>è¿™é‡Œçš„å…¨å±€é”é—®é¢˜å’Œ Linux æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨åœ¨æ—©æœŸé‡åˆ°çš„é—®é¢˜æ¯”è¾ƒç›¸ä¼¼ï¼Œè§£å†³çš„æ–¹æ¡ˆä¹Ÿéƒ½å¤§åŒå°å¼‚ã€‚</p><h3 id="ä»»åŠ¡çªƒå–è°ƒåº¦å™¨"><a href="#ä»»åŠ¡çªƒå–è°ƒåº¦å™¨" class="headerlink" title="ä»»åŠ¡çªƒå–è°ƒåº¦å™¨"></a>ä»»åŠ¡çªƒå–è°ƒåº¦å™¨</h3><p>2012 å¹´ Google çš„å·¥ç¨‹å¸ˆ Dmitry Vyukov åœ¨ <a href="http://golang.org/s/go11sched">Scalable Go Scheduler Design Doc</a> ä¸­æŒ‡å‡ºäº†ç°æœ‰å¤šçº¿ç¨‹è°ƒåº¦å™¨çš„é—®é¢˜å¹¶åœ¨å¤šçº¿ç¨‹è°ƒåº¦å™¨ä¸Šæå‡ºäº†ä¸¤ä¸ªæ”¹è¿›çš„æ‰‹æ®µï¼š</p><ol><li>åœ¨å½“å‰çš„ G-M æ¨¡å‹ä¸­å¼•å…¥äº†å¤„ç†å™¨ Pï¼Œå¢åŠ ä¸­é—´å±‚ï¼›</li><li>åœ¨å¤„ç†å™¨ P çš„åŸºç¡€ä¸Šå®ç°åŸºäºå·¥ä½œçªƒå–çš„è°ƒåº¦å™¨ï¼›</li></ol><p>åŸºäºä»»åŠ¡çªƒå–çš„ Go è¯­è¨€è°ƒåº¦å™¨ä½¿ç”¨äº†æ²¿ç”¨è‡³ä»Šçš„ G-M-P æ¨¡å‹ï¼Œæˆ‘ä»¬èƒ½åœ¨ <a href="https://github.com/golang/go/commit/779c45a50700bda0f6ec98429720802e6c1624e8">runtime: improved scheduler</a> æäº¤ä¸­æ‰¾åˆ°ä»»åŠ¡çªƒå–è°ƒåº¦å™¨åˆšè¢«å®ç°æ—¶çš„<a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c">æºä»£ç </a>ï¼Œè°ƒåº¦å™¨çš„ <a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c#L1039"><code>runtime.schedule</code></a> å‡½æ•°åœ¨è¿™ä¸ªç‰ˆæœ¬çš„è°ƒåº¦å™¨ä¸­åè€Œæ›´ç®€å•äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">static void schedule(void) &#123;</span><br><span class="line">    G *gp;</span><br><span class="line"> top:</span><br><span class="line">    <span class="keyword">if</span>(runtimeÂ·gcwaiting) &#123;</span><br><span class="line">        gcstopm();</span><br><span class="line">        <span class="keyword">goto</span> top;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gp = runqget(m-&gt;p);</span><br><span class="line">    <span class="keyword">if</span>(gp == <span class="literal">nil</span>)</span><br><span class="line">        gp = findrunnable();</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    execute(gp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å¦‚æœå½“å‰è¿è¡Œæ—¶åœ¨ç­‰å¾…åƒåœ¾å›æ”¶ï¼Œè°ƒç”¨ <a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c#L907"><code>runtime.gcstopm</code></a> å‡½æ•°ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c#L2075"><code>runtime.runqget</code></a> å’Œ <a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c#L956"><code>runtime.findrunnable</code></a> ä»æœ¬åœ°æˆ–è€…å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ä¸­è·å–å¾…æ‰§è¡Œçš„ Goroutineï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c#L929"><code>runtime.execute</code></a> å‡½æ•°åœ¨å½“å‰çº¿ç¨‹ M ä¸Šè¿è¡Œ Goroutineï¼›</li></ol><p>å½“å‰å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ä¸­ä¸åŒ…å« Goroutine æ—¶ï¼Œè°ƒç”¨ <a href="https://github.com/golang/go/blob/779c45a50700bda0f6ec98429720802e6c1624e8/src/pkg/runtime/proc.c#L956"><code>findrunnable</code></a> å‡½æ•°ä¼šè§¦å‘å·¥ä½œçªƒå–ï¼Œä»å…¶å®ƒçš„å¤„ç†å™¨çš„é˜Ÿåˆ—ä¸­éšæœºè·å–ä¸€äº› Goroutineã€‚</p><p>è¿è¡Œæ—¶ G-M-P æ¨¡å‹ä¸­å¼•å…¥çš„å¤„ç†å™¨ P æ˜¯çº¿ç¨‹å’Œ Goroutine çš„ä¸­é—´å±‚ï¼Œæˆ‘ä»¬ä»å®ƒçš„ç»“æ„ä½“ä¸­å°±èƒ½çœ‹åˆ°å¤„ç†å™¨ä¸ M å’Œ G çš„å…³ç³»ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P</span> &#123;</span></span><br><span class="line">Lock;</span><br><span class="line"></span><br><span class="line">uint32status;</span><br><span class="line">P*link;</span><br><span class="line">uint32tick;</span><br><span class="line">M*m;</span><br><span class="line">MCache*mcache;</span><br><span class="line"></span><br><span class="line">G**runq;</span><br><span class="line">int32runqhead;</span><br><span class="line">int32runqtail;</span><br><span class="line">int32runqsize;</span><br><span class="line"></span><br><span class="line">G*gfree;</span><br><span class="line">int32gfreecnt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¤„ç†å™¨æŒæœ‰ä¸€ä¸ªç”±å¯è¿è¡Œçš„ Goroutine ç»„æˆçš„è¿è¡Œé˜Ÿåˆ— <code>runq</code>ï¼Œè¿˜åå‘æŒæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚è°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶ä¼šä»å¤„ç†å™¨çš„é˜Ÿåˆ—ä¸­é€‰æ‹©é˜Ÿåˆ—å¤´çš„ Goroutine æ”¾åˆ°çº¿ç¨‹ M ä¸Šæ‰§è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºçš„å›¾ç‰‡å±•ç¤ºäº† Go è¯­è¨€ä¸­çš„çº¿ç¨‹ Mã€å¤„ç†å™¨ P å’Œ Goroutine çš„å…³ç³»ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-02-15805792666151-golang-gmp.png" alt="golang-gmp"></p><p><strong>å›¾ 6-27 - G-M-P æ¨¡å‹</strong></p><p>åŸºäºå·¥ä½œçªƒå–çš„å¤šçº¿ç¨‹è°ƒåº¦å™¨å°†æ¯ä¸€ä¸ªçº¿ç¨‹ç»‘å®šåˆ°äº†ç‹¬ç«‹çš„ CPU ä¸Šï¼Œè¿™äº›çº¿ç¨‹ä¼šè¢«ä¸åŒå¤„ç†å™¨ç®¡ç†ï¼Œä¸åŒçš„å¤„ç†å™¨é€šè¿‡å·¥ä½œçªƒå–å¯¹ä»»åŠ¡è¿›è¡Œå†åˆ†é…å®ç°ä»»åŠ¡çš„å¹³è¡¡ï¼Œä¹Ÿèƒ½æå‡è°ƒåº¦å™¨å’Œ Go è¯­è¨€ç¨‹åºçš„æ•´ä½“æ€§èƒ½ï¼Œä»Šå¤©æ‰€æœ‰çš„ Go è¯­è¨€æœåŠ¡éƒ½å—ç›Šäºè¿™ä¸€æ”¹åŠ¨ã€‚</p><h3 id="æŠ¢å å¼è°ƒåº¦å™¨"><a href="#æŠ¢å å¼è°ƒåº¦å™¨" class="headerlink" title="æŠ¢å å¼è°ƒåº¦å™¨"></a>æŠ¢å å¼è°ƒåº¦å™¨</h3><p>å¯¹ Go è¯­è¨€å¹¶å‘æ¨¡å‹çš„ä¿®æ”¹æå‡äº†è°ƒåº¦å™¨çš„æ€§èƒ½ï¼Œä½†æ˜¯ 1.1 ç‰ˆæœ¬ä¸­çš„è°ƒåº¦å™¨ä»ç„¶ä¸æ”¯æŒæŠ¢å å¼è°ƒåº¦ï¼Œç¨‹åºåªèƒ½ä¾é  Goroutine ä¸»åŠ¨è®©å‡º CPU èµ„æºæ‰èƒ½è§¦å‘è°ƒåº¦ã€‚Go è¯­è¨€çš„è°ƒåº¦å™¨åœ¨ 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦è§£å†³ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>æŸäº› Goroutine å¯ä»¥é•¿æ—¶é—´å ç”¨çº¿ç¨‹ï¼Œé€ æˆå…¶å®ƒ Goroutine çš„é¥¥é¥¿ï¼›</li><li>åƒåœ¾å›æ”¶éœ€è¦æš‚åœæ•´ä¸ªç¨‹åºï¼ˆStop-the-worldï¼ŒSTWï¼‰ï¼Œæœ€é•¿å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¯¼è‡´æ•´ä¸ªç¨‹åºæ— æ³•å·¥ä½œï¼›</li></ul><p>1.2 ç‰ˆæœ¬çš„æŠ¢å å¼è°ƒåº¦è™½ç„¶èƒ½å¤Ÿç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å®ƒå®ç°çš„æŠ¢å å¼è°ƒåº¦æ˜¯åŸºäºåä½œçš„ï¼Œåœ¨ä¹‹åå¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é‡Œ Go è¯­è¨€çš„è°ƒåº¦å™¨éƒ½æœ‰ä¸€äº›æ— æ³•è¢«æŠ¢å çš„è¾¹ç¼˜æƒ…å†µï¼Œä¾‹å¦‚ï¼šfor å¾ªç¯æˆ–è€…åƒåœ¾å›æ”¶é•¿æ—¶é—´å ç”¨çº¿ç¨‹ï¼Œè¿™äº›é—®é¢˜ä¸­çš„ä¸€éƒ¨åˆ†ç›´åˆ° 1.14 æ‰è¢«åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦è§£å†³ã€‚</p><h4 id="åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦"><a href="#åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦" class="headerlink" title="åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦"></a>åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://github.com/golang/go/blob/go1.2/src/pkg/runtime/proc.c"><code>pkg/runtime/proc.c</code></a> æ–‡ä»¶ä¸­æ‰¾åˆ°å¼•å…¥åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦åçš„è°ƒåº¦å™¨ã€‚Go è¯­è¨€ä¼šåœ¨åˆ†æ®µæ ˆçš„æœºåˆ¶ä¸Šå®ç°æŠ¢å è°ƒåº¦ï¼Œåˆ©ç”¨ç¼–è¯‘å™¨åœ¨åˆ†æ®µæ ˆä¸Šæ’å…¥çš„å‡½æ•°ï¼Œæ‰€æœ‰ Goroutine åœ¨å‡½æ•°è°ƒç”¨æ—¶éƒ½æœ‰æœºä¼šè¿›å…¥è¿è¡Œæ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰§è¡ŒæŠ¢å ã€‚Go å›¢é˜Ÿé€šè¿‡ä»¥ä¸‹çš„å¤šä¸ªæäº¤å®ç°è¯¥ç‰¹æ€§ï¼š</p><ul><li>runtime: add stackguard0 to G<ul><li>ä¸º Goroutine å¼•å…¥ <code>stackguard0</code> å­—æ®µï¼Œè¯¥å­—æ®µè¢«è®¾ç½®æˆ <code>StackPreempt</code> æ„å‘³ç€å½“å‰ Goroutine å‘å‡ºäº†æŠ¢å è¯·æ±‚ï¼›</li></ul></li><li>runtime: introduce preemption function (not used for now)<ul><li>å¼•å…¥æŠ¢å å‡½æ•° <a href="https://github.com/golang/go/blob/354ec5166668cae9be899c82e20c38b32ae3b867/src/pkg/runtime/proc.c#L2103"><code>runtime.preemptone</code></a> å’Œ <a href="https://github.com/golang/go/blob/354ec5166668cae9be899c82e20c38b32ae3b867/src/pkg/runtime/proc.c#L2083"><code>runtime.preemptall</code></a>ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¼šæ”¹å˜ Goroutine çš„ <code>stackguard0</code> å­—æ®µå‘å‡ºæŠ¢å è¯·æ±‚ï¼›</li><li>å®šä¹‰æŠ¢å è¯·æ±‚ <code>StackPreempt</code>ï¼›</li></ul></li><li>runtime: preempt goroutines for GC<ul><li>åœ¨ <a href="https://github.com/golang/go/blob/1e112cd59f560129f4dca5e9af7c3cbc445850b6/src/pkg/runtime/proc.c#L356"><code>runtime.stoptheworld</code></a> ä¸­è°ƒç”¨ <a href="https://github.com/golang/go/blob/354ec5166668cae9be899c82e20c38b32ae3b867/src/pkg/runtime/proc.c#L2083"><code>runtime.preemptall</code></a> è®¾ç½®æ‰€æœ‰å¤„ç†å™¨ä¸Šæ­£åœ¨è¿è¡Œçš„ Goroutine çš„ <code>stackguard0</code> ä¸º <code>StackPreempt</code>ï¼›</li><li>åœ¨ <a href="https://github.com/golang/go/blob/1e112cd59f560129f4dca5e9af7c3cbc445850b6/src/pkg/runtime/stack.c#L192"><code>runtime.newstack</code></a> å‡½æ•°ä¸­å¢åŠ æŠ¢å çš„ä»£ç ï¼Œå½“ <code>stackguard0</code> ç­‰äº <code>StackPreempt</code> æ—¶è§¦å‘è°ƒåº¦å™¨æŠ¢å è®©å‡ºçº¿ç¨‹ï¼›</li></ul></li><li>runtime: preempt long-running goroutines<ul><li>åœ¨ç³»ç»Ÿç›‘æ§ä¸­ï¼Œå¦‚æœä¸€ä¸ª Goroutine çš„è¿è¡Œæ—¶é—´è¶…è¿‡ 10msï¼Œå°±ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/bc31bcccd3b94ec8dd324e523c4c7ae9180b937f/src/pkg/runtime/proc.c#L2122"><code>runtime.retake</code></a> å’Œ <a href="https://github.com/golang/go/blob/354ec5166668cae9be899c82e20c38b32ae3b867/src/pkg/runtime/proc.c#L2103"><code>runtime.preemptone</code></a>ï¼›</li></ul></li><li>runtime: more reliable preemption<ul><li>ä¿®å¤ Goroutine å› ä¸ºå‘¨æœŸæ€§æ‰§è¡Œéé˜»å¡çš„ CGO æˆ–è€…ç³»ç»Ÿè°ƒç”¨ä¸ä¼šè¢«æŠ¢å çš„é—®é¢˜ï¼›</li></ul></li></ul><p>ä¸Šé¢çš„å¤šä¸ªæäº¤å®ç°äº†æŠ¢å å¼è°ƒåº¦ï¼Œä½†æ˜¯è¿˜ç¼ºå°‘æœ€å…³é”®çš„ä¸€ä¸ªç¯èŠ‚ â€” ç¼–è¯‘å™¨å¦‚ä½•åœ¨å‡½æ•°è°ƒç”¨å‰æ’å…¥å‡½æ•°ï¼Œæˆ‘ä»¬èƒ½åœ¨éå¸¸å¤è€çš„æäº¤ <a href="https://github.com/golang/go/commit/7343e03c433ebb0c302ed97bf832ad3bd3170de6">runtime: stack growth adjustments, cleanup</a> ä¸­æ‰¾åˆ°ç¼–è¯‘å™¨æ’å…¥å‡½æ•°çš„å‡ºè¡Œï¼Œæœ€æ–°ç‰ˆæœ¬çš„ Go è¯­è¨€ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/b2482e481722357c6daa98ef074d8eaf8ac4baf3/src/cmd/internal/obj/x86/obj6.go#L974"><code>cmd/internal/obj/x86.stacksplit</code></a> æ’å…¥ <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L432"><code>runtime.morestack</code></a> å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯èƒ½ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/0f251028585e052a3d34dcce83b05d8aa9ba170e/src/runtime/stack.go#L918"><code>runtime.newstack</code></a> è§¦å‘æŠ¢å ã€‚ä»ä¸Šé¢çš„å¤šä¸ªæäº¤ä¸­ï¼Œæˆ‘ä»¬èƒ½å½’çº³å‡ºåŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦çš„å·¥ä½œåŸç†ï¼š</p><ol><li>ç¼–è¯‘å™¨ä¼šåœ¨è°ƒç”¨å‡½æ•°å‰æ’å…¥ <a href="https://github.com/golang/go/blob/1e112cd59f560129f4dca5e9af7c3cbc445850b6/src/pkg/runtime/stack.c#L192"><code>runtime.morestack</code></a>ï¼›</li><li>Go è¯­è¨€è¿è¡Œæ—¶ä¼šåœ¨åƒåœ¾å›æ”¶æš‚åœç¨‹åºã€ç³»ç»Ÿç›‘æ§å‘ç° Goroutine è¿è¡Œè¶…è¿‡ 10ms æ—¶å‘å‡ºæŠ¢å è¯·æ±‚ <code>StackPreempt</code>ï¼›</li><li>å½“å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œå¯èƒ½ä¼šæ‰§è¡Œç¼–è¯‘å™¨æ’å…¥çš„ <a href="https://github.com/golang/go/blob/1e112cd59f560129f4dca5e9af7c3cbc445850b6/src/pkg/runtime/stack.c#L192"><code>runtime.morestack</code></a> å‡½æ•°ï¼Œå®ƒè°ƒç”¨çš„ <a href="https://github.com/golang/go/blob/1e112cd59f560129f4dca5e9af7c3cbc445850b6/src/pkg/runtime/stack.c#L192"><code>runtime.newstack</code></a> ä¼šæ£€æŸ¥ Goroutine çš„ <code>stackguard0</code> å­—æ®µæ˜¯å¦ä¸º <code>StackPreempt</code>ï¼›</li><li>å¦‚æœ <code>stackguard0</code> æ˜¯ <code>StackPreempt</code>ï¼Œå°±ä¼šè§¦å‘æŠ¢å è®©å‡ºå½“å‰çº¿ç¨‹ï¼›</li></ol><p>è¿™ç§å®ç°æ–¹å¼è™½ç„¶å¢åŠ äº†è¿è¡Œæ—¶çš„å¤æ‚åº¦ï¼Œä½†æ˜¯å®ç°ç›¸å¯¹ç®€å•ï¼Œä¹Ÿæ²¡æœ‰å¸¦æ¥è¿‡å¤šçš„é¢å¤–å¼€é”€ï¼Œæ€»ä½“æ¥çœ‹è¿˜æ˜¯æ¯”è¾ƒæˆåŠŸçš„å®ç°ï¼Œä¹Ÿåœ¨ Go è¯­è¨€ä¸­ä½¿ç”¨äº† 10 å‡ ä¸ªç‰ˆæœ¬ã€‚å› ä¸ºè¿™é‡Œçš„æŠ¢å æ˜¯é€šè¿‡ç¼–è¯‘å™¨æ’å…¥å‡½æ•°å®ç°çš„ï¼Œè¿˜æ˜¯éœ€è¦å‡½æ•°è°ƒç”¨ä½œä¸ºå…¥å£æ‰èƒ½è§¦å‘æŠ¢å ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç§<strong>åä½œå¼çš„æŠ¢å å¼è°ƒåº¦</strong>ã€‚</p><h4 id="åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦"><a href="#åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦" class="headerlink" title="åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦"></a>åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦</h4><p>åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦è™½ç„¶å®ç°å·§å¦™ï¼Œä½†æ˜¯å¹¶ä¸å®Œå¤‡ï¼Œæˆ‘ä»¬èƒ½åœ¨ <a href="https://github.com/golang/go/issues/24543">runtime: non-cooperative goroutine preemption</a> ä¸­æ‰¾åˆ°ä¸€äº›é—ç•™é—®é¢˜ï¼š</p><ul><li><a href="https://github.com/golang/go/issues/10958">runtime: tight loops should be preemptible #10958</a></li><li><a href="https://github.com/golang/go/issues/17174">An empty for{} will block large slice allocation in another goroutine, even with GOMAXPROCS &gt; 1 ? #17174</a></li><li><a href="https://github.com/golang/go/issues/15442">runtime: tight loop hangs process completely after some time #15442</a></li><li>â€¦</li></ul><p>Go è¯­è¨€åœ¨ 1.14 ç‰ˆæœ¬ä¸­å®ç°äº†éåä½œçš„æŠ¢å å¼è°ƒåº¦ï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬é‡æ„å·²æœ‰çš„é€»è¾‘å¹¶ä¸º Goroutine å¢åŠ æ–°çš„çŠ¶æ€å’Œå­—æ®µæ¥æ”¯æŒæŠ¢å ã€‚Go å›¢é˜Ÿé€šè¿‡ä¸‹é¢çš„ä¸€ç³»åˆ—æäº¤å®ç°äº†è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ—¶é—´é¡ºåºåˆ†æç›¸å…³æäº¤ç†è§£å®ƒçš„å·¥ä½œåŸç†ï¼š</p><ul><li>runtime: add general suspendG/resumeG<ul><li>æŒ‚èµ· Goroutine çš„è¿‡ç¨‹æ˜¯åœ¨åƒåœ¾å›æ”¶çš„æ ˆæ‰«ææ—¶å®Œæˆçš„ï¼Œæˆ‘ä»¬é€šè¿‡ <a href="https://github.com/golang/go/blob/dcdee153cd61de47d0cabd6729a17673536b0418/src/runtime/preempt.go#L105"><code>runtime.suspendG</code></a> å’Œ <a href="https://github.com/golang/go/blob/dcdee153cd61de47d0cabd6729a17673536b0418/src/runtime/preempt.go#L258"><code>runtime.resumeG</code></a> ä¸¤ä¸ªå‡½æ•°é‡æ„æ ˆæ‰«æè¿™ä¸€è¿‡ç¨‹ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/dcdee153cd61de47d0cabd6729a17673536b0418/src/runtime/preempt.go#L105"><code>runtime.suspendG</code></a> å‡½æ•°æ—¶ä¼šå°†å¤„äºè¿è¡ŒçŠ¶æ€çš„ Goroutine çš„ <code>preemptStop</code> æ ‡è®°æˆ <code>true</code>ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2739"><code>runtime.preemptPark</code></a> å‡½æ•°å¯ä»¥æŒ‚èµ·å½“å‰ Goroutineã€å°†å…¶çŠ¶æ€æ›´æ–°æˆ <code>_Gpreempted</code> å¹¶è§¦å‘è°ƒåº¦å™¨çš„é‡æ–°è°ƒåº¦ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿäº¤å‡ºçº¿ç¨‹æ§åˆ¶æƒï¼›</li></ul></li><li>runtime: asynchronous preemption function for x86<ul><li>åœ¨ x86 æ¶æ„ä¸Šå¢åŠ å¼‚æ­¥æŠ¢å çš„å‡½æ•° <a href="https://github.com/golang/go/blob/cdb7fd6b06937aa38a7a4921f567697144448073/src/runtime/preempt_386.s#L6"><code>runtime.asyncPreempt</code></a> å’Œ <a href="https://github.com/golang/go/blob/dcdee153cd61de47d0cabd6729a17673536b0418/src/runtime/preempt.go#L302"><code>runtime.asyncPreempt2</code></a>ï¼›</li></ul></li><li>runtime: use signals to preempt Gs for suspendG<ul><li>æ”¯æŒé€šè¿‡å‘çº¿ç¨‹å‘é€ä¿¡å·çš„æ–¹å¼æš‚åœè¿è¡Œçš„ Goroutineï¼›</li><li>åœ¨ <a href="https://github.com/golang/go/blob/67f0f83216930e053441500e2b28c3fa2b667581/src/runtime/signal_unix.go#L507"><code>runtime.sighandler</code></a> å‡½æ•°ä¸­æ³¨å†Œ <code>SIGURG</code> ä¿¡å·çš„å¤„ç†å‡½æ•° <a href="https://github.com/golang/go/blob/67f0f83216930e053441500e2b28c3fa2b667581/src/runtime/signal_unix.go#L326"><code>runtime.doSigPreempt</code></a>ï¼›</li><li>å®ç° <a href="https://github.com/golang/go/blob/67f0f83216930e053441500e2b28c3fa2b667581/src/runtime/signal_unix.go#L346"><code>runtime.preemptM</code></a> å‡½æ•°ï¼Œå®ƒå¯ä»¥é€šè¿‡ <code>SIGURG</code> ä¿¡å·å‘çº¿ç¨‹å‘é€æŠ¢å è¯·æ±‚ï¼›</li></ul></li><li>runtime: implement async scheduler preemption<ul><li>ä¿®æ”¹ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4666"><code>runtime.preemptone</code></a> å‡½æ•°çš„å®ç°ï¼ŒåŠ å…¥å¼‚æ­¥æŠ¢å çš„é€»è¾‘ï¼›</li></ul></li></ul><p>ç›®å‰çš„æŠ¢å å¼è°ƒåº¦ä¹Ÿåªä¼šåœ¨åƒåœ¾å›æ”¶æ‰«æä»»åŠ¡æ—¶è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥æ¢³ç†ä¸€ä¸‹ä¸Šè¿°ä»£ç å®ç°çš„æŠ¢å å¼è°ƒåº¦è¿‡ç¨‹ï¼š</p><ol><li><p>ç¨‹åºå¯åŠ¨æ—¶ï¼Œåœ¨ <a href="https://github.com/golang/go/blob/62e53b79227dafc6afcd92240c89acb8c0e1dd56/src/runtime/signal_unix.go#L494"><code>runtime.sighandler</code></a> å‡½æ•°ä¸­æ³¨å†Œ <code>SIGURG</code> ä¿¡å·çš„å¤„ç†å‡½æ•° <a href="https://github.com/golang/go/blob/62e53b79227dafc6afcd92240c89acb8c0e1dd56/src/runtime/signal_unix.go#L326"><code>runtime.doSigPreempt</code></a>ï¼›</p></li><li><p>åœ¨è§¦å‘åƒåœ¾å›æ”¶çš„æ ˆæ‰«ææ—¶ä¼šè°ƒç”¨</p></li></ol><p>   <code>runtime.suspendG</code></p><p>   æŒ‚èµ· Goroutineï¼Œè¯¥å‡½æ•°ä¼šæ‰§è¡Œä¸‹é¢çš„é€»è¾‘ï¼š</p><ol><li>å°† <code>_Grunning</code> çŠ¶æ€çš„ Goroutine æ ‡è®°æˆå¯ä»¥è¢«æŠ¢å ï¼Œå³å°† <code>preemptStop</code> è®¾ç½®æˆ <code>true</code>ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/67f0f83216930e053441500e2b28c3fa2b667581/src/runtime/signal_unix.go#L346"><code>runtime.preemptM</code></a> è§¦å‘æŠ¢å ï¼›</li></ol><ol><li><p><a href="https://github.com/golang/go/blob/67f0f83216930e053441500e2b28c3fa2b667581/src/runtime/signal_unix.go#L346"><code>runtime.preemptM</code></a> ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/8e0be05ec7c369387c0ed3c9cf37968c6d3afbbd/src/runtime/os_linux.go#L483"><code>runtime.signalM</code></a> å‘çº¿ç¨‹å‘é€ä¿¡å· <code>SIGURG</code>ï¼›</p></li><li><p>æ“ä½œç³»ç»Ÿä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¹¶æ‰§è¡Œé¢„å…ˆæ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•° <a href="https://github.com/golang/go/blob/62e53b79227dafc6afcd92240c89acb8c0e1dd56/src/runtime/signal_unix.go#L326"><code>runtime.doSigPreempt</code></a>ï¼›</p></li><li><p><a href="https://github.com/golang/go/blob/62e53b79227dafc6afcd92240c89acb8c0e1dd56/src/runtime/signal_unix.go#L326"><code>runtime.doSigPreempt</code></a> å‡½æ•°ä¼šå¤„ç†æŠ¢å ä¿¡å·ï¼Œè·å–å½“å‰çš„ SP å’Œ PC å¯„å­˜å™¨å¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/7955ecebfc85851d43913f9358fa5f6a7bbb7c59/src/runtime/signal_386.go#L69"><code>runtime.sigctxt.pushCall</code></a>ï¼›</p></li><li><p><a href="https://github.com/golang/go/blob/7955ecebfc85851d43913f9358fa5f6a7bbb7c59/src/runtime/signal_386.go#L69"><code>runtime.sigctxt.pushCall</code></a> ä¼šä¿®æ”¹å¯„å­˜å™¨å¹¶åœ¨ç¨‹åºå›åˆ°ç”¨æˆ·æ€æ—¶æ‰§è¡Œ <a href="https://github.com/golang/go/blob/cdb7fd6b06937aa38a7a4921f567697144448073/src/runtime/preempt_386.s#L6"><code>runtime.asyncPreempt</code></a>ï¼›</p></li><li><p>æ±‡ç¼–æŒ‡ä»¤ <a href="https://github.com/golang/go/blob/cdb7fd6b06937aa38a7a4921f567697144448073/src/runtime/preempt_386.s#L6"><code>runtime.asyncPreempt</code></a> ä¼šè°ƒç”¨è¿è¡Œæ—¶å‡½æ•° <a href="https://github.com/golang/go/blob/dcdee153cd61de47d0cabd6729a17673536b0418/src/runtime/preempt.go#L302"><code>runtime.asyncPreempt2</code></a>ï¼›</p></li><li><p><a href="https://github.com/golang/go/blob/dcdee153cd61de47d0cabd6729a17673536b0418/src/runtime/preempt.go#L302"><code>runtime.asyncPreempt2</code></a> ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2739"><code>runtime.preemptPark</code></a>ï¼›</p></li><li><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2739"><code>runtime.preemptPark</code></a> ä¼šä¿®æ”¹å½“å‰ Goroutine çš„çŠ¶æ€åˆ° <code>_Gpreempted</code> å¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/8d7be1e3c9a98191f8c900087025c5e78b73d962/src/runtime/proc.go#L2482"><code>runtime.schedule</code></a> è®©å½“å‰å‡½æ•°é™·å…¥ä¼‘çœ å¹¶è®©å‡ºçº¿ç¨‹ï¼Œè°ƒåº¦å™¨ä¼šé€‰æ‹©å…¶å®ƒçš„ Goroutine ç»§ç»­æ‰§è¡Œï¼›</p></li></ol><p>ä¸Šè¿° 9 ä¸ªæ­¥éª¤å±•ç¤ºäº†åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦çš„æ‰§è¡Œè¿‡ç¨‹ã€‚é™¤äº†åˆ†ææŠ¢å çš„è¿‡ç¨‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¨è®ºä¸€ä¸‹æŠ¢å ä¿¡å·çš„é€‰æ‹©ï¼Œææ¡ˆæ ¹æ®ä»¥ä¸‹çš„å››ä¸ªåŸå› é€‰æ‹© <code>SIGURG</code> ä½œä¸ºè§¦å‘å¼‚æ­¥æŠ¢å çš„ä¿¡å·ï¼›</p><ol><li>è¯¥ä¿¡å·éœ€è¦è¢«è°ƒè¯•å™¨é€ä¼ ï¼›</li><li>è¯¥ä¿¡å·ä¸ä¼šè¢«å†…éƒ¨çš„ libc åº“ä½¿ç”¨å¹¶æ‹¦æˆªï¼›</li><li>è¯¥ä¿¡å·å¯ä»¥éšæ„å‡ºç°å¹¶ä¸”ä¸è§¦å‘ä»»ä½•åæœï¼›</li><li>æˆ‘ä»¬éœ€è¦å¤„ç†å¤šä¸ªå¹³å°ä¸Šçš„ä¸åŒä¿¡å·ï¼›</li></ol><p>STW å’Œæ ˆæ‰«ææ˜¯ä¸€ä¸ªå¯ä»¥æŠ¢å çš„å®‰å…¨ç‚¹ï¼ˆSafe-pointsï¼‰ï¼Œæ‰€ä»¥ Go è¯­è¨€ä¼šåœ¨è¿™é‡Œå…ˆåŠ å…¥æŠ¢å åŠŸèƒ½ã€‚åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦åªè§£å†³äº†åƒåœ¾å›æ”¶å’Œæ ˆæ‰«ææ—¶å­˜åœ¨çš„é—®é¢˜ï¼Œå®ƒåˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰è§£å†³å…¨éƒ¨é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§çœŸæŠ¢å å¼è°ƒåº¦æ—¶è°ƒåº¦å™¨èµ°å‘å®Œå¤‡çš„å¼€å§‹ï¼Œç›¸ä¿¡åœ¨æœªæ¥æˆ‘ä»¬å¯ä»¥ä¼šæ›´å¤šçš„åœ°æ–¹è§¦å‘æŠ¢å ã€‚</p><h3 id="éå‡åŒ€å†…å­˜è®¿é—®è°ƒåº¦å™¨"><a href="#éå‡åŒ€å†…å­˜è®¿é—®è°ƒåº¦å™¨" class="headerlink" title="éå‡åŒ€å†…å­˜è®¿é—®è°ƒåº¦å™¨"></a>éå‡åŒ€å†…å­˜è®¿é—®è°ƒåº¦å™¨</h3><p>éå‡åŒ€å†…å­˜è®¿é—®ï¼ˆNon-uniform memory accessï¼ŒNUMAï¼‰è°ƒåº¦å™¨ç°åœ¨åªæ˜¯ Go è¯­è¨€çš„ææ¡ˆï¼Œå› ä¸ºè¯¥ææ¡ˆè¿‡äºå¤æ‚ï¼Œè€Œç›®å‰çš„è°ƒåº¦å™¨çš„æ€§èƒ½å·²ç»è¶³å¤Ÿä¼˜å¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶æ²¡æœ‰å®ç°è¯¥ææ¡ˆã€‚è¯¥ææ¡ˆçš„åŸç†å°±æ˜¯é€šè¿‡æ‹†åˆ†å…¨å±€èµ„æºï¼Œè®©å„ä¸ªå¤„ç†å™¨èƒ½å¤Ÿå°±è¿‘è·å–ï¼Œå‡å°‘é”ç«äº‰å¹¶å¢åŠ æ•°æ®çš„å±€éƒ¨æ€§ã€‚</p><p>åœ¨ç›®å‰çš„è¿è¡Œæ—¶ä¸­ï¼Œçº¿ç¨‹ã€å¤„ç†å™¨ã€ç½‘ç»œè½®è¯¢å™¨ã€è¿è¡Œé˜Ÿåˆ—ã€å…¨å±€å†…å­˜åˆ†é…å™¨çŠ¶æ€ã€å†…å­˜åˆ†é…ç¼“å­˜å’Œåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯å…¨å±€èµ„æºã€‚è¿è¡Œæ—¶æ²¡æœ‰ä¿è¯æœ¬åœ°åŒ–ï¼Œä¹Ÿä¸æ¸…æ¥šç³»ç»Ÿçš„æ‹“æ‰‘ç»“æ„ï¼Œéƒ¨åˆ†ç»“æ„å¯ä»¥æä¾›ä¸€å®šçš„å±€éƒ¨æ€§ï¼Œä½†æ˜¯ä»å…¨å±€æ¥çœ‹æ²¡æœ‰è¿™ç§ä¿è¯ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-02-15805792666185-go-numa-scheduler-architecture.png" alt="go-numa-scheduler-architecture"></p><p><strong>Go è¯­è¨€ NUMA è°ƒåº¦å™¨</strong></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå †æ ˆã€å…¨å±€è¿è¡Œé˜Ÿåˆ—å’Œçº¿ç¨‹æ± ä¼šæŒ‰ç…§ NUMA èŠ‚ç‚¹è¿›è¡Œåˆ†åŒºï¼Œç½‘ç»œè½®è¯¢å™¨å’Œè®¡æ—¶å™¨ä¼šç”±å•ç‹¬çš„å¤„ç†å™¨æŒæœ‰ã€‚è¿™ç§æ–¹å¼è™½ç„¶èƒ½å¤Ÿåˆ©ç”¨å±€éƒ¨æ€§æé«˜è°ƒåº¦å™¨çš„æ€§èƒ½ï¼Œä½†æ˜¯æœ¬èº«çš„å®ç°è¿‡äºå¤æ‚ï¼Œæ‰€ä»¥ Go è¯­è¨€å›¢é˜Ÿè¿˜æ²¡æœ‰ç€æ‰‹å®ç°è¿™ä¸€ææ¡ˆã€‚</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Go è¯­è¨€çš„è°ƒåº¦å™¨åœ¨æœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬ä¸­è¿…é€Ÿè¿­ä»£ï¼Œä½†æ˜¯ä» 1.2 ç‰ˆæœ¬ä¹‹åè°ƒåº¦å™¨å°±æ²¡æœ‰å¤ªå¤šçš„å˜åŒ–ï¼Œç›´åˆ° 1.14 ç‰ˆæœ¬å¼•å…¥äº†çœŸæ­£çš„æŠ¢å å¼è°ƒåº¦æ‰è§£å†³äº†è‡ª 1.2 ä»¥æ¥ä¸€ç›´å­˜åœ¨çš„é—®é¢˜ã€‚åœ¨å¯é¢„è§çš„æœªæ¥ï¼ŒGo è¯­è¨€çš„è°ƒåº¦å™¨è¿˜ä¼šè¿›ä¸€æ­¥æ¼”è¿›ï¼Œå¢åŠ è§¦å‘æŠ¢å å¼è°ƒåº¦çš„æ—¶é—´ç‚¹ä»¥å‡å°‘å­˜åœ¨çš„è¾¹ç¼˜æƒ…å†µã€‚</p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>ç›¸ä¿¡å„ä½è¯»è€…å·²ç»å¯¹ Go è¯­è¨€è°ƒåº¦ç›¸å…³çš„æ•°æ®ç»“æ„å·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä¸€äº›è¿˜æ˜¯è¦å›é¡¾ä¸€ä¸‹è¿è¡Œæ—¶è°ƒåº¦å™¨çš„ä¸‰ä¸ªé‡è¦ç»„æˆéƒ¨åˆ† â€” çº¿ç¨‹ Mã€Goroutine G å’Œå¤„ç†å™¨ Pï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354595-golang-scheduler.png" alt="golang-scheduler"></p><ol><li>G â€” è¡¨ç¤º Goroutineï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼›</li><li>M â€” è¡¨ç¤ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ï¼Œå®ƒç”±æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨è°ƒåº¦å’Œç®¡ç†ï¼›</li><li>P â€” è¡¨ç¤ºå¤„ç†å™¨ï¼Œå®ƒå¯ä»¥è¢«çœ‹åšè¿è¡Œåœ¨çº¿ç¨‹ä¸Šçš„æœ¬åœ°è°ƒåº¦å™¨ï¼›</li></ol><p>æˆ‘ä»¬ä¼šåœ¨è¿™ä¸€èŠ‚ä¸­åˆ†åˆ«ä»‹ç»ä¸åŒçš„ç»“æ„ä½“ï¼Œè¯¦ç»†ä»‹ç»å®ƒä»¬çš„ä½œç”¨ã€æ•°æ®ç»“æ„ä»¥åŠåœ¨è¿è¡ŒæœŸé—´å¯èƒ½å¤„äºçš„çŠ¶æ€ã€‚</p><h3 id="G"><a href="#G" class="headerlink" title="G"></a>G</h3><p>Gorotuine å°±æ˜¯ Go è¯­è¨€è°ƒåº¦å™¨ä¸­å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®ƒåœ¨è¿è¡Œæ—¶è°ƒåº¦å™¨ä¸­çš„åœ°ä½ä¸çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒå ç”¨äº†æ›´å°çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿé™ä½äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</p><p>Goroutine åªå­˜åœ¨äº Go è¯­è¨€çš„è¿è¡Œæ—¶ï¼Œå®ƒæ˜¯ Go è¯­è¨€åœ¨ç”¨æˆ·æ€æä¾›çš„çº¿ç¨‹ï¼Œä½œä¸ºä¸€ç§ç²’åº¦æ›´ç»†çš„èµ„æºè°ƒåº¦å•å…ƒï¼Œå¦‚æœä½¿ç”¨å¾—å½“èƒ½å¤Ÿåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹æ›´é«˜æ•ˆåœ°åˆ©ç”¨æœºå™¨çš„ CPUã€‚</p><p>Goroutine åœ¨ Go è¯­è¨€è¿è¡Œæ—¶ä½¿ç”¨ç§æœ‰ç»“æ„ä½“ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L395"><code>runtime.g</code></a> è¡¨ç¤ºã€‚è¿™ä¸ªç§æœ‰ç»“æ„ä½“éå¸¸å¤æ‚ï¼Œæ€»å…±åŒ…å« 40 å¤šä¸ªç”¨äºè¡¨ç¤ºå„ç§çŠ¶æ€çš„æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿä¸ä¼šä»‹ç»å…¨éƒ¨å­—æ®µï¼Œè€Œæ˜¯ä¼šæŒ‘é€‰å…¶ä¸­çš„ä¸€éƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼Œé¦–å…ˆæ˜¯ä¸æ ˆç›¸å…³çš„ä¸¤ä¸ªå­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span> &#123;</span><br><span class="line">stack       stack</span><br><span class="line">stackguard0 <span class="keyword">uintptr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>stack</code> å­—æ®µæè¿°äº†å½“å‰ Goroutine çš„æ ˆå†…å­˜èŒƒå›´ <code>[stack.lo, stack.hi)</code>ï¼Œå¦ä¸€ä¸ªå­—æ®µ <code>stackguard0</code> å¯ä»¥ç”¨äºè°ƒåº¦å™¨æŠ¢å å¼è°ƒåº¦ã€‚é™¤äº† <code>stackguard0</code> ä¹‹å¤–ï¼ŒGoroutine ä¸­è¿˜åŒ…å«å¦å¤–ä¸‰ä¸ªä¸æŠ¢å å¯†åˆ‡ç›¸å…³çš„å­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span> &#123;</span><br><span class="line">preempt       <span class="keyword">bool</span> <span class="comment">// æŠ¢å ä¿¡å·</span></span><br><span class="line">preemptStop   <span class="keyword">bool</span> <span class="comment">// æŠ¢å æ—¶å°†çŠ¶æ€ä¿®æ”¹æˆ `_Gpreempted`</span></span><br><span class="line">preemptShrink <span class="keyword">bool</span> <span class="comment">// åœ¨åŒæ­¥å®‰å…¨ç‚¹æ”¶ç¼©æ ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Goroutine ä¸æˆ‘ä»¬åœ¨å‰é¢ç« èŠ‚æåˆ°çš„ <code>defer</code> å’Œ <code>panic</code> ä¹Ÿæœ‰åƒä¸ä¸‡ç¼•çš„è”ç³»ï¼Œæ¯ä¸€ä¸ª Goroutine ä¸Šéƒ½æŒæœ‰ä¸¤ä¸ªåˆ†åˆ«å­˜å‚¨ <code>defer</code> å’Œ <code>panic</code> å¯¹åº”ç»“æ„ä½“çš„é“¾è¡¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span> &#123;</span><br><span class="line">_panic       *_panic <span class="comment">// æœ€å†…ä¾§çš„ panic ç»“æ„ä½“</span></span><br><span class="line">_defer       *_defer <span class="comment">// æœ€å†…ä¾§çš„å»¶è¿Ÿå‡½æ•°ç»“æ„ä½“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬å†èŠ‚é€‰ä¸€äº›ä½œè€…è®¤ä¸ºæ¯”è¾ƒæœ‰è¶£æˆ–è€…é‡è¦çš„å­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span> &#123;</span><br><span class="line">m              *m</span><br><span class="line">sched          gobuf</span><br><span class="line">atomicstatus   <span class="keyword">uint32</span></span><br><span class="line">goid           <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>m</code> â€” å½“å‰ Goroutine å ç”¨çš„çº¿ç¨‹ï¼Œå¯èƒ½ä¸ºç©ºï¼›</li><li><code>atomicstatus</code> â€” Goroutine çš„çŠ¶æ€ï¼›</li><li><code>sched</code> â€” å­˜å‚¨ Goroutine çš„è°ƒåº¦ç›¸å…³çš„æ•°æ®ï¼›</li><li><code>goid</code> â€” Goroutine çš„ IDï¼Œè¯¥å­—æ®µå¯¹å¼€å‘è€…ä¸å¯è§ï¼ŒGo å›¢é˜Ÿè®¤ä¸ºå¼•å…¥ ID ä¼šè®©éƒ¨åˆ† Goroutine å˜å¾—æ›´ç‰¹æ®Šï¼Œä»è€Œé™åˆ¶è¯­è¨€çš„å¹¶å‘èƒ½åŠ›ï¼›</li></ul><p>ä¸Šè¿°å››ä¸ªå­—æ®µä¸­ï¼Œæˆ‘ä»¬éœ€è¦å±•å¼€ä»‹ç» <code>sched</code> å­—æ®µçš„ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L310"><code>runtime.gobuf</code></a> ç»“æ„ä½“ä¸­åŒ…å«å“ªäº›å†…å®¹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> gobuf <span class="keyword">struct</span> &#123;</span><br><span class="line">sp   <span class="keyword">uintptr</span></span><br><span class="line">pc   <span class="keyword">uintptr</span></span><br><span class="line">g    guintptr</span><br><span class="line">ret  sys.Uintreg</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>sp</code> â€” æ ˆæŒ‡é’ˆï¼ˆStack Pointerï¼‰ï¼›</li><li><code>pc</code> â€” ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counterï¼‰ï¼›</li><li><code>g</code> â€” æŒæœ‰ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L310"><code>runtime.gobuf</code></a> çš„ Goroutineï¼›</li><li><code>ret</code> â€” ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼›</li></ul><p>è¿™äº›å†…å®¹ä¼šåœ¨è°ƒåº¦å™¨ä¿å­˜æˆ–è€…æ¢å¤ä¸Šä¸‹æ–‡çš„æ—¶å€™ç”¨åˆ°ï¼Œå…¶ä¸­çš„æ ˆæŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨ä¼šç”¨æ¥å­˜å‚¨æˆ–è€…æ¢å¤å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œæ”¹å˜ç¨‹åºå³å°†æ‰§è¡Œçš„ä»£ç ã€‚</p><p>ç»“æ„ä½“ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L395"><code>runtime.g</code></a> çš„ <code>atomicstatus</code> å­—æ®µå°±å­˜å‚¨äº†å½“å‰ Goroutine çš„çŠ¶æ€ã€‚é™¤äº†å‡ ä¸ªå·²ç»ä¸è¢«ä½¿ç”¨çš„ä»¥åŠä¸ GC ç›¸å…³çš„çŠ¶æ€ä¹‹å¤–ï¼ŒGoroutine å¯èƒ½å¤„äºä»¥ä¸‹ 9 ä¸ªçŠ¶æ€ï¼š</p><div class="table-container"><table><thead><tr><th>çŠ¶æ€</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>_Gidle</code></td><td>åˆšåˆšè¢«åˆ†é…å¹¶ä¸”è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–</td></tr><tr><td><code>_Grunnable</code></td><td>æ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œæ²¡æœ‰æ ˆçš„æ‰€æœ‰æƒï¼Œå­˜å‚¨åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­</td></tr><tr><td><code>_Grunning</code></td><td>å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ‹¥æœ‰æ ˆçš„æ‰€æœ‰æƒï¼Œè¢«èµ‹äºˆäº†å†…æ ¸çº¿ç¨‹ M å’Œå¤„ç†å™¨ P</td></tr><tr><td><code>_Gsyscall</code></td><td>æ­£åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‹¥æœ‰æ ˆçš„æ‰€æœ‰æƒï¼Œæ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œè¢«èµ‹äºˆäº†å†…æ ¸çº¿ç¨‹ M ä½†æ˜¯ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Š</td></tr><tr><td><code>_Gwaiting</code></td><td>ç”±äºè¿è¡Œæ—¶è€Œè¢«é˜»å¡ï¼Œæ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç å¹¶ä¸”ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Šï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨äº Channel çš„ç­‰å¾…é˜Ÿåˆ—ä¸Š</td></tr><tr><td><code>_Gdead</code></td><td>æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œå¯èƒ½æœ‰åˆ†é…çš„æ ˆ</td></tr><tr><td><code>_Gcopystack</code></td><td>æ ˆæ­£åœ¨è¢«æ‹·è´ï¼Œæ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Š</td></tr><tr><td><code>_Gpreempted</code></td><td>ç”±äºæŠ¢å è€Œè¢«é˜»å¡ï¼Œæ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç å¹¶ä¸”ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Šï¼Œç­‰å¾…å”¤é†’</td></tr><tr><td><code>_Gscan</code></td><td>GC æ­£åœ¨æ‰«ææ ˆç©ºé—´ï¼Œæ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œå¯ä»¥ä¸å…¶ä»–çŠ¶æ€åŒæ—¶å­˜åœ¨</td></tr></tbody></table></div><p>ä¸Šè¿°çŠ¶æ€ä¸­æ¯”è¾ƒå¸¸è§æ˜¯ <code>_Grunnable</code>ã€<code>_Grunning</code>ã€<code>_Gsyscall</code>ã€<code>_Gwaiting</code> å’Œ <code>_Gpreempted</code> äº”ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬ä¼šé‡ç‚¹ä»‹ç»è¿™å‡ ä¸ªçŠ¶æ€ï¼ŒGoroutine çš„çŠ¶æ€è¿ç§»æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œè§¦å‘ Goroutine çŠ¶æ€è¿ç§»çš„æ–¹æ³•ä¹Ÿå¾ˆå¤šï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ³•ä»‹ç»å…¨éƒ¨çš„è¿ç§»çº¿è·¯ï¼Œæˆ‘ä»¬ä¼šä»ä¸­é€‰æ‹©ä¸€äº›è¿›è¡Œä»‹ç»ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354603-goroutine-status.png" alt="goroutine-status"></p><p><strong>Goroutine çš„çŠ¶æ€</strong></p><p>è™½ç„¶ Goroutine åœ¨è¿è¡Œæ—¶ä¸­å®šä¹‰çš„çŠ¶æ€éå¸¸å¤šè€Œä¸”å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä¸åŒçš„çŠ¶æ€èšåˆæˆæœ€ç»ˆçš„ä¸‰ç§ï¼šç­‰å¾…ä¸­ã€å¯è¿è¡Œã€è¿è¡Œä¸­ï¼Œåœ¨è¿è¡ŒæœŸé—´æˆ‘ä»¬ä¼šåœ¨è¿™ä¸‰ç§ä¸åŒçš„çŠ¶æ€æ¥å›åˆ‡æ¢ï¼š</p><ul><li>ç­‰å¾…ä¸­ï¼šGoroutine æ­£åœ¨ç­‰å¾…æŸäº›æ¡ä»¶æ»¡è¶³ï¼Œä¾‹å¦‚ï¼šç³»ç»Ÿè°ƒç”¨ç»“æŸç­‰ï¼ŒåŒ…æ‹¬ <code>_Gwaiting</code>ã€<code>_Gsyscall</code> å’Œ <code>_Gpreempted</code> å‡ ä¸ªçŠ¶æ€ï¼›</li><li>å¯è¿è¡Œï¼šGoroutine å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥åœ¨çº¿ç¨‹è¿è¡Œï¼Œå¦‚æœå½“å‰ç¨‹åºä¸­æœ‰éå¸¸å¤šçš„ Goroutineï¼Œæ¯ä¸ª Goroutine å°±å¯èƒ½ä¼šç­‰å¾…æ›´å¤šçš„æ—¶é—´ï¼Œå³ <code>_Grunnable</code>ï¼›</li><li>è¿è¡Œä¸­ï¼šGoroutine æ­£åœ¨æŸä¸ªçº¿ç¨‹ä¸Šè¿è¡Œï¼Œå³ <code>_Grunning</code>ï¼›</li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354615-golang-goroutine-state-transition.png" alt="golang-goroutine-state-transition"></p><p><strong>Goroutine çš„å¸¸è§çŠ¶æ€è¿ç§»</strong></p><p>ä¸Šå›¾å±•ç¤ºäº† Goroutine çŠ¶æ€è¿ç§»çš„å¸¸è§è·¯å¾„ï¼Œå…¶ä¸­åŒ…æ‹¬åˆ›å»º Goroutine åˆ° Goroutine è¢«æ‰§è¡Œã€è§¦å‘ç³»ç»Ÿè°ƒç”¨æˆ–è€…æŠ¢å å¼è°ƒåº¦å™¨çš„çŠ¶æ€è¿ç§»è¿‡ç¨‹ã€‚</p><h3 id="M"><a href="#M" class="headerlink" title="M"></a>M</h3><p>Go è¯­è¨€å¹¶å‘æ¨¡å‹ä¸­çš„ M æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚è°ƒåº¦å™¨æœ€å¤šå¯ä»¥åˆ›å»º 10000 ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å…¶ä¸­å¤§å¤šæ•°çš„çº¿ç¨‹éƒ½ä¸ä¼šæ‰§è¡Œç”¨æˆ·ä»£ç ï¼ˆå¯èƒ½é™·å…¥ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œæœ€å¤šåªä¼šæœ‰ <code>GOMAXPROCS</code> ä¸ªæ´»è·ƒçº¿ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶ä¼šå°† <code>GOMAXPROCS</code> è®¾ç½®æˆå½“å‰æœºå™¨çš„æ ¸æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/debug.go#L17"><code>runtime.GOMAXPROCS</code></a> æ¥æ”¹å˜ç¨‹åºä¸­æœ€å¤§çš„çº¿ç¨‹æ•°ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354634-scheduler-m-and-thread.png" alt="scheduler-m-and-thread"></p><p><strong>CPU å’Œæ´»è·ƒçº¿ç¨‹</strong></p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå››æ ¸æœºå™¨ä¸Šä¼šåˆ›å»ºå››ä¸ªæ´»è·ƒçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯¹åº”ä¸€ä¸ªè¿è¡Œæ—¶ä¸­çš„ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L473"><code>runtime.m</code></a> ç»“æ„ä½“ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ Go çš„é»˜è®¤è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ•°ç­‰äº CPU ä¸ªæ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ä¼šè§¦å‘æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€æœ‰çš„è°ƒåº¦éƒ½ä¼šå‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œç”± Go è¯­è¨€è°ƒåº¦å™¨è§¦å‘ï¼Œèƒ½å¤Ÿå‡å°‘éå¸¸å¤šçš„é¢å¤–å¼€é”€ã€‚</p><p>æ“ä½œç³»ç»Ÿçº¿ç¨‹åœ¨ Go è¯­è¨€ä¸­ä¼šä½¿ç”¨ç§æœ‰ç»“æ„ä½“ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L473"><code>runtime.m</code></a> æ¥è¡¨ç¤ºï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­ä¹ŸåŒ…å«äº†å‡ åä¸ªç§æœ‰çš„å­—æ®µï¼Œæˆ‘ä»¬ä¾ç„¶å¯¹å…¶è¿›è¡Œäº†åˆ å‡ï¼Œå…ˆæ¥äº†è§£å‡ ä¸ªä¸ Goroutine ç›´æ¥ç›¸å…³çš„å­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span> &#123;</span><br><span class="line">g0   *g </span><br><span class="line">curg *g</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ g0 æ˜¯æŒæœ‰è°ƒåº¦æ ˆçš„ Goroutineï¼Œ<code>curg</code> æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸Šè¿è¡Œçš„ç”¨æˆ· Goroutineï¼Œè¿™ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹å”¯ä¸€å…³å¿ƒçš„ä¸¤ä¸ª Goroutineã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354644-g0-and-g.png" alt="g0-and-g"></p><p><strong>è°ƒåº¦ Goroutine å’Œè¿è¡Œ Goroutine</strong></p><p>g0 æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ä¸­æ¯”è¾ƒç‰¹æ®Šçš„ Goroutineï¼Œå®ƒä¼šæ·±åº¦å‚ä¸è¿è¡Œæ—¶çš„è°ƒåº¦è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ Goroutine çš„åˆ›å»ºã€å¤§å†…å­˜åˆ†é…å’Œ CGO å‡½æ•°çš„æ‰§è¡Œã€‚åœ¨åé¢çš„å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸çœ‹åˆ° g0 çš„èº«å½±ã€‚<a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L473"><code>runtime.m</code></a> ç»“æ„ä½“ä¸­è¿˜å­˜åœ¨ç€ä¸‰ä¸ªå¤„ç†å™¨å­—æ®µï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºæ­£åœ¨è¿è¡Œä»£ç çš„å¤„ç†å™¨ <code>p</code>ã€æš‚å­˜çš„å¤„ç†å™¨ <code>nextp</code> å’Œæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹å‰çš„ä½¿ç”¨çº¿ç¨‹çš„å¤„ç†å™¨ <code>oldp</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span> &#123;</span><br><span class="line">p             puintptr</span><br><span class="line">nextp         puintptr</span><br><span class="line">oldp          puintptr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†åœ¨ä¸Šé¢ä»‹ç»çš„å­—æ®µä¹‹å¤–ï¼Œ<a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L473"><code>runtime.m</code></a> ä¸­è¿˜åŒ…å«å¤§é‡ä¸çº¿ç¨‹çŠ¶æ€ã€é”ã€è°ƒåº¦ã€ç³»ç»Ÿè°ƒç”¨æœ‰å…³çš„å­—æ®µï¼Œæˆ‘ä»¬ä¼šåœ¨åˆ†æè°ƒåº¦è¿‡ç¨‹æ—¶è¯¦ç»†ä»‹ç»ã€‚</p><h3 id="P"><a href="#P" class="headerlink" title="P"></a>P</h3><p>è°ƒåº¦å™¨ä¸­çš„å¤„ç†å™¨ P æ˜¯çº¿ç¨‹å’Œ Goroutine çš„ä¸­é—´å±‚ï¼Œå®ƒèƒ½æä¾›çº¿ç¨‹éœ€è¦çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¹Ÿä¼šè´Ÿè´£è°ƒåº¦çº¿ç¨‹ä¸Šçš„ç­‰å¾…é˜Ÿåˆ—ï¼Œé€šè¿‡å¤„ç†å™¨ P çš„è°ƒåº¦ï¼Œæ¯ä¸€ä¸ªå†…æ ¸çº¿ç¨‹éƒ½èƒ½å¤Ÿæ‰§è¡Œå¤šä¸ª Goroutineï¼Œå®ƒèƒ½åœ¨ Goroutine è¿›è¡Œä¸€äº› I/O æ“ä½œæ—¶åŠæ—¶åˆ‡æ¢ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚</p><p>å› ä¸ºè°ƒåº¦å™¨åœ¨å¯åŠ¨æ—¶å°±ä¼šåˆ›å»º <code>GOMAXPROCS</code> ä¸ªå¤„ç†å™¨ï¼Œæ‰€ä»¥ Go è¯­è¨€ç¨‹åºçš„å¤„ç†å™¨æ•°é‡ä¸€å®šä¼šç­‰äº <code>GOMAXPROCS</code>ï¼Œè¿™äº›å¤„ç†å™¨ä¼šç»‘å®šåˆ°ä¸åŒçš„å†…æ ¸çº¿ç¨‹ä¸Šå¹¶åˆ©ç”¨çº¿ç¨‹çš„è®¡ç®—èµ„æºè¿è¡Œ Goroutineã€‚</p><p><a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L548"><code>runtime.p</code></a> æ˜¯å¤„ç†å™¨çš„è¿è¡Œæ—¶è¡¨ç¤ºï¼Œä½œä¸ºè°ƒåº¦å™¨çš„å†…éƒ¨å®ç°ï¼Œå®ƒåŒ…å«çš„å­—æ®µä¹Ÿéå¸¸å¤šï¼Œå…¶ä¸­åŒ…æ‹¬ä¸æ€§èƒ½è¿½è¸ªã€åƒåœ¾å›æ”¶å’Œè®¡æ—¶å™¨ç›¸å…³çš„å­—æ®µï¼Œè¿™äº›å­—æ®µä¹Ÿéå¸¸é‡è¦ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€å±•ç¤ºäº†ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨å¤„ç†å™¨ä¸­çš„çº¿ç¨‹å’Œè¿è¡Œé˜Ÿåˆ—ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> p <span class="keyword">struct</span> &#123;</span><br><span class="line">m           muintptr</span><br><span class="line"></span><br><span class="line">runqhead <span class="keyword">uint32</span></span><br><span class="line">runqtail <span class="keyword">uint32</span></span><br><span class="line">runq     [<span class="number">256</span>]guintptr</span><br><span class="line">runnext guintptr</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå‘å­˜å‚¨çš„çº¿ç¨‹ç»´æŠ¤ç€çº¿ç¨‹ä¸å¤„ç†å™¨ä¹‹é—´çš„å…³ç³»ï¼Œè€Œ <code>runhead</code>ã€<code>runqtail</code> å’Œ <code>runq</code> ä¸‰ä¸ªå­—æ®µè¡¨ç¤ºå¤„ç†å™¨æŒæœ‰çš„è¿è¡Œé˜Ÿåˆ—ï¼Œå…¶ä¸­å­˜å‚¨ç€å¾…æ‰§è¡Œçš„ Goroutine åˆ—è¡¨ï¼Œ<code>runnext</code> ä¸­æ˜¯çº¿ç¨‹ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„ Goroutineã€‚</p><p><a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L548"><code>runtime.p</code></a> ç»“æ„ä½“ä¸­çš„çŠ¶æ€ <code>status</code> å­—æ®µä¼šæ˜¯ä»¥ä¸‹äº”ç§ä¸­çš„ä¸€ç§ï¼š</p><div class="table-container"><table><thead><tr><th>çŠ¶æ€</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>_Pidle</code></td><td>å¤„ç†å™¨æ²¡æœ‰è¿è¡Œç”¨æˆ·ä»£ç æˆ–è€…è°ƒåº¦å™¨ï¼Œè¢«ç©ºé—²é˜Ÿåˆ—æˆ–è€…æ”¹å˜å…¶çŠ¶æ€çš„ç»“æ„æŒæœ‰ï¼Œè¿è¡Œé˜Ÿåˆ—ä¸ºç©º</td></tr><tr><td><code>_Prunning</code></td><td>è¢«çº¿ç¨‹ M æŒæœ‰ï¼Œå¹¶ä¸”æ­£åœ¨æ‰§è¡Œç”¨æˆ·ä»£ç æˆ–è€…è°ƒåº¦å™¨</td></tr><tr><td><code>_Psyscall</code></td><td>æ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œå½“å‰çº¿ç¨‹é™·å…¥ç³»ç»Ÿè°ƒç”¨</td></tr><tr><td><code>_Pgcstop</code></td><td>è¢«çº¿ç¨‹ M æŒæœ‰ï¼Œå½“å‰å¤„ç†å™¨ç”±äºåƒåœ¾å›æ”¶è¢«åœæ­¢</td></tr><tr><td><code>_Pdead</code></td><td>å½“å‰å¤„ç†å™¨å·²ç»ä¸è¢«ä½¿ç”¨</td></tr></tbody></table></div><p>é€šè¿‡åˆ†æå¤„ç†å™¨ P çš„çŠ¶æ€ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¯¹å¤„ç†å™¨çš„å·¥ä½œè¿‡ç¨‹æœ‰ä¸€äº›ç®€å•ç†è§£ï¼Œä¾‹å¦‚å¤„ç†å™¨åœ¨æ‰§è¡Œç”¨æˆ·ä»£ç æ—¶ä¼šå¤„äº <code>_Prunning</code> çŠ¶æ€ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ I/O æ“ä½œæ—¶ä¼šé™·å…¥ <code>_Psyscall</code> çŠ¶æ€ã€‚</p><h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æˆ‘ä»¬åœ¨è¿™ä¸€å°èŠ‚ç®€å•ä»‹ç»äº† Go è¯­è¨€è°ƒåº¦å™¨ä¸­å¸¸è§çš„æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬çº¿ç¨‹ Mã€å¤„ç†å™¨ P å’Œ Goroutine Gï¼Œå®ƒä»¬åœ¨ Go è¯­è¨€è¿è¡Œæ—¶ä¸­åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„ç§æœ‰ç»“æ„ä½“è¡¨ç¤ºï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢ä¼šæ·±å…¥åˆ†æ Go è¯­è¨€è°ƒåº¦å™¨çš„å®ç°åŸç†ã€‚</p><h2 id="è°ƒåº¦å™¨å¯åŠ¨"><a href="#è°ƒåº¦å™¨å¯åŠ¨" class="headerlink" title="è°ƒåº¦å™¨å¯åŠ¨"></a>è°ƒåº¦å™¨å¯åŠ¨</h2><p>è°ƒåº¦å™¨çš„å¯åŠ¨è¿‡ç¨‹æ˜¯æˆ‘ä»¬å¹³æ—¶æ¯”è¾ƒéš¾ä»¥æ¥è§¦çš„è¿‡ç¨‹ï¼Œä¸è¿‡ä½œä¸ºç¨‹åºå¯åŠ¨å‰çš„å‡†å¤‡å·¥ä½œï¼Œç†è§£è°ƒåº¦å™¨çš„å¯åŠ¨è¿‡ç¨‹å¯¹æˆ‘ä»¬ç†è§£è°ƒåº¦å™¨çš„å®ç°åŸç†å¾ˆæœ‰å¸®åŠ©ï¼Œè¿è¡Œæ—¶é€šè¿‡ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L532"><code>runtime.schedinit</code></a> å‡½æ•°åˆå§‹åŒ–è°ƒåº¦å™¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">schedinit</span><span class="params">()</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">sched.maxmcount = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">sched.lastpoll = <span class="keyword">uint64</span>(nanotime())</span><br><span class="line">procs := ncpu</span><br><span class="line"><span class="keyword">if</span> n, ok := atoi32(gogetenv(<span class="string">&quot;GOMAXPROCS&quot;</span>)); ok &amp;&amp; n &gt; <span class="number">0</span> &#123;</span><br><span class="line">procs = n</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> procresize(procs) != <span class="literal">nil</span> &#123;</span><br><span class="line">throw(<span class="string">&quot;unknown runnable goroutine during bootstrap&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è°ƒåº¦å™¨åˆå§‹å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå°† <code>maxmcount</code> è®¾ç½®æˆ 10000ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸€ä¸ª Go è¯­è¨€ç¨‹åºèƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè™½ç„¶æœ€å¤šå¯ä»¥åˆ›å»º 10000 ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹è¿˜æ˜¯ç”± <code>GOMAXPROCS</code> å˜é‡æ§åˆ¶ã€‚</p><p>æˆ‘ä»¬ä»ç¯å¢ƒå˜é‡ <code>GOMAXPROCS</code> è·å–äº†ç¨‹åºèƒ½å¤ŸåŒæ—¶è¿è¡Œçš„æœ€å¤§å¤„ç†å™¨æ•°ä¹‹åå°±ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4154"><code>runtime.procresize</code></a> æ›´æ–°ç¨‹åºä¸­å¤„ç†å™¨çš„æ•°é‡ï¼Œåœ¨è¿™æ—¶æ•´ä¸ªç¨‹åºä¸ä¼šæ‰§è¡Œä»»ä½•ç”¨æˆ· Goroutineï¼Œè°ƒåº¦å™¨ä¹Ÿä¼šè¿›å…¥é”å®šçŠ¶æ€ï¼Œ<a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4154"><code>runtime.procresize</code></a> çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœå…¨å±€å˜é‡ <code>allp</code> åˆ‡ç‰‡ä¸­çš„å¤„ç†å™¨æ•°é‡å°‘äºæœŸæœ›æ•°é‡ï¼Œå°±ä¼šå¯¹åˆ‡ç‰‡è¿›è¡Œæ‰©å®¹ï¼›</li><li>ä½¿ç”¨ <code>new</code> åˆ›å»ºæ–°çš„å¤„ç†å™¨ç»“æ„ä½“å¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4026"><code>runtime.p.init</code></a> æ–¹æ³•åˆå§‹åŒ–åˆšåˆšæ‰©å®¹çš„å¤„ç†å™¨ï¼›</li><li>é€šè¿‡æŒ‡é’ˆå°†çº¿ç¨‹ m0 å’Œå¤„ç†å™¨ <code>allp[0]</code> ç»‘å®šåˆ°ä¸€èµ·ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4058"><code>runtime.p.destroy</code></a> æ–¹æ³•é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¤„ç†å™¨ç»“æ„ï¼›</li><li>é€šè¿‡æˆªæ–­æ”¹å˜å…¨å±€å˜é‡ <code>allp</code> çš„é•¿åº¦ä¿è¯ä¸æœŸæœ›å¤„ç†å™¨æ•°é‡ç›¸ç­‰ï¼›</li><li>å°†é™¤ <code>allp[0]</code> ä¹‹å¤–çš„å¤„ç†å™¨ P å…¨éƒ¨è®¾ç½®æˆ <code>_Pidle</code> å¹¶åŠ å…¥åˆ°å…¨å±€çš„ç©ºé—²é˜Ÿåˆ—ä¸­ï¼›</li></ol><p>è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4154"><code>runtime.procresize</code></a> å°±æ˜¯è°ƒåº¦å™¨å¯åŠ¨çš„æœ€åä¸€æ­¥ï¼Œåœ¨è¿™ä¸€æ­¥è¿‡åè°ƒåº¦å™¨ä¼šå®Œæˆç›¸åº”æ•°é‡å¤„ç†å™¨çš„å¯åŠ¨ï¼Œç­‰å¾…ç”¨æˆ·åˆ›å»ºè¿è¡Œæ–°çš„ Goroutine å¹¶ä¸º Goroutine è°ƒåº¦å¤„ç†å™¨èµ„æºã€‚</p><h2 id="åˆ›å»º-Goroutine"><a href="#åˆ›å»º-Goroutine" class="headerlink" title="åˆ›å»º Goroutine"></a>åˆ›å»º Goroutine</h2><p>æƒ³è¦å¯åŠ¨ä¸€ä¸ªæ–°çš„ Goroutine æ¥æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Go è¯­è¨€ä¸­çš„ <code>go</code> å…³é”®å­—ï¼Œè¿™ä¸ªå…³é”®å­—ä¼šåœ¨ç¼–è¯‘æœŸé—´é€šè¿‡ä»¥ä¸‹æ–¹æ³• <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L1023"><code>cmd/compile/internal/gc.state.stmt</code></a> å’Œ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L4324"><code>cmd/compile/internal/gc.state.call</code></a> ä¸¤ä¸ªæ–¹æ³•å°†è¯¥å…³é”®å­—è½¬æ¢æˆ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3376"><code>runtime.newproc</code></a> å‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *state)</span> <span class="title">call</span><span class="params">(n *Node, k callKind)</span> *<span class="title">ssa</span>.<span class="title">Value</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> k == callDeferStack &#123;</span><br><span class="line">...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> k == callGo:</span><br><span class="line">call = s.newValue1A(ssa.OpStaticCall, types.TypeMem, newproc, s.mem())</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šå°†æ‰€æœ‰çš„ <code>go</code> å…³é”®å­—è¢«è½¬æ¢æˆ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3376"><code>runtime.newproc</code></a> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šæ¥æ”¶å¤§å°å’Œè¡¨ç¤ºå‡½æ•°çš„æŒ‡é’ˆ <code>funcval</code>ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬è¿˜ä¼šè·å– Goroutine ä»¥åŠè°ƒç”¨æ–¹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œç„¶åè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3388"><code>runtime.newproc1</code></a> å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newproc</span><span class="params">(siz <span class="keyword">int32</span>, fn *funcval)</span></span> &#123;</span><br><span class="line">argp := add(unsafe.Pointer(&amp;fn), sys.PtrSize)</span><br><span class="line">gp := getg()</span><br><span class="line">pc := getcallerpc()</span><br><span class="line">newproc1(fn, (*<span class="keyword">uint8</span>)(argp), siz, gp, pc)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3388"><code>runtime.newproc1</code></a> ä¼šæ ¹æ®ä¼ å…¥å‚æ•°åˆå§‹åŒ–ä¸€ä¸ª <code>g</code> ç»“æ„ä½“ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥å‡½æ•°åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ä»‹ç»å®ƒçš„å®ç°ï¼š</p><ol><li>è·å–æˆ–è€…åˆ›å»ºæ–°çš„ Goroutine ç»“æ„ä½“ï¼›</li><li>å°†ä¼ å…¥çš„å‚æ•°ç§»åˆ° Goroutine çš„æ ˆä¸Šï¼›</li><li>æ›´æ–° Goroutine è°ƒåº¦ç›¸å…³çš„å±æ€§ï¼›</li><li>å°† Goroutine åŠ å…¥å¤„ç†å™¨çš„è¿è¡Œé˜Ÿåˆ—ï¼›</li></ol><p>é¦–å…ˆæ˜¯ Goroutine ç»“æ„ä½“çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newproc1</span><span class="params">(fn *funcval, argp *<span class="keyword">uint8</span>, narg <span class="keyword">int32</span>, callergp *g, callerpc <span class="keyword">uintptr</span>)</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line">siz := narg</span><br><span class="line">siz = (siz + <span class="number">7</span>) &amp;^ <span class="number">7</span></span><br><span class="line"></span><br><span class="line">_p_ := _g_.m.p.ptr()</span><br><span class="line">newg := gfget(_p_)</span><br><span class="line"><span class="keyword">if</span> newg == <span class="literal">nil</span> &#123;</span><br><span class="line">newg = malg(_StackMin)</span><br><span class="line">casgstatus(newg, _Gidle, _Gdead)</span><br><span class="line">allgadd(newg)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¼šå…ˆä»å¤„ç†å™¨çš„ <code>gFree</code> åˆ—è¡¨ä¸­æŸ¥æ‰¾ç©ºé—²çš„ Goroutineï¼Œå¦‚æœä¸å­˜åœ¨ç©ºé—²çš„ Goroutineï¼Œå°±ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3353"><code>runtime.malg</code></a> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ ˆå¤§å°è¶³å¤Ÿçš„æ–°ç»“æ„ä½“ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/9b5bd30716914a86619c050f0d75c0da4133b257/src/runtime/memmove_386.s#L34"><code>runtime.memmove</code></a> å‡½æ•°å°† <code>fn</code> å‡½æ•°çš„å…¨éƒ¨å‚æ•°æ‹·è´åˆ°æ ˆä¸Šï¼Œ<code>argp</code> å’Œ <code>narg</code> åˆ†åˆ«æ˜¯å‚æ•°çš„å†…å­˜ç©ºé—´å’Œå¤§å°ï¼Œæˆ‘ä»¬åœ¨è¯¥æ–¹æ³•ä¸­ä¼šç›´æ¥å°†æ‰€æœ‰å‚æ•°å¯¹åº”çš„å†…å­˜ç©ºé—´æ•´ç‰‡çš„æ‹·è´åˆ°æ ˆä¸Šï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">totalSize := <span class="number">4</span>*sys.RegSize + <span class="keyword">uintptr</span>(siz) + sys.MinFrameSize</span><br><span class="line">totalSize += -totalSize &amp; (sys.SpAlign - <span class="number">1</span>)</span><br><span class="line">sp := newg.stack.hi - totalSize</span><br><span class="line">spArg := sp</span><br><span class="line"><span class="keyword">if</span> narg &gt; <span class="number">0</span> &#123;</span><br><span class="line">memmove(unsafe.Pointer(spArg), unsafe.Pointer(argp), <span class="keyword">uintptr</span>(narg))</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ‹·è´äº†æ ˆä¸Šçš„å‚æ•°ä¹‹åï¼Œ<a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3388"><code>runtime.newproc1</code></a> ä¼šè®¾ç½®æ–°çš„ Goroutine ç»“æ„ä½“çš„å‚æ•°ï¼ŒåŒ…æ‹¬æ ˆæŒ‡é’ˆã€ç¨‹åºè®¡æ•°å™¨å¹¶æ›´æ–°å…¶çŠ¶æ€åˆ° <code>_Grunnable</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">memclrNoHeapPointers(unsafe.Pointer(&amp;newg.sched), unsafe.Sizeof(newg.sched))</span><br><span class="line">newg.sched.sp = sp</span><br><span class="line">newg.stktopsp = sp</span><br><span class="line">newg.sched.pc = funcPC(goexit) + sys.PCQuantum</span><br><span class="line">newg.sched.g = guintptr(unsafe.Pointer(newg))</span><br><span class="line">gostartcallfn(&amp;newg.sched, fn)</span><br><span class="line">newg.gopc = callerpc</span><br><span class="line">newg.startpc = fn.fn</span><br><span class="line">casgstatus(newg, _Gdead, _Grunnable)</span><br><span class="line">newg.goid = <span class="keyword">int64</span>(_p_.goidcache)</span><br><span class="line">_p_.goidcache++</span><br></pre></td></tr></table></figure><p>åœ¨æœ€åï¼Œè¯¥å‡½æ•°ä¼šå°†åˆå§‹åŒ–å¥½çš„ Goroutine åŠ å…¥å¤„ç†å™¨çš„è¿è¡Œé˜Ÿåˆ—å¹¶åœ¨æ»¡è¶³æ¡ä»¶æ—¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L1948"><code>runtime.wakep</code></a> å‡½æ•°å”¤é†’æ–°çš„å¤„ç†æ‰§è¡Œ Goroutineï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">runqput(_p_, newg, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> atomic.Load(&amp;sched.npidle) != <span class="number">0</span> &amp;&amp; atomic.Load(&amp;sched.nmspinning) == <span class="number">0</span> &amp;&amp; mainStarted &#123;</span><br><span class="line">wakep()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨åˆ†æ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3388"><code>runtime.newproc1</code></a> å‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼Œçœç•¥äº†ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„è¿‡ç¨‹ï¼Œåˆ†åˆ«æ˜¯ç”¨äºè·å–ç»“æ„ä½“çš„ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3563"><code>runtime.gfget</code></a>ã€<a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3353"><code>runtime.malg</code></a> å‡½æ•°ã€å°† Goroutine åŠ å…¥è¿è¡Œé˜Ÿåˆ—çš„ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4949"><code>runtime.runqput</code></a> ä»¥åŠè°ƒåº¦ä¿¡æ¯çš„è®¾ç½®è¿‡ç¨‹ã€‚</p><h3 id="åˆå§‹åŒ–ç»“æ„ä½“"><a href="#åˆå§‹åŒ–ç»“æ„ä½“" class="headerlink" title="åˆå§‹åŒ–ç»“æ„ä½“"></a>åˆå§‹åŒ–ç»“æ„ä½“</h3><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3563"><code>runtime.gfget</code></a> é€šè¿‡ä¸¤ç§ä¸åŒçš„æ–¹å¼è·å–æ–°çš„ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L395"><code>runtime.g</code></a> ç»“æ„ä½“ï¼š</p><ol><li>ä» Goroutine æ‰€åœ¨å¤„ç†å™¨çš„ <code>gFree</code> åˆ—è¡¨æˆ–è€…è°ƒåº¦å™¨çš„ <code>sched.gFree</code> åˆ—è¡¨ä¸­è·å– <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L395"><code>runtime.g</code></a> ç»“æ„ä½“ï¼›</li><li>è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3353"><code>runtime.malg</code></a> å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°çš„ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L395"><code>runtime.g</code></a> å‡½æ•°å¹¶å°†å½“å‰ç»“æ„ä½“è¿½åŠ åˆ°å…¨å±€çš„ Goroutine åˆ—è¡¨ <code>allgs</code> ä¸­ã€‚</li></ol><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/golang-newproc-get-goroutine.png" alt="golang-newproc-get-goroutine"></p><p><strong>è·å– Goroutine ç»“æ„ä½“çš„ä¸‰ç§æ–¹æ³•</strong></p><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3563"><code>runtime.gfget</code></a> ä¸­åŒ…å«ä¸¤éƒ¨åˆ†é€»è¾‘ï¼Œå®ƒä¼šæ ¹æ®å¤„ç†å™¨ä¸­ <code>gFree</code> åˆ—è¡¨ä¸­ Goroutine çš„æ•°é‡åšå‡ºä¸åŒçš„å†³ç­–ï¼š</p><ol><li>å½“å¤„ç†å™¨çš„ Goroutine åˆ—è¡¨ä¸ºç©ºæ—¶ï¼Œä¼šå°†è°ƒåº¦å™¨æŒæœ‰çš„ç©ºé—² Goroutine è½¬ç§»åˆ°å½“å‰å¤„ç†å™¨ä¸Šï¼Œç›´åˆ° <code>gFree</code> åˆ—è¡¨ä¸­çš„ Goroutine æ•°é‡è¾¾åˆ° 32ï¼›</li><li>å½“å¤„ç†å™¨çš„ Goroutine æ•°é‡å……è¶³æ—¶ï¼Œä¼šä»åˆ—è¡¨å¤´éƒ¨è¿”å›ä¸€ä¸ªæ–°çš„ Goroutineï¼›</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gfget</span><span class="params">(_p_ *p)</span> *<span class="title">g</span></span> &#123;</span><br><span class="line">retry:</span><br><span class="line"><span class="keyword">if</span> _p_.gFree.empty() &amp;&amp; (!sched.gFree.stack.empty() || !sched.gFree.noStack.empty()) &#123;</span><br><span class="line"><span class="keyword">for</span> _p_.gFree.n &lt; <span class="number">32</span> &#123;</span><br><span class="line">gp := sched.gFree.stack.pop()</span><br><span class="line"><span class="keyword">if</span> gp == <span class="literal">nil</span> &#123;</span><br><span class="line">gp = sched.gFree.noStack.pop()</span><br><span class="line"><span class="keyword">if</span> gp == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">_p_.gFree.push(gp)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">goto</span> retry</span><br><span class="line">&#125;</span><br><span class="line">gp := _p_.gFree.pop()</span><br><span class="line"><span class="keyword">if</span> gp == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> gp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è°ƒåº¦å™¨çš„ <code>gFree</code> å’Œå¤„ç†å™¨çš„ <code>gFree</code> åˆ—è¡¨éƒ½ä¸å­˜åœ¨ç»“æ„ä½“æ—¶ï¼Œè¿è¡Œæ—¶ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3353"><code>runtime.malg</code></a> åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L395"><code>runtime.g</code></a> ç»“æ„ä½“ï¼Œå¦‚æœç”³è¯·çš„å †æ ˆå¤§å°å¤§äº 0ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/stack.go#L324"><code>runtime.stackalloc</code></a> åˆ†é… 2KB çš„æ ˆç©ºé—´ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">malg</span><span class="params">(stacksize <span class="keyword">int32</span>)</span> *<span class="title">g</span></span> &#123;</span><br><span class="line">newg := <span class="built_in">new</span>(g)</span><br><span class="line"><span class="keyword">if</span> stacksize &gt;= <span class="number">0</span> &#123;</span><br><span class="line">stacksize = round2(_StackSystem + stacksize)</span><br><span class="line">newg.stack = stackalloc(<span class="keyword">uint32</span>(stacksize))</span><br><span class="line">newg.stackguard0 = newg.stack.lo + _StackGuard</span><br><span class="line">newg.stackguard1 = ^<span class="keyword">uintptr</span>(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> newg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3353"><code>runtime.malg</code></a> è¿”å›çš„ Goroutine ä¼šå­˜å‚¨åˆ°å…¨å±€å˜é‡ <code>allgs</code> ä¸­ã€‚</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œ<a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3388"><code>runtime.newproc1</code></a> ä¼šä»å¤„ç†å™¨æˆ–è€…è°ƒåº¦å™¨çš„ç¼“å­˜ä¸­è·å–æ–°çš„ç»“æ„ä½“ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3353"><code>runtime.malg</code></a> å‡½æ•°åˆ›å»ºæ–°çš„ç»“æ„ä½“ã€‚</p><h3 id="è¿è¡Œé˜Ÿåˆ—"><a href="#è¿è¡Œé˜Ÿåˆ—" class="headerlink" title="è¿è¡Œé˜Ÿåˆ—"></a>è¿è¡Œé˜Ÿåˆ—</h3><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4949"><code>runtime.runqput</code></a> å‡½æ•°ä¼šå°†æ–°åˆ›å»ºçš„ Goroutine è¿è¡Œé˜Ÿåˆ—ä¸Šï¼Œè¿™æ—¢å¯èƒ½æ˜¯å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runqput</span><span class="params">(_p_ *p, gp *g, next <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> next &#123;</span><br><span class="line">retryNext:</span><br><span class="line">oldnext := _p_.runnext</span><br><span class="line"><span class="keyword">if</span> !_p_.runnext.cas(oldnext, guintptr(unsafe.Pointer(gp))) &#123;</span><br><span class="line"><span class="keyword">goto</span> retryNext</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> oldnext == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">gp = oldnext.ptr()</span><br><span class="line">&#125;</span><br><span class="line">retry:</span><br><span class="line">h := atomic.LoadAcq(&amp;_p_.runqhead)</span><br><span class="line">t := _p_.runqtail</span><br><span class="line"><span class="keyword">if</span> t-h &lt; <span class="keyword">uint32</span>(<span class="built_in">len</span>(_p_.runq)) &#123;</span><br><span class="line">_p_.runq[t%<span class="keyword">uint32</span>(<span class="built_in">len</span>(_p_.runq))].set(gp)</span><br><span class="line">atomic.StoreRel(&amp;_p_.runqtail, t+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> runqputslow(_p_, gp, h, t) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">goto</span> retry</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å½“ <code>next</code> ä¸º <code>true</code> æ—¶ï¼Œå°† Goroutine è®¾ç½®åˆ°å¤„ç†å™¨çš„ <code>runnext</code> ä¸Šä½œä¸ºä¸‹ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œçš„ä»»åŠ¡ï¼›</li><li>å½“ <code>next</code> ä¸º <code>false</code> å¹¶ä¸”æœ¬åœ°è¿è¡Œé˜Ÿåˆ—è¿˜æœ‰å‰©ä½™ç©ºé—´æ—¶ï¼Œå°† Goroutine åŠ å…¥å¤„ç†å™¨æŒæœ‰çš„æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼›</li><li>å½“å¤„ç†å™¨çš„æœ¬åœ°è¿è¡Œé˜Ÿåˆ—å·²ç»æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶å°±ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­çš„ä¸€éƒ¨åˆ† Goroutine å’Œå¾…åŠ å…¥çš„ Goroutine é€šè¿‡ <code>runqputslow</code> æ·»åŠ åˆ°è°ƒåº¦å™¨æŒæœ‰çš„å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸Šï¼›</li></ol><p>å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—æ˜¯ä¸€ä¸ªä½¿ç”¨æ•°ç»„æ„æˆçš„ç¯å½¢é“¾è¡¨ï¼Œå®ƒæœ€å¤šå¯ä»¥å­˜å‚¨ 256 ä¸ªå¾…æ‰§è¡Œä»»åŠ¡ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/pnUmLD2SxOdeXwM.png" alt="golang-runnable-queue"></p><p><strong>å…¨å±€å’Œæœ¬åœ°è¿è¡Œé˜Ÿåˆ—</strong></p><p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼ŒGo è¯­è¨€ä¸­æœ‰ä¸¤ä¸ªè¿è¡Œé˜Ÿåˆ—ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ï¼Œå¦ä¸€ä¸ªæ˜¯è°ƒåº¦å™¨æŒæœ‰çš„å…¨å±€è¿è¡Œé˜Ÿåˆ—ï¼Œåªæœ‰åœ¨æœ¬åœ°è¿è¡Œé˜Ÿåˆ—æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶æ‰ä¼šä½¿ç”¨å…¨å±€é˜Ÿåˆ—ã€‚</p><h3 id="è°ƒåº¦ä¿¡æ¯"><a href="#è°ƒåº¦ä¿¡æ¯" class="headerlink" title="è°ƒåº¦ä¿¡æ¯"></a>è°ƒåº¦ä¿¡æ¯</h3><p>è¿è¡Œæ—¶åˆ›å»º Goroutine æ—¶ä¼šé€šè¿‡ä¸‹é¢çš„ä»£ç è®¾ç½®è°ƒåº¦ç›¸å…³çš„ä¿¡æ¯ï¼Œå‰ä¸¤è¡Œä»£ç ä¼šåˆ†åˆ«å°†ç¨‹åºè®¡æ•°å™¨å’Œ Goroutine è®¾ç½®æˆ <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L1336"><code>runtime.goexit</code></a> å‡½æ•°å’Œæ–°åˆ›å»ºçš„ Goroutineï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">newg.sched.pc = funcPC(goexit) + sys.PCQuantum</span><br><span class="line">newg.sched.g = guintptr(unsafe.Pointer(newg))</span><br><span class="line">gostartcallfn(&amp;newg.sched, fn)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œçš„è°ƒåº¦ä¿¡æ¯ <code>sched</code> ä¸æ˜¯åˆå§‹åŒ–åçš„ Goroutine çš„æœ€ç»ˆç»“æœï¼Œç»è¿‡ <a href="https://github.com/golang/go/blob/0f251028585e052a3d34dcce83b05d8aa9ba170e/src/runtime/stack.go#L1058"><code>runtime.gostartcallfn</code></a> å’Œ <a href="https://github.com/golang/go/blob/03ef105daeff4fef1fd66dbffb8e17d1f779b9ea/src/runtime/sys_x86.go#L16"><code>runtime.gostartcall</code></a> ä¸¤ä¸ªå‡½æ•°çš„å¤„ç†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gostartcallfn</span><span class="params">(gobuf *gobuf, fv *funcval)</span></span> &#123;</span><br><span class="line">gostartcall(gobuf, unsafe.Pointer(fv.fn), unsafe.Pointer(fv))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gostartcall</span><span class="params">(buf *gobuf, fn, ctxt unsafe.Pointer)</span></span> &#123;</span><br><span class="line">sp := buf.sp</span><br><span class="line"><span class="keyword">if</span> sys.RegSize &gt; sys.PtrSize &#123;</span><br><span class="line">sp -= sys.PtrSize</span><br><span class="line">*(*<span class="keyword">uintptr</span>)(unsafe.Pointer(sp)) = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">sp -= sys.PtrSize</span><br><span class="line">*(*<span class="keyword">uintptr</span>)(unsafe.Pointer(sp)) = buf.pc</span><br><span class="line">buf.sp = sp</span><br><span class="line">buf.pc = <span class="keyword">uintptr</span>(fn)</span><br><span class="line">buf.ctxt = ctxt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒåº¦ä¿¡æ¯çš„ <code>sp</code> ä¸­å­˜å‚¨äº† <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L1336"><code>runtime.goexit</code></a> å‡½æ•°çš„ç¨‹åºè®¡æ•°å™¨ï¼Œè€Œ <code>pc</code> ä¸­å­˜å‚¨äº†ä¼ å…¥å‡½æ•°çš„ç¨‹åºè®¡æ•°å™¨ã€‚å› ä¸º <code>pc</code> å¯„å­˜å™¨çš„ä½œç”¨å°±æ˜¯å­˜å‚¨ç¨‹åºæ¥ä¸‹æ¥è¿è¡Œçš„ä½ç½®ï¼Œæ‰€ä»¥è¿™é‡Œ <code>pc</code> çš„ä½¿ç”¨æ¯”è¾ƒå¥½ç†è§£ï¼Œä½†æ˜¯ <code>sp</code> ä¸­å­˜å‚¨çš„ <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L1336"><code>runtime.goexit</code></a> å°±ä¼šè®©äººæ„Ÿåˆ°å›°æƒ‘ï¼Œæˆ‘ä»¬éœ€è¦é…åˆä¸‹é¢çš„è°ƒåº¦å¾ªç¯æ¥ç†è§£ <code>sp</code> çš„ä½œç”¨ã€‚</p><h2 id="è°ƒåº¦å¾ªç¯"><a href="#è°ƒåº¦å¾ªç¯" class="headerlink" title="è°ƒåº¦å¾ªç¯"></a>è°ƒåº¦å¾ªç¯</h2><p>è°ƒåº¦å™¨å¯åŠ¨ä¹‹åï¼ŒGo è¯­è¨€è¿è¡Œæ—¶ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L1041"><code>runtime.mstart</code></a> ä»¥åŠ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L1075"><code>runtime.mstart1</code></a>ï¼Œå‰è€…ä¼šåˆå§‹åŒ– g0 çš„ <code>stackguard0</code> å’Œ <code>stackguard1</code> å­—æ®µï¼Œåè€…ä¼šåˆå§‹åŒ–çº¿ç¨‹å¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> è¿›å…¥è°ƒåº¦å¾ªç¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">schedule</span><span class="params">()</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"></span><br><span class="line">top:</span><br><span class="line"><span class="keyword">var</span> gp *g</span><br><span class="line"><span class="keyword">var</span> inheritTime <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> gp == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> _g_.m.p.ptr().schedtick%<span class="number">61</span> == <span class="number">0</span> &amp;&amp; sched.runqsize &gt; <span class="number">0</span> &#123;</span><br><span class="line">lock(&amp;sched.lock)</span><br><span class="line">gp = globrunqget(_g_.m.p.ptr(), <span class="number">1</span>)</span><br><span class="line">unlock(&amp;sched.lock)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> gp == <span class="literal">nil</span> &#123;</span><br><span class="line">gp, inheritTime = runqget(_g_.m.p.ptr())</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> gp == <span class="literal">nil</span> &#123;</span><br><span class="line">gp, inheritTime = findrunnable()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execute(gp, inheritTime)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> å‡½æ•°çš„ä¼šä»ä¸åŒåœ°æ–¹æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutineï¼š</p><ol><li>ä¸ºäº†ä¿è¯å…¬å¹³ï¼Œå½“å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸­æœ‰å¾…æ‰§è¡Œçš„ Goroutine æ—¶ï¼Œé€šè¿‡ <code>schedtick</code> ä¿è¯æœ‰ä¸€å®šå‡ ç‡ä¼šä»å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾å¯¹åº”çš„ Goroutineï¼›</li><li>ä»å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutineï¼›</li><li>å¦‚æœå‰ä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰æ‰¾åˆ° Goroutineï¼Œå°±ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/8d7be1e3c9a98191f8c900087025c5e78b73d962/src/runtime/proc.go#L2111"><code>runtime.findrunnable</code></a> è¿›è¡Œé˜»å¡åœ°æŸ¥æ‰¾ Goroutineï¼›</li></ol><p><a href="https://github.com/golang/go/blob/8d7be1e3c9a98191f8c900087025c5e78b73d962/src/runtime/proc.go#L2111"><code>runtime.findrunnable</code></a> å‡½æ•°çš„å®ç°éå¸¸å¤æ‚ï¼Œè¿™ä¸ª 300 å¤šè¡Œçš„å‡½æ•°é€šè¿‡ä»¥ä¸‹çš„è¿‡ç¨‹è·å–å¯è¿è¡Œçš„ Goroutineï¼š</p><ol><li>ä»æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ã€å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾ï¼›</li><li>ä»ç½‘ç»œè½®è¯¢å™¨ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ Goroutine ç­‰å¾…è¿è¡Œï¼›</li><li>é€šè¿‡ <a href="https://github.com/golang/go/blob/8d7be1e3c9a98191f8c900087025c5e78b73d962/src/runtime/proc.go#L5147"><code>runtime.runqsteal</code></a> å‡½æ•°å°è¯•ä»å…¶ä»–éšæœºçš„å¤„ç†å™¨ä¸­çªƒå–å¾…è¿è¡Œçš„ Goroutineï¼Œåœ¨è¯¥è¿‡ç¨‹ä¸­è¿˜å¯èƒ½çªƒå–å¤„ç†å™¨ä¸­çš„è®¡æ—¶å™¨ï¼›</li></ol><p>å› ä¸ºå‡½æ•°çš„å®ç°è¿‡äºå¤æ‚ï¼Œä¸Šè¿°æ‰§è¡Œè¿‡ç¨‹æ˜¯ç»è¿‡å¤§é‡ç®€åŒ–çš„ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œå½“å‰å‡½æ•°ä¸€å®šä¼šè¿”å›ä¸€ä¸ªå¯æ‰§è¡Œçš„ Goroutineï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨å°±ä¼šé˜»å¡ç­‰å¾…ã€‚</p><p>æ¥ä¸‹æ¥ç”± <a href="https://github.com/golang/go/blob/8d7be1e3c9a98191f8c900087025c5e78b73d962/src/runtime/proc.go#L2076"><code>runtime.execute</code></a> å‡½æ•°æ‰§è¡Œè·å–çš„ Goroutineï¼Œåšå¥½å‡†å¤‡å·¥ä½œåï¼Œå®ƒä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L301"><code>runtime.gogo</code></a> å°† Goroutine è°ƒåº¦åˆ°å½“å‰çº¿ç¨‹ä¸Šã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">execute</span><span class="params">(gp *g, inheritTime <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"></span><br><span class="line">_g_.m.curg = gp</span><br><span class="line">gp.m = _g_.m</span><br><span class="line">casgstatus(gp, _Grunnable, _Grunning)</span><br><span class="line">gp.waitsince = <span class="number">0</span></span><br><span class="line">gp.preempt = <span class="literal">false</span></span><br><span class="line">gp.stackguard0 = gp.stack.lo + _StackGuard</span><br><span class="line"><span class="keyword">if</span> !inheritTime &#123;</span><br><span class="line">_g_.m.p.ptr().schedtick++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gogo(&amp;gp.sched)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L301"><code>runtime.gogo</code></a> åœ¨ä¸åŒå¤„ç†å™¨æ¶æ„ä¸Šçš„å®ç°éƒ½ä¸åŒï¼Œä½†æ˜¯ä¸åŒçš„å®ç°ä¹Ÿéƒ½å¤§åŒå°å¼‚ï¼Œä¸‹é¢æ˜¯è¯¥å‡½æ•°åœ¨ 386 æ¶æ„ä¸Šçš„å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">TEXT runtimeÂ·gogo(SB), NOSPLIT, $<span class="number">8</span><span class="number">-4</span></span><br><span class="line">MOVL buf+<span class="number">0</span>(FP), BX     <span class="comment">// è·å–è°ƒåº¦ä¿¡æ¯</span></span><br><span class="line">MOVL gobuf_g(BX), DX</span><br><span class="line">MOVL <span class="number">0</span>(DX), CX         <span class="comment">// ä¿è¯ Goroutine ä¸ä¸ºç©º</span></span><br><span class="line">get_tls(CX)</span><br><span class="line">MOVL DX, g(CX)</span><br><span class="line">MOVL gobuf_sp(BX), SP  <span class="comment">// å°† runtime.goexit å‡½æ•°çš„ PC æ¢å¤åˆ° SP ä¸­</span></span><br><span class="line">MOVL gobuf_ret(BX), AX</span><br><span class="line">MOVL gobuf_ctxt(BX), DX</span><br><span class="line">MOVL $<span class="number">0</span>, gobuf_sp(BX)</span><br><span class="line">MOVL $<span class="number">0</span>, gobuf_ret(BX)</span><br><span class="line">MOVL $<span class="number">0</span>, gobuf_ctxt(BX)</span><br><span class="line">MOVL gobuf_pc(BX), BX  <span class="comment">// è·å–å¾…æ‰§è¡Œå‡½æ•°çš„ç¨‹åºè®¡æ•°å™¨</span></span><br><span class="line">JMP  BX                <span class="comment">// å¼€å§‹æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°çš„å®ç°éå¸¸å·§å¦™ï¼Œå®ƒä» <a href="https://github.com/golang/go/blob/753d56d3642eb83848aa39e65982a9fc77e722d7/src/runtime/runtime2.go#L310"><code>runtime.gobuf</code></a> ä¸­å–å‡ºäº† <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L1336"><code>runtime.goexit</code></a> çš„ç¨‹åºè®¡æ•°å™¨å’Œå¾…æ‰§è¡Œå‡½æ•°çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå…¶ä¸­ï¼š</p><ul><li><a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L1336"><code>runtime.goexit</code></a> çš„ç¨‹åºè®¡æ•°å™¨è¢«æ”¾åˆ°äº†æ ˆ SP ä¸Šï¼›</li><li>å¾…æ‰§è¡Œå‡½æ•°çš„ç¨‹åºè®¡æ•°å™¨è¢«æ”¾åˆ°äº†å¯„å­˜å™¨ BX ä¸Šï¼›</li></ul><p>åœ¨å‡½æ•°è°ƒç”¨ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ›¾ç»ä»‹ç»è¿‡ Go è¯­è¨€çš„è°ƒç”¨æƒ¯ä¾‹ï¼Œæ­£å¸¸çš„å‡½æ•°è°ƒç”¨éƒ½ä¼šä½¿ç”¨ <code>CALL</code> æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤ä¼šå°†è°ƒç”¨æ–¹çš„è¿”å›åœ°å€åŠ å…¥æ ˆå¯„å­˜å™¨ SP ä¸­ï¼Œç„¶åè·³è½¬åˆ°ç›®æ ‡å‡½æ•°ï¼›å½“ç›®æ ‡å‡½æ•°è¿”å›åï¼Œä¼šä»æ ˆä¸­æŸ¥æ‰¾è°ƒç”¨çš„åœ°å€å¹¶è·³è½¬å›è°ƒç”¨æ–¹ç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„ä»£ç ã€‚</p><p><a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L301"><code>runtime.gogo</code></a> å°±åˆ©ç”¨äº† Go è¯­è¨€çš„è°ƒç”¨æƒ¯ä¾‹æˆåŠŸæ¨¡æ‹Ÿè¿™ä¸€è°ƒç”¨è¿‡ç¨‹ï¼Œé€šè¿‡ä»¥ä¸‹å‡ ä¸ªå…³é”®æŒ‡ä»¤æ¨¡æ‹Ÿ <code>CALL</code> çš„è¿‡ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MOVL gobuf_sp(BX), SP  <span class="comment">// å°† runtime.goexit å‡½æ•°çš„ PC æ¢å¤åˆ° SP ä¸­</span></span><br><span class="line">MOVL gobuf_pc(BX), BX  <span class="comment">// è·å–å¾…æ‰§è¡Œå‡½æ•°çš„ç¨‹åºè®¡æ•°å™¨</span></span><br><span class="line">JMP  BX                <span class="comment">// å¼€å§‹æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354661-golang-gogo-stack.png" alt="golang-gogo-stack"></p><p><strong>runtime.gogo æ ˆå†…å­˜</strong></p><p>ä¸Šå›¾å±•ç¤ºäº†è°ƒç”¨ <code>JMP</code> æŒ‡ä»¤åçš„æ ˆä¸­æ•°æ®ï¼Œå½“ Goroutine ä¸­è¿è¡Œçš„å‡½æ•°è¿”å›æ—¶å°±ä¼šè·³è½¬åˆ° <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L1336"><code>runtime.goexit</code></a> æ‰€åœ¨ä½ç½®æ‰§è¡Œè¯¥å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TEXT runtimeÂ·goexit(SB),NOSPLIT,$<span class="number">0</span><span class="number">-0</span></span><br><span class="line">CALLruntimeÂ·goexit1(SB)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goexit1</span><span class="params">()</span></span> &#123;</span><br><span class="line">mcall(goexit0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡å¥—å¨ƒä¼¼çš„ä¸€ç³»åˆ—å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬æœ€ç»ˆåœ¨å½“å‰çº¿ç¨‹çš„ g0 çš„æ ˆä¸Šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2792"><code>runtime.goexit0</code></a> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°† Goroutine è½¬æ¢ä¼š <code>_Gdead</code> çŠ¶æ€ã€æ¸…ç†å…¶ä¸­çš„å­—æ®µã€ç§»é™¤ Goroutine å’Œçº¿ç¨‹çš„å…³è”å¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3528"><code>runtime.gfput</code></a> é‡æ–°åŠ å…¥å¤„ç†å™¨çš„ Goroutine ç©ºé—²åˆ—è¡¨ <code>gFree</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goexit0</span><span class="params">(gp *g)</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"></span><br><span class="line">casgstatus(gp, _Grunning, _Gdead)</span><br><span class="line">gp.m = <span class="literal">nil</span></span><br><span class="line">...</span><br><span class="line">gp.param = <span class="literal">nil</span></span><br><span class="line">gp.labels = <span class="literal">nil</span></span><br><span class="line">gp.timer = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">dropg()</span><br><span class="line">gfput(_g_.m.p.ptr(), gp)</span><br><span class="line">schedule()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æœ€å <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2792"><code>runtime.goexit0</code></a> å‡½æ•°ä¼šé‡æ–°è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> è§¦å‘æ–°çš„ Goroutine è°ƒåº¦ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè°ƒåº¦å¾ªç¯æ°¸è¿œéƒ½ä¸ä¼šè¿”å›ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354669-golang-scheduler-loop.png" alt="golang-scheduler-loop"></p><p><strong>è°ƒåº¦å¾ªç¯</strong></p><p>Go è¯­è¨€ä¸­çš„è¿è¡Œæ—¶è°ƒåº¦å¾ªç¯ä¼šä» <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> å‡½æ•°å¼€å§‹ï¼Œæœ€ç»ˆåˆå›åˆ° <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a>ï¼›è¿™é‡Œä»‹ç»çš„æ˜¯ Goroutine æ­£å¸¸æ‰§è¡Œå¹¶é€€å‡ºçš„é€»è¾‘ï¼Œå®é™…æƒ…å†µä¼šå¤æ‚å¾—å¤šï¼Œå¤šæ•°æƒ…å†µä¸‹ Goroutine çš„æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éƒ½ä¼šç»å†åä½œå¼æˆ–è€…æŠ¢å å¼è°ƒåº¦ï¼Œè¿™æ—¶ä¼šè®©å‡ºçº¿ç¨‹çš„ä½¿ç”¨æƒç­‰å¾…è°ƒåº¦å™¨çš„å”¤é†’ã€‚</p><h2 id="è§¦å‘è°ƒåº¦"><a href="#è§¦å‘è°ƒåº¦" class="headerlink" title="è§¦å‘è°ƒåº¦"></a>è§¦å‘è°ƒåº¦</h2><p>è°ƒåº¦å™¨çš„ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> å‡½æ•°é‡æ–°é€‰æ‹© Goroutine åœ¨çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æ‰¾åˆ°è¯¥å‡½æ•°çš„è°ƒç”¨æ–¹å°±èƒ½æ‰¾åˆ°æ‰€æœ‰è§¦å‘è°ƒåº¦çš„æ—¶é—´ç‚¹ï¼Œç»è¿‡åˆ†æå’Œæ•´ç†ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°å¦‚ä¸‹çš„æ ‘å½¢ç»“æ„ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354679-schedule-points.png" alt="schedule-points"></p><p><strong>è°ƒåº¦æ—¶é—´ç‚¹</strong></p><p>é™¤äº†ä¸Šå›¾ä¸­å¯èƒ½è§¦å‘è°ƒåº¦çš„æ—¶é—´ç‚¹ï¼Œè¿è¡Œæ—¶è¿˜ä¼šåœ¨çº¿ç¨‹å¯åŠ¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L1041"><code>runtime.mstart</code></a> å’Œ Goroutine æ‰§è¡Œç»“æŸ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2792"><code>runtime.goexit0</code></a> è§¦å‘è°ƒåº¦ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä¼šé‡ç‚¹ä»‹ç»è¿è¡Œæ—¶è§¦å‘è°ƒåº¦çš„å‡ ä¸ªè·¯å¾„ï¼š</p><ul><li>ä¸»åŠ¨æŒ‚èµ· â€” <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L287"><code>runtime.gopark</code></a> -&gt; <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2668"><code>runtime.park_m</code></a></li><li>ç³»ç»Ÿè°ƒç”¨ â€” <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3074"><code>runtime.exitsyscall</code></a> -&gt; <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3236"><code>runtime.exitsyscall0</code></a></li><li>åä½œå¼è°ƒåº¦ â€” <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L267"><code>runtime.Gosched</code></a> -&gt; <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2709"><code>runtime.gosched_m</code></a> -&gt; <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2693"><code>runtime.goschedImpl</code></a></li><li>ç³»ç»Ÿç›‘æ§ â€” <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4455"><code>runtime.sysmon</code></a> -&gt; <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4569"><code>runtime.retake</code></a> -&gt; <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L4666"><code>runtime.preemptone</code></a></li></ul><p>æˆ‘ä»¬åœ¨è¿™é‡Œä»‹ç»çš„è°ƒåº¦æ—¶é—´ç‚¹ä¸æ˜¯ç›´æ¥å°†çº¿ç¨‹çš„è¿è¡Œæƒäº¤ç»™å…¶ä»–ä»»åŠ¡ï¼Œè€Œæ˜¯é€šè¿‡è°ƒåº¦å™¨çš„ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> é‡æ–°è°ƒåº¦ã€‚</p><h3 id="ä¸»åŠ¨æŒ‚èµ·"><a href="#ä¸»åŠ¨æŒ‚èµ·" class="headerlink" title="ä¸»åŠ¨æŒ‚èµ·"></a>ä¸»åŠ¨æŒ‚èµ·</h3><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L287"><code>runtime.gopark</code></a> æ˜¯è§¦å‘è°ƒåº¦æœ€å¸¸è§çš„æ–¹æ³•ï¼Œè¯¥å‡½æ•°ä¼šå°†å½“å‰ Goroutine æš‚åœï¼Œè¢«æš‚åœçš„ä»»åŠ¡ä¸ä¼šæ”¾å›è¿è¡Œé˜Ÿåˆ—ï¼Œæˆ‘ä»¬æ¥åˆ†æè¯¥å‡½æ•°çš„å®ç°åŸç†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gopark</span><span class="params">(unlockf <span class="keyword">func</span>(*g, unsafe.Pointer)</span> <span class="title">bool</span>, <span class="title">lock</span> <span class="title">unsafe</span>.<span class="title">Pointer</span>, <span class="title">reason</span> <span class="title">waitReason</span>, <span class="title">traceEv</span> <span class="title">byte</span>, <span class="title">traceskip</span> <span class="title">int</span>)</span> &#123;</span><br><span class="line">mp := acquirem()</span><br><span class="line">gp := mp.curg</span><br><span class="line">mp.waitlock = lock</span><br><span class="line">mp.waitunlockf = unlockf</span><br><span class="line">gp.waitreason = reason</span><br><span class="line">mp.waittraceev = traceEv</span><br><span class="line">mp.waittraceskip = traceskip</span><br><span class="line">releasem(mp)</span><br><span class="line">mcall(park_m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°ä¼šé€šè¿‡ <a href="https://github.com/golang/go/blob/a38a917aee626a9b9d5ce2b93964f586bf759ea0/src/runtime/asm_386.s#L320"><code>runtime.mcall</code></a> åœ¨åˆ‡æ¢åˆ° g0 çš„æ ˆä¸Šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2668"><code>runtime.park_m</code></a> å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">park_m</span><span class="params">(gp *g)</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"></span><br><span class="line">casgstatus(gp, _Grunning, _Gwaiting)</span><br><span class="line">dropg()</span><br><span class="line"></span><br><span class="line">schedule()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°ä¼šå°†å½“å‰ Goroutine çš„çŠ¶æ€ä» <code>_Grunning</code> åˆ‡æ¢è‡³ <code>_Gwaiting</code>ï¼Œè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2571"><code>runtime.dropg</code></a> ç§»é™¤çº¿ç¨‹å’Œ Gorooutine ä¹‹é—´çš„å…³è”ï¼Œåœ¨è¿™ä¹‹åå°±å¯ä»¥è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> è§¦å‘æ–°ä¸€è½®çš„è°ƒåº¦äº†ã€‚</p><p>å½“ Goroutine ç­‰å¾…çš„ç‰¹å®šæ¡ä»¶æ»¡è¶³åï¼Œè¿è¡Œæ—¶ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L313"><code>runtime.goready</code></a> å°†å› ä¸ºè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L287"><code>runtime.gopark</code></a> è€Œé™·å…¥ä¼‘çœ çš„ Goroutine å”¤é†’ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goready</span><span class="params">(gp *g, traceskip <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">systemstack(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">ready(gp, traceskip, <span class="literal">true</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ready</span><span class="params">(gp *g, traceskip <span class="keyword">int</span>, next <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"></span><br><span class="line">casgstatus(gp, _Gwaiting, _Grunnable)</span><br><span class="line">runqput(_g_.m.p.ptr(), gp, next)</span><br><span class="line"><span class="keyword">if</span> atomic.Load(&amp;sched.npidle) != <span class="number">0</span> &amp;&amp; atomic.Load(&amp;sched.nmspinning) == <span class="number">0</span> &#123;</span><br><span class="line">wakep()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L658"><code>runtime.ready</code></a> ä¼šå°†å‡†å¤‡å°±ç»ªçš„ Goroutine çš„çŠ¶æ€åˆ‡æ¢è‡³ <code>_Grunnable</code> å¹¶å°†å…¶åŠ å…¥å¤„ç†å™¨çš„è¿è¡Œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦å™¨çš„è°ƒåº¦ã€‚</p><h3 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h3><p>ç³»ç»Ÿè°ƒç”¨ä¹Ÿä¼šè§¦å‘è¿è¡Œæ—¶è°ƒåº¦å™¨çš„è°ƒåº¦ï¼Œä¸ºäº†å¤„ç†ç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬ç”šè‡³åœ¨ Goroutine ä¸­åŠ å…¥äº† <code>_Gsyscall</code> çŠ¶æ€ï¼ŒGo è¯­è¨€é€šè¿‡ <a href="https://github.com/golang/go/blob/50bd1c4d4eb4fac8ddeb5f063c099daccfb71b26/src/syscall/asm_linux_386.s#L18"><code>syscall.Syscall</code></a> å’Œ <a href="https://github.com/golang/go/blob/50bd1c4d4eb4fac8ddeb5f063c099daccfb71b26/src/syscall/asm_linux_386.s#L69"><code>syscall.RawSyscall</code></a> ç­‰ä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„æ–¹æ³•å°è£…äº†æ“ä½œç³»ç»Ÿæä¾›çš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶ä¸­ <a href="https://github.com/golang/go/blob/50bd1c4d4eb4fac8ddeb5f063c099daccfb71b26/src/syscall/asm_linux_386.s#L18"><code>syscall.Syscall</code></a> çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#define INVOKE_SYSCALLINT$<span class="number">0x80</span></span><br><span class="line"></span><br><span class="line">TEXT Â·Syscall(SB),NOSPLIT,$<span class="number">0</span><span class="number">-28</span></span><br><span class="line">CALLruntimeÂ·entersyscall(SB)</span><br><span class="line">...</span><br><span class="line">INVOKE_SYSCALL</span><br><span class="line">...</span><br><span class="line">CALLruntimeÂ·exitsyscall(SB)</span><br><span class="line">RET</span><br><span class="line">ok:</span><br><span class="line">...</span><br><span class="line">CALLruntimeÂ·exitsyscall(SB)</span><br><span class="line">RET</span><br></pre></td></tr></table></figure><p>åœ¨é€šè¿‡æ±‡ç¼–æŒ‡ä»¤ <code>INVOKE_SYSCALL</code> æ‰§è¡Œç³»ç»Ÿè°ƒç”¨å‰åï¼Œä¸Šè¿°å‡½æ•°ä¼šè°ƒç”¨è¿è¡Œæ—¶çš„ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2980"><code>runtime.entersyscall</code></a> å’Œ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3074"><code>runtime.exitsyscall</code></a>ï¼Œæ­£æ˜¯è¿™ä¸€å±‚åŒ…è£…èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨é™·å…¥ç³»ç»Ÿè°ƒç”¨å‰è§¦å‘è¿è¡Œæ—¶çš„å‡†å¤‡å’Œæ¸…ç†å·¥ä½œã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img.draveness.me/2020-02-05-15808864354688-golang-syscall-and-rawsyscall.png" alt="golang-syscall-and-rawsyscal"></p><p><strong>å›¾ 6-38 Go è¯­è¨€ç³»ç»Ÿè°ƒç”¨</strong></p><p>ä¸è¿‡å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œå¦‚æœè¿™æ¬¡ç³»ç»Ÿè°ƒç”¨ä¸éœ€è¦è¿è¡Œæ—¶å‚ä¸ï¼Œå°±ä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/50bd1c4d4eb4fac8ddeb5f063c099daccfb71b26/src/syscall/asm_linux_386.s#L69"><code>syscall.RawSyscall</code></a> ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ï¼Œä¸å†è°ƒç”¨è¿è¡Œæ—¶å‡½æ•°ã€‚<a href="https://gist.github.com/draveness/50c88883f30fa99d548cf1163c98aeb1">è¿™é‡Œ</a>åŒ…å« Go è¯­è¨€å¯¹ Linux 386 æ¶æ„ä¸Šä¸åŒç³»ç»Ÿè°ƒç”¨çš„åˆ†ç±»ï¼Œæˆ‘ä»¬ä¼šæŒ‰éœ€å†³å®šæ˜¯å¦éœ€è¦è¿è¡Œæ—¶çš„å‚ä¸ï¼š</p><div class="table-container"><table><thead><tr><th>ç³»ç»Ÿè°ƒç”¨</th><th>ç±»å‹</th></tr></thead><tbody><tr><td>SYS_TIME</td><td>RawSyscall</td></tr><tr><td>SYS_GETTIMEOFDAY</td><td>RawSyscall</td></tr><tr><td>SYS_SETRLIMIT</td><td>RawSyscall</td></tr><tr><td>SYS_GETRLIMIT</td><td>RawSyscall</td></tr><tr><td>SYS_EPOLL_WAIT</td><td>Syscall</td></tr><tr><td>â€¦</td><td>â€¦</td></tr></tbody></table></div><p>ç”±äºç›´æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨ä¼šé˜»å¡å½“å‰çš„çº¿ç¨‹ï¼Œæ‰€ä»¥åªæœ‰å¯ä»¥ç«‹åˆ»è¿”å›çš„ç³»ç»Ÿè°ƒç”¨æ‰å¯èƒ½ä¼šè¢«è®¾ç½®æˆ <code>RawSyscall</code> ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>SYS_EPOLL_CREATE</code>ã€<code>SYS_EPOLL_WAIT</code>ï¼ˆè¶…æ—¶æ—¶é—´ä¸º 0ï¼‰ã€<code>SYS_TIME</code> ç­‰ã€‚</p><p>æ­£å¸¸çš„ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ç›¸æ¯”ä¹‹ä¸‹æ¯”è¾ƒå¤æ‚ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ†åˆ«ä»‹ç»è¿›å…¥ç³»ç»Ÿè°ƒç”¨å‰çš„å‡†å¤‡å·¥ä½œå’Œç³»ç»Ÿè°ƒç”¨ç»“æŸåçš„æ”¶å°¾å·¥ä½œã€‚</p><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2980"><code>runtime.entersyscall</code></a> å‡½æ•°ä¼šåœ¨è·å–å½“å‰ç¨‹åºè®¡æ•°å™¨å’Œæ ˆä½ç½®ä¹‹åè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2913"><code>runtime.reentersyscall</code></a>ï¼Œå®ƒä¼šå®Œæˆ Goroutine è¿›å…¥ç³»ç»Ÿè°ƒç”¨å‰çš„å‡†å¤‡å·¥ä½œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reentersyscall</span><span class="params">(pc, sp <span class="keyword">uintptr</span>)</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line">_g_.m.locks++</span><br><span class="line">_g_.stackguard0 = stackPreempt</span><br><span class="line">_g_.throwsplit = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">save(pc, sp)</span><br><span class="line">_g_.syscallsp = sp</span><br><span class="line">_g_.syscallpc = pc</span><br><span class="line">casgstatus(_g_, _Grunning, _Gsyscall)</span><br><span class="line"></span><br><span class="line">_g_.m.syscalltick = _g_.m.p.ptr().syscalltick</span><br><span class="line">_g_.m.mcache = <span class="literal">nil</span></span><br><span class="line">pp := _g_.m.p.ptr()</span><br><span class="line">pp.m = <span class="number">0</span></span><br><span class="line">_g_.m.oldp.set(pp)</span><br><span class="line">_g_.m.p = <span class="number">0</span></span><br><span class="line">atomic.Store(&amp;pp.status, _Psyscall)</span><br><span class="line"><span class="keyword">if</span> sched.gcwaiting != <span class="number">0</span> &#123;</span><br><span class="line">systemstack(entersyscall_gcwait)</span><br><span class="line">save(pc, sp)</span><br><span class="line">&#125;</span><br><span class="line">_g_.m.locks--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¦æ­¢çº¿ç¨‹ä¸Šå‘ç”Ÿçš„æŠ¢å ï¼Œé˜²æ­¢å‡ºç°å†…å­˜ä¸ä¸€è‡´çš„é—®é¢˜ï¼›</li><li>ä¿è¯å½“å‰å‡½æ•°ä¸ä¼šè§¦å‘æ ˆåˆ†è£‚æˆ–è€…å¢é•¿ï¼›</li><li>ä¿å­˜å½“å‰çš„ç¨‹åºè®¡æ•°å™¨ PC å’Œæ ˆæŒ‡é’ˆ SP ä¸­çš„å†…å®¹ï¼›</li><li>å°† Goroutine çš„çŠ¶æ€æ›´æ–°è‡³ <code>_Gsyscall</code>ï¼›</li><li>å°† Goroutine çš„å¤„ç†å™¨å’Œçº¿ç¨‹æš‚æ—¶åˆ†ç¦»å¹¶æ›´æ–°å¤„ç†å™¨çš„çŠ¶æ€åˆ° <code>_Psyscall</code>ï¼›</li><li>é‡Šæ”¾å½“å‰çº¿ç¨‹ä¸Šçš„é”ï¼›</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2913"><code>runtime.reentersyscall</code></a> æ–¹æ³•ä¼šä½¿å¤„ç†å™¨å’Œçº¿ç¨‹çš„åˆ†ç¦»ï¼Œå½“å‰çº¿ç¨‹ä¼šé™·å…¥ç³»ç»Ÿè°ƒç”¨ç­‰å¾…è¿”å›ï¼Œå½“å‰çº¿ç¨‹ä¸Šçš„é”è¢«é‡Šæ”¾åï¼Œä¼šæœ‰å…¶ä»– Goroutine æŠ¢å å¤„ç†å™¨èµ„æºã€‚</p><h4 id="æ¢å¤å·¥ä½œ"><a href="#æ¢å¤å·¥ä½œ" class="headerlink" title="æ¢å¤å·¥ä½œ"></a>æ¢å¤å·¥ä½œ</h4><p>å½“ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼Œä¼šè°ƒç”¨é€€å‡ºç³»ç»Ÿè°ƒç”¨çš„å‡½æ•° <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3074"><code>runtime.exitsyscall</code></a> ä¸ºå½“å‰ Goroutine é‡æ–°åˆ†é…èµ„æºï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªä¸åŒçš„æ‰§è¡Œè·¯å¾„ï¼š</p><ol><li>è°ƒç”¨ <code>exitsyscallfast</code> å‡½æ•°ï¼›</li><li>åˆ‡æ¢è‡³è°ƒåº¦å™¨çš„ Goroutine å¹¶è°ƒç”¨ <code>exitsyscall0</code> å‡½æ•°ï¼š</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exitsyscall</span><span class="params">()</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"></span><br><span class="line">oldp := _g_.m.oldp.ptr()</span><br><span class="line">_g_.m.oldp = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> exitsyscallfast(oldp) &#123;</span><br><span class="line">_g_.m.p.ptr().syscalltick++</span><br><span class="line">casgstatus(_g_, _Gsyscall, _Grunning)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mcall(exitsyscall0)</span><br><span class="line">_g_.m.p.ptr().syscalltick++</span><br><span class="line">_g_.throwsplit = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§ä¸åŒçš„è·¯å¾„ä¼šåˆ†åˆ«é€šè¿‡ä¸åŒçš„æ–¹æ³•æŸ¥æ‰¾ä¸€ä¸ªç”¨äºæ‰§è¡Œå½“å‰ Goroutine å¤„ç†å™¨ Pï¼Œå¿«é€Ÿè·¯å¾„ <a href="https://github.com/golang/go/blob/cf630586ca5901f4aa7817a536209f2366f9c944/src/runtime/proc.go#L3070-L3107"><code>exitsyscallfast</code></a> ä¸­åŒ…å«ä¸¤ä¸ªä¸åŒçš„åˆ†æ”¯ï¼š</p><ol><li>å¦‚æœ Goroutine çš„åŸå¤„ç†å™¨å¤„äº <code>_Psyscall</code> çŠ¶æ€ï¼Œå°±ä¼šç›´æ¥è°ƒç”¨ <code>wirep</code> å°† Goroutine ä¸å¤„ç†å™¨è¿›è¡Œå…³è”ï¼›</li><li>å¦‚æœè°ƒåº¦å™¨ä¸­å­˜åœ¨é—²ç½®çš„å¤„ç†å™¨ï¼Œå°±ä¼šè°ƒç”¨ <code>acquirep</code> å‡½æ•°ä½¿ç”¨é—²ç½®çš„å¤„ç†å™¨å¤„ç†å½“å‰ Goroutineï¼›</li></ol><p>å¦ä¸€ä¸ªç›¸å¯¹è¾ƒæ…¢çš„è·¯å¾„ <a href="https://github.com/golang/go/blob/cf630586ca5901f4aa7817a536209f2366f9c944/src/runtime/proc.go#L3151-L3179"><code>exitsyscall0</code></a> å°±ä¼šå°†å½“å‰ Goroutine åˆ‡æ¢è‡³ <code>_Grunnable</code> çŠ¶æ€ï¼Œå¹¶ç§»é™¤çº¿ç¨‹ M å’Œå½“å‰ Goroutine çš„å…³è”ï¼š</p><ol><li>å½“æˆ‘ä»¬é€šè¿‡ <code>pidleget</code> è·å–åˆ°é—²ç½®çš„å¤„ç†å™¨æ—¶å°±ä¼šåœ¨è¯¥å¤„ç†å™¨ä¸Šæ‰§è¡Œ Goroutineï¼›</li><li>åœ¨å…¶å®ƒæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°†å½“å‰ Goroutine æ”¾åˆ°å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦å™¨çš„è°ƒåº¦ï¼›</li></ol><p>æ— è®ºå“ªç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­éƒ½ä¼šè°ƒç”¨ <code>schedule</code> å‡½æ•°è§¦å‘è°ƒåº¦å™¨çš„è°ƒåº¦ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å·²ç»ä»‹ç»è¿‡è°ƒåº¦å™¨çš„è°ƒåº¦è¿‡ç¨‹ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°±ä¸å±•å¼€ä»‹ç»äº†ã€‚</p><h3 id="åä½œå¼è°ƒåº¦"><a href="#åä½œå¼è°ƒåº¦" class="headerlink" title="åä½œå¼è°ƒåº¦"></a>åä½œå¼è°ƒåº¦</h3><p>æˆ‘ä»¬åœ¨è®¾è®¡åŸç†ä¸­ä»‹ç»è¿‡äº† Go è¯­è¨€åŸºäºåä½œå¼å’Œä¿¡å·çš„ä¸¤ç§æŠ¢å å¼è°ƒåº¦ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»‹ç» Go è¯­è¨€ä¸­çš„åä½œå¼è°ƒåº¦ã€‚<a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L267"><code>runtime.Gosched</code></a> å°±æ˜¯ä¸»åŠ¨è®©å‡ºå¤„ç†å™¨ï¼Œå…è®¸å…¶ä»– Goroutine è¿è¡Œã€‚è¯¥å‡½æ•°æ— æ³•æŒ‚èµ· Goroutineï¼Œè°ƒåº¦å™¨ä¼šåœ¨è‡ªåŠ¨è°ƒåº¦å½“å‰ Goroutineï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Gosched</span><span class="params">()</span></span> &#123;</span><br><span class="line">checkTimeouts()</span><br><span class="line">mcall(gosched_m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gosched_m</span><span class="params">(gp *g)</span></span> &#123;</span><br><span class="line">goschedImpl(gp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goschedImpl</span><span class="params">(gp *g)</span></span> &#123;</span><br><span class="line">casgstatus(gp, _Grunning, _Grunnable)</span><br><span class="line">dropg()</span><br><span class="line">lock(&amp;sched.lock)</span><br><span class="line">globrunqput(gp)</span><br><span class="line">unlock(&amp;sched.lock)</span><br><span class="line"></span><br><span class="line">schedule()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡è¿ç»­å‡ æ¬¡è·³è½¬ï¼Œæˆ‘ä»¬æœ€ç»ˆåœ¨ g0 çš„æ ˆä¸Šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2693"><code>runtime.goschedImpl</code></a> å‡½æ•°ï¼Œè¿è¡Œæ—¶ä¼šæ›´æ–° Goroutine çš„çŠ¶æ€åˆ° <code>_Grunnable</code>ï¼Œè®©å‡ºå½“å‰çš„å¤„ç†å™¨å¹¶å°† Goroutine é‡æ–°æ”¾å›å…¨å±€é˜Ÿåˆ—ï¼Œåœ¨æœ€åï¼Œè¯¥å‡½æ•°ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L2446"><code>runtime.schedule</code></a> é‡æ–°è§¦å‘è°ƒåº¦ã€‚</p><h2 id="çº¿ç¨‹ç®¡ç†"><a href="#çº¿ç¨‹ç®¡ç†" class="headerlink" title="çº¿ç¨‹ç®¡ç†"></a>çº¿ç¨‹ç®¡ç†</h2><p>Go è¯­è¨€çš„è¿è¡Œæ—¶ä¼šé€šè¿‡è°ƒåº¦å™¨æ”¹å˜çº¿ç¨‹çš„æ‰€æœ‰æƒï¼Œå®ƒä¹Ÿæä¾›äº† <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3656"><code>runtime.LockOSThread</code></a> å’Œ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3708"><code>runtime.UnlockOSThread</code></a> è®©æˆ‘ä»¬æœ‰èƒ½åŠ›ç»‘å®š Goroutine å’Œçº¿ç¨‹å®Œæˆä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„æ“ä½œã€‚Goroutine åº”è¯¥åœ¨è°ƒç”¨æ“ä½œç³»ç»ŸæœåŠ¡æˆ–è€…ä¾èµ–çº¿ç¨‹çŠ¶æ€çš„é Go è¯­è¨€åº“æ—¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3656"><code>runtime.LockOSThread</code></a> å‡½æ•°ï¼Œä¾‹å¦‚ï¼šC è¯­è¨€å›¾å½¢åº“ç­‰ã€‚</p><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3656"><code>runtime.LockOSThread</code></a> ä¼šé€šè¿‡å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç»‘å®š Goroutine å’Œå½“å‰çº¿ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LockOSThread</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> atomic.Load(&amp;newmHandoff.haveTemplateThread) == <span class="number">0</span> &amp;&amp; GOOS != <span class="string">&quot;plan9&quot;</span> &#123;</span><br><span class="line">startTemplateThread()</span><br><span class="line">&#125;</span><br><span class="line">_g_ := getg()</span><br><span class="line">_g_.m.lockedExt++</span><br><span class="line">dolockOSThread()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dolockOSThread</span><span class="params">()</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line">_g_.m.lockedg.set(_g_)</span><br><span class="line">_g_.lockedm.set(_g_.m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3631"><code>runtime.dolockOSThread</code></a> ä¼šåˆ†åˆ«è®¾ç½®çº¿ç¨‹çš„ <code>lockedg</code> å­—æ®µå’Œ Goroutine çš„ <code>lockedm</code> å­—æ®µï¼Œè¿™ä¸¤è¡Œä»£ç ä¼šç»‘å®šçº¿ç¨‹å’Œ Goroutineã€‚</p><p>å½“ Goroutine å®Œæˆäº†ç‰¹å®šçš„æ“ä½œä¹‹åï¼Œå°±ä¼šè°ƒç”¨ä»¥ä¸‹å‡½æ•° <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3708"><code>runtime.UnlockOSThread</code></a> åˆ†ç¦» Goroutine å’Œçº¿ç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UnlockOSThread</span><span class="params">()</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"><span class="keyword">if</span> _g_.m.lockedExt == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">_g_.m.lockedExt--</span><br><span class="line">dounlockOSThread()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dounlockOSThread</span><span class="params">()</span></span> &#123;</span><br><span class="line">_g_ := getg()</span><br><span class="line"><span class="keyword">if</span> _g_.m.lockedInt != <span class="number">0</span> || _g_.m.lockedExt != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">_g_.m.lockedg = <span class="number">0</span></span><br><span class="line">_g_.lockedm = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸ <a href="https://github.com/golang/go/blob/64c22b70bf00e15615bb17c29f808b55bc339682/src/runtime/proc.go#L3656"><code>runtime.LockOSThread</code></a> æ­£å¥½ç›¸åã€‚åœ¨å¤šæ•°çš„æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬éƒ½ç”¨ä¸åˆ°è¿™ä¸€å¯¹å‡½æ•°ï¼Œä¸è¿‡ä½¿ç”¨ CGO æˆ–è€…ç»å¸¸ä¸æ“ä½œç³»ç»Ÿæ‰“äº¤é“çš„è¯»è€…å¯èƒ½ä¼šè§åˆ°å®ƒä»¬çš„èº«å½±ã€‚</p><h2 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Goroutine å’Œè°ƒåº¦å™¨æ˜¯ Go è¯­è¨€èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†ä»»åŠ¡å¹¶ä¸”æœ€å¤§åŒ–åˆ©ç”¨èµ„æºçš„åŸºç¡€ï¼Œæœ¬èŠ‚ä»‹ç»äº† Go è¯­è¨€ç”¨äºå¤„ç†å¹¶å‘ä»»åŠ¡çš„ G - M - P æ¨¡å‹ï¼Œæˆ‘ä»¬ä¸ä»…ä»‹ç»äº†å®ƒä»¬å„è‡ªçš„æ•°æ®ç»“æ„ä»¥åŠå¸¸è§çŠ¶æ€ï¼Œè¿˜é€šè¿‡ç‰¹å®šåœºæ™¯ä»‹ç»è°ƒåº¦å™¨çš„å·¥ä½œåŸç†ä»¥åŠä¸åŒæ•°æ®ç»“æ„ä¹‹é—´çš„åä½œå…³ç³»ï¼Œç›¸ä¿¡èƒ½å¤Ÿå¸®åŠ©å„ä½è¯»è€…ç†è§£è°ƒåº¦å™¨çš„å®ç°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„å‡½æ•°è°ƒç”¨</title>
      <link href="/2020/01/08/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/"/>
      <url>/2020/01/08/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>å‡½æ•°æ˜¯ Go è¯­è¨€ä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œç†è§£å’ŒæŒæ¡å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹æ˜¯æˆ‘ä»¬æ·±å…¥å­¦ä¹  Go æ— æ³•è·³è¿‡çš„ï¼Œæœ¬èŠ‚å°†ä»å‡½æ•°çš„è°ƒç”¨æƒ¯ä¾‹å’Œå‚æ•°çš„ä¼ é€’æ–¹æ³•ä¸¤ä¸ªæ–¹é¢åˆ†åˆ«ä»‹ç»å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><a id="more"></a><h2 id="è°ƒç”¨æƒ¯ä¾‹"><a href="#è°ƒç”¨æƒ¯ä¾‹" class="headerlink" title="è°ƒç”¨æƒ¯ä¾‹"></a>è°ƒç”¨æƒ¯ä¾‹</h2><p>æ— è®ºæ˜¯ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ C å’Œ Goï¼Œè¿˜æ˜¯è„šæœ¬è¯­è¨€ Ruby å’Œ Pythonï¼Œè¿™äº›ç¼–ç¨‹è¯­è¨€åœ¨è°ƒç”¨å‡½æ•°æ—¶å¾€å¾€éƒ½ä½¿ç”¨ç›¸åŒçš„è¯­æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">somefunction(arg0, arg1)</span><br></pre></td></tr></table></figure><p>è™½ç„¶å®ƒä»¬è°ƒç”¨å‡½æ•°çš„è¯­æ³•å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬çš„è°ƒç”¨æƒ¯ä¾‹å´å¯èƒ½å¤§ä¸ç›¸åŒã€‚è°ƒç”¨æƒ¯ä¾‹æ˜¯è°ƒç”¨æ–¹å’Œè¢«è°ƒç”¨æ–¹å¯¹äºå‚æ•°å’Œè¿”å›å€¼ä¼ é€’çš„çº¦å®šï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œä¸ºå„ä½è¯»è€…åˆ†åˆ«ä»‹ç» C å’Œ Go è¯­è¨€çš„è°ƒç”¨æƒ¯ä¾‹ã€‚</p><h3 id="C-è¯­è¨€"><a href="#C-è¯­è¨€" class="headerlink" title="C è¯­è¨€"></a>C è¯­è¨€</h3><p>æˆ‘ä»¬å…ˆæ¥ç ”ç©¶ C è¯­è¨€çš„è°ƒç”¨æƒ¯ä¾‹ï¼Œä½¿ç”¨ <a href="https://gcc.gnu.org/">GCC</a>å’Œ <a href="https://clang.llvm.org/">Clang</a>ç¼–è¯‘å™¨å°† C è¯­è¨€ç¼–è¯‘æˆæ±‡ç¼–ä»£ç æ˜¯åˆ†æå®ƒè°ƒç”¨æƒ¯ä¾‹çš„æœ€å¥½æ–¹æ³•ï¼Œä»æ±‡ç¼–è¯­è¨€ä¸­å¯ä»¥ä¸€çª¥å‡½æ•°è°ƒç”¨çš„å…·ä½“è¿‡ç¨‹ã€‚</p><p>GCC å’Œ Clang ç¼–è¯‘ç›¸åŒ C è¯­è¨€ä»£ç å¯èƒ½ä¼šç”Ÿæˆä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œä¸è¿‡ç”Ÿæˆçš„ä»£ç åœ¨ç»“æ„ä¸Šä¸ä¼šæœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œæ‰€ä»¥å¯¹åªæƒ³ç†è§£è°ƒç”¨æƒ¯ä¾‹çš„äººæ¥è¯´æ²¡æœ‰å¤ªå¤šå½±å“ã€‚ä½œè€…åœ¨æœ¬èŠ‚ä¸­é€‰æ‹©ä½¿ç”¨ GCC ç¼–è¯‘å™¨æ¥ç¼–è¯‘ C è¯­è¨€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gcc --version</span><br><span class="line">gcc (Ubuntu 9.3.0-10ubuntu2) 9.3.0</span><br><span class="line">Copyright (C) 2019 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copyingconditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„ C è¯­è¨€ä»£ç ï¼Œä»£ç ä¸­åªåŒ…å«ä¸¤ä¸ªå‡½æ•°ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ä¸»å‡½æ•° <code>main</code>ï¼Œå¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬å®šä¹‰çš„å‡½æ•° <code>my_function</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ch04/my_function.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_function</span><span class="params">(<span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg1 + arg2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = my_function(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>cc -S my_function.c</code> å‘½ä»¤å°†ä¸Šè¿°æ–‡ä»¶ç¼–è¯‘æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">pushq%rbp</span><br><span class="line">movq%rsp, %rbp</span><br><span class="line">subq$<span class="number">16</span>, %rsp</span><br><span class="line">movl$<span class="number">2</span>, %esi  <span class="comment">// è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">movl$<span class="number">1</span>, %edi  <span class="comment">// è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">callmy_function</span><br><span class="line">movl%eax, <span class="number">-4</span>(%rbp)</span><br><span class="line">my_function:</span><br><span class="line">pushq%rbp</span><br><span class="line">movq%rsp, %rbp</span><br><span class="line">movl%edi, <span class="number">-4</span>(%rbp)    <span class="comment">// å–å‡ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ”¾åˆ°æ ˆä¸Š</span></span><br><span class="line">movl%esi, <span class="number">-8</span>(%rbp)    <span class="comment">// å–å‡ºç¬¬äºŒä¸ªå‚æ•°ï¼Œæ”¾åˆ°æ ˆä¸Š</span></span><br><span class="line">movl<span class="number">-8</span>(%rbp), %eax    <span class="comment">// eax = esi = 1</span></span><br><span class="line">movl<span class="number">-4</span>(%rbp), %edx    <span class="comment">// edx = edi = 2</span></span><br><span class="line">addl%edx, %eax        <span class="comment">// eax = eax + edx = 1 + 2 = 3</span></span><br><span class="line">popq%rbp</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŒ‰ç…§ <code>my_function</code> å‡½æ•°è°ƒç”¨å‰ã€è°ƒç”¨æ—¶ä»¥åŠè°ƒç”¨åä¸‰ä¸ªéƒ¨åˆ†åˆ†æä¸Šè¿°è°ƒç”¨è¿‡ç¨‹ï¼š</p><ul><li>åœ¨ <code>my_function</code> è°ƒç”¨ä¹‹å‰ï¼Œè°ƒç”¨æ–¹ <code>main</code> å‡½æ•°å°† <code>my_function</code> çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«å­˜åˆ° edi å’Œ esi å¯„å­˜å™¨ä¸­ï¼›</li><li>åœ¨ <code>my_function</code> æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šå°†å¯„å­˜å™¨ edi å’Œ esi ä¸­çš„æ•°æ®å­˜å‚¨åˆ° eax å’Œ edx ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ï¼Œéšåé€šè¿‡æ±‡ç¼–æŒ‡ä»¤ <code>addl</code> è®¡ç®—ä¸¤ä¸ªå…¥å‚ä¹‹å’Œï¼›</li><li>åœ¨ <code>my_function</code> è°ƒç”¨ä¹‹åï¼Œä½¿ç”¨å¯„å­˜å™¨ eax ä¼ é€’è¿”å›å€¼ï¼Œ<code>main</code> å‡½æ•°å°† <code>my_function</code> çš„è¿”å›å€¼å­˜å‚¨åˆ°æ ˆä¸Šçš„ <code>i</code> å˜é‡ä¸­ï¼›</li></ul><p>å½“ <code>my_function</code> å‡½æ•°çš„å…¥å‚å¢åŠ è‡³å…«ä¸ªï¼Œè¿™æ—¶é‡æ–°ç¼–è¯‘å½“å‰çš„ç¨‹åºå¯ä»¥ä¼šå¾—åˆ°ä¸åŒçš„æ±‡ç¼–è¯­è¨€ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">pushq%rbp</span><br><span class="line">movq%rsp, %rbp</span><br><span class="line">subq$<span class="number">16</span>, %rsp     <span class="comment">// ä¸ºå‚æ•°ä¼ é€’ç”³è¯· 16 å­—èŠ‚çš„æ ˆç©ºé—´</span></span><br><span class="line">movl$<span class="number">8</span>, <span class="number">8</span>(%rsp)   <span class="comment">// ä¼ é€’ç¬¬ 8 ä¸ªå‚æ•°</span></span><br><span class="line">movl$<span class="number">7</span>, (%rsp)    <span class="comment">// ä¼ é€’ç¬¬ 7 ä¸ªå‚æ•°</span></span><br><span class="line">movl$<span class="number">6</span>, %r9d</span><br><span class="line">movl$<span class="number">5</span>, %r8d</span><br><span class="line">movl$<span class="number">4</span>, %ecx</span><br><span class="line">movl$<span class="number">3</span>, %edx</span><br><span class="line">movl$<span class="number">2</span>, %esi</span><br><span class="line">movl$<span class="number">1</span>, %edi</span><br><span class="line">callmy_function</span><br></pre></td></tr></table></figure><p><code>main</code> å‡½æ•°è°ƒç”¨ <code>my_function</code> æ—¶ï¼Œå‰å…­ä¸ªå‚æ•°æ˜¯ä½¿ç”¨ ediã€esiã€edxã€ecxã€r8d å’Œ r9d å…­ä¸ªå¯„å­˜å™¨ä¼ é€’çš„ã€‚å¯„å­˜å™¨çš„ä½¿ç”¨é¡ºåºä¹Ÿæ˜¯è°ƒç”¨æƒ¯ä¾‹çš„ä¸€éƒ¨åˆ†ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€å®šä¼šä½¿ç”¨ edi å¯„å­˜å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨ esi å¯„å­˜å™¨ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>æœ€åçš„ä¸¤ä¸ªå‚æ•°ä¸å‰é¢çš„å®Œå…¨ä¸åŒï¼Œè°ƒç”¨æ–¹ <code>main</code> å‡½æ•°é€šè¿‡ä¼ é€’è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå›¾ 4-1 å±•ç¤ºäº† <code>main</code> å‡½æ•°åœ¨è°ƒç”¨ <code>my_function</code> å‰çš„æ ˆä¿¡æ¯ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/siN1dErocqeCAXb.png" alt="c-function-call-stack"></p><p>ä¸Šå›¾ä¸­ rbp å¯„å­˜å™¨çš„ä½œç”¨æ˜¯å­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„åŸºå€æŒ‡é’ˆï¼Œå³å±äº <code>main</code> å‡½æ•°çš„æ ˆç©ºé—´çš„èµ·å§‹ä½ç½®ï¼Œè€Œå¦ä¸€ä¸ªå¯„å­˜å™¨ rsp å­˜å‚¨çš„æ˜¯ <code>main</code> å‡½æ•°è°ƒç”¨æ ˆç»“æŸçš„ä½ç½®ï¼Œè¿™ä¸¤ä¸ªå¯„å­˜å™¨å…±åŒè¡¨ç¤ºäº†ä¸€ä¸ªå‡½æ•°çš„æ ˆç©ºé—´ã€‚</p><p>åœ¨è°ƒç”¨ <code>my_function</code> ä¹‹å‰ï¼Œ<code>main</code> å‡½æ•°é€šè¿‡ <code>subq $16, %rsp</code> æŒ‡ä»¤åˆ†é…äº† 16 ä¸ªå­—èŠ‚çš„æ ˆåœ°å€ï¼Œéšåå°†ç¬¬å…­ä¸ªä»¥ä¸Šçš„å‚æ•°æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºå­˜å…¥æ ˆä¸­ï¼Œå³ç¬¬å…«ä¸ªå’Œç¬¬ä¸ƒä¸ªï¼Œä½™ä¸‹çš„å…­ä¸ªå‚æ•°ä¼šé€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œæ¥ä¸‹æ¥è¿è¡Œçš„ <code>call my_function</code> æŒ‡ä»¤ä¼šè°ƒç”¨ <code>my_function</code> å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">my_function:</span><br><span class="line">pushq%rbp</span><br><span class="line">movq%rsp, %rbp</span><br><span class="line">movl%edi, <span class="number">-4</span>(%rbp)    <span class="comment">// rbp-4 = edi = 1</span></span><br><span class="line">movl%esi, <span class="number">-8</span>(%rbp)    <span class="comment">// rbp-8 = esi = 2</span></span><br><span class="line">...</span><br><span class="line">movl<span class="number">-8</span>(%rbp), %eax    <span class="comment">// eax = 2</span></span><br><span class="line">movl<span class="number">-4</span>(%rbp), %edx    <span class="comment">// edx = 1</span></span><br><span class="line">addl%eax, %edx        <span class="comment">// edx = eax + edx = 3</span></span><br><span class="line">...</span><br><span class="line">movl<span class="number">16</span>(%rbp), %eax    <span class="comment">// eax = 7</span></span><br><span class="line">addl%eax, %edx        <span class="comment">// edx = eax + edx = 28</span></span><br><span class="line">movl<span class="number">24</span>(%rbp), %eax    <span class="comment">// eax = 8</span></span><br><span class="line">addl%edx, %eax        <span class="comment">// edx = eax + edx = 36</span></span><br><span class="line">popq%rbp</span><br></pre></td></tr></table></figure><p><code>my_function</code> ä¼šå…ˆå°†å¯„å­˜å™¨ä¸­çš„å…¨éƒ¨æ•°æ®è½¬ç§»åˆ°æ ˆä¸Šï¼Œç„¶ååˆ©ç”¨ eax å¯„å­˜å™¨è®¡ç®—æ‰€æœ‰å…¥å‚çš„å’Œå¹¶è¿”å›ç»“æœã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†æœ¬èŠ‚çš„å‘ç°å’Œåˆ†æç®€å•æ€»ç»“æˆ â€”â€” å½“æˆ‘ä»¬åœ¨ x86_64 çš„æœºå™¨ä¸Šä½¿ç”¨ C è¯­è¨€ä¸­è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‚æ•°éƒ½æ˜¯é€šè¿‡å¯„å­˜å™¨å’Œæ ˆä¼ é€’çš„ï¼Œå…¶ä¸­ï¼š</p><ul><li>å…­ä¸ªä»¥åŠå…­ä¸ªä»¥ä¸‹çš„å‚æ•°ä¼šæŒ‰ç…§é¡ºåºåˆ†åˆ«ä½¿ç”¨ ediã€esiã€edxã€ecxã€r8d å’Œ r9d å…­ä¸ªå¯„å­˜å™¨ä¼ é€’ï¼›</li><li>å…­ä¸ªä»¥ä¸Šçš„å‚æ•°ä¼šä½¿ç”¨æ ˆä¼ é€’ï¼Œå‡½æ•°çš„å‚æ•°ä¼šä»¥ä»å³åˆ°å·¦çš„é¡ºåºä¾æ¬¡å­˜å…¥æ ˆä¸­ï¼›</li></ul><p>è€Œå‡½æ•°çš„è¿”å›å€¼æ˜¯é€šè¿‡ eax å¯„å­˜å™¨è¿›è¡Œä¼ é€’çš„ï¼Œç”±äºåªä½¿ç”¨ä¸€ä¸ªå¯„å­˜å™¨å­˜å‚¨è¿”å›å€¼ï¼Œæ‰€ä»¥ C è¯­è¨€çš„å‡½æ•°ä¸èƒ½åŒæ—¶è¿”å›å¤šä¸ªå€¼ã€‚</p><h3 id="Go-è¯­è¨€"><a href="#Go-è¯­è¨€" class="headerlink" title="Go è¯­è¨€"></a>Go è¯­è¨€</h3><p>åˆ†æäº† C è¯­è¨€å‡½æ•°çš„è°ƒç”¨æƒ¯ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å†æ¥å‰–æä¸€ä¸‹ Go è¯­è¨€ä¸­å‡½æ•°çš„è°ƒç”¨æƒ¯ä¾‹ã€‚æˆ‘ä»¬ä»¥ä¸‹é¢è¿™ä¸ªéå¸¸ç®€å•çš„ä»£ç ç‰‡æ®µä¸ºä¾‹ç®€è¦åˆ†æä¸€ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a + b, a - b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">myFunction(<span class="number">66</span>, <span class="number">77</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ <code>myFunction</code> å‡½æ•°æ¥å—ä¸¤ä¸ªæ•´æ•°å¹¶è¿”å›ä¸¤ä¸ªæ•´æ•°ï¼Œ<code>main</code> å‡½æ•°åœ¨è°ƒç”¨ <code>myFunction</code> æ—¶å°† 66 å’Œ 77 ä¸¤ä¸ªå‚æ•°ä¼ é€’åˆ°å½“å‰å‡½æ•°ä¸­ï¼Œä½¿ç”¨ <code>go tool compile -S -N -l main.go</code> å‘½ä»¤ç¼–è¯‘ä¸Šè¿°ä»£ç å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„æ±‡ç¼–æŒ‡ä»¤ï¼š</p><blockquote><p>æ³¨ï¼šå¦‚æœç¼–è¯‘æ—¶ä¸ä½¿ç”¨ -N -l å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šå¯¹æ±‡ç¼–ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œç¼–è¯‘ç»“æœä¼šæœ‰è¾ƒå¤§å·®åˆ«ã€‚</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.main STEXT size=<span class="number">68</span> args=<span class="number">0x0</span> locals=<span class="number">0x28</span></span><br><span class="line"><span class="number">0x0000</span> <span class="number">00000</span> (main.<span class="keyword">go</span>:<span class="number">7</span>)MOVQ(TLS), CX</span><br><span class="line"><span class="number">0x0009</span> <span class="number">00009</span> (main.<span class="keyword">go</span>:<span class="number">7</span>)CMPQSP, <span class="number">16</span>(CX)</span><br><span class="line"><span class="number">0x000d</span> <span class="number">00013</span> (main.<span class="keyword">go</span>:<span class="number">7</span>)JLS<span class="number">61</span></span><br><span class="line"><span class="number">0x000f</span> <span class="number">00015</span> (main.<span class="keyword">go</span>:<span class="number">7</span>)SUBQ$<span class="number">40</span>, SP      <span class="comment">// åˆ†é… 40 å­—èŠ‚æ ˆç©ºé—´</span></span><br><span class="line"><span class="number">0x0013</span> <span class="number">00019</span> (main.<span class="keyword">go</span>:<span class="number">7</span>)MOVQBP, <span class="number">32</span>(SP)   <span class="comment">// å°†åŸºå€æŒ‡é’ˆå­˜å‚¨åˆ°æ ˆä¸Š</span></span><br><span class="line"><span class="number">0x0018</span> <span class="number">00024</span> (main.<span class="keyword">go</span>:<span class="number">7</span>)LEAQ<span class="number">32</span>(SP), BP</span><br><span class="line"><span class="number">0x001d</span> <span class="number">00029</span> (main.<span class="keyword">go</span>:<span class="number">8</span>)MOVQ$<span class="number">66</span>, (SP)    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="number">0x0025</span> <span class="number">00037</span> (main.<span class="keyword">go</span>:<span class="number">8</span>)MOVQ$<span class="number">77</span>, <span class="number">8</span>(SP)   <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="number">0x002e</span> <span class="number">00046</span> (main.<span class="keyword">go</span>:<span class="number">8</span>)CALL<span class="string">&quot;&quot;</span>.myFunction(SB)</span><br><span class="line"><span class="number">0x0033</span> <span class="number">00051</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)MOVQ<span class="number">32</span>(SP), BP</span><br><span class="line"><span class="number">0x0038</span> <span class="number">00056</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)ADDQ$<span class="number">40</span>, SP</span><br><span class="line"><span class="number">0x003c</span> <span class="number">00060</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)RET</span><br></pre></td></tr></table></figure><p>æ ¹æ® <code>main</code> å‡½æ•°ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡º <code>main</code> å‡½æ•°è°ƒç”¨ <code>myFunction</code> ä¹‹å‰çš„æ ˆæƒ…å†µï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/JRUEtl4yHBY6TXq.png" alt="golang-function-call-stack-before-calling"></p><p><code>main</code> å‡½æ•°é€šè¿‡ <code>SUBQ $40, SP</code> æŒ‡ä»¤ä¸€å…±åœ¨æ ˆä¸Šåˆ†é…äº† 40 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼š</p><div class="table-container"><table><thead><tr><th>ç©ºé—´</th><th>å¤§å°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>SP+32 ~ BP</td><td>8 å­—èŠ‚</td><td><code>main</code> å‡½æ•°çš„æ ˆåŸºå€æŒ‡é’ˆ</td></tr><tr><td>SP+16 ~ SP+32</td><td>16 å­—èŠ‚</td><td>å‡½æ•° <code>myFunction</code> çš„ä¸¤ä¸ªè¿”å›å€¼</td></tr><tr><td>SP ~ SP+16</td><td>16 å­—èŠ‚</td><td>å‡½æ•° <code>myFunction</code> çš„ä¸¤ä¸ªå‚æ•°</td></tr></tbody></table></div><p><code>myFunction</code> å…¥å‚çš„å‹æ ˆé¡ºåºå’Œ C è¯­è¨€ä¸€æ ·ï¼Œéƒ½æ˜¯ä»å³åˆ°å·¦ï¼Œå³ç¬¬ä¸€ä¸ªå‚æ•° 66 åœ¨æ ˆé¡¶çš„ SP ~ SP+8ï¼Œç¬¬äºŒä¸ªå‚æ•°å­˜å‚¨åœ¨ SP+8 ~ SP+16 çš„ç©ºé—´ä¸­ã€‚</p><p>å½“æˆ‘ä»¬å‡†å¤‡å¥½å‡½æ•°çš„å…¥å‚ä¹‹åï¼Œä¼šè°ƒç”¨æ±‡ç¼–æŒ‡ä»¤ <code>CALL &quot;&quot;.myFunction(SB)</code>ï¼Œè¿™ä¸ªæŒ‡ä»¤é¦–å…ˆä¼šå°† <code>main</code> çš„è¿”å›åœ°å€å­˜å…¥æ ˆä¸­ï¼Œç„¶åæ”¹å˜å½“å‰çš„æ ˆæŒ‡é’ˆ SP å¹¶å¼€å§‹æ‰§è¡Œ <code>myFunction</code> çš„æ±‡ç¼–æŒ‡ä»¤ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.myFunction STEXT nosplit size=<span class="number">49</span> args=<span class="number">0x20</span> locals=<span class="number">0x0</span></span><br><span class="line"><span class="number">0x0000</span> <span class="number">00000</span> (main.<span class="keyword">go</span>:<span class="number">3</span>)MOVQ$<span class="number">0</span>, <span class="string">&quot;&quot;</span>.~r2+<span class="number">24</span>(SP) <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€ä¸ªè¿”å›å€¼</span></span><br><span class="line"><span class="number">0x0009</span> <span class="number">00009</span> (main.<span class="keyword">go</span>:<span class="number">3</span>)MOVQ$<span class="number">0</span>, <span class="string">&quot;&quot;</span>.~r3+<span class="number">32</span>(SP) <span class="comment">// åˆå§‹åŒ–ç¬¬äºŒä¸ªè¿”å›å€¼</span></span><br><span class="line"><span class="number">0x0012</span> <span class="number">00018</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)MOVQ<span class="string">&quot;&quot;</span>.a+<span class="number">8</span>(SP), AX    <span class="comment">// AX = 66</span></span><br><span class="line"><span class="number">0x0017</span> <span class="number">00023</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)ADDQ<span class="string">&quot;&quot;</span>.b+<span class="number">16</span>(SP), AX   <span class="comment">// AX = AX + 77 = 143</span></span><br><span class="line"><span class="number">0x001c</span> <span class="number">00028</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)MOVQAX, <span class="string">&quot;&quot;</span>.~r2+<span class="number">24</span>(SP) <span class="comment">// (24)SP = AX = 143</span></span><br><span class="line"><span class="number">0x0021</span> <span class="number">00033</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)MOVQ<span class="string">&quot;&quot;</span>.a+<span class="number">8</span>(SP), AX    <span class="comment">// AX = 66</span></span><br><span class="line"><span class="number">0x0026</span> <span class="number">00038</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)SUBQ<span class="string">&quot;&quot;</span>.b+<span class="number">16</span>(SP), AX   <span class="comment">// AX = AX - 77 = -11</span></span><br><span class="line"><span class="number">0x002b</span> <span class="number">00043</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)MOVQAX, <span class="string">&quot;&quot;</span>.~r3+<span class="number">32</span>(SP) <span class="comment">// (32)SP = AX = -11</span></span><br><span class="line"><span class="number">0x0030</span> <span class="number">00048</span> (main.<span class="keyword">go</span>:<span class="number">4</span>)RET</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°çš„æ±‡ç¼–ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“å‰å‡½æ•°åœ¨æ‰§è¡Œæ—¶é¦–å…ˆä¼šå°† <code>main</code> å‡½æ•°ä¸­é¢„ç•™çš„ä¸¤ä¸ªè¿”å›å€¼åœ°å€ç½®æˆ <code>int</code> ç±»å‹çš„é»˜è®¤å€¼ 0ï¼Œç„¶åæ ¹æ®æ ˆçš„ç›¸å¯¹ä½ç½®è·å–å‚æ•°å¹¶è¿›è¡ŒåŠ å‡æ“ä½œå¹¶å°†å€¼å­˜å›æ ˆä¸­ï¼Œåœ¨ <code>myFunction</code> å‡½æ•°è¿”å›ä¹‹é—´ï¼Œæ ˆä¸­çš„æ•°æ®å¦‚å›¾ 4-3 æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/VY1tQJNkSi94sDv.png" alt="golang-function-call-stack-before-return"></p><p>åœ¨ <code>myFunction</code> è¿”å›ä¹‹åï¼Œ<code>main</code> å‡½æ•°ä¼šé€šè¿‡ä»¥ä¸‹çš„æŒ‡ä»¤æ¥æ¢å¤æ ˆåŸºå€æŒ‡é’ˆå¹¶é”€æ¯å·²ç»å¤±å»ä½œç”¨çš„ 40 å­—èŠ‚çš„æ ˆç©ºé—´ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0033</span> <span class="number">00051</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)    MOVQ    <span class="number">32</span>(SP), BP</span><br><span class="line"><span class="number">0x0038</span> <span class="number">00056</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)    ADDQ    $<span class="number">40</span>, SP</span><br><span class="line"><span class="number">0x003c</span> <span class="number">00060</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)    RET</span><br></pre></td></tr></table></figure><p>é€šè¿‡åˆ†æ Go è¯­è¨€ç¼–è¯‘åçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œæˆ‘ä»¬å‘ç° Go è¯­è¨€ä½¿ç”¨æ ˆä¼ é€’å‚æ•°å’Œæ¥æ”¶è¿”å›å€¼ï¼Œæ‰€ä»¥å®ƒåªéœ€è¦åœ¨æ ˆä¸Šå¤šåˆ†é…ä¸€äº›å†…å­˜å°±å¯ä»¥è¿”å›å¤šä¸ªå€¼ã€‚</p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>C è¯­è¨€å’Œ Go è¯­è¨€åœ¨è®¾è®¡å‡½æ•°çš„è°ƒç”¨æƒ¯ä¾‹æ—¶é€‰æ‹©ä¹Ÿä¸åŒçš„å®ç°ã€‚C è¯­è¨€åŒæ—¶ä½¿ç”¨å¯„å­˜å™¨å’Œæ ˆä¼ é€’å‚æ•°ï¼Œä½¿ç”¨ eax å¯„å­˜å™¨ä¼ é€’è¿”å›å€¼ï¼›è€Œ Go è¯­è¨€ä½¿ç”¨æ ˆä¼ é€’å‚æ•°å’Œè¿”å›å€¼ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤ç§è®¾è®¡çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š</p><ul><li>C è¯­è¨€çš„æ–¹å¼èƒ½å¤Ÿæå¤§åœ°å‡å°‘å‡½æ•°è°ƒç”¨çš„é¢å¤–å¼€é”€ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†å®ç°çš„å¤æ‚åº¦ï¼›<ul><li>CPU è®¿é—®æ ˆçš„å¼€é”€æ¯”è®¿é—®å¯„å­˜å™¨é«˜å‡ åå€ï¼›</li><li>éœ€è¦å•ç‹¬å¤„ç†å‡½æ•°å‚æ•°è¿‡å¤šçš„æƒ…å†µï¼›</li></ul></li><li>Go è¯­è¨€çš„æ–¹å¼èƒ½å¤Ÿé™ä½å®ç°çš„å¤æ‚åº¦å¹¶æ”¯æŒå¤šè¿”å›å€¼ï¼Œä½†æ˜¯ç‰ºç‰²äº†å‡½æ•°è°ƒç”¨çš„æ€§èƒ½ï¼›<ul><li>ä¸éœ€è¦è€ƒè™‘è¶…è¿‡å¯„å­˜å™¨æ•°é‡çš„å‚æ•°åº”è¯¥å¦‚ä½•ä¼ é€’ï¼›</li><li>ä¸éœ€è¦è€ƒè™‘ä¸åŒæ¶æ„ä¸Šçš„å¯„å­˜å™¨å·®å¼‚ï¼›</li><li>å‡½æ•°å…¥å‚å’Œå‡ºå‚çš„å†…å­˜ç©ºé—´éœ€è¦åœ¨æ ˆä¸Šè¿›è¡Œåˆ†é…ï¼›</li></ul></li></ul><p>Go è¯­è¨€ä½¿ç”¨æ ˆä½œä¸ºå‚æ•°å’Œè¿”å›å€¼ä¼ é€’çš„æ–¹æ³•æ˜¯ç»¼åˆè€ƒè™‘åçš„è®¾è®¡ï¼Œé€‰æ‹©è¿™ç§è®¾è®¡æ„å‘³ç€ç¼–è¯‘å™¨ä¼šæ›´åŠ ç®€å•ã€æ›´å®¹æ˜“ç»´æŠ¤ã€‚</p><h2 id="å‚æ•°ä¼ é€’"><a href="#å‚æ•°ä¼ é€’" class="headerlink" title="å‚æ•°ä¼ é€’"></a>å‚æ•°ä¼ é€’</h2><p>é™¤äº†å‡½æ•°çš„è°ƒç”¨æƒ¯ä¾‹ä¹‹å¤–ï¼ŒGo è¯­è¨€åœ¨ä¼ é€’å‚æ•°æ—¶æ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å½±å“çš„æ˜¯å½“æˆ‘ä»¬åœ¨å‡½æ•°ä¸­å¯¹å…¥å‚è¿›è¡Œä¿®æ”¹æ—¶ä¼šä¸ä¼šå½±å“è°ƒç”¨æ–¹çœ‹åˆ°çš„æ•°æ®ã€‚æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹ä¼ å€¼å’Œä¼ å¼•ç”¨ä¸¤è€…çš„åŒºåˆ«ï¼š</p><ul><li>ä¼ å€¼ï¼šå‡½æ•°è°ƒç”¨æ—¶ä¼šå¯¹å‚æ•°è¿›è¡Œæ‹·è´ï¼Œè¢«è°ƒç”¨æ–¹å’Œè°ƒç”¨æ–¹ä¸¤è€…æŒæœ‰ä¸ç›¸å…³çš„ä¸¤ä»½æ•°æ®ï¼›</li><li>ä¼ å¼•ç”¨ï¼šå‡½æ•°è°ƒç”¨æ—¶ä¼šä¼ é€’å‚æ•°çš„æŒ‡é’ˆï¼Œè¢«è°ƒç”¨æ–¹å’Œè°ƒç”¨æ–¹ä¸¤è€…æŒæœ‰ç›¸åŒçš„æ•°æ®ï¼Œä»»æ„ä¸€æ–¹åšå‡ºçš„ä¿®æ”¹éƒ½ä¼šå½±å“å¦ä¸€æ–¹ã€‚</li></ul><p>ä¸åŒè¯­è¨€ä¼šé€‰æ‹©ä¸åŒçš„æ–¹å¼ä¼ é€’å‚æ•°ï¼ŒGo è¯­è¨€é€‰æ‹©äº†ä¼ å€¼çš„æ–¹å¼ï¼Œ<strong>æ— è®ºæ˜¯ä¼ é€’åŸºæœ¬ç±»å‹ã€ç»“æ„ä½“è¿˜æ˜¯æŒ‡é’ˆï¼Œéƒ½ä¼šå¯¹ä¼ é€’çš„å‚æ•°è¿›è¡Œæ‹·è´</strong>ã€‚æœ¬èŠ‚å‰©ä¸‹çš„å†…å®¹å°†ä¼šéªŒè¯è¿™ä¸ªç»“è®ºçš„æ­£ç¡®æ€§ã€‚</p><h3 id="æ•´å‹å’Œæ•°ç»„"><a href="#æ•´å‹å’Œæ•°ç»„" class="headerlink" title="æ•´å‹å’Œæ•°ç»„"></a>æ•´å‹å’Œæ•°ç»„</h3><p>æˆ‘ä»¬å…ˆæ¥åˆ†æ Go è¯­è¨€æ˜¯å¦‚ä½•ä¼ é€’åŸºæœ¬ç±»å‹å’Œæ•°ç»„çš„ã€‚å¦‚ä¸‹æ‰€ç¤ºçš„å‡½æ•° <code>myFunction</code> æ¥æ”¶äº†ä¸¤ä¸ªå‚æ•°ï¼Œæ•´å‹å˜é‡ <code>i</code> å’Œæ•°ç»„ <code>arr</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°†ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°çš„åœ°å€æ‰“å°å‡ºæ¥ï¼Œåœ¨æœ€å¤–å±‚çš„ä¸»å‡½æ•°ä¹Ÿä¼šåœ¨ <code>myFunction</code> å‡½æ•°è°ƒç”¨å‰ååˆ†åˆ«æ‰“å°ä¸¤ä¸ªå‚æ•°çš„åœ°å€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">(i <span class="keyword">int</span>, arr [2]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;in my_funciton - i=(%d, %p) arr=(%v, %p)\n&quot;</span>, i, &amp;i, arr, &amp;arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">30</span></span><br><span class="line">arr := [<span class="number">2</span>]<span class="keyword">int</span>&#123;<span class="number">66</span>, <span class="number">77</span>&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;before calling - i=(%d, %p) arr=(%v, %p)\n&quot;</span>, i, &amp;i, arr, &amp;arr)</span><br><span class="line">myFunction(i, arr)</span><br><span class="line">fmt.Printf(<span class="string">&quot;after  calling - i=(%d, %p) arr=(%v, %p)\n&quot;</span>, i, &amp;i, arr, &amp;arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">before calling - i=(<span class="number">30</span>, <span class="number">0xc00009a000</span>) arr=([<span class="number">66</span> <span class="number">77</span>], <span class="number">0xc00009a010</span>)</span><br><span class="line">in my_funciton - i=(<span class="number">30</span>, <span class="number">0xc00009a008</span>) arr=([<span class="number">66</span> <span class="number">77</span>], <span class="number">0xc00009a020</span>)</span><br><span class="line">after  calling - i=(<span class="number">30</span>, <span class="number">0xc00009a000</span>) arr=([<span class="number">66</span> <span class="number">77</span>], <span class="number">0xc00009a010</span>)</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¿è¡Œè¿™æ®µä»£ç æˆ‘ä»¬ä¼šå‘ç°ï¼Œ<code>main</code> å‡½æ•°å’Œè¢«è°ƒç”¨è€… <code>myFunction</code> ä¸­å‚æ•°çš„åœ°å€æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p><p>ä¸è¿‡ä» <code>main</code> å‡½æ•°çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨è°ƒç”¨ <code>myFunction</code> å‰åï¼Œæ•´æ•° <code>i</code> å’Œæ•°ç»„ <code>arr</code> ä¸¤ä¸ªå‚æ•°çš„åœ°å€éƒ½æ²¡æœ‰å˜åŒ–ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬åœ¨ <code>myFunction</code> å‡½æ•°å†…éƒ¨å¯¹å‚æ•°è¿›è¡Œä¿®æ”¹æ˜¯å¦ä¼šå½±å“ <code>main</code> å‡½æ•°ä¸­çš„å˜é‡å‘¢ï¼Ÿæˆ‘ä»¬æ›´æ–° <code>myFunction</code> å‡½æ•°å¹¶é‡æ–°æ‰§è¡Œè¿™æ®µä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">(i <span class="keyword">int</span>, arr [2]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">i = <span class="number">29</span></span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">88</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;in my_funciton - i=(%d, %p) arr=(%v, %p)\n&quot;</span>, i, &amp;i, arr, &amp;arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">before calling - i=(<span class="number">30</span>, <span class="number">0xc000072008</span>) arr=([<span class="number">66</span> <span class="number">77</span>], <span class="number">0xc000072010</span>)</span><br><span class="line">in my_funciton - i=(<span class="number">29</span>, <span class="number">0xc000072028</span>) arr=([<span class="number">66</span> <span class="number">88</span>], <span class="number">0xc000072040</span>)</span><br><span class="line">after  calling - i=(<span class="number">30</span>, <span class="number">0xc000072008</span>) arr=([<span class="number">66</span> <span class="number">77</span>], <span class="number">0xc000072010</span>)</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°åœ¨ <code>myFunction</code> ä¸­å¯¹å‚æ•°çš„ä¿®æ”¹ä¹Ÿä»…ä»…å½±å“äº†å½“å‰å‡½æ•°ï¼Œå¹¶æ²¡æœ‰å½±å“è°ƒç”¨æ–¹ <code>main</code> å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½ç»™å‡ºå¦‚ä¸‹çš„ç»“è®º - <strong>Go è¯­è¨€ä¸­å¯¹äºæ•´å‹å’Œæ•°ç»„ç±»å‹çš„å‚æ•°éƒ½æ˜¯å€¼ä¼ é€’çš„</strong>ï¼Œä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨å‡½æ•°æ—¶ä¼šå¯¹å†…å®¹è¿›è¡Œæ‹·è´ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœå½“å‰æ•°ç»„çš„å¤§å°éå¸¸çš„å¤§ï¼Œè¿™ç§ä¼ å€¼æ–¹å¼å°±ä¼šå¯¹æ€§èƒ½é€ æˆæ¯”è¾ƒå¤§çš„å½±å“ã€‚</p><h3 id="ç»“æ„ä½“å’ŒæŒ‡é’ˆ"><a href="#ç»“æ„ä½“å’ŒæŒ‡é’ˆ" class="headerlink" title="ç»“æ„ä½“å’ŒæŒ‡é’ˆ"></a>ç»“æ„ä½“å’ŒæŒ‡é’ˆ</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æ Go è¯­è¨€å¦å¤–ä¸¤ç§å¸¸è§ç±»å‹ â€”â€” ç»“æ„ä½“å’ŒæŒ‡é’ˆã€‚åœ¨è¿™æ®µä»£ç ä¸­å®šä¹‰ä¸€ä¸ªåªåŒ…å«ä¸€ä¸ªæˆå‘˜å˜é‡çš„ç®€å•ç»“æ„ä½“ <code>MyStruct</code> ä»¥åŠæ¥å—ä¸¤ä¸ªå‚æ•°çš„ <code>myFunction</code> æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">i <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">(a MyStruct, b *MyStruct)</span></span> &#123;</span><br><span class="line">a.i = <span class="number">31</span></span><br><span class="line">b.i = <span class="number">41</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;in my_function - a=(%d, %p) b=(%v, %p)\n&quot;</span>, a, &amp;a, b, &amp;b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := MyStruct&#123;i: <span class="number">30</span>&#125;</span><br><span class="line">b := &amp;MyStruct&#123;i: <span class="number">40</span>&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;before calling - a=(%d, %p) b=(%v, %p)\n&quot;</span>, a, &amp;a, b, &amp;b)</span><br><span class="line">myFunction(a, b)</span><br><span class="line">fmt.Printf(<span class="string">&quot;after calling  - a=(%d, %p) b=(%v, %p)\n&quot;</span>, a, &amp;a, b, &amp;b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">before calling - a=(&#123;<span class="number">30</span>&#125;, <span class="number">0xc000018178</span>) b=(&amp;&#123;<span class="number">40</span>&#125;, <span class="number">0xc00000c028</span>)</span><br><span class="line">in my_function - a=(&#123;<span class="number">31</span>&#125;, <span class="number">0xc000018198</span>) b=(&amp;&#123;<span class="number">41</span>&#125;, <span class="number">0xc00000c038</span>)</span><br><span class="line">after calling  - a=(&#123;<span class="number">30</span>&#125;, <span class="number">0xc000018178</span>) b=(&amp;&#123;<span class="number">41</span>&#125;, <span class="number">0xc00000c028</span>)</span><br></pre></td></tr></table></figure><p>ä»è¿è¡Œçš„ç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š</p><ul><li>ä¼ é€’ç»“æ„ä½“æ—¶ï¼šä¼šå¯¹ç»“æ„ä½“ä¸­çš„å…¨éƒ¨å†…å®¹è¿›è¡Œæ‹·è´ï¼›</li><li>ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆæ—¶ï¼šä¼šå¯¹ç»“æ„ä½“æŒ‡é’ˆè¿›è¡Œæ‹·è´ï¼›</li></ul><p>å¯¹ç»“æ„ä½“æŒ‡é’ˆçš„ä¿®æ”¹æ˜¯æ”¹å˜äº†æŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“ï¼Œ<code>b.i</code> å¯ä»¥è¢«ç†è§£æˆ <code>(*b).i</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å…ˆè·å–æŒ‡é’ˆ <code>b</code> èƒŒåçš„ç»“æ„ä½“ï¼Œå†ä¿®æ”¹ç»“æ„ä½“çš„æˆå‘˜å˜é‡ã€‚æˆ‘ä»¬ç®€å•ä¿®æ”¹ä¸Šè¿°ä»£ç ï¼Œåˆ†æä¸€ä¸‹ Go è¯­è¨€ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">i <span class="keyword">int</span></span><br><span class="line">j <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">(ms *MyStruct)</span></span> &#123;</span><br><span class="line">ptr := unsafe.Pointer(ms)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">c := (*<span class="keyword">int</span>)(unsafe.Pointer((<span class="keyword">uintptr</span>(ptr) + <span class="keyword">uintptr</span>(<span class="number">8</span>*i))))</span><br><span class="line">*c += i + <span class="number">1</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;[%p] %d\n&quot;</span>, c, *c)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := &amp;MyStruct&#123;i: <span class="number">40</span>, j: <span class="number">50</span>&#125;</span><br><span class="line">myFunction(a)</span><br><span class="line">fmt.Printf(<span class="string">&quot;[%p] %v\n&quot;</span>, a, a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">[<span class="number">0xc000018180</span>] <span class="number">41</span></span><br><span class="line">[<span class="number">0xc000018188</span>] <span class="number">52</span></span><br><span class="line">[<span class="number">0xc000018180</span>] &amp;&#123;<span class="number">41</span> <span class="number">52</span>&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡é’ˆçš„æ–¹å¼ä¿®æ”¹ç»“æ„ä½“ä¸­çš„æˆå‘˜å˜é‡ï¼Œç»“æ„ä½“åœ¨å†…å­˜ä¸­æ˜¯ä¸€ç‰‡è¿ç»­çš„ç©ºé—´ï¼ŒæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆä¹Ÿæ˜¯æŒ‡å‘è¿™ä¸ªç»“æ„ä½“çš„é¦–åœ°å€ã€‚å°† <code>MyStruct</code> æŒ‡é’ˆä¿®æ”¹æˆ <code>int</code> ç±»å‹çš„ï¼Œé‚£ä¹ˆè®¿é—®æ–°æŒ‡é’ˆå°±ä¼šè¿”å›æ•´å‹å˜é‡ <code>i</code>ï¼Œå°†æŒ‡é’ˆç§»åŠ¨ 8 ä¸ªå­—èŠ‚ä¹‹åå°±èƒ½è·å–ä¸‹ä¸€ä¸ªæˆå‘˜å˜é‡ <code>j</code>ã€‚</p><p>å¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°ä»£ç ç®€åŒ–æˆå¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç‰‡æ®µå¹¶ä½¿ç”¨ <code>go tool compile</code> è¿›è¡Œç¼–è¯‘ä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">i <span class="keyword">int</span></span><br><span class="line">j <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">(ms *MyStruct)</span> *<span class="title">MyStruct</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> ms</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> tool compile -S -N -l main.<span class="keyword">go</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.myFunction STEXT nosplit size=<span class="number">20</span> args=<span class="number">0x10</span> locals=<span class="number">0x0</span></span><br><span class="line"><span class="number">0x0000</span> <span class="number">00000</span> (main.<span class="keyword">go</span>:<span class="number">8</span>)MOVQ$<span class="number">0</span>, <span class="string">&quot;&quot;</span>.~r1+<span class="number">16</span>(SP) <span class="comment">// åˆå§‹åŒ–è¿”å›å€¼</span></span><br><span class="line"><span class="number">0x0009</span> <span class="number">00009</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)MOVQ<span class="string">&quot;&quot;</span>.ms+<span class="number">8</span>(SP), AX   <span class="comment">// å¤åˆ¶å¼•ç”¨</span></span><br><span class="line"><span class="number">0x000e</span> <span class="number">00014</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)MOVQAX, <span class="string">&quot;&quot;</span>.~r1+<span class="number">16</span>(SP) <span class="comment">// è¿”å›å¼•ç”¨</span></span><br><span class="line"><span class="number">0x0013</span> <span class="number">00019</span> (main.<span class="keyword">go</span>:<span class="number">9</span>)RET</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µæ±‡ç¼–è¯­è¨€ä¸­æˆ‘ä»¬å‘ç°å½“å‚æ•°æ˜¯æŒ‡é’ˆæ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨ <code>MOVQ &quot;&quot;.ms+8(SP), AX</code> æŒ‡ä»¤å¯¹å¼•ç”¨è¿›è¡Œå¤åˆ¶ï¼Œç„¶åå°†å¤åˆ¶åçš„æŒ‡é’ˆä½œä¸ºè¿”å›å€¼ä¼ é€’å›è°ƒç”¨æ–¹ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/DIEtN3Tvl764BZi.png" alt="golang-pointer-as-argument"></p><p>æ‰€ä»¥å°†æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥æŸä¸€ä¸ªå‡½æ•°æ—¶ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¼šå¯¹æŒ‡é’ˆè¿›è¡Œå¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¼šåŒæ—¶å‡ºç°ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŸæœ‰çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ Go è¯­è¨€ä¸­ã€ä¼ æŒ‡é’ˆã€ä¹Ÿæ˜¯ä¼ å€¼ã€‚</p><h3 id="ä¼ å€¼"><a href="#ä¼ å€¼" class="headerlink" title="ä¼ å€¼"></a>ä¼ å€¼</h3><p>å½“æˆ‘ä»¬å¯¹ Go è¯­è¨€ä¸­å¤§å¤šæ•°å¸¸è§çš„æ•°æ®ç»“æ„è¿›è¡ŒéªŒè¯ä¹‹åï¼Œå…¶å®å°±èƒ½å¤Ÿæ¨æµ‹å‡º Go è¯­è¨€åœ¨ä¼ é€’å‚æ•°æ—¶å…¶å®ä½¿ç”¨çš„å°±æ˜¯ä¼ å€¼çš„æ–¹å¼ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°å‚æ•°æ—¶ä¼šå¯¹è¿™äº›å‚æ•°è¿›è¡Œå¤åˆ¶ï¼›äº†è§£åˆ°è¿™ä¸€ç‚¹ä¹‹åï¼Œåœ¨ä¼ é€’æ•°ç»„æˆ–è€…å†…å­˜å ç”¨éå¸¸å¤§çš„ç»“æ„ä½“æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸€äº›å‡½æ•°ä¸­åº”è¯¥å°½é‡ä½¿ç”¨æŒ‡é’ˆä½œä¸ºå‚æ•°ç±»å‹æ¥é¿å…å‘ç”Ÿå¤§é‡æ•°æ®çš„æ‹·è´è€Œå½±å“æ€§èƒ½ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™ä¸€èŠ‚æˆ‘ä»¬è¯¦ç»†åˆ†æäº† Go è¯­è¨€çš„è°ƒç”¨æƒ¯ä¾‹ï¼ŒåŒ…æ‹¬ä¼ é€’å‚æ•°å’Œè¿”å›å€¼çš„è¿‡ç¨‹å’ŒåŸç†ã€‚Go é€šè¿‡æ ˆä¼ é€’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰ä¼šåœ¨æ ˆä¸Šä¸ºè¿”å›å€¼åˆ†é…åˆé€‚çš„å†…å­˜ç©ºé—´ï¼Œéšåå°†å…¥å‚ä»å³åˆ°å·¦æŒ‰é¡ºåºå‹æ ˆå¹¶æ‹·è´å‚æ•°ï¼Œè¿”å›å€¼ä¼šè¢«å­˜å‚¨åˆ°è°ƒç”¨æ–¹é¢„ç•™å¥½çš„æ ˆç©ºé—´ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•æ€»ç»“å‡ºä»¥ä¸‹å‡ æ¡è§„åˆ™ï¼š</p><ol><li>é€šè¿‡å †æ ˆä¼ é€’å‚æ•°ï¼Œå…¥æ ˆçš„é¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼›</li><li>å‡½æ•°è¿”å›å€¼é€šè¿‡å †æ ˆä¼ é€’å¹¶ç”±è°ƒç”¨è€…é¢„å…ˆåˆ†é…å†…å­˜ç©ºé—´ï¼›</li><li>è°ƒç”¨å‡½æ•°æ—¶éƒ½æ˜¯ä¼ å€¼ï¼Œæ¥æ”¶æ–¹ä¼šå¯¹å…¥å‚è¿›è¡Œå¤åˆ¶å†è®¡ç®—ï¼›</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€çš„å­—ç¬¦ä¸²</title>
      <link href="/2020/01/06/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2020/01/06/go/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<p>å­—ç¬¦ä¸²æ˜¯ Go è¯­è¨€ä¸­æœ€å¸¸ç”¨çš„åŸºç¡€æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œè™½ç„¶å­—ç¬¦ä¸²å¾€å¾€è¢«çœ‹åšä¸€ä¸ªæ•´ä½“ï¼Œä½†æ˜¯å®é™…ä¸Šå­—ç¬¦ä¸²æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒç†è§£æˆä¸€ä¸ªç”±å­—ç¬¦ç»„æˆçš„æ•°ç»„ï¼Œæœ¬æ–‡å°±ä¼šè¯¦ç»†ä»‹ç»å­—ç¬¦ä¸²çš„å®ç°åŸç†ã€ç›¸å…³è½¬æ¢è¿‡ç¨‹ä»¥åŠå¸¸è§æ“ä½œçš„å®ç°ã€‚</p><a id="more"></a><p>å­—ç¬¦ä¸²è™½ç„¶åœ¨ Go è¯­è¨€ä¸­æ˜¯åŸºæœ¬ç±»å‹ <code>string</code>ï¼Œä½†æ˜¯å®ƒå®é™…ä¸Šæ˜¯ç”±å­—ç¬¦ç»„æˆçš„æ•°ç»„ï¼ŒC è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å°±ä½¿ç”¨å­—ç¬¦æ•°ç»„ <code>char[]</code> è¡¨ç¤ºï¼Œä½œä¸ºæ•°ç»„ä¼šå ç”¨ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¿™ç‰‡å†…å­˜ç©ºé—´å­˜å‚¨äº†çš„å­—èŠ‚å…±åŒç»„æˆäº†å­—ç¬¦ä¸²ï¼ŒGo è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å…¶å®æ˜¯ä¸€ä¸ªåªè¯»çš„å­—èŠ‚æ•°ç»„ï¼Œä¸‹å›¾å±•ç¤ºäº† <code>&quot;hello&quot;</code> å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/D6RhWCdKk7oXeOp.png" alt="in-memory-string"></p><p>å¦‚æœæ˜¯ä»£ç ä¸­å­˜åœ¨çš„å­—ç¬¦ä¸²ï¼Œä¼šåœ¨ç¼–è¯‘æœŸé—´è¢«æ ‡è®°æˆåªè¯»æ•°æ® <code>SRODATA</code> ç¬¦å·ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„ä¸€æ®µä»£ç ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå½“æˆ‘ä»¬å°†è¿™æ®µä»£ç ç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€æ—¶ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ° <code>hello</code> å­—ç¬¦ä¸²æœ‰ä¸€ä¸ª <code>SRODATA</code> çš„æ ‡è®°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cat main.go</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">str := <span class="string">&quot;hello&quot;</span></span><br><span class="line">println([]byte(str))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ GOOS=linux GOARCH=amd64 go tool compile -S main.go</span><br><span class="line">...</span><br><span class="line">go.string.<span class="string">&quot;hello&quot;</span> SRODATA dupok size=5</span><br><span class="line">0x0000 68 65 6c 6c 6f                                   hello</span><br><span class="line">... </span><br></pre></td></tr></table></figure><p>åªè¯»åªæ„å‘³ç€å­—ç¬¦ä¸²ä¼šåˆ†é…åˆ°åªè¯»çš„å†…å­˜ç©ºé—´å¹¶ä¸”è¿™å—å†…å­˜ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶æˆ‘ä»¬å…¶å®è¿˜æ˜¯å¯ä»¥å°†è¿™æ®µå†…å­˜æ‹·è´åˆ°å †æˆ–è€…æ ˆä¸Šï¼Œå°†å˜é‡çš„ç±»å‹è½¬æ¢æˆ <code>[]byte</code> ä¹‹åå°±å¯ä»¥è¿›è¡Œï¼Œä¿®æ”¹åé€šè¿‡ç±»å‹è½¬æ¢å°±å¯ä»¥å˜å› <code>string</code>ï¼ŒGo è¯­è¨€åªæ˜¯ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ <code>string</code> ç±»å‹å˜é‡çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>å­—ç¬¦ä¸²åœ¨ Go è¯­è¨€ä¸­çš„æ¥å£å…¶å®éå¸¸ç®€å•ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦ä¸²åœ¨è¿è¡Œæ—¶éƒ½ä¼šä½¿ç”¨å¦‚ä¸‹çš„ <code>StringHeader</code> ç»“æ„ä½“è¡¨ç¤ºï¼Œåœ¨è¿è¡Œæ—¶åŒ…çš„å†…éƒ¨å…¶å®æœ‰ä¸€ä¸ªç§æœ‰çš„ç»“æ„ <code>stringHeader</code>ï¼Œå®ƒæœ‰ç€å®Œå…¨ç›¸åŒçš„ç»“æ„åªæ˜¯ç”¨äºå­˜å‚¨æ•°æ®çš„ <code>Data</code> å­—æ®µä½¿ç”¨äº† <code>unsafe.Pointer</code> ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StringHeader <span class="keyword">struct</span> &#123;</span><br><span class="line">Data <span class="keyword">uintptr</span></span><br><span class="line">Len  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šç»å¸¸ä¼šè¯´å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªåªè¯»çš„<a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice/">åˆ‡ç‰‡</a>ç±»å‹ï¼Œè¿™æ˜¯å› ä¸ºåˆ‡ç‰‡åœ¨ Go è¯­è¨€çš„è¿è¡Œæ—¶è¡¨ç¤ºä¸å­—ç¬¦ä¸²é«˜åº¦ç›¸ä¼¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SliceHeader <span class="keyword">struct</span> &#123;</span><br><span class="line">Data <span class="keyword">uintptr</span></span><br><span class="line">Len  <span class="keyword">int</span></span><br><span class="line">Cap  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸åˆ‡ç‰‡çš„ç»“æ„ä½“ç›¸æ¯”ï¼Œå­—ç¬¦ä¸²å°‘äº†ä¸€ä¸ªè¡¨ç¤ºå®¹é‡çš„ <code>Cap</code> å­—æ®µï¼Œå› ä¸ºå­—ç¬¦ä¸²ä½œä¸ºåªè¯»çš„ç±»å‹ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥å‘å­—ç¬¦ä¸²ç›´æ¥è¿½åŠ å…ƒç´ æ”¹å˜å…¶æœ¬èº«çš„å†…å­˜ç©ºé—´ï¼Œæ‰€æœ‰åœ¨å­—ç¬¦ä¸²ä¸Šæ‰§è¡Œçš„å†™å…¥æ“ä½œå®é™…éƒ½æ˜¯é€šè¿‡æ‹·è´å®ç°çš„ã€‚</p><h2 id="è§£æè¿‡ç¨‹"><a href="#è§£æè¿‡ç¨‹" class="headerlink" title="è§£æè¿‡ç¨‹"></a>è§£æè¿‡ç¨‹</h2><p>å­—ç¬¦ä¸²çš„è§£æä¸€å®šæ˜¯è§£æå™¨åœ¨è¯æ³•åˆ†ææ—¶å°±å®Œæˆçš„ï¼Œè¯æ³•åˆ†æé˜¶æ®µä¼šå¯¹æºæ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²è¿›è¡Œåˆ‡ç‰‡å’Œåˆ†ç»„ï¼Œå°†åŸæœ‰æ— æ„ä¹‰çš„å­—ç¬¦æµè½¬æ¢æˆ Token åºåˆ—ï¼Œåœ¨ Go è¯­è¨€ä¸­ï¼Œæœ‰ä¸¤ç§å­—é¢é‡æ–¹å¼å¯ä»¥å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€ç§æ˜¯ä½¿ç”¨åŒå¼•å·ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨åå¼•å·:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str1 := <span class="string">&quot;this is a string&quot;</span></span><br><span class="line">str2 := <span class="string">`this is another </span></span><br><span class="line"><span class="string">string`</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŒå¼•å·å£°æ˜çš„å­—ç¬¦ä¸²å’Œå…¶ä»–è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œå®ƒåªèƒ½ç”¨äºå•è¡Œå­—ç¬¦ä¸²çš„åˆå§‹åŒ–ï¼Œå¦‚æœå­—ç¬¦ä¸²å†…éƒ¨å‡ºç°åŒå¼•å·ï¼Œéœ€è¦ä½¿ç”¨ <code>\</code> ç¬¦å·é¿å…ç¼–è¯‘å™¨çš„è§£æé”™è¯¯ï¼Œè€Œåå¼•å·å£°æ˜çš„å­—ç¬¦ä¸²å°±å¯ä»¥æ‘†è„±å•è¡Œçš„é™åˆ¶ï¼Œå› ä¸ºåŒå¼•å·ä¸å†è´Ÿè´£æ ‡è®°å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­—ç¬¦ä¸²å†…éƒ¨ç›´æ¥ä½¿ç”¨ <code>&quot;</code>ï¼Œåœ¨é‡åˆ°éœ€è¦æ‰‹å†™ JSON æˆ–è€…å…¶ä»–å¤æ‚æ•°æ®æ ¼å¼çš„åœºæ™¯ä¸‹éå¸¸æ–¹ä¾¿ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json := <span class="string">`&#123;&quot;author&quot;: &quot;draven&quot;, &quot;tags&quot;: [&quot;golang&quot;]&#125;`</span></span><br></pre></td></tr></table></figure><p>ä¸¤ç§ä¸åŒçš„å£°æ˜æ–¹å¼å…¶å®ä¹Ÿæ„å‘³ç€ Go è¯­è¨€çš„ç¼–è¯‘å™¨éœ€è¦åœ¨è§£æçš„é˜¶æ®µèƒ½å¤ŸåŒºåˆ†å¹¶ä¸”æ­£ç¡®è§£æè¿™ä¸¤ç§ä¸åŒçš„å­—ç¬¦ä¸²æ ¼å¼ï¼Œè§£æå­—ç¬¦ä¸²ä½¿ç”¨çš„ <code>scanner</code> æ‰«æå™¨ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯å°†è¾“å…¥çš„å­—ç¬¦æµè½¬æ¢æˆ Token æµï¼Œ<a href="https://github.com/golang/go/blob/cdd2c265cc132a15e20298fbb083a70d7f3b495d/src/cmd/compile/internal/syntax/scanner.go#L641-L669"><code>cmd/compile/internal/syntax.scanner.stdString</code></a> æ–¹æ³•å°±æ˜¯å®ƒç”¨æ¥è§£æä½¿ç”¨åŒå¼•å·åŒ…è£¹çš„æ ‡å‡†å­—ç¬¦ä¸²ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *scanner)</span> <span class="title">stdString</span><span class="params">()</span></span> &#123;</span><br><span class="line">s.startLit()</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">r := s.getr()</span><br><span class="line"><span class="keyword">if</span> r == <span class="string">&#x27;&quot;&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r == <span class="string">&#x27;\\&#x27;</span> &#123;</span><br><span class="line">s.escape(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r == <span class="string">&#x27;\n&#x27;</span> &#123;</span><br><span class="line">s.ungetr()</span><br><span class="line">s.error(<span class="string">&quot;newline in string&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r &lt; <span class="number">0</span> &#123;</span><br><span class="line">s.errh(s.line, s.col, <span class="string">&quot;string not terminated&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">s.nlsemi = <span class="literal">true</span></span><br><span class="line">s.lit = <span class="keyword">string</span>(s.stopLit())</span><br><span class="line">s.kind = StringLit</span><br><span class="line">s.tok = _Literal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸ªæ–¹æ³•çš„å®ç°æˆ‘ä»¬èƒ½åˆ†æå‡º Go è¯­è¨€å¤„ç†æ ‡å‡†å­—ç¬¦ä¸²çš„é€»è¾‘ï¼š</p><ol><li>æ ‡å‡†å­—ç¬¦ä¸²ä½¿ç”¨åŒå¼•å·è¡¨ç¤ºå¼€å¤´å’Œç»“å°¾ï¼›</li><li>æ ‡å‡†å­—ç¬¦ä¸²ä¸­éœ€è¦ä½¿ç”¨åæ–œæ  <code>\</code> æ¥ <code>escape</code> åŒå¼•å·ï¼›</li><li>æ ‡å‡†å­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç°å¦‚ä¸‹æ‰€ç¤ºçš„éšå¼æ¢è¡Œç¬¦å· <code>\n</code>ï¼›</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str := <span class="string">&quot;start</span></span><br><span class="line"><span class="string">end&quot;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åå¼•å·å£°æ˜çš„åŸå§‹å­—ç¬¦ä¸²çš„è§£æè§„åˆ™å°±éå¸¸ç®€å•äº†ï¼Œ<a href="https://github.com/golang/go/blob/cdd2c265cc132a15e20298fbb083a70d7f3b495d/src/cmd/compile/internal/syntax/scanner.go#L671-L693"><code>cmd/compile/internal/syntax.scanner.rawString</code></a> ä¼šå°†éåå¼•å·çš„æ‰€æœ‰å­—ç¬¦éƒ½åˆ’åˆ†åˆ°å½“å‰å­—ç¬¦ä¸²çš„èŒƒå›´ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ”¯æŒå¤æ‚çš„å¤šè¡Œå­—ç¬¦ä¸²ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *scanner)</span> <span class="title">rawString</span><span class="params">()</span></span> &#123;</span><br><span class="line">s.startLit()</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">r := s.getr()</span><br><span class="line"><span class="keyword">if</span> r == <span class="string">&#x27;`&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r &lt; <span class="number">0</span> &#123;</span><br><span class="line">s.errh(s.line, s.col, <span class="string">&quot;string not terminated&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">s.nlsemi = <span class="literal">true</span></span><br><span class="line">s.lit = <span class="keyword">string</span>(s.stopLit())</span><br><span class="line">s.kind = StringLit</span><br><span class="line">s.tok = _Literal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— è®ºæ˜¯æ ‡å‡†å­—ç¬¦ä¸²è¿˜æ˜¯åŸå§‹å­—ç¬¦ä¸²æœ€ç»ˆéƒ½ä¼šè¢«æ ‡è®°æˆ <code>StringLit</code> ç±»å‹çš„ Token å¹¶ä¼ é€’åˆ°ç¼–è¯‘çš„ä¸‹ä¸€ä¸ªé˜¶æ®µ â€” <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/">è¯­æ³•åˆ†æ</a>ï¼Œåœ¨è¯­æ³•åˆ†æé˜¶æ®µï¼Œä¸å­—ç¬¦ä¸²ç›¸å…³çš„è¡¨è¾¾å¼éƒ½ä¼šä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³• <a href="https://github.com/golang/go/blob/b7d097a4cf6b8a9125e4770b54d33826fa803023/src/cmd/compile/internal/gc/noder.go#L1349-L1408"><code>cmd/compile/internal/gc.noder.basicLit</code></a> å¤„ç†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *noder)</span> <span class="title">basicLit</span><span class="params">(lit *syntax.BasicLit)</span> <span class="title">Val</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> s := lit.Value; lit.Kind &#123;</span><br><span class="line"><span class="keyword">case</span> syntax.StringLit:</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) &gt; <span class="number">0</span> &amp;&amp; s[<span class="number">0</span>] == <span class="string">&#x27;`&#x27;</span> &#123;</span><br><span class="line">s = strings.Replace(s, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line">u, _ := strconv.Unquote(s)</span><br><span class="line"><span class="keyword">return</span> Val&#123;U: u&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— è®ºæ˜¯ <code>import</code> è¯­å¥ä¸­åŒ…çš„è·¯å¾„ã€ç»“æ„ä½“ä¸­çš„å­—æ®µæ ‡ç­¾è¿˜æ˜¯è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦ä¸²éƒ½ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•å°†åŸç”Ÿå­—ç¬¦ä¸²ä¸­æœ€åçš„æ¢è¡Œç¬¦åˆ é™¤å¹¶å¯¹å­—ç¬¦ä¸² Token è¿›è¡Œ Unquoteï¼Œä¹Ÿå°±æ˜¯å»æ‰å­—ç¬¦ä¸²ä¸¤éçš„å¼•å·ç­‰æ— å…³å¹²æ‰°ï¼Œè¿˜åŸå…¶æœ¬æ¥çš„é¢ç›®ã€‚</p><p><code>strconv.Unquote</code> æ–¹æ³•å¤„ç†äº†å¾ˆå¤šè¾¹ç•Œæ¡ä»¶å¯¼è‡´æ•´ä¸ªå‡½æ•°éå¸¸å¤æ‚ï¼Œä¸ä»…åŒ…æ‹¬å„ç§ä¸åŒå¼•å·çš„å¤„ç†ï¼Œè¿˜åŒ…æ‹¬ UTF-8 ç­‰ç¼–ç çš„ç›¸å…³é—®é¢˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿå°±ä¸å±•å¼€ä»‹ç»äº†ã€‚</p><h2 id="æ‹¼æ¥"><a href="#æ‹¼æ¥" class="headerlink" title="æ‹¼æ¥"></a>æ‹¼æ¥</h2><p>Go è¯­è¨€æ‹¼æ¥å­—ç¬¦ä¸²ä¼šä½¿ç”¨ <code>+</code> ç¬¦å·ï¼Œç¼–è¯‘å™¨ä¼šå°†è¯¥ç¬¦å·å¯¹åº”çš„ <code>OADD</code> èŠ‚ç‚¹è½¬æ¢æˆ <code>OADDSTR</code> ç±»å‹çš„èŠ‚ç‚¹ï¼Œéšååœ¨ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L439-L1532"><code>cmd/compile/internal/gc.walkexpr</code></a> å‡½æ•°ä¸­è°ƒç”¨ <a href="https://github.com/golang/go/blob/bf4990522263503a1219372cd8f1ee9422b51324/src/cmd/compile/internal/gc/walk.go#L2528-L2586"><code>cmd/compile/internal/gc.addstr</code></a> å‡½æ•°ç”Ÿæˆç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²çš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walkexpr</span><span class="params">(n *Node, init *Nodes)</span> *<span class="title">Node</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">case</span> OADDSTR:</span><br><span class="line">n = addstr(n, init)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/golang/go/blob/bf4990522263503a1219372cd8f1ee9422b51324/src/cmd/compile/internal/gc/walk.go#L2528-L2586"><code>cmd/compile/internal/gc.addstr</code></a> å‡½æ•°èƒ½å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–è¯‘æœŸé—´é€‰æ‹©åˆé€‚çš„å‡½æ•°å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œå¦‚æœéœ€è¦æ‹¼æ¥çš„å­—ç¬¦ä¸²å°äºæˆ–è€…ç­‰äº 5 ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è°ƒç”¨ <code>concatstring&#123;2,3,4,5&#125;</code> ç­‰ä¸€ç³»åˆ—å‡½æ•°ï¼Œå¦‚æœè¶…è¿‡ 5 ä¸ªå°±ä¼šç›´æ¥é€‰æ‹© <a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L23-L55"><code>runtime.concatstrings</code></a> ä¼ å…¥ä¸€ä¸ªæ•°ç»„åˆ‡ç‰‡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addstr</span><span class="params">(n *Node, init *Nodes)</span> *<span class="title">Node</span></span> &#123;</span><br><span class="line">c := n.List.Len()</span><br><span class="line"></span><br><span class="line">buf := nodnil()</span><br><span class="line">args := []*Node&#123;buf&#125;</span><br><span class="line"><span class="keyword">for</span> _, n2 := <span class="keyword">range</span> n.List.Slice() &#123;</span><br><span class="line">args = <span class="built_in">append</span>(args, conv(n2, types.Types[TSTRING]))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn <span class="keyword">string</span></span><br><span class="line"><span class="keyword">if</span> c &lt;= <span class="number">5</span> &#123;</span><br><span class="line">fn = fmt.Sprintf(<span class="string">&quot;concatstring%d&quot;</span>, c)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fn = <span class="string">&quot;concatstrings&quot;</span></span><br><span class="line"></span><br><span class="line">t := types.NewSlice(types.Types[TSTRING])</span><br><span class="line">slice := nod(OCOMPLIT, <span class="literal">nil</span>, typenod(t))</span><br><span class="line">slice.List.Set(args[<span class="number">1</span>:])</span><br><span class="line">args = []*Node&#123;buf, slice&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cat := syslook(fn)</span><br><span class="line">r := nod(OCALL, cat, <span class="literal">nil</span>)</span><br><span class="line">r.List.Set(args)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®æ— è®ºä½¿ç”¨ <code>concatstring&#123;2,3,4,5&#125;</code> ä¸­çš„å“ªä¸€ä¸ªï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L23-L55"><code>runtime.concatstrings</code></a>ï¼Œè¯¥å‡½æ•°ä¼šå…ˆå¯¹ä¼ å…¥çš„åˆ‡ç‰‡å‚æ•°è¿›è¡Œéå†ï¼Œå…ˆè¿‡æ»¤ç©ºå­—ç¬¦ä¸²å¹¶è®¡ç®—æ‹¼æ¥åå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">concatstrings</span><span class="params">(buf *tmpBuf, a []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">idx := <span class="number">0</span></span><br><span class="line">l := <span class="number">0</span></span><br><span class="line">count := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i, x := <span class="keyword">range</span> a &#123;</span><br><span class="line">n := <span class="built_in">len</span>(x)</span><br><span class="line"><span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">l += n</span><br><span class="line">count++</span><br><span class="line">idx = i</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> count == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> count == <span class="number">1</span> &amp;&amp; (buf != <span class="literal">nil</span> || !stringDataOnStack(a[idx])) &#123;</span><br><span class="line"><span class="keyword">return</span> a[idx]</span><br><span class="line">&#125;</span><br><span class="line">s, b := rawstringtmp(buf, l)</span><br><span class="line"><span class="keyword">for</span> _, x := <span class="keyword">range</span> a &#123;</span><br><span class="line"><span class="built_in">copy</span>(b, x)</span><br><span class="line">b = b[<span class="built_in">len</span>(x):]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéç©ºå­—ç¬¦ä¸²çš„æ•°é‡ä¸º 1 å¹¶ä¸”å½“å‰çš„å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Šå°±å¯ä»¥ç›´æ¥è¿”å›è¯¥å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦è¿›è¡Œé¢å¤–çš„ä»»ä½•æ“ä½œã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/vroRD3qW15dKuHh.png" alt="string-concat-and-copy"></p><p>ä½†æ˜¯åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶ä¼šè°ƒç”¨ <code>copy</code> å°†è¾“å…¥çš„å¤šä¸ªå­—ç¬¦ä¸²æ‹·è´åˆ°ç›®æ ‡å­—ç¬¦ä¸²æ‰€åœ¨çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ–°çš„å­—ç¬¦ä¸²æ˜¯ä¸€ç‰‡æ–°çš„å†…å­˜ç©ºé—´ï¼Œä¸åŸæ¥çš„å­—ç¬¦ä¸²ä¹Ÿæ²¡æœ‰ä»»ä½•å…³è”ï¼Œ<strong>ä¸€æ—¦éœ€è¦æ‹¼æ¥çš„å­—ç¬¦ä¸²éå¸¸å¤§ï¼Œæ‹·è´å¸¦æ¥çš„æ€§èƒ½æŸå¤±å°±æ˜¯æ— æ³•å¿½ç•¥çš„</strong>ã€‚</p><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨ Go è¯­è¨€è§£æå’Œåºåˆ—åŒ– JSON ç­‰æ•°æ®æ ¼å¼æ—¶ï¼Œç»å¸¸éœ€è¦å°†æ•°æ®åœ¨ <code>string</code> å’Œ <code>[]byte</code> ä¹‹é—´æ¥å›è½¬æ¢ï¼Œç±»å‹è½¬æ¢çš„å¼€é”€å¹¶æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆå°ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ° <a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L75-L108"><code>runtime.slicebytetostring</code></a> ç­‰å‡½æ•°å‡ºç°åœ¨ç«ç„°å›¾ä¸­ï¼Œæˆä¸ºç¨‹åºçš„æ€§èƒ½çƒ­ç‚¹ã€‚</p><p>ä»å­—èŠ‚æ•°ç»„åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢å°±éœ€è¦ä½¿ç”¨ <a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L75-L108"><code>runtime.slicebytetostring</code></a> å‡½æ•°ï¼Œä¾‹å¦‚ï¼š<code>string(bytes)</code>ï¼Œè¯¥å‡½æ•°åœ¨å‡½æ•°ä½“ä¸­ä¼šå…ˆå¤„ç†ä¸¤ç§æ¯”è¾ƒå¸¸è§çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚æ•°ç»„çš„é•¿åº¦ä¸º 0 æˆ–è€… 1ï¼Œè¿™ä¸¤ä¸ªæƒ…å†µå¤„ç†èµ·æ¥éƒ½éå¸¸ç®€å•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slicebytetostring</span><span class="params">(buf *tmpBuf, b []<span class="keyword">byte</span>)</span> <span class="params">(str <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">l := <span class="built_in">len</span>(b)</span><br><span class="line"><span class="keyword">if</span> l == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> l == <span class="number">1</span> &#123;</span><br><span class="line">stringStructOf(&amp;str).str = unsafe.Pointer(&amp;staticbytes[b[<span class="number">0</span>]])</span><br><span class="line">stringStructOf(&amp;str).<span class="built_in">len</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p unsafe.Pointer</span><br><span class="line"><span class="keyword">if</span> buf != <span class="literal">nil</span> &amp;&amp; <span class="built_in">len</span>(b) &lt;= <span class="built_in">len</span>(buf) &#123;</span><br><span class="line">p = unsafe.Pointer(buf)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p = mallocgc(<span class="keyword">uintptr</span>(<span class="built_in">len</span>(b)), <span class="literal">nil</span>, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line">stringStructOf(&amp;str).str = p</span><br><span class="line">stringStructOf(&amp;str).<span class="built_in">len</span> = <span class="built_in">len</span>(b)</span><br><span class="line">memmove(p, (*(*slice)(unsafe.Pointer(&amp;b))).array, <span class="keyword">uintptr</span>(<span class="built_in">len</span>(b)))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤„ç†è¿‡åä¼šæ ¹æ®ä¼ å…¥çš„ç¼“å†²åŒºå¤§å°å†³å®šæ˜¯å¦éœ€è¦ä¸ºæ–°çš„å­—ç¬¦ä¸²åˆ†é…ä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œ<a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L229-L231"><code>runtime.stringStructOf</code></a> ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²æŒ‡é’ˆè½¬æ¢æˆ <code>stringStruct</code> ç»“æ„ä½“æŒ‡é’ˆï¼Œç„¶åè®¾ç½®ç»“æ„ä½“æŒæœ‰çš„å­—ç¬¦ä¸²æŒ‡é’ˆ <code>str</code> å’Œé•¿åº¦ <code>len</code>ï¼Œæœ€åé€šè¿‡ <code>memmove</code> å°†åŸ <code>[]byte</code> ä¸­çš„å­—èŠ‚å…¨éƒ¨å¤åˆ¶åˆ°æ–°çš„å†…å­˜ç©ºé—´ä¸­ã€‚</p><p>å½“æˆ‘ä»¬æƒ³è¦å°†å­—ç¬¦ä¸²è½¬æ¢æˆ <code>[]byte</code> ç±»å‹æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ <a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L155-L165"><code>runtime.stringtoslicebyte</code></a> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å®ç°éå¸¸å®¹æ˜“ç†è§£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stringtoslicebyte</span><span class="params">(buf *tmpBuf, s <span class="keyword">string</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> b []<span class="keyword">byte</span></span><br><span class="line"><span class="keyword">if</span> buf != <span class="literal">nil</span> &amp;&amp; <span class="built_in">len</span>(s) &lt;= <span class="built_in">len</span>(buf) &#123;</span><br><span class="line">*buf = tmpBuf&#123;&#125;</span><br><span class="line">b = buf[:<span class="built_in">len</span>(s)]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">b = rawbyteslice(<span class="built_in">len</span>(s))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">copy</span>(b, s)</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‘è¯¥å‡½æ•°ä¼ å…¥äº†ç¼“å†²åŒºï¼Œé‚£ä¹ˆå®ƒä¼šä½¿ç”¨ä¼ å…¥çš„ç¼“å†²åŒºå­˜å‚¨ <code>[]byte</code>ï¼Œæ²¡æœ‰ä¼ å…¥ç¼“å†²åŒºæ—¶ï¼Œè¿è¡Œæ—¶ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/8174f7fb2b64c221f7f80c9f7fd4d7eb317ac8bb/src/runtime/string.go#L270-L279"><code>runtime.rawbyteslice</code></a> åˆ›å»ºä¸€ä¸ªæ–°çš„å­—èŠ‚åˆ‡ç‰‡ï¼Œ<code>copy</code> å°±ä¼šå°†å­—ç¬¦ä¸²ä¸­çš„å†…å®¹æ‹·è´åˆ°æ–°çš„ <code>[]byte</code> ä¸­ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/DVsZNaPgfWS75dX.png" alt="string-bytes-conversion"></p><p>å­—ç¬¦ä¸²å’Œ <code>[]byte</code> ä¸­çš„å†…å®¹è™½ç„¶ä¸€æ ·ï¼Œä½†æ˜¯å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯åªè¯»çš„ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡ä¸‹æ ‡æˆ–è€…å…¶ä»–å½¢å¼æ”¹å˜å…¶ä¸­çš„æ•°æ®ï¼Œè€Œ <code>[]byte</code> ä¸­çš„å†…å®¹æ˜¯å¯ä»¥è¯»å†™çš„ï¼Œæ— è®ºä»å“ªç§ç±»å‹è½¬æ¢åˆ°å¦ä¸€ç§éƒ½éœ€è¦å¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œæ‹·è´ï¼Œè€Œå†…å­˜æ‹·è´çš„æ€§èƒ½æŸè€—ä¼šéšç€å­—ç¬¦ä¸²å’Œ <code>[]byte</code> é•¿åº¦çš„å¢é•¿è€Œå¢é•¿ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å­—ç¬¦ä¸²æ˜¯ Go è¯­è¨€ä¸­ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­è¯¦ç»†åˆ†æäº†å­—ç¬¦ä¸²ä¸ <code>[]byte</code> ç±»å‹çš„å…³ç³»ï¼Œä»è¯æ³•åˆ†æé˜¶æ®µç†è§£å­—ç¬¦ä¸²æ˜¯å¦‚ä½•è¢«è§£æçš„ï¼Œä½œä¸ºåªè¯»çš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬æ— æ³•æ”¹å˜å…¶æœ¬èº«çš„ç»“æ„ï¼Œä½†æ˜¯åœ¨åšæ‹¼æ¥å’Œç±»å‹è½¬æ¢ç­‰æ“ä½œæ—¶æ—¶ä¸€å®šè¦æ³¨æ„æ€§èƒ½çš„æŸè€—ï¼Œé‡åˆ°éœ€è¦æè‡´æ€§èƒ½çš„åœºæ™¯ä¸€å®šè¦å°½é‡å‡å°‘ç±»å‹è½¬æ¢çš„æ¬¡æ•°ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://go101.org/article/string.html">Strings in Go</a></li><li><a href="https://blog.golang.org/strings">Strings, bytes, runes and characters in Go</a></li><li><a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8 Â· Wikipedia</a></li><li><a href="https://stackoverflow.com/questions/29255746/how-encode-rune-into-byte-using-utf8-in-golang">How encode []rune into []byte using utf8 in golang?</a></li><li><a href="https://golang.org/ref/spec#Conversions_to_and_from_a_string_type">Conversions to and from a string type</a></li><li><a href="http://cenalulu.github.io/linux/character-encoding/">ååˆ†é’Ÿææ¸…å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç </a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€æ•°ç»„ä¸åˆ‡ç‰‡</title>
      <link href="/2020/01/05/go/Go%E8%AF%AD%E8%A8%80%E6%95%B0%E7%BB%84%E4%B8%8E%E5%88%87%E7%89%87/"/>
      <url>/2020/01/05/go/Go%E8%AF%AD%E8%A8%80%E6%95%B0%E7%BB%84%E4%B8%8E%E5%88%87%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>åˆå­¦Goï¼Œå¯¹äºæ•°ç»„ä¸åˆ‡ç‰‡å¾€å¾€ç†è§£ä¸æ¸…ï¼Œåœ¨Pythonä¸­ï¼Œåªæœ‰Listè¿™ç§æ•°æ®ç»“æ„ï¼Œåªæœ‰åˆ‡ç‰‡ï¼Œè€Œåœ¨Goä¸­ï¼Œä½œä¸ºä¸€ç§ç¼–è¯‘æ€§è¯­è¨€ï¼Œæ•°ç»„ä¸åˆ‡ç‰‡åœ¨åº•å±‚åŸç†ä¸Šæœ‰æ‰€åŒºåˆ«ï¼Œåœ¨æ­¤éœ€è¦ç»“åˆç¼–è¯‘è¿è¡Œæ—¶æ¥ä»‹ç»å®ƒä»¬çš„å®ç°åŸç†ã€‚</p><a id="more"></a><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><h3 id="æ•°ç»„çš„æ•°æ®ç»“æ„ä¸åˆ›å»º"><a href="#æ•°ç»„çš„æ•°æ®ç»“æ„ä¸åˆ›å»º" class="headerlink" title="æ•°ç»„çš„æ•°æ®ç»“æ„ä¸åˆ›å»º"></a>æ•°ç»„çš„æ•°æ®ç»“æ„ä¸åˆ›å»º</h3><p>æ•°ç»„æ˜¯ç”±ç›¸åŒç±»å‹å…ƒç´ çš„é›†åˆç»„æˆçš„æ•°æ®ç»“æ„ï¼Œ<strong>è®¡ç®—æœºä¼šä¸ºæ•°ç»„åˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜æ¥ä¿å­˜å…¶ä¸­çš„å…ƒç´ </strong>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„ä¸­å…ƒç´ çš„ç´¢å¼•å¿«é€Ÿè®¿é—®å…ƒç´ å¯¹åº”çš„å­˜å‚¨åœ°å€ï¼Œå¸¸è§çš„æ•°ç»„å¤§å¤šéƒ½æ˜¯ä¸€ç»´çš„çº¿æ€§æ•°ç»„ï¼Œè€Œå¤šç»´æ•°ç»„åœ¨æ•°å€¼å’Œå›¾å½¢è®¡ç®—é¢†åŸŸå´æœ‰æ¯”è¾ƒå¸¸è§çš„åº”ç”¨ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/QoATkRlvJutEDmx.jpg" alt="2019-02-20-3D-array"></p><p>æ•°ç»„ä½œä¸ºä¸€ç§åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä¼šä»ä¸¤ä¸ªç»´åº¦æè¿°æ•°ç»„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æè¿°æ•°ç»„ä¸­å­˜å‚¨çš„å…ƒç´ ç±»å‹ï¼Œè¿˜éœ€è¦æè¿°æ•°ç»„æœ€å¤§èƒ½å¤Ÿå­˜å‚¨çš„å…ƒç´ ä¸ªæ•°ï¼Œåœ¨ Go è¯­è¨€ä¸­æˆ‘ä»¬å¾€å¾€ä¼šä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„æ–¹å¼æ¥è¡¨ç¤ºæ•°ç»„ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line">[<span class="number">200</span>]<span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¾ˆå¤šè¯­è¨€ä¸åŒï¼ŒGo è¯­è¨€ä¸­æ•°ç»„åœ¨åˆå§‹åŒ–ä¹‹åå¤§å°å°±æ— æ³•æ”¹å˜ï¼Œå­˜å‚¨å…ƒç´ ç±»å‹ç›¸åŒã€ä½†æ˜¯å¤§å°ä¸åŒçš„æ•°ç»„ç±»å‹åœ¨ Go è¯­è¨€çœ‹æ¥ä¹Ÿæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œåªæœ‰ä¸¤ä¸ªæ¡ä»¶éƒ½ç›¸åŒæ‰æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewArray</span><span class="params">(elem *Type, bound <span class="keyword">int64</span>)</span> *<span class="title">Type</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> bound &lt; <span class="number">0</span> &#123;</span><br><span class="line">Fatalf(<span class="string">&quot;NewArray: invalid bound %v&quot;</span>, bound)</span><br><span class="line">&#125;</span><br><span class="line">t := New(TARRAY)</span><br><span class="line">t.Extra = &amp;Array&#123;Elem: elem, Bound: bound&#125;</span><br><span class="line">t.SetNotInHeap(elem.NotInHeap())</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æœŸé—´çš„æ•°ç»„ç±»å‹æ˜¯ç”±ä¸Šè¿°çš„ <a href="https://github.com/golang/go/blob/616c39f6a636166447bdaac4f0871a5ca52bae8c/src/cmd/compile/internal/types/type.go#L473-L481"><code>cmd/compile/internal/types.NewArray</code></a> å‡½æ•°ç”Ÿæˆçš„ï¼Œç±»å‹ <code>Array</code> åŒ…å«ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯å…ƒç´ ç±»å‹ <code>Elem</code>ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°ç»„çš„å¤§å° <code>Bound</code>ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå…±åŒæ„æˆäº†æ•°ç»„ç±»å‹ï¼Œè€Œå½“å‰æ•°ç»„æ˜¯å¦åº”è¯¥åœ¨å †æ ˆä¸­åˆå§‹åŒ–ä¹Ÿåœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†ã€‚</p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>Go è¯­è¨€ä¸­çš„æ•°ç»„æœ‰ä¸¤ç§ä¸åŒçš„åˆ›å»ºæ–¹å¼ï¼Œä¸€ç§æ˜¯æ˜¾å¼çš„æŒ‡å®šæ•°ç»„çš„å¤§å°ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ <code>[...]T</code> å£°æ˜æ•°ç»„ï¼ŒGo è¯­è¨€ä¼šåœ¨ç¼–è¯‘æœŸé—´é€šè¿‡æºä»£ç å¯¹æ•°ç»„çš„å¤§å°è¿›è¡Œæ¨æ–­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr1 := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">arr2 := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ç§å£°æ˜æ–¹å¼åœ¨è¿è¡ŒæœŸé—´å¾—åˆ°çš„ç»“æœæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œåä¸€ç§å£°æ˜æ–¹å¼åœ¨ç¼–è¯‘æœŸé—´å°±ä¼šè¢«ã€è½¬æ¢ã€æˆä¸ºå‰ä¸€ç§ï¼Œè¿™ä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨å¯¹æ•°ç»„å¤§å°çš„æ¨å¯¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ç¼–è¯‘å™¨çš„æ¨å¯¼è¿‡ç¨‹ã€‚</p><h4 id="ä¸Šé™æ¨å¯¼"><a href="#ä¸Šé™æ¨å¯¼" class="headerlink" title="ä¸Šé™æ¨å¯¼"></a>ä¸Šé™æ¨å¯¼</h4><p>ä¸¤ç§ä¸åŒçš„å£°æ˜æ–¹å¼ä¼šå¯¼è‡´ç¼–è¯‘å™¨åšå‡ºå®Œå…¨ä¸åŒçš„å¤„ç†ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ <code>[10]T</code>ï¼Œé‚£ä¹ˆå˜é‡çš„ç±»å‹åœ¨ç¼–è¯‘è¿›è¡Œåˆ°ç±»å‹æ£€æŸ¥é˜¶æ®µæ®µå°±ä¼šè¢«æå–å‡ºæ¥ï¼Œéšåä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/616c39f6a636166447bdaac4f0871a5ca52bae8c/src/cmd/compile/internal/types/type.go#L473-L481"><code>cmd/compile/internal/types.NewArray</code></a> å‡½æ•°åˆ›å»ºåŒ…å«æ•°ç»„å¤§å°çš„ <code>Array</code> ç±»å‹ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>[...]T</code> çš„æ–¹å¼å£°æ˜æ•°ç»„æ—¶ï¼Œè™½ç„¶åœ¨è¿™ä¸€æ­¥ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ª <code>Array</code> ç±»å‹ <code>Array&#123;Elem: elem, Bound: -1&#125;</code>ï¼Œä½†æ˜¯å…¶ä¸­çš„æ•°ç»„å¤§å°ä¸Šé™ä¼šæ˜¯ <code>-1</code>ï¼Œè¿™é‡Œçš„ <code>-1</code> åªæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šåœ¨åé¢çš„ <a href="https://github.com/golang/go/blob/b7d097a4cf6b8a9125e4770b54d33826fa803023/src/cmd/compile/internal/gc/typecheck.go#L2755-L2961"><code>cmd/compile/internal/gc.typecheckcomplit</code></a> å‡½æ•°ä¸­å¯¹è¯¥æ•°ç»„çš„å¤§å°è¿›è¡Œæ¨å¯¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typecheckcomplit</span><span class="params">(n *Node)</span> <span class="params">(res *Node)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> t.Etype &#123;</span><br><span class="line"><span class="keyword">case</span> TARRAY, TSLICE:</span><br><span class="line"><span class="keyword">var</span> length, i <span class="keyword">int64</span></span><br><span class="line">nl := n.List.Slice()</span><br><span class="line"><span class="keyword">for</span> i2, l := <span class="keyword">range</span> nl &#123;</span><br><span class="line">i++</span><br><span class="line"><span class="keyword">if</span> i &gt; length &#123;</span><br><span class="line">length = i</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> t.IsDDDArray() &#123;</span><br><span class="line">t.SetNumElem(length)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåˆ å‡åçš„ <a href="https://github.com/golang/go/blob/b7d097a4cf6b8a9125e4770b54d33826fa803023/src/cmd/compile/internal/gc/typecheck.go#L2755-L2961"><code>cmd/compile/internal/gc.typecheckcomplit</code></a> å‡½æ•°é€šè¿‡éå†å…ƒç´ çš„æ–¹å¼æ¥è®¡ç®—æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ã€‚ä¸Šè¿°ä»£ç ä¸­çš„ <code>DDDArray</code> æŒ‡çš„å°±æ˜¯ä½¿ç”¨ <code>[...]T</code> å£°æ˜çš„æ•°ç»„ï¼Œå› ä¸ºå£°æ˜è¿™ç§æ•°ç»„æ—¶éœ€è¦ä½¿ç”¨ä¸‰ä¸ªç‚¹ï¼ˆDotï¼‰ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘å™¨ä¸­å°±è¢«ç§°ä½œ <code>DDDArray</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹å‡º <code>[...]T&#123;1, 2, 3&#125;</code> å’Œ <code>[3]T&#123;1, 2, 3&#125;</code> åœ¨è¿è¡Œæ—¶æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œ<code>[...]T</code> è¿™ç§åˆå§‹åŒ–æ–¹å¼ä¹Ÿåªæ˜¯ Go è¯­è¨€ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ç§è¯­æ³•ç³–ï¼Œå½“æˆ‘ä»¬ä¸æƒ³è®¡ç®—æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°æ—¶å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•è¾ƒå°‘ä¸€äº›å·¥ä½œã€‚</p><h4 id="è¯­å¥è½¬æ¢"><a href="#è¯­å¥è½¬æ¢" class="headerlink" title="è¯­å¥è½¬æ¢"></a>è¯­å¥è½¬æ¢</h4><p>å¯¹äºä¸€ä¸ªç”±å­—é¢é‡ç»„æˆçš„æ•°ç»„ï¼Œæ ¹æ®æ•°ç»„å…ƒç´ æ•°é‡çš„ä¸åŒï¼Œç¼–è¯‘å™¨ä¼šåœ¨è´Ÿè´£åˆå§‹åŒ–å­—é¢é‡çš„ <a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L875-L967"><code>cmd/compile/internal/gc.anylit</code></a> å‡½æ•°ä¸­åšä¸¤ç§ä¸åŒçš„ä¼˜åŒ–ï¼š</p><ol><li>å½“å…ƒç´ æ•°é‡å°äºæˆ–è€…ç­‰äº 4 ä¸ªæ—¶ï¼Œä¼šç›´æ¥å°†æ•°ç»„ä¸­çš„å…ƒç´ æ”¾ç½®åœ¨æ ˆä¸Šï¼›</li><li>å½“å…ƒç´ æ•°é‡å¤§äº 4 ä¸ªæ—¶ï¼Œä¼šå°†æ•°ç»„ä¸­çš„å…ƒç´ æ”¾ç½®åˆ°é™æ€åŒºå¹¶åœ¨è¿è¡Œæ—¶å–å‡ºï¼›</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anylit</span><span class="params">(n *Node, var_ *Node, init *Nodes)</span></span> &#123;</span><br><span class="line">t := n.Type</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line"><span class="keyword">case</span> OSTRUCTLIT, OARRAYLIT:</span><br><span class="line"><span class="keyword">if</span> n.List.Len() &gt; <span class="number">4</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fixedlit(inInitFunction, initKindLocalCode, n, var_, init)</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ•°ç»„çš„å…ƒç´ <strong>å°äºæˆ–è€…ç­‰äºå››ä¸ª</strong>æ—¶ï¼Œ<a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L515-L583"><code>cmd/compile/internal/gc.fixedlit</code></a> ä¼šè´Ÿè´£åœ¨å‡½æ•°ç¼–è¯‘ä¹‹å‰å°† <code>[3]&#123;1, 2, 3&#125;</code> è½¬æ¢æˆæ›´åŠ åŸå§‹çš„è¯­å¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fixedlit</span><span class="params">(ctxt initContext, kind initKind, n *Node, var_ *Node, init *Nodes)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> splitnode <span class="function"><span class="keyword">func</span><span class="params">(*Node)</span> <span class="params">(a *Node, value *Node)</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, r := <span class="keyword">range</span> n.List.Slice() &#123;</span><br><span class="line">a, value := splitnode(r)</span><br><span class="line">a = nod(OAS, a, value)</span><br><span class="line">a = typecheck(a, ctxStmt)</span><br><span class="line"><span class="keyword">switch</span> kind &#123;</span><br><span class="line"><span class="keyword">case</span> initKindStatic:</span><br><span class="line">genAsStatic(a)</span><br><span class="line"><span class="keyword">case</span> initKindLocalCode:</span><br><span class="line">a = orderStmtInPlace(a, <span class="keyword">map</span>[<span class="keyword">string</span>][]*Node&#123;&#125;)</span><br><span class="line">a = walkstmt(a)</span><br><span class="line">init.Append(a)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°å°äºå››ä¸ªæ—¶ï¼Œ<a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L515-L583"><code>cmd/compile/internal/gc.fixedlit</code></a> å‡½æ•°æ¥å—çš„ <code>kind</code> æ˜¯ <code>initKindLocalCode</code>ï¼Œä¸Šè¿°ä»£ç ä¼šå°†åŸæœ‰çš„åˆå§‹åŒ–è¯­å¥ <code>[3]int&#123;1, 2, 3&#125;</code> æ‹†åˆ†æˆä¸€ä¸ªå£°æ˜å˜é‡çš„è¡¨è¾¾å¼å’Œå‡ ä¸ªèµ‹å€¼è¡¨è¾¾å¼ï¼Œè¿™äº›è¡¨è¾¾å¼ä¼šå®Œæˆå¯¹æ•°ç»„çš„åˆå§‹åŒ–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">3</span>]<span class="keyword">int</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">arr[<span class="number">2</span>] = <span class="number">3</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå½“å‰æ•°ç»„çš„å…ƒç´ å¤§äº 4 ä¸ªï¼Œ<code>anylit</code> æ–¹æ³•ä¼šå…ˆè·å–ä¸€ä¸ªå”¯ä¸€çš„ <code>staticname</code>ï¼Œç„¶åè°ƒç”¨ <a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L515-L583"><code>cmd/compile/internal/gc.fixedlit</code></a> å‡½æ•°åœ¨é™æ€å­˜å‚¨åŒºåˆå§‹åŒ–æ•°ç»„ä¸­çš„å…ƒç´ å¹¶å°†ä¸´æ—¶å˜é‡èµ‹å€¼ç»™å½“å‰çš„æ•°ç»„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anylit</span><span class="params">(n *Node, var_ *Node, init *Nodes)</span></span> &#123;</span><br><span class="line">t := n.Type</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line"><span class="keyword">case</span> OSTRUCTLIT, OARRAYLIT:</span><br><span class="line"><span class="keyword">if</span> n.List.Len() &gt; <span class="number">4</span> &#123;</span><br><span class="line">vstat := staticname(t)</span><br><span class="line">vstat.Name.SetReadonly(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">fixedlit(inNonInitFunction, initKindStatic, n, vstat, init)</span><br><span class="line"></span><br><span class="line">a := nod(OAS, var_, vstat)</span><br><span class="line">a = typecheck(a, ctxStmt)</span><br><span class="line">a = walkexpr(a, init)</span><br><span class="line">init.Append(a)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬åœ¨ä»£ç ä¸­åˆå§‹åŒ– <code>[5]int&#123;1, 2, 3, 4, 5&#125;</code> æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°è¿‡ç¨‹ç†è§£æˆä»¥ä¸‹çš„ä¼ªä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line">statictmp_0[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">statictmp_0[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">statictmp_0[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">statictmp_0[<span class="number">3</span>] = <span class="number">4</span></span><br><span class="line">statictmp_0[<span class="number">4</span>] = <span class="number">5</span></span><br><span class="line">arr = statictmp_0</span><br></pre></td></tr></table></figure><p>æ€»ç»“èµ·æ¥ï¼Œå¦‚æœæ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°å°äºæˆ–è€…ç­‰äº 4 ä¸ªï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å˜é‡ä¼šç›´æ¥åœ¨æ ˆä¸Šåˆå§‹åŒ–ï¼Œå¦‚æœæ•°ç»„å…ƒç´ å¤§äº 4 ä¸ªï¼Œå˜é‡å°±ä¼šåœ¨é™æ€å­˜å‚¨åŒºåˆå§‹åŒ–ç„¶åæ‹·è´åˆ°æ ˆä¸Šï¼Œè¿™äº›è½¬æ¢åçš„ä»£ç æ‰ä¼šç»§ç»­è¿›å…¥<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-ir-ssa/">ä¸­é—´ä»£ç ç”Ÿæˆ</a>å’Œ<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-machinecode/">æœºå™¨ç ç”Ÿæˆ</a>ä¸¤ä¸ªé˜¶æ®µï¼Œæœ€åç”Ÿæˆå¯ä»¥æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><h3 id="è®¿é—®å’Œèµ‹å€¼"><a href="#è®¿é—®å’Œèµ‹å€¼" class="headerlink" title="è®¿é—®å’Œèµ‹å€¼"></a>è®¿é—®å’Œèµ‹å€¼</h3><p>æ— è®ºæ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯é™æ€å­˜å‚¨åŒºï¼Œæ•°ç»„åœ¨å†…å­˜ä¸­å…¶å®å°±æ˜¯ä¸€è¿ä¸²çš„å†…å­˜ç©ºé—´ï¼Œè¡¨ç¤ºæ•°ç»„çš„æ–¹æ³•å°±æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„å¼€å¤´çš„æŒ‡é’ˆã€æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ä»¥åŠæ•°ç»„ä¸­å…ƒç´ ç±»å‹å çš„ç©ºé—´å¤§å°ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ï¼Œè®¿é—®æ—¶å°±å¯èƒ½å‘ç”Ÿè¶Šç•Œï¼Œè€Œå¦‚æœä¸çŸ¥é“æ•°ç»„ä¸­å…ƒç´ ç±»å‹çš„å¤§å°ï¼Œå°±æ²¡æœ‰åŠæ³•çŸ¥é“åº”è¯¥ä¸€æ¬¡å–å‡ºå¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±æ— æ³•çŸ¥é“è¿™ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´åˆ°åº•å­˜å‚¨äº†ä»€ä¹ˆæ•°æ®ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/5dHu9LZRQck3EKS.png" alt="golang-array-memory"></p><p>æ•°ç»„è®¿é—®è¶Šç•Œæ˜¯éå¸¸ä¸¥é‡çš„é”™è¯¯ï¼ŒGo è¯­è¨€ä¸­å¯¹è¶Šç•Œçš„åˆ¤æ–­æ˜¯å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´ç”±é™æ€ç±»å‹æ£€æŸ¥å®Œæˆçš„ï¼Œ<a href="https://github.com/golang/go/blob/b7d097a4cf6b8a9125e4770b54d33826fa803023/src/cmd/compile/internal/gc/typecheck.go#L327-L2081"><code>cmd/compile/internal/gc.typecheck1</code></a> å‡½æ•°ä¼šå¯¹è®¿é—®æ•°ç»„çš„ç´¢å¼•è¿›è¡ŒéªŒè¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typecheck1</span><span class="params">(n *Node, top <span class="keyword">int</span>)</span> <span class="params">(res *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line"><span class="keyword">case</span> OINDEX:</span><br><span class="line">ok |= ctxExpr</span><br><span class="line">l := n.Left  <span class="comment">// array</span></span><br><span class="line">r := n.Right <span class="comment">// index</span></span><br><span class="line"><span class="keyword">switch</span> n.Left.Type.Etype &#123;</span><br><span class="line"><span class="keyword">case</span> TSTRING, TARRAY, TSLICE:</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> n.Right.Type != <span class="literal">nil</span> &amp;&amp; !n.Right.Type.IsInteger() &#123;</span><br><span class="line">yyerror(<span class="string">&quot;non-integer array index %v&quot;</span>, n.Right)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !n.Bounded() &amp;&amp; Isconst(n.Right, CTINT) &#123;</span><br><span class="line">x := n.Right.Int64()</span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line">yyerror(<span class="string">&quot;invalid array index %v (index must be non-negative)&quot;</span>, n.Right)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> n.Left.Type.IsArray() &amp;&amp; x &gt;= n.Left.Type.NumElem() &#123;</span><br><span class="line">yyerror(<span class="string">&quot;invalid array index %v (out of bounds for %d-element array)&quot;</span>, n.Right, n.Left.Type.NumElem())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è®¿é—®æ•°ç»„çš„ç´¢å¼•æ˜¯éæ•´æ•°æ—¶ä¼šç›´æ¥æŠ¥é”™ â€”â€” <code>non-integer array index %v</code>ï¼›</li><li>è®¿é—®æ•°ç»„çš„ç´¢å¼•æ˜¯è´Ÿæ•°æ—¶ä¼šç›´æ¥æŠ¥é”™ â€”â€” <code>&quot;invalid array index %v (index must be non-negative)&quot;</code>ï¼›</li><li>è®¿é—®æ•°ç»„çš„ç´¢å¼•è¶Šç•Œæ—¶ä¼šç›´æ¥æŠ¥é”™ â€”â€” <code>&quot;invalid array index %v (out of bounds for %d-element array)&quot;</code>ï¼›</li></ol><p>æ•°ç»„å’Œå­—ç¬¦ä¸²çš„ä¸€äº›ç®€å•è¶Šç•Œé”™è¯¯éƒ½ä¼šåœ¨ç¼–è¯‘æœŸé—´å‘ç°ï¼Œæ¯”å¦‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ•´æ•°æˆ–è€…å¸¸é‡è®¿é—®æ•°ç»„ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨å˜é‡å»è®¿é—®æ•°ç»„æˆ–è€…å­—ç¬¦ä¸²æ—¶ï¼Œç¼–è¯‘å™¨å°±æ— æ³•å‘ç°å¯¹åº”çš„é”™è¯¯äº†ï¼Œè¿™æ—¶å°±éœ€è¦ Go è¯­è¨€è¿è¡Œæ—¶å‘æŒ¥ä½œç”¨äº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr[<span class="number">4</span>]: invalid array index <span class="number">4</span> (out of bounds <span class="keyword">for</span> <span class="number">3</span>-element array)</span><br><span class="line">arr[i]: <span class="built_in">panic</span>: runtime error: index out of <span class="keyword">range</span> [<span class="number">4</span>] with length <span class="number">3</span></span><br></pre></td></tr></table></figure><p>Go è¯­è¨€è¿è¡Œæ—¶åœ¨å‘ç°æ•°ç»„ã€åˆ‡ç‰‡å’Œå­—ç¬¦ä¸²çš„è¶Šç•Œæ“ä½œä¼šç”±è¿è¡Œæ—¶çš„ <code>panicIndex</code> å’Œ <a href="https://github.com/golang/go/blob/22d28a24c8b0d99f2ad6da5fe680fa3cfa216651/src/runtime/panic.go#L86-L89"><code>runtime.goPanicIndex</code></a> å‡½æ•°è§¦å‘ç¨‹åºçš„è¿è¡Œæ—¶é”™è¯¯å¹¶å¯¼è‡´å´©æºƒé€€å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TEXT runtimeÂ·panicIndex(SB),NOSPLIT,$<span class="number">0</span><span class="number">-8</span></span><br><span class="line">MOVLAX, x+<span class="number">0</span>(FP)</span><br><span class="line">MOVLCX, y+<span class="number">4</span>(FP)</span><br><span class="line">JMPruntimeÂ·goPanicIndex(SB)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goPanicIndex</span><span class="params">(x <span class="keyword">int</span>, y <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">panicCheck1(getcallerpc(), <span class="string">&quot;index out of range&quot;</span>)</span><br><span class="line"><span class="built_in">panic</span>(boundsError&#123;x: <span class="keyword">int64</span>(x), signed: <span class="literal">true</span>, y: y, code: boundsIndex&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ•°ç»„çš„è®¿é—®æ“ä½œ <code>OINDEX</code> æˆåŠŸé€šè¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥ä¹‹åï¼Œä¼šè¢«è½¬æ¢æˆå‡ ä¸ª SSA æŒ‡ä»¤ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„ Go è¯­è¨€ä»£ç ï¼Œé€šè¿‡å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œç¼–è¯‘ä¼šå¾—åˆ° <code>ssa.html</code> æ–‡ä»¶ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> check</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">outOfRange</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">arr := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">i := <span class="number">4</span></span><br><span class="line">elem := arr[i]</span><br><span class="line"><span class="keyword">return</span> elem</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ GOSSAFUNC=outOfRange <span class="keyword">go</span> build array.<span class="keyword">go</span></span><br><span class="line">dumped SSA to ./ssa.html</span><br></pre></td></tr></table></figure><p><code>start</code> é˜¶æ®µç”Ÿæˆçš„ SSA ä»£ç å°±æ˜¯ä¼˜åŒ–ä¹‹å‰çš„ç¬¬ä¸€ç‰ˆä¸­é—´ä»£ç ï¼Œä¸‹é¢å±•ç¤ºçš„éƒ¨åˆ†å°±æ˜¯ <code>elem := arr[i]</code> å¯¹åº”çš„ä¸­é—´ä»£ç ï¼Œåœ¨è¿™æ®µä¸­é—´ä»£ç ä¸­æˆ‘ä»¬å‘ç° Go è¯­è¨€ä¸ºæ•°ç»„çš„è®¿é—®æ“ä½œç”Ÿæˆäº†åˆ¤æ–­æ•°ç»„ä¸Šé™çš„æŒ‡ä»¤ <code>IsInBounds</code> ä»¥åŠå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è§¦å‘ç¨‹åºå´©æºƒçš„ <code>PanicBounds</code> æŒ‡ä»¤ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">b1:</span><br><span class="line">    ...</span><br><span class="line">    v22 (<span class="number">6</span>) = LocalAddr &lt;*[<span class="number">3</span>]<span class="keyword">int</span>&gt; &#123;arr&#125; v2 v20</span><br><span class="line">    v23 (<span class="number">6</span>) = IsInBounds &lt;<span class="keyword">bool</span>&gt; v21 v11</span><br><span class="line">If v23 â†’ b2 b3 (likely) (<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">b2: â† b1-</span><br><span class="line">    v26 (<span class="number">6</span>) = PtrIndex &lt;*<span class="keyword">int</span>&gt; v22 v21</span><br><span class="line">    v27 (<span class="number">6</span>) = Copy &lt;mem&gt; v20</span><br><span class="line">    v28 (<span class="number">6</span>) = Load &lt;<span class="keyword">int</span>&gt; v26 v27 (elem[<span class="keyword">int</span>])</span><br><span class="line">    ...</span><br><span class="line">Ret v30 (+<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">b3: â† b1-</span><br><span class="line">    v24 (<span class="number">6</span>) = Copy &lt;mem&gt; v20</span><br><span class="line">    v25 (<span class="number">6</span>) = PanicBounds &lt;mem&gt; [<span class="number">0</span>] v21 v11 v24</span><br><span class="line">Exit v25 (<span class="number">6</span>)</span><br></pre></td></tr></table></figure><p><code>PanicBounds</code> æŒ‡ä»¤æœ€ç»ˆä¼šè¢«è½¬æ¢æˆä¸Šé¢æåˆ°çš„ <code>panicIndex</code> å‡½æ•°ï¼Œå½“æ•°ç»„ä¸‹æ ‡æ²¡æœ‰è¶Šç•Œæ—¶ï¼Œç¼–è¯‘å™¨ä¼šå…ˆè·å–æ•°ç»„çš„å†…å­˜åœ°å€å’Œè®¿é—®çš„ä¸‹æ ‡ï¼Œç„¶ååˆ©ç”¨ <code>PtrIndex</code> è®¡ç®—å‡ºç›®æ ‡å…ƒç´ çš„åœ°å€ï¼Œå†ä½¿ç”¨ <code>Load</code> æ“ä½œå°†æŒ‡é’ˆä¸­çš„å…ƒç´ åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>å½“ç„¶åªæœ‰å½“ç¼–è¯‘å™¨æ— æ³•å¯¹æ•°ç»„ä¸‹æ ‡æ˜¯å¦è¶Šç•Œæ— æ³•åšå‡ºåˆ¤æ–­æ—¶æ‰ä¼šåŠ å…¥ <code>PanicBounds</code> æŒ‡ä»¤äº¤ç»™è¿è¡Œæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨ä½¿ç”¨å­—é¢é‡æ•´æ•°è®¿é—®æ•°ç»„ä¸‹æ ‡æ—¶å°±ä¼šç”Ÿæˆéå¸¸ç®€å•çš„ä¸­é—´ä»£ç ï¼Œå½“æˆ‘ä»¬å°†ä¸Šè¿°ä»£ç ä¸­çš„ <code>arr[i]</code> æ”¹æˆ <code>arr[2]</code> æ—¶ï¼Œå°±ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">b1:</span><br><span class="line">    ...</span><br><span class="line">    v21 (<span class="number">5</span>) = LocalAddr &lt;*[<span class="number">3</span>]<span class="keyword">int</span>&gt; &#123;arr&#125; v2 v20</span><br><span class="line">    v22 (<span class="number">5</span>) = PtrIndex &lt;*<span class="keyword">int</span>&gt; v21 v14</span><br><span class="line">    v23 (<span class="number">5</span>) = Load &lt;<span class="keyword">int</span>&gt; v22 v20 (elem[<span class="keyword">int</span>])</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>Go è¯­è¨€å¯¹äºæ•°ç»„çš„è®¿é—®è¿˜æ˜¯æœ‰ç€æ¯”è¾ƒå¤šçš„æ£€æŸ¥çš„ï¼Œå®ƒä¸ä»…ä¼šåœ¨ç¼–è¯‘æœŸé—´æå‰å‘ç°ä¸€äº›ç®€å•çš„è¶Šç•Œé”™è¯¯å¹¶æ’å…¥ç”¨äºæ£€æµ‹æ•°ç»„ä¸Šé™çš„å‡½æ•°è°ƒç”¨ï¼Œè€Œåœ¨è¿è¡ŒæœŸé—´è¿™äº›æ’å…¥çš„å‡½æ•°ä¼šè´Ÿè´£ä¿è¯ä¸ä¼šå‘ç”Ÿè¶Šç•Œé”™è¯¯ã€‚</p><p>æ•°ç»„çš„èµ‹å€¼å’Œæ›´æ–°æ“ä½œ <code>a[i] = 2</code> ä¹Ÿä¼šç”Ÿæˆ SSA ç”ŸæˆæœŸé—´è®¡ç®—å‡ºæ•°ç»„å½“å‰å…ƒç´ çš„å†…å­˜åœ°å€ï¼Œç„¶åä¿®æ”¹å½“å‰å†…å­˜åœ°å€çš„å†…å®¹ï¼Œè¿™äº›èµ‹å€¼è¯­å¥ä¼šè¢«è½¬æ¢æˆå¦‚ä¸‹æ‰€ç¤ºçš„ SSA æ“ä½œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">b1:</span><br><span class="line">    ...</span><br><span class="line">    v21 (<span class="number">5</span>) = LocalAddr &lt;*[<span class="number">3</span>]<span class="keyword">int</span>&gt; &#123;arr&#125; v2 v19</span><br><span class="line">    v22 (<span class="number">5</span>) = PtrIndex &lt;*<span class="keyword">int</span>&gt; v21 v13</span><br><span class="line">    v23 (<span class="number">5</span>) = Store &lt;mem&gt; &#123;<span class="keyword">int</span>&#125; v22 v20 v19</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>èµ‹å€¼çš„è¿‡ç¨‹ä¸­ä¼šå…ˆç¡®å®šç›®æ ‡æ•°ç»„çš„åœ°å€ï¼Œå†é€šè¿‡ <code>PtrIndex</code> è·å–ç›®æ ‡å…ƒç´ çš„åœ°å€ï¼Œæœ€åä½¿ç”¨ <code>Store</code> æŒ‡ä»¤å°†æ•°æ®å­˜å…¥åœ°å€ä¸­ï¼Œä»ä¸Šé¢çš„è¿™äº› SSA ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ— è®ºæ˜¯æ•°ç»„çš„å¯»å€è¿˜æ˜¯èµ‹å€¼éƒ½æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„ï¼Œæ²¡æœ‰è¿è¡Œæ—¶çš„å‚ä¸ã€‚</p><h2 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h2><p>æ›´å¸¸ç”¨çš„æ•°æ®ç»“æ„å…¶å®æ˜¯åˆ‡ç‰‡ï¼Œåˆ‡ç‰‡å°±æ˜¯åŠ¨æ€æ•°ç»„ï¼Œå®ƒçš„é•¿åº¦å¹¶ä¸å›ºå®šï¼Œæˆ‘ä»¬å¯ä»¥éšæ„å‘åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ ï¼Œè€Œåˆ‡ç‰‡ä¼šåœ¨å®¹é‡ä¸è¶³æ—¶è‡ªåŠ¨æ‰©å®¹ã€‚</p><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œåˆ‡ç‰‡ç±»å‹çš„å£°æ˜æ–¹å¼ä¸æ•°ç»„æœ‰ä¸€äº›ç›¸ä¼¼ï¼Œç”±äºåˆ‡ç‰‡çš„é•¿åº¦æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥å£°æ˜æ—¶åªéœ€è¦æŒ‡å®šåˆ‡ç‰‡ä¸­çš„å…ƒç´ ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[]<span class="keyword">int</span></span><br><span class="line">[]<span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ä»åˆ‡ç‰‡çš„å®šä¹‰æˆ‘ä»¬èƒ½æ¨æµ‹å‡ºï¼Œåˆ‡ç‰‡åœ¨ç¼–è¯‘æœŸé—´çš„ç”Ÿæˆçš„ç±»å‹åªä¼šåŒ…å«åˆ‡ç‰‡ä¸­çš„å…ƒç´ ç±»å‹ï¼Œå³ <code>int</code> æˆ–è€… <code>interface&#123;&#125;</code> ç­‰ã€‚<a href="https://github.com/golang/go/blob/616c39f6a636166447bdaac4f0871a5ca52bae8c/src/cmd/compile/internal/types/type.go#L484-L496"><code>cmd/compile/internal/types.NewSlice</code></a> å°±æ˜¯ç¼–è¯‘æœŸé—´ç”¨äºåˆ›å»º <code>Slice</code> ç±»å‹çš„å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSlice</span><span class="params">(elem *Type)</span> *<span class="title">Type</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t := elem.Cache.slice; t != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> t.Elem() != elem &#123;</span><br><span class="line">Fatalf(<span class="string">&quot;elem mismatch&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">t := New(TSLICE)</span><br><span class="line">t.Extra = Slice&#123;Elem: elem&#125;</span><br><span class="line">elem.Cache.slice = t</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•è¿”å›çš„ç»“æ„ä½“ <code>TSLICE</code> ä¸­çš„ <code>Extra</code> å­—æ®µæ˜¯ä¸€ä¸ªåªåŒ…å«åˆ‡ç‰‡å†…å…ƒç´ ç±»å‹çš„ <code>Slice&#123;Elem: elem&#125;</code> ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>åˆ‡ç‰‡å†…å…ƒç´ çš„ç±»å‹æ˜¯åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šçš„</strong>ï¼Œç¼–è¯‘å™¨ç¡®å®šäº†ç±»å‹ä¹‹åï¼Œä¼šå°†ç±»å‹å­˜å‚¨åœ¨ <code>Extra</code> å­—æ®µä¸­å¸®åŠ©ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–ã€‚</p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>ç¼–è¯‘æœŸé—´çš„åˆ‡ç‰‡æ˜¯ <code>Slice</code> ç±»å‹çš„ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶åˆ‡ç‰‡ç”±å¦‚ä¸‹çš„ <code>SliceHeader</code> ç»“æ„ä½“è¡¨ç¤ºï¼Œå…¶ä¸­ <code>Data</code> å­—æ®µæ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œ<code>Len</code> è¡¨ç¤ºå½“å‰åˆ‡ç‰‡çš„é•¿åº¦ï¼Œè€Œ <code>Cap</code> è¡¨ç¤ºå½“å‰åˆ‡ç‰‡çš„å®¹é‡ï¼Œä¹Ÿå°±æ˜¯ <code>Data</code> æ•°ç»„çš„å¤§å°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SliceHeader <span class="keyword">struct</span> &#123;</span><br><span class="line">Data <span class="keyword">uintptr</span></span><br><span class="line">Len  <span class="keyword">int</span></span><br><span class="line">Cap  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Data</code> ä½œä¸ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¿™ç‰‡å†…å­˜ç©ºé—´å¯ä»¥ç”¨äºå­˜å‚¨åˆ‡ç‰‡ä¸­ä¿å­˜çš„å…¨éƒ¨å…ƒç´ ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ åªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œåº•å±‚å­˜å‚¨å…¶å®éƒ½æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‰‡ç†è§£æˆä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´åŠ ä¸Šé•¿åº¦ä¸å®¹é‡çš„æ ‡è¯†ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/xH4o6IVjtbU7Prk.png" alt="golang-slice-struct"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬ä¼šå‘ç°åˆ‡ç‰‡ä¸æ•°ç»„çš„å…³ç³»éå¸¸å¯†åˆ‡ï¼Œåˆ‡ç‰‡å¼•å…¥äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæä¾›äº†å¯¹æ•°ç»„ä¸­éƒ¨åˆ†ç‰‡æ®µçš„å¼•ç”¨ï¼Œä½œä¸ºæ•°ç»„çš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡ŒåŒºé—´å¯ä»¥ä¿®æ”¹å®ƒçš„é•¿åº¦ï¼Œå¦‚æœåº•å±‚çš„æ•°ç»„é•¿åº¦ä¸è¶³å°±ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼Œåˆ‡ç‰‡ä¸­çš„æ•°ç»„å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸è¿‡åœ¨ä¸Šå±‚çœ‹æ¥åˆ‡ç‰‡æ—¶æ²¡æœ‰å˜åŒ–çš„ï¼Œä¸Šå±‚åªéœ€è¦ä¸åˆ‡ç‰‡æ‰“äº¤é“ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„æ•°ç»„å˜åŒ–ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä»‹ç»è¿‡ï¼Œè·å–æ•°ç»„å¤§å°ã€å¯¹æ•°ç»„ä¸­çš„å…ƒç´ çš„è¯»å†™åœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»è¿›è¡Œäº†ç®€åŒ–ï¼Œç”±äºæ•°ç»„çš„å†…å­˜å›ºå®šä¸”è¿ç»­ï¼Œå¾ˆå¤šæ“ä½œéƒ½ä¼šå˜æˆå¯¹å†…å­˜çš„ç›´æ¥è¯»å†™ã€‚ä½†æ˜¯åˆ‡ç‰‡æ˜¯è¿è¡Œæ—¶æ‰ä¼šç¡®å®šå†…å®¹çš„ç»“æ„ï¼Œæ‰€æœ‰çš„æ“ä½œè¿˜éœ€è¦ä¾èµ– Go è¯­è¨€çš„è¿è¡Œæ—¶æ¥å®Œæˆï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±ä¼šä»‹ç»åˆ‡ç‰‡ä¸€äº›å¸¸è§æ“ä½œçš„å®ç°åŸç†ã€‚</p><h3 id="åˆå§‹åŒ–-1"><a href="#åˆå§‹åŒ–-1" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>Go è¯­è¨€ä¸­çš„åˆ‡ç‰‡æœ‰ä¸‰ç§åˆå§‹åŒ–çš„æ–¹å¼ï¼š</p><ol><li><p>é€šè¿‡ä¸‹æ ‡çš„æ–¹å¼è·å¾—æ•°ç»„æˆ–è€…åˆ‡ç‰‡çš„ä¸€éƒ¨åˆ†ï¼›</p></li><li><p>ä½¿ç”¨å­—é¢é‡åˆå§‹åŒ–æ–°çš„åˆ‡ç‰‡ï¼›</p></li><li><p>ä½¿ç”¨å…³é”®å­— <code>make</code> åˆ›å»ºåˆ‡ç‰‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr[<span class="number">0</span>:<span class="number">3</span>] or slice[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">slice := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">slice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure></li></ol><h4 id="ä½¿ç”¨ä¸‹æ ‡"><a href="#ä½¿ç”¨ä¸‹æ ‡" class="headerlink" title="ä½¿ç”¨ä¸‹æ ‡"></a>ä½¿ç”¨ä¸‹æ ‡</h4><p>ä½¿ç”¨ä¸‹æ ‡åˆ›å»ºåˆ‡ç‰‡æ˜¯æœ€åŸå§‹ä¹Ÿæœ€æ¥è¿‘æ±‡ç¼–è¯­è¨€çš„æ–¹å¼ï¼Œå®ƒæ˜¯æ‰€æœ‰æ–¹æ³•ä¸­æœ€ä¸ºåº•å±‚çš„ä¸€ç§ï¼Œ<code>arr[0:3]</code> æˆ–è€… <code>slice[0:3]</code> è¿™äº›æ“ä½œä¼šç”±ç¼–è¯‘å™¨è½¬æ¢æˆ <code>OpSliceMake</code> æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ch03/op_slice_make.go</span></span><br><span class="line"><span class="keyword">package</span> opslicemake</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newSlice</span><span class="params">()</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">arr := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">slice := arr[<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line"><span class="keyword">return</span> slice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>GOSSAFUNC</code> å˜é‡ç¼–è¯‘ä¸Šè¿°ä»£ç å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ SSA ä¸­é—´ä»£ç ï¼Œåœ¨<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-ir-ssa/">ä¸­é—´ä»£ç ç”Ÿæˆ</a>çš„ <code>decompose builtin</code> é˜¶æ®µï¼Œ<code>slice := arr[0:1]</code> å¯¹åº”çš„éƒ¨åˆ†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v27 (+<span class="number">5</span>) = SliceMake &lt;[]<span class="keyword">int</span>&gt; v11 v14 v17</span><br><span class="line"></span><br><span class="line">name &amp;arr[*[<span class="number">3</span>]<span class="keyword">int</span>]: v11</span><br><span class="line">name slice.ptr[*<span class="keyword">int</span>]: v11</span><br><span class="line">name slice.<span class="built_in">len</span>[<span class="keyword">int</span>]: v14</span><br><span class="line">name slice.<span class="built_in">cap</span>[<span class="keyword">int</span>]: v17</span><br></pre></td></tr></table></figure><p><code>SliceMake</code> è¿™ä¸ªæ“ä½œä¼šæ¥å—ä¸‰ä¸ªå‚æ•°åˆ›å»ºæ–°çš„åˆ‡ç‰‡ï¼Œå…ƒç´ ç±»å‹ã€æ•°ç»„æŒ‡é’ˆã€åˆ‡ç‰‡å¤§å°å’Œå®¹é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨æ•°æ®ç»“æ„ä¸€èŠ‚ä¸­æåˆ°çš„åˆ‡ç‰‡çš„å‡ ä¸ªå­—æ®µã€‚</p><h4 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨å­—é¢é‡ <code>[]int&#123;1, 2, 3&#125;</code> åˆ›å»ºæ–°çš„åˆ‡ç‰‡æ—¶ï¼Œ<a href="https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L595-L766"><code>cmd/compile/internal/gc.slicelit</code></a> å‡½æ•°ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†å®ƒå±•å¼€æˆå¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vstat [<span class="number">3</span>]<span class="keyword">int</span></span><br><span class="line">vstat[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">vstat[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">vstat[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> vauto *[<span class="number">3</span>]<span class="keyword">int</span> = <span class="built_in">new</span>([<span class="number">3</span>]<span class="keyword">int</span>)</span><br><span class="line">*vauto = vstat</span><br><span class="line">slice := vauto[:]</span><br></pre></td></tr></table></figure><ol><li>æ ¹æ®åˆ‡ç‰‡ä¸­çš„å…ƒç´ æ•°é‡å¯¹åº•å±‚æ•°ç»„çš„å¤§å°è¿›è¡Œæ¨æ–­å¹¶åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼›</li><li>å°†è¿™äº›å­—é¢é‡å…ƒç´ å­˜å‚¨åˆ°åˆå§‹åŒ–çš„æ•°ç»„ä¸­ï¼›</li><li>åˆ›å»ºä¸€ä¸ªåŒæ ·æŒ‡å‘ <code>[3]int</code> ç±»å‹çš„æ•°ç»„æŒ‡é’ˆï¼›</li><li>å°†é™æ€å­˜å‚¨åŒºçš„æ•°ç»„ <code>vstat</code> èµ‹å€¼ç»™ <code>vauto</code> æŒ‡é’ˆæ‰€åœ¨çš„åœ°å€ï¼›</li><li>é€šè¿‡ <code>[:]</code> æ“ä½œè·å–ä¸€ä¸ªåº•å±‚ä½¿ç”¨ <code>vauto</code> çš„åˆ‡ç‰‡ï¼›</li></ol><p>ç¬¬ 5 æ­¥ä¸­çš„ <code>[:]</code> å°±æ˜¯ä½¿ç”¨ä¸‹æ ‡åˆ›å»ºåˆ‡ç‰‡çš„æ–¹æ³•ï¼Œä»è¿™ä¸€ç‚¹æˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡º <code>[:]</code> æ“ä½œæ˜¯åˆ›å»ºåˆ‡ç‰‡æœ€åº•å±‚çš„ä¸€ç§æ–¹æ³•ã€‚</p><h4 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h4><p>å¦‚æœä½¿ç”¨å­—é¢é‡çš„æ–¹å¼åˆ›å»ºåˆ‡ç‰‡ï¼Œå¤§éƒ¨åˆ†çš„å·¥ä½œå°±éƒ½ä¼šåœ¨ç¼–è¯‘æœŸé—´å®Œæˆï¼Œä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨ <code>make</code> å…³é”®å­—åˆ›å»ºåˆ‡ç‰‡æ—¶ï¼Œå¾ˆå¤šå·¥ä½œéƒ½éœ€è¦è¿è¡Œæ—¶çš„å‚ä¸ï¼›è°ƒç”¨æ–¹å¿…é¡»åœ¨ <code>make</code> å‡½æ•°ä¸­ä¼ å…¥ä¸€ä¸ªåˆ‡ç‰‡çš„å¤§å°ä»¥åŠå¯é€‰çš„å®¹é‡ï¼Œ<a href="https://github.com/golang/go/blob/b7d097a4cf6b8a9125e4770b54d33826fa803023/src/cmd/compile/internal/gc/typecheck.go#L327-L2126"><code>cmd/compile/internal/gc.typecheck1</code></a> ä¼šå¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typecheck1</span><span class="params">(n *Node, top <span class="keyword">int</span>)</span> <span class="params">(res *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">case</span> OMAKE:</span><br><span class="line">args := n.List.Slice()</span><br><span class="line"></span><br><span class="line">i := <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> t.Etype &#123;</span><br><span class="line"><span class="keyword">case</span> TSLICE:</span><br><span class="line"><span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(args) &#123;</span><br><span class="line">yyerror(<span class="string">&quot;missing len argument to make(%v)&quot;</span>, t)</span><br><span class="line"><span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">l = args[i]</span><br><span class="line">i++</span><br><span class="line"><span class="keyword">var</span> r *Node</span><br><span class="line"><span class="keyword">if</span> i &lt; <span class="built_in">len</span>(args) &#123;</span><br><span class="line">r = args[i]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> Isconst(l, CTINT) &amp;&amp; r != <span class="literal">nil</span> &amp;&amp; Isconst(r, CTINT) &amp;&amp; l.Val().U.(*Mpint).Cmp(r.Val().U.(*Mpint)) &gt; <span class="number">0</span> &#123;</span><br><span class="line">yyerror(<span class="string">&quot;len larger than cap in make(%v)&quot;</span>, t)</span><br><span class="line"><span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">n.Left = l</span><br><span class="line">n.Right = r</span><br><span class="line">n.Op = OMAKESLICE</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°ä¸ä»…ä¼šæ£€æŸ¥ <code>len</code> æ˜¯å¦ä¼ å…¥ï¼Œè¿˜ä¼šä¿è¯ä¼ å…¥çš„å®¹é‡ <code>cap</code> ä¸€å®šå¤§äºæˆ–è€…ç­‰äº <code>len</code>ï¼Œé™¤äº†æ ¡éªŒå‚æ•°ä¹‹å¤–ï¼Œå½“å‰å‡½æ•°ä¼šå°† <code>OMAKE</code> èŠ‚ç‚¹è½¬æ¢æˆ <code>OMAKESLICE</code>ï¼Œéšåçš„ä¸­é—´ä»£ç ç”Ÿæˆé˜¶æ®µåœ¨ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L439-L1532"><code>cmd/compile/internal/gc.walkexpr</code></a> å‡½æ•°ä¸­çš„ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/walk.go#L1315"><code>OMAKESLICE</code></a> åˆ†æ”¯ä¾æ®ä¸¤ä¸ªé‡è¦æ¡ä»¶å¯¹è¿™é‡Œçš„ <code>OMAKESLICE</code> è¿›è¡Œè½¬æ¢ï¼š</p><ol><li>åˆ‡ç‰‡çš„å¤§å°å’Œå®¹é‡æ˜¯å¦è¶³å¤Ÿå°ï¼›</li><li>åˆ‡ç‰‡æ˜¯å¦å‘ç”Ÿäº†é€ƒé€¸ï¼Œæœ€ç»ˆåœ¨å †ä¸Šåˆå§‹åŒ–</li></ol><p>å½“åˆ‡ç‰‡å‘ç”Ÿé€ƒé€¸æˆ–è€…éå¸¸å¤§æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L34-L50"><code>runtime.makeslice</code></a> å‡½æ•°åœ¨å †ä¸Šåˆå§‹åŒ–ï¼Œå¦‚æœå½“å‰çš„åˆ‡ç‰‡ä¸ä¼šå‘ç”Ÿé€ƒé€¸å¹¶ä¸”åˆ‡ç‰‡éå¸¸å°çš„æ—¶å€™ï¼Œ<code>make([]int, 3, 4)</code> ä¼šè¢«ç›´æ¥è½¬æ¢æˆå¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">4</span>]<span class="keyword">int</span></span><br><span class="line">n := arr[:<span class="number">3</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¼šåˆå§‹åŒ–æ•°ç»„å¹¶ä¸”ç›´æ¥é€šè¿‡ä¸‹æ ‡ <code>[:3]</code> æ¥å¾—åˆ°æ•°ç»„çš„åˆ‡ç‰‡ï¼Œè¿™ä¸¤éƒ¨åˆ†æ“ä½œéƒ½ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆï¼Œç¼–è¯‘å™¨ä¼šåœ¨æ ˆä¸Šæˆ–è€…é™æ€å­˜å‚¨åŒºåˆ›å»ºæ•°ç»„ï¼Œ<code>[:3]</code> ä¼šè¢«è½¬æ¢æˆä¸Šä¸€èŠ‚æåˆ°çš„ <code>OpSliceMake</code> æ“ä½œã€‚</p><p>åˆ†æäº†ä¸»è¦ç”±ç¼–è¯‘å™¨å¤„ç†çš„åˆ†æ”¯ä¹‹åï¼Œæˆ‘ä»¬å›åˆ°ç”¨äºåˆ›å»ºåˆ‡ç‰‡çš„è¿è¡Œæ—¶å‡½æ•° <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L34-L50"><code>runtime.makeslice</code></a>ï¼Œè¿™ä¸ªå‡½æ•°çš„å®ç°éå¸¸ç®€å•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeslice</span><span class="params">(et *_type, <span class="built_in">len</span>, <span class="built_in">cap</span> <span class="keyword">int</span>)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">mem, overflow := math.MulUintptr(et.size, <span class="keyword">uintptr</span>(<span class="built_in">cap</span>))</span><br><span class="line"><span class="keyword">if</span> overflow || mem &gt; maxAlloc || <span class="built_in">len</span> &lt; <span class="number">0</span> || <span class="built_in">len</span> &gt; <span class="built_in">cap</span> &#123;</span><br><span class="line">mem, overflow := math.MulUintptr(et.size, <span class="keyword">uintptr</span>(<span class="built_in">len</span>))</span><br><span class="line"><span class="keyword">if</span> overflow || mem &gt; maxAlloc || <span class="built_in">len</span> &lt; <span class="number">0</span> &#123;</span><br><span class="line">panicmakeslicelen()</span><br><span class="line">&#125;</span><br><span class="line">panicmakeslicecap()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> mallocgc(mem, et, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒçš„ä¸»è¦å·¥ä½œå°±æ˜¯è®¡ç®—å½“å‰åˆ‡ç‰‡å ç”¨çš„å†…å­˜ç©ºé—´å¹¶åœ¨å †ä¸Šç”³è¯·ä¸€ç‰‡è¿ç»­çš„å†…å­˜ï¼Œå®ƒä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼è®¡ç®—å ç”¨çš„å†…å­˜ï¼š</p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">å†…å­˜ç©ºé—´ </span>=<span class="string"> åˆ‡ç‰‡ä¸­å…ƒç´ å¤§å° x åˆ‡ç‰‡å®¹é‡</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶å¤§å¤šçš„é”™è¯¯éƒ½å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è¢«æ£€æŸ¥å‡ºæ¥ï¼Œä½†æ˜¯åœ¨åˆ›å»ºåˆ‡ç‰‡çš„è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿäº†ä»¥ä¸‹é”™è¯¯å°±ä¼šç›´æ¥å¯¼è‡´ç¨‹åºè§¦å‘è¿è¡Œæ—¶é”™è¯¯å¹¶å´©æºƒï¼š</p><ol><li>å†…å­˜ç©ºé—´çš„å¤§å°å‘ç”Ÿäº†æº¢å‡ºï¼›</li><li>ç”³è¯·çš„å†…å­˜å¤§äºæœ€å¤§å¯åˆ†é…çš„å†…å­˜ï¼›</li><li>ä¼ å…¥çš„é•¿åº¦å°äº 0 æˆ–è€…é•¿åº¦å¤§äºå®¹é‡ï¼›</li></ol><p><code>mallocgc</code> å°±æ˜¯ç”¨äºç”³è¯·å†…å­˜çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å®ç°è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœé‡åˆ°äº†æ¯”è¾ƒå°çš„å¯¹è±¡ä¼šç›´æ¥åˆå§‹åŒ–åœ¨ Go è¯­è¨€è°ƒåº¦å™¨é‡Œé¢çš„ P ç»“æ„ä¸­ï¼Œè€Œå¤§äº 32KB çš„ä¸€äº›å¯¹è±¡ä¼šåœ¨å †ä¸Šåˆå§‹åŒ–ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ç« èŠ‚ä¸­è¯¦ç»†ä»‹ç» Go è¯­è¨€çš„å†…å­˜åˆ†é…å™¨ï¼Œåœ¨è¿™é‡Œå°±ä¸å±•å¼€åˆ†æäº†ã€‚</p><p>ç›®å‰çš„ <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L34-L50"><code>runtime.makeslice</code></a> ä¼šè¿”å›æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œä¹‹å‰ç‰ˆæœ¬çš„ Go è¯­è¨€ä¸­ï¼Œæ•°ç»„æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ä¼šè¢«åˆæˆä¸€ä¸ª <code>slice</code> ç»“æ„å¹¶è¿”å›ï¼Œä½†æ˜¯ä» <a href="https://github.com/golang/go/commit/020a18c545bf49ffc087ca93cd238195d8dcc411#diff-d9238ca551e72b3a80da9e0da10586a4">cmd/compile: move slice construction to callers of makeslice</a> è¿™æ¬¡æäº¤ä¹‹åï¼Œæ„å»ºç»“æ„ä½“ <code>SliceHeader</code> çš„å·¥ä½œå°±éƒ½äº¤ç»™ <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L34-L50"><code>runtime.makeslice</code></a> çš„è°ƒç”¨æ–¹å¤„ç†äº†ï¼Œè¿™äº›è°ƒç”¨æ–¹ä¼šåœ¨ç¼–è¯‘æœŸé—´æ„å»ºåˆ‡ç‰‡ç»“æ„ä½“ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typecheck1</span><span class="params">(n *Node, top <span class="keyword">int</span>)</span> <span class="params">(res *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">case</span> OSLICEHEADER:</span><br><span class="line"><span class="keyword">switch</span> </span><br><span class="line">t := n.Type</span><br><span class="line">n.Left = typecheck(n.Left, ctxExpr)</span><br><span class="line">l := typecheck(n.List.First(), ctxExpr)</span><br><span class="line">c := typecheck(n.List.Second(), ctxExpr)</span><br><span class="line">l = defaultlit(l, types.Types[TINT])</span><br><span class="line">c = defaultlit(c, types.Types[TINT])</span><br><span class="line"></span><br><span class="line">n.List.SetFirst(l)</span><br><span class="line">n.List.SetSecond(c)</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>OSLICEHEADER</code> æ“ä½œä¼šåˆ›å»ºæˆ‘ä»¬åœ¨ä¸Šé¢ä»‹ç»è¿‡çš„ç»“æ„ä½“ <code>SliceHeader</code>ï¼Œå…¶ä¸­åŒ…å«æ•°ç»„æŒ‡é’ˆã€åˆ‡ç‰‡é•¿åº¦å’Œå®¹é‡ï¼Œå®ƒä¹Ÿæ˜¯åˆ‡ç‰‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SliceHeader <span class="keyword">struct</span> &#123;</span><br><span class="line">Data <span class="keyword">uintptr</span></span><br><span class="line">Len  <span class="keyword">int</span></span><br><span class="line">Cap  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£æ˜¯å› ä¸ºå¤§å¤šæ•°å¯¹åˆ‡ç‰‡ç±»å‹çš„æ“ä½œå¹¶ä¸éœ€è¦ç›´æ¥æ“ä½œåŸ <code>slice</code> ç»“æ„ä½“ï¼Œæ‰€ä»¥ <code>SliceHeader</code> çš„å¼•å…¥èƒ½å¤Ÿå‡å°‘åˆ‡ç‰‡åˆå§‹åŒ–æ—¶çš„å°‘é‡å¼€é”€ï¼Œè¿™ä¸ªæ”¹åŠ¨èƒ½å¤Ÿå‡å°‘ ~0.2% çš„ Go è¯­è¨€åŒ…å¤§å°å¹¶ä¸”èƒ½å¤Ÿå‡å°‘ 92 ä¸ª <code>panicindex</code> çš„è°ƒç”¨ï¼Œå æ•´ä¸ª Go è¯­è¨€äºŒè¿›åˆ¶çš„ ~3.5%ã€‚</p><h3 id="è®¿é—®å…ƒç´ "><a href="#è®¿é—®å…ƒç´ " class="headerlink" title="è®¿é—®å…ƒç´ "></a>è®¿é—®å…ƒç´ </h3><p>å¯¹åˆ‡ç‰‡å¸¸è§çš„æ“ä½œå°±æ˜¯è·å–å®ƒçš„é•¿åº¦æˆ–è€…å®¹é‡ï¼Œè¿™ä¸¤ä¸ªä¸åŒçš„å‡½æ•° <code>len</code> å’Œ <code>cap</code> è¢« Go è¯­è¨€çš„ç¼–è¯‘å™¨çœ‹æˆæ˜¯ä¸¤ç§ç‰¹æ®Šçš„æ“ä½œï¼Œå³ <code>OLEN</code> å’Œ <code>OCAP</code>ï¼Œå®ƒä»¬ä¼šåœ¨ <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-ir-ssa/">SSA ç”Ÿæˆé˜¶æ®µ</a>è¢« <a href="https://github.com/golang/go/blob/a037582efff56082631508b15b287494df6e9b69/src/cmd/compile/internal/gc/ssa.go#L1975-L2724"><code>cmd/compile/internal/gc.epxr</code></a> å‡½æ•°è½¬æ¢æˆ <code>OpSliceLen</code> å’Œ <code>OpSliceCap</code> æ“ä½œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *state)</span> <span class="title">expr</span><span class="params">(n *Node)</span> *<span class="title">ssa</span>.<span class="title">Value</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line"><span class="keyword">case</span> OLEN, OCAP:</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> n.Left.Type.IsSlice():</span><br><span class="line">op := ssa.OpSliceLen</span><br><span class="line"><span class="keyword">if</span> n.Op == OCAP &#123;</span><br><span class="line">op = ssa.OpSliceCap</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.newValue1(op, types.Types[TINT], s.expr(n.Left))</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®åˆ‡ç‰‡ä¸­çš„å­—æ®µå¯èƒ½ä¼šè§¦å‘ <code>decompose builtin</code> é˜¶æ®µçš„ä¼˜åŒ–ï¼Œ<code>len(slice)</code> æˆ–è€… <code>cap(slice)</code> åœ¨ä¸€äº›æƒ…å†µä¸‹ä¼šè¢«ç›´æ¥æ›¿æ¢æˆåˆ‡ç‰‡çš„é•¿åº¦æˆ–è€…å®¹é‡ï¼Œä¸éœ€è¦è¿è¡Œæ—¶ä»åˆ‡ç‰‡ç»“æ„ä¸­è·å–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(SlicePtr (SliceMake ptr _ _ )) -&gt; ptr</span><br><span class="line">(SliceLen (SliceMake _ <span class="built_in">len</span> _)) -&gt; <span class="built_in">len</span></span><br><span class="line">(SliceCap (SliceMake _ _ <span class="built_in">cap</span>)) -&gt; <span class="built_in">cap</span></span><br></pre></td></tr></table></figure><p>é™¤äº†è·å–åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¹‹å¤–ï¼Œè®¿é—®åˆ‡ç‰‡ä¸­å…ƒç´ ä½¿ç”¨çš„ <code>OINDEX</code> æ“ä½œä¹Ÿä¼šåœ¨ä¸­é—´ä»£ç ç”ŸæˆæœŸé—´è½¬æ¢æˆå¯¹åœ°å€çš„ç›´æ¥è®¿é—®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *state)</span> <span class="title">expr</span><span class="params">(n *Node)</span> *<span class="title">ssa</span>.<span class="title">Value</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> n.Op &#123;</span><br><span class="line"><span class="keyword">case</span> OINDEX:</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> n.Left.Type.IsSlice():</span><br><span class="line">p := s.addr(n, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span> s.load(n.Left.Type.Elem(), p)</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡ç‰‡çš„æ“ä½œåŸºæœ¬éƒ½æ˜¯åœ¨ç¼–è¯‘æœŸé—´å®Œæˆçš„ï¼Œé™¤äº†è®¿é—®åˆ‡ç‰‡çš„é•¿åº¦ã€å®¹é‡æˆ–è€…å…¶ä¸­çš„å…ƒç´ ä¹‹å¤–ï¼Œä½¿ç”¨ <code>range</code> éå†åˆ‡ç‰‡æ—¶ä¹Ÿä¼šåœ¨ç¼–è¯‘æœŸé—´è½¬æ¢æˆå½¢å¼æ›´ç®€å•çš„ä»£ç ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ <code>range</code> å…³é”®å­—ä¸€èŠ‚ä¸­ä»‹ç»ä½¿ç”¨ <code>range</code> éå†åˆ‡ç‰‡çš„è¿‡ç¨‹ã€‚</p><h3 id="è¿½åŠ å’Œæ‰©å®¹"><a href="#è¿½åŠ å’Œæ‰©å®¹" class="headerlink" title="è¿½åŠ å’Œæ‰©å®¹"></a>è¿½åŠ å’Œæ‰©å®¹</h3><p>å‘åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ åº”è¯¥æ˜¯æœ€å¸¸è§çš„åˆ‡ç‰‡æ“ä½œï¼Œåœ¨ Go è¯­è¨€ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨ <code>append</code> å…³é”®å­—å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ ï¼Œä¸­é—´ä»£ç ç”Ÿæˆé˜¶æ®µçš„ <a href="https://github.com/golang/go/blob/a037582efff56082631508b15b287494df6e9b69/src/cmd/compile/internal/gc/ssa.go#L2732-L2884"><code>cmd/compile/internal/gc.state.append</code></a> æ–¹æ³•ä¼šæ‹†åˆ† <code>append</code> å…³é”®å­—ï¼Œè¯¥æ–¹æ³•è¿½åŠ å…ƒç´ ä¼šæ ¹æ®è¿”å›å€¼æ˜¯å¦ä¼šè¦†ç›–åŸå˜é‡ï¼Œåˆ†åˆ«è¿›å…¥ä¸¤ç§æµç¨‹ï¼Œå¦‚æœ <code>append</code> è¿”å›çš„ã€æ–°åˆ‡ç‰‡ã€ä¸éœ€è¦èµ‹å€¼å›åŸæœ‰çš„å˜é‡ï¼Œå°±ä¼šè¿›å…¥å¦‚ä¸‹çš„å¤„ç†æµç¨‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// append(slice, 1, 2, 3)</span></span><br><span class="line">ptr, <span class="built_in">len</span>, <span class="built_in">cap</span> := slice</span><br><span class="line">newlen := <span class="built_in">len</span> + <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> newlen &gt; <span class="built_in">cap</span> &#123;</span><br><span class="line">    ptr, <span class="built_in">len</span>, <span class="built_in">cap</span> = growslice(slice, newlen)</span><br><span class="line">    newlen = <span class="built_in">len</span> + <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">*(ptr+<span class="built_in">len</span>) = <span class="number">1</span></span><br><span class="line">*(ptr+<span class="built_in">len</span>+<span class="number">1</span>) = <span class="number">2</span></span><br><span class="line">*(ptr+<span class="built_in">len</span>+<span class="number">2</span>) = <span class="number">3</span></span><br><span class="line"><span class="keyword">return</span> makeslice(ptr, newlen, <span class="built_in">cap</span>)</span><br></pre></td></tr></table></figure><p><strong>æˆ‘ä»¬ä¼šå…ˆå¯¹åˆ‡ç‰‡ç»“æ„ä½“è¿›è¡Œè§£æ„è·å–å®ƒçš„æ•°ç»„æŒ‡é’ˆã€å¤§å°å’Œå®¹é‡ï¼Œå¦‚æœåœ¨è¿½åŠ å…ƒç´ ååˆ‡ç‰‡çš„å¤§å°å¤§äºå®¹é‡ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L76-L191"><code>runtime.growslice</code></a> å¯¹åˆ‡ç‰‡è¿›è¡Œæ‰©å®¹å¹¶å°†æ–°çš„å…ƒç´ ä¾æ¬¡åŠ å…¥åˆ‡ç‰‡ï¼›å¦‚æœ <code>append</code> åçš„åˆ‡ç‰‡ä¼šè¦†ç›–åŸåˆ‡ç‰‡ï¼Œå³ <code>slice = append(slice, 1, 2, 3)</code>ï¼Œ <a href="https://github.com/golang/go/blob/a037582efff56082631508b15b287494df6e9b69/src/cmd/compile/internal/gc/ssa.go#L2732-L2884"><code>cmd/compile/internal/gc.state.append</code></a> å°±ä¼šä½¿ç”¨å¦ä¸€ç§æ–¹å¼æ”¹å†™å…³é”®å­—ï¼š</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// slice = append(slice, 1, 2, 3)</span></span><br><span class="line">a := &amp;slice</span><br><span class="line">ptr, <span class="built_in">len</span>, <span class="built_in">cap</span> := slice</span><br><span class="line">newlen := <span class="built_in">len</span> + <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">uint</span>(newlen) &gt; <span class="keyword">uint</span>(<span class="built_in">cap</span>) &#123;</span><br><span class="line">   newptr, <span class="built_in">len</span>, newcap = growslice(slice, newlen)</span><br><span class="line">   vardef(a)</span><br><span class="line">   *a.<span class="built_in">cap</span> = newcap</span><br><span class="line">   *a.ptr = newptr</span><br><span class="line">&#125;</span><br><span class="line">newlen = <span class="built_in">len</span> + <span class="number">3</span></span><br><span class="line">*a.<span class="built_in">len</span> = newlen</span><br><span class="line">*(ptr+<span class="built_in">len</span>) = <span class="number">1</span></span><br><span class="line">*(ptr+<span class="built_in">len</span>+<span class="number">1</span>) = <span class="number">2</span></span><br><span class="line">*(ptr+<span class="built_in">len</span>+<span class="number">2</span>) = <span class="number">3</span></span><br></pre></td></tr></table></figure><p>æ˜¯å¦è¦†ç›–åŸå˜é‡çš„é€»è¾‘å…¶å®å·®ä¸å¤šï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºæœ€åçš„ç»“æœæ˜¯ä¸æ˜¯èµ‹å€¼ä¼šåŸæœ‰çš„å˜é‡ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©è¦†ç›–åŸæœ‰çš„å˜é‡ï¼Œä¹Ÿä¸éœ€è¦æ‹…å¿ƒåˆ‡ç‰‡çš„æ‹·è´ï¼Œå› ä¸º Go è¯­è¨€çš„ç¼–è¯‘å™¨å·²ç»å¯¹è¿™ç§æƒ…å†µä½œäº†ä¼˜åŒ–ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/iNK7eyh8BL6obQA.png" alt="golang-slice-append"></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»é€šè¿‡ <code>append</code> å…³é”®å­—è¢«è½¬æ¢çš„æ§åˆ¶æµäº†è§£äº†åœ¨åˆ‡ç‰‡å®¹é‡è¶³å¤Ÿæ—¶å¦‚ä½•å‘åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ ï¼Œä½†æ˜¯å½“åˆ‡ç‰‡çš„å®¹é‡ä¸è¶³æ—¶å°±ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L76-L191"><code>runtime.growslice</code></a> å‡½æ•°ä¸ºåˆ‡ç‰‡æ‰©å®¹ï¼Œæ‰©å®¹å°±æ˜¯ä¸ºåˆ‡ç‰‡åˆ†é…ä¸€å—æ–°çš„å†…å­˜ç©ºé—´å¹¶å°†åŸåˆ‡ç‰‡çš„å…ƒç´ å…¨éƒ¨æ‹·è´è¿‡å»ï¼Œæˆ‘ä»¬åˆ†å‡ éƒ¨åˆ†åˆ†æè¯¥æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">growslice</span><span class="params">(et *_type, old slice, <span class="built_in">cap</span> <span class="keyword">int</span>)</span> <span class="title">slice</span></span> &#123;</span><br><span class="line">newcap := old.<span class="built_in">cap</span></span><br><span class="line">doublecap := newcap + newcap</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">cap</span> &gt; doublecap &#123;</span><br><span class="line">newcap = <span class="built_in">cap</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> old.<span class="built_in">len</span> &lt; <span class="number">1024</span> &#123;</span><br><span class="line">newcap = doublecap</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> <span class="number">0</span> &lt; newcap &amp;&amp; newcap &lt; <span class="built_in">cap</span> &#123;</span><br><span class="line">newcap += newcap / <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> newcap &lt;= <span class="number">0</span> &#123;</span><br><span class="line">newcap = <span class="built_in">cap</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆ†é…å†…å­˜ç©ºé—´ä¹‹å‰éœ€è¦å…ˆç¡®å®šæ–°çš„åˆ‡ç‰‡å®¹é‡ï¼ŒGo è¯­è¨€æ ¹æ®åˆ‡ç‰‡çš„å½“å‰å®¹é‡é€‰æ‹©ä¸åŒçš„ç­–ç•¥è¿›è¡Œæ‰©å®¹ï¼š</p><ol><li>å¦‚æœæœŸæœ›å®¹é‡å¤§äºå½“å‰å®¹é‡çš„ä¸¤å€å°±ä¼šä½¿ç”¨æœŸæœ›å®¹é‡ï¼›</li><li>å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å°äº 1024 å°±ä¼šå°†å®¹é‡ç¿»å€ï¼›</li><li>å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å¤§äº 1024 å°±ä¼šæ¯æ¬¡å¢åŠ  25% çš„å®¹é‡ï¼Œç›´åˆ°æ–°å®¹é‡å¤§äºæœŸæœ›å®¹é‡ï¼›</li></ol><p>ç¡®å®šäº†åˆ‡ç‰‡çš„å®¹é‡ä¹‹åï¼Œå°±å¯ä»¥è®¡ç®—åˆ‡ç‰‡ä¸­æ–°æ•°ç»„å ç”¨çš„å†…å­˜äº†ï¼Œè®¡ç®—çš„æ–¹æ³•å°±æ˜¯å°†ç›®æ ‡å®¹é‡å’Œå…ƒç´ å¤§å°ç›¸ä¹˜ï¼Œè®¡ç®—æ–°å®¹é‡æ—¶å¯èƒ½ä¼šå‘ç”Ÿæº¢å‡ºæˆ–è€…è¯·æ±‚çš„å†…å­˜è¶…è¿‡ä¸Šé™ï¼Œåœ¨è¿™æ—¶å°±ä¼šç›´æ¥ <code>panic</code>ï¼Œä¸è¿‡ç›¸å…³çš„ä»£ç åœ¨è¿™é‡Œå°±è¢«çœç•¥äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> overflow <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> newlenmem, capmem <span class="keyword">uintptr</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">lenmem = <span class="keyword">uintptr</span>(old.<span class="built_in">len</span>) * et.size</span><br><span class="line">newlenmem = <span class="keyword">uintptr</span>(<span class="built_in">cap</span>) * et.size</span><br><span class="line">capmem, _ = math.MulUintptr(et.size, <span class="keyword">uintptr</span>(newcap))</span><br><span class="line">capmem = roundupsize(capmem)</span><br><span class="line">newcap = <span class="keyword">int</span>(capmem / et.size)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> p unsafe.Pointer</span><br><span class="line"><span class="keyword">if</span> et.kind&amp;kindNoPointers != <span class="number">0</span> &#123;</span><br><span class="line">p = mallocgc(capmem, <span class="literal">nil</span>, <span class="literal">false</span>)</span><br><span class="line">memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p = mallocgc(capmem, et, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">if</span> writeBarrier.enabled &#123;</span><br><span class="line">bulkBarrierPreWriteSrcOnly(<span class="keyword">uintptr</span>(p), <span class="keyword">uintptr</span>(old.array), lenmem)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">memmove(p, old.array, lenmem)</span><br><span class="line"><span class="keyword">return</span> slice&#123;p, old.<span class="built_in">len</span>, newcap&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåˆ‡ç‰‡ä¸­å…ƒç´ ä¸æ˜¯æŒ‡é’ˆç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨ <code>memclrNoHeapPointers</code> å°†è¶…å‡ºåˆ‡ç‰‡å½“å‰é•¿åº¦çš„ä½ç½®æ¸…ç©ºå¹¶åœ¨æœ€åä½¿ç”¨ <code>memmove</code> å°†åŸæ•°ç»„å†…å­˜ä¸­çš„å†…å®¹æ‹·è´åˆ°æ–°ç”³è¯·çš„å†…å­˜ä¸­ã€‚è¿™é‡Œçš„ <code>memclrNoHeapPointers</code> å’Œ <code>memmove</code> éƒ½æ˜¯ç”¨ç›®æ ‡æœºå™¨ä¸Šçš„æ±‡ç¼–æŒ‡ä»¤å®ç°çš„ã€‚</p><p><a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L76-L191"><code>runtime.growslice</code></a> å‡½æ•°æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>slice</code> ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†æ–°çš„æ•°ç»„æŒ‡é’ˆã€å¤§å°å’Œå®¹é‡ï¼Œè¿™ä¸ªè¿”å›çš„ä¸‰å…ƒç»„æœ€ç»ˆä¼šæ”¹å˜åŸæœ‰çš„åˆ‡ç‰‡ï¼Œå¸®åŠ© <code>append</code> å®Œæˆå…ƒç´ è¿½åŠ çš„åŠŸèƒ½ã€‚</p><h3 id="æ‹·è´åˆ‡ç‰‡"><a href="#æ‹·è´åˆ‡ç‰‡" class="headerlink" title="æ‹·è´åˆ‡ç‰‡"></a>æ‹·è´åˆ‡ç‰‡</h3><p>åˆ‡ç‰‡çš„æ‹·è´è™½ç„¶ä¸æ˜¯ä¸€ä¸ªå¸¸è§çš„æ“ä½œç±»å‹ï¼Œä½†æ˜¯å´æ˜¯æˆ‘ä»¬å­¦ä¹ åˆ‡ç‰‡å®ç°åŸç†å¿…é¡»è¦è°ˆåŠçš„ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>copy(a, b)</code> çš„å½¢å¼å¯¹åˆ‡ç‰‡è¿›è¡Œæ‹·è´æ—¶ï¼Œç¼–è¯‘æœŸé—´çš„ <a href="https://github.com/golang/go/blob/bf4990522263503a1219372cd8f1ee9422b51324/src/cmd/compile/internal/gc/walk.go#L2980-L3040"><code>cmd/compile/internal/gc.copyany</code></a> å‡½æ•°ä¹Ÿä¼šåˆ†ä¸¤ç§æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œå¦‚æœå½“å‰ <code>copy</code> ä¸æ˜¯åœ¨è¿è¡Œæ—¶è°ƒç”¨çš„ï¼Œ<code>copy(a, b)</code> ä¼šè¢«ç›´æ¥è½¬æ¢æˆä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n := <span class="built_in">len</span>(a)</span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="built_in">len</span>(b) &#123;</span><br><span class="line">    n = <span class="built_in">len</span>(b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> a.ptr != b.ptr &#123;</span><br><span class="line">    memmove(a.ptr, b.ptr, n*sizeof(elem(a))) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>memmove</code> ä¼šè´Ÿè´£å¯¹å†…å­˜è¿›è¡Œæ‹·è´ï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/440f7d64048cd94cba669e16fe92137ce6b84073/src/runtime/slice.go#L197-L230"><code>runtime.slicecopy</code></a> å‡½æ•°æ›¿æ¢è¿è¡ŒæœŸé—´è°ƒç”¨çš„ <code>copy</code>ï¼Œä¾‹å¦‚ï¼š<code>go copy(a, b)</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slicecopy</span><span class="params">(to, fm slice, width <span class="keyword">uintptr</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> fm.<span class="built_in">len</span> == <span class="number">0</span> || to.<span class="built_in">len</span> == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">n := fm.<span class="built_in">len</span></span><br><span class="line"><span class="keyword">if</span> to.<span class="built_in">len</span> &lt; n &#123;</span><br><span class="line">n = to.<span class="built_in">len</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> width == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">size := <span class="keyword">uintptr</span>(n) * width</span><br><span class="line"><span class="keyword">if</span> size == <span class="number">1</span> &#123;</span><br><span class="line">*(*<span class="keyword">byte</span>)(to.array) = *(*<span class="keyword">byte</span>)(fm.array)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">memmove(to.array, fm.array, size)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°çš„å®ç°éå¸¸ç›´æ¥ï¼Œä¸¤ç§ä¸åŒçš„æ‹·è´æ–¹å¼ä¸€èˆ¬éƒ½ä¼šé€šè¿‡ <code>memmove</code> å°†æ•´å—å†…å­˜ä¸­çš„å†…å®¹æ‹·è´åˆ°ç›®æ ‡çš„å†…å­˜åŒºåŸŸä¸­ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/FyjzandcAUmoJB8.png" alt="golang-slice-copy"></p><p>ç›¸æ¯”äºä¾æ¬¡å¯¹å…ƒç´ è¿›è¡Œæ‹·è´ï¼Œè¿™ç§æ–¹å¼èƒ½å¤Ÿæä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå“ªæ€•ä½¿ç”¨ <code>memmove</code> å¯¹å†…å­˜æˆå—è¿›è¡Œæ‹·è´ï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œè¿˜æ˜¯ä¼šå ç”¨éå¸¸å¤šçš„èµ„æºï¼Œåœ¨å¤§åˆ‡ç‰‡ä¸Šæ‰§è¡Œæ‹·è´æ“ä½œæ—¶ä¸€å®šè¦æ³¨æ„æ€§èƒ½å½±å“ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ•°ç»„æ˜¯ Go è¯­è¨€ä¸­é‡è¦çš„æ•°æ®ç»“æ„ï¼Œäº†è§£å®ƒçš„å®ç°èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£è¿™é—¨è¯­è¨€ï¼Œé€šè¿‡å¯¹å…¶å®ç°çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹æ•°ç»„çš„è®¿é—®å’Œèµ‹å€¼éœ€è¦åŒæ—¶ä¾èµ–ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ï¼Œå®ƒçš„å¤§å¤šæ•°æ“ä½œåœ¨ç¼–è¯‘æœŸé—´éƒ½ä¼šè½¬æ¢æˆå¯¹å†…å­˜çš„ç›´æ¥è¯»å†™ï¼Œåœ¨ä¸­é—´ä»£ç ç”ŸæˆæœŸé—´ï¼Œç¼–è¯‘å™¨è¿˜ä¼šæ’å…¥è¿è¡Œæ—¶æ–¹æ³• <code>panicIndex</code> è°ƒç”¨é˜²æ­¢å‘ç”Ÿè¶Šç•Œé”™è¯¯ã€‚</p><p>åˆ‡ç‰‡çš„å¾ˆå¤šåŠŸèƒ½éƒ½æ˜¯åœ¨è¿è¡Œæ—¶å®ç°çš„äº†ï¼Œæ— è®ºæ˜¯åˆå§‹åŒ–åˆ‡ç‰‡ï¼Œè¿˜æ˜¯å¯¹åˆ‡ç‰‡è¿›è¡Œè¿½åŠ æˆ–æ‰©å®¹éƒ½éœ€è¦è¿è¡Œæ—¶çš„æ”¯æŒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨é‡åˆ°å¤§åˆ‡ç‰‡æ‰©å®¹æˆ–è€…å¤åˆ¶æ—¶å¯èƒ½ä¼šå‘ç”Ÿå¤§è§„æ¨¡çš„å†…å­˜æ‹·è´ï¼Œä¸€å®šè¦åœ¨ä½¿ç”¨æ—¶å‡å°‘è¿™ç§æƒ…å†µçš„å‘ç”Ÿé¿å…å¯¹ç¨‹åºçš„æ€§èƒ½é€ æˆå½±å“ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://blog.golang.org/slices">Arrays, slices (and strings): The mechanics of â€˜appendâ€™</a></li><li><a href="https://stackoverflow.com/questions/30525184/array-vs-slice-accessing-speed">Array vs Slice: accessing speed</a></li><li><a href="https://blog.golang.org/slices">Arrays, slices (and strings): The mechanics of â€˜appendâ€™</a></li><li><a href="https://blog.golang.org/go-slices-usage-and-internals">Go Slices: usage and internals</a></li><li><a href="https://stackoverflow.com/questions/30525184/array-vs-slice-accessing-speed">Array vs Slice: accessing speed</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ç¼–è¯‘è¿‡ç¨‹</title>
      <link href="/2020/01/04/go/Go%E8%AF%AD%E8%A8%80%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/"/>
      <url>/2020/01/04/go/Go%E8%AF%AD%E8%A8%80%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>Goè¯­è¨€éœ€è¦ç¼–è¯‘æ‰èƒ½å¤Ÿè¿è¡Œï¼Œä¸ºäº†ç†è§£Goçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä»ç¼–è¯‘åŸç†çš„ä¸€äº›åŸºç¡€æ¦‚å¿µå‡ºå‘ï¼Œå¯¹Goçš„ç¼–è¯‘è¿‡ç¨‹è¿›è¡Œæ¢è®¨ã€‚</p><a id="more"></a><h2 id="ç¼–è¯‘åŸç†é¢„å¤‡çŸ¥è¯†"><a href="#ç¼–è¯‘åŸç†é¢„å¤‡çŸ¥è¯†" class="headerlink" title="ç¼–è¯‘åŸç†é¢„å¤‡çŸ¥è¯†"></a>ç¼–è¯‘åŸç†é¢„å¤‡çŸ¥è¯†</h2><h3 id="æŠ½è±¡è¯­æ³•æ ‘"><a href="#æŠ½è±¡è¯­æ³•æ ‘" class="headerlink" title="æŠ½è±¡è¯­æ³•æ ‘"></a>æŠ½è±¡è¯­æ³•æ ‘</h3><p>ï¼ˆASTï¼‰ï¼Œæ˜¯æºä»£ç è¯­æ³•çš„ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºï¼Œå®ƒç”¨æ ‘çŠ¶çš„æ–¹å¼è¡¨ç¤ºç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fn:1">1</a>ã€‚æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ¯ä¸€é¢—å­æ ‘éƒ½è¡¨ç¤ºä¸€ä¸ªè¯­æ³•å…ƒç´ ï¼Œä¾‹å¦‚ä¸€ä¸ª if else è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ä» <code>2 * 3 + 7</code> è¿™ä¸€è¡¨è¾¾å¼ä¸­è§£æå‡ºä¸‹å›¾æ‰€ç¤ºçš„æŠ½è±¡è¯­æ³•æ ‘ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="/Users/maywzh/Downloads/2019-12-20-15768548776645-abstract-syntax-tree.png" alt="2019-12-20-15768548776645-abstract-syntax-tree"></p><p>ä½œä¸ºç¼–è¯‘å™¨å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼ŒæŠ½è±¡è¯­æ³•æ ‘æŠ¹å»äº†æºä»£ç ä¸­ä¸é‡è¦çš„ä¸€äº›å­—ç¬¦ - ç©ºæ ¼ã€åˆ†å·æˆ–è€…æ‹¬å·ç­‰ç­‰ã€‚ç¼–è¯‘å™¨åœ¨æ‰§è¡Œå®Œè¯­æ³•åˆ†æä¹‹åä¼šè¾“å‡ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼Œè¿™ä¸ªæŠ½è±¡è¯­æ³•æ ‘ä¼šè¾…åŠ©ç¼–è¯‘å™¨è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç¡®å®šè¯­æ³•æ­£ç¡®çš„ç¨‹åºæ˜¯å¦å­˜åœ¨ä¸€äº›ç±»å‹ä¸åŒ¹é…æˆ–ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><h3 id="é™æ€å•èµ‹å€¼"><a href="#é™æ€å•èµ‹å€¼" class="headerlink" title="é™æ€å•èµ‹å€¼"></a>é™æ€å•èµ‹å€¼</h3><p><a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">é™æ€å•èµ‹å€¼</a>ï¼ˆStatic Single Assignment, SSAï¼‰æ˜¯ä¸­é—´ä»£ç çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¦‚æœä¸€ä¸ªä¸­é—´ä»£ç å…·æœ‰é™æ€å•èµ‹å€¼çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆæ¯ä¸ªå˜é‡å°±åªä¼šè¢«èµ‹å€¼ä¸€æ¬¡<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fn:2">2</a>ã€‚åœ¨å®è·µä¸­æˆ‘ä»¬é€šå¸¸ä¼šç”¨æ·»åŠ ä¸‹æ ‡çš„æ–¹å¼å®ç°æ¯ä¸ªå˜é‡åªèƒ½è¢«èµ‹å€¼ä¸€æ¬¡çš„ç‰¹æ€§ï¼Œè¿™é‡Œä»¥ä¸‹é¢çš„ä»£ç ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x := <span class="number">1</span></span><br><span class="line">x := <span class="number">2</span></span><br><span class="line">y := x</span><br></pre></td></tr></table></figure><p>æ ¹æ®åˆ†æï¼Œæˆ‘ä»¬å…¶å®èƒ½å¤Ÿå‘ç°ä¸Šè¿°çš„ä»£ç å…¶å®å¹¶ä¸éœ€è¦ç¬¬ä¸€ä¸ªå°† <code>1</code> èµ‹å€¼ç»™ <code>x</code> çš„è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯ <code>x := 1</code> è¿™ä¸€è¡¨è¾¾å¼åœ¨ä¸Šè¿°çš„ä»£ç ç‰‡æ®µä¸­æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x1 := <span class="number">1</span></span><br><span class="line">x2 := <span class="number">2</span></span><br><span class="line">y1 := x2</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨å…·æœ‰ SSA ç‰¹æ€§çš„ä¸­é—´ä»£ç æ—¶ï¼Œå°±å¯ä»¥éå¸¸æ¸…æ™°åœ°å‘ç°å˜é‡ <code>y1</code> çš„å€¼å’Œ <code>x1</code> æ˜¯å®Œå…¨æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œæ‰€ä»¥åœ¨æœºå™¨ç ç”Ÿæˆæ—¶å…¶å®å°±å¯ä»¥çœç•¥ç¬¬ä¸€æ­¥ï¼Œè¿™æ ·å°±èƒ½å‡å°‘éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ¥ä¼˜åŒ–è¿™ä¸€æ®µä»£ç ã€‚</p><p>åœ¨ä¸­é—´ä»£ç ä¸­ä½¿ç”¨ SSA çš„ç‰¹æ€§èƒ½å¤Ÿä¸ºæ•´ä¸ªç¨‹åºå®ç°ä»¥ä¸‹çš„ä¼˜åŒ–ï¼š</p><ol><li>å¸¸æ•°ä¼ æ’­ï¼ˆconstant propagationï¼‰</li><li>å€¼åŸŸä¼ æ’­ï¼ˆvalue range propagationï¼‰</li><li>ç¨€ç–æœ‰æ¡ä»¶çš„å¸¸æ•°ä¼ æ’­ï¼ˆsparse conditional constant propagationï¼‰</li><li>æ¶ˆé™¤æ— ç”¨çš„ç¨‹å¼ç ï¼ˆdead code eliminationï¼‰</li><li>å…¨åŸŸæ•°å€¼ç¼–å·ï¼ˆglobal value numberingï¼‰</li><li>æ¶ˆé™¤éƒ¨åˆ†çš„å†—ä½™ï¼ˆpartial redundancy eliminationï¼‰</li><li>å¼ºåº¦æŠ˜å‡ï¼ˆstrength reductionï¼‰</li><li>å¯„å­˜å™¨åˆ†é…ï¼ˆregister allocationï¼‰</li></ol><p>å› ä¸º SSA çš„ä¸»è¦ä½œç”¨æ˜¯å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥å®ƒæ˜¯ç¼–è¯‘å™¨åç«¯<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fn:3">3</a>çš„ä¸€éƒ¨åˆ†ï¼›å½“ç„¶ä»£ç ç¼–è¯‘é¢†åŸŸé™¤äº† SSA è¿˜æœ‰å¾ˆå¤šä¸­é—´ä»£ç çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p><h3 id="æŒ‡ä»¤é›†"><a href="#æŒ‡ä»¤é›†" class="headerlink" title="æŒ‡ä»¤é›†"></a>æŒ‡ä»¤é›†</h3><p>æœ€åè¦ä»‹ç»çš„ä¸€ä¸ªé¢„å¤‡çŸ¥è¯†å°±æ˜¯<a href="https://en.wikipedia.org/wiki/Instruction_set_architecture">æŒ‡ä»¤é›†</a>äº†ï¼Œå¾ˆå¤šå¼€å‘è€…éƒ½ä¼šé‡åˆ°åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„ç»“æœå’Œæœ¬åœ°ä¸åŒçš„é—®é¢˜ï¼Œå¯¼è‡´è¿™ç§æƒ…å†µçš„åŸå› å…¶å®éå¸¸å¤æ‚ï¼Œä¸åŒæœºå™¨ä½¿ç”¨ä¸åŒçš„æŒ‡ä»¤ä¹Ÿæ˜¯å¯èƒ½çš„åŸå› ä¹‹ä¸€ã€‚</p><p>æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ <code>uname -m</code> å°±èƒ½å¤Ÿè·å¾—å½“å‰æœºå™¨ä¸Šç¡¬ä»¶çš„ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -m</span><br><span class="line">x86_64</span><br></pre></td></tr></table></figure><p>x86 æ˜¯ç›®å‰æ¯”è¾ƒå¸¸è§çš„æŒ‡ä»¤é›†ï¼Œé™¤äº† x86 ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æŒ‡ä»¤é›†ï¼Œä¸åŒçš„å¤„ç†å™¨ä½¿ç”¨äº†ä¸åŒçš„æ¶æ„å’Œæœºå™¨è¯­è¨€ï¼Œæ‰€ä»¥å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸ºäº†åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œéœ€è¦å°†æºä»£ç æ ¹æ®æ¶æ„ç¿»è¯‘æˆä¸åŒçš„æœºå™¨ä»£ç ã€‚</p><p>å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœºï¼ˆCISCï¼‰å’Œç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼ˆRISCï¼‰æ˜¯ç›®å‰çš„ä¸¤ç§ CPU åŒºåˆ«ï¼Œå®ƒä»¬åœ¨è®¾è®¡ç†å¿µä¸Šä¼šæœ‰ä¸€äº›ä¸åŒï¼Œä»åå­—æˆ‘ä»¬å°±èƒ½çœ‹å‡ºæ¥è¿™ä¸¤ç§ä¸åŒçš„è®¾è®¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p><ul><li>å¤æ‚æŒ‡ä»¤é›†é€šè¿‡å¢åŠ æŒ‡ä»¤çš„æ•°é‡å‡å°‘éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ•°ï¼›</li><li>ç²¾ç®€æŒ‡ä»¤é›†èƒ½ä½¿ç”¨æ›´å°‘çš„æŒ‡ä»¤å®Œæˆç›®æ ‡çš„è®¡ç®—ä»»åŠ¡ï¼›</li></ul><p>æ—©æœŸçš„ CPU ä¸ºäº†å‡å°‘æœºå™¨è¯­è¨€æŒ‡ä»¤çš„æ•°é‡ä½¿ç”¨å¤æ‚æŒ‡ä»¤é›†å®Œæˆè®¡ç®—ä»»åŠ¡ï¼Œè¿™ä¸¤è€…å…¶å®å¹¶æ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œå®ƒä»¬åªæ˜¯åœ¨ä¸€äº›è®¾è®¡ä¸Šçš„é€‰æ‹©ä¸åŒä»¥è¾¾åˆ°ä¸åŒçš„ç›®çš„ã€‚</p><h2 id="Goç¼–è¯‘"><a href="#Goç¼–è¯‘" class="headerlink" title="Goç¼–è¯‘"></a>Goç¼–è¯‘</h2><p>Go è¯­è¨€ç¼–è¯‘å™¨çš„æºä»£ç åœ¨ <code>src/cmd/compile</code> ç›®å½•ä¸­ï¼Œç›®å½•ä¸‹çš„æ–‡ä»¶å…±åŒç»„æˆäº† Go è¯­è¨€çš„ç¼–è¯‘å™¨ã€‚ç¼–è¯‘å™¨æœ‰å‰ç«¯å’Œåç«¯ï¼Œç¼–è¯‘å™¨çš„å‰ç«¯ä¸€èˆ¬æ‰¿æ‹…ç€è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç±»å‹æ£€æŸ¥å’Œä¸­é—´ä»£ç ç”Ÿæˆå‡ éƒ¨åˆ†å·¥ä½œï¼Œè€Œç¼–è¯‘å™¨åç«¯ä¸»è¦è´Ÿè´£ç›®æ ‡ä»£ç çš„ç”Ÿæˆå’Œä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯å°†ä¸­é—´ä»£ç ç¿»è¯‘æˆç›®æ ‡æœºå™¨èƒ½å¤Ÿè¿è¡Œçš„äºŒè¿›åˆ¶æœºå™¨ç ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/aVgqxoZyL265X8m.png" alt="complication-process"></p><p>Go çš„ç¼–è¯‘å™¨åœ¨é€»è¾‘ä¸Šå¯ä»¥è¢«åˆ†æˆå››ä¸ªé˜¶æ®µï¼š<strong>è¯æ³•ä¸è¯­æ³•åˆ†æã€ç±»å‹æ£€æŸ¥å’Œ AST è½¬æ¢ã€é€šç”¨ SSA ç”Ÿæˆå’Œæœ€åçš„æœºå™¨ä»£ç ç”Ÿæˆ</strong>ã€‚</p><h3 id="è¯æ³•ä¸è¯­æ³•åˆ†æ"><a href="#è¯æ³•ä¸è¯­æ³•åˆ†æ" class="headerlink" title="è¯æ³•ä¸è¯­æ³•åˆ†æ"></a>è¯æ³•ä¸è¯­æ³•åˆ†æ</h3><p>æ‰€æœ‰çš„ç¼–è¯‘è¿‡ç¨‹å…¶å®éƒ½æ˜¯ä»è§£æä»£ç çš„æºæ–‡ä»¶å¼€å§‹çš„ï¼Œè¯æ³•åˆ†æçš„ä½œç”¨å°±æ˜¯è§£ææºä»£ç æ–‡ä»¶ï¼Œå®ƒå°†æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²åºåˆ—è½¬æ¢æˆ Token åºåˆ—ï¼Œæ–¹ä¾¿åé¢çš„å¤„ç†å’Œè§£æï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠæ‰§è¡Œè¯æ³•åˆ†æçš„ç¨‹åºç§°ä¸ºè¯æ³•è§£æå™¨ï¼ˆlexerï¼‰ã€‚</p><p>è€Œè¯­æ³•åˆ†æçš„è¾“å…¥å°±æ˜¯è¯æ³•åˆ†æå™¨è¾“å‡ºçš„ Token åºåˆ—ï¼Œè¿™äº›åºåˆ—ä¼šæŒ‰ç…§é¡ºåºè¢«è¯­æ³•åˆ†æå™¨è¿›è¡Œè§£æï¼Œè¯­æ³•çš„è§£æè¿‡ç¨‹å°±æ˜¯å°†è¯æ³•åˆ†æç”Ÿæˆçš„ Token æŒ‰ç…§è¯­è¨€å®šä¹‰å¥½çš„æ–‡æ³•ï¼ˆGrammarï¼‰è‡ªä¸‹è€Œä¸Šæˆ–è€…è‡ªä¸Šè€Œä¸‹çš„è¿›è¡Œè§„çº¦ï¼Œæ¯ä¸€ä¸ª Go çš„æºä»£ç æ–‡ä»¶æœ€ç»ˆä¼šè¢«å½’çº³æˆä¸€ä¸ª <a href="https://golang.org/ref/spec#Source_file_organization"><code>SourceFile</code></a> ç»“æ„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SourceFile = PackageClause <span class="string">&quot;;&quot;</span> &#123; ImportDecl <span class="string">&quot;;&quot;</span> &#125; &#123; TopLevelDecl <span class="string">&quot;;&quot;</span> &#125; .</span><br></pre></td></tr></table></figure><p>è¯æ³•åˆ†æä¼šè¿”å›ä¸€ä¸ªä¸åŒ…å«ç©ºæ ¼ã€æ¢è¡Œç­‰å­—ç¬¦çš„ Token åºåˆ—ï¼Œä¾‹å¦‚ï¼š<code>package</code>, <code>json</code>, <code>import</code>, <code>(</code>, <code>io</code>, <code>)</code>, â€¦ï¼Œè€Œè¯­æ³•åˆ†æä¼šæŠŠ Token åºåˆ—è½¬æ¢æˆæœ‰æ„ä¹‰çš„ç»“æ„ä½“ï¼Œä¹Ÿå°±æ˜¯è¯­æ³•æ ‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;json.go&quot;</span>: SourceFile &#123;</span><br><span class="line">    PackageName: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">    ImportDecl: []Import&#123;</span><br><span class="line">        <span class="string">&quot;io&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    TopLevelDecl: ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† Token è½¬æ¢æˆä¸Šè¿°è¯­æ³•æ ‘å°±ä¼šä½¿ç”¨è¯­æ³•è§£æå™¨ï¼Œè¯­æ³•è§£æçš„ç»“æœå…¶å®å°±æ˜¯ä¸Šé¢ä»‹ç»è¿‡çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œæ¯ä¸€ä¸ª AST éƒ½å¯¹åº”ç€ä¸€ä¸ªå•ç‹¬çš„ Go è¯­è¨€æ–‡ä»¶ï¼Œè¿™ä¸ªæŠ½è±¡è¯­æ³•æ ‘ä¸­åŒ…æ‹¬å½“å‰æ–‡ä»¶å±äºçš„åŒ…åã€å®šä¹‰çš„å¸¸é‡ã€ç»“æ„ä½“å’Œå‡½æ•°ç­‰ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/uniNRZGjIfKcF43.png" alt="golang-files-and-ast"></p><p><strong>å›¾ 2-3 ä»æºæ–‡ä»¶åˆ°è¯­æ³•æ ‘</strong></p><p>å¦‚æœåœ¨è¯­æ³•è§£æçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»»ä½•è¯­æ³•é”™è¯¯ï¼Œéƒ½ä¼šè¢«è¯­æ³•è§£æå™¨å‘ç°å¹¶å°†æ¶ˆæ¯æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼Œæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¹Ÿä¼šéšç€é”™è¯¯çš„å‡ºç°è€Œè¢«ä¸­æ­¢ã€‚</p><h3 id="ç±»å‹æ£€æŸ¥"><a href="#ç±»å‹æ£€æŸ¥" class="headerlink" title="ç±»å‹æ£€æŸ¥"></a>ç±»å‹æ£€æŸ¥</h3><p>å½“æ‹¿åˆ°ä¸€ç»„æ–‡ä»¶çš„æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼ŒGo è¯­è¨€çš„ç¼–è¯‘å™¨ä¼šå¯¹è¯­æ³•æ ‘ä¸­å®šä¹‰å’Œä½¿ç”¨çš„ç±»å‹è¿›è¡Œæ£€æŸ¥ï¼Œç±»å‹æ£€æŸ¥åˆ†åˆ«ä¼šæŒ‰ç…§ä»¥ä¸‹çš„é¡ºåºå¯¹ä¸åŒç±»å‹çš„èŠ‚ç‚¹è¿›è¡ŒéªŒè¯å’Œå¤„ç†ï¼š</p><ol><li>å¸¸é‡ã€ç±»å‹å’Œå‡½æ•°ååŠç±»å‹ï¼›</li><li>å˜é‡çš„èµ‹å€¼å’Œåˆå§‹åŒ–ï¼›</li><li>å‡½æ•°å’Œé—­åŒ…çš„ä¸»ä½“ï¼›</li><li>å“ˆå¸Œé”®å€¼å¯¹çš„ç±»å‹ï¼›</li><li>å¯¼å…¥å‡½æ•°ä½“ï¼›</li><li>å¤–éƒ¨çš„å£°æ˜ï¼›</li></ol><p>é€šè¿‡å¯¹æ•´é¢—æŠ½è±¡è¯­æ³•æ ‘çš„éå†ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå¯¹å½“å‰å­æ ‘çš„ç±»å‹è¿›è¡ŒéªŒè¯ï¼Œä»¥ä¿è¯å½“å‰èŠ‚ç‚¹ä¸Šä¸ä¼šå‡ºç°ç±»å‹é”™è¯¯çš„é—®é¢˜ï¼Œæ‰€æœ‰çš„ç±»å‹é”™è¯¯å’Œä¸åŒ¹é…éƒ½ä¼šåœ¨è¿™ä¸€ä¸ªé˜¶æ®µè¢«å‘ç°å’Œæš´éœ²å‡ºæ¥ï¼Œç»“æ„ä½“æ˜¯å¦å®ç°äº†æŸäº›æ¥å£ä¹Ÿä¼šåœ¨è¿™ä¸€é˜¶æ®µè¢«æ£€æŸ¥å‡ºæ¥ã€‚</p><p>ç±»å‹æ£€æŸ¥é˜¶æ®µä¸æ­¢ä¼šå¯¹èŠ‚ç‚¹çš„ç±»å‹è¿›è¡ŒéªŒè¯ï¼Œè¿˜ä¼šå±•å¼€å’Œæ”¹å†™ä¸€äº›å†…å»ºçš„å‡½æ•°ï¼Œä¾‹å¦‚ <code>make</code> å…³é”®å­—åœ¨è¿™ä¸ªé˜¶æ®µä¼šæ ¹æ®å­æ ‘çš„ç»“æ„è¢«æ›¿æ¢æˆ <code>makeslice</code> æˆ–è€… <code>makechan</code> ç­‰å‡½æ•°ã€‚ç±»å‹æ£€æŸ¥è¿™ä¸€è¿‡ç¨‹åœ¨æ•´ä¸ªç¼–è¯‘æµç¨‹ä¸­è¿˜æ˜¯éå¸¸é‡è¦çš„ï¼ŒGo è¯­è¨€çš„å¾ˆå¤šå…³é”®å­—éƒ½ä¾èµ–ç±»å‹æ£€æŸ¥æœŸé—´çš„å±•å¼€å’Œæ”¹å†™ã€‚</p><h3 id="ä¸­é—´ä»£ç ç”Ÿæˆ"><a href="#ä¸­é—´ä»£ç ç”Ÿæˆ" class="headerlink" title="ä¸­é—´ä»£ç ç”Ÿæˆ"></a>ä¸­é—´ä»£ç ç”Ÿæˆ</h3><p>å½“æˆ‘ä»¬å°†æºæ–‡ä»¶è½¬æ¢æˆäº†æŠ½è±¡è¯­æ³•æ ‘ã€å¯¹æ•´æ£µæ ‘çš„è¯­æ³•è¿›è¡Œè§£æå¹¶è¿›è¡Œç±»å‹æ£€æŸ¥ä¹‹åï¼Œå°±å¯ä»¥è®¤ä¸ºå½“å‰æ–‡ä»¶ä¸­çš„ä»£ç ä¸å­˜åœ¨è¯­æ³•é”™è¯¯å’Œç±»å‹é”™è¯¯çš„é—®é¢˜äº†ï¼ŒGo è¯­è¨€çš„ç¼–è¯‘å™¨å°±ä¼šå°†è¾“å…¥çš„æŠ½è±¡è¯­æ³•æ ‘è½¬æ¢æˆä¸­é—´ä»£ç ã€‚</p><p>åœ¨ç±»å‹æ£€æŸ¥ä¹‹åï¼Œå°±ä¼šé€šè¿‡ä¸€ä¸ªåä¸º <code>compileFunctions</code> çš„å‡½æ•°å¼€å§‹å¯¹æ•´ä¸ª Go è¯­è¨€é¡¹ç›®ä¸­çš„å…¨éƒ¨å‡½æ•°è¿›è¡Œç¼–è¯‘ï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨ä¸€ä¸ªç¼–è¯‘é˜Ÿåˆ—ä¸­ç­‰å¾…å‡ ä¸ªåç«¯å·¥ä½œåç¨‹çš„æ¶ˆè´¹ï¼Œè¿™äº›å¹¶å‘æ‰§è¡Œçš„ Goroutine ä¼šå°†æ‰€æœ‰å‡½æ•°å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘è½¬æ¢æˆä¸­é—´ä»£ç ã€‚<br><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/GYENCH8jIwcRxmT.png" alt="concurrency-compiling"></p><p>ç”±äº Go è¯­è¨€ç¼–è¯‘å™¨çš„ä¸­é—´ä»£ç ä½¿ç”¨äº† SSA çš„ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€é˜¶æ®µæˆ‘ä»¬å°±èƒ½å¤Ÿåˆ†æå‡ºä»£ç ä¸­çš„æ— ç”¨å˜é‡å’Œç‰‡æ®µå¹¶å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚</p><p>Go è¯­è¨€æºä»£ç çš„ <a href="https://github.com/golang/go/tree/master/src/cmd/compile/internal"><code>src/cmd/compile/internal</code></a> ç›®å½•ä¸­åŒ…å«äº†å¾ˆå¤šæœºå™¨ç ç”Ÿæˆç›¸å…³çš„åŒ…ï¼Œä¸åŒç±»å‹çš„ CPU åˆ†åˆ«ä½¿ç”¨äº†ä¸åŒçš„åŒ…ç”Ÿæˆæœºå™¨ç ï¼Œå…¶ä¸­åŒ…æ‹¬ amd64ã€armã€arm64ã€mipsã€mips64ã€ppc64ã€s390xã€x86 å’Œ wasmï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰è¶£çš„å°±æ˜¯ WebAssemblyï¼ˆWasmï¼‰<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fn:7">7</a>äº†ã€‚</p><p>ä½œä¸ºä¸€ç§åœ¨æ ˆè™šæ‹Ÿæœºä¸Šä½¿ç”¨çš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ï¼Œå®ƒçš„è®¾è®¡çš„ä¸»è¦ç›®æ ‡å°±æ˜¯åœ¨ Web æµè§ˆå™¨ä¸Šæä¾›ä¸€ç§å…·æœ‰é«˜å¯ç§»æ¤æ€§çš„ç›®æ ‡è¯­è¨€ã€‚Go è¯­è¨€çš„ç¼–è¯‘å™¨æ—¢ç„¶èƒ½å¤Ÿç”Ÿæˆ Wasm æ ¼å¼çš„æŒ‡ä»¤ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿè¿è¡Œåœ¨å¸¸è§çš„ä¸»æµæµè§ˆå™¨ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ GOARCH=wasm GOOS=js go build -o lib.wasm main.go</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„å‘½ä»¤å°† Go çš„æºä»£ç ç¼–è¯‘æˆèƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸Šè¿è¡Œ WebAssembly æ–‡ä»¶ï¼Œå½“ç„¶é™¤äº†è¿™ç§æ–°å…´çš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ä¹‹å¤–ï¼ŒGo è¯­è¨€ç»è¿‡ç¼–è¯‘è¿˜å¯ä»¥è¿è¡Œåœ¨å‡ ä¹å…¨éƒ¨çš„ä¸»æµæœºå™¨ä¸Šï¼Œä¸è¿‡å¯¹äºé™¤äº† Linux å’Œ Darwin ä¹‹å¤–çš„æœºå™¨ä¸Šå…¼å®¹æ€§ä¸Šå¯èƒ½è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šGo Plugin è‡³ä»Šä»ç„¶ä¸æ”¯æŒ Windows<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fn:8">8</a>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/sCoQZ6vRiTbduF7.png" alt="supported-hardware"></p><h3 id="ç¼–è¯‘å™¨å…¥å£"><a href="#ç¼–è¯‘å™¨å…¥å£" class="headerlink" title="ç¼–è¯‘å™¨å…¥å£"></a>ç¼–è¯‘å™¨å…¥å£</h3><p>Go è¯­è¨€çš„ç¼–è¯‘å™¨å…¥å£åœ¨ <a href="https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/main.go"><code>src/cmd/compile/internal/gc/main.go</code></a> æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ª 600 å¤šè¡Œçš„ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/main.go#L144-L796"><code>Main</code></a> å‡½æ•°å°±æ˜¯ Go è¯­è¨€ç¼–è¯‘å™¨çš„ä¸»ç¨‹åºï¼Œè¯¥å‡½æ•°ä¼šå…ˆè·å–å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°å¹¶æ›´æ–°ç¼–è¯‘é€‰é¡¹å’Œé…ç½®ï¼Œéšåå°±ä¼šå¼€å§‹è¿è¡Œ <code>parseFiles</code> å‡½æ•°å¯¹è¾“å…¥çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œè¯æ³•ä¸è¯­æ³•åˆ†æå¾—åˆ°æ–‡ä»¶å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Main</span><span class="params">(archInit <span class="keyword">func</span>(*Arch)</span>)</span> &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">lines := parseFiles(flag.Args())</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±ä¼šåˆ†ä¹ä¸ªé˜¶æ®µå¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œæ›´æ–°å’Œç¼–è¯‘ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢ä»‹ç»çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šç»å†ç±»å‹æ£€æŸ¥ã€SSA ä¸­é—´ä»£ç ç”Ÿæˆä»¥åŠæœºå™¨ç ç”Ÿæˆä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æ£€æŸ¥å¸¸é‡ã€ç±»å‹å’Œå‡½æ•°çš„ç±»å‹ï¼›</li><li>å¤„ç†å˜é‡çš„èµ‹å€¼ï¼›</li><li>å¯¹å‡½æ•°çš„ä¸»ä½“è¿›è¡Œç±»å‹æ£€æŸ¥ï¼›</li><li>å†³å®šå¦‚ä½•æ•è·å˜é‡ï¼›</li><li>æ£€æŸ¥å†…è”å‡½æ•°çš„ç±»å‹ï¼›</li><li>è¿›è¡Œé€ƒé€¸åˆ†æï¼›</li><li>å°†é—­åŒ…çš„ä¸»ä½“è½¬æ¢æˆå¼•ç”¨çš„æ•è·å˜é‡ï¼›</li><li>ç¼–è¯‘é¡¶å±‚å‡½æ•°ï¼›</li><li>æ£€æŸ¥å¤–éƒ¨ä¾èµ–çš„å£°æ˜ï¼›</li></ol><p>å¯¹æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹æœ‰ä¸€ä¸ªé¡¶å±‚çš„è®¤è¯†ä¹‹åï¼Œæˆ‘ä»¬é‡æ–°å›åˆ°è¯æ³•å’Œè¯­æ³•åˆ†æåçš„å…·ä½“æµç¨‹ï¼Œåœ¨è¿™é‡Œç¼–è¯‘å™¨ä¼šå¯¹ç”Ÿæˆè¯­æ³•æ ‘ä¸­çš„èŠ‚ç‚¹æ‰§è¡Œç±»å‹æ£€æŸ¥ï¼Œé™¤äº†å¸¸é‡ã€ç±»å‹å’Œå‡½æ•°è¿™äº›é¡¶å±‚å£°æ˜ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šå¯¹å˜é‡çš„èµ‹å€¼è¯­å¥ã€å‡½æ•°ä¸»ä½“ç­‰ç»“æ„è¿›è¡Œæ£€æŸ¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(xtop); i++ &#123;</span><br><span class="line">n := xtop[i]</span><br><span class="line"><span class="keyword">if</span> op := n.Op; op != ODCL &amp;&amp; op != OAS &amp;&amp; op != OAS2 &amp;&amp; (op != ODCLTYPE || !n.Left.Name.Param.Alias) &#123;</span><br><span class="line">xtop[i] = typecheck(n, ctxStmt)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(xtop); i++ &#123;</span><br><span class="line">n := xtop[i]</span><br><span class="line"><span class="keyword">if</span> op := n.Op; op == ODCL || op == OAS || op == OAS2 || op == ODCLTYPE &amp;&amp; n.Left.Name.Param.Alias &#123;</span><br><span class="line">xtop[i] = typecheck(n, ctxStmt)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»å‹æ£€æŸ¥ä¼šéå†ä¼ å…¥èŠ‚ç‚¹çš„å…¨éƒ¨å­èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¯¹ <code>make</code> ç­‰å…³é”®å­—è¿›è¡Œå±•å¼€å’Œé‡å†™ï¼Œåœ¨ç±»å‹æ£€æŸ¥ä¼šæ”¹å˜è¯­æ³•æ ‘ä¸­çš„ä¸€äº›èŠ‚ç‚¹ï¼Œä¸ä¼šç”Ÿæˆæ–°çš„å˜é‡æˆ–è€…è¯­æ³•æ ‘ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„ç»“æŸä¹Ÿæ„å‘³ç€æºä»£ç ä¸­å·²ç»ä¸å­˜åœ¨è¯­æ³•é”™è¯¯å’Œç±»å‹é”™è¯¯ï¼Œä¸­é—´ä»£ç å’Œæœºå™¨ç éƒ½å¯ä»¥æ ¹æ®æŠ½è±¡è¯­æ³•æ ‘æ­£å¸¸ç”Ÿæˆäº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">initssaconfig()</span><br><span class="line"></span><br><span class="line">peekitabs()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(xtop); i++ &#123;</span><br><span class="line">n := xtop[i]</span><br><span class="line"><span class="keyword">if</span> n.Op == ODCLFUNC &#123;</span><br><span class="line">funccompile(n)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compileFunctions()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, n := <span class="keyword">range</span> externdcl &#123;</span><br><span class="line"><span class="keyword">if</span> n.Op == ONAME &#123;</span><br><span class="line">externdcl[i] = typecheck(externdcl[i], ctxExpr)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkMapKeys()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»ç¨‹åºè¿è¡Œçš„æœ€åï¼Œä¼šå°†é¡¶å±‚çš„å‡½æ•°ç¼–è¯‘æˆä¸­é—´ä»£ç å¹¶æ ¹æ®ç›®æ ‡çš„ CPU æ¶æ„ç”Ÿæˆæœºå™¨ç ï¼Œä¸è¿‡åœ¨è¿™ä¸€é˜¶æ®µä¹Ÿæœ‰å¯èƒ½ä¼šå†æ¬¡å¯¹å¤–éƒ¨ä¾èµ–è¿›è¡Œç±»å‹æ£€æŸ¥ä»¥éªŒè¯æ­£ç¡®æ€§ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><p>æŠ½è±¡è¯­æ³•æ ‘ <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">https://en.wikipedia.org/wiki/Abstract_syntax_tree</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:1">â†©ï¸</a></p></li><li><p>é™æ€å•èµ‹å€¼ <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">https://en.wikipedia.org/wiki/Static_single_assignment_form</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:2">â†©ï¸</a></p></li><li><p>ç¼–è¯‘å™¨ä¸€èˆ¬åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œå…¶ä¸­å‰ç«¯çš„ä¸»è¦å·¥ä½œæ˜¯å°†æºä»£ç ç¿»è¯‘æˆç¼–ç¨‹è¯­è¨€æ— å…³çš„ä¸­é—´è¡¨ç¤ºï¼Œè€Œåç«¯ä¸»è¦è´Ÿè´£ç›®æ ‡ä»£ç çš„ä¼˜åŒ–å’Œç”Ÿæˆã€‚ <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:3">â†©ï¸</a></p></li><li><p>æŒ‡ä»¤é›†æ¶æ„æ˜¯è®¡ç®—æœºçš„æŠ½è±¡æ¨¡å‹ï¼Œä¹Ÿè¢«ç§°ä½œæ¶æ„æˆ–è€…è®¡ç®—æ¶æ¶æ„ <a href="https://en.wikipedia.org/wiki/Instruction_set_architecture">https://en.wikipedia.org/wiki/Instruction_set_architecture</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:4">â†©ï¸</a></p></li><li><p><code>SourceFile</code> è¡¨ç¤ºä¸€ä¸ª Go è¯­è¨€æºæ–‡ä»¶ï¼Œå®ƒç”± <code>package</code> å®šä¹‰ã€å¤šä¸ª <code>import</code> è¯­å¥ä»¥åŠé¡¶å±‚çš„å£°æ˜ç»„æˆ <a href="https://golang.org/ref/spec#Source_file_organization">https://golang.org/ref/spec#Source_file_organization</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:5">â†©ï¸</a></p></li><li><p>å…³äº Go è¯­è¨€æ–‡æ³•çš„æ˜¯ä¸æ˜¯ LALR(1) çš„è®¨è®º <a href="https://groups.google.com/forum/#!msg/golang-nuts/jVjbH2-emMQ/UdZlSNhd3DwJ">https://groups.google.com/forum/#!msg/golang-nuts/jVjbH2-emMQ/UdZlSNhd3DwJ</a></p><p>LALR çš„å…¨ç§°æ˜¯ Look-Ahead LRï¼Œå¤§å¤šæ•°çš„é€šç”¨ç¼–ç¨‹è¯­è¨€éƒ½ä¼šä½¿ç”¨ LALR çš„æ–‡æ³• <a href="https://en.wikipedia.org/wiki/LALR_parser">https://en.wikipedia.org/wiki/LALR_parser</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:6">â†©ï¸</a></p></li><li><p>WebAssembly æ˜¯åŸºäºæ ˆçš„è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤ï¼Œç®€ç§° Wasm <a href="https://webassembly.org/">https://webassembly.org/</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:7">â†©ï¸</a></p></li><li><p>plugin: add Windows support #19282 <a href="https://github.com/golang/go/issues/19282">https://github.com/golang/go/issues/19282</a> <a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/#fnref:8">â†©ï¸</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯†ç å­¦ä¹‹æ¤­åœ†æ›²çº¿</title>
      <link href="/2019/11/05/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF/"/>
      <url>/2019/11/05/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ã€Šå‡ ä½•ã€‹è¯¾æœ¬é‡Œå­¦è¿‡äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹è¡¨ç¤ºç›´çº¿ï¼ŒäºŒå…ƒäºŒæ¬¡æ–¹ç¨‹è¡¨ç¤ºåœ†é”¥æ›²çº¿(åœ†ï¼Œæ¤­åœ†ï¼ŒåŒæ›²çº¿å’ŒæŠ›ç‰©çº¿)ï¼Œé‚£ä¹ˆäºŒå…ƒä¸‰æ¬¡æ–¹ç¨‹è¡¨ç¤ºä»€ä¹ˆæ›²çº¿å‘¢ï¼Ÿç­”æ¡ˆè‡ªç„¶å°±æ˜¯æ¤­åœ†æ›²çº¿ã€‚ä¸ºäº†æ–¹ä¾¿ç ”ç©¶ï¼Œå¤§éƒ¨åˆ†çš„äºŒå…ƒä¸‰æ¬¡æ–¹ç¨‹å¯ä»¥ç®€åŒ–æˆé­å°”æ–¯ç‰¹æ‹‰æ–¯æ–¹ç¨‹çš„å½¢å¼ã€‚å…¶ä¸­ï¼Œç³»æ•°a å’Œb éœ€è¦æ»¡è¶³æ¡ä»¶$4a^3 + 27b^2 \neq 0$ï¼Œè¯¥æ¡ä»¶ä¿è¯æ–¹ç¨‹ä¸­ä¸ä¼šå‡ºç°éå¥‡å¼‚ç‚¹ä»¥è·å¾—å¹³æ»‘çš„æ¤­åœ†æ›²çº¿ã€‚</p><p>æ¤­åœ†æ›²çº¿çš„å½¢çŠ¶è·Ÿæ¤­åœ†æ¯«æ— å…³ç³»ã€‚å½“åˆæ•°å­¦å®¶ä»¬åœ¨ç ”ç©¶å¦‚ä½•è®¡ç®—æ¤­åœ†å¼§é•¿çš„æ—¶å€™å‘ç°éœ€è¦æ±‚è§£å¦‚ä¸‹ç±»å‹çš„ç§¯åˆ†, ç”±äºå’Œæ¤­åœ†ç›¸å…³ï¼Œç§¯åˆ†ä¸­çš„åˆ†æ¯é¡¹$y =\sqrt{(x^3+ax+b)}$ ä¾¿è¢«ç§°ä½œæ¤­åœ†æ›²çº¿ã€‚</p><script type="math/tex; mode=display">\int_{\alpha}^{\beta}{\frac{dx}{\sqrt{x^3+ax+b}}}</script><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€äº›åˆæ³•çš„æ¤­åœ†æ›²çº¿ï¼Œ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/HVAGpxoOJeICg4L.png" alt="img"></p><p>ä¸‹å›¾å±•ç¤ºäº†ä¸¤ç§éæ³•çš„æ¤­åœ†æ›²çº¿ï¼Œåˆ†åˆ«å­˜åœ¨ä¸€ä¸ªå°–ç‚¹å’Œå‰ç‚¹ä½¿æ›²çº¿ä¸å¹³æ»‘ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/PBChKjWvuZrtcwx.png" alt="6663612-59e2ae0394772adb"></p><a id="more"></a><h2 id="å¯†ç å­¦ä¸æœ‰é™å¾ªç¯ç¾¤"><a href="#å¯†ç å­¦ä¸æœ‰é™å¾ªç¯ç¾¤" class="headerlink" title="å¯†ç å­¦ä¸æœ‰é™å¾ªç¯ç¾¤"></a>å¯†ç å­¦ä¸æœ‰é™å¾ªç¯ç¾¤</h2><p>ç°ä»£å¯†ç å­¦ç®—æ³•å’Œåè®®ä¸­ï¼Œæ¶ˆæ¯æ˜¯ä½œä¸ºæœ‰é™ç©ºé—´ä¸­çš„æ•°å­—æˆ–å…ƒç´ æ¥å¤„ç†çš„ã€‚åŠ å¯†å’Œè§£å¯†çš„å„ç§æ“ä½œå¿…é¡»åœ¨æ¶ˆæ¯ä¹‹é—´è¿›è¡Œå˜æ¢ï¼Œä»¥ä½¿å˜æ¢æœä»æœ‰é™æ¶ˆæ¯ç©ºé—´å†…éƒ¨çš„å°é—­æ€§ã€‚ç„¶è€Œï¼Œæ•°çš„ä¸€èˆ¬è¿ç®—è¯¸å¦‚åŠ å‡ä¹˜é™¤å¹¶ä¸æ»¡è¶³æœ‰é™ç©ºé—´å†…éƒ¨çš„å°é—­æ€§ã€‚æ‰€ä»¥å¯†ç ç®—æ³•é€šå¸¸è¿è¡Œäºå…·æœ‰æŸäº›ä¿æŒå°é—­æ€§çš„ä»£æ•°ç»“æ„çš„ç©ºé—´ä¸­ï¼Œè¿™ç§ä»£æ•°ç»“æ„å°±æ˜¯<strong>æœ‰é™å¾ªç¯ç¾¤</strong>ã€‚åœ¨æ•°å­¦ä¸­ï¼Œç¾¤æ˜¯ä¸€ç§ä»£æ•°ç»“æ„ï¼Œç”±ä¸€ä¸ªé›†åˆä»¥åŠä¸€ä¸ªäºŒå…ƒè¿ç®—ç»„æˆã€‚ç¾¤å¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼šå°é—­æ€§ï¼Œç»“åˆå¾‹ï¼Œå­˜åœ¨å•ä½å…ƒå’Œå­˜åœ¨é€†å…ƒã€‚</p><h2 id="æ¤­åœ†æ›²çº¿ç¾¤å®šä¹‰"><a href="#æ¤­åœ†æ›²çº¿ç¾¤å®šä¹‰" class="headerlink" title="æ¤­åœ†æ›²çº¿ç¾¤å®šä¹‰"></a>æ¤­åœ†æ›²çº¿ç¾¤å®šä¹‰</h2><p>1985å¹´ï¼ŒNeal Koblitzå’ŒVictor S.Milleråˆ†åˆ«ç‹¬ç«‹æå‡ºåˆ©ç”¨æ¤­åœ†æ›²çº¿äº§ç”Ÿæ¤­åœ†æ›²çº¿å¾ªç¯ç¾¤ç”¨äºå¯†ç å­¦ã€‚åœ¨æ•°å­¦ä¸Šï¼Œæ¤­åœ†æ›²çº¿ç¾¤çš„å…ƒç´ ä¸ºæ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ï¼Œç¾¤æ“ä½œä¸ºâ€+â€,â€+â€çš„å®šä¹‰ä¸ºï¼Œç»™å®šæ›²çº¿ä¸¤ç‚¹$Pï¼ŒQï¼ŒP+Q$ç­‰äº$P$å’Œ$Q$ä¸¤ç‚¹çš„è¿çº¿ä¸æ›²çº¿äº¤ç‚¹æ²¿Xè½´çš„å¯¹ç§°ç‚¹ï¼Œå¦‚æœ$P=Q$ï¼Œåˆ™$P+P$ç­‰äºPåœ¨æ›²çº¿ä¸Šçš„åˆ‡çº¿ä¸æ›²çº¿äº¤ç‚¹æ²¿Xè½´çš„å¯¹ç§°ç‚¹ã€‚è¯¥ç¾¤çš„å•ä½å…ƒä¸ºæ— ç©·è¿œé›¶ç‚¹è®°ä½œ$O=(0,0)$ï¼Œæœ‰$P+O=P$ï¼Œç‚¹Pçš„é€†å…ƒä¸ºå…¶æ²¿Xè½´çš„å¯¹ç§°ç‚¹ï¼Œè®°ä½œ$-P$ã€‚</p><p>ä¸‹å›¾æ¼”ç¤ºäº†å¦‚ä½•è®¡ç®—$P+Q=R(P\neq Q)$</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/42pa379WjufgEOs.png" alt="6663612-092e13fc0b2a01eb"></p><p>ä¸‹å›¾æ¼”ç¤ºäº†å¦‚ä½•è®¡ç®—$P+Q=2P=R(P=Q)$ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/aOgDzy4JedX1RnS.png" alt="6663612-6f8e91a21db4b3e3"></p><p>ä¸‹å›¾æ¼”ç¤ºäº†å¦‚ä½•è®¡ç®—$P$çš„é€†å…ƒ$-P$ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/iuAdvgZBc54NKwn.png" alt="6663612-ef00d3b116ffb790"></p><h2 id="æ¤­åœ†æ›²çº¿æœ‰é™å¾ªç¯ç¾¤"><a href="#æ¤­åœ†æ›²çº¿æœ‰é™å¾ªç¯ç¾¤" class="headerlink" title="æ¤­åœ†æ›²çº¿æœ‰é™å¾ªç¯ç¾¤"></a>æ¤­åœ†æ›²çº¿æœ‰é™å¾ªç¯ç¾¤</h2><p>å‰é¢ä»‹ç»çš„æ¤­åœ†æ›²çº¿éƒ½æ˜¯åŸºäºæœ‰ç†æ•°çš„ï¼Œä½†æ˜¯è®¡ç®—æœºè¿ç®—æµ®ç‚¹æ•°(å°æ•°)çš„é€Ÿåº¦è¾ƒæ…¢ï¼Œæ›´é‡è¦çš„æ˜¯å››èˆäº”å…¥æµ®ç‚¹æ•°ä¼šäº§ç”Ÿè¯¯å·®ï¼Œå¯¼è‡´å¤šæ¬¡åŠ å¯†è§£å¯†æ“ä½œååŸå§‹æ¶ˆæ¯ä¸èƒ½è¢«è¿˜åŸã€‚æ•…è€ƒè™‘åˆ°åŠ å¯†ç®—æ³•çš„å¯å®ç°æ€§ï¼Œå¯†ç å­¦ä¸Šä½¿ç”¨åŸºäºæ•´æ•°çš„æ¨¡åŠ è¿ç®—äº§ç”Ÿæ¤­åœ†æ›²çº¿æœ‰é™å¾ªç¯ç¾¤ã€‚</p><p>æœ¬æ–‡ä¸æ¶‰åŠå…·ä½“çš„æ•°å­¦è®¡ç®—ï¼Œå°†ç”¨å…·ä½“çš„ä¾‹å­å±•ç¤ºå¦‚ä½•äº§ç”ŸECCæœ‰é™å¾ªç¯ç¾¤ã€‚ä¾‹å¦‚è€ƒè™‘$y^2=x^3-7x+10\ (mod\  19)$çš„é›†åˆï¼Œè¯¥é›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ¨¡è¿ç®—æŠŠå‘æ•£çš„æ¤­åœ†æ›²çº¿æ˜ å°„åˆ°$19\times 19$çš„æ­£æ–¹å½¢ç©ºé—´ä¸­ï¼Œå¹¶ä¸”ä¿æŒäº†åŸæœ‰æ›²çº¿çš„ä¸Šä¸‹å¯¹ç§°ç‰¹æ€§ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/wA3g81lh6yupBQO.png" alt="6663612-95901135c214ebea"></p><p>ä¸‹å›¾å±•ç¤ºäº†$y^2=x^3-7x+10\ (mod\ 19)$é›†åˆä¸­çš„å…ƒç´ å’Œæ¤­åœ†æ›²çº¿çš„å…³ç³»ã€‚</p><p>ç‚¹$Qâ€™$æ˜ å°„åˆ°ç‚¹$Q$ï¼Œç‚¹Pçš„å¯¹ç§°ç‚¹ä¹Ÿç”±ç‚¹$-Pâ€™$æ˜ å°„åˆ°ç‚¹$-P$ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/OlF2SeAchVWC486.png" alt="6663612-f99ccd0e5533dc70"></p><p>å¦‚æœå–ä¸€ä¸ªæ›´å¤§çš„è´¨æ•°$p$è¿›è¡Œæ¨¡è¿ç®—ï¼Œé›†åˆä¸­çš„å…ƒç´ ç‚¹ä¹Ÿä¼šç›¸åº”åœ°å¢å¤šã€‚ä¸‹å›¾å±•ç¤ºäº†åˆ©ç”¨åŒä¸€ä¸ªæ›²çº¿æ–¹ç¨‹è¿›è¡Œä¸åŒæ¨¡è¿ç®—çš„ç»“æœã€‚åœ¨å®é™…çš„æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ä¸­ï¼Œä½¿ç”¨é•¿åº¦ä¸º192-256ä½çš„è´¨æ•°$p$è¿›è¡Œæ¨¡è¿ç®—ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/IB4EoegpHlNiT71.png" alt="6663612-6aa923268fa3e091"></p><p>ç°åœ¨æˆ‘ä»¬åŸºäº$y^2=x^3-7x+10\ (mod\ 19)$ï¼Œåˆ©ç”¨äº§ç”Ÿå…ƒ$P=(2,2)$æ¥ç”ŸæˆECCæœ‰é™å¾ªç¯ç¾¤ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…·ä½“çš„è®¡ç®—ä½¿ç”¨<a href="http://www.christelbach.com/ECCalculator.aspx">åœ¨çº¿ECCè®¡ç®—å™¨</a>ã€‚</p><p>å¾—åˆ°å¦‚ä¸‹ç»“æœ:</p><script type="math/tex; mode=display">1P=(2,2)\\2P=(13,8)\\3P=(1,2)\\4P=(16,17)\\5P=(10,3)\\...\\22P=(13,11)\\23P=(2,17)\\24P=(0,0)</script><p>$G={nP|P=(2,2)}$å®Œæ•´çš„é›†åˆä¸º</p><p>${p=(2,2),2P=(13,8),3P=(1,2), â€¦ 23P=(2,17),24P=O=(0,0)}$</p><h2 id="æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ECDLP"><a href="#æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ECDLP" class="headerlink" title="æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ECDLP"></a>æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ECDLP</h2><p>è¯·é—®ä¸Šå›¾ä¸­ä¸ç‚¹$Q$ç›¸å¯¹åº”çš„$n$å€¼ä¸ºå¤šå°‘ï¼Ÿ</p><p>æŸ¥æ‰¾é›†åˆ$G={nP|P=(2,2)}$ä¸­çš„å…ƒç´ å¯çŸ¥ç­”æ¡ˆæ˜¯$Q=(5,10)=10P$ï¼Œä½†æ˜¯å®é™…åº”ç”¨ä¸­æ²¡æœ‰ç°æˆçš„é›†åˆå¯ä¾›æŸ¥è¡¨ã€‚è‹¥å·²çŸ¥æŸä¸ªç‚¹Qï¼Œåªèƒ½ç”¨æ¯”è¾ƒåŸå§‹çš„æ–¹æ³•æ¼”ç®—å¯èƒ½çš„$n$å€¼ï¼Œç›®å‰å¯å®ç°çš„æ•ˆç‡æœ€é«˜çš„ç®—æ³•ä¸ºBaby-step giant-stepç®—æ³•ï¼Œè®¡ç®—å¤æ‚åº¦ä¸º$O(\sqrt{n})$ã€‚åè¿‡æ¥ï¼Œå¦‚æœå·²çŸ¥nè®¡ç®—$n*P$åˆ™ç®€å•çš„å¤šï¼Œå› ä¸ºæœ‰é™å¾ªç¯ç¾¤æ»¡è¶³ç»“åˆå¾‹ï¼Œå¯ä»¥ä½¿ç”¨square and multiplyç®—æ³•ï¼Œè®¡ç®—å¤æ‚åº¦ä¸º$O(2log2n)$ã€‚ä¾‹å¦‚ï¼Œæ¯”ç‰¹å¸ä½¿ç”¨åä¸ºsecp256k1çš„æ ‡å‡†ECCæ›²çº¿ï¼Œ$n$çš„é•¿åº¦ä¸º256ä½. Baby-step giant-stepç®—æ³•çš„è®¡ç®—å¤æ‚åº¦ä¸º$O(2^{128})$ï¼Œè€Œsquare and multiplyç®—æ³•çš„è®¡ç®—å¤æ‚åº¦ä»…ä¸ºO(512)ã€‚</p><p>ç”¨å¯†ç å­¦æœ¯è¯­æè¿°ä¸ºï¼šECCæœ‰é™å¾ªç¯ç¾¤æ„æˆäº†ä¸€ä¸ªå•å‘å‡½æ•°$Q=nP$ï¼Œå·²çŸ¥$n,P$å¯ä»¥å¾ˆå®¹æ˜“è®¡ç®—$Q$ï¼›åè¿‡æ¥å·²çŸ¥$P,Q$åˆ™éš¾ä»¥è®¡ç®—$n$.äºæ˜¯$(n,Q=n\cdot P )$æ„æˆäº†ä¸€å¯¹ç§é’¥å’Œå…¬é’¥ã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œåˆ©ç”¨square and multiply ç®—æ³•è®¡ç®—Q=137Pï¼Œä»…éœ€9æ­¥ä¾¿å¾—åˆ°è®¡ç®—ç»“æœã€‚</p><h2 id="ECDHåŸºäºæ¤­åœ†æ›²çº¿çš„Diffie-Hellmanå¯†é’¥äº¤æ¢"><a href="#ECDHåŸºäºæ¤­åœ†æ›²çº¿çš„Diffie-Hellmanå¯†é’¥äº¤æ¢" class="headerlink" title="ECDHåŸºäºæ¤­åœ†æ›²çº¿çš„Diffie-Hellmanå¯†é’¥äº¤æ¢"></a>ECDHåŸºäºæ¤­åœ†æ›²çº¿çš„Diffie-Hellmanå¯†é’¥äº¤æ¢</h2><p>ECCå¯ä»¥ç”¨äºåŠ å¯†è§£å¯†ï¼Œä½†æ˜¯ç”±äºå…¶ç®—æ³•å¤æ‚è®¡ç®—é€Ÿåº¦æ…¢ï¼Œæ•…è±è¿ªæ€iCE40 UltraPlusç³»åˆ—èŠ¯ç‰‡ç»¼åˆä½¿ç”¨ECDHç®—æ³•è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œå†é€šè¿‡AESè¿›è¡Œæ¶ˆæ¯çš„å¿«é€ŸåŠ å¯†/è§£å¯†åŠ©åŠ›äºIoTé€šä¿¡ã€‚æ•…æœ¬æ–‡ä»¥iCE40 UltraPlusèŠ¯ç‰‡çš„Security IPä¸ºä¾‹ä»‹ç»ECDHå¯†é’¥äº¤æ¢ã€‚ä¸‹å›¾ä¸ºECDHå¯†é’¥äº¤æ¢ç®—æ³•çš„ç¤ºæ„å›¾ï¼ŒiCE40Pluså’ŒHoståˆ†åˆ«äº§ç”Ÿè‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ï¼Œç„¶åé€šè¿‡å…¬å…±ç½‘ç»œæŠŠå…¬é’¥åˆ†äº«ç»™å¯¹æ–¹ï¼Œå†å„è‡ªä½¿ç”¨ç§é’¥åœ¨æœ¬åœ°è®¡ç®—å‡ºç›¸åŒçš„å¯†é’¥è¿›è¡ŒAESåŠ å¯†é€šä¿¡ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/IHxbt7OJ8SgXFka.png" alt="6663612-b52df96317d4d4bf"></p><p>ç”±äºæœ‰é™å¾ªç¯ç¾¤æ»¡è¶³äº¤æ¢å¾‹ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯</p><script type="math/tex; mode=display">{KEY}_{Host}=m\cdot n\cdot P=n\cdot m\cdot P={KEY}_{FPGA}</script>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¯†ç å­¦ </tag>
            
            <tag> æ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯†ç å­¦ä¹‹Diffie-Hellmanå¯†é’¥äº¤æ¢</title>
      <link href="/2019/10/10/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8BDiffie-Hellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2/"/>
      <url>/2019/10/10/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8BDiffie-Hellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<p><a href="https://en.wikipedia.org/wiki/Diffieâ€“Hellman_key_exchange">Deffie-Hellman</a>(ç®€ç§° DH) å¯†é’¥äº¤æ¢æ˜¯æœ€æ—©çš„å¯†é’¥äº¤æ¢ç®—æ³•ä¹‹ä¸€ï¼Œå®ƒä½¿å¾—é€šä¿¡çš„åŒæ–¹èƒ½åœ¨éå®‰å…¨çš„ä¿¡é“ä¸­å®‰å…¨çš„äº¤æ¢å¯†é’¥ï¼Œç”¨äºåŠ å¯†åç»­çš„é€šä¿¡æ¶ˆæ¯ã€‚ Whitfield Diffie å’Œ Martin Hellman äº 1976 æå‡ºè¯¥ç®—æ³•ï¼Œä¹‹åè¢«åº”ç”¨äºå®‰å…¨é¢†åŸŸï¼Œæ¯”å¦‚ Https åè®®çš„ TSL(<a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a>) å’Œ IPsec åè®®çš„ IKE(<a href="https://en.wikipedia.org/wiki/Internet_Key_Exchange">Internet Key Exchange</a>) å‡ä»¥ DH ç®—æ³•ä½œä¸ºå¯†é’¥äº¤æ¢ç®—æ³•ã€‚</p><a id="more"></a><h2 id="æ•°è®ºåŸºç¡€"><a href="#æ•°è®ºåŸºç¡€" class="headerlink" title="æ•°è®ºåŸºç¡€"></a>æ•°è®ºåŸºç¡€</h2><p>ç†è§£ DH ç®—æ³•å‰ï¼Œå…ˆä»‹ç»ä¸€äº›å¿…è¦çš„æ•°è®ºé¢†åŸŸçŸ¥è¯†ï¼Œåˆ†åˆ«æ˜¯ç¦»æ•£å¯¹æ•°é—®é¢˜å’Œä¸€ä¸ªæ±‚æ¨¡å…¬å¼ã€‚</p><h3 id="ç¦»æ•£å¯¹æ•°é—®é¢˜"><a href="#ç¦»æ•£å¯¹æ•°é—®é¢˜" class="headerlink" title="ç¦»æ•£å¯¹æ•°é—®é¢˜"></a>ç¦»æ•£å¯¹æ•°é—®é¢˜</h3><p>å‡å®š a, p å‡æ˜¯ç´ æ•°ï¼Œä¸‹é¢ä¸¤ä¸ªé›†åˆç›¸ç­‰ï¼Œè¯æ˜è¿‡ç¨‹è¯·å‚è€ƒ <a href="http://www.amazon.com/Cryptography-Network-Security-Principles-Practice/dp/0133354695">Cryptography and Network Security</a> ç¬¬å…«ç« ï¼š</p><script type="math/tex; mode=display">{a^1 (mod\ p), a^2 (mod\ p), ... a^{p-1}(mod\ p)} = {1,2,...,p-1}</script><p>ä¸Šè¿°å¼å­å¯æ¦‚æ‹¬æˆä»¥ä¸‹ä¸‰ç‚¹ï¼Œå¯¹äº 1 &lt;= x,y &lt;= p - 1ï¼Œæœ‰ï¼š</p><ul><li>$a^x (mod\ p)$ ä¸€å®šå±äº {1, 2, â€¦, p -1 }</li><li>$\forall x != y, a^x (mod\ p) \neq a^y (mod\ p)$</li><li>$1 \leq b \leq p - 1$ï¼Œä¸€å®šå­˜åœ¨å”¯ä¸€çš„ $1 \leq x \leq p-1$ï¼Œä½¿å¾— $b = a^x (mod\ p)$</li></ul><blockquote><p>âœ¨ å‡ºäºæ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢çš„æ¨å¯¼ä¸­$=$ä¸¤è¾¹é»˜è®¤çœç•¥$(mod\ p)$</p></blockquote><p>ç¬¬ä¸‰ç‚¹åœ¨æ±‚è§£ä¸Šæœ‰è¿™ä¹ˆä¸€ä¸ªç‰¹ç‚¹ï¼šå·²çŸ¥ x æ±‚ b éå¸¸å®¹æ˜“ï¼Œå·²çŸ¥ b æ±‚ x éå¸¸å›°éš¾ï¼Œé‚£ä¹ˆè¿™ä¾¿æ˜¯ä¸€ä¸ªå›°éš¾é—®é¢˜ï¼Œç‰¹åˆ«å½“ p å¾ˆå¤§æ—¶ï¼Œæ±‚è§£çš„å¤æ‚åº¦éå¸¸é«˜ï¼Œæ‰€ä»¥å®ƒåˆè¢«ç§°ä¸ºç¦»æ•£å¯¹æ•°é—®é¢˜ (<a href="https://en.wikipedia.org/wiki/Discrete_logarithm">Discrete logarithm</a>)ï¼Œå®ƒæ˜¯ DH ç®—æ³•èƒ½å¤Ÿå®‰å…¨äº¤æ¢å¯†é’¥çš„åŸºç¡€</p><h3 id="æ±‚æ¨¡å…¬å¼"><a href="#æ±‚æ¨¡å…¬å¼" class="headerlink" title="æ±‚æ¨¡å…¬å¼"></a>æ±‚æ¨¡å…¬å¼</h3><p>å‡è®¾ q ä¸ºç´ æ•°ï¼Œå¯¹äºæ­£æ•´æ•° a,x,yï¼Œæœ‰ï¼š</p><script type="math/tex; mode=display">(a^x)^y = a^{xy}</script><p>è¯æ˜å¦‚ä¸‹ï¼š</p><blockquote><p>ä»¤$ a^x = mp + n$ï¼Œ å…¶ä¸­ m, n ä¸ºè‡ªç„¶æ•°ï¼Œ$ 0 \leq n &lt; p$ï¼Œåˆ™æœ‰</p></blockquote><script type="math/tex; mode=display">\begin{equation} \begin{split} C &= (a^x)^y \\  &= (mp + n)^y \\  &= n^y \\  &= (mp +n)^y \\  &= a^{xy} \end{split} \end{equation}</script><h2 id="Deffie-Hellman-ç®—æ³•åŸç†"><a href="#Deffie-Hellman-ç®—æ³•åŸç†" class="headerlink" title="Deffie-Hellman ç®—æ³•åŸç†"></a>Deffie-Hellman ç®—æ³•åŸç†</h2><p>æœ¬æ–‡å‚è€ƒ <a href="http://www.amazon.com/Cryptography-Network-Security-Principles-Practice/dp/0133354695">Cryptography and Network Security</a> ä¸€ä¹¦ï¼Œä»‹ç» DH ç®—æ³•åŸç†ï¼Œåœ¨æŒæ¡ä¸ŠèŠ‚æ•°è®ºçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œç†è§£ DH ç®—æ³•åŸç†éå¸¸å®¹æ˜“ã€‚</p><p>å‡è®¾ A, B ä¸¤æ–¹è¿›è¡Œé€šä¿¡å‰éœ€è¦äº¤æ¢å¯†é’¥ï¼Œé¦–å…ˆ A, B å…±åŒé€‰å– p å’Œ a ä¸¤ä¸ªç´ æ•°ï¼Œå…¶ä¸­ p å’Œ a å‡å…¬å¼€ã€‚ä¹‹å A é€‰æ‹©ä¸€ä¸ªè‡ªç„¶æ•° Xaï¼Œè®¡ç®—å‡º Yaï¼ŒXa ä¿å¯†ï¼ŒYa å…¬å¼€ï¼›åŒç†ï¼ŒB é€‰æ‹© Xb å¹¶è®¡ç®—å‡º Ybï¼Œå…¶ä¸­ Xb ä¿å¯†ï¼ŒYb å…¬å¼€ã€‚ä¹‹å A ç”¨ Yb å’Œ Xa è®¡ç®—å‡ºå¯†é’¥ Kï¼Œè€Œ B ç”¨ Ya å’Œ Xb è®¡ç®—å¯†é’¥ Kï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">|                    Global Pulic Elements                          |</span><br><span class="line">|                                                                   |</span><br><span class="line">|       p                               prime number                |</span><br><span class="line">|       a                               prime number, a &lt; p         |</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">|                   <span class="built_in"> User </span>A Key Generation                          |</span><br><span class="line">|                                                                   |</span><br><span class="line">|       Select private Xa               Xa &lt; p                      |</span><br><span class="line">|       Calculate public Ya             Ya = a^Xa mod p             |</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">|                   <span class="built_in"> User </span>B Key Generation                          |</span><br><span class="line">|                                                                   |</span><br><span class="line">|       Select private Xb               Xb &lt; p                      |</span><br><span class="line">|       Calculate public Yb             Yb = a^Xb mod p             |</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">|               Calculation of<span class="built_in"> Secret </span>Key by<span class="built_in"> User </span>A                 |</span><br><span class="line">|                                                                   |</span><br><span class="line">|      <span class="built_in"> Secret </span>Key K                    K = Yb^Xa mod p             |</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">+-------------------------------------------------------------------+</span><br><span class="line">|               Calculation of<span class="built_in"> Secret </span>Key by<span class="built_in"> User </span>B                 |</span><br><span class="line">|                                                                   |</span><br><span class="line">|      <span class="built_in"> Secret </span>Key K                    K = Ya^Xb mod p             |</span><br><span class="line">+-------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¯æ˜ï¼ŒA å’Œ B è®¡ç®—å‡ºæ¥çš„å¯†é’¥ K ç›¸åŒã€‚</p><blockquote><script type="math/tex; mode=display">\begin{equation}\begin{split} K = Yb^{Xa}  = (a^{Xb})^{Xa}  = a^{Xa \cdot Xb}            = (a^{Xa} )^{Xb}   = Ya^{Xb}\end{split} \end{equation}</script></blockquote><p>ä¸Šé¢ä¸€å…±å‡ºç°äº† $a, p, Xa, Ya, Xb, Yb, K$ å…± 7 ä¸ªæ•°ï¼Œå…¶ä¸­ï¼š</p><ul><li>å…¬å¼€çš„æ•°ï¼š$a, p, Ya, Yb$</li><li>éå…¬å¼€æ•°ï¼š$Xa, Xb, K$</li></ul><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œa ä¸€èˆ¬ä¸º 2 æˆ– 5ï¼Œè€Œ$p$ çš„å–å€¼éå¸¸å¤§ï¼Œè‡³å°‘å‡ ç™¾ä½ï¼ŒXa å’Œ Xb çš„å–å€¼ä¹Ÿéå¸¸å¤§ï¼Œå…¶å¤æ‚åº¦è‡³å°‘ä¸º <a href="https://en.wikipedia.org/wiki/Pollard&#39;s_rho_algorithm_for_logarithms">$O(p^{0.5})$</a>ã€‚å¯¹äºæ”»å‡»è€…æ¥è¯´ï¼Œå·²çŸ¥ $Yaï¼ŒXa$ çš„æ±‚è§£éå¸¸å›°éš¾ï¼ŒåŒç† Xb çš„æ±‚è§£ä¹Ÿå¾ˆå›°éš¾ï¼Œæ‰€ä»¥æ”»å‡»è€…éš¾ä»¥æ±‚å‡º Kï¼Œæ‰€ä»¥ DH èƒ½å¤Ÿä¿è¯é€šä¿¡åŒæ–¹åœ¨é€æ˜çš„ä¿¡é“ä¸­å®‰å…¨çš„äº¤æ¢å¯†é’¥ã€‚<a href="https://en.wikipedia.org/wiki/Diffieâ€“Hellman_key_exchange#/media/File:Diffie-Hellman_Key_Exchange.svg">ä¸‹å›¾</a>éå¸¸å½¢è±¡çš„æè¿°å¯†é’¥äº¤æ¢æµç¨‹ï¼š</p><p>â€‹                        <img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/11/j7te34ZRPH59fYz.png" alt="DH key exchange"></p>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¯†ç å­¦ </tag>
            
            <tag> æ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonçš„å…¨å±€è§£é‡Šå™¨é”æ˜¯ä»€ä¹ˆ</title>
      <link href="/2018/09/08/Python/Python%E7%9A%84%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81%E6%98%AF%E4%BB%80%E4%B9%88/"/>
      <url>/2018/09/08/Python/Python%E7%9A%84%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81%E6%98%AF%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<p>å…¨å±€è§£é‡Šæ€§é”ï¼Œç®€ç§°GIL(Global Interpreter Lock)ï¼Œå®ƒæ˜¯ä»€ä¹ˆï¼Œå®˜æ–¹æœ‰å¦‚ä¸‹è§£é‡Šï¼š</p><blockquote><p>In CPython, the global interpreter lock, or GIL, is a mutex that protects access to Python objects, preventing multiple threads from executing Python bytecodes at once. This lock is necessary mainly because CPythonâ€™s memory management is not thread-safe. (However, since the GIL exists, other features have grown to depend on the guarantees that it enforces.)</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š</p><ul><li><code>GIL</code>åœ¨æ‰§è¡ŒPythonå­—èŠ‚ç æ—¶ä¿æŠ¤è®¿é—®Pythonå¯¹è±¡è€Œé˜»æ­¢å¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„äº’æ–¥é”ï¼Œä¸»è¦å› ä¸ºCPythonçš„è§£é‡Šå™¨éçº¿ç¨‹å®‰å…¨ã€‚</li><li><code>GIL</code>éPythonè¯­è¨€ç‰¹æ€§ï¼Œè€Œæ˜¯ä¾èµ–äºè§£é‡Šå™¨çš„å®ç°ï¼Œ<code>CPython</code>å®ç°äº†<code>GIL</code>æœºåˆ¶</li><li><code>GIL</code>ä¿è¯Pythonè§£é‡Šå™¨è¿è¡Œæ—¶ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œï¼Œä¿è¯å†…å­˜ç®¡ç†å®‰å…¨</li><li>ç›®å‰å·²ç»æœ‰è®¸å¤šåŠŸèƒ½ä¾èµ–<code>GIL</code></li></ul><a id="more"></a><p>å¸¸è§çš„Pythonè§£é‡Šå™¨æœ‰å¦‚ä¸‹å‡ ç§ï¼Œä»¥åŠè¿™äº›è§£é‡Šå™¨æ˜¯å¦å­˜åœ¨<code>GIL</code>ï¼š</p><ul><li><code>CPython</code>ï¼š<code>C</code>è¯­è¨€å¼€å‘çš„è§£é‡Šå™¨ï¼Œé»˜è®¤å®˜æ–¹ç‰ˆæœ¬ï¼Œä½¿ç”¨æœ€ä¸ºå¹¿æ³›ï¼Œæœ‰<code>GIL</code></li><li><code>IPython</code>ï¼šåŸºäº<code>CPython</code>å¼€å‘çš„äº¤äº’å¼è§£é‡Šå™¨ï¼Œåªæ˜¯å¢å¼ºäº†äº¤äº’åŠŸèƒ½ï¼Œæ‰§è¡ŒåŠŸèƒ½ä¸<code>CPython</code>å®Œå…¨ä¸€æ ·</li><li><code>PyPy</code>ï¼šç›®æ ‡æ˜¯åŠ å¿«æ‰§è¡Œé€Ÿåº¦ï¼Œé‡‡ç”¨JITæŠ€æœ¯ï¼Œå¯¹Pythonä»£ç è¿›è¡ŒåŠ¨æ€ç¼–è¯‘ï¼ˆä¸æ˜¯è§£é‡Šï¼‰ï¼Œå¯æ˜¾è‘—æé«˜æ‰§è¡Œé€Ÿåº¦ï¼Œä½†æ‰§è¡Œç»“æœå¯èƒ½ä¸<code>CPython</code>ä¸åŒã€‚æœ‰<code>GIL</code>ï¼Œä½†å…¶å¼€å‘è€…å®£å¸ƒå‘å¸ƒå»æ‰<code>GIL</code>çš„ç‰ˆæœ¬</li><li><code>Jython</code>ï¼šè¿è¡Œåœ¨Javaå¹³å°ä¸Šçš„Pythonè§£é‡Šå™¨ï¼Œå¯ä»¥æŠŠPythonä»£ç ç¼–è¯‘æˆ<code>Java</code>å­—èŠ‚ç ï¼Œä¾èµ–<code>Java</code>å¹³å°ï¼Œæ²¡æœ‰<code>GIL</code></li><li><code>IronPython</code>ï¼šå’Œ<code>Jython</code>ç±»ä¼¼ï¼Œæ‰§è¡Œåœ¨å¾®è½¯<code>.Net</code>å¹³å°çš„Pythonè§£é‡Šå™¨ï¼Œå¯ä»¥æŠŠPythonä»£ç ç¼–è¯‘æˆ<code>.Net</code>å­—èŠ‚ç ä¾èµ–<code>.Net</code>å¹³å°ï¼Œæ²¡æœ‰<code>GIL</code></li></ul><h2 id="GIL-Problem"><a href="#GIL-Problem" class="headerlink" title="GIL Problem:"></a>GIL Problem:</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span>():</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt;= <span class="number">1000000000</span>:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ä¸ªçº¿ç¨‹æ‰§è¡Œloopæ–¹æ³•</span></span><br><span class="line">t1 = threading.Thread(target=loop)</span><br><span class="line">t2 = threading.Thread(target=loop)</span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œè™½ç„¶å¼€äº†2ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä½†æˆ‘ä»¬è§‚å¯ŸCPUä½¿ç”¨æƒ…å†µï¼Œå‘ç°å…¶åªèƒ½è·‘æ»¡ä¸€ä¸ªæ ¸å¿ƒã€‚</p><p>ç”±äº<code>GIL</code>çš„å­˜åœ¨ï¼Œå½“çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿå”¤é†’åï¼Œå¿…é¡»æ‹¿åˆ°<code>GIL</code>é”åæ‰èƒ½æ‰§è¡Œä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶åˆ»æ°¸è¿œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œè¿™å°±å¯¼è‡´å¦‚æœæˆ‘ä»¬çš„ç¨‹åºæ˜¯CPUå¯†é›†è¿ç®—å‹çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆä½¿ç”¨Pythonå¤šçº¿ç¨‹æ˜¯ä¸èƒ½æé«˜æ•ˆç‡çš„ã€‚</p><p>ä½†å³ä½¿æœ‰<code>GIL</code>çš„å­˜åœ¨ï¼Œç†è®ºæ¥ä¸Šæ¥è¯´ï¼Œåªè¦<code>GIL</code>é‡Šæ”¾çš„å¤Ÿå‹¤å¿«ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œæ€ä¹ˆä¹Ÿè¦æ¯”å•çº¿ç¨‹æ•ˆç‡é«˜å§ï¼Ÿ</p><p>ç°å®ç»“æœæ˜¯ï¼šæ•ˆç‡æ¯”æˆ‘ä»¬æƒ³è±¡çš„æ›´ç³Ÿç³•ï¼</p><ul><li>ä¸²è¡Œæ‰§è¡Œ2æ¬¡CPUå¯†é›†å‹ä»»åŠ¡ï¼š</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">def <span class="keyword">loop</span>():</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt;= <span class="number">5000000000</span>:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # ä¸²è¡Œæ‰§è¡Œ<span class="number">2</span>æ¬¡CPUå¯†é›†å‹ä»»åŠ¡</span><br><span class="line">    start = <span class="type">time</span>.time()</span><br><span class="line">    <span class="keyword">loop</span>()</span><br><span class="line">    <span class="keyword">loop</span>()</span><br><span class="line">    print <span class="type">time</span>.time() - <span class="keyword">start</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"># <span class="number">540.302778006</span></span><br></pre></td></tr></table></figure><ul><li>2ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡ï¼š</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">def <span class="keyword">loop</span>():</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt;= <span class="number">5000000000</span>:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # <span class="number">2</span>ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡</span><br><span class="line">    start = <span class="type">time</span>.time()</span><br><span class="line">    </span><br><span class="line">    t1 = threading.Thread(target=<span class="keyword">loop</span>)</span><br><span class="line">    t2 = threading.Thread(target=<span class="keyword">loop</span>)</span><br><span class="line">    t1.<span class="keyword">start</span>()</span><br><span class="line">    t2.<span class="keyword">start</span>()</span><br><span class="line">    t1.<span class="keyword">join</span>()</span><br><span class="line">    t2.<span class="keyword">join</span>()</span><br><span class="line">    </span><br><span class="line">    print <span class="type">time</span>.time() - <span class="keyword">start</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line"># <span class="number">573.972337961</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åˆ†åˆ«æ¨¡æ‹Ÿäº†ä¸€ä¸ªCPUå¯†é›†å‹ä»»åŠ¡åœ¨ä¸²è¡Œæ‰§è¡Œ2æ¬¡å’Œ2ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„åœºæ™¯ï¼Œæ‰§è¡Œç»“æœå‘ç°ï¼Œå¤šçº¿ç¨‹çš„æ•ˆç‡è¿˜ä¸å¦‚ä¸²è¡Œæ•ˆç‡é«˜ï¼</p><p>ä¸ºä»€ä¹ˆä¼šå¯¼è‡´è¿™ç§æƒ…å†µï¼Ÿæˆ‘ä»¬æ¥åˆ†æå…¶èƒŒåçš„å·¥ä½œåŸç†ã€‚</p><h2 id="How-GIL"><a href="#How-GIL" class="headerlink" title="How GIL?"></a>How GIL?</h2><p>ç”±äºPythonçš„çº¿ç¨‹å°±æ˜¯Cè¯­è¨€çš„<code>pthread</code>ï¼Œå®ƒæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿè°ƒåº¦ç®—æ³•è°ƒåº¦æ‰§è¡Œã€‚è€ŒPythonçš„æ‰§è¡Œæ˜¯åŸºäº<code>opcode</code>æ•°é‡çš„è°ƒåº¦æ–¹å¼ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ¯æ‰§è¡Œä¸€å®šæ•°é‡çš„å­—èŠ‚ç ï¼Œæˆ–é‡åˆ°ç³»ç»ŸIOæ—¶ï¼Œä¼šå¼ºåˆ¶é‡Šæ”¾<code>GIL</code>ï¼Œç„¶åè§¦å‘ä¸€æ¬¡æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ã€‚</p><h3 id="å•æ ¸CPUä¸‹çš„å¤šçº¿ç¨‹"><a href="#å•æ ¸CPUä¸‹çš„å¤šçº¿ç¨‹" class="headerlink" title="å•æ ¸CPUä¸‹çš„å¤šçº¿ç¨‹"></a>å•æ ¸CPUä¸‹çš„å¤šçº¿ç¨‹</h3><p>å¦‚æœæ˜¯å•æ ¸CPUæƒ…å†µä¸‹ï¼Œåœ¨å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œæ¯æ¬¡çº¿ç¨‹Aé‡Šæ”¾<code>GIL</code>åï¼Œè¢«å”¤é†’çš„çº¿ç¨‹Bèƒ½å¤Ÿç«‹å³æ‹¿åˆ°<code>GIL</code>ï¼Œèƒ½å¤Ÿæ— ç¼æ‰§è¡Œï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/PH9e8qMihbvyTDz.png" alt="1524717396"></p><h3 id="å¤šæ ¸CPUä¸‹çš„å¤šçº¿ç¨‹"><a href="#å¤šæ ¸CPUä¸‹çš„å¤šçº¿ç¨‹" class="headerlink" title="å¤šæ ¸CPUä¸‹çš„å¤šçº¿ç¨‹"></a>å¤šæ ¸CPUä¸‹çš„å¤šçº¿ç¨‹</h3><p>ä½†åœ¨å¤šæ ¸CPUæƒ…å†µä¸‹å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨CPU0æ‰§è¡Œå®Œä¹‹åé‡Šæ”¾<code>GIL</code>ï¼Œå…¶ä»–CPUä¸Šçš„çº¿ç¨‹éƒ½ä¼šè¿›è¡Œç«äº‰ï¼Œä½†CPU0å¯èƒ½åˆé©¬ä¸Šè·å–åˆ°äº†<code>GIL</code>ï¼Œè¿™å°±å¯¼è‡´å…¶ä»–CPUä¸Šè¢«å”¤é†’çš„çº¿ç¨‹åªèƒ½çœ¼å·´å·´åœ°çœ‹ç€CPU0ä¸Šçš„çº¿ç¨‹æ¬¢å¿«åœ°æ‰§è¡Œç€ï¼Œè€Œè‡ªå·±åªèƒ½ç­‰å¾…ï¼Œç›´åˆ°åˆè¢«åˆ‡æ¢åˆ°å¾…è°ƒåº¦çš„çŠ¶æ€ï¼Œè¿™å°±ä¼šäº§ç”Ÿå¤šæ ¸CPUé¢‘ç¹è¿›è¡Œçº¿ç¨‹åˆ‡æ¢ï¼Œæ¶ˆè€—ç€èµ„æºï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‹¿åˆ°<code>GIL</code>çœŸæ­£æ‰§è¡ŒPythonä»£ç ï¼Œè¿™å°±å¯¼è‡´å¤šçº¿ç¨‹åœ¨å¤šæ ¸CPUæƒ…å†µä¸‹ï¼Œæ•ˆç‡è¿˜ä¸å¦‚å•çº¿ç¨‹æ‰§è¡Œæ•ˆç‡é«˜ã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/hGA8qPFcK2Vezr7.png" alt="1524709489"></p><p>ç»¿è‰²éƒ¨åˆ†æ˜¯çº¿ç¨‹è·å¾—äº†<code>GIL</code>å¹¶è¿›è¡Œæœ‰æ•ˆçš„CPUè¿ç®—ï¼Œçº¢è‰²éƒ¨åˆ†æ˜¯è¢«å”¤é†’çš„çº¿ç¨‹ç”±äºæ²¡æœ‰äº‰å¤ºåˆ°<code>GIL</code>ï¼Œåªèƒ½æ— æ•ˆåœ°ç­‰å¾…ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨CPUçš„å¹¶è¡Œè¿ç®—èƒ½åŠ›ã€‚è¿™å°±æ˜¯å¤šçº¿ç¨‹åœ¨å¤šæ ¸CPUä¸‹ï¼Œæ‰§è¡Œæ•ˆç‡è¿˜ä¸å¦‚å•çº¿ç¨‹æˆ–å•æ ¸CPUæ•ˆç‡é«˜çš„åŸå› ã€‚</p><h3 id="å¤šçº¿ç¨‹IOå¯†é›†å‹ä»»åŠ¡"><a href="#å¤šçº¿ç¨‹IOå¯†é›†å‹ä»»åŠ¡" class="headerlink" title="å¤šçº¿ç¨‹IOå¯†é›†å‹ä»»åŠ¡"></a>å¤šçº¿ç¨‹IOå¯†é›†å‹ä»»åŠ¡</h3><p>æˆ‘ä»¬å†è¿›ä¸€æ­¥è¯•æƒ³ï¼Œå¦‚æœå¤šçº¿ç¨‹æ‰§è¡ŒIOå¯†é›†å‹ä»»åŠ¡ï¼Œæ•ˆç‡å¦‚ä½•ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æ¯”å•çº¿ç¨‹æ•ˆç‡è¦é«˜ã€‚</p><p>è¿™æ˜¯ç”±äºIOå¯†é›†å‹çš„ä»»åŠ¡ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…IOä¸Šï¼Œå¾ˆå°‘æ¶ˆè€—CPUçš„èµ„æºï¼Œæ‰€ä»¥åœ¨IOå¯†é›†å‹ä»»åŠ¡çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æ˜¯å¯ä»¥æå‡æ•ˆç‡çš„ã€‚</p><h2 id="Why-GIL"><a href="#Why-GIL" class="headerlink" title="Why GIL?"></a>Why GIL?</h2><p>æ—¢ç„¶<code>GIL</code>çš„å½±å“è¿™ä¹ˆå¤§ï¼Œé‚£ä¸ºä»€ä¹ˆPythonçš„è§£é‡Šå™¨<code>CPython</code>åœ¨è®¾è®¡æ—¶è¦é‡‡ç”¨è¿™ç§æ–¹å¼å‘¢ï¼Ÿ</p><p>è¿™å°±è¦è¿½æº¯å†å²åŸå› ï¼Œ2000å¹´ä»¥å‰ï¼Œå„ä¸ªCPUå‚å•†éƒ½åœ¨åŠªåŠ›æå‡æ ¸å¿ƒé¢‘ç‡ä»è€Œæé«˜è®¡ç®—æœºçš„æ€§èƒ½ï¼Œä½†åˆ°2000å¹´ä»¥åé€æ¸é‡åˆ°å¤©èŠ±æ¿ï¼Œä¹‹åæå‡æ–¹å‘æ”¹ä¸ºå¤šæ ¸å¿ƒæ–¹å‘ã€‚</p><p>ä¸ºäº†æ›´æœ‰æ•ˆçš„åˆ©ç”¨å¤šæ ¸å¿ƒCPUï¼Œå°±å‡ºç°äº†å¤šçº¿ç¨‹çš„ç¼–ç¨‹æ–¹å¼ï¼Œè€Œéšä¹‹å¸¦æ¥çš„å°±æ˜¯çº¿ç¨‹é—´æ•°æ®ä¸€è‡´æ€§å’ŒçŠ¶æ€åŒæ­¥çš„å›°éš¾ã€‚</p><p>Pythonè®¾è®¡è€…åœ¨è®¾è®¡è§£é‡Šå™¨æ—¶ï¼Œå¯èƒ½æ²¡æœ‰æƒ³åˆ°CPUçš„æ€§èƒ½æå‡ä¼šè¿™ä¹ˆå¿«è½¬ä¸ºå¤šæ ¸å¿ƒæ–¹å‘å‘å±•ï¼Œæ‰€ä»¥åœ¨å½“æ—¶çš„åœºæ™¯ä¸‹ï¼Œè®¾è®¡ä¸€ä¸ªå…¨å±€é”æ˜¯é‚£ä¸ªæ—¶ä»£ä¿æŠ¤å¤šçº¿ç¨‹èµ„æºä¸€è‡´æ€§çš„æœ€ç®€å•ç»æµçš„è®¾è®¡æ–¹æ¡ˆã€‚</p><p>è€Œéšç€å¤šæ ¸å¿ƒæ—¶ä»£æ¥ä¸´ï¼Œå½“å¤§å®¶è¯•å›¾å»æ‹†åˆ†å’Œå»é™¤<code>GIL</code>çš„æ—¶å€™ï¼Œå‘ç°å¤§é‡åº“çš„ä»£ç å¼€å‘è€…å·²ç»é‡åº¦ä¾èµ–<code>GIL</code>ï¼ˆé»˜è®¤Pythonnå†…éƒ¨å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— éœ€åœ¨å¼€å‘æ—¶é¢å¤–åŠ é”ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªå»é™¤<code>GIL</code>çš„ä»»åŠ¡å˜å¾—å¤æ‚ä¸”éš¾ä»¥å®ç°ã€‚</p><p>æ‰€ä»¥ç®€å•æ¥è¯´<code>GIL</code>çš„å­˜åœ¨æ›´å¤šçš„æ˜¯å†å²åŸå› ï¼Œå¦‚æœæ¨å€’é‡æ¥é‡æ–°è®¾è®¡ï¼Œé¢å¯¹å¤šçº¿ç¨‹é—®é¢˜å¯èƒ½è®¾è®¡å¾—ä¼šæ›´ä¸ºä¼˜é›…ã€‚</p><h2 id="How-to-solve"><a href="#How-to-solve" class="headerlink" title="How to solve?"></a>How to solve?</h2><p>æ—¢ç„¶<code>GIL</code>å­˜åœ¨ä¼šå¯¼è‡´è¿™ä¹ˆå¤šé—®é¢˜ï¼Œé‚£æˆ‘ä»¬æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥ç»•å¼€è¿™äº›é—®é¢˜ï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼Ÿæ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>IOå¯†é›†å‹ä»»åŠ¡åœºæ™¯ï¼Œå¤šçº¿ç¨‹å¯ä»¥æé«˜è¿è¡Œæ•ˆç‡ï¼ˆæ¨èï¼‰</li><li>ä½¿ç”¨æ²¡æœ‰<code>GIL</code>çš„Pythonè§£é‡Šå™¨ï¼ˆä¸æ¨èï¼‰</li><li>CPUå¯†é›†å‹ä»»åŠ¡åœºæ™¯ï¼Œå¯æ”¹ä¸ºå¤šè¿›ç¨‹æ‰§è¡Œï¼ˆæ¨èï¼‰</li><li>ç¼–å†™Pythonçš„Cæ‰©å±•æ¨¡å—ï¼ŒæŠŠCPUå¯†é›†å‹ä»»åŠ¡äº¤ç»™Cæ¨¡å—å¤„ç†ï¼ˆç¼–ç å¤æ‚ï¼Œä¸æ¨èï¼‰</li><li>æ›´æ¢å…¶ä»–è¯­è¨€å®ç°CPUå¯†é›†å‹ä»»åŠ¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisè¯¦è§£ä¹‹â€”â€”ç‰¹æ€§ä¸ç”¨é€”</title>
      <link href="/2018/03/04/Redis/Redis%E8%AF%A6%E8%A7%A3%E4%B9%8B%E2%80%94%E2%80%94%E7%89%B9%E6%80%A7%E4%B8%8E%E7%94%A8%E9%80%94/"/>
      <url>/2018/03/04/Redis/Redis%E8%AF%A6%E8%A7%A3%E4%B9%8B%E2%80%94%E2%80%94%E7%89%B9%E6%80%A7%E4%B8%8E%E7%94%A8%E9%80%94/</url>
      
        <content type="html"><![CDATA[<p><code>Redis</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>ANSI C</code> ç¼–å†™çš„å¼€æºã€æ”¯æŒ <strong>ç½‘ç»œ</strong>ã€åŸºäº <strong>å†…å­˜</strong>ã€<strong>å•çº¿ç¨‹æ¨¡å‹</strong>ã€<strong>å¯é€‰æŒä¹…æ€§</strong> çš„ <strong>é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“</strong>ã€‚Redisæ˜¯ä¸€ä¸ªK-Vçš„éå…³ç³»å‹æ•°æ®åº“ï¼ˆNoSQLï¼‰ï¼Œå¸¸è§çš„NoSQLæ•°æ®åº“æœ‰ï¼šK-Væ•°æ®åº“å¦‚Redisã€Memcachedï¼Œåˆ—å¼æ•°æ®åº“å¦‚å¤§æ•°æ®ç»„ä»¶HBaseï¼Œæ–‡æ¡£æ•°æ®åº“å¦‚mongoDBã€‚Redisåº”ç”¨å¹¿æ³›ï¼Œå°¤å…¶æ˜¯è¢«ä½œä¸ºç¼“å­˜ä½¿ç”¨ã€‚</p><a id="more"></a><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ol><li><strong>é€Ÿåº¦å¿«</strong>ï¼Œæœ€å¿«å¯è¾¾åˆ° <code>10w QPS</code>ï¼ˆåŸºäº <strong>å†…å­˜</strong>ï¼Œ<code>C</code> è¯­è¨€ï¼Œ<strong>å•çº¿ç¨‹</strong> æ¶æ„ï¼‰ï¼›</li><li>åŸºäº <strong>é”®å€¼å¯¹</strong> (<code>key/value</code>) çš„æ•°æ®ç»“æ„æœåŠ¡å™¨ã€‚å…¨ç§° <code>Remote Dictionary Server</code>ã€‚åŒ…æ‹¬ <code>string</code>(<strong>å­—ç¬¦ä¸²</strong>)ã€<code>hash</code>(<strong>å“ˆå¸Œ</strong>)ã€<code>list</code>(<strong>åˆ—è¡¨</strong>)ã€<code>set</code>(<strong>é›†åˆ</strong>)ã€<code>zset</code>(<strong>æœ‰åºé›†åˆ</strong>)ã€<code>bitmap</code>(<strong>ä½å›¾</strong>)ã€‚åŒæ—¶åœ¨ <strong>å­—ç¬¦ä¸²</strong> çš„åŸºç¡€ä¸Šæ¼”å˜å‡º <strong>ä½å›¾</strong>ï¼ˆ<code>BitMaps</code>ï¼‰å’Œ <code>HyperLogLog</code> ä¸¤ç§æ•°æ®ç»“æ„ã€‚<code>3.2</code> ç‰ˆæœ¬ä¸­åŠ å…¥ <code>GEO</code>ï¼ˆ<strong>åœ°ç†ä¿¡æ¯ä½ç½®</strong>ï¼‰ã€‚</li><li>ä¸°å¯Œçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š<strong>é”®è¿‡æœŸ</strong>ï¼ˆç¼“å­˜ï¼‰ï¼Œ<strong>å‘å¸ƒè®¢é˜…</strong>ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œ <code>Lua</code> è„šæœ¬ï¼ˆè‡ªå·±å®ç° <code>Redis</code> å‘½ä»¤ï¼‰ï¼Œ<strong>äº‹åŠ¡</strong>ï¼Œ<strong>æµæ°´çº¿</strong>ï¼ˆ<code>Pipeline</code>ï¼Œç”¨äºå‡å°‘ç½‘ç»œå¼€é”€ï¼‰ã€‚</li><li>ç®€å•ç¨³å®šã€‚æ— å¤–éƒ¨åº“ä¾èµ–ï¼Œå•çº¿ç¨‹æ¨¡å‹ã€‚</li><li>å®¢æˆ·ç«¯è¯­è¨€å¤šã€‚</li><li><strong>æŒä¹…åŒ–</strong>ï¼ˆæ”¯æŒä¸¤ç§ <strong>æŒä¹…åŒ–</strong> æ–¹å¼ <code>RDB</code> å’Œ <code>AOF</code>ï¼‰ã€‚</li><li><strong>ä¸»ä»å¤åˆ¶</strong>ï¼ˆåˆ†å¸ƒå¼çš„åŸºç¡€ï¼‰ã€‚</li><li><strong>é«˜å¯ç”¨</strong>ï¼ˆ<code>Redis Sentinel</code>ï¼‰ï¼Œ<strong>åˆ†å¸ƒå¼</strong>ï¼ˆ<code>Redis Cluster</code>ï¼‰å’Œ <strong>æ°´å¹³æ‰©å®¹</strong>ã€‚</li></ol><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>åˆç†çš„ä½¿ç”¨ <strong>ç¼“å­˜</strong> èƒ½å¤Ÿæ˜æ˜¾åŠ å¿«è®¿é—®çš„é€Ÿåº¦ï¼ŒåŒæ—¶é™ä½æ•°æ®æºçš„å‹åŠ›ã€‚è¿™ä¹Ÿæ˜¯ <code>Redis</code> æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚<code>Redis</code> æä¾›äº† <strong>é”®å€¼è¿‡æœŸæ—¶é—´</strong>ï¼ˆ<code>EXPIRE key seconds</code>ï¼‰è®¾ç½®ï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†çµæ´»æ§åˆ¶ <strong>æœ€å¤§å†…å­˜</strong> å’Œ <strong>å†…å­˜æº¢å‡º</strong> åçš„ <strong>æ·˜æ±°ç­–ç•¥</strong>ã€‚</p><h4 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½DBå°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„keyé¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚</p><p>æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜ï¼Œæœ€å¸¸è§çš„åˆ™æ˜¯é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„bitmapä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢« è¿™ä¸ªbitmapæ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚å¦å¤–ä¹Ÿæœ‰ä¸€ä¸ªæ›´ä¸ºç®€å•ç²—æš´çš„æ–¹æ³•ï¼ˆæˆ‘ä»¬é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ï¼‰ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•° æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚</p><h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h4><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨æˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´ç¼“å­˜åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°DBï¼ŒDBç¬æ—¶å‹åŠ›è¿‡é‡é›ªå´©ã€‚</p><p>ç¼“å­˜å¤±æ•ˆæ—¶çš„é›ªå´©æ•ˆåº”å¯¹åº•å±‚ç³»ç»Ÿçš„å†²å‡»éå¸¸å¯æ€•ã€‚å¤§å¤šæ•°ç³»ç»Ÿè®¾è®¡è€…è€ƒè™‘ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯ç¼“å­˜çš„å•çº¿ ç¨‹ï¼ˆè¿›ç¨‹ï¼‰å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚è¿™é‡Œåˆ†äº«ä¸€ä¸ªç®€å•æ–¹æ¡ˆå°±æ—¶è®²ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p><h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><p>å¯¹äºä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œå¦‚æœè¿™äº›keyå¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸â€œçƒ­ç‚¹â€çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢«â€œå‡»ç©¿â€çš„é—®é¢˜ï¼Œè¿™ä¸ªå’Œç¼“å­˜é›ªå´©çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹æŸä¸€keyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯å¾ˆå¤škeyã€‚ç¼“å­˜åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><h5 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h5><ol><li><p>äº’æ–¥é”</p><p>ä¸šç•Œæ¯”è¾ƒå¸¸ç”¨çš„åšæ³•ï¼Œæ˜¯ä½¿ç”¨mutexã€‚ç®€å•åœ°æ¥è¯´ï¼Œå°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbï¼Œè€Œæ˜¯å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚Redisçš„SETNXæˆ–è€…Memcacheçš„ADDï¼‰å»setä¸€ä¸ªmutex keyï¼Œå½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œå¹¶å›è®¾ç¼“å­˜ï¼›å¦åˆ™ï¼Œå°±é‡è¯•æ•´ä¸ªgetç¼“å­˜çš„æ–¹æ³•ã€‚SETNXï¼Œæ˜¯ã€ŒSET if Not eXistsã€çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸å­˜åœ¨çš„æ—¶å€™æ‰è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é”çš„æ•ˆæœã€‚æ‰€ä»¥è¿™é‡Œç»™å‡ºä»£ç å‚è€ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Redis</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(key)</span> </span>&#123;</span><br><span class="line">      String value = redis.get(key);</span><br><span class="line">      <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123; <span class="comment">//ä»£è¡¨ç¼“å­˜å€¼è¿‡æœŸ</span></span><br><span class="line">          <span class="comment">//è®¾ç½®3minçš„è¶…æ—¶ï¼Œé˜²æ­¢delæ“ä½œå¤±è´¥çš„æ—¶å€™ï¼Œä¸‹æ¬¡ç¼“å­˜è¿‡æœŸä¸€ç›´ä¸èƒ½load db</span></span><br><span class="line">  <span class="keyword">if</span> (redis.setnx(key_mutex, <span class="number">1</span>, <span class="number">3</span> * <span class="number">60</span>) == <span class="number">1</span>) &#123;  <span class="comment">//ä»£è¡¨è®¾ç½®æˆåŠŸ</span></span><br><span class="line">               value = db.get(key);</span><br><span class="line">                      redis.set(key, value, expire_secs);</span><br><span class="line">                      redis.del(key_mutex);</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;  <span class="comment">//è¿™ä¸ªæ—¶å€™ä»£è¡¨åŒæ—¶å€™çš„å…¶ä»–çº¿ç¨‹å·²ç»load dbå¹¶å›è®¾åˆ°ç¼“å­˜äº†ï¼Œè¿™æ—¶å€™é‡è¯•è·å–ç¼“å­˜å€¼å³å¯</span></span><br><span class="line">                      sleep(<span class="number">50</span>);</span><br><span class="line">                      get(key);  <span class="comment">//é‡è¯•</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> value;      </span><br><span class="line">          &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Memcache</span></span><br><span class="line"><span class="keyword">if</span> (memcache.get(key) == <span class="keyword">null</span>) &#123;  </span><br><span class="line">    <span class="comment">// 3 min timeout to avoid mutex holder crash  </span></span><br><span class="line">    <span class="keyword">if</span> (memcache.add(key_mutex, <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>) == <span class="keyword">true</span>) &#123;  </span><br><span class="line">        value = db.get(key);  </span><br><span class="line">        memcache.set(key, value);  </span><br><span class="line">        memcache.delete(key_mutex);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        sleep(<span class="number">50</span>);  </span><br><span class="line">        retry();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æå‰ä½¿ç”¨äº’æ–¥é”</p><p>åœ¨valueå†…éƒ¨è®¾ç½®1ä¸ªè¶…æ—¶å€¼(timeout1), timeout1æ¯”å®é™…çš„memcache timeout(timeout2)å°ã€‚å½“ä»cacheè¯»å–åˆ°timeout1å‘ç°å®ƒå·²ç»è¿‡æœŸæ—¶å€™ï¼Œé©¬ä¸Šå»¶é•¿timeout1å¹¶é‡æ–°è®¾ç½®åˆ°cacheã€‚ç„¶åå†ä»æ•°æ®åº“åŠ è½½æ•°æ®å¹¶è®¾ç½®åˆ°cacheä¸­ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">v = memcache.get(key);  </span><br><span class="line"><span class="keyword">if</span> (v == <span class="keyword">null</span>) &#123;  </span><br><span class="line">    <span class="keyword">if</span> (memcache.add(key_mutex, <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>) == <span class="keyword">true</span>) &#123;  </span><br><span class="line">        value = db.get(key);  </span><br><span class="line">        memcache.set(key, value);  </span><br><span class="line">        memcache.delete(key_mutex);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        sleep(<span class="number">50</span>);  </span><br><span class="line">        retry();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> (v.timeout &lt;= now()) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (memcache.add(key_mutex, <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>) == <span class="keyword">true</span>) &#123;  </span><br><span class="line">            <span class="comment">// extend the timeout for other threads  </span></span><br><span class="line">            v.timeout += <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>;  </span><br><span class="line">            memcache.set(key, v, KEY_TIMEOUT * <span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// load the latest value from db  </span></span><br><span class="line">            v = db.get(key);  </span><br><span class="line">            v.timeout = KEY_TIMEOUT;  </span><br><span class="line">            memcache.set(key, value, KEY_TIMEOUT * <span class="number">2</span>);  </span><br><span class="line">            memcache.delete(key_mutex);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            sleep(<span class="number">50</span>);  </span><br><span class="line">            retry();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ°¸è¿œä¸è¿‡æœŸ</p><p>è¿™é‡Œçš„â€œæ°¸è¿œä¸è¿‡æœŸâ€åŒ…å«ä¸¤å±‚æ„æ€ï¼š</p><blockquote><p>(1) ä»redisä¸Šçœ‹ï¼Œç¡®å®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™å°±ä¿è¯äº†ï¼Œä¸ä¼šå‡ºç°çƒ­ç‚¹keyè¿‡æœŸé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œç‰©ç†â€ä¸è¿‡æœŸã€‚</p><p>(2) ä»åŠŸèƒ½ä¸Šçœ‹ï¼Œå¦‚æœä¸è¿‡æœŸï¼Œé‚£ä¸å°±æˆé™æ€çš„äº†å—ï¼Ÿæ‰€ä»¥æˆ‘ä»¬æŠŠè¿‡æœŸæ—¶é—´å­˜åœ¨keyå¯¹åº”çš„valueé‡Œï¼Œå¦‚æœå‘ç°è¦è¿‡æœŸäº†ï¼Œé€šè¿‡ä¸€ä¸ªåå°çš„å¼‚æ­¥çº¿ç¨‹è¿›è¡Œç¼“å­˜çš„æ„å»ºï¼Œä¹Ÿå°±æ˜¯â€œé€»è¾‘â€è¿‡æœŸ</p></blockquote><p>â€‹    ä»å®æˆ˜çœ‹ï¼Œè¿™ç§æ–¹æ³•å¯¹äºæ€§èƒ½éå¸¸å‹å¥½ï¼Œå”¯ä¸€ä¸è¶³çš„å°±æ˜¯æ„å»ºç¼“å­˜æ—¶å€™ï¼Œå…¶ä½™çº¿ç¨‹(éæ„å»ºç¼“å­˜çš„çº¿ç¨‹)å¯èƒ½è®¿é—®çš„æ˜¯è€æ•°æ®ï¼Œä½†æ˜¯å¯¹äºä¸€èˆ¬çš„äº’è”ç½‘åŠŸèƒ½æ¥è¯´è¿™ä¸ªè¿˜æ˜¯å¯ä»¥å¿å—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">String <span class="title">get</span><span class="params">(<span class="keyword">final</span> String key)</span> </span>&#123;  </span><br><span class="line">        V v = redis.get(key);  </span><br><span class="line">        String value = v.getValue();  </span><br><span class="line">        <span class="keyword">long</span> timeout = v.getTimeout();  </span><br><span class="line">        <span class="keyword">if</span> (v.timeout &lt;= System.currentTimeMillis()) &#123;  </span><br><span class="line">            <span class="comment">// å¼‚æ­¥æ›´æ–°åå°å¼‚å¸¸æ‰§è¡Œ  </span></span><br><span class="line">            threadPool.execute(<span class="keyword">new</span> Runnable() &#123;  </span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                    String keyMutex = <span class="string">&quot;mutex:&quot;</span> + key;  </span><br><span class="line">                    <span class="keyword">if</span> (redis.setnx(keyMutex, <span class="string">&quot;1&quot;</span>)) &#123;  </span><br><span class="line">                        <span class="comment">// 3 min timeout to avoid mutex holder crash  </span></span><br><span class="line">                        redis.expire(keyMutex, <span class="number">3</span> * <span class="number">60</span>);  </span><br><span class="line">                        String dbValue = db.get(key);  </span><br><span class="line">                        redis.set(key, dbValue);  </span><br><span class="line">                        redis.delete(keyMutex);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>èµ„æºä¿æŠ¤</p><p>é‡‡ç”¨netflixçš„hystrixï¼Œå¯ä»¥åšèµ„æºçš„éš”ç¦»ä¿æŠ¤ä¸»çº¿ç¨‹æ± ï¼Œå¦‚æœæŠŠè¿™ä¸ªåº”ç”¨åˆ°ç¼“å­˜çš„æ„å»ºä¹Ÿæœªå°ä¸å¯ã€‚</p><p>å››ç§è§£å†³æ–¹æ¡ˆï¼šæ²¡æœ‰æœ€ä½³åªæœ‰æœ€åˆé€‚</p></li></ol><div class="table-container"><table><thead><tr><th>è§£å†³æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>ç®€å•åˆ†å¸ƒå¼äº’æ–¥é”ï¼ˆmutex keyï¼‰</td><td>1. æ€è·¯ç®€å•2. ä¿è¯ä¸€è‡´æ€§</td><td>1. ä»£ç å¤æ‚åº¦å¢å¤§2. å­˜åœ¨æ­»é”çš„é£é™©3. å­˜åœ¨çº¿ç¨‹æ± é˜»å¡çš„é£é™©</td></tr><tr><td>â€œæå‰â€ä½¿ç”¨äº’æ–¥é”</td><td>1. ä¿è¯ä¸€è‡´æ€§</td><td>åŒä¸Š</td></tr><tr><td>ä¸è¿‡æœŸ(æœ¬æ–‡)</td><td>1. å¼‚æ­¥æ„å»ºç¼“å­˜ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹æ± </td><td>1. ä¸ä¿è¯ä¸€è‡´æ€§ã€‚2. ä»£ç å¤æ‚åº¦å¢å¤§(æ¯ä¸ªvalueéƒ½è¦ç»´æŠ¤ä¸€ä¸ªtimekey)ã€‚3. å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´(æ¯ä¸ªvalueéƒ½è¦ç»´æŠ¤ä¸€ä¸ªtimekey)ã€‚</td></tr><tr><td>èµ„æºéš”ç¦»ç»„ä»¶hystrix(æœ¬æ–‡)</td><td>1. hystrixæŠ€æœ¯æˆç†Ÿï¼Œæœ‰æ•ˆä¿è¯åç«¯ã€‚2. hystrixç›‘æ§å¼ºå¤§ã€‚</td><td>1. éƒ¨åˆ†è®¿é—®å­˜åœ¨é™çº§ç­–ç•¥ã€‚</td></tr></tbody></table></div><h4 id="è¿‡æœŸç­–ç•¥"><a href="#è¿‡æœŸç­–ç•¥" class="headerlink" title="è¿‡æœŸç­–ç•¥"></a>è¿‡æœŸç­–ç•¥</h4><p>å¤§éƒ¨åˆ†åœºæ™¯<code>ä¸é€‚åˆç¼“å­˜ä¸€è‡´å­˜åœ¨</code>ï¼Œé¦–å…ˆï¼Œä½ çš„sqlæ•°æ®åº“çš„å†…å®¹å¯èƒ½å¾ˆå¤šå°±ä¸è¯´äº†ï¼Œå¦å¤–ï¼Œè¿”å›ç»™ä½ çš„å¯¹è±¡å¦‚æœæ˜¯å®Œæ•´çš„pojoå¯¹è±¡è¿˜å¥½ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä½¿ç”¨ä¸åŒå‚æ•°å„ç§å…³è”æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé‚£ä¹ˆredisä¸­ä¼šå‚¨å­˜å¤ªå¤šå†·æ•°æ®ã€‚å ç”¨èµ„æºè€Œå¾—ä¸åˆ°é”€æ¯ã€‚æˆ‘ä»¬å­¦è¿‡<code>æ“ä½œç³»ç»Ÿ</code>ä¹ŸçŸ¥é“åœ¨è®¡ç®—æœºçš„<code>ç¼“å­˜å®ç°</code>ä¸­æœ‰ï¼‰å…ˆè¿›å…ˆå‡ºçš„ç®—æ³•ï¼ˆ<strong>FIFO</strong>ï¼‰ï¼›æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆ<strong>LRU</strong>ï¼‰ï¼›æœ€ä½³æ·˜æ±°ç®—æ³•ï¼ˆ<strong>OPT</strong>ï¼‰ï¼›æœ€å°‘è®¿é—®é¡µé¢ç®—æ³•ï¼ˆ<strong>LFR</strong>ï¼‰ç­‰ç£ç›˜è°ƒåº¦ç®—æ³•ã€‚å¯¹äºwebå¼€å‘ä¹Ÿå¯ä»¥å€Ÿé‰´ã€‚æ ¹æ®æ—¶é—´æ¥çš„FIFOæ˜¯æœ€å¥½å®ç°çš„ã€‚å› ä¸ºredisåœ¨<code>å…¨å±€key</code>æ”¯æŒè¿‡æœŸç­–ç•¥ã€‚</p><p>è€Œå¼€å‘ä¸­å¯èƒ½è¿˜ä¼šé‡åˆ°<code>å…¶ä»–é—®é¢˜</code>ã€‚æ¯”å¦‚è¿‡æœŸæ—¶é—´çš„é€‰æ‹©ä¸Šï¼Œå¦‚æœè¿‡ä¹…ä¼šå¯¼è‡´æ•°æ®èšé›†ã€‚è€Œè¿‡å°‘å¯èƒ½å¯¼è‡´é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ç”šè‡³å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜é›ªå´©ç­‰é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œè¿‡æœŸç­–ç•¥ä¸€å®šè¦è®¾ç½®ã€‚å¹¶ä¸”å¯¹äº<code>å…³é”®key</code>ä¸€å®šè¦<code>å°å¿ƒè°¨æ…è®¾è®¡</code>ã€‚</p><h3 id="æ’è¡Œæ¦œ"><a href="#æ’è¡Œæ¦œ" class="headerlink" title="æ’è¡Œæ¦œ"></a>æ’è¡Œæ¦œ</h3><p>æ¯ä¸ªç½‘ç«™éƒ½æœ‰è‡ªå·±çš„æ’è¡Œæ¦œï¼Œä¾‹å¦‚æŒ‰ç…§ <strong>çƒ­åº¦æ’å</strong> çš„æ’è¡Œæ¦œï¼Œ<strong>å‘å¸ƒæ—¶é—´</strong> çš„æ’è¡Œæ¦œï¼Œ<strong>ç­”é¢˜æ’è¡Œæ¦œ</strong> ç­‰ç­‰ã€‚<code>Redis</code> æä¾›äº† <strong>åˆ—è¡¨</strong>ï¼ˆ<code>list</code>ï¼‰å’Œ <strong>æœ‰åºé›†åˆ</strong>ï¼ˆ<code>zset</code>ï¼‰æ•°æ®ç»“æ„ï¼Œåˆç†çš„ä½¿ç”¨è¿™äº›æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ„å»ºå„ç§æ’è¡Œæ¦œç³»ç»Ÿã€‚</p><h3 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h3><p><strong>è®¡æ•°å™¨</strong> åœ¨ç½‘ç«™åº”ç”¨ä¸­éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼š<strong>ç‚¹èµæ•°</strong>åŠ  <code>1</code>ï¼Œ<strong>æµè§ˆæ•°</strong> åŠ  <code>1</code>ã€‚è¿˜æœ‰å¸¸ç”¨çš„ <strong>é™æµæ“ä½œ</strong>ï¼Œé™åˆ¶æ¯ä¸ªç”¨æˆ·æ¯ç§’ <strong>è®¿é—®ç³»ç»Ÿçš„æ¬¡æ•°</strong> ç­‰ç­‰ã€‚<code>Redis</code> æ”¯æŒ <strong>è®¡æ•°åŠŸèƒ½</strong>ï¼ˆ<code>INCR key</code>ï¼‰ï¼Œè€Œä¸”è®¡æ•°çš„ <strong>æ€§èƒ½</strong> ä¹Ÿéå¸¸å¥½ï¼Œè®¡æ•°çš„åŒæ—¶ä¹Ÿå¯ä»¥è®¾ç½® <strong>è¶…æ—¶æ—¶é—´</strong>ï¼Œè¿™æ ·å°±å¯ä»¥ <strong>å®ç°é™æµ</strong>ã€‚</p><h3 id="ç¤¾äº¤ç½‘ç»œ"><a href="#ç¤¾äº¤ç½‘ç»œ" class="headerlink" title="ç¤¾äº¤ç½‘ç»œ"></a>ç¤¾äº¤ç½‘ç»œ</h3><p>èµ/è¸©ï¼Œç²‰ä¸ï¼Œå…±åŒå¥½å‹/å–œå¥½ï¼Œæ¨é€ï¼Œä¸‹æ‹‰åˆ·æ–°ç­‰æ˜¯ç¤¾äº¤ç½‘ç«™å¿…å¤‡çš„åŠŸèƒ½ã€‚ç”±äºç¤¾äº¤ç½‘ç«™ <strong>è®¿é—®é‡é€šå¸¸æ¯”è¾ƒå¤§</strong>ï¼Œè€Œä¸” <strong>ä¼ ç»Ÿçš„æ•°æ®åº“</strong> ä¸å¤ªé€‚åˆä¿å­˜è¿™ç±»æ•°æ®ï¼Œ<code>Redis</code> æä¾›çš„ <strong>æ•°æ®ç»“æ„</strong> å¯ä»¥ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“å®ç°è¿™äº›åŠŸèƒ½ã€‚</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><p><code>Redis</code> æä¾›çš„ <strong>å‘å¸ƒè®¢é˜…</strong>ï¼ˆ<code>PUB/SUB</code>ï¼‰å’Œ <strong>é˜»å¡é˜Ÿåˆ—</strong> çš„åŠŸèƒ½ï¼Œè™½ç„¶å’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—æ¯”ï¼Œè¿˜ <strong>ä¸å¤Ÿå¼ºå¤§</strong>ï¼Œä½†å¯¹äºä¸€èˆ¬çš„æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½åŸºæœ¬æ»¡è¶³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisè¯¦è§£ä¹‹â€”â€”å•çº¿ç¨‹é«˜å¹¶å‘</title>
      <link href="/2018/03/01/Redis/Redis%E8%AF%A6%E8%A7%A3%E4%B9%8B%E2%80%94%E2%80%94%E5%8D%95%E7%BA%BF%E7%A8%8B%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
      <url>/2018/03/01/Redis/Redis%E8%AF%A6%E8%A7%A3%E4%B9%8B%E2%80%94%E2%80%94%E5%8D%95%E7%BA%BF%E7%A8%8B%E9%AB%98%E5%B9%B6%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>redis æœ€åŸºæœ¬çš„ä¸€ä¸ªå†…éƒ¨åŸç†å’Œç‰¹ç‚¹ï¼Œå°±æ˜¯ redis å®é™…ä¸Šæ˜¯ä¸ªå•çº¿ç¨‹å·¥ä½œæ¨¡å‹ã€‚å¦‚ä»Šåœ¨å„å¤§äº’è”ç½‘å…¬å¸å·²ç»å¤§é¢ç§¯å–ä»£äº†memcachedçš„åº”ç”¨ã€‚å®ƒå¯ä»¥æ‰¿è½½ç›¸å½“å¤§çš„QPSã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡å¯¹Redisçš„çº¿ç¨‹æ¨¡å‹å’Œå¹¶å‘æ¨¡å‹å¯¹å®ƒçš„é«˜æ€§èƒ½è¿›è¡Œåˆ†æã€‚</p><a id="more"></a><h2 id="Redisçº¿ç¨‹æ¨¡å‹"><a href="#Redisçº¿ç¨‹æ¨¡å‹" class="headerlink" title="Redisçº¿ç¨‹æ¨¡å‹"></a>Redisçº¿ç¨‹æ¨¡å‹</h2><p>redis å†…éƒ¨ä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ file event handlerï¼Œè¿™ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ redis æ‰å«åšå•çº¿ç¨‹çš„æ¨¡å‹ã€‚å®ƒé‡‡ç”¨ IO å¤šè·¯å¤ç”¨æœºåˆ¶åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œæ ¹æ® socket ä¸Šçš„äº‹ä»¶æ¥é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„ç»“æ„åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¤šä¸ª socket</li><li>IO å¤šè·¯å¤ç”¨ç¨‹åº</li><li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨</li><li>äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰</li></ul><p>å¤šä¸ª socket å¯èƒ½ä¼šå¹¶å‘äº§ç”Ÿä¸åŒçš„æ“ä½œï¼Œæ¯ä¸ªæ“ä½œå¯¹åº”ä¸åŒçš„æ–‡ä»¶äº‹ä»¶ï¼Œä½†æ˜¯ IO å¤šè·¯å¤ç”¨ç¨‹åºä¼šç›‘å¬å¤šä¸ª socketï¼Œä¼šå°† socket äº§ç”Ÿçš„äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶ï¼ŒæŠŠè¯¥äº‹ä»¶äº¤ç»™å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>æ¥çœ‹å®¢æˆ·ç«¯ä¸ redis çš„ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/IEtOiXKdgDWRGos.png" alt="fv69yaxxd9"></p><p>å®¢æˆ·ç«¯ socket01 å‘ redis çš„ server socket è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶ server socket ä¼šäº§ç”Ÿä¸€ä¸ª AE_READABLE äº‹ä»¶ï¼ŒIO å¤šè·¯å¤ç”¨ç¨‹åºç›‘å¬åˆ° server socket äº§ç”Ÿçš„äº‹ä»¶åï¼Œå°†è¯¥äº‹ä»¶å‹å…¥é˜Ÿåˆ—ä¸­ã€‚æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä»é˜Ÿåˆ—ä¸­è·å–è¯¥äº‹ä»¶ï¼Œäº¤ç»™è¿æ¥åº”ç­”å¤„ç†å™¨ã€‚è¿æ¥åº”ç­”å¤„ç†å™¨ä¼šåˆ›å»ºä¸€ä¸ªèƒ½ä¸å®¢æˆ·ç«¯é€šä¿¡çš„ socket01ï¼Œå¹¶å°†è¯¥ socket01 çš„ AE_READABLE äº‹ä»¶ä¸å‘½ä»¤è¯·æ±‚å¤„ç†å™¨å…³è”ã€‚</p><p>å‡è®¾æ­¤æ—¶å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ª set key value è¯·æ±‚ï¼Œæ­¤æ—¶ redis ä¸­çš„ socket01 ä¼šäº§ç”Ÿ AE_READABLE äº‹ä»¶ï¼ŒIO å¤šè·¯å¤ç”¨ç¨‹åºå°†äº‹ä»¶å‹å…¥é˜Ÿåˆ—ï¼Œæ­¤æ—¶äº‹ä»¶åˆ†æ´¾å™¨ä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥äº‹ä»¶ï¼Œç”±äºå‰é¢ socket01 çš„ AE_READABLE äº‹ä»¶å·²ç»ä¸å‘½ä»¤è¯·æ±‚å¤„ç†å™¨å…³è”ï¼Œå› æ­¤äº‹ä»¶åˆ†æ´¾å™¨å°†äº‹ä»¶äº¤ç»™å‘½ä»¤è¯·æ±‚å¤„ç†å™¨æ¥å¤„ç†ã€‚å‘½ä»¤è¯·æ±‚å¤„ç†å™¨è¯»å– socket01 çš„ key value å¹¶åœ¨è‡ªå·±å†…å­˜ä¸­å®Œæˆ key value çš„è®¾ç½®ã€‚æ“ä½œå®Œæˆåï¼Œå®ƒä¼šå°† socket01 çš„ AE_WRITABLE äº‹ä»¶ä¸å‘½ä»¤å›å¤å¤„ç†å™¨å…³è”ã€‚</p><p>å¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯å‡†å¤‡å¥½æ¥æ”¶è¿”å›ç»“æœäº†ï¼Œé‚£ä¹ˆ redis ä¸­çš„ socket01 ä¼šäº§ç”Ÿä¸€ä¸ª AE_WRITABLE äº‹ä»¶ï¼ŒåŒæ ·å‹å…¥é˜Ÿåˆ—ä¸­ï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ‰¾åˆ°ç›¸å…³è”çš„å‘½ä»¤å›å¤å¤„ç†å™¨ï¼Œç”±å‘½ä»¤å›å¤å¤„ç†å™¨å¯¹ socket01 è¾“å…¥æœ¬æ¬¡æ“ä½œçš„ä¸€ä¸ªç»“æœï¼Œæ¯”å¦‚ okï¼Œä¹‹åè§£é™¤ socket01 çš„ AE_WRITABLE äº‹ä»¶ä¸å‘½ä»¤å›å¤å¤„ç†å™¨çš„å…³è”ã€‚</p><p>è¿™æ ·ä¾¿å®Œæˆäº†ä¸€æ¬¡é€šä¿¡ã€‚</p><h3 id="å‡ ç§I-Oæ¨¡å‹"><a href="#å‡ ç§I-Oæ¨¡å‹" class="headerlink" title="å‡ ç§I/Oæ¨¡å‹"></a>å‡ ç§I/Oæ¨¡å‹</h3><p>ä¸ºä»€ä¹ˆRedisè¦é‡‡ç”¨ I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Ÿ</p><p>Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯çº¿æ€§æ‰§è¡Œçš„ï¼Œç”±äºè¯»å†™æ“ä½œç­‰å¾…ç”¨æˆ·è¾“å…¥æˆ–è¾“å‡ºéƒ½æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥I/Oæ“ä½œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¾€å¾€ä¸èƒ½ç›´æ¥è¿”å›ï¼Œè¿™ä¼šå¯¼è‡´æŸä¸€æ–‡ä»¶çš„IOé˜»å¡å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æ— æ³•å¯¹å…¶ä»–å®¢æˆ·æä¾›æœåŠ¡ï¼Œè€ŒIOå¤šè·¯å¤ç”¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="å›é¡¾IOå¤šè·¯å¤ç”¨"><a href="#å›é¡¾IOå¤šè·¯å¤ç”¨" class="headerlink" title="å›é¡¾IOå¤šè·¯å¤ç”¨"></a>å›é¡¾IOå¤šè·¯å¤ç”¨</h4><p>å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…IOæ–‡ä»¶æè¿°ç¬¦ï¼Œå†…æ ¸ç›‘è§†è¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰ï¼Œå…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œ<code>select</code>ï¼Œ <code>poll</code>ï¼Œ<code>epoll</code>å‡½æ•°å°±å¯ä»¥è¿”å›ã€‚å¯¹äºç›‘è§†çš„æ–¹å¼ï¼Œåˆå¯ä»¥åˆ†ä¸º selectï¼Œ pollï¼Œ epollä¸‰ç§æ–¹å¼ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/T1hwz5douryFOXb.png" alt="20164149_LD8E"></p><h4 id="Reactorè®¾è®¡æ¨¡å¼"><a href="#Reactorè®¾è®¡æ¨¡å¼" class="headerlink" title="Reactorè®¾è®¡æ¨¡å¼"></a>Reactorè®¾è®¡æ¨¡å¼</h4><p>reactorè®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä¸€ç§<strong>åŸºäºäº‹ä»¶é©±åŠ¨</strong>çš„è®¾è®¡æ¨¡å¼ã€‚Reactoræ¡†æ¶æ˜¯ACEå„ä¸ªæ¡†æ¶ä¸­æœ€åŸºç¡€çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå…¶ä»–æ¡†æ¶éƒ½æˆ–å¤šæˆ–å°‘åœ°ç”¨åˆ°äº†Reactoræ¡†æ¶ã€‚åœ¨äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ä¸­ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·çš„æœåŠ¡è¯·æ±‚åˆ†ç¦»ï¼ˆdemultiplexï¼‰å’Œè°ƒåº¦ï¼ˆdispatchï¼‰ç»™åº”ç”¨ç¨‹åºã€‚åœ¨äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ä¸­ï¼ŒåŒæ­¥åœ°ã€æœ‰åºåœ°å¤„ç†åŒæ—¶æ¥æ”¶çš„å¤šä¸ªæœåŠ¡è¯·æ±‚ã€‚reactoræ¨¡å¼ä¸å¤–è§‚æ¨¡å¼æœ‰ç‚¹åƒã€‚ä¸è¿‡ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¸å•ä¸ªäº‹ä»¶æºå…³è”ï¼Œè€Œååº”å™¨æ¨¡å¼åˆ™ä¸å¤šä¸ªäº‹ä»¶æºå…³è” ã€‚å½“ä¸€ä¸ªä¸»ä½“å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾å±ä½“éƒ½å¾—åˆ°é€šçŸ¥ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/piHkn5ALthX34BR.png" alt="aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTYxMTAzMTAxMzAyMzMx"></p><blockquote><p>Handles ï¼šè¡¨ç¤ºæ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºfdã€‚</p><p>Synchronous Event Demultiplexer ï¼šåŒæ­¥äº‹ä»¶åˆ†ç¦»å™¨ï¼Œé˜»å¡ç­‰å¾…Handlesä¸­çš„äº‹ä»¶å‘ç”Ÿã€‚</p><p>Initiation Dispatcher ï¼šåˆå§‹åˆ†æ´¾å™¨ï¼Œä½œç”¨ä¸ºæ·»åŠ Event handlerï¼ˆäº‹ä»¶å¤„ç†å™¨ï¼‰ã€åˆ é™¤Event handlerä»¥åŠåˆ†æ´¾äº‹ä»¶ç»™Event handlerã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSynchronous Event Demultiplexerè´Ÿè´£ç­‰å¾…æ–°äº‹ä»¶å‘ç”Ÿï¼Œäº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥Initiation Dispatcherï¼Œç„¶åInitiation Dispatcherè°ƒç”¨event handlerå¤„ç†äº‹ä»¶ã€‚</p><p>Event Handler ï¼šäº‹ä»¶å¤„ç†å™¨çš„æ¥å£</p><p>Concrete Event Handler ï¼šäº‹ä»¶å¤„ç†å™¨çš„å®é™…å®ç°ï¼Œè€Œä¸”ç»‘å®šäº†ä¸€ä¸ªHandleã€‚å› ä¸ºåœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸æ­¢ä¸€ç§äº‹ä»¶å¤„ç†å™¨ï¼Œå› æ­¤è¿™é‡Œå°†äº‹ä»¶å¤„ç†å™¨æ¥å£å’Œå®ç°åˆ†å¼€ï¼Œä¸C++ã€Javaè¿™äº›é«˜çº§è¯­è¨€ä¸­çš„å¤šæ€ç±»ä¼¼ã€‚</p></blockquote><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨I/Oå¤šè·¯å¤ç”¨æ¨¡å—åŒæ—¶ç›‘å¬å¤šä¸ªFDï¼Œå½“acceptã€readã€writeå’Œcloseæ–‡ä»¶äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šå›è°ƒFDç»‘å®šçš„äº‹ä»¶å¤„ç†å™¨ã€‚</p><p>è™½ç„¶æ•´ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨åœ¨å•çº¿ç¨‹ä¸Šè¿è¡Œï¼Œä½†æ˜¯é€šè¿‡I/Oå¤šè·¯å¤ç”¨æ¨¡å—çš„å¼•å…¥ï¼Œå®ç°äº†åŒæ—¶å¯¹å¤šä¸ªFDè¯»å†™çš„ç›‘æ§ï¼Œæé«˜äº†ç½‘ç»œé€šä¿¡æ¨¡å‹çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿è¯æ•´ä¸ªRedisæœåŠ¡çš„å®ç°çš„ç®€å•ã€‚</p><h4 id="I-Oå¤šè·¯å¤ç”¨æ¨¡å—"><a href="#I-Oå¤šè·¯å¤ç”¨æ¨¡å—" class="headerlink" title="I/Oå¤šè·¯å¤ç”¨æ¨¡å—"></a>I/Oå¤šè·¯å¤ç”¨æ¨¡å—</h4>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> Redis </tag>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeræ ¸å¿ƒæŠ€æœ¯ä¸åŸç†åˆæ¢</title>
      <link href="/2018/03/01/docker/Docker%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
      <url>/2018/03/01/docker/Docker%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>æåˆ°è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„ä¸€å®šæ˜¯ Dockerï¼Œç»è¿‡å››å¹´çš„å¿«é€Ÿå‘å±• Docker å·²ç»æˆä¸ºäº†å¾ˆå¤šå…¬å¸çš„æ ‡é…ï¼Œä¹Ÿä¸å†æ˜¯ä¸€ä¸ªåªèƒ½åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨çš„ç©å…·äº†ã€‚ä½œä¸ºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¹¿æ³›åº”ç”¨çš„äº§å“ï¼ŒDocker æœ‰ç€éå¸¸æˆç†Ÿçš„ç¤¾åŒºä»¥åŠå¤§é‡çš„ä½¿ç”¨è€…ï¼Œä»£ç åº“ä¸­çš„å†…å®¹ä¹Ÿå˜å¾—éå¸¸åºå¤§ã€‚</p><p>Docker ç›®å‰çš„ç»„ä»¶ç›¸å½“å¤šï¼Œå¹¶ä¸”å®ç°ä¹Ÿéå¸¸å¤æ‚ï¼Œæœ¬æ–‡å¿½ç•¥ç¹æ‚çš„ç»†èŠ‚ï¼Œé›†ä¸­æ¢è®¨Dockerçš„ä¸€äº›åŸºç¡€æŠ€æœ¯åŸç†ã€‚</p><a id="more"></a><h2 id="å®¹å™¨ï¼Ÿè™šæ‹Ÿæœºï¼Ÿ"><a href="#å®¹å™¨ï¼Ÿè™šæ‹Ÿæœºï¼Ÿ" class="headerlink" title="å®¹å™¨ï¼Ÿè™šæ‹Ÿæœºï¼Ÿ"></a>å®¹å™¨ï¼Ÿè™šæ‹Ÿæœºï¼Ÿ</h2><p>å®¹å™¨å’Œè™šæ‹Ÿæœºæ˜¯éå¸¸ç›¸ä¼¼çš„æŠ€æœ¯æ¦‚å¿µï¼Œå› ä¸ºä»–ä»¬éƒ½æä¾›äº†éš”ç¦»åº”ç”¨å’Œä¾èµ–ç¯å¢ƒçš„èƒ½åŠ›ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯æä¾›äº†ä¸€ä¸ªæ²™ç®±ç¯å¢ƒï¼Œä½¿å¾—åº”ç”¨éƒ½å¯ä»¥éƒ¨ç½²åœ¨ä»»æ„å®¿ä¸»æœºã€‚ä½†ä¸¤è€…çš„åº•å±‚åŸç†æœ‰æ‰€ä¸åŒã€‚</p><h3 id="è™šæ‹Ÿæœº"><a href="#è™šæ‹Ÿæœº" class="headerlink" title="è™šæ‹Ÿæœº"></a>è™šæ‹Ÿæœº</h3><p>è™šæ‹Ÿæœºç†è®ºä¸Šæ˜¯ä¸€ä¸ªçœŸå®çš„è®¡ç®—æœºæ“ä½œç³»ç»Ÿçš„å°è£…ï¼Œå®ƒè¿è¡Œåœ¨ç‰©ç†è®¾å¤‡ä¹‹ä¸Šï¼Œé€šè¿‡ Hypervisor è¿›è¡Œå»ºç«‹å’Œè¿è¡Œè™šæ‹Ÿæœºä½“ç³»ã€‚å¸¸è§çš„è™šæ‹ŸåŸºæœ¬æ¶æ„å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/02/Crgxi5A8OtdD6V1.png" alt="2019-07-31-15-40-55"></p><p>åœ¨ Host OS çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ Hypervisor æ¥è¿›è¡Œè™šæ‹Ÿæœºèµ„æºæ§åˆ¶ï¼Œå¹¶æ‹¥æœ‰è‡ªå·±çš„ Guest OSï¼Œè™½ç„¶éš”ç¦»å¾—æ›´å½»åº•ï¼Œä½†æ˜¯æ˜¾ç„¶èµ„æºçš„å¼€é”€ä¼šæ›´å¤§ã€‚</p><h3 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h3><p>ä¸åŒäºè™šæ‹Ÿæœºæä¾›åœ¨ç‰©ç†ç¡¬ä»¶çº§åˆ«çš„æ“ä½œç³»ç»Ÿéš”ç¦»ï¼Œå®¹å™¨æŠ€æœ¯æä¾›çš„æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„è¿›ç¨‹éš”ç¦»ï¼ŒDocker æœ¬èº«åªæ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œåªæ˜¯åœ¨å®¹å™¨æŠ€æœ¯ä¸‹ï¼Œè¿›ç¨‹ä¹‹é—´ç½‘ç»œã€ç©ºé—´ç­‰ç­‰æ˜¯éš”ç¦»çš„ï¼Œäº’ä¸çŸ¥é“å½¼æ­¤ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/rhYdmqNQnzajc3f.png" alt="docker-core-techs"></p><p><strong>å®¹å™¨ä¸è™šæ‹ŸæœºæŠ€æœ¯æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå¤šä¸ªå®¹å™¨ä¹‹é—´æ˜¯å…±äº«äº†å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸</strong>ã€‚åœ¨ Host OS ä¸Šï¼Œé€šè¿‡ Docker Engine å…±äº« Host OS çš„å†…æ ¸ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/02/OgkzsIcBhWbL1nH.png" alt="img"></p><p>é¦–å…ˆï¼ŒDocker çš„å‡ºç°ä¸€å®šæ˜¯å› ä¸ºç›®å‰çš„åç«¯åœ¨å¼€å‘å’Œè¿ç»´é˜¶æ®µç¡®å®éœ€è¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯è§£å†³å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç¯å¢ƒä¸€è‡´çš„é—®é¢˜ï¼Œé€šè¿‡ Docker æˆ‘ä»¬å¯ä»¥å°†ç¨‹åºè¿è¡Œçš„ç¯å¢ƒä¹Ÿçº³å…¥åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œæ’é™¤å› ä¸ºç¯å¢ƒé€ æˆä¸åŒè¿è¡Œç»“æœçš„å¯èƒ½ã€‚ä½†æ˜¯ä¸Šè¿°éœ€æ±‚è™½ç„¶æ¨åŠ¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯çš„äº§ç”Ÿï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰åˆé€‚çš„åº•å±‚æŠ€æœ¯æ”¯æ’‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»ç„¶å¾—ä¸åˆ°ä¸€ä¸ªå®Œç¾çš„äº§å“ã€‚æœ¬æ–‡å‰©ä¸‹çš„å†…å®¹ä¼šä»‹ç»å‡ ç§ Docker ä½¿ç”¨çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¦‚æœæˆ‘ä»¬äº†è§£å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•å’ŒåŸç†ï¼Œå°±èƒ½æ¸…æ¥š Docker çš„å®ç°åŸç†ã€‚</p><h2 id="èµ„æºéš”ç¦»ï¼šå‘½åç©ºé—´-Namespaces"><a href="#èµ„æºéš”ç¦»ï¼šå‘½åç©ºé—´-Namespaces" class="headerlink" title="èµ„æºéš”ç¦»ï¼šå‘½åç©ºé—´ Namespaces"></a>èµ„æºéš”ç¦»ï¼šå‘½åç©ºé—´ Namespaces</h2><p>å‘½åç©ºé—´ (namespaces) æ˜¯ Linux ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºåˆ†ç¦»è¿›ç¨‹æ ‘ã€ç½‘ç»œæ¥å£ã€æŒ‚è½½ç‚¹ä»¥åŠè¿›ç¨‹é—´é€šä¿¡ç­‰èµ„æºçš„æ–¹æ³•ã€‚åœ¨æ—¥å¸¸ä½¿ç”¨ Linux æˆ–è€… macOS æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿è¡Œå¤šä¸ªå®Œå…¨åˆ†ç¦»çš„æœåŠ¡å™¨çš„éœ€è¦ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†å¤šä¸ªæœåŠ¡ï¼Œè¿™äº›æœåŠ¡å…¶å®ä¼šç›¸äº’å½±å“çš„ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½èƒ½çœ‹åˆ°å…¶ä»–æœåŠ¡çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥è®¿é—®å®¿ä¸»æœºå™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œè¿™æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¸æ„¿æ„çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒæœåŠ¡èƒ½åšåˆ°<strong>å®Œå…¨éš”ç¦»</strong>ï¼Œå°±åƒè¿è¡Œåœ¨å¤šå°ä¸åŒçš„æœºå™¨ä¸Šä¸€æ ·ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/7XbSceY8OupAmgN.png" alt="multiple-servers-on-linux"></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦æœåŠ¡å™¨ä¸Šçš„æŸä¸€ä¸ªæœåŠ¡è¢«å…¥ä¾µï¼Œé‚£ä¹ˆå…¥ä¾µè€…å°±èƒ½å¤Ÿè®¿é—®å½“å‰æœºå™¨ä¸Šçš„æ‰€æœ‰æœåŠ¡å’Œæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„ï¼Œè€Œ Docker å…¶å®å°±é€šè¿‡ Linux çš„ Namespaces å¯¹ä¸åŒçš„å®¹å™¨å®ç°äº†éš”ç¦»ã€‚</p><p>Linux çš„å‘½åç©ºé—´æœºåˆ¶æä¾›äº†ä»¥ä¸‹ä¸ƒç§ä¸åŒçš„å‘½åç©ºé—´ï¼ŒåŒ…æ‹¬ <code>CLONE_NEWCGROUP</code>ã€<code>CLONE_NEWIPC</code>ã€<code>CLONE_NEWNET</code>ã€<code>CLONE_NEWNS</code>ã€<code>CLONE_NEWPID</code>ã€<code>CLONE_NEWUSER</code> å’Œ <code>CLONE_NEWUTS</code>ï¼Œé€šè¿‡è¿™ä¸ƒä¸ªé€‰é¡¹æˆ‘ä»¬èƒ½åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹æ—¶è®¾ç½®æ–°è¿›ç¨‹åº”è¯¥åœ¨å“ªäº›èµ„æºä¸Šä¸å®¿ä¸»æœºå™¨è¿›è¡Œéš”ç¦»ã€‚</p><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p>è¿›ç¨‹æ˜¯ Linux ä»¥åŠç°åœ¨æ“ä½œç³»ç»Ÿä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œä¹Ÿæ˜¯åœ¨ç°ä»£åˆ†æ—¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªä»»åŠ¡å•å…ƒã€‚åœ¨æ¯ä¸€ä¸ª *nix çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿé€šè¿‡ <code>ps</code> å‘½ä»¤æ‰“å°å‡ºå½“å‰æ“ä½œç³»ç»Ÿä¸­æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œæ¯”å¦‚åœ¨ Ubuntu ä¸Šï¼Œä½¿ç”¨è¯¥å‘½ä»¤å°±èƒ½å¾—åˆ°ä»¥ä¸‹çš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps -ef</span></span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 Apr08 ?        00:00:09 /sbin/init</span><br><span class="line">root         2     0  0 Apr08 ?        00:00:00 [kthreadd]</span><br><span class="line">root         3     2  0 Apr08 ?        00:00:05 [ksoftirqd/0]</span><br><span class="line">root         5     2  0 Apr08 ?        00:00:00 [kworker/0:0H]</span><br><span class="line">root         7     2  0 Apr08 ?        00:07:10 [rcu_sched]</span><br><span class="line">root        39     2  0 Apr08 ?        00:00:00 [migration/0]</span><br><span class="line">root        40     2  0 Apr08 ?        00:01:54 [watchdog/0]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å½“å‰æœºå™¨ä¸Šæœ‰å¾ˆå¤šçš„è¿›ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œåœ¨ä¸Šè¿°è¿›ç¨‹ä¸­æœ‰ä¸¤ä¸ªéå¸¸ç‰¹æ®Šï¼Œä¸€ä¸ªæ˜¯ <code>pid</code> ä¸º 1 çš„ <code>/sbin/init</code> è¿›ç¨‹ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>pid</code> ä¸º 2 çš„ <code>kthreadd</code> è¿›ç¨‹ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ˜¯è¢« Linux ä¸­çš„ä¸Šå¸è¿›ç¨‹ <code>idle</code> åˆ›å»ºå‡ºæ¥çš„ï¼Œå…¶ä¸­å‰è€…è´Ÿè´£æ‰§è¡Œå†…æ ¸çš„ä¸€éƒ¨åˆ†åˆå§‹åŒ–å·¥ä½œå’Œç³»ç»Ÿé…ç½®ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€äº›ç±»ä¼¼ <code>getty</code> çš„æ³¨å†Œè¿›ç¨‹ï¼Œè€Œåè€…è´Ÿè´£ç®¡ç†å’Œè°ƒåº¦å…¶ä»–çš„å†…æ ¸è¿›ç¨‹ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/ecHLJgxUOtnXKGa.png" alt="linux-processes"></p><p>å¦‚æœæˆ‘ä»¬åœ¨å½“å‰çš„ Linux æ“ä½œç³»ç»Ÿä¸‹è¿è¡Œä¸€ä¸ªæ–°çš„ Docker å®¹å™¨ï¼Œå¹¶é€šè¿‡ <code>exec</code> è¿›å…¥å…¶å†…éƒ¨çš„ <code>bash</code> å¹¶æ‰“å°å…¶ä¸­çš„å…¨éƒ¨è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹çš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@iZ255w13cy6Z:~# docker run -it -d ubuntu</span><br><span class="line">b809a2eb3630e64c581561b08ac46154878ff1c61c6519848b4a29d412215e79</span><br><span class="line">root@iZ255w13cy6Z:~# docker exec -it b809a2eb3630 /bin/bash</span><br><span class="line">root@b809a2eb3630:/# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 15:42 pts/0    00:00:00 /bin/bash</span><br><span class="line">root         9     0  0 15:42 pts/1    00:00:00 /bin/bash</span><br><span class="line">root        17     9  0 15:43 pts/1    00:00:00 ps -ef</span><br></pre></td></tr></table></figure><p>åœ¨æ–°çš„å®¹å™¨å†…éƒ¨æ‰§è¡Œ <code>ps</code> å‘½ä»¤æ‰“å°å‡ºäº†éå¸¸å¹²å‡€çš„è¿›ç¨‹åˆ—è¡¨ï¼Œåªæœ‰åŒ…å«å½“å‰ <code>ps -ef</code> åœ¨å†…çš„ä¸‰ä¸ªè¿›ç¨‹ï¼Œåœ¨å®¿ä¸»æœºå™¨ä¸Šçš„å‡ åä¸ªè¿›ç¨‹éƒ½å·²ç»æ¶ˆå¤±ä¸è§äº†ã€‚</p><p>å½“å‰çš„ Docker å®¹å™¨æˆåŠŸå°†å®¹å™¨å†…çš„è¿›ç¨‹ä¸å®¿ä¸»æœºå™¨ä¸­çš„è¿›ç¨‹éš”ç¦»ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å®¿ä¸»æœºå™¨ä¸Šæ‰“å°å½“å‰çš„å…¨éƒ¨è¿›ç¨‹æ—¶ï¼Œä¼šå¾—åˆ°ä¸‹é¢ä¸‰æ¡ä¸ Docker ç›¸å…³çš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     29407     1  0 Nov16 ?        00:08:38 /usr/bin/dockerd --raw-logs</span><br><span class="line">root      1554 29407  0 Nov19 ?        00:03:28 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state-dir /var/run/docker/libcontainerd/containerd --shim docker-containerd-shim --runtime docker-runc</span><br><span class="line">root      5006  1554  0 08:38 ?        00:00:00 docker-containerd-shim b809a2eb3630e64c581561b08ac46154878ff1c61c6519848b4a29d412215e79 /var/run/docker/libcontainerd/b809a2eb3630e64c581561b08ac46154878ff1c61c6519848b4a29d412215e79 docker-runc</span><br></pre></td></tr></table></figure><p>åœ¨å½“å‰çš„å®¿ä¸»æœºå™¨ä¸Šï¼Œå¯èƒ½å°±å­˜åœ¨ç”±ä¸Šè¿°çš„ä¸åŒè¿›ç¨‹æ„æˆçš„è¿›ç¨‹æ ‘ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/jrcaVNQ1OYteB3h.png" alt="docker-process-group"></p><p>è¿™å°±æ˜¯åœ¨ä½¿ç”¨ <code>clone(2)</code> åˆ›å»ºæ–°è¿›ç¨‹æ—¶ä¼ å…¥ <code>CLONE_NEWPID</code> å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ Linux çš„å‘½åç©ºé—´å®ç°è¿›ç¨‹çš„éš”ç¦»ï¼ŒDocker å®¹å™¨å†…éƒ¨çš„ä»»æ„è¿›ç¨‹éƒ½å¯¹å®¿ä¸»æœºå™¨çš„è¿›ç¨‹ä¸€æ— æ‰€çŸ¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">containerRouter.postContainersStart</span><br><span class="line">â””â”€â”€ daemon.ContainerStart</span><br><span class="line">    â””â”€â”€ daemon.createSpec</span><br><span class="line">        â””â”€â”€ setNamespaces</span><br><span class="line">            â””â”€â”€ setNamespace</span><br></pre></td></tr></table></figure><p>Docker çš„å®¹å™¨å°±æ˜¯ä½¿ç”¨ä¸Šè¿°æŠ€æœ¯å®ç°ä¸å®¿ä¸»æœºå™¨çš„è¿›ç¨‹éš”ç¦»ï¼Œå½“æˆ‘ä»¬æ¯æ¬¡è¿è¡Œ <code>docker run</code> æˆ–è€… <code>docker start</code> æ—¶ï¼Œéƒ½ä¼šåœ¨ä¸‹é¢çš„æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªç”¨äºè®¾ç½®è¿›ç¨‹é—´éš”ç¦»çš„ Specï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(daemon *Daemon)</span> <span class="title">createSpec</span><span class="params">(c *container.Container)</span> <span class="params">(*specs.Spec, error)</span></span> &#123;</span><br><span class="line">s := oci.DefaultSpec()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">if</span> err := setNamespaces(daemon, &amp;s, c); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;linux spec namespaces: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &amp;s, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>setNamespaces</code> æ–¹æ³•ä¸­ä¸ä»…ä¼šè®¾ç½®è¿›ç¨‹ç›¸å…³çš„å‘½åç©ºé—´ï¼Œè¿˜ä¼šè®¾ç½®ä¸ç”¨æˆ·ã€ç½‘ç»œã€IPC ä»¥åŠ UTS ç›¸å…³çš„å‘½åç©ºé—´ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setNamespaces</span><span class="params">(daemon *Daemon, s *specs.Spec, c *container.Container)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// user</span></span><br><span class="line"><span class="comment">// network</span></span><br><span class="line"><span class="comment">// ipc</span></span><br><span class="line"><span class="comment">// uts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pid</span></span><br><span class="line"><span class="keyword">if</span> c.HostConfig.PidMode.IsContainer() &#123;</span><br><span class="line">ns := specs.LinuxNamespace&#123;Type: <span class="string">&quot;pid&quot;</span>&#125;</span><br><span class="line">pc, err := daemon.getPidContainer(c)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">ns.Path = fmt.Sprintf(<span class="string">&quot;/proc/%d/ns/pid&quot;</span>, pc.State.GetPID())</span><br><span class="line">setNamespace(s, ns)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.HostConfig.PidMode.IsHost() &#123;</span><br><span class="line">oci.RemoveNamespace(s, specs.LinuxNamespaceType(<span class="string">&quot;pid&quot;</span>))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ns := specs.LinuxNamespace&#123;Type: <span class="string">&quot;pid&quot;</span>&#125;</span><br><span class="line">setNamespace(s, ns)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å‘½åç©ºé—´ç›¸å…³çš„è®¾ç½® <code>Spec</code> æœ€åéƒ½ä¼šä½œä¸º <code>Create</code> å‡½æ•°çš„å…¥å‚åœ¨åˆ›å»ºæ–°çš„å®¹å™¨æ—¶è¿›è¡Œè®¾ç½®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemon.containerd.Create(context.Background(), container.ID, spec, createOptions)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ä¸å‘½åç©ºé—´çš„ç›¸å…³çš„è®¾ç½®éƒ½æ˜¯åœ¨ä¸Šè¿°çš„ä¸¤ä¸ªå‡½æ•°ä¸­å®Œæˆçš„ï¼ŒDocker é€šè¿‡å‘½åç©ºé—´æˆåŠŸå®Œæˆäº†ä¸å®¿ä¸»æœºè¿›ç¨‹å’Œç½‘ç»œçš„éš”ç¦»ã€‚</p><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><p>å¦‚æœ Docker çš„å®¹å™¨é€šè¿‡ Linux çš„å‘½åç©ºé—´å®Œæˆäº†ä¸å®¿ä¸»æœºè¿›ç¨‹çš„ç½‘ç»œéš”ç¦»ï¼Œä½†æ˜¯å´åˆæ²¡æœ‰åŠæ³•é€šè¿‡å®¿ä¸»æœºçš„ç½‘ç»œä¸æ•´ä¸ªäº’è”ç½‘ç›¸è¿ï¼Œå°±ä¼šäº§ç”Ÿå¾ˆå¤šé™åˆ¶ï¼Œæ‰€ä»¥ Docker è™½ç„¶å¯ä»¥é€šè¿‡å‘½åç©ºé—´åˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ç½‘ç»œç¯å¢ƒï¼Œä½†æ˜¯ Docker ä¸­çš„æœåŠ¡ä»ç„¶éœ€è¦ä¸å¤–ç•Œç›¸è¿æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p><p>æ¯ä¸€ä¸ªä½¿ç”¨ <code>docker run</code> å¯åŠ¨çš„å®¹å™¨å…¶å®éƒ½å…·æœ‰å•ç‹¬çš„ç½‘ç»œå‘½åç©ºé—´ï¼ŒDocker ä¸ºæˆ‘ä»¬æä¾›äº†å››ç§ä¸åŒçš„ç½‘ç»œæ¨¡å¼ï¼ŒHostã€Containerã€None å’Œ Bridge æ¨¡å¼ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/PvBQqfkS3N1mpxi.png" alt="docker-network"></p><p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä»‹ç» Docker é»˜è®¤çš„ç½‘ç»œè®¾ç½®æ¨¡å¼ï¼šç½‘æ¡¥æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œé™¤äº†åˆ†é…éš”ç¦»çš„ç½‘ç»œå‘½åç©ºé—´ä¹‹å¤–ï¼ŒDocker è¿˜ä¼šä¸ºæ‰€æœ‰çš„å®¹å™¨è®¾ç½® IP åœ°å€ã€‚å½“ Docker æœåŠ¡å™¨åœ¨ä¸»æœºä¸Šå¯åŠ¨ä¹‹åä¼šåˆ›å»ºæ–°çš„è™šæ‹Ÿç½‘æ¡¥ docker0ï¼Œéšååœ¨è¯¥ä¸»æœºä¸Šå¯åŠ¨çš„å…¨éƒ¨æœåŠ¡åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½ä¸è¯¥ç½‘æ¡¥ç›¸è¿ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/J7uD3G9gSd6eO1l.png" alt="docker-network-topology"></p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªå®¹å™¨åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡ï¼Œä¸¤ä¸ªè™šæ‹Ÿç½‘å¡ç»„æˆäº†æ•°æ®çš„é€šé“ï¼Œå…¶ä¸­ä¸€ä¸ªä¼šæ”¾åœ¨åˆ›å»ºçš„å®¹å™¨ä¸­ï¼Œä¼šåŠ å…¥åˆ°åä¸º docker0 ç½‘æ¡¥ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç½‘æ¡¥çš„æ¥å£ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brctl show</span></span><br><span class="line">bridge namebridge idSTP enabledinterfaces</span><br><span class="line">docker08000.0242a6654980noveth3e84d4f</span><br><span class="line">            veth9953b75</span><br></pre></td></tr></table></figure><p>docker0 ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªæ–°çš„ IP åœ°å€å¹¶å°† docker0 çš„ IP åœ°å€è®¾ç½®ä¸ºé»˜è®¤çš„ç½‘å…³ã€‚ç½‘æ¡¥ docker0 é€šè¿‡ iptables ä¸­çš„é…ç½®ä¸å®¿ä¸»æœºå™¨ä¸Šçš„ç½‘å¡ç›¸è¿ï¼Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ iptables è½¬å‘åˆ° docker0 å¹¶ç”±ç½‘æ¡¥åˆ†å‘ç»™å¯¹åº”çš„æœºå™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> iptables -t nat -L</span></span><br><span class="line">Chain PREROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">DOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL</span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">RETURN     all  --  anywhere             anywhere</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å½“å‰çš„æœºå™¨ä¸Šä½¿ç”¨ <code>docker run -d -p 6379:6379 redis</code> å‘½ä»¤å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„ Redis å®¹å™¨ï¼Œåœ¨è¿™ä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹å½“å‰ <code>iptables</code> çš„ NAT é…ç½®å°±ä¼šçœ‹åˆ°åœ¨ <code>DOCKER</code> çš„é“¾ä¸­å‡ºç°äº†ä¸€æ¡æ–°çš„è§„åˆ™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DNAT       tcp  --  anywhere             anywhere             tcp dpt:6379 to:192.168.0.4:6379</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è§„åˆ™ä¼šå°†ä»ä»»æ„æºå‘é€åˆ°å½“å‰æœºå™¨ 6379 ç«¯å£çš„ TCP åŒ…è½¬å‘åˆ° 192.168.0.4:6379 æ‰€åœ¨çš„åœ°å€ä¸Šã€‚</p><p>è¿™ä¸ªåœ°å€å…¶å®ä¹Ÿæ˜¯ Docker ä¸º Redis æœåŠ¡åˆ†é…çš„ IP åœ°å€ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å½“å‰æœºå™¨ä¸Šç›´æ¥ ping è¿™ä¸ª IP åœ°å€å°±ä¼šå‘ç°å®ƒæ˜¯å¯ä»¥è®¿é—®åˆ°çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ping 192.168.0.4</span></span><br><span class="line">PING 192.168.0.4 (192.168.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.4: icmp_seq=1 ttl=64 time=0.069 ms</span><br><span class="line">64 bytes from 192.168.0.4: icmp_seq=2 ttl=64 time=0.043 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.4 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.043/0.056/0.069/0.013 ms</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°çš„ä¸€ç³»åˆ—ç°è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¨æµ‹å‡º Docker æ˜¯å¦‚ä½•å°†å®¹å™¨çš„å†…éƒ¨çš„ç«¯å£æš´éœ²å‡ºæ¥å¹¶å¯¹æ•°æ®åŒ…è¿›è¡Œè½¬å‘çš„äº†ï¼›å½“æœ‰ Docker çš„å®¹å™¨éœ€è¦å°†æœåŠ¡æš´éœ²ç»™å®¿ä¸»æœºå™¨ï¼Œå°±ä¼šä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼ŒåŒæ—¶å‘ iptables ä¸­è¿½åŠ ä¸€æ¡æ–°çš„è§„åˆ™ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/dax5mACvb6NHfEF.png" alt="docker-network-forward"></p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>redis-cli</code> åœ¨å®¿ä¸»æœºå™¨çš„å‘½ä»¤è¡Œä¸­è®¿é—® 127.0.0.1:6379 çš„åœ°å€æ—¶ï¼Œç»è¿‡ iptables çš„ NAT PREROUTING å°† ip åœ°å€å®šå‘åˆ°äº† 192.168.0.4ï¼Œé‡å®šå‘è¿‡çš„æ•°æ®åŒ…å°±å¯ä»¥é€šè¿‡ iptables ä¸­çš„ FILTER é…ç½®ï¼Œæœ€ç»ˆåœ¨ NAT POSTROUTING é˜¶æ®µå°† ip åœ°å€ä¼ªè£…æˆ 127.0.0.1ï¼Œåˆ°è¿™é‡Œè™½ç„¶ä»å¤–é¢çœ‹èµ·æ¥æˆ‘ä»¬è¯·æ±‚çš„æ˜¯ 127.0.0.1:6379ï¼Œä½†æ˜¯å®é™…ä¸Šè¯·æ±‚çš„å·²ç»æ˜¯ Docker å®¹å™¨æš´éœ²å‡ºçš„ç«¯å£äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> redis-cli -h 127.0.0.1 -p 6379 ping</span></span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><p>Docker é€šè¿‡ Linux çš„å‘½åç©ºé—´å®ç°äº†ç½‘ç»œçš„éš”ç¦»ï¼Œåˆé€šè¿‡ iptables è¿›è¡Œæ•°æ®åŒ…è½¬å‘ï¼Œè®© Docker å®¹å™¨èƒ½å¤Ÿä¼˜é›…åœ°ä¸ºå®¿ä¸»æœºå™¨æˆ–è€…å…¶ä»–å®¹å™¨æä¾›æœåŠ¡ã€‚</p><h4 id="libnetwork"><a href="#libnetwork" class="headerlink" title="libnetwork"></a>libnetwork</h4><p>æ•´ä¸ªç½‘ç»œéƒ¨åˆ†çš„åŠŸèƒ½éƒ½æ˜¯é€šè¿‡ Docker æ‹†åˆ†å‡ºæ¥çš„ libnetwork å®ç°çš„ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè¿æ¥ä¸åŒå®¹å™¨çš„å®ç°ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä¸ºåº”ç”¨ç»™å‡ºä¸€ä¸ªèƒ½å¤Ÿæä¾›ä¸€è‡´çš„ç¼–ç¨‹æ¥å£å’Œç½‘ç»œå±‚æŠ½è±¡çš„<strong>å®¹å™¨ç½‘ç»œæ¨¡å‹</strong>ã€‚</p><blockquote><p>The goal of libnetwork is to deliver a robust Container Network Model that provides a consistent programming interface and the required network abstractions for applications.</p></blockquote><p>libnetwork ä¸­æœ€é‡è¦çš„æ¦‚å¿µï¼Œå®¹å™¨ç½‘ç»œæ¨¡å‹ç”±ä»¥ä¸‹çš„å‡ ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼Œåˆ†åˆ«æ˜¯ Sandboxã€Endpoint å’Œ Networkï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/T5mjHLCXvh4J3tu.png" alt="container-network-model"></p><p>åœ¨å®¹å™¨ç½‘ç»œæ¨¡å‹ä¸­ï¼Œæ¯ä¸€ä¸ªå®¹å™¨å†…éƒ¨éƒ½åŒ…å«ä¸€ä¸ª Sandboxï¼Œå…¶ä¸­å­˜å‚¨ç€å½“å‰å®¹å™¨çš„ç½‘ç»œæ ˆé…ç½®ï¼ŒåŒ…æ‹¬å®¹å™¨çš„æ¥å£ã€è·¯ç”±è¡¨å’Œ DNS è®¾ç½®ï¼ŒLinux ä½¿ç”¨ç½‘ç»œå‘½åç©ºé—´å®ç°è¿™ä¸ª Sandboxï¼Œæ¯ä¸€ä¸ª Sandbox ä¸­éƒ½å¯èƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª Endpointï¼Œåœ¨ Linux ä¸Šå°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘å¡ vethï¼ŒSandbox é€šè¿‡ Endpoint åŠ å…¥åˆ°å¯¹åº”çš„ç½‘ç»œä¸­ï¼Œè¿™é‡Œçš„ç½‘ç»œå¯èƒ½å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°çš„ Linux ç½‘æ¡¥æˆ–è€… VLANã€‚</p><blockquote><p>æƒ³è¦è·å¾—æ›´å¤šä¸ libnetwork æˆ–è€…å®¹å™¨ç½‘ç»œæ¨¡å‹ç›¸å…³çš„ä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯» <a href="https://github.com/docker/libnetwork/blob/master/docs/design.md">Design Â· libnetwork</a> äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é˜…è¯»æºä»£ç äº†è§£ä¸åŒ OS å¯¹å®¹å™¨ç½‘ç»œæ¨¡å‹çš„ä¸åŒå®ç°ã€‚</p></blockquote><h3 id="æŒ‚è½½ç‚¹"><a href="#æŒ‚è½½ç‚¹" class="headerlink" title="æŒ‚è½½ç‚¹"></a>æŒ‚è½½ç‚¹</h3><p>è™½ç„¶æˆ‘ä»¬å·²ç»é€šè¿‡ Linux çš„å‘½åç©ºé—´è§£å†³äº†è¿›ç¨‹å’Œç½‘ç»œéš”ç¦»çš„é—®é¢˜ï¼Œåœ¨ Docker è¿›ç¨‹ä¸­æˆ‘ä»¬å·²ç»æ²¡æœ‰åŠæ³•è®¿é—®å®¿ä¸»æœºå™¨ä¸Šçš„å…¶ä»–è¿›ç¨‹å¹¶ä¸”é™åˆ¶äº†ç½‘ç»œçš„è®¿é—®ï¼Œä½†æ˜¯ Docker å®¹å™¨ä¸­çš„è¿›ç¨‹ä»ç„¶èƒ½å¤Ÿè®¿é—®æˆ–è€…ä¿®æ”¹å®¿ä¸»æœºå™¨ä¸Šçš„å…¶ä»–ç›®å½•ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›çœ‹åˆ°çš„ã€‚</p><p>åœ¨æ–°çš„è¿›ç¨‹ä¸­åˆ›å»ºéš”ç¦»çš„æŒ‚è½½ç‚¹å‘½åç©ºé—´éœ€è¦åœ¨ <code>clone</code> å‡½æ•°ä¸­ä¼ å…¥ <code>CLONE_NEWNS</code>ï¼Œè¿™æ ·å­è¿›ç¨‹å°±èƒ½å¾—åˆ°çˆ¶è¿›ç¨‹æŒ‚è½½ç‚¹çš„æ‹·è´ï¼Œå¦‚æœä¸ä¼ å…¥è¿™ä¸ªå‚æ•°<strong>å­è¿›ç¨‹å¯¹æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™éƒ½ä¼šåŒæ­¥å›çˆ¶è¿›ç¨‹ä»¥åŠæ•´ä¸ªä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿ</strong>ã€‚</p><p>å¦‚æœä¸€ä¸ªå®¹å™¨éœ€è¦å¯åŠ¨ï¼Œé‚£ä¹ˆå®ƒä¸€å®šéœ€è¦æä¾›ä¸€ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆrootfsï¼‰ï¼Œå®¹å™¨éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œæ‰€æœ‰äºŒè¿›åˆ¶çš„æ‰§è¡Œéƒ½å¿…é¡»åœ¨è¿™ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/YL8jAqxevWuZPSy.png" alt="libcontainer-filesystem"></p><p>æƒ³è¦æ­£å¸¸å¯åŠ¨ä¸€ä¸ªå®¹å™¨å°±éœ€è¦åœ¨ rootfs ä¸­æŒ‚è½½ä»¥ä¸Šçš„å‡ ä¸ªç‰¹å®šçš„ç›®å½•ï¼Œé™¤äº†ä¸Šè¿°çš„å‡ ä¸ªç›®å½•éœ€è¦æŒ‚è½½ä¹‹å¤–æˆ‘ä»¬è¿˜éœ€è¦å»ºç«‹ä¸€äº›ç¬¦å·é“¾æ¥ä¿è¯ç³»ç»Ÿ IO ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/M7dcRLkSNeVHbj6.png" alt="libcontainer-symlinks-and-io"></p><p>ä¸ºäº†ä¿è¯å½“å‰çš„å®¹å™¨è¿›ç¨‹æ²¡æœ‰åŠæ³•è®¿é—®å®¿ä¸»æœºå™¨ä¸Šå…¶ä»–ç›®å½•ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¿˜éœ€è¦é€šè¿‡ libcontainer æä¾›çš„ <code>pivot_root</code> æˆ–è€… <code>chroot</code> å‡½æ•°æ”¹å˜è¿›ç¨‹èƒ½å¤Ÿè®¿é—®ä¸ªæ–‡ä»¶ç›®å½•çš„æ ¹èŠ‚ç‚¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pivor_root</span></span><br><span class="line">put_old = mkdir(...);</span><br><span class="line">pivot_root(rootfs, put_old);</span><br><span class="line">chdir(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">unmount(put_old, MS_DETACH);</span><br><span class="line">rmdir(put_old);</span><br><span class="line"></span><br><span class="line"><span class="comment">// chroot</span></span><br><span class="line">mount(rootfs, <span class="string">&quot;/&quot;</span>, <span class="literal">NULL</span>, MS_MOVE, <span class="literal">NULL</span>);</span><br><span class="line">chroot(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;/&quot;</span>);</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å°†å®¹å™¨éœ€è¦çš„ç›®å½•æŒ‚è½½åˆ°äº†å®¹å™¨ä¸­ï¼ŒåŒæ—¶ä¹Ÿç¦æ­¢å½“å‰çš„å®¹å™¨è¿›ç¨‹è®¿é—®å®¿ä¸»æœºå™¨ä¸Šçš„å…¶ä»–ç›®å½•ï¼Œä¿è¯äº†ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„éš”ç¦»ã€‚</p><blockquote><p>è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹æ˜¯ä½œè€…åœ¨ libcontainer ä¸­çš„ <a href="https://github.com/opencontainers/runc/blob/master/libcontainer/SPEC.md">SPEC.md</a> æ–‡ä»¶ä¸­æ‰¾åˆ°çš„ï¼Œå…¶ä¸­åŒ…å«äº† Docker ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿçš„è¯´æ˜ï¼Œå¯¹äº Docker æ˜¯å¦çœŸçš„ä½¿ç”¨ <code>chroot</code> æ¥ç¡®ä¿å½“å‰çš„è¿›ç¨‹æ— æ³•è®¿é—®å®¿ä¸»æœºå™¨çš„ç›®å½•ï¼Œä½œè€…å…¶å®ä¹Ÿ<strong>æ²¡æœ‰ç¡®åˆ‡çš„ç­”æ¡ˆ</strong>ï¼Œä¸€æ˜¯ Docker é¡¹ç›®çš„ä»£ç å¤ªå¤šåºå¤§ï¼Œä¸çŸ¥é“è¯¥ä»ä½•å…¥æ‰‹ï¼Œä½œè€…å°è¯•é€šè¿‡ Google æŸ¥æ‰¾ç›¸å…³çš„ç»“æœï¼Œä½†æ˜¯æ—¢æ‰¾åˆ°äº†æ— äººå›ç­”çš„ <a href="https://forums.docker.com/t/does-the-docker-engine-use-chroot/25429">é—®é¢˜</a>ï¼Œä¹Ÿå¾—åˆ°äº†ä¸ SPEC ä¸­çš„æè¿°æœ‰å†²çªçš„ <a href="https://www.quora.com/Do-Docker-containers-use-a-chroot-environment">ç­”æ¡ˆ</a> ï¼Œå¦‚æœå„ä½è¯»è€…æœ‰æ˜ç¡®çš„ç­”æ¡ˆå¯ä»¥åœ¨åšå®¢ä¸‹é¢ç•™è¨€ï¼Œéå¸¸æ„Ÿè°¢ã€‚</p></blockquote><h3 id="chroot"><a href="#chroot" class="headerlink" title="chroot"></a>chroot</h3><p>åœ¨è¿™é‡Œä¸å¾—ä¸ç®€å•ä»‹ç»ä¸€ä¸‹ <code>chroot</code>ï¼ˆchange rootï¼‰ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿé»˜è®¤çš„ç›®å½•å°±éƒ½æ˜¯ä»¥ <code>/</code> ä¹Ÿå°±æ˜¯æ ¹ç›®å½•å¼€å¤´çš„ï¼Œ<code>chroot</code> çš„ä½¿ç”¨èƒ½å¤Ÿæ”¹å˜å½“å‰çš„ç³»ç»Ÿæ ¹ç›®å½•ç»“æ„ï¼Œé€šè¿‡æ”¹å˜å½“å‰ç³»ç»Ÿçš„æ ¹ç›®å½•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé™åˆ¶ç”¨æˆ·çš„æƒåˆ©ï¼Œåœ¨æ–°çš„æ ¹ç›®å½•ä¸‹å¹¶ä¸èƒ½å¤Ÿè®¿é—®æ—§ç³»ç»Ÿæ ¹ç›®å½•çš„ç»“æ„ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±å»ºç«‹äº†ä¸€ä¸ªä¸åŸç³»ç»Ÿå®Œå…¨éš”ç¦»çš„ç›®å½•ç»“æ„ã€‚</p><blockquote><p>ä¸ chroot çš„ç›¸å…³å†…å®¹éƒ¨åˆ†æ¥è‡ª <a href="https://www.ibm.com/developerworks/cn/linux/l-cn-chroot/index.html">ç†è§£ chroot</a> ä¸€æ–‡ï¼Œå„ä½è¯»è€…å¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« è·å¾—æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚</p></blockquote><h2 id="èµ„æºé™åˆ¶ï¼šCGroups"><a href="#èµ„æºé™åˆ¶ï¼šCGroups" class="headerlink" title="èµ„æºé™åˆ¶ï¼šCGroups"></a>èµ„æºé™åˆ¶ï¼šCGroups</h2><p>æˆ‘ä»¬é€šè¿‡ Linux çš„å‘½åç©ºé—´ä¸ºæ–°åˆ›å»ºçš„è¿›ç¨‹éš”ç¦»äº†æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå¹¶ä¸å®¿ä¸»æœºå™¨ä¹‹é—´çš„è¿›ç¨‹ç›¸äº’éš”ç¦»ï¼Œä½†æ˜¯å‘½åç©ºé—´å¹¶ä¸èƒ½å¤Ÿä¸ºæˆ‘ä»¬æä¾›ç‰©ç†èµ„æºä¸Šçš„éš”ç¦»ï¼Œæ¯”å¦‚ CPU æˆ–è€…å†…å­˜ï¼Œå¦‚æœåœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œäº†å¤šä¸ªå¯¹å½¼æ­¤ä»¥åŠå®¿ä¸»æœºå™¨ä¸€æ— æ‰€çŸ¥çš„ã€å®¹å™¨ã€ï¼Œè¿™äº›å®¹å™¨å´å…±åŒå ç”¨äº†å®¿ä¸»æœºå™¨çš„ç‰©ç†èµ„æºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/os4E8KvWazui521.png" alt="docker-shared-resources"></p><p>å¦‚æœå…¶ä¸­çš„æŸä¸€ä¸ªå®¹å™¨æ­£åœ¨æ‰§è¡Œ CPU å¯†é›†å‹çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šå½±å“å…¶ä»–å®¹å™¨ä¸­ä»»åŠ¡çš„æ€§èƒ½ä¸æ‰§è¡Œæ•ˆç‡ï¼Œå¯¼è‡´å¤šä¸ªå®¹å™¨ç›¸äº’å½±å“å¹¶ä¸”æŠ¢å èµ„æºã€‚å¦‚ä½•å¯¹å¤šä¸ªå®¹å™¨çš„èµ„æºä½¿ç”¨è¿›è¡Œé™åˆ¶å°±æˆäº†è§£å†³è¿›ç¨‹è™šæ‹Ÿèµ„æºéš”ç¦»ä¹‹åçš„ä¸»è¦é—®é¢˜ï¼Œè€Œ Control Groupsï¼ˆç®€ç§° CGroupsï¼‰å°±æ˜¯èƒ½å¤Ÿéš”ç¦»å®¿ä¸»æœºå™¨ä¸Šçš„ç‰©ç†èµ„æºï¼Œä¾‹å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ I/O å’Œç½‘ç»œå¸¦å®½ã€‚</p><p>æ¯ä¸€ä¸ª CGroup éƒ½æ˜¯ä¸€ç»„è¢«ç›¸åŒçš„æ ‡å‡†å’Œå‚æ•°é™åˆ¶çš„è¿›ç¨‹ï¼Œä¸åŒçš„ CGroup ä¹‹é—´æ˜¯æœ‰å±‚çº§å…³ç³»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¹‹é—´å¯ä»¥ä»çˆ¶ç±»ç»§æ‰¿ä¸€äº›ç”¨äºé™åˆ¶èµ„æºä½¿ç”¨çš„æ ‡å‡†å’Œå‚æ•°ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/AfvxM3omeE7Tudp.png" alt="cgroups-inheritance"></p><p>Linux çš„ CGroup èƒ½å¤Ÿä¸ºä¸€ç»„è¿›ç¨‹åˆ†é…èµ„æºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°çš„ CPUã€å†…å­˜ã€ç½‘ç»œå¸¦å®½ç­‰èµ„æºï¼Œé€šè¿‡å¯¹èµ„æºçš„åˆ†é…ï¼ŒCGroup èƒ½å¤Ÿæä¾›ä»¥ä¸‹çš„å‡ ç§åŠŸèƒ½ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/kI4HhGTte6aAymd.png" alt="groups-features"></p><blockquote><p>åœ¨ CGroup ä¸­ï¼Œæ‰€æœ‰çš„ä»»åŠ¡å°±æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œ CGroup å°±æ˜¯ä¸€ç»„æŒ‰ç…§æŸç§æ ‡å‡†åˆ’åˆ†çš„è¿›ç¨‹ï¼Œåœ¨ CGroup è¿™ç§æœºåˆ¶ä¸­ï¼Œæ‰€æœ‰çš„èµ„æºæ§åˆ¶éƒ½æ˜¯ä»¥ CGroup ä½œä¸ºå•ä½å®ç°çš„ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½å¯ä»¥éšæ—¶åŠ å…¥ä¸€ä¸ª CGroup ä¹Ÿå¯ä»¥éšæ—¶é€€å‡ºä¸€ä¸ª CGroupã€‚</p><p>â€“ <a href="https://www.ibm.com/developerworks/cn/linux/1506_cgroup/index.html">CGroup ä»‹ç»ã€åº”ç”¨å®ä¾‹åŠåŸç†æè¿°</a></p></blockquote><p>Linux ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥å®ç° CGroupï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å½“å‰çš„ CGroup ä¸­æœ‰å“ªäº›å­ç³»ç»Ÿï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> lssubsys -m</span></span><br><span class="line">cpuset /sys/fs/cgroup/cpuset</span><br><span class="line">cpu /sys/fs/cgroup/cpu</span><br><span class="line">cpuacct /sys/fs/cgroup/cpuacct</span><br><span class="line">memory /sys/fs/cgroup/memory</span><br><span class="line">devices /sys/fs/cgroup/devices</span><br><span class="line">freezer /sys/fs/cgroup/freezer</span><br><span class="line">blkio /sys/fs/cgroup/blkio</span><br><span class="line">perf_event /sys/fs/cgroup/perf_event</span><br><span class="line">hugetlb /sys/fs/cgroup/hugetlb</span><br></pre></td></tr></table></figure><p>å¤§å¤šæ•° Linux çš„å‘è¡Œç‰ˆéƒ½æœ‰ç€éå¸¸ç›¸ä¼¼çš„å­ç³»ç»Ÿï¼Œè€Œä¹‹æ‰€ä»¥å°†ä¸Šé¢çš„ cpusetã€cpu ç­‰ä¸œè¥¿ç§°ä½œå­ç³»ç»Ÿï¼Œæ˜¯å› ä¸ºå®ƒä»¬èƒ½å¤Ÿä¸ºå¯¹åº”çš„æ§åˆ¶ç»„åˆ†é…èµ„æºå¹¶é™åˆ¶èµ„æºçš„ä½¿ç”¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ cgroup åªéœ€è¦åœ¨æƒ³è¦åˆ†é…æˆ–è€…é™åˆ¶èµ„æºçš„å­ç³»ç»Ÿä¸‹é¢åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œç„¶åè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å°±ä¼šè‡ªåŠ¨å‡ºç°å¾ˆå¤šçš„å†…å®¹ï¼Œå¦‚æœä½ åœ¨ Linux ä¸Šå®‰è£…äº† Dockerï¼Œä½ å°±ä¼šå‘ç°æ‰€æœ‰å­ç³»ç»Ÿçš„ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªåä¸º docker çš„æ–‡ä»¶å¤¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls cpu</span></span><br><span class="line">cgroup.clone_children  </span><br><span class="line">...</span><br><span class="line">cpu.stat  </span><br><span class="line">docker  </span><br><span class="line">notify_on_release </span><br><span class="line">release_agent </span><br><span class="line">tasks</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls cpu/docker/</span></span><br><span class="line">9c3057f1291b53fd54a3d12023d2644efe6a7db6ddf330436ae73ac92d401cf1 </span><br><span class="line">cgroup.clone_children  </span><br><span class="line">...</span><br><span class="line">cpu.stat  </span><br><span class="line">notify_on_release </span><br><span class="line">release_agent </span><br><span class="line">tasks</span><br></pre></td></tr></table></figure><p><code>9c3057xxx</code> å…¶å®å°±æ˜¯æˆ‘ä»¬è¿è¡Œçš„ä¸€ä¸ª Docker å®¹å™¨ï¼Œå¯åŠ¨è¿™ä¸ªå®¹å™¨æ—¶ï¼ŒDocker ä¼šä¸ºè¿™ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªä¸å®¹å™¨æ ‡è¯†ç¬¦ç›¸åŒçš„ CGroupï¼Œåœ¨å½“å‰çš„ä¸»æœºä¸Š CGroup å°±ä¼šæœ‰ä»¥ä¸‹çš„å±‚çº§å…³ç³»ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/wXYPHcUyBrVfTWN.png" alt="linux-cgroups"></p><p>æ¯ä¸€ä¸ª CGroup ä¸‹é¢éƒ½æœ‰ä¸€ä¸ª <code>tasks</code> æ–‡ä»¶ï¼Œå…¶ä¸­å­˜å‚¨ç€å±äºå½“å‰æ§åˆ¶ç»„çš„æ‰€æœ‰è¿›ç¨‹çš„ pidï¼Œä½œä¸ºè´Ÿè´£ cpu çš„å­ç³»ç»Ÿï¼Œ<code>cpu.cfs_quota_us</code> æ–‡ä»¶ä¸­çš„å†…å®¹èƒ½å¤Ÿå¯¹ CPU çš„ä½¿ç”¨ä½œå‡ºé™åˆ¶ï¼Œå¦‚æœå½“å‰æ–‡ä»¶çš„å†…å®¹ä¸º 50000ï¼Œé‚£ä¹ˆå½“å‰æ§åˆ¶ç»„ä¸­çš„å…¨éƒ¨è¿›ç¨‹çš„ CPU å ç”¨ç‡ä¸èƒ½è¶…è¿‡ 50%ã€‚</p><p>å¦‚æœç³»ç»Ÿç®¡ç†å‘˜æƒ³è¦æ§åˆ¶ Docker æŸä¸ªå®¹å™¨çš„èµ„æºä½¿ç”¨ç‡å°±å¯ä»¥åœ¨ <code>docker</code> è¿™ä¸ªçˆ¶æ§åˆ¶ç»„ä¸‹é¢æ‰¾åˆ°å¯¹åº”çš„å­æ§åˆ¶ç»„å¹¶ä¸”æ”¹å˜å®ƒä»¬å¯¹åº”æ–‡ä»¶çš„å†…å®¹ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç¨‹åºè¿è¡Œæ—¶å°±ä½¿ç”¨å‚æ•°ï¼Œè®© Docker è¿›ç¨‹å»æ”¹å˜ç›¸åº”æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -d --cpu-quota=50000 busybox</span></span><br><span class="line">53861305258ecdd7f5d2a3240af694aec9adb91cd4c7e210b757f71153cdd274</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> 53861305258ecdd7f5d2a3240af694aec9adb91cd4c7e210b757f71153cdd274/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">cgroup.clone_children  cgroup.event_control  cgroup.procs  cpu.cfs_period_us  cpu.cfs_quota_us  cpu.shares  cpu.stat  notify_on_release  tasks</span><br><span class="line"><span class="meta">$</span><span class="bash"> cat cpu.cfs_quota_us</span></span><br><span class="line">50000</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨ Docker å…³é—­æ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ—¶ï¼ŒDocker çš„å­æ§åˆ¶ç»„å¯¹åº”çš„æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢« Docker è¿›ç¨‹ç§»é™¤ï¼ŒDocker åœ¨ä½¿ç”¨ CGroup æ—¶å…¶å®ä¹Ÿåªæ˜¯åšäº†ä¸€äº›åˆ›å»ºæ–‡ä»¶å¤¹æ”¹å˜æ–‡ä»¶å†…å®¹çš„æ–‡ä»¶æ“ä½œï¼Œä¸è¿‡ CGroup çš„ä½¿ç”¨ä¹Ÿç¡®å®è§£å†³äº†æˆ‘ä»¬é™åˆ¶å­å®¹å™¨èµ„æºå ç”¨çš„é—®é¢˜ï¼Œç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿä¸ºå¤šä¸ªå®¹å™¨åˆç†çš„åˆ†é…èµ„æºå¹¶ä¸”ä¸ä¼šå‡ºç°å¤šä¸ªå®¹å™¨äº’ç›¸æŠ¢å èµ„æºçš„é—®é¢˜ã€‚</p><h2 id="å­˜å‚¨é©±åŠ¨ï¼šUnionFS"><a href="#å­˜å‚¨é©±åŠ¨ï¼šUnionFS" class="headerlink" title="å­˜å‚¨é©±åŠ¨ï¼šUnionFS"></a>å­˜å‚¨é©±åŠ¨ï¼šUnionFS</h2><p>Linux çš„å‘½åç©ºé—´å’Œæ§åˆ¶ç»„åˆ†åˆ«è§£å†³äº†ä¸åŒèµ„æºéš”ç¦»çš„é—®é¢˜ï¼Œå‰è€…è§£å†³äº†è¿›ç¨‹ã€ç½‘ç»œä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„éš”ç¦»ï¼Œåè€…å®ç°äº† CPUã€å†…å­˜ç­‰èµ„æºçš„éš”ç¦»ï¼Œä½†æ˜¯åœ¨ Docker ä¸­è¿˜æœ‰å¦ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜éœ€è¦è§£å†³ - ä¹Ÿå°±æ˜¯é•œåƒã€‚</p><p>é•œåƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå®ƒåˆæ˜¯å¦‚ä½•ç»„æˆå’Œç»„ç»‡çš„æ˜¯ä½œè€…ä½¿ç”¨ Docker ä»¥æ¥çš„ä¸€æ®µæ—¶é—´å†…ä¸€ç›´æ¯”è¾ƒè®©ä½œè€…æ„Ÿåˆ°å›°æƒ‘çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker run</code> éå¸¸è½»æ¾åœ°ä»è¿œç¨‹ä¸‹è½½ Docker çš„é•œåƒå¹¶åœ¨æœ¬åœ°è¿è¡Œã€‚</p><p>Docker é•œåƒå…¶å®æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†ä¸€ä¸ª Docker é•œåƒä¸­çš„æ–‡ä»¶å¯¼å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">export</span> $(docker create busybox) | tar -C rootfs -xvf -</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">bin  dev  etc  home proc root sys  tmp  usr  var</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ª busybox é•œåƒä¸­çš„ç›®å½•ç»“æ„ä¸ Linux æ“ä½œç³»ç»Ÿçš„æ ¹ç›®å½•ä¸­çš„å†…å®¹å¹¶æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œå¯ä»¥è¯´ <strong>Docker é•œåƒå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶</strong>ã€‚</p><h3 id="å­˜å‚¨é©±åŠ¨"><a href="#å­˜å‚¨é©±åŠ¨" class="headerlink" title="å­˜å‚¨é©±åŠ¨"></a>å­˜å‚¨é©±åŠ¨</h3><p>Docker ä½¿ç”¨äº†ä¸€ç³»åˆ—ä¸åŒçš„å­˜å‚¨é©±åŠ¨ç®¡ç†é•œåƒå†…çš„æ–‡ä»¶ç³»ç»Ÿå¹¶è¿è¡Œå®¹å™¨ï¼Œè¿™äº›å­˜å‚¨é©±åŠ¨ä¸ Docker å·ï¼ˆvolumeï¼‰æœ‰äº›ä¸åŒï¼Œå­˜å‚¨å¼•æ“ç®¡ç†ç€èƒ½å¤Ÿåœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å…±äº«çš„å­˜å‚¨ã€‚</p><p>æƒ³è¦ç†è§£ Docker ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ Docker æ˜¯å¦‚ä½•æ„å»ºå¹¶ä¸”å­˜å‚¨é•œåƒçš„ï¼Œä¹Ÿéœ€è¦æ˜ç™½ Docker çš„é•œåƒæ˜¯å¦‚ä½•è¢«æ¯ä¸€ä¸ªå®¹å™¨æ‰€ä½¿ç”¨çš„ï¼›Docker ä¸­çš„æ¯ä¸€ä¸ªé•œåƒéƒ½æ˜¯ç”±ä¸€ç³»åˆ—åªè¯»çš„å±‚ç»„æˆçš„ï¼ŒDockerfile ä¸­çš„æ¯ä¸€ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨å·²æœ‰çš„åªè¯»å±‚ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">15.04</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> make /app</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> python /app/app.py</span></span><br></pre></td></tr></table></figure><p>å®¹å™¨ä¸­çš„æ¯ä¸€å±‚éƒ½åªå¯¹å½“å‰å®¹å™¨è¿›è¡Œäº†éå¸¸å°çš„ä¿®æ”¹ï¼Œä¸Šè¿°çš„ Dockerfile æ–‡ä»¶ä¼šæ„å»ºä¸€ä¸ªæ‹¥æœ‰å››å±‚ layer çš„é•œåƒï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/OjlPgrkvCB6QdA4.png" alt="docker-container-laye"></p><p>å½“é•œåƒè¢« <code>docker run</code> å‘½ä»¤åˆ›å»ºæ—¶å°±ä¼šåœ¨é•œåƒçš„æœ€ä¸Šå±‚æ·»åŠ ä¸€ä¸ªå¯å†™çš„å±‚ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨å±‚ï¼Œæ‰€æœ‰å¯¹äºè¿è¡Œæ—¶å®¹å™¨çš„ä¿®æ”¹å…¶å®éƒ½æ˜¯å¯¹è¿™ä¸ªå®¹å™¨è¯»å†™å±‚çš„ä¿®æ”¹ã€‚</p><p>å®¹å™¨å’Œé•œåƒçš„åŒºåˆ«å°±åœ¨äºï¼Œæ‰€æœ‰çš„é•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œè€Œæ¯ä¸€ä¸ªå®¹å™¨å…¶å®ç­‰äºé•œåƒåŠ ä¸Šä¸€ä¸ªå¯è¯»å†™çš„å±‚ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªé•œåƒå¯ä»¥å¯¹åº”å¤šä¸ªå®¹å™¨ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/I3DQBAdHYpEbXWq.png" alt="docker-images-and-container"></p><h3 id="AUFS"><a href="#AUFS" class="headerlink" title="AUFS"></a>AUFS</h3><p>å…¶å®åœ¨æœ‰äº† Namespace å’Œ cgroups çš„æƒ…å†µä¸‹ï¼Œå¯¹äº Docker é¡¹ç›®çš„åˆå§‹åŒ–å¯ä»¥ç®€å•æŠ½è±¡ä¸ºï¼š</p><ol><li>å¯åŠ¨ Namespace é…ç½®</li><li>è®¾ç½® cgroups å‚æ•°ï¼Œå¯¹èµ„æºè¿›è¡Œé™åˆ¶</li><li>åˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•</li></ol><p>ä½†æ˜¯è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>æ˜¯å¦æ¯æ¬¡æ‰“åŒ…ã€å‡çº§é•œåƒéƒ½è¦é‡æ–°èµ°ä¸€éæ•´ä¸ªåˆå§‹åŒ–æµç¨‹</strong>ï¼Ÿè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p><p>Docker ä¸­æœ€å…¸å‹çš„å­˜å‚¨é©±åŠ¨å°±æ˜¯ AUFSï¼ˆAdvanced Multi-layered unification filesytemï¼‰ï¼Œå¯ä»¥å°† AUFS æƒ³è±¡ä¸ºä¸€ä¸ªå¯ä»¥ â€œæ ˆå¼å åŠ â€ çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒAUFS å…è®¸åœ¨ä¸€ä¸ªåŸºç¡€çš„æ–‡ä»¶ç³»ç»Ÿçš„ä¸Šï¼Œâ€œå¢é‡å¼â€ çš„å¢åŠ æ–‡ä»¶ã€‚AUFS æ”¯æŒå°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œè¿™ç§æŒ‚è½½å¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ã€‚é€šå¸¸ï¼ŒAUFS æœ€ä¸Šå±‚æ˜¯å¯è¯»å†™å±‚ï¼Œè€Œæœ€åº•å±‚æ˜¯åªè¯»å±‚ï¼Œæ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>UnionFS å…¶å®æ˜¯ä¸€ç§ä¸º Linux æ“ä½œç³»ç»Ÿè®¾è®¡çš„ç”¨äºæŠŠå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿã€è”åˆã€åˆ°åŒä¸€ä¸ªæŒ‚è½½ç‚¹çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡ã€‚è€Œ AUFS å³ Advanced UnionFS å…¶å®å°±æ˜¯ UnionFS çš„å‡çº§ç‰ˆï¼Œå®ƒèƒ½å¤Ÿæä¾›æ›´ä¼˜ç§€çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</p><p>AUFS ä½œä¸ºè”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿå°†ä¸åŒæ–‡ä»¶å¤¹ä¸­çš„å±‚è”åˆï¼ˆUnionï¼‰åˆ°äº†åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œè¿™äº›æ–‡ä»¶å¤¹åœ¨ AUFS ä¸­ç§°ä½œåˆ†æ”¯ï¼Œæ•´ä¸ªã€è”åˆã€çš„è¿‡ç¨‹è¢«ç§°ä¸º<em>è”åˆæŒ‚è½½ï¼ˆUnion Mountï¼‰</em>ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/GgsoNJSW7kFymVu.png" alt="docker-aufs"></p><p>æ¯ä¸€ä¸ªé•œåƒå±‚æˆ–è€…å®¹å™¨å±‚éƒ½æ˜¯ <code>/var/lib/docker/</code> ç›®å½•ä¸‹çš„ä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼›åœ¨ Docker ä¸­ï¼Œæ‰€æœ‰é•œåƒå±‚å’Œå®¹å™¨å±‚çš„å†…å®¹éƒ½å­˜å‚¨åœ¨ <code>/var/lib/docker/aufs/diff/</code> ç›®å½•ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls /var/lib/docker/aufs/diff/00adcccc1a55a36a610a6ebb3e07cc35577f2f5a3b671be3dbc0e74db9ca691c       93604f232a831b22aeb372d5b11af8c8779feb96590a6dc36a80140e38e764d8</span></span><br><span class="line">00adcccc1a55a36a610a6ebb3e07cc35577f2f5a3b671be3dbc0e74db9ca691c-init  93604f232a831b22aeb372d5b11af8c8779feb96590a6dc36a80140e38e764d8-init</span><br><span class="line">019a8283e2ff6fca8d0a07884c78b41662979f848190f0658813bb6a9a464a90       93b06191602b7934fafc984fbacae02911b579769d0debd89cf2a032e7f35cfa</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è€Œ <code>/var/lib/docker/aufs/layers/</code> ä¸­å­˜å‚¨ç€é•œåƒå±‚çš„å…ƒæ•°æ®ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä¿å­˜ç€é•œåƒå±‚çš„å…ƒæ•°æ®ï¼Œæœ€åçš„ <code>/var/lib/docker/aufs/mnt/</code> åŒ…å«é•œåƒæˆ–è€…å®¹å™¨å±‚çš„æŒ‚è½½ç‚¹ï¼Œæœ€ç»ˆä¼šè¢« Docker é€šè¿‡è”åˆçš„æ–¹å¼è¿›è¡Œç»„è£…ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/XxoDKUnTwsmidc5.png" alt="docker-filesystems"></p><p>ä¸Šé¢çš„è¿™å¼ å›¾ç‰‡éå¸¸å¥½çš„å±•ç¤ºäº†ç»„è£…çš„è¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ªé•œåƒå±‚éƒ½æ˜¯å»ºç«‹åœ¨å¦ä¸€ä¸ªé•œåƒå±‚ä¹‹ä¸Šçš„ï¼ŒåŒæ—¶æ‰€æœ‰çš„é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œåªæœ‰æ¯ä¸ªå®¹å™¨æœ€é¡¶å±‚çš„å®¹å™¨å±‚æ‰å¯ä»¥è¢«ç”¨æˆ·ç›´æ¥è¯»å†™ï¼Œæ‰€æœ‰çš„å®¹å™¨éƒ½å»ºç«‹åœ¨ä¸€äº›åº•å±‚æœåŠ¡ï¼ˆKernelï¼‰ä¸Šï¼ŒåŒ…æ‹¬å‘½åç©ºé—´ã€æ§åˆ¶ç»„ã€rootfs ç­‰ç­‰ï¼Œè¿™ç§å®¹å™¨çš„ç»„è£…æ–¹å¼æä¾›äº†éå¸¸å¤§çš„çµæ´»æ€§ï¼Œåªè¯»çš„é•œåƒå±‚é€šè¿‡å…±äº«ä¹Ÿèƒ½å¤Ÿå‡å°‘ç£ç›˜çš„å ç”¨ã€‚</p><h4 id="AUFS-çš„è¯»å†™æ“ä½œ"><a href="#AUFS-çš„è¯»å†™æ“ä½œ" class="headerlink" title="AUFS çš„è¯»å†™æ“ä½œ"></a>AUFS çš„è¯»å†™æ“ä½œ</h4><h5 id="è¯»æ“ä½œ"><a href="#è¯»æ“ä½œ" class="headerlink" title="è¯»æ“ä½œ"></a>è¯»æ“ä½œ</h5><p>å½“éœ€è¦<strong>å†™å…¥</strong>ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¸å­˜åœ¨æ—¶åˆ™åœ¨å¯è¯»å†™å±‚æ–°å»ºä¸€ä¸ªï¼Œå¦åˆ™ä¸€ç›´ä»å‘ä¸‹å¯»æ‰¾ã€‚</p><h5 id="å†™æ“ä½œ"><a href="#å†™æ“ä½œ" class="headerlink" title="å†™æ“ä½œ"></a>å†™æ“ä½œ</h5><p>å½“<strong>åˆ é™¤</strong>ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶ä»…å­˜åœ¨å¯è¯»å†™å±‚ï¼Œåˆ™ç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>ä½†æ˜¯åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåˆ é™¤çš„æ˜¯åªè¯»å±‚çš„æ–‡ä»¶å‘¢ï¼Ÿæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå…ˆåˆ é™¤å¯è¯»å†™å±‚ä¸­çš„å¤‡ä»½ï¼Œä¹‹åé€šè¿‡åˆ›å»ºä¸€ä¸ª whiteout æ–‡ä»¶æ¥æ ‡è®°æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§ â€œé®æŒ¡â€ï¼Œåªè¯»å±‚æ–‡ä»¶å´ä¸ä¼šè¢«çœŸæ­£çš„åˆ é™¤ï¼Œä½†æ˜¯è¡¨ç°ä¸Šç¡®æ˜¯å·²ç»è¢« â€œåˆ é™¤â€ äº†ã€‚</p><p>å½“<strong>æ–°å»º</strong>æ–‡ä»¶æ—¶ï¼Œç”±äº whiteout çš„ å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ£€æŸ¥ whiteout æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å…ˆåˆ é™¤å†åˆ›å»ºã€‚</p><p>AUFS åªæ˜¯ Docker å­˜å‚¨é©±åŠ¨çš„å…¶ä¸­ä¸€ç§ï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸‹å¹¶ä¸æ˜¯æœ€ä¼˜çš„é€‰æ‹©ï¼Œä½†éƒ½æ˜¯å±äº Union File Systemï¼Œä¸»è¦æ˜¯åŸºäº â€œå†™æ—¶å¤åˆ¶â€ ä»¥åŠ â€œç”¨æ—¶é…ç½®â€ ä¸¤ç§æ–¹å¼ï¼Œä½†å®ƒèƒ½å¤Ÿæœ‰æ•ˆå¸®åŠ©æˆ‘ä»¬ç†è§£ Docker çš„åˆ†å±‚ç»“æ„ä»¥åŠåŸç†ã€‚å…¶ä»–çš„ Docker å­˜å‚¨é©±åŠ¨è¿˜æœ‰ OverlayFSã€Devicemapperã€Btrfsã€ZFS ç­‰ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h3 id="å…¶ä»–å­˜å‚¨é©±åŠ¨"><a href="#å…¶ä»–å­˜å‚¨é©±åŠ¨" class="headerlink" title="å…¶ä»–å­˜å‚¨é©±åŠ¨"></a>å…¶ä»–å­˜å‚¨é©±åŠ¨</h3><p>AUFS åªæ˜¯ Docker ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨çš„ä¸€ç§ï¼Œé™¤äº† AUFS ä¹‹å¤–ï¼ŒDocker è¿˜æ”¯æŒäº†ä¸åŒçš„å­˜å‚¨é©±åŠ¨ï¼ŒåŒ…æ‹¬ <code>aufs</code>ã€<code>devicemapper</code>ã€<code>overlay2</code>ã€<code>zfs</code> å’Œ <code>vfs</code> ç­‰ç­‰ï¼Œåœ¨æœ€æ–°çš„ Docker ä¸­ï¼Œ<code>overlay2</code> å–ä»£äº† <code>aufs</code> æˆä¸ºäº†æ¨èçš„å­˜å‚¨é©±åŠ¨ï¼Œä½†æ˜¯åœ¨æ²¡æœ‰ <code>overlay2</code> é©±åŠ¨çš„æœºå™¨ä¸Šä»ç„¶ä¼šä½¿ç”¨ <code>aufs</code> ä½œä¸º Docker çš„é»˜è®¤é©±åŠ¨ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/FaMDlpWB1UKAzYk.png" alt="docker-storage-driver"></p><p>ä¸åŒçš„å­˜å‚¨é©±åŠ¨åœ¨å­˜å‚¨é•œåƒå’Œå®¹å™¨æ–‡ä»¶æ—¶ä¹Ÿæœ‰ç€å®Œå…¨ä¸åŒçš„å®ç°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥åœ¨ Docker çš„å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/engine/userguide/storagedriver/selectadriver/">Select a storage driver</a> ä¸­æ‰¾åˆ°ç›¸åº”çš„å†…å®¹ã€‚</p><p>æƒ³è¦æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ Docker ä¸Šä½¿ç”¨äº†å“ªç§å­˜å‚¨é©±åŠ¨åªéœ€è¦ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤å°±èƒ½å¾—åˆ°ç›¸å¯¹åº”çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker info | grep Storage</span></span><br><span class="line">Storage Driver: aufs</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Docker ç›®å‰å·²ç»æˆä¸ºäº†éå¸¸ä¸»æµçš„æŠ€æœ¯ï¼Œå·²ç»åœ¨å¾ˆå¤šæˆç†Ÿå…¬å¸çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä½†æ˜¯ Docker çš„æ ¸å¿ƒæŠ€æœ¯å…¶å®å·²ç»æœ‰å¾ˆå¤šå¹´çš„å†å²äº†ï¼ŒLinux å‘½åç©ºé—´ã€æ§åˆ¶ç»„Cgroupså’Œ UnionFS ä¸‰å¤§æŠ€æœ¯æ”¯æ’‘äº†ç›®å‰ Docker çš„å®ç°ï¼Œä¹Ÿæ˜¯ Docker èƒ½å¤Ÿå‡ºç°çš„æœ€é‡è¦åŸå› ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li><a href="https://www.safaribooksonline.com/library/view/using-docker/9781491915752/ch04.html">Chapter 4. Docker Fundamentals Â· Using Docker by Adrian Mount</a></li><li><a href="https://washraf.gitbooks.io/the-docker-ecosystem/content/Chapter 1/Section 3/techniques_behind_docker.html">TECHNIQUES BEHIND DOCKER</a></li><li><a href="https://docs.docker.com/engine/docker-overview/#the-underlying-technology">Docker overview</a></li><li><a href="https://lwn.net/Articles/312641/">Unifying filesystems with union mounts</a></li><li><a href="https://coolshell.cn/articles/17061.html">DOCKER åŸºç¡€æŠ€æœ¯ï¼šAUFS</a></li><li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/">RESOURCE MANAGEMENT GUIDE</a></li><li><a href="http://www.linuxjournal.com/article/7714">Kernel Korner - Unionfs: Bringing Filesystems Together</a></li><li><a href="https://lwn.net/Articles/325369/">Union file systems: Implementations, part I</a></li><li><a href="https://blog.docker.com/2016/05/docker-unikernels-open-source/">IMPROVING DOCKER WITH UNIKERNELS: INTRODUCING HYPERKIT, VPNKIT AND DATAKIT</a></li><li><a href="https://www.toptal.com/linux/separation-anxiety-isolating-your-system-with-linux-namespaces">Separation Anxiety: A Tutorial for Isolating Your System with Linux Namespaces</a></li><li><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-chroot/index.html">ç†è§£ chroot</a></li><li><a href="http://www.yolinux.com/TUTORIALS/LinuxTutorialInitProcess.html">Linux Init Process / PC Boot Procedure</a></li><li><a href="http://www.infoq.com/cn/articles/docker-network-and-pipework-open-source-explanation-practice#">Docker ç½‘ç»œè¯¦è§£åŠ pipework æºç è§£è¯»ä¸å®è·µ</a></li><li><a href="https://docs.docker.com/engine/userguide/networking/default_network/container-communication/#communication-between-containers">Understand container communication</a></li><li><a href="https://github.com/docker/labs/blob/master/networking/concepts/05-bridge-networks.md">Docker Bridge Network Driver Architecture</a></li><li><a href="http://www.thegeekstuff.com/2011/01/iptables-fundamentals/">Linux Firewall Tutorial: IPTables Tables, Chains, Rules Fundamentals</a></li><li><a href="http://www.iptables.info/en/structure-of-iptables.html">Traversing of tables and chains</a></li><li><a href="http://dockone.io/article/1255">Docker ç½‘ç»œéƒ¨åˆ†æ‰§è¡Œæµåˆ†æï¼ˆLibnetwork æºç è§£è¯»ï¼‰</a></li><li><a href="https://github.com/docker/libnetwork/blob/master/docs/design.md">Libnetwork Design</a></li><li><a href="http://www.infoq.com/cn/articles/analysis-of-docker-file-system-aufs-and-devicemapper">å‰–æ Docker æ–‡ä»¶ç³»ç»Ÿï¼šAufsä¸Devicemapper</a></li><li><a href="https://stackoverflow.com/questions/22889241/linux-understanding-the-mount-namespace-clone-clone-newns-flag">Linux - understanding the mount namespace &amp; clone CLONE_NEWNS flag</a></li><li><a href="http://www.infoq.com/cn/articles/docker-kernel-knowledge-namespace-resource-isolation">Docker èƒŒåçš„å†…æ ¸çŸ¥è¯† â€”â€” Namespace èµ„æºéš”ç¦»</a></li><li><a href="https://linuxcontainers.org/">Infrastructure for container projects</a></li><li><a href="https://github.com/opencontainers/runc/blob/master/libcontainer/SPEC.md">Spec Â· libcontainer</a></li><li><a href="https://coolshell.cn/articles/17010.html">DOCKER åŸºç¡€æŠ€æœ¯ï¼šLINUX NAMESPACEï¼ˆä¸Šï¼‰</a></li><li><a href="https://coolshell.cn/articles/17049.html">DOCKER åŸºç¡€æŠ€æœ¯ï¼šLINUX CGROUP</a></li><li><a href="https://yq.aliyun.com/articles/65034">ã€Šè‡ªå·±åŠ¨æ‰‹å†™Dockerã€‹ä¹¦æ‘˜ä¹‹ä¸‰ï¼š Linux UnionFS</a></li><li><a href="http://www.programering.com/a/MDMzAjMwATk.html">Introduction to Docker</a></li><li><a href="https://docs.docker.com/v1.9/engine/userguide/storagedriver/imagesandcontainers/">Understand images, containers, and storage drivers</a></li><li><a href="https://docs.docker.com/engine/userguide/storagedriver/aufs-driver/#configure-docker-with-the-aufs-storage-driver">Use the AUFS storage driver</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxäº”ç§IOæ¨¡å‹è¯¦è§£</title>
      <link href="/2018/02/28/Linux/Linux%E4%B9%8B%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>/2018/02/28/Linux/Linux%E4%B9%8B%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>I/Oä¸è®¡ç®—æ˜¯è®¡ç®—æœºç³»ç»Ÿçš„æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œè€ŒI/Oå¾€å¾€å æ®äº†ç›¸å½“å¤šçš„èµ„æºå’Œæ—¶é—´ï¼Œæ‰€ä»¥å¦‚ä½•æé«˜I/Oæ€§èƒ½ï¼Œæˆä¸ºäº†æ€§èƒ½ä¼˜åŒ–çš„æå…¶é‡è¦çš„ç‚¹ã€‚è¿™é‡Œæˆ‘ä»¬ç»“åˆä¸€äº›å…¶ä»–çš„Linuxç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µæ¥æ¯”è¾ƒåŸºæœ¬çš„äº”ç§I/Oæ¨¡å‹ã€‚</p><a id="more"></a><h2 id="æ¦‚å¿µå¼•å…¥"><a href="#æ¦‚å¿µå¼•å…¥" class="headerlink" title="æ¦‚å¿µå¼•å…¥"></a>æ¦‚å¿µå¼•å…¥</h2><h3 id="ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´"></a>ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´</h3><p>ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“ä½œç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºå†…æ ¸ç©ºé—´ï¼Œè€Œå°†è¾ƒä½çš„3Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºç”¨æˆ·ç©ºé—´ã€‚</p><h3 id="è¿›ç¨‹åˆ‡æ¢"><a href="#è¿›ç¨‹åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹åˆ‡æ¢"></a>è¿›ç¨‹åˆ‡æ¢</h3><p>ä¸ºäº†æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸å†…æ ¸ç´§å¯†ç›¸å…³çš„ã€‚</p><p>ä»ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡ä¸‹é¢è¿™äº›å˜åŒ–ï¼š</p><ol><li>ä¿å­˜å¤„ç†æœºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ã€‚</li><li>æ›´æ–°PCBä¿¡æ¯ã€‚</li><li>æŠŠè¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼Œå¦‚å°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ã€‚</li><li>é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¹¶æ›´æ–°å…¶PCBã€‚</li><li>æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„ã€‚</li><li>æ¢å¤å¤„ç†æœºä¸Šä¸‹æ–‡ã€‚</li></ol><p>è¯¦è§<a href="https://link.jianshu.com/?t=http://guojing.me/linux-kernel-architecture/posts/process-switch/">è¿›ç¨‹åˆ‡æ¢</a>ã€‚</p><h3 id="è¿›ç¨‹é˜»å¡"><a href="#è¿›ç¨‹é˜»å¡" class="headerlink" title="è¿›ç¨‹é˜»å¡"></a>è¿›ç¨‹é˜»å¡</h3><p>æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œç”±äºæœŸå¾…çš„æŸäº›äº‹ä»¶æœªå‘ç”Ÿï¼Œå¦‚è¯·æ±‚ç³»ç»Ÿèµ„æºå¤±è´¥ã€ç­‰å¾…æŸç§æ“ä½œçš„å®Œæˆã€æ–°æ•°æ®å°šæœªåˆ°è¾¾æˆ–æ— æ–°å·¥ä½œåšç­‰ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé˜»å¡åŸè¯­(Block)ï¼Œä½¿è‡ªå·±ç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºé˜»å¡çŠ¶æ€ã€‚å¯è§ï¼Œè¿›ç¨‹çš„é˜»å¡æ˜¯è¿›ç¨‹è‡ªèº«çš„ä¸€ç§ä¸»åŠ¨è¡Œä¸ºï¼Œä¹Ÿå› æ­¤åªæœ‰å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹ï¼ˆè·å¾—CPUï¼‰ï¼Œæ‰å¯èƒ½å°†å…¶è½¬ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæ˜¯ä¸å ç”¨CPUèµ„æºçš„ã€‚</p><h3 id="æ–‡ä»¶æè¿°ç¬¦FD"><a href="#æ–‡ä»¶æè¿°ç¬¦FD" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦FD"></a>æ–‡ä»¶æè¿°ç¬¦FD</h3><p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªç”¨äºè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µã€‚</p><p>æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚</p><h3 id="ç¼“å­˜IO"><a href="#ç¼“å­˜IO" class="headerlink" title="ç¼“å­˜IO"></a>ç¼“å­˜IO</h3><p>ç¼“å­˜ IO åˆè¢«ç§°ä½œæ ‡å‡† IOï¼Œå¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤ IO æ“ä½œéƒ½æ˜¯ç¼“å­˜ IOã€‚åœ¨ Linux çš„ç¼“å­˜ IO æœºåˆ¶ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† IO çš„æ•°æ®ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆ page cache ï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šä»æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚</p><p><strong>ç¼“å­˜ IO çš„ç¼ºç‚¹ï¼š</strong></p><p>æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­éœ€è¦åœ¨åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´å’Œå†…æ ¸è¿›è¡Œå¤šæ¬¡æ•°æ®æ‹·è´æ“ä½œï¼Œè¿™äº›æ•°æ®æ‹·è´æ“ä½œæ‰€å¸¦æ¥çš„ CPU ä»¥åŠå†…å­˜å¼€é”€æ˜¯éå¸¸å¤§çš„ã€‚</p><h2 id="äº”ç§I-Oæ¨¡å‹"><a href="#äº”ç§I-Oæ¨¡å‹" class="headerlink" title="äº”ç§I/Oæ¨¡å‹"></a>äº”ç§I/Oæ¨¡å‹</h2><h3 id="åŒæ­¥é˜»å¡-Blocking-I-O"><a href="#åŒæ­¥é˜»å¡-Blocking-I-O" class="headerlink" title="åŒæ­¥é˜»å¡ Blocking I/O"></a>åŒæ­¥é˜»å¡ Blocking I/O</h3><blockquote><p>æˆ‘å’Œå¥³å‹ç‚¹å®Œé¤åï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½åšå¥½ï¼Œåªå¥½ååœ¨é¤å…é‡Œé¢ç­‰ï¼Œç›´åˆ°åšå¥½ï¼Œç„¶ååƒå®Œæ‰ç¦»å¼€ã€‚å¥³å‹æœ¬æƒ³è¿˜å’Œæˆ‘ä¸€èµ·é€›è¡—çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“é¥­èƒ½ä»€ä¹ˆæ—¶å€™åšå¥½ï¼Œåªå¥½å’Œæˆ‘ä¸€èµ·åœ¨é¤å…ç­‰ï¼Œè€Œä¸èƒ½å»é€›è¡—ï¼Œç›´åˆ°åƒå®Œé¥­æ‰èƒ½å»é€›è¡—ï¼Œä¸­é—´ç­‰å¾…åšé¥­çš„æ—¶é—´æµªè´¹æ‰äº†ã€‚<code>è¿™å°±æ˜¯å…¸å‹çš„é˜»å¡</code>ã€‚</p></blockquote><p>åŒæ­¥é˜»å¡ IO æ¨¡å‹æ˜¯æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ¨¡å‹ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„æ¨¡å‹ã€‚åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingã€‚å®ƒç¬¦åˆäººä»¬æœ€å¸¸è§çš„æ€è€ƒé€»è¾‘ã€‚é˜»å¡å°±æ˜¯è¿›ç¨‹ â€œè¢«â€ ä¼‘æ¯, CPUå¤„ç†å…¶å®ƒè¿›ç¨‹å»äº†ã€‚</p><p>åœ¨è¿™ä¸ªIOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆrecvformï¼‰ï¼Œè¿™ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºé˜»å¡ï¼Œä»€ä¹ˆä¹Ÿä¸å¹²ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½ï¼Œå¹¶ä¸”å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·è¿›ç¨‹ï¼Œæœ€åè¿›ç¨‹å†å¤„ç†æ•°æ®ï¼Œåœ¨ç­‰å¾…æ•°æ®åˆ°å¤„ç†æ•°æ®çš„ä¸¤ä¸ªé˜¶æ®µï¼Œæ•´ä¸ªè¿›ç¨‹éƒ½è¢«é˜»å¡ã€‚<strong>ä¸èƒ½å¤„ç†åˆ«çš„ç½‘ç»œIO</strong>ã€‚è°ƒç”¨åº”ç”¨ç¨‹åºå¤„äºä¸€ç§ä¸å†æ¶ˆè´¹ CPU è€Œåªæ˜¯ç®€å•ç­‰å¾…å“åº”çš„çŠ¶æ€ï¼Œå› æ­¤ä»å¤„ç†çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚åœ¨è°ƒç”¨recv()/recvfrom()å‡½æ•°æ—¶ï¼Œå‘ç”Ÿåœ¨å†…æ ¸ä¸­ç­‰å¾…æ•°æ®å’Œå¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/V7co6PrnFAxOWei.png" alt="java10-1557020023"></p><p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†<code>recv()/recvfrom()</code>è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ï¼ˆå¯¹äºç½‘ç»œIOæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ã€‚æ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ã€‚è¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­æ˜¯éœ€è¦ä¸€ä¸ªè¿‡ç¨‹çš„ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ï¼ˆå½“ç„¶ï¼Œæ˜¯è¿›ç¨‹è‡ªå·±é€‰æ‹©çš„é˜»å¡ï¼‰ã€‚ç¬¬äºŒä¸ªé˜¶æ®µï¼šå½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p><p>æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><p>èƒ½å¤ŸåŠæ—¶è¿”å›æ•°æ®ï¼Œæ— å»¶è¿Ÿï¼›</p></li><li><p>æ¨¡å‹ç®€å•æ˜“äºå¼€å‘ï¼›</p></li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ç­‰å¾…æ—¶é—´é•¿ï¼Œæ€§èƒ½è¾ƒå·®ï¼›</li></ul><h3 id="åŒæ­¥éé˜»å¡-Nonblocking-I-O"><a href="#åŒæ­¥éé˜»å¡-Nonblocking-I-O" class="headerlink" title="åŒæ­¥éé˜»å¡ Nonblocking I/O"></a>åŒæ­¥éé˜»å¡ Nonblocking I/O</h3><blockquote><p>æˆ‘å¥³å‹ä¸ç”˜å¿ƒç™½ç™½åœ¨è¿™ç­‰ï¼Œåˆæƒ³å»é€›å•†åœºï¼Œåˆæ‹…å¿ƒé¥­å¥½äº†ã€‚æ‰€ä»¥æˆ‘ä»¬é€›ä¸€ä¼šï¼Œå›æ¥è¯¢é—®æœåŠ¡å‘˜é¥­å¥½äº†æ²¡æœ‰ï¼Œæ¥æ¥å›å›å¥½å¤šæ¬¡ï¼Œé¥­éƒ½è¿˜æ²¡åƒéƒ½å¿«ç´¯æ­»äº†å•¦ã€‚<code>è¿™å°±æ˜¯éé˜»å¡</code>ã€‚éœ€è¦ä¸æ–­çš„è¯¢é—®ï¼Œæ˜¯å¦å‡†å¤‡å¥½äº†ã€‚</p></blockquote><p>åŒæ­¥éé˜»å¡å°±æ˜¯ â€œæ¯éš”ä¸€ä¼šå„¿ç„ä¸€çœ¼è¿›åº¦æ¡â€ çš„è½®è¯¢ï¼ˆpollingï¼‰æ–¹å¼ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œè®¾å¤‡æ˜¯ä»¥éé˜»å¡çš„å½¢å¼æ‰“å¼€çš„ã€‚è¿™æ„å‘³ç€ IO æ“ä½œä¸ä¼šç«‹å³å®Œæˆï¼Œ<code>read</code> æ“ä½œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ä»£ç ï¼Œè¯´æ˜è¿™ä¸ªå‘½ä»¤ä¸èƒ½ç«‹å³æ»¡è¶³ï¼ˆ<code>EAGAIN</code> æˆ– <code>EWOULDBLOCK</code>ï¼‰ã€‚</p><p>åœ¨ç½‘ç»œIOæ—¶å€™ï¼Œéé˜»å¡IOä¹Ÿä¼šè¿›è¡Œrecvformç³»ç»Ÿè°ƒç”¨ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œä¸é˜»å¡IOä¸ä¸€æ ·ï¼Œâ€éé˜»å¡å°†å¤§çš„æ•´ç‰‡æ—¶é—´çš„é˜»å¡åˆ†æˆNå¤šçš„å°çš„é˜»å¡, æ‰€ä»¥è¿›ç¨‹ä¸æ–­åœ°æœ‰æœºä¼š â€˜è¢«â€™ CPUå…‰é¡¾â€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´éé˜»å¡çš„<code>recvform</code>ç³»ç»Ÿè°ƒç”¨è°ƒç”¨ä¹‹åï¼Œè¿›ç¨‹å¹¶æ²¡æœ‰è¢«é˜»å¡ï¼Œå†…æ ¸é©¬ä¸Šè¿”å›ç»™è¿›ç¨‹ï¼Œå¦‚æœæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œæ­¤æ—¶ä¼šè¿”å›ä¸€ä¸ª<code>error</code>ã€‚è¿›ç¨‹åœ¨è¿”å›ä¹‹åï¼Œå¯ä»¥å¹²ç‚¹åˆ«çš„äº‹æƒ…ï¼Œç„¶åå†å‘èµ·recvformç³»ç»Ÿè°ƒç”¨ã€‚é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œå¾ªç¯å¾€å¤çš„è¿›è¡Œ<code>recvform</code>ç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¹‹ä¸ºè½®è¯¢ã€‚è½®è¯¢æ£€æŸ¥å†…æ ¸æ•°æ®ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½ï¼Œå†æ‹·è´æ•°æ®åˆ°è¿›ç¨‹ï¼Œè¿›è¡Œæ•°æ®å¤„ç†ã€‚<strong>éœ€è¦æ³¨æ„ï¼Œæ‹·è´æ•°æ®æ•´ä¸ªè¿‡ç¨‹ï¼Œè¿›ç¨‹ä»ç„¶æ˜¯å±äºé˜»å¡çš„çŠ¶æ€</strong>ã€‚</p><p>åœ¨linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/RbsD6CcZVMBvFaq.png" alt="20152818_DXcj"></p><p>å½“ç”¨æˆ·è¿›ç¨‹å‘å‡º<code>read</code>æ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®²ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€<code>read</code>æ“ä½œã€‚ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚</p><p>æ‰€ä»¥ï¼Œnonblocking IOçš„ç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚</p><p><strong>åŒæ­¥éé˜»å¡æ–¹å¼ç›¸æ¯”åŒæ­¥é˜»å¡æ–¹å¼ï¼š</strong></p><p><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½å¤Ÿåœ¨ç­‰å¾…ä»»åŠ¡å®Œæˆçš„æ—¶é—´é‡Œå¹²å…¶ä»–æ´»äº†ï¼ˆåŒ…æ‹¬æäº¤å…¶ä»–ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ â€œåå°â€ å¯ä»¥æœ‰å¤šä¸ªä»»åŠ¡åœ¨åŒæ—¶æ‰§è¡Œï¼‰ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šä»»åŠ¡å®Œæˆçš„å“åº”å»¶è¿Ÿå¢å¤§äº†ï¼Œå› ä¸ºæ¯è¿‡ä¸€æ®µæ—¶é—´æ‰å»è½®è¯¢ä¸€æ¬¡readæ“ä½œï¼Œè€Œä»»åŠ¡å¯èƒ½åœ¨ä¸¤æ¬¡è½®è¯¢ä¹‹é—´çš„ä»»æ„æ—¶é—´å®Œæˆã€‚è¿™ä¼šå¯¼è‡´æ•´ä½“æ•°æ®ååé‡çš„é™ä½ã€‚</p><h3 id="å¤šè·¯å¤ç”¨-Multiplexing-I-O"><a href="#å¤šè·¯å¤ç”¨-Multiplexing-I-O" class="headerlink" title="å¤šè·¯å¤ç”¨ Multiplexing I/O"></a>å¤šè·¯å¤ç”¨ Multiplexing I/O</h3><blockquote><p>é¤å…å®‰è£…äº†ç”µå­å±å¹•ç”¨æ¥æ˜¾ç¤ºç‚¹é¤çš„çŠ¶æ€ï¼Œè¿™æ ·æˆ‘å’Œå¥³å‹é€›è¡—ä¸€ä¼šï¼Œå›æ¥å°±ä¸ç”¨å»è¯¢é—®æœåŠ¡å‘˜äº†ï¼Œç›´æ¥çœ‹ç”µå­å±å¹•å°±å¯ä»¥äº†ã€‚è¿™æ ·æ¯ä¸ªäººçš„é¤æ˜¯å¦å¥½äº†ï¼Œéƒ½ç›´æ¥çœ‹ç”µå­å±å¹•å°±å¯ä»¥äº†ï¼Œè¿™å°±æ˜¯å…¸å‹çš„IOå¤šè·¯å¤ç”¨ã€‚</p></blockquote><p>ç”±äºåŒæ­¥éé˜»å¡æ–¹å¼éœ€è¦ä¸æ–­ä¸»åŠ¨è½®è¯¢ï¼Œè½®è¯¢å æ®äº†å¾ˆå¤§ä¸€éƒ¨åˆ†è¿‡ç¨‹ï¼Œè½®è¯¢ä¼šæ¶ˆè€—å¤§é‡çš„CPUæ—¶é—´ï¼Œè€Œ â€œåå°â€ å¯èƒ½æœ‰å¤šä¸ªä»»åŠ¡åœ¨åŒæ—¶è¿›è¡Œï¼Œäººä»¬å°±æƒ³åˆ°äº†å¾ªç¯æŸ¥è¯¢å¤šä¸ªä»»åŠ¡çš„å®ŒæˆçŠ¶æ€ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå°±å»å¤„ç†å®ƒã€‚<strong>å¦‚æœè½®è¯¢ä¸æ˜¯è¿›ç¨‹çš„ç”¨æˆ·æ€ï¼Œè€Œæ˜¯æœ‰äººå¸®å¿™å°±å¥½äº†ã€‚</strong>é‚£ä¹ˆè¿™å°±æ˜¯æ‰€è°“çš„ â€œIO å¤šè·¯å¤ç”¨â€ã€‚UNIX/Linux ä¸‹çš„ <code>select</code>ã€<code>poll</code>ã€<code>epoll</code> å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼ˆ<code>epoll</code> æ¯” <code>poll</code>ã€<code>select</code> æ•ˆç‡é«˜ï¼Œåšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ï¼‰ã€‚</p><p>I/Oå¤šè·¯å¤ç”¨æœ‰ä¸¤ä¸ªç‰¹åˆ«çš„ç³»ç»Ÿè°ƒç”¨<code>select</code>ã€<code>poll</code>ã€<code>epoll</code>å‡½æ•°ã€‚<code>select</code>è°ƒç”¨æ˜¯å†…æ ¸çº§åˆ«çš„ï¼Œ<code>select</code>è½®è¯¢ç›¸å¯¹éé˜»å¡çš„è½®è¯¢çš„åŒºåˆ«åœ¨äºâ€”â€”å‰è€…å¯ä»¥ç­‰å¾…å¤šä¸ªsocketï¼Œèƒ½å®ç°åŒæ—¶å¯¹å¤šä¸ªIOç«¯å£è¿›è¡Œç›‘å¬ï¼Œå½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªsocketçš„æ•°æ®å‡†å¥½äº†ï¼Œå°±èƒ½è¿”å›è¿›è¡Œå¯è¯»ï¼Œç„¶åè¿›ç¨‹å†è¿›è¡Œ<code>recvform</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå°†æ•°æ®ç”±å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹æ˜¯é˜»å¡çš„ã€‚<code>select</code>æˆ–<code>poll</code>è°ƒç”¨ä¹‹åï¼Œä¼šé˜»å¡è¿›ç¨‹ï¼Œä¸blocking IOé˜»å¡ä¸åŒåœ¨äºï¼Œæ­¤æ—¶çš„<code>select</code>ä¸æ˜¯ç­‰åˆ°socketæ•°æ®å…¨éƒ¨åˆ°è¾¾å†å¤„ç†, è€Œæ˜¯æœ‰äº†ä¸€éƒ¨åˆ†æ•°æ®å°±ä¼šè°ƒç”¨ç”¨æˆ·è¿›ç¨‹æ¥å¤„ç†ã€‚å¦‚ä½•çŸ¥é“æœ‰ä¸€éƒ¨åˆ†æ•°æ®åˆ°è¾¾äº†å‘¢ï¼Ÿç›‘è§†çš„äº‹æƒ…äº¤ç»™äº†å†…æ ¸ï¼Œå†…æ ¸è´Ÿè´£æ•°æ®åˆ°è¾¾çš„å¤„ç†ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºâ€éé˜»å¡â€å§ã€‚</p><p>I/Oå¤ç”¨æ¨¡å‹ä¼šç”¨åˆ°<code>select</code>ã€<code>poll</code>ã€<code>epoll</code>å‡½æ•°ï¼Œè¿™å‡ ä¸ªå‡½æ•°ä¹Ÿä¼šä½¿è¿›ç¨‹é˜»å¡ï¼Œä½†æ˜¯å’Œé˜»å¡I/Oæ‰€ä¸åŒçš„çš„ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥åŒæ—¶é˜»å¡å¤šä¸ªI/Oæ“ä½œã€‚è€Œä¸”å¯ä»¥åŒæ—¶å¯¹å¤šä¸ªè¯»æ“ä½œã€å¤šä¸ªå†™æ“ä½œçš„I/Oå‡½æ•°è¿›è¡Œæ£€æµ‹ï¼Œç›´åˆ°æœ‰æ•°æ®å¯è¯»æˆ–å¯å†™æ—¶ï¼ˆæ³¨æ„ä¸æ˜¯å…¨éƒ¨æ•°æ®å¯è¯»æˆ–å¯å†™ï¼‰ï¼Œæ‰çœŸæ­£è°ƒç”¨I/Oæ“ä½œå‡½æ•°ã€‚</p><p>å¯¹äºå¤šè·¯å¤ç”¨ï¼Œä¹Ÿå°±æ˜¯è½®è¯¢å¤šä¸ªsocketã€‚å¤šè·¯å¤ç”¨æ—¢ç„¶å¯ä»¥å¤„ç†å¤šä¸ªIOï¼Œä¹Ÿå°±å¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œå¤šä¸ªIOä¹‹é—´çš„é¡ºåºå˜å¾—ä¸ç¡®å®šäº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é’ˆå¯¹ä¸åŒçš„ç¼–å·ã€‚å…·ä½“æµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/T1hwz5douryFOXb.png" alt="20164149_LD8E"></p><p>IO multiplexingå°±æ˜¯æˆ‘ä»¬è¯´çš„<code>select</code>ï¼Œ<code>poll</code>ï¼Œ<code>epoll</code>ï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸ºevent driven IOã€‚<code>select/epoll</code>çš„å¥½å¤„å°±åœ¨äºå•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOã€‚å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯<code>select</code>ï¼Œ<code>poll</code>ï¼Œ<code>epoll</code>è¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚</p><p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p><blockquote><p>å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…IOæ–‡ä»¶æè¿°ç¬¦ï¼Œå†…æ ¸ç›‘è§†è¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰ï¼Œå…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselectï¼Œ pollï¼Œepollå‡½æ•°å°±å¯ä»¥è¿”å›ã€‚å¯¹äºç›‘è§†çš„æ–¹å¼ï¼Œåˆå¯ä»¥åˆ†ä¸º selectï¼Œ pollï¼Œ epollä¸‰ç§æ–¹å¼ã€‚</p></blockquote><p>ä¸Šé¢çš„å›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (<code>select</code> å’Œ <code>recvfrom</code>)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (<code>recvfrom</code>)ã€‚ä½†æ˜¯ï¼Œç”¨<code>select</code>çš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨<code>select/epoll</code>çš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚ï¼ˆ<code>select/epoll</code>çš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚ï¼‰</p><p>åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«<code>select</code>è¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚æ‰€ä»¥<strong>IOå¤šè·¯å¤ç”¨æ˜¯é˜»å¡åœ¨<code>selectï¼Œepoll</code>è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨ä¹‹ä¸Šï¼Œè€Œæ²¡æœ‰é˜»å¡åœ¨çœŸæ­£çš„I/Oç³»ç»Ÿè°ƒç”¨å¦‚recvfromä¹‹ä¸Šã€‚</strong></p><p>åœ¨I/Oç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯æ¥å…¥è¯·æ±‚æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æˆ–è€…I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯è¿›è¡Œå¤„ç†ã€‚I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯é€šè¿‡æŠŠå¤šä¸ªI/Oçš„é˜»å¡å¤ç”¨åˆ°åŒä¸€ä¸ªselectçš„é˜»å¡ä¸Šï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿåœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚ä¸ä¼ ç»Ÿçš„å¤šçº¿ç¨‹/å¤šè¿›ç¨‹æ¨¡å‹æ¯”<strong>ï¼ŒI/Oå¤šè·¯å¤ç”¨çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ç³»ç»Ÿå¼€é”€å°ï¼Œç³»ç»Ÿä¸éœ€è¦åˆ›å»ºæ–°çš„é¢å¤–è¿›ç¨‹æˆ–è€…çº¿ç¨‹</strong>ï¼Œä¹Ÿä¸éœ€è¦ç»´æŠ¤è¿™äº›è¿›ç¨‹å’Œçº¿ç¨‹çš„è¿è¡Œï¼Œé™åº•äº†ç³»ç»Ÿçš„ç»´æŠ¤å·¥ä½œé‡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼ŒI/Oå¤šè·¯å¤ç”¨çš„ä¸»è¦åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li><p>æœåŠ¡å™¨éœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªå¤„äºç›‘å¬çŠ¶æ€æˆ–è€…å¤šä¸ªè¿æ¥çŠ¶æ€çš„å¥—æ¥å­—ã€‚</p></li><li><p>æœåŠ¡å™¨éœ€è¦åŒæ—¶å¤„ç†å¤šç§ç½‘ç»œåè®®çš„å¥—æ¥å­—ã€‚</p></li></ul><p>äº†è§£äº†å‰é¢ä¸‰ç§IOæ¨¡å¼ï¼Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œ<strong>ä»–ä»¬åœ¨ç­‰å¾…æ•°æ®åˆ°æ¥çš„æ—¶å€™ï¼Œå¤„ç†çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œç›´æ¥ç­‰å¾…ï¼Œè½®è¯¢ï¼Œ<code>select</code>æˆ–<code>poll</code>è½®è¯¢</strong>ï¼Œä¸¤ä¸ªé˜¶æ®µè¿‡ç¨‹ï¼š</p><ol><li><p>ç¬¬ä¸€ä¸ªé˜¶æ®µæœ‰çš„é˜»å¡ï¼Œæœ‰çš„ä¸é˜»å¡ï¼Œæœ‰çš„å¯ä»¥é˜»å¡åˆå¯ä»¥ä¸é˜»å¡ã€‚</p></li><li><p>ç¬¬äºŒä¸ªé˜¶æ®µéƒ½æ˜¯é˜»å¡çš„ã€‚</p></li></ol><p><strong><u>ä»æ•´ä¸ªIOè¿‡ç¨‹æ¥çœ‹ï¼Œä»–ä»¬éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå› æ­¤å¯ä»¥å½’ä¸ºåŒæ­¥æ¨¡å‹(synchronous)ã€‚éƒ½æ˜¯è¿›ç¨‹ä¸»åŠ¨ç­‰å¾…ä¸”å‘å†…æ ¸æ£€æŸ¥çŠ¶æ€ã€‚</u></strong></p><p>é«˜å¹¶å‘çš„ç¨‹åºä¸€èˆ¬ä½¿ç”¨åŒæ­¥éé˜»å¡æ–¹å¼è€Œéå¤šçº¿ç¨‹ + åŒæ­¥é˜»å¡æ–¹å¼ã€‚è¦ç†è§£è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆè¦æ‰¯åˆ°å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«ã€‚æ¯”å¦‚å»æŸéƒ¨é—¨åŠäº‹éœ€è¦ä¾æ¬¡å»å‡ ä¸ªçª—å£ï¼ŒåŠäº‹å¤§å…é‡Œçš„äººæ•°å°±æ˜¯å¹¶å‘æ•°ï¼Œè€Œçª—å£ä¸ªæ•°å°±æ˜¯å¹¶è¡Œåº¦ã€‚ä¹Ÿå°±æ˜¯è¯´å¹¶å‘æ•°æ˜¯æŒ‡åŒæ—¶è¿›è¡Œçš„ä»»åŠ¡æ•°ï¼ˆå¦‚åŒæ—¶æœåŠ¡çš„ HTTP è¯·æ±‚ï¼Œè€Œå¹¶è¡Œæ•°æ˜¯å¯ä»¥åŒæ—¶å·¥ä½œçš„ç‰©ç†èµ„æºæ•°é‡ï¼ˆå¦‚ CPU æ ¸æ•°ï¼‰ã€‚é€šè¿‡åˆç†è°ƒåº¦ä»»åŠ¡çš„ä¸åŒé˜¶æ®µï¼Œå¹¶å‘æ•°å¯ä»¥è¿œè¿œå¤§äºå¹¶è¡Œåº¦ï¼Œè¿™å°±æ˜¯åŒºåŒºå‡ ä¸ª CPU å¯ä»¥æ”¯æŒä¸Šä¸‡ä¸ªç”¨æˆ·å¹¶å‘è¯·æ±‚çš„å¥¥ç§˜ã€‚åœ¨è¿™ç§é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¸ºæ¯ä¸ªä»»åŠ¡ï¼ˆç”¨æˆ·è¯·æ±‚ï¼‰åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹çš„å¼€é”€éå¸¸å¤§ã€‚è€ŒåŒæ­¥éé˜»å¡æ–¹å¼å¯ä»¥æŠŠå¤šä¸ª IO è¯·æ±‚ä¸¢åˆ°åå°å»ï¼Œè¿™å°±å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹é‡ŒæœåŠ¡å¤§é‡çš„å¹¶å‘ IO è¯·æ±‚ã€‚</p><h4 id="åˆ°åº•æ˜¯åŒæ­¥é˜»å¡è¿˜æ˜¯å¼‚æ­¥é˜»å¡"><a href="#åˆ°åº•æ˜¯åŒæ­¥é˜»å¡è¿˜æ˜¯å¼‚æ­¥é˜»å¡" class="headerlink" title="åˆ°åº•æ˜¯åŒæ­¥é˜»å¡è¿˜æ˜¯å¼‚æ­¥é˜»å¡"></a>åˆ°åº•æ˜¯åŒæ­¥é˜»å¡è¿˜æ˜¯å¼‚æ­¥é˜»å¡</h4><p>åŒæ­¥æ˜¯éœ€è¦ä¸»åŠ¨ç­‰å¾…æ¶ˆæ¯é€šçŸ¥ï¼Œè€Œå¼‚æ­¥åˆ™æ˜¯è¢«åŠ¨æ¥æ”¶æ¶ˆæ¯é€šçŸ¥ï¼Œé€šè¿‡å›è°ƒã€é€šçŸ¥ã€çŠ¶æ€ç­‰æ–¹å¼æ¥è¢«åŠ¨è·å–æ¶ˆæ¯ã€‚IOå¤šè·¯å¤ç”¨åœ¨é˜»å¡åˆ°selecté˜¶æ®µæ—¶ï¼Œç”¨æˆ·è¿›ç¨‹æ˜¯ä¸»åŠ¨ç­‰å¾…å¹¶è°ƒç”¨selectå‡½æ•°è·å–æ•°æ®å°±ç»ªçŠ¶æ€æ¶ˆæ¯ï¼Œå¹¶ä¸”å…¶è¿›ç¨‹çŠ¶æ€ä¸ºé˜»å¡ã€‚æ‰€ä»¥ï¼ŒæŠŠIOå¤šè·¯å¤ç”¨å½’ä¸ºåŒæ­¥é˜»å¡æ¨¡å¼ã€‚</p><h3 id="ä¿¡å·é©±åŠ¨IO-Signal-driven-I-O"><a href="#ä¿¡å·é©±åŠ¨IO-Signal-driven-I-O" class="headerlink" title="ä¿¡å·é©±åŠ¨IO Signal-driven I/O"></a>ä¿¡å·é©±åŠ¨IO Signal-driven I/O</h3><p>å…è®¸Socketè¿›è¡Œä¿¡å·é©±åŠ¨IOï¼Œå¹¶å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸é˜»å¡ã€‚å½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œè¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªSIGIOä¿¡å·ï¼Œå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨I/Oæ“ä½œå‡½æ•°å¤„ç†æ•°æ®ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/tI3sfV4oyaSiNwE.png" alt="21091434_DsZb"></p><h3 id="å¼‚æ­¥éé˜»å¡-asynchronous-I-O"><a href="#å¼‚æ­¥éé˜»å¡-asynchronous-I-O" class="headerlink" title="å¼‚æ­¥éé˜»å¡ asynchronous I/O"></a>å¼‚æ­¥éé˜»å¡ asynchronous I/O</h3><blockquote><p>å¥³å‹ä¸æƒ³é€›è¡—ï¼Œåˆé¤å…å¤ªåµäº†ï¼Œå›å®¶å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ã€‚äºæ˜¯æˆ‘ä»¬å«å¤–å–ï¼Œæ‰“ä¸ªç”µè¯ç‚¹é¤ï¼Œç„¶åæˆ‘å’Œå¥³å‹å¯ä»¥åœ¨å®¶å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ï¼Œé¥­å¥½äº†é€è´§å‘˜é€åˆ°å®¶é‡Œæ¥ã€‚è¿™å°±æ˜¯å…¸å‹çš„å¼‚æ­¥ï¼Œåªéœ€è¦æ‰“ä¸ªç”µè¯è¯´ä¸€ä¸‹ï¼Œç„¶åå¯ä»¥åšè‡ªå·±çš„äº‹æƒ…ï¼Œé¥­å¥½äº†å°±é€æ¥äº†ã€‚</p></blockquote><p>ç›¸å¯¹äºåŒæ­¥IOï¼Œå¼‚æ­¥IOä¸æ˜¯é¡ºåºæ‰§è¡Œã€‚ç”¨æˆ·è¿›ç¨‹è¿›è¡Œaio_readç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œæ— è®ºå†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œéƒ½ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ï¼Œç„¶åç”¨æˆ·æ€è¿›ç¨‹å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚ç­‰åˆ°socketæ•°æ®å‡†å¤‡å¥½äº†ï¼Œå†…æ ¸ç›´æ¥å¤åˆ¶æ•°æ®ç»™è¿›ç¨‹ï¼Œç„¶åä»å†…æ ¸å‘è¿›ç¨‹å‘é€é€šçŸ¥ã€‚IOä¸¤ä¸ªé˜¶æ®µï¼Œè¿›ç¨‹éƒ½æ˜¯éé˜»å¡çš„ã€‚</p><p>Linuxæä¾›äº†AIOåº“å‡½æ•°å®ç°å¼‚æ­¥ï¼Œä½†æ˜¯ç”¨çš„å¾ˆå°‘ã€‚ç›®å‰æœ‰å¾ˆå¤šå¼€æºçš„å¼‚æ­¥IOåº“ï¼Œä¾‹å¦‚libeventã€libevã€libuvã€‚å¼‚æ­¥è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/rsQRKLS6MxgYA2q.png" alt="20175459_gtgw"></p><p>ç”¨æˆ·è¿›ç¨‹å‘èµ·aio_readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ã€‚å½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalæˆ–æ‰§è¡Œä¸€ä¸ªåŸºäºçº¿ç¨‹çš„å›è°ƒå‡½æ•°æ¥å®Œæˆè¿™æ¬¡ IO å¤„ç†è¿‡ç¨‹ï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p><p><strong>åœ¨ Linux ä¸­ï¼Œé€šçŸ¥çš„æ–¹å¼æ˜¯ â€œä¿¡å·â€ï¼š</strong></p><blockquote><p>å¦‚æœè¿™ä¸ªè¿›ç¨‹æ­£åœ¨ç”¨æˆ·æ€å¿™ç€åšåˆ«çš„äº‹ï¼ˆä¾‹å¦‚åœ¨è®¡ç®—ä¸¤ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ï¼‰ï¼Œé‚£å°±å¼ºè¡Œæ‰“æ–­ä¹‹ï¼Œè°ƒç”¨äº‹å…ˆæ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•å¤„ç†è¿™ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚ç”±äºä¿¡å·å¤„ç†å‡½æ•°æ˜¯çªç„¶é—¯è¿›æ¥çš„ï¼Œå› æ­¤è·Ÿä¸­æ–­å¤„ç†ç¨‹åºä¸€æ ·ï¼Œæœ‰å¾ˆå¤šäº‹æƒ…æ˜¯ä¸èƒ½åšçš„ï¼Œå› æ­¤ä¿é™©èµ·è§ï¼Œä¸€èˆ¬æ˜¯æŠŠäº‹ä»¶ â€œç™»è®°â€ ä¸€ä¸‹æ”¾è¿›é˜Ÿåˆ—ï¼Œç„¶åè¿”å›è¯¥è¿›ç¨‹åŸæ¥åœ¨åšçš„äº‹ã€‚</p><p>å¦‚æœè¿™ä¸ªè¿›ç¨‹æ­£åœ¨å†…æ ¸æ€å¿™ç€åšåˆ«çš„äº‹ï¼Œä¾‹å¦‚ä»¥åŒæ­¥é˜»å¡æ–¹å¼è¯»å†™ç£ç›˜ï¼Œé‚£å°±åªå¥½æŠŠè¿™ä¸ªé€šçŸ¥æŒ‚èµ·æ¥äº†ï¼Œç­‰åˆ°å†…æ ¸æ€çš„äº‹æƒ…å¿™å®Œäº†ï¼Œå¿«è¦å›åˆ°ç”¨æˆ·æ€çš„æ—¶å€™ï¼Œå†è§¦å‘ä¿¡å·é€šçŸ¥ã€‚</p><p>å¦‚æœè¿™ä¸ªè¿›ç¨‹ç°åœ¨è¢«æŒ‚èµ·äº†ï¼Œä¾‹å¦‚æ— äº‹å¯åš sleep äº†ï¼Œé‚£å°±æŠŠè¿™ä¸ªè¿›ç¨‹å”¤é†’ï¼Œä¸‹æ¬¡æœ‰ CPU ç©ºé—²çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒåº¦åˆ°è¿™ä¸ªè¿›ç¨‹ï¼Œè§¦å‘ä¿¡å·é€šçŸ¥ã€‚</p></blockquote><p>å¼‚æ­¥ API è¯´æ¥è½»å·§ï¼Œåšæ¥éš¾ï¼Œè¿™ä¸»è¦æ˜¯å¯¹ API çš„å®ç°è€…è€Œè¨€çš„ã€‚Linux çš„å¼‚æ­¥ IOï¼ˆAIOï¼‰æ”¯æŒæ˜¯ 2.6.22 æ‰å¼•å…¥çš„ï¼Œè¿˜æœ‰å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ä¸æ”¯æŒå¼‚æ­¥ IOã€‚Linux çš„å¼‚æ­¥ IO æœ€åˆæ˜¯ä¸ºæ•°æ®åº“è®¾è®¡çš„ï¼Œå› æ­¤é€šè¿‡å¼‚æ­¥ IO çš„è¯»å†™æ“ä½œä¸ä¼šè¢«ç¼“å­˜æˆ–ç¼“å†²ï¼Œè¿™å°±æ— æ³•åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ä¸ç¼“å†²æœºåˆ¶ã€‚</p><p><strong>å¾ˆå¤šäººæŠŠ Linux çš„ O_NONBLOCK è®¤ä¸ºæ˜¯å¼‚æ­¥æ–¹å¼ï¼Œä½†äº‹å®ä¸Šè¿™æ˜¯å‰é¢è®²çš„åŒæ­¥éé˜»å¡æ–¹å¼ã€‚</strong>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè™½ç„¶ Linux ä¸Šçš„ IO API ç•¥æ˜¾ç²—ç³™ï¼Œä½†æ¯ç§ç¼–ç¨‹æ¡†æ¶éƒ½æœ‰å°è£…å¥½çš„å¼‚æ­¥ IO å®ç°ã€‚æ“ä½œç³»ç»Ÿå°‘åšäº‹ï¼ŒæŠŠæ›´å¤šçš„è‡ªç”±ç•™ç»™ç”¨æˆ·ï¼Œæ­£æ˜¯ UNIX çš„è®¾è®¡å“²å­¦ï¼Œä¹Ÿæ˜¯ Linux ä¸Šç¼–ç¨‹æ¡†æ¶ç™¾èŠ±é½æ”¾çš„ä¸€ä¸ªåŸå› ã€‚</p><p>ä»å‰é¢ IO æ¨¡å‹çš„åˆ†ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º AIO çš„åŠ¨æœºï¼š</p><blockquote><p>åŒæ­¥é˜»å¡æ¨¡å‹éœ€è¦åœ¨ IO æ“ä½œå¼€å§‹æ—¶é˜»å¡åº”ç”¨ç¨‹åºã€‚è¿™æ„å‘³ç€ä¸å¯èƒ½åŒæ—¶é‡å è¿›è¡Œå¤„ç†å’Œ IO æ“ä½œã€‚</p><p>åŒæ­¥éé˜»å¡æ¨¡å‹å…è®¸å¤„ç†å’Œ IO æ“ä½œé‡å è¿›è¡Œï¼Œä½†æ˜¯è¿™éœ€è¦åº”ç”¨ç¨‹åºæ ¹æ®é‡ç°çš„è§„åˆ™æ¥æ£€æŸ¥ IO æ“ä½œçš„çŠ¶æ€ã€‚</p><p>è¿™æ ·å°±å‰©ä¸‹å¼‚æ­¥éé˜»å¡ IO äº†ï¼Œå®ƒå…è®¸å¤„ç†å’Œ IO æ“ä½œé‡å è¿›è¡Œï¼ŒåŒ…æ‹¬ IO æ“ä½œå®Œæˆçš„é€šçŸ¥ã€‚</p></blockquote><p>IOå¤šè·¯å¤ç”¨é™¤äº†éœ€è¦é˜»å¡ä¹‹å¤–ï¼Œ<code>select</code>å‡½æ•°æ‰€æä¾›çš„åŠŸèƒ½ï¼ˆå¼‚æ­¥é˜»å¡ IOï¼‰ä¸ AIO ç±»ä¼¼ã€‚ä¸è¿‡ï¼Œå®ƒæ˜¯å¯¹é€šçŸ¥äº‹ä»¶è¿›è¡Œé˜»å¡ï¼Œè€Œä¸æ˜¯å¯¹ IO è°ƒç”¨è¿›è¡Œé˜»å¡ã€‚</p><h3 id="å…³äºå¼‚æ­¥é˜»å¡"><a href="#å…³äºå¼‚æ­¥é˜»å¡" class="headerlink" title="å…³äºå¼‚æ­¥é˜»å¡"></a>å…³äºå¼‚æ­¥é˜»å¡</h3><p>æœ‰æ—¶æˆ‘ä»¬çš„ API åªæä¾›å¼‚æ­¥é€šçŸ¥æ–¹å¼ï¼Œä¾‹å¦‚åœ¨ node.js é‡Œï¼Œä½†ä¸šåŠ¡é€»è¾‘éœ€è¦çš„æ˜¯åšå®Œä¸€ä»¶äº‹ååšå¦ä¸€ä»¶äº‹ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥åˆå§‹åŒ–åæ‰èƒ½å¼€å§‹æ¥å—ç”¨æˆ·çš„ HTTP è¯·æ±‚ï¼Œè¿™æ ·çš„ä¸šåŠ¡é€»è¾‘å°±éœ€è¦è°ƒç”¨è€…æ˜¯ä»¥é˜»å¡æ–¹å¼æ¥å·¥ä½œã€‚</p><p>ä¸ºäº†åœ¨å¼‚æ­¥ç¯å¢ƒé‡Œæ¨¡æ‹Ÿ â€œé¡ºåºæ‰§è¡Œâ€ çš„æ•ˆæœï¼Œå°±éœ€è¦æŠŠåŒæ­¥ä»£ç è½¬æ¢æˆå¼‚æ­¥å½¢å¼ï¼Œè¿™ç§°ä¸º CPSï¼ˆContinuation Passing Styleï¼‰å˜æ¢ã€‚BYVoid å¤§ç¥çš„ <a href="https://link.jianshu.com?t=https://github.com/BYVoid/continuation">continuation.js</a> åº“å°±æ˜¯ä¸€ä¸ª CPS å˜æ¢çš„å·¥å…·ã€‚ç”¨æˆ·åªéœ€ç”¨æ¯”è¾ƒç¬¦åˆäººç±»å¸¸ç†çš„åŒæ­¥æ–¹å¼ä¹¦å†™ä»£ç ï¼ŒCPS å˜æ¢å™¨ä¼šæŠŠå®ƒè½¬æ¢æˆå±‚å±‚åµŒå¥—çš„å¼‚æ­¥å›è°ƒå½¢å¼ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/Dxzcvh826j9Osfe.png" alt="20183314_5rY1"></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/sGLikDutaBUR4TQ.png" alt="20183327_wIGf"></p><p>å¦å¤–ä¸€ç§ä½¿ç”¨é˜»å¡æ–¹å¼çš„ç†ç”±æ˜¯é™ä½å“åº”å»¶è¿Ÿã€‚å¦‚æœé‡‡ç”¨éé˜»å¡æ–¹å¼ï¼Œä¸€ä¸ªä»»åŠ¡ A è¢«æäº¤åˆ°åå°ï¼Œå°±å¼€å§‹åšå¦ä¸€ä»¶äº‹ Bï¼Œä½† B è¿˜æ²¡åšå®Œï¼ŒA å°±å®Œæˆäº†ï¼Œè¿™æ—¶è¦æƒ³è®© A çš„å®Œæˆäº‹ä»¶è¢«å°½å¿«å¤„ç†ï¼ˆæ¯”å¦‚ A æ˜¯ä¸ªç´§æ€¥äº‹åŠ¡ï¼‰ï¼Œè¦ä¹ˆä¸¢å¼ƒåšåˆ°ä¸€åŠçš„ Bï¼Œè¦ä¹ˆä¿å­˜ B çš„ä¸­é—´çŠ¶æ€å¹¶åˆ‡æ¢å› Aï¼Œä»»åŠ¡çš„åˆ‡æ¢æ˜¯éœ€è¦æ—¶é—´çš„ï¼ˆä¸ç®¡æ˜¯ä»ç£ç›˜è½½å…¥åˆ°å†…å­˜ï¼Œè¿˜æ˜¯ä»å†…å­˜è½½å…¥åˆ°é«˜é€Ÿç¼“å­˜ï¼‰ï¼Œè¿™åŠ¿å¿…é™ä½ A çš„å“åº”é€Ÿåº¦ã€‚å› æ­¤ï¼Œå¯¹å®æ—¶ç³»ç»Ÿæˆ–è€…å»¶è¿Ÿæ•æ„Ÿçš„äº‹åŠ¡ï¼Œæœ‰æ—¶é‡‡ç”¨é˜»å¡æ–¹å¼æ¯”éé˜»å¡æ–¹å¼æ›´å¥½ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="é˜»å¡vséé˜»å¡"><a href="#é˜»å¡vséé˜»å¡" class="headerlink" title="é˜»å¡vséé˜»å¡"></a>é˜»å¡vséé˜»å¡</h3><p>è°ƒç”¨blocking IOä¼šä¸€ç›´blockä½å¯¹åº”çš„è¿›ç¨‹ç›´åˆ°æ“ä½œå®Œæˆï¼Œè€Œnon-blocking IOåœ¨kernelè¿˜å‡†å¤‡æ•°æ®çš„æƒ…å†µä¸‹ä¼šç«‹åˆ»è¿”å›ã€‚</p><h3 id="åŒæ­¥vså¼‚æ­¥"><a href="#åŒæ­¥vså¼‚æ­¥" class="headerlink" title="åŒæ­¥vså¼‚æ­¥"></a>åŒæ­¥vså¼‚æ­¥</h3><p>å…³äºsynchronouså’Œasynchronousï¼ŒPOSIXç»™å‡ºäº†å¦‚ä¸‹çš„å®šä¹‰ï¼š</p><blockquote><p>A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;</p><p>An asynchronous I/O operation does not cause the requesting process to be blocked;</p></blockquote><p>ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºsynchronous IOåšâ€IO operationâ€çš„æ—¶å€™ä¼šå°†processé˜»å¡ã€‚æŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œä¹‹å‰æ‰€è¿°çš„blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±äºsynchronous IOã€‚</p><p>æœ‰äººä¼šè¯´ï¼Œnon-blocking IOå¹¶æ²¡æœ‰è¢«blockå•Šã€‚è¿™é‡Œæœ‰ä¸ªéå¸¸â€œç‹¡çŒ¾â€çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸­æ‰€æŒ‡çš„â€IO operationâ€æ˜¯æŒ‡çœŸå®çš„IOæ“ä½œï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„<code>recvfrom</code>è¿™ä¸ªsystem callã€‚non-blocking IOåœ¨æ‰§è¡Œ<code>recvfrom</code>è¿™ä¸ªsystem callçš„æ—¶å€™ï¼Œå¦‚æœkernelçš„æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ—¶å€™ä¸ä¼šblockè¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå½“kernelä¸­æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œrecvfromä¼šå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> I/O </tag>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCPä¸‰æ¬¡æ¡æ‰‹çš„åº•å±‚é€»è¾‘</title>
      <link href="/2018/02/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BTCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%9A%84%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/"/>
      <url>/2018/02/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BTCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%9A%84%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/</url>
      
        <content type="html"><![CDATA[<p>TCPä¸‰æ¬¡æ¡æ‰‹æ˜¯åŸºç¡€ä¸­çš„åŸºç¡€ï¼Œæ‰€æœ‰å·¥ç¨‹å¸ˆéƒ½å¯¹æ­¤ç†Ÿæ‚‰ä¸è¿‡ã€‚ä½†è¿™é‡Œçš„ä¸‰æ¬¡å¾€å¾€è¢«å¿½è§†ï¼Œç©¶ç«Ÿä¸ºä½•TCPéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿæœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨TCPä¸‰æ¬¡æ¡æ‰‹çš„åº•å±‚é€»è¾‘ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä¼šä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä»‹ç»ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketsã€çª—å£å¤§å°ã€åˆå§‹åºåˆ—å·å¹¶å»ºç«‹ TCP è¿æ¥ï¼š</p><ul><li>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½é˜»æ­¢é‡å¤å†å²è¿æ¥çš„åˆå§‹åŒ–ï¼›</li><li>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å¯¹é€šä¿¡åŒæ–¹çš„åˆå§‹åºåˆ—å·è¿›è¡Œåˆå§‹åŒ–ï¼›</li><li>è®¨è®ºå…¶ä»–æ¬¡æ•°æ¡æ‰‹å»ºç«‹è¿æ¥çš„å¯èƒ½æ€§ï¼›</li></ul><p>è¿™å‡ ä¸ªè®ºç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ TCP é€‰æ‹©ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„æœ€ä¸»è¦åŸå› ï¼Œå…¶ä»–çš„å‡ ä¸ªåŸå› ç›¸æ¯”ä¹‹ä¸‹éƒ½æ˜¯æ¬¡è¦çš„åŸå› ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯¹å®ƒä»¬çš„è®¨è®ºåªæ˜¯ä¸ºäº†è®©æ•´ä¸ªè§†è§’æ›´åŠ ä¸°å¯Œï¼Œé€šè¿‡å¤šæ–¹é¢ç†è§£è¿™ä¸€æœ‰è¶£çš„è®¾è®¡å†³ç­–ã€‚</p><a id="more"></a><p><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol</a> æ–‡æ¡£ä¸­éå¸¸æ¸…æ¥šåœ°å®šä¹‰äº† TCP ä¸­çš„è¿æ¥æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹ï¼šç”¨äºä¿è¯å¯é æ€§å’Œæµæ§åˆ¶æœºåˆ¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·ä»¥åŠçª—å£å¤§å°å«åšè¿æ¥ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/02/dfQg4A3Y1JqeyTu.png" alt="what-is-tcp-connection"></p><p>æ‰€ä»¥ï¼Œå»ºç«‹ TCP è¿æ¥å°±æ˜¯é€šä¿¡çš„åŒæ–¹éœ€è¦å¯¹ä¸Šè¿°çš„ä¸‰ç§ä¿¡æ¯è¾¾æˆå…±è¯†ï¼Œè¿æ¥ä¸­çš„ä¸€å¯¹ Socket æ˜¯ç”±äº’è”ç½‘åœ°å€æ ‡å¿—ç¬¦å’Œç«¯å£ç»„æˆçš„ï¼Œçª—å£å¤§å°ä¸»è¦ç”¨æ¥åšæµæ§åˆ¶ï¼Œæœ€åçš„åºåˆ—å·æ˜¯ç”¨æ¥è¿½è¸ªé€šä¿¡å‘èµ·æ–¹å‘é€çš„æ•°æ®åŒ…åºå·ï¼Œæ¥æ”¶æ–¹å¯ä»¥é€šè¿‡åºåˆ—å·å‘å‘é€æ–¹ç¡®è®¤æŸä¸ªæ•°æ®åŒ…çš„æˆåŠŸæ¥æ”¶ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°†åŸæœ‰çš„é—®é¢˜è½¬æ¢æˆäº†ã€ä¸ºä»€ä¹ˆéœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketsã€çª—å£å¤§å°å’Œåˆå§‹åºåˆ—å·ï¼Ÿã€ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¼€å§‹å¯¹è¿™ä¸ªç»†åŒ–çš„é—®é¢˜è¿›è¡Œåˆ†æå¹¶å¯»æ‰¾è§£é‡Šã€‚</p><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä¼šä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä»‹ç»ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketsã€çª—å£å¤§å°ã€åˆå§‹åºåˆ—å·å¹¶å»ºç«‹ TCP è¿æ¥ï¼š</p><ul><li>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½é˜»æ­¢é‡å¤å†å²è¿æ¥çš„åˆå§‹åŒ–ï¼›</li><li>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å¯¹é€šä¿¡åŒæ–¹çš„åˆå§‹åºåˆ—å·è¿›è¡Œåˆå§‹åŒ–ï¼›</li><li>è®¨è®ºå…¶ä»–æ¬¡æ•°æ¡æ‰‹å»ºç«‹è¿æ¥çš„å¯èƒ½æ€§ï¼›</li></ul><p>è¿™å‡ ä¸ªè®ºç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ TCP é€‰æ‹©ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„æœ€ä¸»è¦åŸå› ï¼Œå…¶ä»–çš„å‡ ä¸ªåŸå› ç›¸æ¯”ä¹‹ä¸‹éƒ½æ˜¯æ¬¡è¦çš„åŸå› ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯¹å®ƒä»¬çš„è®¨è®ºåªæ˜¯ä¸ºäº†è®©æ•´ä¸ªè§†è§’æ›´åŠ ä¸°å¯Œï¼Œé€šè¿‡å¤šæ–¹é¢ç†è§£è¿™ä¸€æœ‰è¶£çš„è®¾è®¡å†³ç­–ã€‚</p><h3 id="å†å²è¿æ¥"><a href="#å†å²è¿æ¥" class="headerlink" title="å†å²è¿æ¥"></a>å†å²è¿æ¥</h3><p><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol</a> å…¶å®å°±æŒ‡å‡ºäº† TCP è¿æ¥ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„é¦–è¦åŸå›  â€”â€” ä¸ºäº†é˜»æ­¢å†å²çš„é‡å¤è¿æ¥åˆå§‹åŒ–é€ æˆçš„æ··ä¹±é—®é¢˜ï¼Œé˜²æ­¢ä½¿ç”¨ TCP åè®®é€šä¿¡çš„åŒæ–¹å»ºç«‹äº†é”™è¯¯çš„è¿æ¥ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/03/YEVnqM4zvKRmDhG.png" alt="tcp-recovery-from-old-duplicate-syn"></p><p>æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼Œå¦‚æœé€šä¿¡åŒæ–¹çš„é€šä¿¡æ¬¡æ•°åªæœ‰ä¸¤æ¬¡ï¼Œé‚£ä¹ˆå‘é€æ–¹ä¸€æ—¦å‘å‡ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ä¹‹åå®ƒå°±æ²¡æœ‰åŠæ³•æ’¤å›è¿™ä¸€æ¬¡è¯·æ±‚ï¼Œå¦‚æœåœ¨ç½‘ç»œçŠ¶å†µå¤æ‚æˆ–è€…è¾ƒå·®çš„ç½‘ç»œä¸­ï¼Œå‘é€æ–¹è¿ç»­å‘é€å¤šæ¬¡å»ºç«‹è¿æ¥çš„è¯·æ±‚ï¼Œå¦‚æœ TCP å»ºç«‹è¿æ¥åªèƒ½é€šä¿¡ä¸¤æ¬¡ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹åªèƒ½é€‰æ‹©æ¥å—æˆ–è€…æ‹’ç»å‘é€æ–¹å‘èµ·çš„è¯·æ±‚ï¼Œå®ƒå¹¶ä¸æ¸…æ¥šè¿™ä¸€æ¬¡è¯·æ±‚æ˜¯ä¸æ˜¯ç”±äºç½‘ç»œæ‹¥å µè€Œæ—©æ—©è¿‡æœŸçš„è¿æ¥ã€‚</p><p>æ‰€ä»¥ï¼ŒTCP é€‰æ‹©ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥å¹¶åœ¨è¿æ¥å¼•å…¥äº† <code>RST</code> è¿™ä¸€æ§åˆ¶æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹å½“æ”¶åˆ°è¯·æ±‚æ—¶ä¼šå°†å‘é€æ–¹å‘æ¥çš„ <code>SEQ+1</code> å‘é€ç»™å¯¹æ–¹ï¼Œè¿™æ—¶ç”±å‘é€æ–¹æ¥åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯å†å²è¿æ¥ï¼š</p><ul><li>å¦‚æœå½“å‰è¿æ¥æ˜¯å†å²è¿æ¥ï¼Œå³ <code>SEQ</code> è¿‡æœŸæˆ–è€…è¶…æ—¶ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šç›´æ¥å‘é€ <code>RST</code> æ§åˆ¶æ¶ˆæ¯ä¸­æ­¢è¿™ä¸€æ¬¡è¿æ¥ï¼›</li><li>å¦‚æœå½“å‰è¿æ¥ä¸æ˜¯å†å²è¿æ¥ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šå‘é€ <code>ACK</code> æ§åˆ¶æ¶ˆæ¯ï¼Œé€šä¿¡åŒæ–¹å°±ä¼šæˆåŠŸå»ºç«‹è¿æ¥ï¼›</li></ul><p>ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å’Œ <code>RST</code> æ§åˆ¶æ¶ˆæ¯å°†æ˜¯å¦å»ºç«‹è¿æ¥çš„æœ€ç»ˆæ§åˆ¶æƒäº¤ç»™äº†å‘é€æ–¹ï¼Œå› ä¸ºåªæœ‰å‘é€æ–¹æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡æ¥åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯é”™è¯¯çš„æˆ–è€…è¿‡æœŸçš„ï¼Œè¿™ä¹Ÿæ˜¯ TCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„æœ€ä¸»è¦åŸå› ã€‚</p><h3 id="åˆå§‹åºåˆ—å·"><a href="#åˆå§‹åºåˆ—å·" class="headerlink" title="åˆå§‹åºåˆ—å·"></a>åˆå§‹åºåˆ—å·</h3><p>å¦ä¸€ä¸ªä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„é‡è¦çš„åŸå› å°±æ˜¯é€šä¿¡åŒæ–¹éƒ½éœ€è¦è·å¾—ä¸€ä¸ªç”¨äºå‘é€ä¿¡æ¯çš„åˆå§‹åŒ–åºåˆ—å·ï¼Œä½œä¸ºä¸€ä¸ªå¯é çš„ä¼ è¾“å±‚åè®®ï¼ŒTCP éœ€è¦åœ¨ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸­æ„å»ºä¸€ä¸ªå¯é çš„ä¼ è¾“å±‚ï¼Œç½‘ç»œçš„ä¸ç¡®å®šæ€§å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åŒ…çš„ç¼ºå¤±å’Œé¡ºåºé¢ å€’ç­‰é—®é¢˜ï¼Œå¸¸è§çš„é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼š</p><ul><li>æ•°æ®åŒ…è¢«å‘é€æ–¹å¤šæ¬¡å‘é€é€ æˆæ•°æ®çš„é‡å¤ï¼›</li><li>æ•°æ®åŒ…åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­è¢«è·¯ç”±æˆ–è€…å…¶ä»–èŠ‚ç‚¹ä¸¢å¤±ï¼›</li><li>æ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶æ–¹å¯èƒ½æ— æ³•æŒ‰ç…§å‘é€é¡ºåºï¼›</li></ul><p>ä¸ºäº†è§£å†³ä¸Šè¿°è¿™äº›å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼ŒTCP åè®®è¦æ±‚å‘é€æ–¹åœ¨æ•°æ®åŒ…ä¸­åŠ å…¥ã€åºåˆ—å·ã€å­—æ®µï¼Œæœ‰äº†æ•°æ®åŒ…å¯¹åº”çš„åºåˆ—å·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ï¼š</p><ul><li>æ¥æ”¶æ–¹å¯ä»¥é€šè¿‡åºåˆ—å·å¯¹é‡å¤çš„æ•°æ®åŒ…è¿›è¡Œå»é‡ï¼›</li><li>å‘é€æ–¹ä¼šåœ¨å¯¹åº”æ•°æ®åŒ…æœªè¢« ACK æ—¶è¿›è¡Œé‡å¤å‘é€ï¼›</li><li>æ¥æ”¶æ–¹å¯ä»¥æ ¹æ®æ•°æ®åŒ…çš„åºåˆ—å·å¯¹å®ƒä»¬è¿›è¡Œé‡æ–°æ’åºï¼›</li></ul><p>åºåˆ—å·åœ¨ TCP è¿æ¥ä¸­æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼Œåˆå§‹åºåˆ—å·ä½œä¸º TCP è¿æ¥çš„ä¸€éƒ¨åˆ†ä¹Ÿéœ€è¦åœ¨ä¸‰æ¬¡æ¡æ‰‹æœŸé—´è¿›è¡Œåˆå§‹åŒ–ï¼Œç”±äº TCP è¿æ¥é€šä¿¡çš„åŒæ–¹éƒ½éœ€è¦è·å¾—åˆå§‹åºåˆ—å·ï¼Œæ‰€ä»¥å®ƒä»¬å…¶å®éœ€è¦å‘å¯¹æ–¹å‘é€ <code>SYN</code> æ§åˆ¶æ¶ˆæ¯å¹¶æºå¸¦è‡ªå·±æœŸæœ›çš„åˆå§‹åŒ–åºåˆ—å· <code>SEQ</code>ï¼Œå¯¹æ–¹åœ¨æ”¶åˆ° <code>SYN</code> æ¶ˆæ¯ä¹‹åä¼šé€šè¿‡ <code>ACK</code> æ§åˆ¶æ¶ˆæ¯ä»¥åŠ <code>SEQ+1</code> æ¥è¿›è¡Œç¡®è®¤ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/03/aEen7ulNP21jfTC.png" alt="basic-4-way-handshake"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šä¿¡åŒæ–¹çš„ä¸¤ä¸ª <code>TCP A/B</code> åˆ†åˆ«å‘å¯¹æ–¹å‘é€ <code>SYN</code> å’Œ <code>ACK</code> æ§åˆ¶æ¶ˆæ¯ï¼Œç­‰å¾…é€šä¿¡åŒæ–¹éƒ½è·å–åˆ°äº†è‡ªå·±æœŸæœ›çš„åˆå§‹åŒ–åºåˆ—å·ä¹‹åå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ï¼Œç”±äº TCP æ¶ˆæ¯å¤´çš„è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸­é—´çš„ä¸¤æ¬¡é€šä¿¡åˆæˆä¸€ä¸ªï¼Œ<code>TCP B</code> å¯ä»¥å‘ <code>TCP A</code> åŒæ—¶å‘é€ <code>ACK</code> å’Œ <code>SYN</code> æ§åˆ¶æ¶ˆæ¯ï¼Œè¿™ä¹Ÿå°±å¸®åŠ©æˆ‘ä»¬å°†å››æ¬¡é€šä¿¡å‡å°‘è‡³ä¸‰æ¬¡ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œç½‘ç»œä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œå…¶ä¸­å¹¶ä¸å­˜åœ¨ä¸€ä¸ªç”¨äºè®¡æ•°çš„å…¨å±€æ—¶é’Ÿï¼Œè€Œ TCP å¯ä»¥é€šè¿‡ä¸åŒçš„æœºåˆ¶æ¥åˆå§‹åŒ–åºåˆ—å·ï¼Œä½œä¸º TCP è¿æ¥çš„æ¥æ”¶æ–¹æˆ‘ä»¬æ— æ³•åˆ¤æ–­å¯¹æ–¹ä¼ æ¥çš„åˆå§‹åŒ–åºåˆ—å·æ˜¯å¦è¿‡æœŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦äº¤ç”±å¯¹æ–¹æ¥åˆ¤æ–­ï¼ŒTCP è¿æ¥çš„å‘èµ·æ–¹å¯ä»¥é€šè¿‡ä¿å­˜å‘å‡ºçš„åºåˆ—å·åˆ¤æ–­è¿æ¥æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè®©æ¥æ”¶æ–¹æ¥ä¿å­˜å¹¶åˆ¤æ–­åºåˆ—å·å´æ˜¯ä¸ç°å®çš„ï¼Œè¿™ä¹Ÿå†ä¸€æ¬¡å¼ºåŒ–äº†æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æå‡ºçš„è§‚ç‚¹ â€”â€” é¿å…å†å²é”™è¿æ¥çš„åˆå§‹åŒ–ã€‚</p><h3 id="é€šä¿¡æ¬¡æ•°"><a href="#é€šä¿¡æ¬¡æ•°" class="headerlink" title="é€šä¿¡æ¬¡æ•°"></a>é€šä¿¡æ¬¡æ•°</h3><p>å½“æˆ‘ä»¬è®¨è®º TCP å»ºç«‹è¿æ¥éœ€è¦çš„é€šä¿¡æ¬¡æ•°æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæ‰§ç€äºä¸ºä»€ä¹ˆé€šä¿¡ä¸‰æ¬¡æ‰å¯ä»¥å»ºç«‹è¿æ¥ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ï¼›è®¨è®ºä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°æ¥å»ºç«‹è¿æ¥å¾€å¾€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ€»å¯ä»¥<strong>ä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°äº¤æ¢ç›¸åŒçš„ä¿¡æ¯</strong>ï¼Œæ‰€ä»¥ä½¿ç”¨å››æ¬¡ã€äº”æ¬¡æˆ–è€…æ›´å¤šæ¬¡æ•°å»ºç«‹è¿æ¥åœ¨æŠ€æœ¯ä¸Šéƒ½æ˜¯å®Œå…¨å¯ä»¥å®ç°çš„ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/03/LcoAQhJECWtXBil.png" alt="basic-3-way-handshake"></p><p>è¿™ç§å¢åŠ  TCP è¿æ¥é€šä¿¡æ¬¡æ•°çš„é—®é¢˜å¾€å¾€æ²¡æœ‰è®¨è®ºçš„å¿…è¦æ€§ï¼Œæˆ‘ä»¬è¿½æ±‚çš„å…¶å®æ˜¯ç”¨æ›´å°‘çš„é€šä¿¡æ¬¡æ•°ï¼ˆç†è®ºä¸Šçš„è¾¹ç•Œï¼‰å®Œæˆä¿¡æ¯çš„äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä¸Šä¸¤èŠ‚ä¸­ä¹Ÿä¸€å†å¼ºè°ƒä½¿ç”¨ã€ä¸¤æ¬¡æ¡æ‰‹ã€æ²¡æœ‰åŠæ³•å»ºç«‹ TCP è¿æ¥ï¼Œä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ˜¯å»ºç«‹è¿æ¥æ‰€éœ€è¦çš„æœ€å°æ¬¡æ•°ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­è®¨è®ºäº†ä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨å…·ä½“åˆ†æè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆé‡æ–°æ€è€ƒäº† TCP è¿æ¥ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œ<a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol - IETF Tools</a> å¯¹ TCP è¿æ¥æœ‰ç€éå¸¸æ¸…æ¥šçš„å®šä¹‰ â€”â€” ç”¨äºä¿è¯å¯é æ€§å’Œæµæ§åˆ¶æœºåˆ¶çš„æ•°æ®ï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·ä»¥åŠçª—å£å¤§å°ã€‚</p><p>TCP å»ºç«‹è¿æ¥æ—¶é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥æœ‰æ•ˆåœ°é¿å…å†å²é”™è¯¯è¿æ¥çš„å»ºç«‹ï¼Œå‡å°‘é€šä¿¡åŒæ–¹ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ï¼Œä¸‰æ¬¡æ¡æ‰‹èƒ½å¤Ÿå¸®åŠ©é€šä¿¡åŒæ–¹è·å–åˆå§‹åŒ–åºåˆ—å·ï¼Œå®ƒä»¬èƒ½å¤Ÿä¿è¯æ•°æ®åŒ…ä¼ è¾“çš„ä¸é‡ä¸ä¸¢ï¼Œè¿˜èƒ½ä¿è¯å®ƒä»¬çš„ä¼ è¾“é¡ºåºï¼Œä¸ä¼šå› ä¸ºç½‘ç»œä¼ è¾“çš„é—®é¢˜å‘ç”Ÿæ··ä¹±ï¼Œåˆ°è¿™é‡Œä¸ä½¿ç”¨ã€ä¸¤æ¬¡æ¡æ‰‹ã€å’Œã€å››æ¬¡æ¡æ‰‹ã€çš„åŸå› å·²ç»éå¸¸æ¸…æ¥šäº†ï¼š</p><ul><li>ã€ä¸¤æ¬¡æ¡æ‰‹ã€ï¼šæ— æ³•é¿å…å†å²é”™è¯¯è¿æ¥çš„åˆå§‹åŒ–ï¼Œæµªè´¹æ¥æ”¶æ–¹çš„èµ„æºï¼›</li><li>ã€å››æ¬¡æ¡æ‰‹ã€ï¼šTCP åè®®çš„è®¾è®¡å¯ä»¥è®©æˆ‘ä»¬åŒæ—¶ä¼ é€’ <code>ACK</code> å’Œ <code>SYN</code> ä¸¤ä¸ªæ§åˆ¶ä¿¡æ¯ï¼Œå‡å°‘äº†é€šä¿¡æ¬¡æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°ä¼ è¾“ç›¸åŒçš„ä¿¡æ¯ï¼›</li></ul><p>æˆ‘ä»¬é‡æ–°å›åˆ°åœ¨æ–‡ç« å¼€å¤´æçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ç±»æ¯”è§£é‡Š TCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ˜¯é”™è¯¯çš„ï¼Ÿè¿™ä¸»è¦è¿˜æ˜¯å› ä¸ºï¼Œè¿™ä¸ªç±»æ¯”æ²¡æœ‰è§£é‡Šæ¸…æ¥šæ ¸å¿ƒé—®é¢˜ â€”â€” é¿å…å†å²ä¸Šçš„é‡å¤è¿æ¥ã€‚åˆ°æœ€åï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€äº›æ¯”è¾ƒå¼€æ”¾çš„ç›¸å…³é—®é¢˜ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ä»”ç»†æƒ³ä¸€ä¸‹ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>é™¤äº†ä½¿ç”¨åºåˆ—å·æ˜¯å¦è¿˜æœ‰å…¶ä»–æ–¹å¼ä¿è¯æ¶ˆæ¯çš„ä¸é‡ä¸ä¸¢ï¼Ÿ</li><li>UDP åè®®æœ‰è¿æ¥çš„æ¦‚å¿µä¹ˆï¼Œå®ƒèƒ½ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é ä¹ˆï¼Ÿ</li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol - IETF Tools</a></li><li><a href="https://networkengineering.stackexchange.com/questions/24068/why-do-we-need-a-3-way-handshake-why-not-just-2-way">Why do we need a 3-way handshake? Why not just 2-way?</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP/IP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å»ºç«‹é«˜æ•ˆçŸ¥è¯†ç¬”è®°ç®¡ç†ç³»ç»Ÿ</title>
      <link href="/2018/02/01/%E6%96%B9%E6%B3%95%E8%AE%BA/%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E9%AB%98%E6%95%88%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
      <url>/2018/02/01/%E6%96%B9%E6%B3%95%E8%AE%BA/%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E9%AB%98%E6%95%88%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>è½¬è½½è‡ªï¼š<a href="https://zhuanlan.zhihu.com/p/191519306">å¦‚ä½•å»ºç«‹çŸ¥è¯†ç¬”è®°ç®¡ç†ç³»ç»Ÿï¼Ÿ</a></p><p>äººè„‘çš„å·¥ä½œå…¶å®å¾ˆå¤§ç¨‹åº¦ä¸Šä¸è®¡ç®—æœºçš„å·¥ä½œæœºåˆ¶ç›¸ä¼¼ï¼Œäººè„‘çš„æ€ç»´åŒºæ˜¯CPUå¤„ç†æ€è€ƒä»»åŠ¡ ï¼Œäººè„‘çš„å·¥ä½œè®°å¿†åŒºæ˜¯CPUç¼“å­˜å¤„ç†å·¥ä½œç¬æ—¶è®°å¿†ï¼Œäººè„‘çš„çŸ­æœŸè®°å¿†åŒºæ˜¯å†…å­˜å¤„ç†çŸ­æœŸè®°å¿†ï¼Œäººè„‘çš„å»ºç«‹çš„ç¥ç»çªè§¦åˆ™æ˜¯æ•°æ®åº“ã€‚ä½†æ˜¯äººè„‘çš„å®¹é‡æ¯•ç«Ÿæœ‰é™ï¼Œä¸€ç§æ›´ç»æµçš„åšæ³•æ˜¯ï¼ŒæŠŠå…³é”®çš„çŸ¥è¯†èŠ‚ç‚¹å­˜å‚¨åœ¨å¤§è„‘ä¸­ï¼Œä½œä¸ºé¢†åŸŸçŸ¥è¯†çš„ç´¢å¼•ï¼Œè€Œå¤§é‡ç»†èŠ‚é—®é¢˜å­˜å‚¨äºå„ç§æ•°å­—åŒ–å­˜å‚¨è®¾å¤‡ã€‚è¿™ä¾¿æ˜¯ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Ÿ</strong></h2><p>å‡è®¾æœ‰ä¸€ä¸ªåœºæ™¯ï¼ŒåºŠå¤´æœ‰ 10 æœ¬ä¹¦ï¼Œè¦åœ¨å…¶ä¸­æ‰¾åˆ°ä¸€æœ¬ä¹¦ï¼Œä½ ä¼šæ€ä¹ˆæ‰¾ï¼Ÿä¸€æœ¬æœ¬ç¿»æ‰¾ã€‚</p><p>ä½†å‡å¦‚åœ¨ç¾å›½å›½ä¼šå›¾ä¹¦é¦†ä¸­ï¼Œè—ä¹¦è¶… 2.1 äº¿æœ¬ï¼Œåœ¨é‡Œè¾¹æ‰¾åˆ°æŸä¸€æœ¬ä¹¦ï¼Œè¯·é—®ä½ å¦‚ä½•æ‰¾ï¼Ÿ</p><p>ä»…å‡­äººè„‘æ˜¯æ²¡æœ‰åŠæ³•å¤„ç†è¿™ä¹ˆå¤§çš„ä¿¡æ¯é‡çš„ã€‚é‚£ä¹ˆå›¾ä¹¦é¦†çš„ç®¡ç†äººå‘˜ï¼Œæ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼Ÿ</p><p>å½“è®©æ˜¯é ç€ä¸€å¥—ç®¡ç†ç³»ç»Ÿï¼Œè®©ä¸€åˆ‡è§„å¾‹åŒ–ï¼Œè§„åˆ™åŒ–ï¼Œç³»ç»ŸåŒ–ï¼ŒæŠŠäººè§£æ”¾å‡ºæ¥ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/MIpzQ8NPBhdAw5a.jpg" alt=""></p><p>åŒç†ï¼Œæˆ‘ä»¬çš„çŸ¥è¯†ç®¡ç†ç³»ç»Ÿå°±ç›¸å½“äºè¿™ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œè€ŒçŸ¥è¯†å°±å¦‚åŒè¿™ä¸€æœ¬æœ¬å›¾ä¹¦ï¼Œå½“æœ‰äº†å¥—ç³»ç»Ÿå»ç®¡ç†å®ƒä»¬ä»¥åï¼Œæˆ‘ä»¬å°±ç›¸å½“äºæ‹¥æœ‰äº†å¦å¤–çš„ä¸€ä¸ªå¤§è„‘ï¼Œå¦‚æ­¤å°±å¯ä»¥æŠŠæˆ‘ä»¬å¤§è„‘ä¸æ“…é•¿çš„ä¸œè¥¿ï¼Œå…¨éƒ¨æ‰”ç»™è¿™ä¸ªå¤–è„‘ï¼Œè®©å®ƒå¸®åŠ©æˆ‘ä»¬è®°å¿†ï¼Œæ•´ç†ç­‰ç­‰ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä½ å¿…é¡»è¦å»ºç«‹å¤–è„‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½ å¿…é¡»è¦å»ºç«‹å¤–è„‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½ å¿…é¡»è¦å»ºç«‹å¤–è„‘ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆä½ å¿…é¡»è¦å»ºç«‹å¤–è„‘ï¼Ÿ</strong></h2><p><strong>1. å¤§è„‘æ˜¯ç”¨æ¥æ€è€ƒçš„ï¼Œä¸æ˜¯ç”¨æ¥è®°å¿†çš„ã€‚</strong></p><p>è®°å¿†ï¼Œå°¤å…¶æ˜¯æ­»è®°ç¡¬èƒŒï¼Œæ˜¯æœ€åäººæ€§çš„ï¼Œè¿›åŒ–è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œå¤§è„‘åªä¼šè®°ä½æœ€èƒ½å¸®åŠ©æˆ‘ä»¬ç”Ÿå­˜çš„ä¿¡æ¯ï¼Œè‡³äºæ— å…³ç´§è¦çš„ï¼Œå®ƒä¸ºäº†èŠ‚çœè„‘åŠ›èµ„æºä¼šå°½å¯èƒ½çš„å¿˜è®°å®ƒä»¬ï¼ŒåŒæ ·çš„å¤§è„‘ä¹Ÿåªèƒ½å¤„ç†çœ¼ä¸‹çš„å°éƒ¨åˆ†ä¿¡æ¯ï¼Œè€Œé¢å¯¹å¤§é‡ä¿¡æ¯å¤„ç†çš„æ—¶å€™ï¼Œå¤§è„‘å°±ä¼šç½¢å·¥ã€‚</p><p>æˆ‘ä»¬å¹³å¸¸ç”¨è„‘çš„æ—¶å€™ï¼Œæ„Ÿè§‰æ€ç»ªä¹±ï¼Œå¤´æ˜è„‘æ¶¨ï¼Œå°±æ˜¯å› ä¸ºå¤§è„‘å¤„ç†çš„ä¿¡æ¯å·²ç»è¶…è¿‡äº†å®ƒçš„è´Ÿè·ã€‚<strong>å¤§è„‘çš„æœºåˆ¶å¤©ç”Ÿå°±ä¸æ˜¯ä¸ºäº†è®°å¿†å’Œå¤„ç†å¤§é‡ä¿¡æ¯è€Œè®¾è®¡çš„ï¼ï¼ï¼</strong></p><p>ä½†æ˜¯åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬åˆéœ€è¦å¤„ç†å’Œè®°ä½å¾ˆå¤šä¿¡æ¯å’ŒçŸ¥è¯†ç‚¹ï¼Œä»¥ä¾¿ä½¿ç”¨çš„æ—¶å€™å¯ä»¥éšç”¨éšå–ï¼Œé‚£åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å½“ç„¶æ˜¯å»ºç«‹å¤–è„‘ï¼ï¼ï¼</p><p><strong>å‰é¢è¯´äº†æˆ‘ä»¬å¤§è„‘ä¸æ“…é•¿çš„è®°å¿†å’Œå¤§è§„æ¨¡ä¿¡æ¯ç®¡ç†ï¼Œä½†è¿™å´æ˜¯æˆ‘ä»¬å¤–è„‘æ‰€æ“…é•¿çš„ã€‚æˆ‘ä»¬çš„å¤§è„‘ä¼šé—å¿˜ï¼Œä½†æ˜¯å¤–è„‘å®ƒæ°¸è¿œä¹Ÿä¸ä¼šå¿˜çš„ï¼Œä½ å»ºç«‹çš„è¿™ä¸ªå¤–è„‘å°±ä¼šå’Œä½ çš„å¤§è„‘å½¢æˆäº’è¡¥ï¼Œå„å‘æŒ¥å…¶æ‰€é•¿ã€‚</strong></p><p>æ­£å¦‚ä¸Šé¢çš„å›¾ä¹¦ç®¡ç†æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è®°ä½æ¯æœ¬ä¹¦çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ—¶å€™ï¼Œåªè¦çŸ¥é“æ€ä¹ˆä»å›¾ä¹¦ç®¡ç†ç³»ç»Ÿä¸­æ‰¾åˆ°å®ƒä»¬å³å¯ã€‚</p><p><strong>æ‰€ä»¥æƒ³å‘æŒ¥å¤§è„‘çœŸæ­£çš„å¨åŠ›ï¼Œå°±æŠŠå®ƒä»è®°å¿†ä¸­è§£æ”¾å‡ºæ¥ï¼Œè®©å®ƒå»æ€è€ƒï¼Œè€Œä¸æ˜¯è®©å®ƒå»è®°å¿†ã€‚</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/HkrCVtuxdainy2X.jpg" alt=""></p><p><strong>æœ‰åŒå­¦çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šæŠ¬æ ï¼šæœ‰å¿…è¦å¼„è¿™ä¹ˆä¸€ä¸ªå¤–è„‘å—ï¼Œæˆ‘å¤§è„‘å°±å¤Ÿç”¨äº†å•Šã€‚</strong></p><p>å½“ä½ åªæƒ³åšä¸ª â€œæ’¸ç‘Ÿâ€ çš„æ—¶å€™ï¼Œè§‰å¾—è¿™è¾ˆå­èƒ½æ¬ä¸ªç –ï¼Œæ‰›ä¸ªæ°´æ³¥å°±å¤Ÿäº†ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ç¦»å¼€äº†ï¼Œå› ä¸ºä½ ç¡®å®æ²¡æœ‰è¿™ä¸ªéœ€æ±‚ã€‚</p><p>ä½†æ˜¯ä½ æƒ³è·å¾—ä¸æ–­æˆé•¿ï¼Œè¦è·å¾—æ›´å¼ºçš„èƒ½åŠ›ï¼Œæƒ³è¦åœ¨ç¤¾ä¼šçš„æ¿€çƒˆç«äº‰ä¸­æœ‰è¶³å¤Ÿçš„ç«äº‰åŠ›ï¼Œä½ çš„çŸ¥è¯†å‚¨å¤‡å¿…ç„¶éœ€è¦è¢«æ‰©å¤§ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä½ è¦é è„‘å­è®°å¿†å—ï¼Ÿå›æƒ³ä½ ä¸Šå­¦çš„ç”Ÿæ¶¯å°±çŸ¥é“äº†ï¼Œé‚£æ˜¯å¤šä¹ˆç—›çš„é¢†æ‚Ÿ~</p><p>æ­£å¦‚ä¸Šæ–‡æ¡ˆä¾‹ï¼Œä½ åªæœ‰åæœ¬ä¹¦çš„æ—¶å€™ï¼Œå½“ç„¶ä¸éœ€è¦å»ºç«‹å¤–è„‘ï¼Œæƒ³è¦å•¥æ‰«ä¸€çœ¼å°±å¤Ÿäº†ï¼Œä½†æ˜¯å½“ä½ æœ‰ 1000 æœ¬ã€10000 æœ¬ã€ä¸€ç™¾ä¸‡ã€ä¸€ä¸ªäº¿æœ¬çš„æ—¶å€™å‘¢ï¼Ÿ</p><p>ä»¥ä¸Šåªæ˜¯æˆ‘ä»¬å¿…é¡»å»ºç«‹å¤–è„‘çš„ä¸€ä¸ªç†ç”±ä¹‹ä¸€ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„ç†ç”±ã€‚</p><p><strong>2. å¤–è„‘æ˜¯ä¸ºäº†å¸®åŠ©å¤§è„‘æ›´å¥½çš„è®°ä½ï¼šæœ‰é€»è¾‘å…³ç³»çš„çŸ¥è¯†ï¼Œä½ ç”¨çš„æ—¶å€™æ‰èƒ½æƒ³èµ·æ¥ã€‚</strong></p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·è¯´å‘¢ï¼Ÿ</p><p>åŒæ ·æˆ‘ä»¬å…ˆä¸å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œç»™ä½ æ¥ä¸ªå°æµ‹è¯•ã€‚</p><p>ç°åœ¨æ€è€ƒä¸€ä¸‹ï¼šæˆ‘è®©ä½ è¯´æ°´æœçš„åå­—ï¼Œä½ çœ‹çœ‹ä½ èƒ½è¯´å‡ºå¤šå°‘ä¸ªæ°´æœã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™æœ‰ä»€ä¹ˆéš¾çš„ï¼šè‹¹æœï¼Œé¦™è•‰ï¼Œæ¢¨ã€æ©˜å­ã€ç«é¾™æœã€è¥¿ç“œâ€¦.</p><p>ä½†æ˜¯ä½ å‘ç°è¶Šå¾€ä¸‹ï¼Œä½ æ€è€ƒçš„æ—¶é—´å°±è¶Šé•¿ï¼Œè¶Šè¯´ä¸å‡ºæ¥ã€‚</p><p>ä½ å¯ä»¥å…ˆæš‚åœé˜…è¯»è¯•è¯•~</p><p>é‚£ä¹ˆæˆ‘å†æ¢ä¸€ä¸ªé—®é¢˜ï¼Œè¯·å‘Šè¯‰å¦‚è¥¿çº¢æŸ¿ç‚’é¸¡è›‹æ€ä¹ˆåšï¼Ÿ</p><p>ä½ å¯èƒ½æƒ³éƒ½ä¸ç”¨æƒ³ï¼Œç›´æ¥å°±å¯ä»¥è„±å£è€Œå‡ºï¼šå‡†å¤‡é£Ÿæ â€”&gt; æ´—èœåˆ‡èœ â€”-&gt; çˆ†é”…å¼€ç‚’ â€”-&gt;â€¦..</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p><p>å› ä¸ºå‰è€…å¤§è„‘ç´¢å¼•çš„æ˜¯ä¸€ä¸ªç‚¹ä¸€ä¸ªç‚¹çš„ä¿¡æ¯ï¼Œåè€…ç´¢å¼•çš„ä¸€æ•´ä¸ªç»“æ„ï¼Œä¸€æ•´å¥—æµç¨‹ï¼Œä¸€æ•´å¼ çŸ¥è¯†çš„ç½‘ã€‚</p><p>ä½ çœ‹ï¼Œç‚¹çŠ¶çš„ä¸œè¥¿è¢«å¤§è„‘ç´¢å¼•æ˜¯å¾ˆå›°éš¾çš„ï¼Œä½†æ˜¯æœ‰é€»è¾‘æœ‰ç»“æ„çš„ä¸œè¥¿åˆ™ä¸åŒï¼Œåè€…ä¸€ç´¢å¼•å°±æ˜¯ä¸€å¤§ç‰‡ï¼Œä¸€æ•´ä¸ªä½“ç³»ã€‚å½“ä½ æŠŠç‚¹çŠ¶çš„çŸ¥è¯†ç¼–ç»‡æˆä¸€å¼ ç½‘åï¼Œå®ƒä»¬å°±ä¼šå½¢æˆä½ çš„æ€ç»´æ¨¡å‹ï¼Œè¿™æ ·ï¼Œä½ ç”¨çš„æ—¶å€™æ‰èƒ½æƒ³èµ·æ¥ã€‚</p><p>å¾ˆå¤šäººæŠ±æ€¨ï¼Œå­¦è¿‡çš„ä¸œè¥¿ç”¨ä¸å‡ºæ¥ï¼Œåæ€ä¸€ä¸‹ï¼Œä»å°åˆ°å¤§ï¼Œä½ è°ƒç”¨ä½ çŸ¥è¯†å‚¨å¤‡çš„æ—¶å€™æ˜¯ä¸æ˜¯éƒ½åƒæ˜¯ä¸Šé¢æƒ³æ°´æœä¸€æ ·ï¼Œæƒ³åˆ°å“ªæ˜¯å“ªã€‚</p><p>ä½ æ•´ç†è¿‡ä½ çš„çŸ¥è¯†å—ï¼Ÿä½ çš„çŸ¥è¯†æ˜¯æˆç»“æ„çš„å—ï¼Ÿä½ è„‘ä¸­æœ‰è¿™ä¹ˆä¸€å¼ åºå¤§çš„çŸ¥è¯†ç»“æ„ç½‘å—ï¼Ÿ</p><p>è€ŒæŠŠçŸ¥è¯†æ‰“å…¥å¤–è„‘çš„è¿‡ç¨‹å°±æ˜¯åœ¨ç¼–ç»‡ä½ è¿™å¼ ç½‘ï¼Œæ‰€ä»¥<strong>å»ºç«‹å¤–è„‘çš„æœ¬è´¨å°±æ˜¯ä½“ç³»åŒ–ä½ çŸ¥è¯†çš„è¿‡ç¨‹ï¼ï¼ï¼</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/7TditOLD8hZF3ES.jpg" alt=""></p><h2 id="å¦‚ä½•å»ºç«‹å¤–è„‘ï¼Ÿ"><a href="#å¦‚ä½•å»ºç«‹å¤–è„‘ï¼Ÿ" class="headerlink" title="å¦‚ä½•å»ºç«‹å¤–è„‘ï¼Ÿ"></a>å¦‚ä½•å»ºç«‹å¤–è„‘ï¼Ÿ</h2><p><strong>æ•´ä¸ªå¤–è„‘æ˜¯ç”±ä¸¤ä¸ªç³»ç»Ÿæ„æˆã€‚</strong></p><blockquote><p>ç¬¬ä¸€ä¸ªæ˜¯å‚¨å­˜ç¬”è®°çš„ç³»ç»Ÿã€‚<br>ç¬¬äºŒä¸ªåˆ™æ˜¯ç´¢å¼•ç¬”è®°çš„ç³»ç»Ÿã€‚</p></blockquote><p>ä½ å¯ä»¥ç†è§£æˆä¸€ä¸ªæ”¾ï¼Œä¸€ä¸ªæ‹¿ï¼Œè¿™é‡ŒçŸ¥é“æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿å³å¯ï¼Œåæ–‡ä¼šå±•å¼€ä»‹ç»ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/navSjTKx6VoIMzm.jpg" alt=""></p><p><strong>è€Œæ•´ä¸ªå¤–è„‘çš„æ­å»ºå¯ä»¥å½’çº³ä¸ºä¸‰æ­¥èµ°~</strong></p><blockquote><p>ç¬¬ä¸€æ­¥ï¼šæŠŠæ”¶é›†çŸ¥è¯†æœ‰åºçš„è£…è¿›å»<br>ç¬¬äºŒæ­¥ï¼šæŠŠçŸ¥è¯†æ•´ç†å¥½ï¼Œè®¾ç«‹è§„åˆ™ï¼Œä»¥ä¾›éšæ—¶æç”¨ã€‚<br>ç¬¬ä¸‰æ­¥ï¼šç”¨çš„æ—¶å€™å¯ä»¥è¿…é€Ÿçš„æŠŠéœ€è¦çš„çŸ¥è¯†æ‹¿å‡ºæ¥ã€‚</p></blockquote><p><strong>æ•´ç¯‡æ–‡ç« çš„æ ¸å¿ƒä¸‹é¢ä¸€å¼ å›¾å°±æ¦‚æ‹¬äº†ï¼Œä½†æ˜¯ä¸ºäº†è®©ä½ å½»åº•æå®šè¿™ä»¶äº‹ï¼Œæˆ‘ä¼šæ°å¼€äº†æ‰ç¢äº†ï¼Œä¸€æ­¥æ­¥æ‰‹æŠŠæ‰‹å¸¦ä½ æ­å‡ºä½ çš„çŸ¥è¯†ç®¡ç†ç³»ç»Ÿã€‚</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/uQ7hqe8rLIDkFiH.png" alt=""></p><p><strong>ä¸‹é¢æˆ‘ä»¬å…ˆä»æ­å»ºå‚¨å­˜ä½“å…¥æ‰‹ï¼Œä»é›¶å¼€å§‹æ­å»ºæ•´ä¸ªå¤–è„‘ç³»ç»Ÿ~</strong></p><h3 id="ä¸€ï¼šé€‰æ‹©å¤–è„‘è½½ä½“"><a href="#ä¸€ï¼šé€‰æ‹©å¤–è„‘è½½ä½“" class="headerlink" title="ä¸€ï¼šé€‰æ‹©å¤–è„‘è½½ä½“"></a>ä¸€ï¼šé€‰æ‹©å¤–è„‘è½½ä½“</h3><p>ä¸€å°èƒ½æ­£å¸¸è·‘çš„ç”µè„‘ç³»ç»Ÿï¼Œå‰æå°±æ˜¯ä¸»æœºï¼Œæ˜¾ç¤ºå±è¿™äº›ç¡¬ä»¶è½½ä½“ï¼Œä½ æ“ä½œç³»ç»Ÿå†ç‰›é€¼ï¼Œæ²¡æœ‰ä¸»æœºä½ ä¹Ÿè·‘ä¸èµ·æ¥ã€‚</p><p>åŒç†ï¼Œæˆ‘ä»¬çš„å¤–è„‘çš„æ­å»ºä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ‰€ä»¥å»ºç«‹å¤–è„‘çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æ‰¾åˆ°å¤–è„‘çš„è½½ä½“ï¼Œå³å­˜æ”¾æˆ‘ä»¬çŸ¥è¯†çš„å·¥å…·ã€‚</p><p>é‚£ä¹ˆå¸‚é¢ä¸Šæä¾›ç»™æˆ‘ä»¬ç°æˆçš„å¤–è„‘è½½ä½“éƒ½æœ‰å“ªäº›å‘¢ï¼Ÿ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/oZnYvQfGDe91u7J.jpg" alt=""></p><p>å¤ªå¤šå¤ªå¤šäº†ï¼Œä¸»æµçš„æœ‰é“äº‘ç¬”è®°ã€å°è±¡ç¬”è®°ã€onenote ç­‰ï¼Œéƒ½å¯ä»¥ä½œä¸ºæˆ‘ä»¬å¤–è„‘çš„è½½ä½“ï¼Œå®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œæƒ³è¯¦ç»†äº†è§£çš„åŒå­¦è¯·è‡ªè¡Œäº†è§£ï¼Œæˆ‘è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œå¤§å®¶å‡­å€Ÿå–œå¥½é€‰æ‹©ï¼Œæ€»ä¹‹ï¼Œéƒ½æ˜¯ç°æˆçš„ï¼Œä»»å›é€‰æ‹©~</p><p>æˆ‘æœ¬äººçš„å¤–è„‘è½½ä½“ä¸ºæœ‰é“äº‘ç¬”è®°ï¼Œä¸‹æ–‡æ¼”ç¤ºï¼Œå‡ä»¥æ­¤ç¬”è®°åšæ¡ˆä¾‹ï¼Œå…¶ä»–è½½ä½“åŒç†~</p><p><strong>å½“æˆ‘ä»¬ç¡®å®šäº†å¤§è„‘çš„è½½ä½“ä»¥åå‘¢ï¼Ÿ</strong></p><p>å»ºç«‹å‡ ä¸ªæ–‡ä»¶å¤¹åï¼Œå°±å¼€å§‹ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·çš„å—ï¼Ÿ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/PbwXspTIK2k67hg.jpg" alt=""></p><p><strong>è¿™æ ·çš„å¤–è„‘ç³»ç»Ÿæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</strong></p><blockquote><p><strong>â‘  å±‚æ¬¡ç»“æ„æ··ä¹±ï¼š</strong>è¿™æ ·é•¿é•¿çš„åˆ—ä¸‹æ¥ï¼Œæˆ‘ä¸çŸ¥é“ä½ å¤´å¤§æ²¡æœ‰ï¼Œåˆ«è¯´æå–äº†ï¼Œæˆ‘å•å•çœ‹åˆ°è¿™ä¸€ä¸²ï¼Œå¤´å°±å…ˆå¤§ä¸€åœˆäº†ã€‚<br>å› ä¸ºè¿™æ ·æ··ä¹±çš„ç»“æ„ï¼Œå«ç³Šå…¶è¾çš„ç›®å½•ï¼Œä¼šè®©ä½ ç¿»çœ‹è¿™äº›ä¸œè¥¿çš„æ—¶å€™ï¼Œå¯¹è¿™ç§å‡Œä¹±æœ‰ä¸€ç§åŒæ¶æ„Ÿã€‚<br><strong>â‘¡ æå–å›°éš¾ï¼š</strong>æ··ä¹±çš„å†…å®¹ï¼Œä¼šè®©çœŸæ­£ç”¨çš„æ—¶å€™æ‰¾ä¸åˆ°ï¼Œæ‰€æœ‰çš„ç¬”è®°ï¼Œå¦‚æœç”¨çš„æ—¶å€™æ‰¾ä¸åˆ°ï¼Œæˆ–è€…éœ€è¦å¾ˆå¤§çš„åŠŸå¤«æ‰èƒ½æ‰¾åˆ°ï¼Œé‚£è¿™ä¸ªå¤–è„‘ç³»ç»Ÿå°±æ²¡å¤šå¤§æ„ä¹‰äº†ï¼Œå½“ä½ ç¬”è®°å†…å®¹å°‘çš„æ—¶å€™ï¼Œä½ è¿˜èƒ½è®°å¾—é‚£æ˜¯å“ªï¼Œä½†æ˜¯å½“å¤§åˆ°ä¸€å®šé‡çº§äº†å‘¢ï¼Œä½ çš„å¤–è„‘ä¸€å®šä¼šå´©æºƒã€‚<br><strong>â‘¢ çŸ¥è¯†ç¢ç‰‡åŒ–</strong>ï¼šä»¥ä¸Šæ‰€å»ºç«‹çš„æ–‡ä»¶å¤¹ï¼Œä¹‹é—´éƒ½æ˜¯å‰²è£‚çš„ï¼Œç¬”è®°ä¸ç¬”è®°é—´è¿æ¥ä¸èµ·æ¥ã€‚<br>æˆ‘ä»¬åœ¨æ–‡ç« å¼€å§‹çš„æ—¶å€™å°±è¯´äº†ï¼Œå¤–è„‘çš„ä½œç”¨é™¤äº†å¸®æˆ‘ä»¬æ‰¿æ‹…è®°å¿†çš„è´Ÿæ‹…ï¼Œè¿˜æœ‰ä¸€é¡¹èŒèƒ½å°±æ˜¯è¾…åŠ©æˆ‘ä»¬å¤§è„‘ä¸ºæˆ‘ä»¬å»ºç«‹èµ·çŸ¥è¯†ä½“ç³»ï¼Œå¦‚æœä½ çš„ç¬”è®°ä¹‹é—´éƒ½æ˜¯ä¸€ä¸ªä¸ªæ•£ä¹±çš„ç‚¹ï¼Œé‚£ä¹ˆå¤–è„‘çš„æ„ä¹‰å°±è¦è¢«ç æ‰ä¸€åŠã€‚</p></blockquote><p><strong>ä¸€å¥è¯æ¥è¯´ï¼Œä¸Šé¢çš„é‚£äº›éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½çš„å¤–è„‘ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰è§£å†³æˆ‘ä»¬ä¸ºä»€ä¹ˆå»ºç«‹å¤–è„‘çš„æœ¬è´¨é—®é¢˜ã€‚</strong></p><p><strong>é‚£ä¹ˆä»€ä¹ˆæ˜¯å¥½çš„å¤–è„‘å‘¢ï¼Ÿ</strong></p><blockquote><p><strong>1. çŸ¥è¯†ç»“æ„ä½“ç³»åŒ–ï¼š</strong>ç¬”è®°ä¸ç¬”è®°é—´çš„çŸ¥è¯†ç‚¹ä¸åˆ†æ•£ï¼Œä¸æ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œä¸æ˜¯ç¢ç‰‡åŒ–çš„ã€‚<br><strong>2. æ–¹ä¾¿ç®¡ç†ï¼š</strong>çœ‹åˆ°ä¸å¤´å¤§ï¼Œç»“æ„æ¸…æ™°ï¼Œä¸€ç›®äº†ç„¶ã€‚<br><strong>3. æå–æ–¹ä¾¿ï¼Œé«˜æ•ˆï¼š</strong>æœ€å¥½é«˜æ•ˆåˆ°å¦‚åŒæ¢å›Šå–ç‰©ï¼Œæƒ³åˆ°å°±èƒ½ç§’æ‹¿åˆ°ã€‚å¦‚æœè¿™ä¸€ç‚¹æ»¡è¶³ä¸äº†ï¼Œæ‰¾ä¸€ä¸ªæƒ³è¦çš„ä¿¡æ¯è¦åŠå¤©ï¼Œé‚£ä¹ˆè¿™å¥—ç³»ç»Ÿå°±æ²¡æœ‰å¤šå°‘æ„ä¹‰ã€‚</p></blockquote><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/S2w4osnQHAK3rvk.jpg" alt=""></p><p>å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œä½ çŸ¥é“äº†ï¼Œä¸€ä¸ªå¥½çš„å¤–è„‘çš„æ ‡å‡†ï¼Œéšç€è€Œæ¥çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•æ‰èƒ½è®©ä½ çš„å¤–è„‘è¾¾æˆä»¥ä¸Šæ ‡å‡†ã€‚</p><p><strong>é‚£ä¹ˆå¦‚ä½•è®©å¤–è„‘æ»¡è¶³ä»¥ä¸Šæ¡ä»¶å‘¢ï¼Ÿ</strong></p><p>æ­£å¦‚ç”µè„‘çš„ windows ç³»ç»Ÿä¸€æ ·ï¼Œè£…ä¸Šäº†ï¼Œæˆ‘ä»¬å°±æ— éœ€ç”¨ä¹±ä¸ƒå…«ç³Ÿåäººæ€§çš„ dos å‘½ä»¤å»è®©è®¡ç®—æœºå·¥ä½œï¼Œæ‰€æœ‰çš„ä¸€åˆ‡éƒ½æœ‰åºçš„è·‘åœ¨è¿™å¥—æ¸…çˆ½çš„å›¾å½¢åŒ–ç³»ç»Ÿä¹‹ä¸Šã€‚</p><p><strong>åŒç†æƒ³è®©å¤–è„‘ä¸ä¹±ï¼Œä½ å¿…é¡»éƒ¨ç½²ä¸€å¥—è§„åˆ™åŒ–çš„æ“ä½œç³»ç»Ÿï¼Œè®©æˆ‘ä»¬çš„çŸ¥è¯†ç¬”è®°å…¨éƒ¨è·‘åœ¨è¿™å¥—ç®¡ç†ç³»ç»Ÿä¹‹ä¸Šï¼Œä¿è¯åº•ç›˜ä¸ä¹±ï¼Œæ ¹åŸºç¨³ï¼Œè€Œä¸æ˜¯éšæ€§è€Œå»ºã€‚</strong></p><p>æ‰€ä»¥æ‰¾åˆ°è½½ä½“ä¹‹åï¼Œä¸æ˜¯ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œè€Œæ˜¯è¦ç»™æˆ‘ä»¬çš„å¤–è„‘è£…ä¸Šä¸€ä¸ªç±»ä¼¼ windows ä¸€æ ·çš„åº•å±‚ç³»ç»Ÿï¼Œè€Œæˆ‘ä»¬è¿™å¥—è·‘åœ¨å¤–è„‘è½½ä½“ä¸Šçš„ç³»ç»Ÿå°±æ˜¯ GTD ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºç«‹å¤–è„‘çš„ç¬¬äºŒæ­¥å°±æ˜¯ç»™å®ƒè£…ä¸Šè¿™å¥—ç³»ç»Ÿã€‚</p><h3 id="äºŒï¼šéƒ¨ç½²-GTD-æ“ä½œç³»ç»Ÿ"><a href="#äºŒï¼šéƒ¨ç½²-GTD-æ“ä½œç³»ç»Ÿ" class="headerlink" title="äºŒï¼šéƒ¨ç½² GTD æ“ä½œç³»ç»Ÿ"></a>äºŒï¼šéƒ¨ç½² GTD æ“ä½œç³»ç»Ÿ</h3><p><strong>â‘  ä»€ä¹ˆæ˜¯ GTD ç³»ç»Ÿï¼Ÿ</strong></p><p>GTD çš„è‹±æ–‡å…¨ç§°æ˜¯ï¼šGetting Things Done</p><p>è¿™æ˜¯ç”±è‘—åçš„æ—¶é—´ç®¡ç†äººæˆ´ç»´ãƒ»è‰¾ä¼¦åœ¨ä»–çš„è‘—ä½œã€Šå°½ç®¡å»åšã€‹é‡Œæå‡ºçš„ä¸€å¥—ç§»åŠ¨ç¡¬ç›˜å¼çš„ä»»åŠ¡ç®¡ç†æ–¹æ³•ï¼Œå®ƒçš„æ ¸å¿ƒç²¾é«“æ˜¯æŠŠæ‰€æœ‰å¾…åŠä»»åŠ¡éƒ½ä»å¤§è„‘é‡Œç§»å‡ºå»ï¼Œæ¸…ç©ºå¤§è„‘ï¼Œç”¨å¤–éƒ¨çš„å·¥å…·å»ç®¡ç†ä»»åŠ¡ï¼Œè®©å¤§è„‘çš„å…¨éƒ¨èµ„æºéƒ½ç”¨æ¥æ€è€ƒï¼Œè€Œåˆä¸ä¼šé—æ¼ä»»ä½•ä¸€ä»¶äº‹ã€‚</p><p>éƒ¨ç½²äº† GTD ç³»ç»Ÿåœ¨ç¬”è®°æœ¬ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ© GTD çš„å·¥ä½œæµï¼Œä¸ä»…æ‹¥æœ‰äº†çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œè€Œä¸”è¿˜æŠŠæˆ‘ä»¬çš„æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿä¹Ÿéƒ½å›Šæ‹¬å…¶ä¸­äº†ï¼Œæå¤§å¹…åº¦çš„è§£æ”¾äº†æˆ‘ä»¬çš„å¤§è„‘ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/Z26TjanLCMIP8gQ.jpg" alt=""></p><p><strong>â‘¡ å¦‚ä½•éƒ¨ç½² GTD ç³»ç»Ÿåˆ°ç¬”è®°æœ¬ä¸Šï¼Ÿ</strong></p><p>GTD å·¥ä½œæµæ€»å…±æœ‰ 5 ä¸ªæ­¥éª¤ï¼šæ”¶é›†ã€å˜æ¸…ã€æ•´ç†ã€å½’æ¡£ã€å›é¡¾ã€‚</p><p>è€ŒæŠŠå®ƒç”¨åˆ°æˆ‘ä»¬çš„å¤–è„‘ä¸Šå°±å˜æˆäº†ä¿¡æ¯ç®¡ç†æµï¼ŒåŒæ ·ä¹Ÿæ˜¯äº”ä¸ªæ­¥éª¤ï¼š</p><p>GTD ä¿¡æ¯æµï¼šæ”¶é›†ç®±ã€ç­‰å¾…å¤„ç†ã€å°†æ¥å¯èƒ½ã€å½’æ¡£èµ„æ–™ã€ä¸“é¢˜ç ”ç©¶ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/PYXr54Wy1tTxd3Q.jpg" alt=""></p><p>ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹ï¼Œæˆ‘ä»¬è®¾ç½®çš„è¿™äº”ä¸ªæ–‡ä»¶å¤¹å¯ä»¥å¹²ä»€ä¹ˆã€‚</p><p><strong>1. æ”¶é›†ç®±</strong></p><p>è¿™ä¸ªå°±ç›¸å½“äºä½ åœ¨å„å¤§å¹³å°ç‚¹çš„æ”¶è—ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‹¿æ‰‹æœºåˆ·åˆ°å¥½æ–‡äº†ï¼ˆæ¯”å¦‚è¿™ç¯‡æ–‡ç« å“ˆ~ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå„å¤§å¹³å°çš„å¥½æ–‡ï¼Œä¸€é”®é›†ä¸­æ‰”åˆ°è¿™ä¸ªæ”¶é›†ç®±ä¸­ã€‚</p><p>è¿™ä¸ªä¸œè¥¿çš„ä½œç”¨å°±æ˜¯è´Ÿè´£æ”¶é›†ï¼Œä½ ä¸å¿…æ“å¿ƒè¯¥æ”¾åˆ°é‚£ä¸ªåˆ†ç±»ï¼Œæ‰€æœ‰çš„å¥½ä¸œè¥¿ï¼Œä¸€è‚¡è„‘æ‰”è¿›å»å°± OK äº†ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¹…åº¦çš„è§£æ”¾æˆ‘ä»¬åˆ†ç±»å½’ç±»çš„æ—¶é—´ï¼Œç­‰åˆ°äº†ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ï¼Œæ¯”å¦‚æ™šä¸Šç»Ÿä¸€å¤„ç†ï¼Œè¿™æ ·æ—¢ä¸æ‰“æ–­æˆ‘ä»¬å½“å‰æ‰‹å¤´çš„äº‹æƒ…ï¼ŒåŒæ—¶åˆç¡®ä¿äº†æ”¶è—çš„æ–‡ä»¶ä¸ä¼šä¹±ä¸ƒå…«ç³Ÿï¼Œåˆèƒ½è®©ä½ è®¤çœŸçš„è¯„ä¼°å’Œç²¾è¯»è¿™ç¯‡æ–‡ç« ï¼Œç¡®ä¿è¿›å…¥ä½ ç¬”è®°çš„éƒ½æ˜¯ç²¾å“ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/HfBtsrGiSpFnjLT.jpg" alt=""></p><p><strong>2. ç­‰å¾…å¤„ç†</strong></p><p>è¿™ä¸ªæ–‡ä»¶å¤¹æ‰¿è½½æˆ‘ä»¬å½“å¤©çš„æ—¥ç¨‹ï¼Œå¤‡å¿˜å½•ï¼Œè®°äº‹æœ¬ï¼Œæ²‰æ€å½•ã€æ—¥è®°æœ¬ç­‰ç­‰ã€‚</p><p>ä½ åº”è¯¥æœ‰ä½“ä¼šï¼Œå¤§è„‘å‡­è®°å¿†åŠ›å¤„ç†è¿™äº›äº‹æƒ…æœ‰å¤šå‘çˆ¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™äº›äº‹æƒ…äº¤ç»™å¤–è„‘å¤„ç†ï¼ŒæŠŠæ—¥ç¨‹ï¼Œå¾…åŠäº‹é¡¹ç­‰å…¨éƒ¨ç§»åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼ŒæŠŠè¿™äº›äº‹æƒ…å…¨éƒ¨ä»å¤§è„‘ä¸­æ¸…ç†å‡ºå»ï¼Œæƒ³çŸ¥é“æ¥ä¸‹æ¥è¦åšä»€ä¹ˆäº‹æƒ…ç›´æ¥æ¥ç¿»è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæ•ˆç‡é«˜çš„é£èµ·ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/C7KdH45qMBcOV3X.jpg" alt=""></p><p><strong>3. å°†æ¥å¯èƒ½</strong></p><p>è¿™é‡Œä¸»è¦æ‰¿è½½è®¡åˆ’ã€è§„åˆ’ã€æƒ³æ³•ã€ç‚¹å­ç±»çš„ä¸œè¥¿ã€‚</p><p>æ¯”å¦‚ä½ çœ‹åˆ°äº†ä¸€ä¸ªç‚¹å­ï¼Œå‘ç°äº†ä¸€ä¸ªé¡¹ç›®ï¼Œä½ å°±å¯ä»¥å…ˆæŠŠå®ƒæ‰”åˆ°è¿™é‡Œï¼Œä½œä¸ºä½ çš„çµæ„Ÿåº“ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/Prpod8FtVSux5si.jpg" alt=""></p><p><strong>4. å½’æ¡£èµ„æ–™</strong></p><p>è¿™ä¸ªæ˜¯æˆ‘ä»¬çš„çŸ¥è¯†çš„å¤§æœ¬è¥ï¼Œæœ€ç»ˆæ‰€æœ‰çš„ä¿¡æ¯å’Œç¬”è®°éƒ½ä¼šè¢«å½’å…¥åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬æ”¶é›†åˆ°çš„ä¿¡æ¯é€šè¿‡æ•´ç†å®Œæ¯•ä»¥åï¼Œå°±æ”¾å…¥è¿™é‡Œï¼Œä»¥ä¾›éšæ‰‹å¤ä¹ å’Œä½¿ç”¨çš„æ—¶å€™éšæ—¶è°ƒå–ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/En5uQeaCl1x6ZUG.jpg" alt=""></p><p><strong>5. ä¸“é¢˜ç ”ç©¶</strong></p><p>æ¯”å¦‚æˆ‘æœ€è¿‘å¯¹å”±æ­Œæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥å•ç‹¬è¿™ä¸“é¢˜è¿™é‡Œå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸“é—¨æœåŠ¡äºå”±æ­Œï¼Œå½“ç ”ç©¶å‡ºæˆæœäº†ï¼Œå†æŠŠå®ƒå½’å…¥åˆ°å½’æ¡£èµ„æ–™ä¸­ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/Any4i5R3JcVpIg1.jpg" alt=""></p><p>å½“ä½ åœ¨ä½ çš„ç¬”è®°æœ¬ä¸Šï¼Œåˆ›å»ºäº†è¿™ä¸ª 5 ä¸ªæ–‡ä»¶å¤¹åï¼Œä½ çš„ GTD ç³»ç»Ÿå°±éƒ¨ç½²å®Œæˆäº†ã€‚</p><p>ä½ çœ‹ï¼Œéƒ¨ç½²äº† GTDï¼Œé€šè¿‡ GTD æ¥å¤„ç†ä¿¡æ¯åï¼Œä½ çš„å¤–è„‘æ˜¯ä¸æ˜¯ç‰¹åˆ«æœ‰å±‚æ¬¡æ„Ÿï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¤–è„‘åƒæ˜¯æœ‰äº†çµé­‚ä¸€æ ·~ï¼Œè€Œä¸æ˜¯ç±»ä¼¼äºä¸Šé¢é‚£å››ä¸ªç¬”è®°é•¿é•¿çš„ä¸€ä¸²ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/H8uaZgQ1wy756l2.jpg" alt=""></p><p>é‚£ä¹ˆéƒ¨ç½²å®Œ GTD ç³»ç»Ÿåå°±å®Œäº†å—ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚</p><p>å®Œæˆäº†æœ€åº•å±‚ç³»ç»Ÿçš„æ­å»ºï¼Œæˆ‘ä»¬å°±è¦å¼€å§‹å»å¤„ç†è¾“å…¥è¿›æ¥çš„ç¬”è®°äº†ï¼Œå‰é¢è¯´äº†ï¼Œ<strong>æœ€ç»ˆæ‰€æœ‰çš„ç¬”è®°éƒ½ä¼šè¢«æ±‡æ€»å½’æ¡£åˆ°ã€å½’æ¡£èµ„æ–™ã€è¿™ä¸ªæ–‡ä»¶å¤¹ä¹‹ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®¡ç†ç¬”è®°çš„æ ¸å¿ƒå°±åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­</strong>ï¼Œä½†æ˜¯é‚£ä¹ˆå¤šçš„ç¬”è®°ï¼Œæ€ä¹ˆå»ç®¡ç†å•Šï¼Œè¿˜æ˜¯åƒä¸Šé¢å›¾ä¸­é‚£å››ä¸ªæ¡ˆä¾‹ä¸€æ ·ï¼Œåˆ—å‡ºé•¿é•¿çš„ä¸€ä¸²æ–‡ä»¶å¤¹å—ï¼Ÿ</p><p>ä¸‹é¢æˆ‘ä»¬è¿›å…¥æœ¬æ–‡çš„ç¬¬ä¸‰ä¸ªæ¨¡å—ï¼Œæ¥è§£å†³ä»¥ä¸Šé—®é¢˜ã€‚</p><h3 id="ä¸‰ï¼šè§„åˆ™åŒ–ä¿¡æ¯â€”â€”ç»™å¤–è„‘ç«‹ç»“æ„ã€ç»™ç¬”è®°ç«‹è§„çŸ©ã€‚"><a href="#ä¸‰ï¼šè§„åˆ™åŒ–ä¿¡æ¯â€”â€”ç»™å¤–è„‘ç«‹ç»“æ„ã€ç»™ç¬”è®°ç«‹è§„çŸ©ã€‚" class="headerlink" title="ä¸‰ï¼šè§„åˆ™åŒ–ä¿¡æ¯â€”â€”ç»™å¤–è„‘ç«‹ç»“æ„ã€ç»™ç¬”è®°ç«‹è§„çŸ©ã€‚"></a>ä¸‰ï¼šè§„åˆ™åŒ–ä¿¡æ¯â€”â€”ç»™å¤–è„‘ç«‹ç»“æ„ã€ç»™ç¬”è®°ç«‹è§„çŸ©ã€‚</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“æ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œå¦‚æœå½’å…¥è¿›æ¥çš„ç¬”è®°æ²¡æœ‰è§„åˆ™ï¼Œé‚£å°±ä¼šä¹±ä¸ƒå…«ç³Ÿï¼Œå®Œå…¨æ²¡æ•ˆç‡å¯è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦ç»™è¾“å…¥è¿›æ¥çš„ç¬”è®°è¿›è¡Œå¤„ç†ï¼Œæ•™ç»™å®ƒä»¬è§„çŸ©ï¼Œè®©å®ƒä»¬å˜å¾—æ¸…æ™°æœ‰è§„å¾‹ï¼Œåªæœ‰è¿™æ ·ï¼Œä½ æå–å®ƒçš„æ—¶å€™æ‰èƒ½è¿…é€Ÿæ‰¾åˆ°ä½ æƒ³è¦çš„ã€‚</p><p>ä½†æ˜¯è¦è®¾ç«‹é‚£äº›è§„çŸ©å‘¢ï¼Ÿå¦‚ä½•è®¾ç«‹å‘¢ï¼Ÿ</p><p>ä¸‹é¢æä¾›å››å¤§åŸåˆ™ï¼Œä¿è¯è®©ä½ çš„ç¬”è®°è§„è§„çŸ©çŸ©çš„ã€‚</p><p><strong>â‘  æœ€ç®€å±‚åŸåˆ™</strong></p><p><strong>ä»€ä¹ˆæ˜¯æœ€ç®€å±‚åŸåˆ™ï¼Ÿ</strong></p><p>æ‰€è°“æœ€ç®€å±‚åŸåˆ™å°±æ˜¯è®©æ–‡ä»¶å¤¹å°½å¯èƒ½çš„å°‘ï¼Œå±‚çº§å°½å¯èƒ½çš„å°‘ï¼Œå› ä¸ºåªæœ‰æ•°é‡å°‘ï¼Œä½ çœ‹èµ·æ¥æ‰ä¸ä¼šå¤´å¤§ï¼Œå¦‚æœè¿˜æ˜¯ä¸€å±‚åˆä¸€å±‚çš„æ–‡ä»¶å¤¹ï¼Œé‚£å°±å’Œå‰é¢ä½ çœ‹åˆ°çš„é‚£å››å¼ ç¬”è®°æ²¡å•¥å·®åˆ«äº†ã€‚</p><p><strong>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å°½å¯èƒ½çš„å°‘å‘¢ï¼Ÿ</strong></p><p>å½“ç„¶æ˜¯æ‰¾ä¸€ä¸ªå¯ä»¥æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½åŒ…æ‹¬è¿›æ¥çš„ç»´åº¦ï¼Œå®ƒç¬¦åˆä¹‹å‰æ–‡ç« æåˆ°çš„ MECE åŸåˆ™ï¼Œæ—¢æ¶µç›–äº†æ‰€æœ‰ç¬”è®°ç‰¹æ€§ï¼Œåˆä¸é—æ¼ï¼ŒåŒæ—¶åˆä¸å†—é•¿ã€‚</p><p>æˆ‘è¿™é‡Œå°±æä¾›ç»™ä½ ä¸€ä¸ªè¿™æ ·çš„ç»´åº¦ï¼Œä»¥ç¬”è®°çš„ â€œç”¨å¤„â€ è¿™ä¸€ä¸ªç»´åº¦è¿›è¡Œåˆ’åˆ†ï¼Œå³ï¼šã€å­¦ä¹ ã€ã€å·¥ä½œã€ã€ç”Ÿæ´»ã€ã€‚</p><p>ä½ å¯ä»¥éšä¾¿æƒ³ï¼Œä»ç”¨å¤„æ¥è®ºï¼Œä»»ä½•ç¬”è®°éƒ½ä¸ä¼šé€ƒè¿‡è¿™ä¸ªä¸‰ä¸ªåˆ†ç±»çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯ç¬¦åˆ MECE çš„ï¼Œæˆ‘ä»¬å°±ä»¥å®ƒä½œä¸ºåˆ’åˆ†çŸ¥è¯†çš„æ ‡å‡†ï¼Œä½œä¸ºã€å½’æ¡£èµ„æ–™ã€çš„æ‰“åº•æ–‡ä»¶å¤¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†æœ€ç®€å±‚ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/hfjAVnl4GDOXC7r.jpg" alt=""></p><p>æ‰“åº•æ–‡ä»¶å¤¹æœ‰äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¯¹æ–‡ä»¶å¤¹åšä¸€äº›è¿›ä¸€æ­¥ç»†åˆ†ï¼Œä½†å¦‚æœä½ è¿˜æ˜¯å»ºç«‹ä¸€ä¸²æ–‡ä»¶å¤¹ï¼Œæ•´ä¸ªç¬”è®°ä½“ç³»å¿…ç„¶ä¼šä¹±ï¼Œé‚£ä¹ˆå¦‚ä½•ç®¡ç†ä¸‹ä¸€çº§çš„æ–‡ä»¶å¤¹å‘¢ï¼Ÿ</p><p>è¿™å°±ç”¨åˆ°äº†è®©ä½ ç¬”è®°è§„çŸ©çš„ç¬¬äºŒä¸ªåŸåˆ™ï¼ï¼ï¼</p><p><strong>â‘¡ ç›®å½•ç¼–ç åŸåˆ™</strong></p><p><strong>ä»€ä¹ˆæ˜¯ç›®å½•ç¼–ç åŸåˆ™ï¼Ÿ</strong></p><p>ä½ å¯ä»¥å…ˆæ€è€ƒä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä¸€æœ¬ä¹¦æœ‰é‚£ä¹ˆå¤šçš„çŸ¥è¯†ç‚¹ï¼Œå®ƒæ˜¯æ€ä¹ˆæ’ç‰ˆæ‰è®©å†…å®¹æ¸…æ™°ä¸€ç›®äº†ç„¶çš„ï¼Ÿ</p><p>å½“ç„¶æ˜¯æŠŠå›¾ä¹¦çŸ¥è¯†ç»“æ„æ•´ç†æˆç›®å½•æŒ‰ç…§å±‚æ¬¡ç¼–ç å•Šï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™æ ·ä½ çœ‹èµ·æ¥ç»“æ„å°±ä¼šéå¸¸æ¸…æ™°ï¼Œä¸€ç›®äº†ç„¶ï¼ŒåŒç†ï¼Œæˆ‘ä»¬å¯¹æ–‡ä»¶å¤¹çš„å±‚çº§ç®¡ç†ï¼ŒåŒæ ·é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œè®©æ–‡ä»¶å¤¹çš„å±‚çº§ä¸å±‚çº§ä¹‹é—´å»ºç«‹èµ·é€»è¾‘å…³ç³»ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/cQxRyXtFm3PdEIr.jpg" alt=""></p><p><strong>é‚£å¦‚ä½•ç›®å½•ç¼–ç å‘¢?</strong></p><p>è¿™é‡Œä¸è¿›è¡Œèµ˜è¿°ï¼Œæˆ‘ç»™ä½ åšäº†ä¸€å¼ å›¾ï¼Œæ‰«ä¸€çœ¼ä¼°è®¡ä½ å°±ä¼šäº†ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/AsFWJrC8PnVfHOw.jpg" alt=""></p><p><strong>é™¤äº†å»ºç«‹èµ·æ¸…æ™°çš„é€»è¾‘å±‚æ¬¡å¤–ï¼Œä¸ºä»€ä¹ˆä½ ä¸€å®šè¦ç”¨ç›®å½•ç¼–ç ï¼Ÿ</strong></p><p>å› ä¸ºæœ‰äº†ç›®å½•ç¼–ç åï¼Œç¬”è®°å°±èƒ½å®ç°è‡ªåŠ¨æ’åºï¼ï¼  </p><p>ç¬”è®°æœ¬ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§åç§°æ’åºçš„ï¼Œæ¯”å¦‚ï¼Œæ•°å­— 1 åœ¨æ•°å­— 2 å‰é¢ï¼Œå­—æ¯ A åœ¨å­—æ¯ B å‰é¢ï¼Œå¦‚æ­¤å°±ä¼šéå¸¸æœ‰åºï¼Œå¯å‚è€ƒå¾®ä¿¡å¥½å‹ç›®å½•å“ˆ~  </p><p>å¦‚æœä½ æ²¡ç»™å®ƒè¿™æ ·è§„åˆ™åŒ–å‘½åï¼Œåˆ™ä¼šå‡ºç°ä¹±åºæƒ…å†µï¼Œä¼šè®©ç¬”è®°çœ‹èµ·æ¥ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œä½†å¦‚æœä½ è®¾ç½®äº†ç¼–ç ï¼Œå°±èƒ½å®ç°è‡ªåŠ¨æ’åºï¼Œéå¸¸çˆ½å•Š~</p><p>æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨å›¾ä¹¦ç›®å½•ç¼–ç ï¼Œä¸€ç®­åŒé›•ï¼Œä¸ä»…è®©ç»“æ„é€»è¾‘å±‚æ¬¡æ¸…æ™°ï¼Œè€Œä¸”è¿˜èƒ½å®ç°è‡ªåŠ¨æ’åºã€‚</p><p>ä»¥ä¸Šæˆ‘ä»¬è¯´äº†è®©ä½ ç¬”è®°è§„çŸ©çš„å››ä¸ªåŸåˆ™çš„å‰ä¸¤ä¸ªåŸåˆ™ï¼Œæœ‰äº†å®ƒä»¬å¯ä»¥è®©ä½ çš„ç¬”è®°ç»“æ„å±‚æ¬¡æœ‰äº†ä¸€ä¸ªè´¨çš„æå‡ï¼Œä½†ä»…ä»…æ˜¯å±‚æ¬¡æ¸…æ™°è¿˜è¿œè¿œä¸å¤Ÿï¼Œæƒ³è¦ä½ çš„ç¬”è®°è§„çŸ©ï¼Œä½ è¿˜éœ€è¦ç¬¬ä¸‰ä¸ªåŸåˆ™ã€‚</p><p><strong>â‘¢ ç»Ÿä¸€å‘½ååŸåˆ™</strong></p><p><strong>ä»€ä¹ˆæ˜¯ç»Ÿä¸€å‘½åçš„åŸåˆ™ï¼Ÿ</strong></p><p>å³ï¼š<strong>æ— è®ºæ˜¯æ–‡ä»¶å¤¹è¿˜æ˜¯ç¬”è®°æœ¬èº«ï¼Œéƒ½è¦éµå¾ªä¸€å¥—æ ‡å‡†çš„å‘½ååŸåˆ™</strong>ï¼Œåªæœ‰è¿™æ ·ä½ çš„ç¬”è®°æ‰ä¸ä¼šä¹±ï¼Œåˆ‡è®°æŠŠç¬”è®°å‘½åæˆè¿™æ ·çš„æ— æ ¼å¼ç¬”è®°ï¼Œä¸€æ—¦å…»æˆè¿™æ ·çš„ä¹ æƒ¯ï¼ŒåæœŸä¼šè®©ä½ æœ‰ä¸€ç§æƒ³é”¤æ­»ä½ è‡ªå·±çš„æ„Ÿè§‰ï¼Œç›¸ä¿¡æˆ‘~</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/c1WHEDpQyoViwnY.jpg" alt=""></p><p><strong>é‚£ä¹ˆç”¨ä»€ä¹ˆæ ‡å‡†å‘½åå‘¢ï¼Ÿæ€ä¹ˆå‘½åï¼Ÿ</strong></p><p>ä¸‹é¢æˆ‘ç»™å‡ºä¸‰ä¸ªæ–¹æ³•ï¼Œè®©ä½ è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>1. ç”¨é»„é‡‘åœˆæ³•åˆ™å‘½åæ–‡ä»¶å¤¹</strong></p><p>ä½ å­¦ä¹ çš„ä»»ä½•ä¸€ä¸ªçŸ¥è¯†ç‚¹æˆ–ä¸“é¢˜éƒ½é€ƒä¸è¿‡é»„é‡‘åœˆçš„ç»ˆæä¸‰é—®ï¼Œå³ï¼šæ˜¯ä»€ä¹ˆï¼ˆwhatï¼‰ã€ä¸ºä»€ä¹ˆï¼ˆwhyï¼‰ã€å¦‚ä½•åšï¼ˆhowï¼‰ã€‚</p><p>æ¯”å¦‚ä½ æƒ³ç ”ç©¶æ¼”è®²çš„è¯é¢˜ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š</p><blockquote><ol><li>ä»€ä¹ˆæ˜¯æ¼”è®²ï¼Ÿï¼ˆwhat is æ¼”è®²ï¼‰  </li><li>ä¸ºä»€ä¹ˆè¦å­¦ä¹ å’Œè®­ç»ƒæ¼”è®²ï¼Ÿï¼ˆwhy æ¼”è®²ï¼‰  </li><li>å¦‚ä½•è®­ç»ƒæ¼”è®²ï¼Ÿï¼ˆhow to æ¼”è®²ï¼‰</li></ol></blockquote><p>å½“ä½ åˆ›å»ºäº†è¿™ä¸ªä¸‰ä¸ªæ–‡ä»¶å¤¹åï¼Œä½ å°±å¯ä»¥æŠŠæ¼”è®²ç›¸å…³çš„æ‰€æœ‰çŸ¥è¯†ç‚¹æŒ‰ç…§é»„é‡‘åœˆåˆ†å‡ºçš„ä¸‰ä¸ªæ–‡ä»¶å¤¹åˆ†åˆ«å½’å±ï¼Œå¦‚æ­¤æ¯ä¸ªæ–‡ä»¶å¤¹å¯¹åº”å•¥å†…å®¹ï¼Œä¸€çœ¼æœ›ç©¿~</p><p>ä½ çœ‹ï¼Œä¸‰ä¸ªæ–‡ä»¶å¤¹è§£å†³ä¸€åˆ‡ï¼Œè€Œä¸”çœ‹èµ·æ¥æ˜¯é‚£ä¹ˆçš„æ¸…æ™°ï¼Œé‚£ä¹ˆçš„ä¸€ç›®äº†ç„¶~~</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/5pBFYTOg6ynuZWw.jpg" alt=""></p><p><strong>2. ç¬”è®°æ–‡ä»¶è§„èŒƒåŒ–å‘½å</strong></p><p>ä¸Šé¢è®²çš„æ˜¯æ–‡ä»¶å¤¹çš„å‘½åæ–¹æ³•ï¼Œè¿™é‡Œåˆ™æ˜¯å…·ä½“åˆ°çš„æŸä¸ªç¬”è®°æ–‡ä»¶å‘½åã€‚</p><p>è¿™é‡Œä¹Ÿæ²¡æœ‰å¤ªå¤šå¯è®²çš„ï¼Œæˆ‘ç»™ä½ åšäº†ä¸€å¼ å›¾ï¼Œæä¾›äº†ä¸€ä¸ªå…¬å¼ï¼Œä½ çœ‹ä¸€çœ¼å°±ç§’æ‡‚äº†ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/WhfLvAFT8E2t6GU.jpg" alt=""></p><p><strong>è§„åˆ™åŒ–å‘½åï¼Œæ•ˆæœç¤ºèŒƒ~~</strong></p><p>ä½ çœ‹ï¼Œè¿™æ ·çš„ç¬”è®°æ ‡é¢˜å‘½åå’Œä¸Šå›¾çš„ä¸¤å°äººé‚£å¼ ç¬”è®°æ ‡é¢˜å‘½åï¼Œé‚£ä¸ªçœ‹èµ·æ¥è®©äººçˆ½ï¼Ÿ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/cM9JvKWDPp3sNAL.jpg" alt=""></p><p><strong>3. æ„ä¹‰ä¸æ˜çš„å±‚ï¼Œåšå†³ä¸è¦ã€‚</strong></p><p>è¿˜æœ‰å¾ˆå¤šåŒå­¦ä¼šå»ºä¸€ä¸ªã€å…¶ä»–ã€çš„æ–‡ä»¶å¤¹ï¼Œè¯·é—®ï¼Œä½ è¿™ä¸ªã€å…¶ä»–ã€æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä½ ä¹‹æ‰€ä»¥å»ºè¿™ä¸ªã€å…¶ä»–ã€å°±æ˜¯å› ä¸ºï¼Œä½ ä¹Ÿæä¸é€šæŸä¸ªç¬”è®°æ–‡ä»¶å±äºé‚£ä¸ªç±»åˆ«äº†ï¼Œä¸å¥½åˆ†ç±»çš„æ‰€å¹¸ä¸€è‚¡è„‘çš„æ‰”åˆ°è¿™é‡Œè¾¹ã€‚</p><p>æˆ‘å‘Šè¯‰ä½ ï¼Œä½ åœ¨ç”¨çš„æ—¶å€™æ˜¯æ ¹æœ¬ä¸ä¼šå»ç¿»ã€å…¶ä»–ã€è¿™ä¸ªåˆ†ç±»çš„ï¼Œå› ä¸ºå®ƒåœ¨ä½ è„‘ä¸­å°±æ²¡æœ‰å•¥æ¦‚å¿µï¼Œä½ éƒ½ä¸çŸ¥é“ä½ æ”¾äº†äº›å•¥ï¼Œåº”è¯¥æ”¾äº›å•¥ï¼Œåˆæ€ä¹ˆèƒ½æŒ‡æœ›æå–çš„æ—¶å€™æ‰¾åˆ°å‘¢ï¼Ÿ</p><p>æ‰€ä»¥ï¼Œè¿™ç§æ„ä¹‰ä¸æ˜çš„å±‚ï¼Œåšå†³ä¸è¦ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/DNhV4jMyrcdHuW2.png" alt=""></p><p>åˆ°äº†è¿™é‡Œï¼Œä½ çŸ¥é“äº†è®©ç¬”è®°è§„çŸ©çš„ä¸‰ä¸ªåŸåˆ™ï¼Œä½†æ˜¯ä»…ä»…çŸ¥é“ä»¥ä¸Šä¸‰ä¸ªåŸåˆ™ï¼Œè¿˜ä¸èƒ½è®©å®ƒä»¬å¾ˆè§„çŸ©ï¼Œæƒ³è¦ä»–ä»¬æ›´è§„çŸ©ä¸€äº›ï¼Œä½ è¿˜éœ€è¦ç¬¬å››ä¸ªåŸåˆ™ã€‚</p><p><strong>â‘£ æ ‡ç­¾åŒ–åŸåˆ™</strong></p><p>ä»€ä¹ˆæ˜¯æ ‡ç­¾åŒ–åŸåˆ™ï¼Ÿä»¥åŠä¸ºä»€ä¹ˆè¦ç”¨æ ‡ç­¾å»ç®¡ç†æˆ‘ä»¬çš„ç¬”è®°ï¼Ÿ</p><p>æˆ‘å…ˆä¸å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œç»™ä½ å‡ºé“å°é¢˜~</p><p>å‡å¦‚è®©ä½ ç»™ä¼Ÿäººå½’ç±»ï¼Œä½ ä¼šæŠŠæ¯›çˆ·çˆ·å½’åˆ°å“ªä¸€ç±»ï¼Ÿ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/P54UKve7nYoxaF9.jpg" alt=""></p><p>ä½ ä¼šæŠŠæ¯›çˆ·çˆ·å½’åˆ°æ”¿æ²»å®¶ï¼Ÿæ€æƒ³å®¶ï¼Ÿå†›äº‹å®¶ï¼Ÿâ€¦â€¦ æŠ±æ­‰ï¼Œè¿™äº›å¤´è¡”æ¯›çˆ·çˆ·éƒ½å äº†~</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/wjNF4pAlCiGRLde.jpg" alt=""></p><p>ä½ çœ‹ï¼Œä½ æ˜¯æ²¡æœ‰åŠæ³•æŠŠä»–æŒ‰å•ä¸€çš„ç»´åº¦å½’ç±»çš„ã€‚</p><p>å¦‚æœä½ å•ä¸€çš„æŠŠæ¯›çˆ·çˆ·å½’åˆ°ä¸€ä¸ªåˆ†ç±»ä¸­ï¼Œæ¯”å¦‚ â€œè¯—äººâ€ï¼Œé‚£ä¹ˆæœç´¢å…¶ä»–åˆ†ç±»ï¼Œå°±æ‰¾ä¸åˆ°æ¯›çˆ·çˆ·äº†ï¼Œé‚£ä½ å°±æŠŠæ¯›çˆ·çˆ·ç»™å®šä½åœ¨æŸä¸ªåˆ†ç±»ä¸­äº†ï¼Œè¿™æ ·åšå°±æ˜¯æœ‰æ¼çš„ï¼ŒåŒç†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸ªæ¡ˆä¾‹~</p><p>ä½ ä¼šæŠŠå‰ä¸¤å¹´å¤§ç«çš„ã€Šæˆ˜ç‹¼ 2ã€‹å½’åˆ°ä»€ä¹ˆåˆ†ç±»ä¸­ï¼Ÿä½ èƒ½å¯¹å®ƒè¿›è¡Œå•ä¸€å½’ç±»å—ï¼Ÿ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/hJG4QNmktdIuPzf.jpg" alt=""></p><p>æˆ‘ä»¬ä¹‹å‰çš„æ–‡ç« ä¸­è®²ç»´åº¦çš„æ—¶å€™å°±å·²ç»è¯´äº†ï¼Œ<strong>ä»»ä½•ä¸€ä»¶äº‹ç‰©éƒ½å¯ä»¥æœ‰å¾ˆå¤šä¸ªç»´åº¦ã€‚</strong>å¦‚æœä½ æŠŠæŸäº‹ç‰©æŒ‰ç…§ä¸€ä¸ªç»´åº¦å½’ç±»ï¼Œä½ å°±ç›¸å½“äºæŠŠå®ƒç»™å®šæ­»äº†ï¼ŒåŒç†æˆ‘ä»¬çš„çŸ¥è¯†ä¾æ—§å¦‚æ­¤ã€‚</p><p><strong>ä½ ç¬”è®°é‡Œçš„çŸ¥è¯†ï¼Œå¤§éƒ¨åˆ†éƒ½è¢«ä½ ç»™å®šæ­»äº†ã€‚</strong></p><p>å¾ˆå¤šäººçš„ç¬”è®°ä¹‹æ‰€ä»¥æ²¡æœ‰æ•ˆç‡ï¼Œç”¨çš„æ—¶å€™æ‰¾ä¸åˆ°ï¼Œå¾ˆå¤§çš„åŸå› å°±æ˜¯ä½ æŠŠçŸ¥è¯†ç»™é™å®šæ­»äº†ã€‚</p><p>æ¯”å¦‚ä½ å­¦åˆ°äº†ä¸€ä¸ªå†™ä½œæŠ€å·§ â€œå¦‚ä½•ç…½æƒ…â€ ï¼Œå¦‚æœä½ å•çº¯çš„æŠŠè¿™ä¸ªæŠ€å·§å½’å…¥åˆ° â€œå†™å°è¯´â€ è¿™ä¸ªåˆ†ç±»ä¸­ï¼Œåªæœ‰å†™å°è¯´çš„æ—¶å€™ï¼Œä½ æ‰ä¼šæƒ³èµ·å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªè¿™ä¸ªçŸ¥è¯†ç‚¹å°±è®©ä½ å­¦æ­»äº†ï¼Œå› ä¸ºè¿™ä¸ªæŠ€å·§å®Œå…¨å¯èƒ½å¥—ç”¨åˆ°å†™æ–‡æ¡ˆï¼Œå†™æŠ¥å‘Šç­‰ç­‰â€¦.</p><p><strong>é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</strong></p><p>è¿™å°±å›ç­”äº†ä¸Šé¢ï¼Œä¸ºä»€ä¹ˆè¦ç”¨æ ‡ç­¾æ¥ç®¡ç†ç¬”è®°äº†çš„é—®é¢˜äº†ã€‚</p><p><strong>æ‰“æ ‡ç­¾å°±æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è®¾ç½®çš„ï¼Œä½ å¯ä»¥ç»™ä¸€ä¸ªçŸ¥è¯†ç‚¹æ‰“ä¸Šæ— æ•°ä¸ªæ ‡ç­¾ï¼Œå½“ä½ æœç´¢ä»»ä½•ä¸€ä¸ªæ ‡ç­¾ç»´åº¦çš„æ—¶å€™éƒ½èƒ½å¤Ÿç´¢å¼•åˆ°è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚</strong></p><p>æ­£å¦‚ä¸Šé¢æ¡ˆä¾‹ä¸­ï¼Œåªè¦ä½ ç»™æ¯›çˆ·çˆ·æ‰“ä¸Šäº†æ ‡ç­¾ï¼Œæ— è®ºä½ æœ XX å®¶ï¼Œéƒ½èƒ½æ‰¾åˆ°æ¯›çˆ·çˆ·ã€‚è€Œã€Šæˆ˜ç‹¼ 2ã€‹ä¸­ä½ æœç´¢å•†ä¸šç‰‡ä¹Ÿèƒ½æ‰¾åˆ°å®ƒï¼Œæœç´¢æˆ˜äº‰ç‰‡ä¹Ÿèƒ½æ‰¾åˆ°å®ƒï¼Œæœç´¢å´äº¬ä¹Ÿèƒ½æ‰¾åˆ°å®ƒâ€¦.</p><p><strong>å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±ä¸ç”¨çº ç»“äºæŸä¸ªçŸ¥è¯†ç‚¹å…·ä½“è¯¥å½’å…¥ã€å‚¨å­˜ä½“ã€çš„é‚£ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæ— è®ºæ˜¯ä½ æ”¾åˆ°é‚£ï¼Œåªè¦æ ‡ç­¾æ‰“ä¸Šäº†ï¼Œå°±ä¸ç”¨æ‹…å¿ƒç´¢å¼•é—®é¢˜ã€‚</strong></p><p>å½“ä½ éƒ¨ç½²äº†ä¸€ç³»åˆ—æ ‡ç­¾çš„æ—¶å€™ï¼Œä½ çš„çŸ¥è¯†å°±æ´»äº†ã€‚</p><blockquote><p>æ¯”å¦‚ï¼šã€è®°å¿†ã€è¿™ä¸ªæ ‡ç­¾ï¼Œå½“ä½ æƒ³è¦è¿™ä¸ªæ ‡ç­¾çš„å†…å®¹çš„æ—¶å€™ï¼Œäº‘ç¬”è®°å°±ä¼šå¸®åŠ©ä½ ï¼ŒæŠŠæ‰€æœ‰è¿™ä¸ªè¢«ä½ æ ‡è®°è¿‡è¿™ä¸ªæ ‡ç­¾çš„æ–‡ç« ç»™æ‰¾å‡ºæ¥ï¼Œæ— è®ºå®ƒæ˜¯ä½ è¿‡å»çš„è¯»ä¹¦ç¬”è®°ï¼Œæˆ–è€…æ˜¯ç”µè§†å‰§çœ‹åˆ°çš„ï¼Œæ¼”è®²å¬åˆ°çš„ï¼Œè¯¾ç¨‹ä¸­å­¦åˆ°çš„ï¼Œæ€»ä¹‹ï¼Œåªè¦åŒ…å«è¿™ä¸ªæ ‡ç­¾çš„ï¼Œä¸€è‚¡è„‘çš„éƒ½ä¼šç»™ä½ æŠ“å‡ºæ¥ï¼Œä¾›ä½ è°ƒé£ä½¿ç”¨â€¦â€¦</p></blockquote><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/N6neIJh19QYZzLl.jpg" alt=""></p><p>ä¸‹é¢ç»™ä½ å±•ç¤ºä¸€ä¸‹ï¼Œ<strong>æˆ‘æ˜¯å¦‚ä½•ç»™ä¸€ä¸ªè¯¾ç¨‹æ‰“æ ‡ç­¾çš„ï¼ï¼ï¼</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/pqxOFNe8ETknfJZ.jpg" alt=""></p><p>å¥½äº† ï¼Œçœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šè¯´ï¼Œå®Œæˆä»¥ä¸Šéƒ¨ç½²ï¼Œç¬”è®°çš„æ•´ä½“æ•ˆç‡æ˜¯é«˜äº†å¾ˆå¤šï¼ŒçŸ¥è¯†ä¹Ÿç»™ç›˜æ´»äº†ï¼Œä½†æ˜¯ä»¥ä¸ŠçŸ¥è¯†ä¹‹é—´ä»ç„¶æ˜¯å‰²è£‚çš„ï¼Œç¬”è®°ä¸ç¬”è®°é—´ä»ç„¶å½¢æˆä¸äº†ä½“ç³»ï¼Œè€Œä¸”ç¬”è®°é‡å’Œæ ‡ç­¾ä¸€å¤šï¼Œæ ‡ç­¾æœ¬èº«ä¹Ÿå°±ä¹±äº†ï¼Œéƒ½ä¸çŸ¥é“æ ‡ç­¾é‚£ä¸ªæ˜¯å“ªä¸ªäº†ï¼Œé‚£å¦‚ä½•è§£å†³è¿™ä¸€ç³»åˆ—é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±è¿›å…¥æœ¬æ–‡çš„æœ€åä¸€ä¸ªæ¨¡å—ï¼Œéƒ¨ç½²ç´¢å¼•ä½“ï¼Œè®©ä½ çš„å¤–è„‘çš„æ•ˆç‡å½»åº•é£èµ·æ¥~~</p><h3 id="å››ï¼šéƒ¨ç½²ç´¢å¼•ä½“ç³»ç»Ÿ"><a href="#å››ï¼šéƒ¨ç½²ç´¢å¼•ä½“ç³»ç»Ÿ" class="headerlink" title="å››ï¼šéƒ¨ç½²ç´¢å¼•ä½“ç³»ç»Ÿ"></a>å››ï¼šéƒ¨ç½²ç´¢å¼•ä½“ç³»ç»Ÿ</h3><h4 id="ä»€ä¹ˆæ˜¯å‚¨å­˜ä½“å’Œç´¢å¼•ä½“ç³»ç»Ÿï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å‚¨å­˜ä½“å’Œç´¢å¼•ä½“ç³»ç»Ÿï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å‚¨å­˜ä½“å’Œç´¢å¼•ä½“ç³»ç»Ÿï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å‚¨å­˜ä½“å’Œç´¢å¼•ä½“ç³»ç»Ÿï¼Ÿ</h4><p>å‚¨å­˜ä½“å°±æ˜¯æˆ‘ä»¬ä»¥ä¸Šå¿™æ´»çš„ï¼Œé‚£éƒ½æ˜¯åœ¨éƒ¨ç½²å‚¨å­˜ä½“çš„ç³»ç»Ÿï¼Œå³åœ¨æ–‡ä»¶å¤¹é‡Œçš„é‚£ä¸€å¥—ã€‚</p><p>æˆ‘ä»¬å‰é¢è¯´äº†ï¼Œæˆ‘ä»¬é€šè¿‡æ ‡ç­¾è°ƒå–ç¬”è®°æˆ–ä¿¡æ¯ï¼Œè€Œç´¢å¼•ä½“ç³»ç»Ÿï¼Œå°±æ˜¯<strong>æŠŠæ ‡ç­¾ä¸æ ‡ç­¾ä¹‹é—´ä¹Ÿå»ºç«‹èµ·é€»è¾‘å…³ç³»ï¼Œå½¢æˆä½“ç³»å’Œç»“æ„ï¼Œæœ€åå†…åŒ–æˆæˆ‘ä»¬çš„çŸ¥è¯†ä½“ç³»ã€‚</strong>  </p><p>ä¸€å¥è¯è§£é‡Šï¼Œå‚¨å­˜ä½“ç”¨äºç®¡ç† â€œæ–‡ä»¶å¤¹çš„ç³»ç»Ÿâ€ï¼Œè€Œç´¢å¼•ä½“åˆ™ç”¨äºç®¡ç† â€œæ ‡ç­¾çš„ç³»ç»Ÿâ€ã€‚</p><p>ä¸ºäº†è®©ä¸¤è€…æ›´æœ‰è¾¨è¯†åº¦ï¼Œæ–‡ä»¶å¤¹ç³»ç»Ÿä½œä¸ºå‚¨å­˜ä½“è¯†åˆ«ç¬¦å·ã€Cã€ï¼Œæ ‡ç­¾ç³»ç»Ÿä½œä¸ºç´¢å¼•ä½“ï¼Œè¯†åˆ«ç¬¦ã€Sã€ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/G1RjTF2hEZAovYB.jpg" alt=""></p><p><strong>2. å¦‚ä½•æ­å»ºç´¢å¼•ä½“ï¼Ÿ</strong></p><p><strong>â‘  åº•å±‚ç³»ç»Ÿæ­å»º</strong>  </p><p>å‚¨å­˜ä½“æœ‰ GTD ä½œä¸ºåº•å±‚æ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆç´¢å¼•ä½“åŒæ ·ä¹Ÿåº”è¯¥æœ‰æ“ä½œç³»ç»Ÿä½œä¸ºåˆ†ç±»ã€‚ç´¢å¼•ä½“çš„åˆ†ç±»è§„åˆ™å°±æ˜¯æˆ‘ä»¬å‰æ–‡è¯´çš„ã€å­¦ä¹ ã€ã€ã€å·¥ä½œã€ã€ã€ç”Ÿæ´»ã€ä¸‰ä¸ªåˆ†ç±»ï¼Œå› ä¸ºä½ ç¬”è®°ä¸Šæ‰€æœ‰çš„ä¸œè¥¿éƒ½é€ƒä¸è¿‡è¿™ä¸‰ç‚¹ï¼Œå®ƒæ˜¯ç¬¦åˆ MECE çš„ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/q4WVghOablC6TLP.jpg" alt=""></p><p>å·¥ä½œå’Œç”Ÿæ´»çš„åˆ†ç±»æˆ‘è¿™é‡Œä¸å¤šä»‹ç»ï¼Œå› ä¸ºè¿™ä¸ªä½“ç³»ä¸ä½“ç³»æ— æ‰€è°“ï¼Œå¤§å®¶æŒ‰ç…§è‡ªå·±çš„å–œå¥½æ‰“æ ‡ç­¾å³å¯ã€‚è¿™é‡Œä¸»è¦ä»‹ç»çš„æ˜¯ã€å­¦ä¹ ã€ï¼Œå› ä¸ºè¿™æ‰æ˜¯æ‰¿è½½æˆ‘ä»¬çŸ¥è¯†æ ‡ç­¾çš„å¤§æœ¬è¥ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„çŸ¥è¯†æ ‡ç­¾éƒ½ä»¥è¿™ä¸ªåˆ†ç±»ä¸ºåº•ã€‚  </p><p>é‚£ä¹ˆåœ¨ã€å­¦ä¹ ã€è¿™ä¸ªåˆ†ç±»åº•ä¸‹ï¼Œåº”è¯¥æ€ä¹ˆå»æ„å»ºçŸ¥è¯†æ¶æ„å‘¢ï¼Ÿ</p><p><strong>â‘¡ ä¸€ä¸ªç»´åº¦åˆ†ç±»æ‰€æœ‰çŸ¥è¯†æ ‡ç­¾</strong>  </p><p>ä½“ç³»çš„æ„æˆä¸€å®šæœ‰åº•å±‚åˆ†ç±»ä½œä¸ºæ”¯æ’‘çš„ï¼Œæ‰€ä»¥æƒ³è¦æŠŠé›¶æ•£çš„æ ‡ç­¾ï¼Œç¼–ç»‡æˆç³»ç»Ÿå°±éœ€è¦å¯¹ä»–ä»¬è¿›è¡Œåˆ†ç±»ï¼Œé‚£ä¹ˆä»ä½œç”¨çš„ç»´åº¦ï¼Œä½ ä¼šæŠŠ â€œæ‰€æœ‰çš„çŸ¥è¯†â€ æ ‡ç­¾åˆ†æˆå“ªå‡ ç±»ï¼Ÿ  </p><p>å¯èƒ½æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„æ ‡å‡†~  </p><p>æˆ‘æœ¬äººæŒ‰ç…§å’Œå‚è€ƒäº† â€œå„’å®¶çš„æœ€é«˜ç†æƒ³â€ æŠŠä¸€ä¸ªäººçš„ä¸€ç”Ÿæ‰€æœ‰çš„çŸ¥è¯†åˆ†æˆäº†å››ç±»ï¼š</p><p>å³ï¼šä¿®èº«çš„çŸ¥è¯†ã€é½å®¶çš„çŸ¥è¯†ã€æ²»å›½çš„çŸ¥è¯†ã€å¹³å¤©ä¸‹çš„çŸ¥è¯†~  </p><p>å“ˆå“ˆï¼Œæ¯”è¾ƒä¸­äºŒï¼Œä¸è¿‡æˆ‘çœ‹ç€å¾ˆé¡ºçœ¼ï¼Œè¿™ä¸ªåˆ†ç±»ä»…ä¾›å‚è€ƒï¼Œå¦‚æœä½ ä¹Ÿè§‰å¾—è¿™ä¸ªç»´åº¦ä¸é”™ï¼Œå¯ä»¥ç›´æ¥æ‹¿å»ç”¨~</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/YHBgFJ3pS2Pi4Ia.jpg" alt=""></p><p>å¥½äº†ï¼Œæœ‰äº†è¿™ä¸ªç»´åº¦ï¼Œä½ å°±å¯ä»¥æŠŠä½ åœ¨å‚¨å­˜ä½“é‡Œæ‰“ä¸Šçš„æ ‡ç­¾ï¼ŒæŒ‰ç…§è¿™å››ä¸ªç»´åº¦ï¼Œåˆ†é—¨åˆ«ç±»çš„æ•´ç†åœ¨è¿™é‡Œè¾¹å³å¯ï¼Œæˆ‘æˆªå–ä¸€æ®µæˆ‘ã€ç´¢å¼•ä½“ã€ç³»ç»Ÿä¸­çš„æ•´ç†æ•ˆæœï¼Œä¾›å¤§å®¶å‚è€ƒ~  </p><p>ä½ å¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“ã€ç´¢å¼•ä½“ã€é€æ¸å®Œå–„ä»¥åï¼Œå®ƒå°±æ˜¯ä¸€å¥—å®Œæ•´ï¼Œæ¸…æ™°çš„çŸ¥è¯†ä½“ç³»~~</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/oakgDsqN6xcyCHm.jpg" alt=""></p><p><strong>â‘¢ åŒºåˆ«ç¬¦å·</strong>  </p><p>ä½ å¯èƒ½çœ‹åˆ°ç´¢å¼•ä½“ä¸­æ¯ä¸ªå¯¹è±¡çš„å‰é¢éƒ½æœ‰ä¸ªç¬¦å·ï¼Œæœ‰çš„ç¬¦å·æ˜¯ã€ # ã€æœ‰çš„ç¬¦å·æ˜¯ã€ - ã€ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>è¿™ä¸¤ä¸ªç¬¦å·æ˜¯åŒºåˆ«ç¬¦å·ï¼Œå‰é¢æœ‰ã€ # ã€çš„ï¼Œè¯´æ˜å®ƒæ˜¯æ ‡ç­¾ã€‚  </p><p>è€Œå‰é¢æœ‰ã€ - ã€çš„è¯´æ˜å®ƒä¸æ˜¯æ ‡ç­¾ï¼Œè¿™äº›ä¸œè¥¿çš„å­˜åœ¨ä»…ä»…æ˜¯ä¸ºäº†è¿æ¥æ ‡ç­¾ï¼ŒæŠŠæ ‡ç­¾ä¸²è”æˆç³»ç»Ÿçš„è¿æ¥ç¬¦å·ï¼Œå¸®åŠ©æˆ‘ä»¬çœ‹çš„æ›´æ¸…æ™°ï¼Œæ›´æœ‰ç»“æ„å’Œå±‚æ¬¡æ„Ÿï¼Œå®ƒä»¬æ˜¯ä¸å‚ä¸ç´¢å¼•çš„ï¼Œå½“ç„¶ã€ - ã€ç¬¦å·ä½ å¯åŠ å¯ä¸åŠ ï¼Œä½†æ˜¯ã€ # ã€è¿™ä¸ªç¬¦å·ï¼Œæˆ‘å»ºè®®ä¸€å®šè¦åŠ ä¸Šï¼ŒåŸå› ä¼šåœ¨ä¸‹é¢è¯´ã€‚</p><p><strong>â‘£ é€šè¿‡ã€ç´¢å¼•ä½“ã€å¿«é€Ÿæå–å†…å®¹</strong>  </p><p>å½“ä¸€åˆ‡éƒ½æ­å»ºå®Œæ¯•ä»¥åï¼Œå‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬æå–ä¸œè¥¿çš„æ—¶å€™äº†ï¼Œä½ å¯ä»¥é€šè¿‡å•å‡»æ ‡ç­¾æå–ï¼Œä½†æ˜¯æˆ‘æœ€å¸¸ç”¨çš„å°±æ˜¯æœç´¢æå–ï¼Œæƒ³è¦å•¥ï¼Œç›´æ¥æœç´¢ï¼Œå¦‚æ¢å›Šå–ç‰©ä¸€æ ·é…¸çˆ½ã€‚</p><p>æ¯”å¦‚ï¼šåœ¨æˆ‘ç¬”è®°ä¸­ï¼Œæˆ‘æœç´¢ã€å†™ä½œã€è¿™ä¸ªæ ‡ç­¾ï¼Œä½ çœ‹~ï¼Œäº‘ç¬”è®°ä¼šæŠŠæˆ‘æ‰“è¿™ä¸ªæ ‡ç­¾çš„æ‰€æœ‰å†…å®¹éƒ½ç»™æˆ‘æ‰¾äº†å‡ºæ¥ã€‚</p><p>æ— è®ºæ˜¯æˆ‘ä¸ªäººçš„éšæ‰‹æ„Ÿæƒ³ã€æˆ‘è¯»ä¹¦çš„ç¬”è®°ï¼Œæˆ–è€…æˆ‘æ”¶é›†åˆ°çš„ä»»ä½•ä¸œè¥¿ï¼Œåªè¦å®ƒæ˜¯åœ¨è¿™ä¸ªæ ‡ç­¾ä¹‹ä¸‹ï¼Œç¬é—´æå–~~</p><p><strong>â‘¤ å¦‚ä½•è®©æå–æ•ˆç‡æ›´é«˜ï¼Ÿ</strong></p><p>æˆ‘ä»¬åœ¨å®é™…çš„æå–ç¬”è®°çš„åœºæ™¯ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜~</p><p>æ¯”å¦‚ä¸€æœ¬ä¹¦çš„è¯»ä¹¦ç¬”è®°ï¼Œå°±åœ¨è¿™ä¸€ç¯‡ç¬”è®°ä¸­ï¼Œå®ƒå°±å¯èƒ½æ¶µç›–æ— æ•°ä¸ªçŸ¥è¯†ç‚¹ï¼Œå³ä½¿æˆ‘ç”¨æ ‡ç­¾å®šä½åˆ°äº†è¿™ç¯‡ç¬”è®°ï¼Œæƒ³è¦æ‰¾åˆ°ç¬”è®°ä¸­çš„æˆ‘æƒ³è¦çš„ä¸œè¥¿ï¼Œä¹Ÿè¦ç¿»çœ‹å¥½ä¹…ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ç¬é—´å°±èƒ½æ‰¾åˆ°æˆ‘æƒ³è¦çš„ä¿¡æ¯çš„æ–¹æ³•å‘¢ï¼Ÿ</p><p>æœ‰çš„ï¼Œ<strong>è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨ç¬”è®°æ–‡ä»¶å†…å¤„å¤„æ‰“æ ‡ç­¾</strong>ï¼Œå¦‚æ­¤å¯ä»¥ç¬é—´æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ã€‚</p><p>æ¯”å¦‚ä¸‹å›¾ï¼Œæˆ‘å°±åœ¨è¿™ä¸ªç¬”è®°çš„æŸä¸€å¤„çš„çŸ¥è¯†ç‚¹ï¼Œæ‰“ä¸Šäº†ä¸‰ä¸ªæ ‡ç­¾ï¼Œå½“æˆ‘éœ€è¦æ‰¾è¿™ä¸‰ä¸ªæ ‡ç­¾ä»»æ„ä¸€ä¸ªçš„æ—¶å€™ï¼Œäº‘ç¬”è®°ä¼šè¿…é€Ÿå¸®æˆ‘æ‰¾åˆ°å®ƒæ‰€åœ¨çš„ä½ç½®ï¼Œå¹¶ä¸”æ‰“ä¸Šé«˜äº®ï¼Œè¿™æ ·æ•´ç¯‡æ–‡ç« éƒ½å˜æˆäº†æˆ‘æ ‡ç­¾ç³»ç»Ÿä¸­çš„ä¸€ä¸ªä¸ªçŸ¥è¯†ç‚¹ï¼Œå®ƒä¸å†å±äºåŸä½œè€…ï¼Œè€Œæ˜¯å±äºæˆ‘ä½“ç³»ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p><p>è¿™å°±å›ç­”äº†ä¸Šé¢æ‰€è¯´çš„ä¸ºä»€ä¹ˆè¦åœ¨æ ‡ç­¾ä¸ŠåŠ ä¸€ä¸ª #ï¼ŒåŸå› å°±åœ¨è¿™ï¼Œå¦‚æœä½ ä¸åŠ è¿™ä¸ªè¯†åˆ«ç¬¦å·ï¼Œæœç´¢åˆ°çš„ä¸œè¥¿å°±ä¼šä¹±ä¸ƒå…«ç³Ÿï¼Œå¼‚å¸¸ç—›è‹¦å•Šï¼Œè¿™æ˜¯å‘ï¼Œæˆ‘å·²ç»æ›¿ä½ ä»¬è¸©è¿‡äº†~</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/8kRTrF2aMSJ1xof.jpg" alt=""></p><p>å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œï¼Œæ•´ç¯‡æ–‡ç« ä¹Ÿåˆ°äº†ç»“å°¾äº†ï¼Œè¿™ä¸ªå‰©ä¸‹çš„ä½ åªéœ€è¦åœ¨ä¸æ–­çš„å­¦ä¹ è¿‡ç¨‹ä¸­å»å®Œå–„å’Œå¡«å……è¿™ä¸ªéª¨æ¶ï¼Œæœ€ç»ˆå®ƒå°±ä¼šå½¢æˆä¸€å¼ åºå¤§çš„çŸ¥è¯†ç»“æ„ç½‘ï¼Œåˆ°æ—¶å€™ä½ å°±ç¥åŠŸå¤§æˆï¼Œå°±å¯ä»¥ä»»æ„çºµæ¨ªäº†ã€‚</p><h4 id="æ‰“é€ å®Œæ¯•åæœ€é‡è¦çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ‰“é€ å®Œæ¯•åæœ€é‡è¦çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ‰“é€ å®Œæ¯•åæœ€é‡è¦çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ‰“é€ å®Œæ¯•åæœ€é‡è¦çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p><strong>1. æŠŠç¬”è®°è½¯ä»¶æœ¬èº«ç©ç†Ÿ</strong></p><p>å› ä¸ºè¿™ç¯‡æ–‡ç« ä¸æ˜¯ä»‹ç»è½¯ä»¶åŠŸèƒ½çš„ï¼Œæ‰€ä»¥å‡ ä¹æ²¡æœ‰æåˆ°è½¯ä»¶æœ¬èº«æä¾›ç»™æˆ‘ä»¬çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ—¥ç¨‹æ¨¡æ¿ã€æ€ç»´å¯¼å›¾ã€ORC ç­‰ç­‰å¤ªå¤šå¤ªå¤šäº†ï¼Œä½ è¦æ˜¯æ‡‚å¾—ç¬”è®°è½¯ä»¶æä¾›ç»™æˆ‘ä»¬çš„å„ç§åŠŸèƒ½ï¼Œé‚£ä¹ˆä½ ä¸€å®šå¯ä»¥ç©çš„éå¸¸ 6ï¼Œè¿™ä¸ªå¤§å®¶è¯·è‡ªè¡Œäº†è§£ï¼Œç½‘ä¸Šæœ‰çš„æ˜¯ä»‹ç»çš„ï¼Œæˆ‘è¿™é‡Œä¸è¿›è¡Œèµ˜è¿°äº†ã€‚</p><p><strong>2. è§„å¾‹æ€§çš„æ¸…ç†æ”¶é›†ç®±</strong></p><p>æ­£å¦‚ä½ è£…ä¿®æˆ¿å­ä¸€æ ·ï¼Œåœ¨è£…ä¿®çš„æ—¶å€™ä½ å¯ä»¥ä¸€æ¬¡æ€§è£…ä¿®çš„ç¾è½®ç¾å¥‚ï¼Œä½†æ˜¯åœ¨ç”Ÿæ´»ä¸­å¦‚æœä½ é‚‹é‚‹é¢é¢ï¼Œè‡­è¢œå­ï¼Œè„ä¸œè¥¿åˆ°å¤„æ‰”ï¼Œå¾ˆå¿«ä½ çš„æ–°æˆ¿å­ä¹Ÿå°±ç ´æ—§äº†ï¼Œæƒ³è¦è®©ä»–ä¸€ç›´ç„•ç„¶ä¸€æ–°ï¼Œé«˜æ•ˆè¿è¡Œï¼Œä½ å°±å¿…é¡»å…»æˆå¹²å‡€ï¼Œå«ç”Ÿï¼Œè‡ªå¾‹çš„ç”Ÿæ´»ä¹ æƒ¯ã€‚</p><p>åŒç†æˆ‘ä»¬çš„ç¬”è®°ç³»ç»Ÿä¾ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿™æ¬¡æ‰“é€ äº†ä¸€å¥—è¶…çº§ç‰›é€¼çš„ç³»ç»Ÿï¼Œä½†æ˜¯å¦‚æœä½ æ”¶é›†åˆ°çš„èµ„æ–™ï¼Œé•¿æœŸå †ç§¯åœ¨æ”¶é›†ç®±ä¸­ä¸å»æ¸…ç†ï¼Œå†…å®¹è¢«åˆ°å¤„å½’ç±»ï¼Œé‚£ä¹ˆè¿™å¥—ç³»ç»Ÿå¾ˆå¿«å°±ä¼šè¢«ä½ ææ®‹ã€‚</p><p>æ‰€ä»¥ä½ çš„ä¹ æƒ¯ï¼Œæ‰æ˜¯ä¿æŒè¿™å¥—ç³»ç»Ÿé«˜æ•ˆè¿è½¬çš„å…³é”®ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p><blockquote><p><strong>æˆ‘ä¸ªäººçš„æ¸…ç†ä¹ æƒ¯æ˜¯ï¼Œæ¯ä¸ªå‘¨æœ«æ‹¿å‡ºå›ºå®šçš„æ—¶é—´ï¼Œæ¸…ç†ä¸€æ¬¡æ”¶é›†ç®±ï¼Œå½“ç„¶å¦‚æœä½ æ¯”æˆ‘å‹¤å¿«ï¼Œä¸”æ—¶é—´å……è£•ï¼Œå®Œå…¨å¯ä»¥ä¸€å¤©ä¸€æ¸…ç†ï¼Œè¿™æ ·è‚¯å®šä¼šæ›´å¥½ã€‚</strong></p></blockquote><p><strong>3. è¿­ä»£å†…å®¹ï¼Œåˆ æ‰è¿‡æ—¶çš„ä¸œè¥¿ï¼Œå¡«å……ç©ºç™½çš„å†…å®¹ã€‚</strong></p><p>åˆšå¼€å§‹å»ºç«‹èµ·ä½ çš„å¤–è„‘çš„æ—¶å€™ï¼Œä¸å¯èƒ½ä¸€ä¸‹å­å°±å»ºæˆç±»ä¼¼æˆ‘å¤–è„‘é‚£æ ·çš„ä¸°å¯Œï¼Œè‚¯å®šä¼šæœ‰å¾ˆå¤šéœ€è¦å®Œå–„çš„åœ°æ–¹ï¼Œä¸æ–­è¿­ä»£ï¼Œæ›´æ–°ï¼Œè¿™æ‰æ˜¯ä½ çš„å¤–è„‘èƒ½æŒç»­è¿è½¬ï¼Œå¹¶ä¸”è¶Šç”¨è¶Šé¡ºæ‰‹çš„æ ¸å¿ƒã€‚</p><p>æœ€åæé†’ä¸€å¥ï¼š<strong>å¤–è„‘è¦æ—¶å¸¸ç¿»é˜…ï¼Œåªæœ‰ä½ æ—¶å¸¸ç¿»é˜…å®ƒï¼Œå®ƒæ‰ä¼šå†…åŒ–åˆ°ä½ çš„å¤§è„‘ä¸­ã€‚</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/MAxE1tm9bngfN3d.jpg" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>ä¸€ï¼šä»€ä¹ˆæ˜¯çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Ÿ</strong></p><blockquote><p>çŸ¥è¯†ç®¡ç†ç³»ç»Ÿå°±æ˜¯æˆ‘ä»¬çš„å¤–è„‘ã€‚</p></blockquote><p><strong>äºŒï¼šä¸ºä»€ä¹ˆè¦æ­å»ºå¤–è„‘ï¼Ÿ</strong></p><blockquote><ol><li>ä¿¡æ¯é‡å¤šäº†ï¼Œæˆ‘ä»¬çš„å¤§è„‘æ˜¯æ— æ³•è®°ä½çš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åˆ«çš„æ–¹å¼è®°ä½å®ƒï¼Œå¹¶ä¸”åœ¨ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥éšæ‰‹æå–ã€‚  </li><li>æ­å»ºå¤–è„‘ï¼Œæœ¬èº«å°±æ˜¯æŠŠé›¶ç¢çš„ä¸œè¥¿ä½“ç³»åŒ–çš„è¿‡ç¨‹ï¼Œå°±æ˜¯æ­å»ºçŸ¥è¯†ä½“ç³»çš„è¿‡ç¨‹ï¼Œå¤§è„‘å–œæ¬¢æœ‰ç»“æ„çš„ä¸œè¥¿ã€‚</li></ol></blockquote><p><strong>ä¸‰ï¼šå¦‚ä½•æ­å»ºå¤–è„‘?</strong></p><p><strong>å¤–è„‘çš„æ„æˆåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºå‚¨å­˜ä½“æ­å»ºï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºç´¢å¼•ä½“æ­å»ºã€‚</strong></p><p><strong>â‘ ï¼šæ­å»ºå‚¨å­˜ä½“</strong></p><blockquote><p><strong>ä»€ä¹ˆæ˜¯å‚¨å­˜ä½“ï¼Ÿ</strong><br>å‚¨å­˜ä½“å°±æ˜¯ç®¡ç†æ–‡ä»¶å¤¹ã€å‚¨å­˜ç¬”è®°çš„ç³»ç»Ÿ<br><strong>å¦‚ä½•æ­å»ºå‚¨å­˜ä½“ï¼Ÿ</strong>  </p><ol><li>ä»¥ GTD ä¿¡æ¯æµä½œä¸ºåº•å±‚ç³»ç»Ÿ  </li><li>è§„åˆ™åŒ–ä¿¡æ¯éœ€è¦éµå¾ªå››å¤§åŸåˆ™ï¼Œå³ï¼š<br>ï¼ˆ1ï¼‰æœ€ç®€å±‚åŸåˆ™<br>ï¼ˆ2ï¼‰ç›®å½•ç¼–ç åŸåˆ™<br>ï¼ˆ3ï¼‰ç»Ÿä¸€å‘½ååŸåˆ™<br>ï¼ˆ4ï¼‰æ ‡ç­¾åŒ–åŸåˆ™</li></ol></blockquote><p><strong>â‘¡ï¼šæ­å»ºç´¢å¼•ä½“</strong></p><blockquote><p><strong>ä»€ä¹ˆæ˜¯ç´¢å¼•ä½“ï¼Ÿ</strong><br>ç´¢å¼•ä½“å°±æ˜¯ç®¡ç†æ ‡ç­¾çš„ç³»ç»Ÿã€‚<br><strong>å¦‚ä½•æ­å»ºç´¢å¼•ä½“ï¼Ÿ</strong>  </p><ol><li>ä»¥ã€å­¦ä¹ ã€ã€ã€å·¥ä½œã€ã€ã€ç”Ÿæ´»ã€ä¸‰åˆ†ç±»ä¸ºåº•å±‚ã€‚  </li><li>ç”¨ä¸€ä¸ªç»´åº¦æ¶µç›–æ‰€æœ‰ã€å­¦ä¹ ã€çš„çŸ¥è¯†æ ‡ç­¾ï¼šä¿®èº«çš„çŸ¥è¯†ã€é½å®¶çš„çŸ¥è¯†ã€æ²»å›½çš„çŸ¥è¯†ã€å¹³å¤©ä¸‹çš„çŸ¥è¯†ã€‚<br><strong>å¦‚ä½•è¿›ä¸€æ­¥æå‡ç´¢å¼•æ•ˆç‡ï¼Ÿ</strong><br>ç¬”è®°å†…å¤„å¤„æ‰“æ ‡ç­¾</li></ol></blockquote><p><strong>ä¸‰ï¼šä¿è¯å¤–è„‘çš„é«˜æ•ˆè¿è½¬</strong></p><blockquote><ol><li>ç©è½¬ç¬”è®°è½¯ä»¶åŠŸèƒ½  </li><li>è§„å¾‹çš„æ¸…ç†æ”¶é›†ç®±  </li><li>ä¸æ–­çš„å¡«å……å®Œå–„ï¼Œè¿­ä»£æ›´æ–°ç¬”è®°ã€‚</li></ol></blockquote><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/T41gLqIiX9AoDrC.jpg" alt=""></p><hr><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="[https://xueshu.baidu.com/usercenter/paper/show?paperid=2d66dce9a805fe0fce1ef025d30889b1&amp;site=xueshu\_se">æ–‡çŒ®åˆ†ç±»æ³•</a></p><p><a href="https://link.zhihu.com/?target=https%3A//wenku.baidu.com/view/a533c6906bec0975f465e272.html">ç¾å›½å›½ä¼šå›¾ä¹¦é¦†åˆ†ç±»æ³•ç®€è¡¨</a></p><p><a href="https://link.zhihu.com/?target=https%3A//www.ixueshu.com/document/c2f1afb362c2fded3ba5746287489d5d318947a18e7f9386.html">ç¾å›½å›½ä¼šå›¾ä¹¦é¦†çš„è®¡ç®—æœºåº”ç”¨ç³»ç»Ÿ</a></p>]]></content>
      
      
      <categories>
          
          <category> æ–¹æ³•è®º </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–¹æ³•è®º </tag>
            
            <tag> çŸ¥è¯†ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿä¸­çš„selectã€pollã€epollæœºåˆ¶</title>
      <link href="/2018/01/29/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8Bselect%E3%80%81poll%E3%80%81epoll%E6%9C%BA%E5%88%B6/"/>
      <url>/2018/01/29/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8Bselect%E3%80%81poll%E3%80%81epoll%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>IOå¤šè·¯å¤ç”¨æ˜¯æŒ‡å†…æ ¸ä¸€æ—¦å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªIOæ¡ä»¶å‡†å¤‡è¯»å–ï¼Œå®ƒå°±é€šçŸ¥è¯¥è¿›ç¨‹ã€‚ä¸å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ç›¸æ¯”ï¼ŒI/Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ç³»ç»Ÿå¼€é”€å°ï¼Œç³»ç»Ÿä¸å¿…åˆ›å»ºè¿›ç¨‹/çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›è¿›ç¨‹/çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€é”€ã€‚</p><p>ç›®å‰æ”¯æŒI/Oå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰ selectï¼Œpselectï¼Œpollï¼Œepollï¼ŒI/Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼Œä½†selectï¼Œpselectï¼Œpollï¼Œepollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œè€Œå¼‚æ­¥I/Oåˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥I/Oçš„å®ç°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><a id="more"></a><p>IOå¤šè·¯å¤ç”¨é€‚ç”¨å¦‚ä¸‹åœºåˆï¼š</p><ol><li>å½“å®¢æˆ·å¤„ç†å¤šä¸ªæè¿°ç¬¦æ—¶ï¼ˆä¸€èˆ¬æ˜¯äº¤äº’å¼è¾“å…¥å’Œç½‘ç»œå¥—æ¥å£ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨I/Oå¤ç”¨ã€‚</li><li>å½“ä¸€ä¸ªå®¢æˆ·åŒæ—¶å¤„ç†å¤šä¸ªå¥—æ¥å£æ—¶ï¼Œè€Œè¿™ç§æƒ…å†µæ˜¯å¯èƒ½çš„ï¼Œä½†å¾ˆå°‘å‡ºç°ã€‚</li><li>å¦‚æœä¸€ä¸ªTCPæœåŠ¡å™¨æ—¢è¦å¤„ç†ç›‘å¬å¥—æ¥å£ï¼Œåˆè¦å¤„ç†å·²è¿æ¥å¥—æ¥å£ï¼Œä¸€èˆ¬ä¹Ÿè¦ç”¨åˆ°I/Oå¤ç”¨ã€‚</li><li>å¦‚æœä¸€ä¸ªæœåŠ¡å™¨å³è¦å¤„ç†TCPï¼Œåˆè¦å¤„ç†UDPï¼Œä¸€èˆ¬è¦ä½¿ç”¨I/Oå¤ç”¨ã€‚</li><li>å¦‚æœä¸€ä¸ªæœåŠ¡å™¨è¦å¤„ç†å¤šä¸ªæœåŠ¡æˆ–å¤šä¸ªåè®®ï¼Œä¸€èˆ¬è¦ä½¿ç”¨I/Oå¤ç”¨ã€‚</li></ol><h2 id="ä»C10kå¼•è¿°selectã€pollã€epoll"><a href="#ä»C10kå¼•è¿°selectã€pollã€epoll" class="headerlink" title="ä»C10kå¼•è¿°selectã€pollã€epoll"></a>ä»C10kå¼•è¿°selectã€pollã€epoll</h2><h3 id="C10ké—®é¢˜"><a href="#C10ké—®é¢˜" class="headerlink" title="C10ké—®é¢˜"></a>C10ké—®é¢˜</h3><p>éšç€äº’è”ç½‘çš„æ™®åŠï¼Œåº”ç”¨çš„ç”¨æˆ·ç¾¤ä½“å‡ ä½•å€å¢é•¿ï¼Œæ­¤æ—¶æœåŠ¡å™¨æ€§èƒ½é—®é¢˜å°±å‡ºç°ã€‚æœ€åˆçš„æœåŠ¡å™¨æ˜¯åŸºäºè¿›ç¨‹/çº¿ç¨‹æ¨¡å‹ã€‚æ–°åˆ°æ¥ä¸€ä¸ªTCPè¿æ¥ï¼Œå°±éœ€è¦åˆ†é…ä¸€ä¸ªè¿›ç¨‹ã€‚å‡å¦‚æœ‰C10Kï¼Œå°±éœ€è¦åˆ›å»º1Wä¸ªè¿›ç¨‹ï¼Œå¯æƒ³è€ŒçŸ¥å•æœºæ˜¯æ— æ³•æ‰¿å—çš„ã€‚é‚£ä¹ˆå¦‚ä½•çªç ´å•æœºæ€§èƒ½æ˜¯é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹å¿…é¡»è¦é¢å¯¹çš„é—®é¢˜ï¼Œè¿›è€Œè¿™äº›å±€é™å’Œé—®é¢˜å°±ç»Ÿç§°ä¸ºC10Ké—®é¢˜ï¼Œæœ€æ—©æ˜¯ç”±Dan Kegelè¿›è¡Œå½’çº³å’Œæ€»ç»“çš„ï¼Œå¹¶ä¸”ä»–ä¹Ÿç³»ç»Ÿçš„åˆ†æå’Œæå‡ºè§£å†³æ–¹æ¡ˆã€‚</p><p>C10Ké—®é¢˜çš„æœ¬è´¨ä¸Šæ˜¯æ“ä½œç³»ç»Ÿçš„é—®é¢˜ã€‚å¯¹äºWeb 1.0/2.0æ—¶ä»£çš„æ“ä½œç³»ç»Ÿï¼Œä¼ ç»Ÿçš„åŒæ­¥é˜»å¡I/Oæ¨¡å‹å¤„ç†æ–¹å¼éƒ½æ˜¯requests per secondã€‚å½“åˆ›å»ºçš„è¿›ç¨‹æˆ–çº¿ç¨‹å¤šäº†ï¼Œæ•°æ®æ‹·è´é¢‘ç¹ï¼ˆç¼“å­˜I/Oã€å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ç©ºé—´ã€é˜»å¡ï¼Œè¿›ç¨‹/çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—å¤§ï¼Œ å¯¼è‡´æ“ä½œç³»ç»Ÿå´©æºƒï¼Œè¿™å°±æ˜¯C10Ké—®é¢˜çš„æœ¬è´¨ã€‚</p><p>å¯è§, è§£å†³C10Ké—®é¢˜çš„å…³é”®å°±æ˜¯å°½å¯èƒ½å‡å°‘è¿™äº›CPUèµ„æºæ¶ˆè€—ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ä»ç½‘ç»œç¼–ç¨‹æŠ€æœ¯çš„è§’åº¦æ¥è¯´ï¼Œä¸»è¦æ€è·¯ï¼š</p><ol><li>æ¯ä¸ªè¿æ¥åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹/è¿›ç¨‹</li><li>åŒä¸€ä¸ªçº¿ç¨‹/è¿›ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥</li></ol><h4 id="æ¯ä¸ªè¿›ç¨‹-çº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥"><a href="#æ¯ä¸ªè¿›ç¨‹-çº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥" class="headerlink" title="æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥"></a>æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥</h4><p>è¯¥æ€è·¯æœ€ä¸ºç›´æ¥ï¼Œä½†æ˜¯ç”³è¯·è¿›ç¨‹/çº¿ç¨‹æ˜¯éœ€è¦ç³»ç»Ÿèµ„æºçš„ï¼Œä¸”ç³»ç»Ÿéœ€è¦ç®¡ç†è¿™äº›è¿›ç¨‹/çº¿ç¨‹ï¼Œæ‰€ä»¥ä¼šä½¿èµ„æºå ç”¨è¿‡å¤šï¼Œå¯æ‰©å±•æ€§å·®</p><h4 id="æ¯ä¸ªè¿›ç¨‹-çº¿ç¨‹åŒæ—¶å¤„ç†-å¤šä¸ªè¿æ¥-I-Oå¤šè·¯å¤ç”¨"><a href="#æ¯ä¸ªè¿›ç¨‹-çº¿ç¨‹åŒæ—¶å¤„ç†-å¤šä¸ªè¿æ¥-I-Oå¤šè·¯å¤ç”¨" class="headerlink" title="æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹åŒæ—¶å¤„ç† å¤šä¸ªè¿æ¥(I/Oå¤šè·¯å¤ç”¨)"></a>æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹åŒæ—¶å¤„ç† å¤šä¸ªè¿æ¥(I/Oå¤šè·¯å¤ç”¨)</h4><ol><li><strong>selectæ–¹å¼</strong>ï¼šä½¿ç”¨fd_setç»“æ„ä½“å‘Šè¯‰å†…æ ¸åŒæ—¶ç›‘æ§é‚£äº›æ–‡ä»¶å¥æŸ„ï¼Œä½¿ç”¨é€ä¸ªæ’æŸ¥æ–¹å¼å»æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å¥æŸ„å°±ç»ªæˆ–è€…è¶…æ—¶ã€‚è¯¥æ–¹å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼šæ–‡ä»¶å¥æŸ„æ•°é‡æ˜¯æœ‰ä¸Šçº¿çš„ï¼Œé€ä¸ªæ£€æŸ¥ååé‡ä½ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¦é‡å¤åˆå§‹åŒ–fd_setã€‚</li><li><strong>pollæ–¹å¼</strong>ï¼šè¯¥æ–¹å¼ä¸»è¦è§£å†³äº†selectæ–¹å¼çš„2ä¸ªç¼ºç‚¹ï¼Œæ–‡ä»¶å¥æŸ„ä¸Šé™é—®é¢˜(é“¾è¡¨æ–¹å¼å­˜å‚¨)ä»¥åŠé‡å¤åˆå§‹åŒ–é—®é¢˜(ä¸åŒå­—æ®µæ ‡æ³¨å…³æ³¨äº‹ä»¶å’Œå‘ç”Ÿäº‹ä»¶)ï¼Œä½†æ˜¯é€ä¸ªå»æ£€æŸ¥æ–‡ä»¶å¥æŸ„æ˜¯å¦å°±ç»ªçš„é—®é¢˜ä»ç„¶æ²¡æœ‰è§£å†³ã€‚</li><li><strong>epollæ–¹å¼</strong>ï¼šè¯¥æ–¹å¼å¯ä»¥è¯´æ˜¯C10Ké—®é¢˜çš„killerï¼Œä»–ä¸å»è½®è¯¢ç›‘å¬æ‰€æœ‰æ–‡ä»¶å¥æŸ„æ˜¯å¦å·²ç»å°±ç»ªã€‚epollåªå¯¹å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶å¥æŸ„æ„Ÿå…´è¶£ã€‚å…¶å·¥ä½œæœºåˆ¶æ˜¯ï¼Œä½¿ç”¨â€äº‹ä»¶â€çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡epoll_ctlæ³¨å†Œæ–‡ä»¶æè¿°ç¬¦fdï¼Œä¸€æ—¦è¯¥fdå°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥fd, epoll_waitä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥, å¹¶é€šçŸ¥åº”ç”¨ç¨‹åºã€‚è€Œä¸”epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦,å°†ç”¨æˆ·è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­, è¿™æ ·æ•°æ®åªéœ€è¦ä»å†…æ ¸ç¼“å­˜ç©ºé—´æ‹·è´ä¸€æ¬¡åˆ°ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´ã€‚è€Œä¸”epollæ˜¯é€šè¿‡å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜æ–¹å¼æ¥å®ç°äº‹ä»¶å°±ç»ªæ¶ˆæ¯ä¼ é€’çš„ï¼Œå…¶æ•ˆç‡éå¸¸é«˜ã€‚ä½†æ˜¯epollæ˜¯ä¾èµ–ç³»ç»Ÿçš„(Linux)ã€‚</li><li><strong>å¼‚æ­¥I/O</strong>ä»¥åŠWindowsï¼Œè¯¥æ–¹å¼åœ¨windowsä¸Šæ”¯æŒå¾ˆå¥½ã€‚</li></ol><h4 id="ä¼ ç»Ÿæ€è·¯"><a href="#ä¼ ç»Ÿæ€è·¯" class="headerlink" title="ä¼ ç»Ÿæ€è·¯"></a>ä¼ ç»Ÿæ€è·¯</h4><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å¾ªç¯æŒ¨ä¸ªå¤„ç†å„ä¸ªè¿æ¥ï¼Œæ¯ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ª socketï¼Œå½“æ‰€æœ‰ socket éƒ½æœ‰æ•°æ®çš„æ—¶å€™ï¼Œè¿™ç§æ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p><p>ä½†æ˜¯å½“åº”ç”¨è¯»å–æŸä¸ª socket çš„æ–‡ä»¶æ•°æ®ä¸ ready çš„æ—¶å€™ï¼Œæ•´ä¸ªåº”ç”¨ä¼šé˜»å¡åœ¨è¿™é‡Œç­‰å¾…è¯¥æ–‡ä»¶å¥æŸ„ï¼Œå³ä½¿åˆ«çš„æ–‡ä»¶å¥æŸ„ readyï¼Œä¹Ÿæ— æ³•å¾€ä¸‹å¤„ç†ã€‚</p><p><strong>æ€è·¯</strong>ï¼šç›´æ¥å¾ªç¯å¤„ç†å¤šä¸ªè¿æ¥ã€‚</p><p><strong>é—®é¢˜</strong>ï¼šä»»ä¸€æ–‡ä»¶å¥æŸ„çš„ä¸æˆåŠŸä¼šé˜»å¡ä½æ•´ä¸ªåº”ç”¨ã€‚</p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>è¦è§£å†³ä¸Šé¢é˜»å¡çš„é—®é¢˜ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œå¦‚æœæˆ‘åœ¨è¯»å–æ–‡ä»¶å¥æŸ„ä¹‹å‰ï¼Œå…ˆæŸ¥ä¸‹å®ƒçš„çŠ¶æ€ï¼Œready äº†å°±è¿›è¡Œå¤„ç†ï¼Œä¸ ready å°±ä¸è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜äº†å˜›ï¼Ÿ</p><p>äºæ˜¯æœ‰äº† select æ–¹æ¡ˆã€‚ç”¨ä¸€ä¸ª fd_set ç»“æ„ä½“æ¥å‘Šè¯‰å†…æ ¸åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶å¥æŸ„ï¼Œå½“å…¶ä¸­æœ‰æ–‡ä»¶å¥æŸ„çš„çŠ¶æ€å‘ç”ŸæŒ‡å®šå˜åŒ–ï¼ˆä¾‹å¦‚æŸå¥æŸ„ç”±ä¸å¯ç”¨å˜ä¸ºå¯ç”¨ï¼‰æˆ–è¶…æ—¶ï¼Œåˆ™è°ƒç”¨è¿”å›ã€‚ä¹‹ååº”ç”¨å¯ä»¥ä½¿ç”¨ <code>FD_ISSET</code> æ¥é€ä¸ªæŸ¥çœ‹æ˜¯å“ªä¸ªæ–‡ä»¶å¥æŸ„çš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>è¿™æ ·åšï¼Œå°è§„æ¨¡çš„è¿æ¥é—®é¢˜ä¸å¤§ï¼Œä½†å½“è¿æ¥æ•°å¾ˆå¤šï¼ˆæ–‡ä»¶å¥æŸ„ä¸ªæ•°å¾ˆå¤šï¼‰çš„æ—¶å€™ï¼Œé€ä¸ªæ£€æŸ¥çŠ¶æ€å°±å¾ˆæ…¢äº†ã€‚å› æ­¤ï¼Œselect å¾€å¾€å­˜åœ¨ç®¡ç†çš„å¥æŸ„ä¸Šé™ï¼ˆ<code>FD_SETSIZE</code>ï¼‰ã€‚åŒæ—¶ï¼Œåœ¨ä½¿ç”¨ä¸Šï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå­—æ®µè®°å½•å…³æ³¨å’Œå‘ç”Ÿäº‹ä»¶ï¼Œæ¯æ¬¡è°ƒç”¨ä¹‹å‰è¦é‡æ–°åˆå§‹åŒ– <code>fd_set</code> ç»“æ„ä½“ã€‚</p><blockquote><p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p></blockquote><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/ubzW8CDimwPQrA4.png" alt="21155028_QOj2"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(<span class="keyword">int</span> nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong>ï¼šæœ‰è¿æ¥è¯·æ±‚æŠµè¾¾äº†å†æ£€æŸ¥å¤„ç†ã€‚</p><p><strong>é—®é¢˜</strong>ï¼šå¥æŸ„ä¸Šé™+é‡å¤åˆå§‹åŒ–+é€ä¸ªæ’æŸ¥æ‰€æœ‰æ–‡ä»¶å¥æŸ„çŠ¶æ€æ•ˆç‡ä¸é«˜ã€‚</p><h4 id="å·¥ä½œè¿‡ç¨‹"><a href="#å·¥ä½œè¿‡ç¨‹" class="headerlink" title="å·¥ä½œè¿‡ç¨‹"></a>å·¥ä½œè¿‡ç¨‹</h4><p>ä¸€ä¸ªå…¸å‹çš„ç”¨æˆ·åº”ç”¨è°ƒç”¨selectæœºåˆ¶è¯·æ±‚æ•°æ®è¿‡ç¨‹ï¼š</p><ol><li><p>ä½¿ç”¨<code>copy_from_user</code>ä»ç”¨æˆ·ç©ºé—´æ‹·è´fd_setåˆ°å†…æ ¸ç©ºé—´</p></li><li><p>æ³¨å†Œå›è°ƒå‡½æ•°<code>__pollwait</code></p></li><li><p>éå†æ‰€æœ‰fdï¼Œè°ƒç”¨å…¶å¯¹åº”çš„pollæ–¹æ³•ï¼ˆå¯¹äºsocketï¼Œè¿™ä¸ªpollæ–¹æ³•æ˜¯<code>sock_poll</code>ï¼Œ<code>sock_poll</code>æ ¹æ®æƒ…å†µä¼šè°ƒç”¨åˆ°<code>tcp_poll</code>,<code>udp_poll</code>æˆ–è€…<code>datagram_poll</code>ï¼‰</p></li><li><p>ä»¥<code>tcp_poll</code>ä¸ºä¾‹ï¼Œå…¶æ ¸å¿ƒå®ç°å°±æ˜¯<code>__pollwait</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ³¨å†Œçš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p><code>__pollwait</code>çš„ä¸»è¦å·¥ä½œå°±æ˜¯æŠŠcurrentï¼ˆå½“å‰è¿›ç¨‹ï¼‰æŒ‚åˆ°è®¾å¤‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œä¸åŒçš„è®¾å¤‡æœ‰ä¸åŒçš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå¯¹äºtcp_pollæ¥è¯´ï¼Œå…¶ç­‰å¾…é˜Ÿåˆ—æ˜¯sk-&gt;sk_sleepï¼ˆæ³¨æ„æŠŠè¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å¹¶ä¸ä»£è¡¨è¿›ç¨‹å·²ç»ç¡çœ äº†ï¼‰ã€‚åœ¨è®¾å¤‡æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼ˆç½‘ç»œè®¾å¤‡ï¼‰æˆ–å¡«å†™å®Œæ–‡ä»¶æ•°æ®ï¼ˆç£ç›˜è®¾å¤‡ï¼‰åï¼Œä¼šå”¤é†’è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸Šç¡çœ çš„è¿›ç¨‹ï¼Œè¿™æ—¶currentä¾¿è¢«å”¤é†’äº†ã€‚</p></li><li><p><code>poll</code>æ–¹æ³•è¿”å›æ—¶ä¼šè¿”å›ä¸€ä¸ªæè¿°è¯»å†™æ“ä½œæ˜¯å¦å°±ç»ªçš„maskæ©ç ï¼Œæ ¹æ®è¿™ä¸ªmaskæ©ç ç»™fd_setèµ‹å€¼ã€‚</p></li><li><p>å¦‚æœéå†å®Œæ‰€æœ‰çš„fdï¼Œè¿˜æ²¡æœ‰è¿”å›ä¸€ä¸ªå¯è¯»å†™çš„maskæ©ç ï¼Œåˆ™ä¼šè°ƒç”¨schedule_timeoutæ˜¯è°ƒç”¨selectçš„è¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯currentï¼‰è¿›å…¥ç¡çœ ã€‚å½“è®¾å¤‡é©±åŠ¨å‘ç”Ÿè‡ªèº«èµ„æºå¯è¯»å†™åï¼Œä¼šå”¤é†’å…¶ç­‰å¾…é˜Ÿåˆ—ä¸Šç¡çœ çš„è¿›ç¨‹ã€‚å¦‚æœè¶…è¿‡ä¸€å®šçš„è¶…æ—¶æ—¶é—´ï¼ˆ<code>schedule_timeout</code>æŒ‡å®šï¼‰ï¼Œè¿˜æ˜¯æ²¡äººå”¤é†’ï¼Œåˆ™è°ƒç”¨selectçš„è¿›ç¨‹ä¼šé‡æ–°è¢«å”¤é†’è·å¾—CPUï¼Œè¿›è€Œé‡æ–°éå†fdï¼Œåˆ¤æ–­æœ‰æ²¡æœ‰å°±ç»ªçš„fdã€‚</p></li><li><p>æŠŠ<code>fd_set</code>ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p></li></ol><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/29/JWBwCQ1XHP8mpld.png" alt="137084-20180611142415772-1018872947"></p><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><p>poll ä¸»è¦è§£å†³ select çš„å‰ä¸¤ä¸ªé—®é¢˜ï¼šé€šè¿‡ä¸€ä¸ª pollfd æ•°ç»„å‘å†…æ ¸ä¼ é€’éœ€è¦å…³æ³¨çš„äº‹ä»¶æ¶ˆé™¤æ–‡ä»¶å¥æŸ„ä¸Šé™ï¼ŒåŒæ—¶ä½¿ç”¨ä¸åŒå­—æ®µåˆ†åˆ«æ ‡æ³¨å…³æ³¨äº‹ä»¶å’Œå‘ç”Ÿäº‹ä»¶ï¼Œæ¥é¿å…é‡å¤åˆå§‹åŒ–ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">poll</span><span class="params">(struct pollfd *fds, <span class="keyword">nfds_t</span> nfds, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong>ï¼šè®¾è®¡æ–°çš„æ•°æ®ç»“æ„æä¾›ä½¿ç”¨æ•ˆç‡ã€‚</p><p><strong>é—®é¢˜</strong>ï¼šé€ä¸ªæ’æŸ¥æ‰€æœ‰æ–‡ä»¶å¥æŸ„çŠ¶æ€æ•ˆç‡ä¸é«˜ã€‚</p><h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><p>æ—¢ç„¶é€ä¸ªæ’æŸ¥æ‰€æœ‰æ–‡ä»¶å¥æŸ„çŠ¶æ€æ•ˆç‡ä¸é«˜ï¼Œå¾ˆè‡ªç„¶çš„ï¼Œå¦‚æœè°ƒç”¨è¿”å›çš„æ—¶å€™åªç»™åº”ç”¨æä¾›å‘ç”Ÿäº†çŠ¶æ€å˜åŒ–ï¼ˆå¾ˆå¯èƒ½æ˜¯æ•°æ® readyï¼‰çš„æ–‡ä»¶å¥æŸ„ï¼Œè¿›è¡Œæ’æŸ¥çš„æ•ˆç‡ä¸å°±é«˜å¤šäº†ä¹ˆã€‚</p><p>epoll é‡‡ç”¨äº†è¿™ç§è®¾è®¡ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„åº”ç”¨åœºæ™¯ã€‚</p><p>å®éªŒè¡¨æ˜ï¼Œå½“æ–‡ä»¶å¥æŸ„æ•°ç›®è¶…è¿‡ 10 ä¹‹åï¼Œepoll æ€§èƒ½å°†ä¼˜äº select å’Œ pollï¼›å½“æ–‡ä»¶å¥æŸ„æ•°ç›®è¾¾åˆ° 10K çš„æ—¶å€™ï¼Œepoll å·²ç»è¶…è¿‡ select å’Œ poll ä¸¤ä¸ªæ•°é‡çº§ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event *events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong>ï¼šåªè¿”å›çŠ¶æ€å˜åŒ–çš„æ–‡ä»¶å¥æŸ„ã€‚</p><p><strong>é—®é¢˜</strong>ï¼šä¾èµ–ç‰¹å®šå¹³å°ï¼ˆLinuxï¼‰ã€‚</p><p>å› ä¸ºLinuxæ˜¯äº’è”ç½‘ä¼ä¸šä¸­ä½¿ç”¨ç‡æœ€é«˜çš„æ“ä½œç³»ç»Ÿï¼Œepollå°±æˆä¸ºC10K killerã€é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€å¼‚æ­¥éé˜»å¡è¿™äº›æŠ€æœ¯çš„ä»£åè¯äº†ã€‚FreeBSDæ¨å‡ºäº†<code>kqueue</code>ï¼ŒLinuxæ¨å‡ºäº†<code>epoll</code>ï¼ŒWindowsæ¨å‡ºäº†<code>IOCP</code>ï¼ŒSolarisæ¨å‡ºäº†<code>/dev/poll</code>ã€‚è¿™äº›æ“ä½œç³»ç»Ÿæä¾›çš„åŠŸèƒ½å°±æ˜¯ä¸ºäº†è§£å†³C10Ké—®é¢˜ã€‚epollæŠ€æœ¯çš„ç¼–ç¨‹æ¨¡å‹å°±æ˜¯å¼‚æ­¥éé˜»å¡å›è°ƒï¼Œä¹Ÿå¯ä»¥å«åš<code>Reactor</code>ï¼Œäº‹ä»¶é©±åŠ¨ï¼Œäº‹ä»¶è½®å¾ªï¼ˆEventLoopï¼‰ã€‚Nginxï¼Œlibeventï¼Œnode.jsè¿™äº›å°±æ˜¯Epollæ—¶ä»£çš„äº§ç‰©ã€‚</p><h3 id="libevent"><a href="#libevent" class="headerlink" title="libevent"></a>libevent</h3><p>ç”±äºepoll, kqueue, IOCPæ¯ä¸ªæ¥å£éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œç¨‹åºç§»æ¤éå¸¸å›°éš¾ï¼Œäºæ˜¯éœ€è¦å¯¹è¿™äº›æ¥å£è¿›è¡Œå°è£…ï¼Œä»¥è®©å®ƒä»¬æ˜“äºä½¿ç”¨å’Œç§»æ¤ï¼Œå…¶ä¸­libeventåº“å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚è·¨å¹³å°ï¼Œå°è£…åº•å±‚å¹³å°çš„è°ƒç”¨ï¼Œæä¾›ç»Ÿä¸€çš„ APIï¼Œä½†åº•å±‚åœ¨ä¸åŒå¹³å°ä¸Šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„è°ƒç”¨ã€‚</p><p>æŒ‰ç…§libeventçš„å®˜æ–¹ç½‘ç«™ï¼Œlibeventåº“æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼šå½“ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ç‰¹å®šäº‹ä»¶ï¼ˆå¦‚å¯è¯»ï¼Œå¯å†™æˆ–å‡ºé”™ï¼‰å‘ç”Ÿäº†ï¼Œæˆ–ä¸€ä¸ªå®šæ—¶äº‹ä»¶å‘ç”Ÿäº†ï¼Œlibeventå°±ä¼šè‡ªåŠ¨æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œæ¥å¤„ç†äº‹ä»¶ã€‚ç›®å‰ï¼Œlibeventå·²æ”¯æŒä»¥ä¸‹æ¥å£/dev/poll, kqueue, event ports, select, poll å’Œ epollã€‚Libeventçš„å†…éƒ¨äº‹ä»¶æœºåˆ¶å®Œå…¨æ˜¯åŸºäºæ‰€ä½¿ç”¨çš„æ¥å£çš„ã€‚å› æ­¤libeventéå¸¸å®¹æ˜“ç§»æ¤ï¼Œä¹Ÿä½¿å®ƒçš„æ‰©å±•æ€§éå¸¸å®¹æ˜“ã€‚ç›®å‰ï¼Œlibeventå·²åœ¨ä»¥ä¸‹æ“ä½œç³»ç»Ÿä¸­ç¼–è¯‘é€šè¿‡ï¼šLinuxï¼ŒBSDï¼ŒMac OS Xï¼ŒSolariså’ŒWindowsã€‚</p><p>ä½¿ç”¨libeventåº“è¿›è¡Œå¼€å‘éå¸¸ç®€å•ï¼Œä¹Ÿå¾ˆå®¹æ˜“åœ¨å„ç§unixå¹³å°ä¸Šç§»æ¤ã€‚ä¸€ä¸ªç®€å•çš„ä½¿ç”¨libeventåº“çš„ç¨‹åºå¦‚ä¸‹ï¼š</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> I/O </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–ç¨‹ä¹‹å¹¶å‘ç¼–ç¨‹</title>
      <link href="/2018/01/28/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
      <url>/2018/01/28/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>åœ¨è®¡ç®—æœºæœ€æ—©æœŸçš„æ—¶å€™ï¼Œæ²¡æœ‰æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œç¨‹åºåªéœ€è¦ä¸€ç§æ–¹å¼ï¼Œé‚£å°±æ˜¯ä»å¤´åˆ°å°¾ä¾æ¬¡æ‰§è¡Œã€‚ä»»ä½•èµ„æºéƒ½ä¼šä¸ºè¿™ä¸ªç¨‹åºæœåŠ¡ï¼Œåœ¨è®¡ç®—æœºä½¿ç”¨æŸäº›èµ„æºæ—¶ï¼Œå…¶ä»–èµ„æºå°±ä¼šç©ºé—²ï¼Œå°±ä¼šå­˜åœ¨ <code>æµªè´¹èµ„æº</code> çš„æƒ…å†µã€‚</p><p>æ“ä½œç³»ç»Ÿçš„å‡ºç°ä¸ºæˆ‘ä»¬çš„ç¨‹åºå¸¦æ¥äº† <code>å¹¶å‘æ€§</code>ï¼Œæ“ä½œç³»ç»Ÿä½¿æˆ‘ä»¬çš„ç¨‹åºèƒ½å¤ŸåŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºï¼Œä¸€ä¸ªç¨‹åºå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¹Ÿå°±ç›¸å½“äºåŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚</p><a id="more"></a><h2 id="æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§"><a href="#æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§"></a>æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§</h2><p>æ“ä½œç³»ç»Ÿæ˜¯ä¸€ä¸ª<code>å¹¶å‘ç³»ç»Ÿ</code>ï¼Œå¹¶å‘æ€§æ˜¯æ“ä½œç³»ç»Ÿéå¸¸é‡è¦çš„ç‰¹å¾ï¼Œæ“ä½œç³»ç»Ÿå…·æœ‰åŒæ—¶å¤„ç†å’Œè°ƒåº¦å¤šä¸ªç¨‹åºçš„èƒ½åŠ›ï¼Œæ¯”å¦‚å¤šä¸ª I/O è®¾å¤‡åŒæ—¶åœ¨è¾“å…¥è¾“å‡ºï¼›è®¾å¤‡ I/O å’Œ CPU è®¡ç®—åŒæ—¶è¿›è¡Œï¼›å†…å­˜ä¸­åŒæ—¶æœ‰å¤šä¸ªç³»ç»Ÿå’Œç”¨æˆ·ç¨‹åºè¢«å¯åŠ¨äº¤æ›¿ã€ç©¿æ’åœ°æ‰§è¡Œã€‚æ“ä½œç³»ç»Ÿåœ¨åè°ƒå’Œåˆ†é…è¿›ç¨‹çš„åŒæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šä¸ºä¸åŒè¿›ç¨‹åˆ†é…ä¸åŒçš„èµ„æºã€‚</p><p>æ“ä½œç³»ç»Ÿå®ç°å¤šä¸ªç¨‹åºåŒæ—¶è¿è¡Œè§£å†³äº†å•ä¸ªç¨‹åºæ— æ³•åšåˆ°çš„é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸‰ç‚¹</p><ul><li><code>èµ„æºåˆ©ç”¨ç‡</code>ï¼Œæˆ‘ä»¬ä¸Šé¢è¯´åˆ°ï¼Œå•ä¸ªè¿›ç¨‹å­˜åœ¨èµ„æºæµªè´¹çš„æƒ…å†µï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨ä¸ºæŸä¸ªæ–‡ä»¶å¤¹èµ‹äºˆæƒé™çš„æ—¶å€™ï¼Œè¾“å…¥ç¨‹åºæ— æ³•æ¥å—å¤–éƒ¨çš„è¾“å…¥å­—ç¬¦ï¼Œåªæœ‰ç­‰åˆ°æƒé™èµ‹äºˆå®Œæ¯•åæ‰èƒ½æ¥å—å¤–éƒ¨è¾“å…¥ã€‚æ€»çš„æ¥è®²ï¼Œå°±æ˜¯åœ¨ç­‰å¾…ç¨‹åºæ—¶æ— æ³•æ‰§è¡Œå…¶ä»–å·¥ä½œã€‚å¦‚æœåœ¨ç­‰å¾…ç¨‹åºæ—¶å¯ä»¥è¿è¡Œå¦ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆå°†ä¼šå¤§å¤§æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚ï¼ˆèµ„æºå¹¶ä¸ä¼šè§‰å¾—ç´¯ï¼‰å› ä¸ºå®ƒä¸ä¼šåˆ’æ°´ï½</li><li><code>å…¬å¹³æ€§</code>ï¼Œä¸åŒçš„ç”¨æˆ·å’Œç¨‹åºéƒ½èƒ½å¤Ÿä½¿ç”¨è®¡ç®—æœºä¸Šçš„èµ„æºã€‚ä¸€ç§é«˜æ•ˆçš„è¿è¡Œæ–¹å¼æ˜¯ä¸ºä¸åŒçš„ç¨‹åºåˆ’åˆ†æ—¶é—´ç‰‡æ¥ä½¿ç”¨èµ„æºï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å†³å®šä¸åŒè¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚è™½ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰èƒ½å¤Ÿå…¬å¹³äº«æœ‰èµ„æºçš„æƒåˆ©ï¼Œä½†æ˜¯å½“æœ‰ä¸€ä¸ªè¿›ç¨‹é‡Šæ”¾èµ„æºåçš„åŒæ—¶æœ‰ä¸€ä¸ªä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹æŠ¢å¤ºèµ„æºï¼Œå°±ä¼šé€ æˆä¼˜å…ˆçº§ä½çš„è¿›ç¨‹æ— æ³•è·å¾—èµ„æºï¼Œè¿›è€Œå¯¼è‡´è¿›ç¨‹é¥¥é¥¿ã€‚</li><li><code>ä¾¿åˆ©æ€§</code>ï¼Œå•ä¸ªè¿›ç¨‹æ˜¯æ˜¯ä¸ç”¨é€šä¿¡çš„ï¼Œé€šä¿¡çš„æœ¬è´¨å°±æ˜¯<code>ä¿¡æ¯äº¤æ¢</code>ï¼ŒåŠæ—¶è¿›è¡Œä¿¡æ¯äº¤æ¢èƒ½å¤Ÿé¿å…<code>ä¿¡æ¯å­¤å²›</code>ï¼Œåšé‡å¤æ€§çš„å·¥ä½œï¼›ä»»ä½•å¹¶å‘èƒ½åšçš„äº‹æƒ…ï¼Œå•è¿›ç¨‹ä¹Ÿèƒ½å¤Ÿå®ç°ï¼Œåªä¸è¿‡è¿™ç§æ–¹å¼æ•ˆç‡å¾ˆä½ï¼Œå®ƒæ˜¯ä¸€ç§<code>é¡ºåºæ€§</code>çš„ã€‚</li></ul><p>ä½†æ˜¯ï¼Œé¡ºåºç¼–ç¨‹ï¼ˆä¹Ÿç§°ä¸º<code>ä¸²è¡Œç¼–ç¨‹</code>ï¼‰ä¹Ÿä¸æ˜¯<code>ä¸€æ— æ˜¯å¤„</code>çš„ï¼Œä¸²è¡Œç¼–ç¨‹çš„ä¼˜åŠ¿åœ¨äºå…¶<strong>ç›´è§‚æ€§å’Œç®€å•æ€§</strong>ï¼Œå®¢è§‚æ¥è®²ï¼Œä¸²è¡Œç¼–ç¨‹æ›´é€‚åˆæˆ‘ä»¬äººè„‘çš„æ€è€ƒæ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸ä¼šæ»¡è¶³äºé¡ºåºç¼–ç¨‹ï¼Œ<strong>we want it more!!!</strong> ã€‚èµ„æºåˆ©ç”¨ç‡ã€å…¬å¹³æ€§å’Œä¾¿åˆ©æ€§ä¿ƒä½¿ç€è¿›ç¨‹å‡ºç°çš„åŒæ—¶ï¼Œä¹Ÿä¿ƒä½¿ç€<code>çº¿ç¨‹</code>çš„å‡ºç°ã€‚</p><p>å…³äºè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Œç®€å•ç†è§£å°±ä¸€å¥è¯ï¼š<strong>è¿›ç¨‹æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè€Œçº¿ç¨‹æ˜¯åº”ç”¨ç¨‹åºä¸­çš„ä¸€æ¡é¡ºåºæµ</strong>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/9EQ5HDcLPFhydSm.png" alt="img"></p><p>è¿›ç¨‹ä¸­ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ¥å®Œæˆä¸€äº›ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡æœ‰å¯èƒ½ç›¸åŒæœ‰å¯èƒ½ä¸åŒã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œé¡ºåºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/mCoROYJhPqZegNu.png" alt="img"></p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼Œè¿™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çº¿ç¨‹å†…éƒ¨çš„å’Œçº¿ç¨‹å…±äº«çš„èµ„æºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><blockquote><p>åœ¨è®¡ç®—æœºä¸­ï¼Œä¸€èˆ¬å †æ ˆæŒ‡çš„å°±æ˜¯æ ˆï¼Œè€Œå †æŒ‡çš„æ‰æ˜¯å †</p></blockquote><p>çº¿ç¨‹ä¼šå…±äº«è¿›ç¨‹èŒƒå›´å†…çš„èµ„æºï¼Œä¾‹å¦‚å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±ç§æœ‰çš„å†…å®¹ï¼Œæ¯”å¦‚ç¨‹åºè®¡æ•°å™¨ã€æ ˆä»¥åŠå±€éƒ¨å˜é‡ã€‚ä¸‹é¢æ±‡æ€»äº†è¿›ç¨‹å’Œçº¿ç¨‹å…±äº«èµ„æºçš„åŒºåˆ«</p><p><img src= "/img/loading2.gif" data-lazy-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c323cd6f49f40ce88ecf01e1c8ca6dd~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>çº¿ç¨‹æ˜¯ä¸€ç§<code>è½»é‡çº§</code>çš„è¿›ç¨‹ï¼Œè½»é‡çº§ä½“ç°åœ¨çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯è¦æ¯”è¿›ç¨‹çš„å¼€é”€å°å¾ˆå¤šã€‚</p><blockquote><p>æ³¨æ„ï¼šä»»ä½•æ¯”è¾ƒéƒ½æ˜¯ç›¸å¯¹çš„ã€‚</p></blockquote><p>åœ¨å¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œéƒ½ä»¥çº¿ç¨‹ä¸ºåŸºæœ¬çš„è°ƒåº¦å•ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è§†è§’ç€é‡æ”¾åœ¨å¯¹<code>çº¿ç¨‹</code>çš„æ¢ç©¶ã€‚</p><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><h3 id="ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹"><a href="#ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹"></a>ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹</h3><p>å¤šçº¿ç¨‹æ„å‘³ç€ä½ èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‡ä»¤æ˜¯åœ¨ CPU ä¸­æ‰§è¡Œçš„ï¼Œå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºå°±åƒæ˜¯å…·æœ‰å¤šä¸ª CPU åœ¨åŒæ—¶æ‰§è¡Œåº”ç”¨ç¨‹åºçš„ä»£ç ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/UIT3HkbCR1Mv5tg.png" alt="img"></p><p>å…¶å®è¿™æ˜¯ä¸€ç§å‡è±¡ï¼Œçº¿ç¨‹æ•°é‡å¹¶ä¸ç­‰äº CPU æ•°é‡ï¼Œå•ä¸ª CPU å°†åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº« CPU çš„æ—¶é—´ç‰‡ï¼Œåœ¨ç»™å®šçš„æ—¶é—´ç‰‡å†…æ‰§è¡Œæ¯ä¸ªçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œæ¯ä¸ªçº¿ç¨‹ä¹Ÿå¯ä»¥ç”±ä¸åŒçš„ CPU æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/c9nG1zNHjkoaiwg.png" alt="28f4eee4f9b146b583775f58bd8499b6_tplv-k3u1fbpfcp-zoom-1"></p><h3 id="å¹¶å‘ä¸å¹¶è¡Œ"><a href="#å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ä¸å¹¶è¡Œ"></a>å¹¶å‘ä¸å¹¶è¡Œ</h3><p><code>å¹¶å‘</code>æ„å‘³ç€åº”ç”¨ç¨‹åºä¼šæ‰§è¡Œå¤šä¸ªçš„ä»»åŠ¡ï¼Œä½†æ˜¯å¦‚æœè®¡ç®—æœºåªæœ‰ä¸€ä¸ª CPU çš„è¯ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºæ— æ³•åŒæ—¶æ‰§è¡Œå¤šä¸ªçš„ä»»åŠ¡ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºåˆéœ€è¦æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ‰€ä»¥è®¡ç®—æœºåœ¨å¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ï¼Œå®ƒå¹¶æ²¡æœ‰å®Œæˆå½“å‰çš„ä»»åŠ¡ï¼Œåªæ˜¯æŠŠçŠ¶æ€æš‚å­˜ï¼Œè¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼ŒCPU åœ¨å¤šä¸ªä»»åŠ¡ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/MLkJm1wf96hjvEq.png" alt="2b9f5d2444564a4892dae6773ed49dfc_tplv-k3u1fbpfcp-zoom-1"></p><p><code>å¹¶è¡Œ</code>æ˜¯æŒ‡åº”ç”¨ç¨‹åºå°†å…¶ä»»åŠ¡åˆ†è§£ä¸ºè¾ƒå°çš„å­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œä¾‹å¦‚åœ¨å¤šä¸ªCPUä¸ŠåŒæ—¶è¿›è¡Œã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/6zmK3IGcHRX7Lfd.png" alt="db5307cfa3454ae19626a6b5d0c0720d_tplv-k3u1fbpfcp-zoom-1"></p><h3 id="ä¼˜åŠ¿å’ŒåŠ£åŠ¿"><a href="#ä¼˜åŠ¿å’ŒåŠ£åŠ¿" class="headerlink" title="ä¼˜åŠ¿å’ŒåŠ£åŠ¿"></a>ä¼˜åŠ¿å’ŒåŠ£åŠ¿</h3><p>åˆç†ä½¿ç”¨çº¿ç¨‹æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œåˆç†ç¼–å†™ä¸€é“å‡†ç¡®æ— è¯¯çš„å¤šçº¿ç¨‹ç¨‹åºæ›´æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œå¦‚æœçº¿ç¨‹ä½¿ç”¨å¾—å½“ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é™ä½ç¨‹åºçš„å¼€å‘å’Œç»´æŠ¤æˆæœ¬ã€‚</p><p>Java å¾ˆå¥½çš„åœ¨ç”¨æˆ·ç©ºé—´å®ç°äº†å¼€å‘å·¥å…·åŒ…ï¼Œå¹¶åœ¨å†…æ ¸ç©ºé—´æä¾›ç³»ç»Ÿè°ƒç”¨æ¥æ”¯æŒå¤šçº¿ç¨‹ç¼–ç¨‹ï¼ŒJava æ”¯æŒäº†ä¸°å¯Œçš„ç±»åº“ <code>java.util.concurrent</code> å’Œè·¨å¹³å°çš„<code>å†…å­˜æ¨¡å‹</code>ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†å¼€å‘äººå‘˜çš„é—¨æ§›ï¼Œå¹¶å‘ä¸€ç›´ä»¥æ¥æ˜¯ä¸€ä¸ªé«˜é˜¶çš„ä¸»é¢˜ï¼Œä½†æ˜¯ç°åœ¨ï¼Œå¹¶å‘ä¹Ÿæˆä¸ºäº†ä¸»æµå¼€å‘äººå‘˜çš„å¿…å¤‡ç´ è´¨ã€‚</p><p>è™½ç„¶çº¿ç¨‹å¸¦æ¥çš„å¥½å¤„å¾ˆå¤šï¼Œä½†æ˜¯ç¼–å†™æ­£ç¡®çš„å¤šçº¿ç¨‹ï¼ˆå¹¶å‘ï¼‰ç¨‹åºæ˜¯ä¸€ä»¶æå›°éš¾çš„äº‹æƒ…ï¼Œå¹¶å‘ç¨‹åºçš„ Bug å¾€å¾€ä¼šè¯¡å¼‚åœ°å‡ºç°åˆè¯¡å¼‚çš„æ¶ˆå¤±ï¼Œåœ¨å½“ä½ è®¤ä¸ºæ²¡æœ‰é—®é¢˜çš„æ—¶å€™å®ƒå°±å‡ºç°äº†ï¼Œ<code>éš¾ä»¥å®šä½</code> æ˜¯å¹¶å‘ç¨‹åºçš„ä¸€ä¸ªç‰¹å¾ï¼Œæ‰€ä»¥åœ¨æ­¤åŸºç¡€ä¸Šä½ éœ€è¦æœ‰æ‰å®çš„å¹¶å‘åŸºæœ¬åŠŸã€‚é‚£ä¹ˆï¼Œå¹¶å‘ä¸ºä»€ä¹ˆä¼šå‡ºç°å‘¢ï¼Ÿ</p><h3 id="å¹¶å‘ä¸ºä»€ä¹ˆä¼šå‡ºç°"><a href="#å¹¶å‘ä¸ºä»€ä¹ˆä¼šå‡ºç°" class="headerlink" title="å¹¶å‘ä¸ºä»€ä¹ˆä¼šå‡ºç°"></a>å¹¶å‘ä¸ºä»€ä¹ˆä¼šå‡ºç°</h3><p>è®¡ç®—æœºä¸–ç•Œçš„å¿«é€Ÿå‘å±•ç¦»ä¸å¼€ CPUã€å†…å­˜å’Œ I/O è®¾å¤‡çš„é«˜é€Ÿå‘å±•ï¼Œä½†æ˜¯è¿™ä¸‰è€…ä¸€ç›´å­˜åœ¨é€Ÿåº¦å·®å¼‚æ€§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä»å­˜å‚¨å™¨çš„å±‚æ¬¡ç»“æ„å¯ä»¥çœ‹å‡º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/UsuhfLiE3QcKvog.png" alt="1d414061db36482eb05bac3ca3bc686f_tplv-k3u1fbpfcp-zoom-1"></p><p>CPU å†…éƒ¨æ˜¯å¯„å­˜å™¨çš„æ„é€ ï¼Œå¯„å­˜å™¨çš„è®¿é—®é€Ÿåº¦è¦é«˜äº<code>é«˜é€Ÿç¼“å­˜</code>ï¼Œé«˜é€Ÿç¼“å­˜çš„è®¿é—®é€Ÿåº¦è¦é«˜äºå†…å­˜ï¼Œæœ€æ…¢çš„æ˜¯ç£ç›˜è®¿é—®ã€‚</p><p>ç¨‹åºæ˜¯åœ¨å†…å­˜ä¸­æ‰§è¡Œçš„ï¼Œç¨‹åºé‡Œå¤§éƒ¨åˆ†è¯­å¥éƒ½è¦è®¿é—®å†…å­˜ï¼Œæœ‰äº›è¿˜éœ€è¦è®¿é—® I/O è®¾å¤‡ï¼Œæ ¹æ®æ¼æ¡¶ç†è®ºæ¥è¯´ï¼Œç¨‹åºæ•´ä½“çš„æ€§èƒ½å–å†³äºæœ€æ…¢çš„æ“ä½œä¹Ÿå°±æ˜¯ç£ç›˜è®¿é—®é€Ÿåº¦ã€‚</p><p>å› ä¸º CPU é€Ÿåº¦å¤ªå¿«äº†ï¼Œæ‰€ä»¥ä¸ºäº†å‘æŒ¥ CPU çš„é€Ÿåº¦ä¼˜åŠ¿ï¼Œå¹³è¡¡è¿™ä¸‰è€…çš„é€Ÿåº¦å·®å¼‚ï¼Œè®¡ç®—æœºä½“ç³»æœºæ„ã€æ“ä½œç³»ç»Ÿã€ç¼–è¯‘ç¨‹åºéƒ½åšå‡ºäº†è´¡çŒ®ï¼Œä¸»è¦ä½“ç°ä¸ºï¼š</p><ul><li>CPU ä½¿ç”¨ç¼“å­˜æ¥ä¸­å’Œå’Œå†…å­˜çš„è®¿é—®é€Ÿåº¦å·®å¼‚</li><li>æ“ä½œç³»ç»Ÿæä¾›è¿›ç¨‹å’Œçº¿ç¨‹è°ƒåº¦ï¼Œè®© CPU åœ¨æ‰§è¡ŒæŒ‡ä»¤çš„åŒæ—¶åˆ†æ—¶å¤ç”¨çº¿ç¨‹ï¼Œè®©å†…å­˜å’Œç£ç›˜ä¸æ–­äº¤äº’ï¼Œä¸åŒçš„ <code>CPU æ—¶é—´ç‰‡</code> èƒ½å¤Ÿæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œä»è€Œå‡è¡¡è¿™ä¸‰è€…çš„å·®å¼‚</li><li>ç¼–è¯‘ç¨‹åºæä¾›ä¼˜åŒ–æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼Œè®©ç¼“å­˜èƒ½å¤Ÿåˆç†çš„ä½¿ç”¨</li></ul><p>æˆ‘ä»¬åœ¨äº«å—è¿™äº›ä¾¿åˆ©çš„åŒæ—¶ï¼Œå¤šçº¿ç¨‹ä¹Ÿä¸ºæˆ‘ä»¬å¸¦æ¥äº†æŒ‘æˆ˜ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹å¹¶å‘é—®é¢˜ä¸ºä»€ä¹ˆä¼šå‡ºç°ä»¥åŠå¤šçº¿ç¨‹çš„æºå¤´æ˜¯ä»€ä¹ˆã€‚</p><h3 id="çº¿ç¨‹å¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜"><a href="#çº¿ç¨‹å¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜" class="headerlink" title="çº¿ç¨‹å¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜"></a>çº¿ç¨‹å¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜</h3><p>çº¿ç¨‹å®‰å…¨æ€§æ˜¯éå¸¸å¤æ‚çš„ï¼Œåœ¨æ²¡æœ‰é‡‡ç”¨<code>åŒæ­¥æœºåˆ¶</code>çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¸­çš„æ‰§è¡Œæ“ä½œå¾€å¾€æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œè¿™ä¹Ÿæ˜¯å¤šçº¿ç¨‹å¸¦æ¥çš„æŒ‘æˆ˜ä¹‹ä¸€ï¼Œä¸‹é¢æˆ‘ä»¬ç»™å‡ºä¸€æ®µä»£ç ï¼Œæ¥çœ‹çœ‹å®‰å…¨æ€§é—®é¢˜ä½“ç°åœ¨å“ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TSynchronized</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">1000</span>;i++) &#123;</span><br><span class="line">            increase();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        TSynchronized tSynchronized = <span class="keyword">new</span> TSynchronized();</span><br><span class="line">        Thread aThread = <span class="keyword">new</span> Thread(tSynchronized);</span><br><span class="line">        Thread bThread = <span class="keyword">new</span> Thread(tSynchronized);</span><br><span class="line">        aThread.start();</span><br><span class="line">        bThread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;i = &quot;</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µç¨‹åºè¾“å‡ºåä¼šå‘ç°ï¼Œi çš„å€¼æ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œè¿™ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æµ‹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ã€‚</p><p><code>TSynchronized</code> å®ç°äº† Runnable æ¥å£ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªé™æ€å˜é‡ <code>i</code>ï¼Œç„¶ååœ¨ <code>increase</code> æ–¹æ³•ä¸­æ¯æ¬¡éƒ½å¢åŠ  i çš„å€¼ï¼Œåœ¨å…¶å®ç°çš„ run æ–¹æ³•ä¸­è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå…±æ‰§è¡Œ 1000 æ¬¡ã€‚</p><h4 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h4><p>åœ¨å•æ ¸ CPU æ—¶ä»£ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…±ç”¨ä¸€ä¸ª CPUï¼ŒCPU ç¼“å­˜å’Œå†…å­˜çš„ä¸€è‡´æ€§é—®é¢˜å®¹æ˜“è§£å†³ï¼ŒCPU å’Œ å†…å­˜ä¹‹é—´</p><p>å¦‚æœç”¨å›¾æ¥è¡¨ç¤ºçš„è¯æˆ‘æƒ³ä¼šæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/Dbr51qVywGNipER.png" alt="74cb25a3dc3a4ff8902c7d0088c393e7_tplv-k3u1fbpfcp-zoom-1"></p><p>åœ¨å¤šæ ¸æ—¶ä»£ï¼Œå› ä¸ºæœ‰å¤šæ ¸çš„å­˜åœ¨ï¼Œæ¯ä¸ªæ ¸éƒ½èƒ½å¤Ÿç‹¬ç«‹çš„è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯é¢— CPU éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œè¿™æ—¶ CPU ç¼“å­˜ä¸å†…å­˜çš„æ•°æ®ä¸€è‡´æ€§å°±æ²¡é‚£ä¹ˆå®¹æ˜“è§£å†³äº†ï¼Œå½“å¤šä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„ CPU ä¸Šæ‰§è¡Œæ—¶ï¼Œè¿™äº›çº¿ç¨‹æ“ä½œçš„æ˜¯ä¸åŒçš„ CPU ç¼“å­˜ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/fmU13JXVRC6psQN.png" alt="ad95cb50434c4017a4acd6990ab0e03c_tplv-k3u1fbpfcp-zoom-1"></p><p>å› ä¸º i æ˜¯é™æ€å˜é‡ï¼Œæ²¡æœ‰ç»è¿‡ä»»ä½•çº¿ç¨‹å®‰å…¨æªæ–½çš„ä¿æŠ¤ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå¹¶å‘ä¿®æ”¹ i çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸º i ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯¼è‡´è¿™ç§ç»“æœçš„å‡ºç°æ˜¯ç”±äº aThread å’Œ bThread ä¸­è¯»å–çš„ i å€¼å½¼æ­¤ä¸å¯è§ï¼Œæ‰€ä»¥è¿™æ˜¯ç”±äº <code>å¯è§æ€§</code> å¯¼è‡´çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h4 id="åŸå­æ€§é—®é¢˜"><a href="#åŸå­æ€§é—®é¢˜" class="headerlink" title="åŸå­æ€§é—®é¢˜"></a>åŸå­æ€§é—®é¢˜</h4><p>çœ‹èµ·æ¥å¾ˆæ™®é€šçš„ä¸€æ®µç¨‹åºå´å› ä¸ºä¸¤ä¸ªçº¿ç¨‹ <code>aThread</code> å’Œ <code>bThread</code> äº¤æ›¿æ‰§è¡Œäº§ç”Ÿäº†ä¸åŒçš„ç»“æœã€‚ä½†æ˜¯æ ¹æºä¸æ˜¯å› ä¸ºåˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹å¯¼è‡´çš„ï¼Œå¤šçº¿ç¨‹åªæ˜¯äº§ç”Ÿçº¿ç¨‹å®‰å…¨æ€§çš„å¿…è¦æ¡ä»¶ï¼Œæœ€ç»ˆçš„æ ¹æºå‡ºç°åœ¨ <code>i++</code> è¿™ä¸ªæ“ä½œä¸Šã€‚</p><p>è¿™ä¸ªæ“ä½œæ€ä¹ˆäº†ï¼Ÿè¿™ä¸å°±æ˜¯ä¸€ä¸ªç»™ i é€’å¢çš„æ“ä½œå—ï¼Ÿä¹Ÿå°±æ˜¯ <strong>i++ =&gt; i = i + 1</strong>ï¼Œè¿™æ€ä¹ˆå°±ä¼šäº§ç”Ÿé—®é¢˜äº†ï¼Ÿ</p><p>å› ä¸º <code>i++</code> ä¸æ˜¯ä¸€ä¸ª <code>åŸå­æ€§</code> æ“ä½œï¼Œä»”ç»†æƒ³ä¸€ä¸‹ï¼Œi++ å…¶å®æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œè¯»å– i çš„å€¼ï¼Œæ‰§è¡Œ i + 1 æ“ä½œï¼Œç„¶åæŠŠ i + 1 å¾—å‡ºçš„å€¼é‡æ–°èµ‹ç»™ iï¼ˆå°†ç»“æœå†™å…¥å†…å­˜ï¼‰ã€‚</p><p>å½“ä¸¤ä¸ªçº¿ç¨‹å¼€å§‹è¿è¡Œåï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæŠŠ i çš„å€¼è¯»å…¥åˆ° CPU ç¼“å­˜ä¸­ï¼Œç„¶åæ‰§è¡Œ + 1 æ“ä½œï¼Œå†æŠŠ + 1 ä¹‹åçš„å€¼å†™å…¥å†…å­˜ã€‚å› ä¸ºçº¿ç¨‹é—´éƒ½æœ‰å„è‡ªçš„è™šæ‹Ÿæœºæ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼Œä»–ä»¬å½¼æ­¤ä¹‹é—´æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œæ‰€ä»¥å½“ aThread æ‰§è¡Œ + 1 æ“ä½œåï¼Œä¼šæŠŠæ•°æ®å†™å…¥åˆ°å†…å­˜ï¼ŒåŒæ—¶ bThread æ‰§è¡Œ + 1 æ“ä½œåï¼Œä¹Ÿä¼šæŠŠæ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œå› ä¸º CPU æ—¶é—´ç‰‡çš„æ‰§è¡Œå‘¨æœŸæ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥ä¼šå‡ºç°å½“ aThread è¿˜æ²¡æœ‰æŠŠæ•°æ®å†™å…¥å†…å­˜æ—¶ï¼ŒbThread å°±ä¼šè¯»å–å†…å­˜ä¸­çš„æ•°æ®ï¼Œç„¶åæ‰§è¡Œ + 1æ“ä½œï¼Œå†å†™å›å†…å­˜ï¼Œä»è€Œè¦†ç›– i çš„å€¼ï¼Œå¯¼è‡´ aThread æ‰€åšçš„åŠªåŠ›ç™½è´¹ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/Fdi2vREeJ7bxDHg.png" alt="0d7fc09c26af41e3902b2773cde6901a_tplv-k3u1fbpfcp-zoom-1"></p><p>ä¸ºä»€ä¹ˆä¸Šé¢çš„çº¿ç¨‹åˆ‡æ¢ä¼šå‡ºç°é—®é¢˜å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥è€ƒè™‘ä¸€ä¸‹æ­£å¸¸æƒ…å†µä¸‹ï¼ˆå³ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜çš„æƒ…å†µä¸‹ï¼‰ä¸¤æ¡çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/XSxAnutUPsRjozd.png" alt="d7d9c89021a54f668437e2ad8b2212a3_tplv-k3u1fbpfcp-zoom-1"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ aThread åœ¨æ‰§è¡Œå®Œæ•´ä¸ª i++ çš„æ“ä½œåï¼Œæ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹è¿›è¡Œåˆ‡æ¢ï¼Œç”± aThread -&gt; bThreadï¼Œè¿™æ˜¯æœ€ç†æƒ³çš„æ“ä½œï¼Œä¸€æ—¦æ“ä½œç³»ç»Ÿåœ¨ä»»æ„ <code>è¯»å–/å¢åŠ /å†™å…¥</code> é˜¶æ®µäº§ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œéƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä¾‹å¦‚å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/QRMcoE1AWSNzbnF.png" alt="e61fc4b52120487ab632722a3b06f280_tplv-k3u1fbpfcp-zoom-1"></p><p>æœ€å¼€å§‹çš„æ—¶å€™ï¼Œå†…å­˜ä¸­ i = 0ï¼ŒaThread è¯»å–å†…å­˜ä¸­çš„å€¼å¹¶æŠŠå®ƒè¯»å–åˆ°è‡ªå·±çš„å¯„å­˜å™¨ä¸­ï¼Œæ‰§è¡Œ +1 æ“ä½œï¼Œæ­¤æ—¶å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼ŒbThread å¼€å§‹æ‰§è¡Œï¼Œè¯»å–å†…å­˜ä¸­çš„å€¼å¹¶æŠŠå®ƒè¯»å–åˆ°è‡ªå·±çš„å¯„å­˜å™¨ä¸­ï¼Œæ­¤æ—¶å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢è‡³ aThread å¼€å§‹è¿è¡Œï¼ŒaThread æŠŠè‡ªå·±å¯„å­˜å™¨çš„å€¼å†™å›åˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶åˆå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œç”± aThread -&gt; bThreadï¼Œçº¿ç¨‹ bThread æŠŠè‡ªå·±å¯„å­˜å™¨çš„å€¼ +1 ç„¶åå†™å›å†…å­˜ï¼Œå†™å®Œåå†…å­˜ä¸­çš„å€¼ä¸æ˜¯ 2 ï¼Œè€Œæ˜¯ 1ï¼Œ å†…å­˜ä¸­çš„ i å€¼è¢«è¦†ç›–äº†ã€‚</p><p>æˆ‘ä»¬ä¸Šé¢æåˆ° <code>åŸå­æ€§</code> è¿™ä¸ªæ¦‚å¿µï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯åŸå­æ€§å‘¢ï¼Ÿ</p><blockquote><p>å¹¶å‘ç¼–ç¨‹çš„åŸå­æ€§æ“ä½œæ˜¯å®Œå…¨ç‹¬ç«‹äºä»»ä½•å…¶ä»–è¿›ç¨‹è¿è¡Œçš„æ“ä½œï¼ŒåŸå­æ“ä½œå¤šç”¨äºç°ä»£æ“ä½œç³»ç»Ÿå’Œå¹¶è¡Œå¤„ç†ç³»ç»Ÿä¸­ã€‚</p><p>åŸå­æ“ä½œé€šå¸¸åœ¨å†…æ ¸ä¸­ä½¿ç”¨ï¼Œå› ä¸ºå†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸»è¦ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå¤§å¤šæ•°è®¡ç®—æœºç¡¬ä»¶ï¼Œç¼–è¯‘å™¨å’Œåº“ä¹Ÿæä¾›åŸå­æ€§æ“ä½œã€‚</p><p>åœ¨åŠ è½½å’Œå­˜å‚¨ä¸­ï¼Œè®¡ç®—æœºç¡¬ä»¶å¯¹å­˜å‚¨å™¨å­—è¿›è¡Œè¯»å–å’Œå†™å…¥ã€‚ä¸ºäº†å¯¹å€¼è¿›è¡ŒåŒ¹é…ã€å¢åŠ æˆ–è€…å‡å°æ“ä½œï¼Œä¸€èˆ¬é€šè¿‡åŸå­æ“ä½œè¿›è¡Œã€‚åœ¨åŸå­æ“ä½œæœŸé—´ï¼Œå¤„ç†å™¨å¯ä»¥åœ¨åŒä¸€æ•°æ®ä¼ è¾“æœŸé—´å®Œæˆè¯»å–å’Œå†™å…¥ã€‚ è¿™æ ·ï¼Œå…¶ä»–è¾“å…¥/è¾“å‡ºæœºåˆ¶æˆ–å¤„ç†å™¨æ— æ³•æ‰§è¡Œå­˜å‚¨å™¨è¯»å–æˆ–å†™å…¥ä»»åŠ¡ï¼Œç›´åˆ°åŸå­æ“ä½œå®Œæˆä¸ºæ­¢ã€‚</p></blockquote><p>ç®€å•æ¥è®²ï¼Œå°±æ˜¯<strong>åŸå­æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</strong>ã€‚æ•°æ®åº“äº‹åŠ¡çš„åŸå­æ€§ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªæ¦‚å¿µæ¼”è¿›çš„ã€‚</p><h4 id="æœ‰åºæ€§é—®é¢˜"><a href="#æœ‰åºæ€§é—®é¢˜" class="headerlink" title="æœ‰åºæ€§é—®é¢˜"></a>æœ‰åºæ€§é—®é¢˜</h4><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­è¿˜æœ‰å¸¦æ¥è®©äººéå¸¸å¤´ç–¼çš„ <code>æœ‰åºæ€§</code> é—®é¢˜ï¼Œæœ‰åºæ€§é¡¾åæ€ä¹‰å°±æ˜¯é¡ºåºæ€§ï¼Œåœ¨è®¡ç®—æœºä¸­æŒ‡çš„å°±æ˜¯æŒ‡ä»¤çš„å…ˆåæ‰§è¡Œé¡ºåºã€‚ä¸€ä¸ªéå¸¸æ˜¾è€Œæ˜“è§çš„ä¾‹å­å°±æ˜¯ JVM ä¸­çš„<code>ç±»åŠ è½½</code></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/AgvqPchMZydStnG.png" alt="7522eb69ca384c599bc1f2959bc19209_tplv-k3u1fbpfcp-zoom-1"></p><p>è¿™æ˜¯ä¸€ä¸ª JVM åŠ è½½ç±»çš„è¿‡ç¨‹å›¾ï¼Œä¹Ÿç§°ä¸ºç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œç±»ä»åŠ è½½åˆ° JVM åˆ°å¸è½½ä¸€å…±ä¼šç»å†äº”ä¸ªé˜¶æ®µ <strong>åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å¸è½½</strong>ã€‚è¿™äº”ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸€å®šçš„ï¼Œä½†æ˜¯åœ¨è¿æ¥é˜¶æ®µï¼Œä¹Ÿä¼šåˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼Œå³ <strong>éªŒè¯ã€å‡†å¤‡ã€è§£æ</strong> é˜¶æ®µï¼Œè¿™ä¸‰ä¸ªé˜¶æ®µçš„æ‰§è¡Œé¡ºåºä¸æ˜¯ç¡®å®šçš„ï¼Œé€šå¸¸äº¤å‰è¿›è¡Œï¼Œåœ¨ä¸€ä¸ªé˜¶æ®µçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p><p>æœ‰åºæ€§é—®é¢˜ä¸€èˆ¬æ˜¯ç¼–è¯‘å™¨å¸¦æ¥çš„ï¼Œç¼–è¯‘å™¨æœ‰çš„æ—¶å€™ç¡®å®æ˜¯ <strong>å¥½å¿ƒåŠåäº‹</strong>ï¼Œå®ƒä¸ºäº†ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œå¾€å¾€æ›´æ¢æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</p><h4 id="æ´»è·ƒæ€§é—®é¢˜"><a href="#æ´»è·ƒæ€§é—®é¢˜" class="headerlink" title="æ´»è·ƒæ€§é—®é¢˜"></a>æ´»è·ƒæ€§é—®é¢˜</h4><p>å¤šçº¿ç¨‹è¿˜ä¼šå¸¦æ¥<code>æ´»è·ƒæ€§</code>é—®é¢˜ï¼Œå¦‚ä½•å®šä¹‰æ´»è·ƒæ€§é—®é¢˜å‘¢ï¼Ÿæ´»è·ƒæ€§é—®é¢˜å…³æ³¨çš„æ˜¯ <strong>æŸä»¶äº‹æƒ…æ˜¯å¦ä¼šå‘ç”Ÿ</strong>ã€‚</p><p><strong>å¦‚æœä¸€ç»„çº¿ç¨‹ä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…ä¸€ä¸ªäº‹ä»¶çš„å‘ç”Ÿï¼Œè€Œè¿™ä¸ªäº‹ä»¶åªèƒ½ç”±è¯¥ç»„ä¸­æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹è§¦å‘ï¼Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´æ­»é”</strong>ã€‚</p><p>ç®€å•ä¸€ç‚¹æ¥è¡¨è¿°ä¸€ä¸‹ï¼Œå°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾èµ„æºï¼Œè€Œå…¶ä»–èµ„æºä¹Ÿåœ¨ç­‰å¾…æ¯ä¸ªçº¿ç¨‹é‡Šæ”¾èµ„æºï¼Œè¿™æ ·æ²¡æœ‰çº¿ç¨‹æŠ¢å…ˆé‡Šæ”¾è‡ªå·±çš„èµ„æºï¼Œè¿™ç§æƒ…å†µä¼šäº§ç”Ÿæ­»é”ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šæ— é™çš„ç­‰å¾…ä¸‹å»ã€‚</p><p><strong>æ­»é”çš„å¿…è¦æ¡ä»¶</strong></p><p>é€ æˆæ­»é”çš„åŸå› æœ‰å››ä¸ªï¼Œç ´åå…¶ä¸­ä¸€ä¸ªå³å¯ç ´åæ­»é”</p><ul><li>äº’æ–¥æ¡ä»¶ï¼šæŒ‡è¿›ç¨‹å¯¹æ‰€åˆ†é…åˆ°çš„èµ„æºè¿›è¡Œæ’å®ƒæ€§ä½¿ç”¨ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºåªç”±ä¸€ä¸ªè¿›ç¨‹å ç”¨ã€‚å¦‚æœæ­¤æ—¶è¿˜æœ‰å…¶å®ƒè¿›ç¨‹è¯·æ±‚èµ„æºï¼Œåˆ™è¯·æ±‚è€…åªèƒ½ç­‰å¾…ï¼Œç›´è‡³å æœ‰èµ„æºçš„è¿›ç¨‹é‡Šæ”¾ã€‚</li><li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šæŒ‡è¿›ç¨‹å·²ç»ä¿æŒè‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶å®ƒè¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œä½†åˆå¯¹è‡ªå·±å·²è·å¾—çš„å…¶å®ƒèµ„æºä¿æŒå æœ‰ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶ï¼šæŒ‡è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œæ—¶ç”±è‡ªå·±é‡Šæ”¾ã€‚</li><li>å¾ªç¯ç­‰å¾…ï¼šæŒ‡åœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹å¯¹åº”çš„ç¯å½¢é“¾ã€‚</li></ul><p>æ¢å¥è¯è¯´ï¼Œæ­»é”çº¿ç¨‹é›†åˆä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¦ä¸€ä¸ªæ­»é”çº¿ç¨‹å æœ‰çš„èµ„æºã€‚ä½†æ˜¯ç”±äºæ‰€æœ‰çº¿ç¨‹éƒ½ä¸èƒ½è¿è¡Œï¼Œå®ƒä»¬ä¹‹ä¸­ä»»ä½•ä¸€ä¸ªèµ„æºéƒ½æ— æ³•é‡Šæ”¾èµ„æºï¼Œæ‰€ä»¥æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¢«å”¤é†’ã€‚</p><p>å¦‚æœè¯´æ­»é”å¾ˆ<code>ç—´æƒ…</code>çš„è¯ï¼Œé‚£ä¹ˆ<code>æ´»é”</code>ç”¨ä¸€åˆ™æˆè¯­æ¥è¡¨ç¤ºå°±æ˜¯ <code>å¼„å·§æˆæ‹™</code>ã€‚</p><p>æŸäº›æƒ…å†µä¸‹ï¼Œå½“çº¿ç¨‹æ„è¯†åˆ°å®ƒä¸èƒ½è·å–æ‰€éœ€è¦çš„ä¸‹ä¸€ä¸ªé”æ—¶ï¼Œå°±ä¼šå°è¯•ç¤¼è²Œçš„é‡Šæ”¾å·²ç»è·å¾—çš„é”ï¼Œç„¶åç­‰å¾…éå¸¸çŸ­çš„æ—¶é—´å†æ¬¡å°è¯•è·å–ã€‚å¯ä»¥æƒ³åƒä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šå½“ä¸¤ä¸ªäººåœ¨ç‹­è·¯ç›¸é€¢çš„æ—¶å€™ï¼Œéƒ½æƒ³ç»™å¯¹æ–¹è®©è·¯ï¼Œç›¸åŒçš„æ­¥è°ƒä¼šå¯¼è‡´åŒæ–¹éƒ½æ— æ³•å‰è¿›ã€‚</p><p>ç°åœ¨å‡æƒ³æœ‰ä¸€å¯¹å¹¶è¡Œçš„çº¿ç¨‹ç”¨åˆ°äº†ä¸¤ä¸ªèµ„æºã€‚å®ƒä»¬åˆ†åˆ«å°è¯•è·å–å¦ä¸€ä¸ªé”å¤±è´¥åï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šé‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”ï¼Œå†æ¬¡è¿›è¡Œå°è¯•ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´è¿›è¡Œé‡å¤ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰çº¿ç¨‹é˜»å¡ï¼Œä½†æ˜¯çº¿ç¨‹ä»ç„¶ä¸ä¼šå‘ä¸‹æ‰§è¡Œï¼Œè¿™ç§çŠ¶å†µæˆ‘ä»¬ç§°ä¹‹ä¸º <code>æ´»é”(livelock)</code>ã€‚</p><p>å¦‚æœæˆ‘ä»¬æœŸæœ›çš„äº‹æƒ…ä¸€ç›´ä¸ä¼šå‘ç”Ÿï¼Œå°±ä¼šäº§ç”Ÿæ´»è·ƒæ€§é—®é¢˜ï¼Œæ¯”å¦‚å•çº¿ç¨‹ä¸­çš„æ— é™å¾ªç¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(;;)&#123;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œæ¯”å¦‚ aThread å’Œ bThread éƒ½éœ€è¦æŸç§èµ„æºï¼ŒaThread ä¸€ç›´å ç”¨èµ„æºä¸é‡Šæ”¾ï¼ŒbThread ä¸€ç›´å¾—ä¸åˆ°æ‰§è¡Œï¼Œå°±ä¼šé€ æˆæ´»è·ƒæ€§é—®é¢˜ï¼ŒbThread çº¿ç¨‹ä¼šäº§ç”Ÿ<code>é¥¥é¥¿</code>ï¼Œæˆ‘ä»¬åé¢ä¼šè¯´ã€‚</p><h4 id="æ€§èƒ½é—®é¢˜"><a href="#æ€§èƒ½é—®é¢˜" class="headerlink" title="æ€§èƒ½é—®é¢˜"></a>æ€§èƒ½é—®é¢˜</h4><p>ä¸æ´»è·ƒæ€§é—®é¢˜å¯†åˆ‡ç›¸å…³çš„æ˜¯ <code>æ€§èƒ½</code> é—®é¢˜ï¼Œå¦‚æœè¯´æ´»è·ƒæ€§é—®é¢˜å…³æ³¨çš„æ˜¯æœ€ç»ˆçš„ç»“æœï¼Œé‚£ä¹ˆæ€§èƒ½é—®é¢˜å…³æ³¨çš„å°±æ˜¯é€ æˆç»“æœçš„è¿‡ç¨‹ï¼Œæ€§èƒ½é—®é¢˜æœ‰å¾ˆå¤šæ–¹é¢ï¼šæ¯”å¦‚<strong>æœåŠ¡æ—¶é—´è¿‡é•¿ï¼Œååç‡è¿‡ä½ï¼Œèµ„æºæ¶ˆè€—è¿‡é«˜</strong>ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­è¿™æ ·çš„é—®é¢˜åŒæ ·å­˜åœ¨ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§èƒ½å› ç´ é‚£å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ <code>çº¿ç¨‹åˆ‡æ¢</code>ï¼Œä¹Ÿç§°ä¸º <code>ä¸Šä¸‹æ–‡åˆ‡æ¢(Context Switch)</code>ï¼Œè¿™ç§æ“ä½œå¼€é”€å¾ˆå¤§ã€‚</p><blockquote><p>åœ¨è®¡ç®—æœºä¸–ç•Œä¸­ï¼Œè€å¤–éƒ½å–œæ¬¢ç”¨ context ä¸Šä¸‹æ–‡è¿™ä¸ªè¯ï¼Œè¿™ä¸ªè¯æ¶µç›–çš„å†…å®¹å¾ˆå¤šï¼ŒåŒ…æ‹¬ä¸Šä¸‹æ–‡åˆ‡æ¢çš„èµ„æºï¼Œå¯„å­˜å™¨çš„çŠ¶æ€ã€ç¨‹åºè®¡æ•°å™¨ç­‰ã€‚context switch ä¸€èˆ¬æŒ‡çš„å°±æ˜¯è¿™äº›ä¸Šä¸‹æ–‡åˆ‡æ¢çš„èµ„æºã€å¯„å­˜å™¨çŠ¶æ€ã€ç¨‹åºè®¡æ•°å™¨çš„å˜åŒ–ç­‰ã€‚</p></blockquote><p>åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸­ï¼Œä¼šä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ï¼Œä¸¢å¤±å±€éƒ¨æ€§ï¼ŒæŠŠå¤§é‡çš„æ—¶é—´æ¶ˆè€—åœ¨çº¿ç¨‹åˆ‡æ¢ä¸Šè€Œä¸æ˜¯çº¿ç¨‹è¿è¡Œä¸Šã€‚</p><p>ä¸ºä»€ä¹ˆçº¿ç¨‹åˆ‡æ¢ä¼šå¼€é”€å¦‚æ­¤ä¹‹å¤§å‘¢ï¼Ÿçº¿ç¨‹é—´çš„åˆ‡æ¢ä¼šæ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/sdbBQKjY5olEORV.png" alt="6c81b43a91c24533bbcd16ccaf63d5fe_tplv-k3u1fbpfcp-zoom-1"></p><p>å°† CPU ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€çº¿ç¨‹æ¶‰åŠæŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œä¿å­˜å…¶çŠ¶æ€ï¼Œä¾‹å¦‚å¯„å­˜å™¨ï¼Œç„¶åæ¢å¤åˆ°è¦åˆ‡æ¢çš„çº¿ç¨‹çš„çŠ¶æ€ï¼ŒåŠ è½½æ–°çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ­¤æ—¶çº¿ç¨‹åˆ‡æ¢å®é™…ä¸Šå°±å·²ç»å®Œæˆäº†ï¼›æ­¤æ—¶ï¼ŒCPU ä¸åœ¨æ‰§è¡Œçº¿ç¨‹åˆ‡æ¢ä»£ç ï¼Œè¿›è€Œæ‰§è¡Œæ–°çš„å’Œçº¿ç¨‹å…³è”çš„ä»£ç ã€‚</p><h3 id="å¼•èµ·çº¿ç¨‹åˆ‡æ¢çš„å‡ ç§æ–¹å¼"><a href="#å¼•èµ·çº¿ç¨‹åˆ‡æ¢çš„å‡ ç§æ–¹å¼" class="headerlink" title="å¼•èµ·çº¿ç¨‹åˆ‡æ¢çš„å‡ ç§æ–¹å¼"></a>å¼•èµ·çº¿ç¨‹åˆ‡æ¢çš„å‡ ç§æ–¹å¼</h3><p>çº¿ç¨‹é—´çš„åˆ‡æ¢ä¸€èˆ¬æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æœ‰å“ªå‡ ç§æ–¹å¼å‘¢ï¼Ÿæˆ–è€…è¯´çº¿ç¨‹åˆ‡æ¢æœ‰å“ªå‡ ç§è¯±å› å‘¢ï¼Ÿä¸»è¦æœ‰ä¸‹é¢å‡ ç§å¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹å¼</p><ul><li>å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å®Œæˆï¼Œç³»ç»Ÿçš„ CPU æ­£å¸¸è°ƒåº¦ä¸‹ä¸€ä¸ªéœ€è¦è¿è¡Œçš„çº¿ç¨‹</li><li>å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡é‡åˆ° I/O ç­‰é˜»å¡æ“ä½œï¼Œçº¿ç¨‹è°ƒåº¦å™¨æŒ‚èµ·æ­¤ä»»åŠ¡ï¼Œç»§ç»­è°ƒåº¦ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</li><li>å¤šä¸ªä»»åŠ¡å¹¶å‘æŠ¢å é”èµ„æºï¼Œå½“å‰ä»»åŠ¡æ²¡æœ‰è·å¾—é”èµ„æºï¼Œè¢«çº¿ç¨‹è°ƒåº¦å™¨æŒ‚èµ·ï¼Œç»§ç»­è°ƒåº¦ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</li><li>ç”¨æˆ·çš„ä»£ç æŒ‚èµ·å½“å‰ä»»åŠ¡ï¼Œæ¯”å¦‚çº¿ç¨‹æ‰§è¡Œ sleep æ–¹æ³•ï¼Œè®©å‡ºCPUã€‚</li><li>ä½¿ç”¨ç¡¬ä»¶ä¸­æ–­çš„æ–¹å¼å¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><h2 id="çº¿ç¨‹å®‰å…¨æ€§"><a href="#çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€§"></a>çº¿ç¨‹å®‰å…¨æ€§</h2><p>åœ¨ Java ä¸­ï¼Œè¦å®ç°çº¿ç¨‹å®‰å…¨æ€§ï¼Œå¿…é¡»è¦æ­£ç¡®çš„ä½¿ç”¨çº¿ç¨‹å’Œé”ï¼Œä½†æ˜¯è¿™äº›åªæ˜¯æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„ä¸€ç§æ–¹å¼ï¼Œè¦ç¼–å†™æ­£ç¡®æ— è¯¯çš„çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼Œå…¶æ ¸å¿ƒå°±æ˜¯å¯¹çŠ¶æ€è®¿é—®æ“ä½œè¿›è¡Œç®¡ç†ã€‚æœ€é‡è¦çš„å°±æ˜¯æœ€ <code>å…±äº«(Shared)</code>çš„ å’Œ <code>å¯å˜(Mutable)</code>çš„çŠ¶æ€ã€‚åªæœ‰å…±äº«å’Œå¯å˜çš„å˜é‡æ‰ä¼šå‡ºç°é—®é¢˜ï¼Œç§æœ‰å˜é‡ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œå‚è€ƒ<code>ç¨‹åºè®¡æ•°å™¨</code>ã€‚</p><p>å¯¹è±¡çš„çŠ¶æ€å¯ä»¥ç†è§£ä¸ºå­˜å‚¨åœ¨å®ä¾‹å˜é‡æˆ–è€…é™æ€å˜é‡ä¸­çš„æ•°æ®ï¼Œå…±äº«æ„å‘³ç€æŸä¸ªå˜é‡å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€å¯å˜æ„å‘³ç€å˜é‡åœ¨ç”Ÿå‘½å‘¨æœŸå†…ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå–å†³äºå®ƒæ˜¯å¦è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ã€‚è¦ä½¿å˜é‡èƒ½å¤Ÿè¢«å®‰å…¨è®¿é—®ï¼Œå¿…é¡»é€šè¿‡åŒæ­¥æœºåˆ¶æ¥å¯¹å˜é‡è¿›è¡Œä¿®é¥°ã€‚</p><p>å¦‚æœä¸é‡‡ç”¨åŒæ­¥æœºåˆ¶çš„è¯ï¼Œé‚£ä¹ˆå°±è¦é¿å…å¤šçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„è®¿é—®ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼</p><ul><li>ä¸è¦åœ¨å¤šçº¿ç¨‹ä¹‹é—´å…±äº«å˜é‡</li><li>å°†å…±äº«å˜é‡ç½®ä¸ºä¸å¯å˜çš„</li></ul><p>æˆ‘ä»¬è¯´äº†è¿™ä¹ˆå¤šæ¬¡çº¿ç¨‹å®‰å…¨æ€§ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨æ€§å‘¢ï¼Ÿ</p><h3 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨æ€§"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨æ€§"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨æ€§</h3><p>å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å®‰å…¨è°ƒç”¨çš„ä»£ç ç§°ä¸ºçº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœä¸€æ®µä»£ç æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å°±ä¸å­˜åœ¨ <code>ç«æ€æ¡ä»¶</code>ã€‚ä»…ä»…å½“å¤šä¸ªçº¿ç¨‹å…±äº«èµ„æºæ—¶ï¼Œæ‰ä¼šå‡ºç°ç«æ€æ¡ä»¶ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„æ¢è®¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç®€å•çš„ç»“è®ºï¼š<strong>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªç±»æ—¶ï¼Œè¿™ä¸ªç±»å§‹ç»ˆéƒ½èƒ½è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚</p><p>å•çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ•°é‡ä¸º 1 çš„å¤šçº¿ç¨‹ï¼Œå•çº¿ç¨‹ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¯»å–æŸä¸ªå˜é‡çš„å€¼ä¸ä¼šäº§ç”Ÿå®‰å…¨æ€§é—®é¢˜ï¼Œå› ä¸ºä¸ç®¡è¯»å–å¤šå°‘æ¬¡ï¼Œè¿™ä¸ªå˜é‡çš„å€¼éƒ½ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><p>æˆ‘ä»¬ä¸Šé¢æåˆ°äº†åŸå­æ€§çš„æ¦‚å¿µï¼Œä½ å¯ä»¥æŠŠ<code>åŸå­æ€§</code>æ“ä½œæƒ³è±¡æˆä¸ºä¸€ä¸ª<code>ä¸å¯åˆ†å‰²</code> çš„æ•´ä½“ï¼Œå®ƒçš„ç»“æœåªæœ‰ä¸¤ç§ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚ä½ å¯ä»¥æŠŠåŸå­æ€§è®¤ä¸ºæ˜¯ <code>å©šå§»å…³ç³»</code> çš„ä¸€ç§ï¼Œç”·äººå’Œå¥³äººåªä¼šäº§ç”Ÿä¸¤ç§ç»“æœï¼Œ<code>å¥½å¥½çš„</code> å’Œ <code>è¯´æ•£å°±æ•£</code>ï¼Œä¸€èˆ¬ç”·äººçš„ä¸€ç”Ÿéƒ½å¯ä»¥æŠŠä»–çœ‹æˆæ˜¯åŸå­æ€§çš„ä¸€ç§ï¼Œå½“ç„¶æˆ‘ä»¬ä¸æ’é™¤<code>æ—¶é—´ç®¡ç†(çº¿ç¨‹åˆ‡æ¢)</code>çš„ä¸ªä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“çº¿ç¨‹åˆ‡æ¢å¿…ç„¶ä¼šä¼´éšç€å®‰å…¨æ€§é—®é¢˜ï¼Œç”·äººè¦å‡ºå»æµªä¹Ÿä¼šé€ æˆä¸¤ç§ç»“æœï¼Œè¿™ä¸¤ç§ç»“æœåˆ†åˆ«å¯¹åº”å®‰å…¨æ€§çš„ä¸¤ä¸ªç»“æœï¼šçº¿ç¨‹å®‰å…¨ï¼ˆå¥½å¥½çš„ï¼‰å’Œçº¿ç¨‹ä¸å®‰å…¨ï¼ˆè¯´æ•£å°±æ•£ï¼‰ã€‚</p><h3 id="ç«æ€æ¡ä»¶"><a href="#ç«æ€æ¡ä»¶" class="headerlink" title="ç«æ€æ¡ä»¶"></a>ç«æ€æ¡ä»¶</h3><p>æœ‰äº†ä¸Šé¢çš„çº¿ç¨‹åˆ‡æ¢çš„åŠŸåº•ï¼Œé‚£ä¹ˆç«æ€æ¡ä»¶ä¹Ÿå°±å¥½å®šä¹‰äº†ï¼Œå®ƒæŒ‡çš„å°±æ˜¯<strong>ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œå½±å“ç¨‹åºè¿è¡Œçš„æ­£ç¡®æ€§æ—¶ï¼Œè¿™ç§å°±è¢«ç§°ä¸ºç«æ€æ¡ä»¶(race condition)</strong> ï¼Œçº¿ç¨‹åˆ‡æ¢æ˜¯å¯¼è‡´ç«æ€æ¡ä»¶å‡ºç°çš„è¯±å¯¼å› ç´ ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ï¼Œæ¥çœ‹ä¸€æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RaceCondition</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Signleton single = <span class="keyword">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Signleton <span class="title">newSingleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(single == <span class="keyword">null</span>)&#123;</span><br><span class="line">      single = <span class="keyword">new</span> Signleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> single;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ¶‰åŠåˆ°ä¸€ä¸ªç«æ€æ¡ä»¶ï¼Œé‚£å°±æ˜¯åˆ¤æ–­ <code>single</code> çš„æ—¶å€™ï¼Œå¦‚æœ single åˆ¤æ–­ä¸ºç©ºï¼Œæ­¤æ—¶å‘ç”Ÿäº†çº¿ç¨‹åˆ‡æ¢ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåˆ¤æ–­ single çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ç©ºï¼Œæ‰§è¡Œ new æ“ä½œï¼Œç„¶åçº¿ç¨‹åˆ‡æ¢å›ä¹‹å‰çš„çº¿ç¨‹ï¼Œå†æ‰§è¡Œ new æ“ä½œï¼Œé‚£ä¹ˆå†…å­˜ä¸­å°±ä¼šæœ‰ä¸¤ä¸ª Singleton å¯¹è±¡ã€‚</p><h3 id="åŠ é”æœºåˆ¶"><a href="#åŠ é”æœºåˆ¶" class="headerlink" title="åŠ é”æœºåˆ¶"></a>åŠ é”æœºåˆ¶</h3><p>åœ¨ Java ä¸­ï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼æ¥å¯¹å…±äº«å’Œå¯å˜çš„èµ„æºè¿›è¡ŒåŠ é”å’Œä¿æŠ¤ã€‚Java æä¾›ä¸€ç§å†…ç½®çš„æœºåˆ¶å¯¹èµ„æºè¿›è¡Œä¿æŠ¤ï¼š<code>synchronized</code> å…³é”®å­—ï¼Œå®ƒæœ‰ä¸‰ç§ä¿æŠ¤æœºåˆ¶</p><ul><li>å¯¹æ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ–¹æ³•ï¼›</li><li>å¯¹æŸä¸ªå¯¹è±¡å®ä¾‹ï¼ˆåœ¨æˆ‘ä»¬ä¸Šé¢çš„æ¢è®¨ä¸­ï¼Œå˜é‡å¯ä»¥ä½¿ç”¨å¯¹è±¡æ¥æ›¿æ¢ï¼‰è¿›è¡ŒåŠ é”ï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å¯¹è±¡å®ä¾‹è¿›è¡Œè®¿é—®ï¼›</li><li>å¯¹ç±»å¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®ç±»ä¸­çš„èµ„æºã€‚</li></ul><p>synchronized å…³é”®å­—å¯¹èµ„æºè¿›è¡Œä¿æŠ¤çš„ä»£ç å—ä¿—ç§° <code>åŒæ­¥ä»£ç å—(Synchronized Block)</code>ï¼Œä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line">  <span class="comment">// çº¿ç¨‹å®‰å…¨çš„ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥ç”¨åšä¸€ä¸ªå®ç°åŒæ­¥çš„é”ï¼Œè¿™äº›é”è¢«ç§°ä¸º <code>å†…ç½®é”(Instrinsic Lock)</code>æˆ–è€… <code>ç›‘è§†å™¨é”(Monitor Lock)</code>ã€‚çº¿ç¨‹åœ¨è¿›å…¥åŒæ­¥ä»£ç ä¹‹å‰ä¼šè‡ªåŠ¨è·å¾—é”ï¼Œå¹¶ä¸”åœ¨é€€å‡ºåŒæ­¥ä»£ç æ—¶è‡ªåŠ¨é‡Šæ”¾é”ï¼Œè€Œæ— è®ºæ˜¯é€šè¿‡æ­£å¸¸æ‰§è¡Œè·¯å¾„é€€å‡ºè¿˜æ˜¯é€šè¿‡å¼‚å¸¸è·¯å¾„é€€å‡ºï¼Œè·å¾—å†…ç½®é”çš„å”¯ä¸€é€”å¾„å°±æ˜¯è¿›å…¥è¿™ä¸ªç”±é”ä¿æŠ¤çš„åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ã€‚</p><p>synchronized çš„å¦ä¸€ç§éšå«çš„è¯­ä¹‰å°±æ˜¯ <code>äº’æ–¥</code>ï¼Œäº’æ–¥æ„å‘³ç€<code>ç‹¬å </code>ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œå½“çº¿ç¨‹ A å°è¯•è·å¾—ä¸€ä¸ªç”±çº¿ç¨‹ B æŒæœ‰çš„é”æ—¶ï¼Œçº¿ç¨‹ A å¿…é¡»ç­‰å¾…æˆ–è€…é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹ B é‡Šæ”¾è¿™ä¸ªé”ï¼Œå¦‚æœçº¿ç¨‹ B ä¸é‡Šæ”¾é”çš„è¯ï¼Œé‚£ä¹ˆçº¿ç¨‹ A å°†ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚</p><p>çº¿ç¨‹ A è·å¾—çº¿ç¨‹ B æŒæœ‰çš„é”æ—¶ï¼Œçº¿ç¨‹ A å¿…é¡»ç­‰å¾…æˆ–è€…é˜»å¡ï¼Œä½†æ˜¯è·å–é”çš„çº¿ç¨‹ B å¯ä»¥é‡å…¥ï¼Œé‡å…¥çš„æ„æ€å¯ä»¥ç”¨ä¸€æ®µä»£ç è¡¨ç¤º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Retreent</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>&#123;</span><br><span class="line">    doSomethingElse();</span><br><span class="line">    System.out.println(<span class="string">&quot;doSomething......&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomethingElse</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;doSomethingElse......&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å– doSomething() æ–¹æ³•é”çš„çº¿ç¨‹å¯ä»¥æ‰§è¡Œ doSomethingElse() æ–¹æ³•ï¼Œæ‰§è¡Œå®Œæ¯•åå¯ä»¥é‡æ–°æ‰§è¡Œ doSomething() æ–¹æ³•ä¸­çš„å†…å®¹ã€‚é”é‡å…¥ä¹Ÿæ”¯æŒå­ç±»å’Œçˆ¶ç±»ä¹‹é—´çš„é‡å…¥ï¼Œå…·ä½“çš„æˆ‘ä»¬åé¢ä¼šè¿›è¡Œä»‹ç»ã€‚</p><p><code>volatile</code> æ˜¯ä¸€ç§è½»é‡çº§çš„ <code>synchronized</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§è½»é‡çº§çš„åŠ é”æ–¹å¼ï¼Œvolatile é€šè¿‡ä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§æ¥ä»ä¾§é¢å¯¹å¯¹è±¡è¿›è¡ŒåŠ é”ã€‚å¯è§æ€§çš„æ„æ€å°±æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ä¸€ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿ <code>çœ‹è§</code> è¿™ä¸ªä¿®æ”¹çš„å€¼ã€‚volatile çš„æ‰§è¡Œæˆæœ¬è¦æ¯” <code>synchronized</code> ä½å¾ˆå¤šï¼Œå› ä¸º volatile ä¸ä¼šå¼•èµ·çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/uUfTv7oRhjPwBLz.png" alt="526ad007f30d4ae3b7ed9419497ce879_tplv-k3u1fbpfcp-zoom-1"></p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>åŸå­ç±»</code> æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒåŸå­ç±»å…¶å®å°±æ˜¯ <code>rt.jar</code> ä¸‹é¢ä»¥ <code>atomic</code> å¼€å¤´çš„ç±»</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/3JvDNy8knzPRaFA.png" alt="88cbd9b934514334b039098545dce0df_tplv-k3u1fbpfcp-zoom-1"></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>java.util.concurrent</code> å·¥å…·åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œå…·ä½“çš„å®ç°ç±»å’Œå…¶åŸç†æˆ‘ä»¬åé¢ä¼šè¯´ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¹¶å‘æ¨¡å‹æ¥å®ç°å¹¶å‘ç³»ç»Ÿï¼Œå¹¶å‘æ¨¡å‹è¯´çš„æ˜¯ç³»ç»Ÿä¸­çš„çº¿ç¨‹å¦‚ä½•åä½œå®Œæˆå¹¶å‘ä»»åŠ¡ã€‚ä¸åŒçš„å¹¶å‘æ¨¡å‹ä»¥ä¸åŒçš„æ–¹å¼æ‹†åˆ†ä»»åŠ¡ï¼Œçº¿ç¨‹å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚</p><h2 id="ç«æ€æ¡ä»¶å’Œå…³é”®åŒºåŸŸ"><a href="#ç«æ€æ¡ä»¶å’Œå…³é”®åŒºåŸŸ" class="headerlink" title="ç«æ€æ¡ä»¶å’Œå…³é”®åŒºåŸŸ"></a>ç«æ€æ¡ä»¶å’Œå…³é”®åŒºåŸŸ</h2><p>ç«æ€æ¡ä»¶æ˜¯åœ¨å…³é”®ä»£ç åŒºåŸŸå‘ç”Ÿçš„ä¸€ç§ç‰¹æ®Šæ¡ä»¶ã€‚å…³é”®åŒºåŸŸæ˜¯ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„ä»£ç éƒ¨åˆ†ï¼Œå…³é”®åŒºåŸŸä¸­çš„ä»£ç æ‰§è¡Œé¡ºåºä¼šå¯¹é€ æˆä¸ä¸€æ ·çš„ç»“æœã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ®µå…³é”®ä»£ç ï¼Œè€Œè¿™æ®µå…³é”®ä»£ç ä¼šå› ä¸ºæ‰§è¡Œé¡ºåºä¸åŒè€Œé€ æˆä¸åŒçš„ç»“æœæ—¶ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å°±ä¼šåŒ…å«ç«äº‰æ¡ä»¶ã€‚</p><h2 id="å¹¶å‘æ¨¡å‹å’Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆç›¸ä¼¼"><a href="#å¹¶å‘æ¨¡å‹å’Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆç›¸ä¼¼" class="headerlink" title="å¹¶å‘æ¨¡å‹å’Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆç›¸ä¼¼"></a>å¹¶å‘æ¨¡å‹å’Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆç›¸ä¼¼</h2><p>å¹¶å‘æ¨¡å‹å…¶å®å’Œåˆ†å¸ƒå¼ç³»ç»Ÿæ¨¡å‹éå¸¸ç›¸ä¼¼ï¼Œåœ¨å¹¶å‘æ¨¡å‹ä¸­æ˜¯<code>çº¿ç¨‹</code>å½¼æ­¤è¿›è¡Œé€šä¿¡ï¼Œè€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæ¨¡å‹ä¸­æ˜¯ <code>è¿›ç¨‹</code> å½¼æ­¤è¿›è¡Œé€šä¿¡ã€‚ç„¶è€Œæœ¬è´¨ä¸Šï¼Œè¿›ç¨‹å’Œçº¿ç¨‹ä¹Ÿéå¸¸ç›¸ä¼¼ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¹¶å‘æ¨¡å‹å’Œåˆ†å¸ƒå¼æ¨¡å‹éå¸¸ç›¸ä¼¼çš„åŸå› ã€‚</p><p>åˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸è¦æ¯”å¹¶å‘ç³»ç»Ÿé¢ä¸´æ›´å¤šçš„æŒ‘æˆ˜å’Œé—®é¢˜æ¯”å¦‚è¿›ç¨‹é€šä¿¡ã€ç½‘ç»œå¯èƒ½å‡ºç°å¼‚å¸¸ï¼Œæˆ–è€…è¿œç¨‹æœºå™¨æŒ‚æ‰ç­‰ç­‰ã€‚ä½†æ˜¯ä¸€ä¸ªå¹¶å‘æ¨¡å‹åŒæ ·é¢ä¸´ç€æ¯”å¦‚ CPU æ•…éšœã€ç½‘å¡å‡ºç°é—®é¢˜ã€ç¡¬ç›˜å‡ºç°é—®é¢˜ç­‰ã€‚</p><p>å› ä¸ºå¹¶å‘æ¨¡å‹å’Œåˆ†å¸ƒå¼æ¨¡å‹å¾ˆç›¸ä¼¼ï¼Œå› æ­¤ä»–ä»¬å¯ä»¥ç›¸äº’å€Ÿé‰´ï¼Œä¾‹å¦‚ç”¨äºçº¿ç¨‹åˆ†é…çš„æ¨¡å‹å°±ç±»ä¼¼äºåˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸­çš„è´Ÿè½½å‡è¡¡æ¨¡å‹ã€‚</p><p>å…¶å®è¯´ç™½äº†ï¼Œåˆ†å¸ƒå¼æ¨¡å‹çš„æ€æƒ³å°±æ˜¯å€Ÿé‰´å¹¶å‘æ¨¡å‹çš„åŸºç¡€ä¸Šæ¨æ¼”å‘å±•æ¥çš„ã€‚</p><h2 id="è®¤è¯†ä¸¤ä¸ªçŠ¶æ€"><a href="#è®¤è¯†ä¸¤ä¸ªçŠ¶æ€" class="headerlink" title="è®¤è¯†ä¸¤ä¸ªçŠ¶æ€"></a>è®¤è¯†ä¸¤ä¸ªçŠ¶æ€</h2><p>å¹¶å‘æ¨¡å‹çš„ä¸€ä¸ªé‡è¦çš„æ–¹é¢æ˜¯ï¼Œçº¿ç¨‹æ˜¯å¦åº”è¯¥<code>å…±äº«çŠ¶æ€</code>ï¼Œæ˜¯å…·æœ‰<code>å…±äº«çŠ¶æ€</code>è¿˜æ˜¯<code>ç‹¬ç«‹çŠ¶æ€</code>ã€‚å…±äº«çŠ¶æ€ä¹Ÿå°±æ„å‘³ç€åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å…±äº«æŸäº›çŠ¶æ€</p><p>çŠ¶æ€å…¶å®å°±æ˜¯<code>æ•°æ®</code>ï¼Œæ¯”å¦‚ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¯¹è±¡ã€‚å½“çº¿ç¨‹è¦å…±äº«æ•°æ®æ—¶ï¼Œå°±ä¼šé€ æˆ <code>ç«æ€æ¡ä»¶</code> æˆ–è€… <code>æ­»é”</code> ç­‰é—®é¢˜ã€‚å½“ç„¶ï¼Œè¿™äº›é—®é¢˜åªæ˜¯å¯èƒ½ä¼šå‡ºç°ï¼Œå…·ä½“å®ç°æ–¹å¼å–å†³äºä½ æ˜¯å¦å®‰å…¨çš„ä½¿ç”¨å’Œè®¿é—®å…±äº«å¯¹è±¡ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/zbjAdaQH1FEetkS.png" alt="d7524f66939846579bf85e7f4a1a801d_tplv-k3u1fbpfcp-zoom-1"><br>ç‹¬ç«‹çš„çŠ¶æ€è¡¨æ˜çŠ¶æ€ä¸ä¼šåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œå¦‚æœçº¿ç¨‹ä¹‹é—´éœ€è¦é€šä¿¡çš„è¯ï¼Œä»–ä»¬å¯ä»¥è®¿é—®ä¸å¯å˜çš„å¯¹è±¡æ¥å®ç°ï¼Œè¿™æ˜¯æœ€æœ‰æ•ˆçš„é¿å…å¹¶å‘é—®é¢˜çš„ä¸€ç§æ–¹å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/4wWYgfpeZvrKaJ3.png" alt="eef9af1d393b4034b21bfe37a27dd79d_tplv-k3u1fbpfcp-zoom-1"></p><p>ä½¿ç”¨ç‹¬ç«‹çŠ¶æ€è®©æˆ‘ä»¬çš„è®¾è®¡æ›´åŠ ç®€å•ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®å¯¹è±¡ï¼Œå³ä½¿äº¤æ¢å¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„å¯¹è±¡ã€‚</p><h2 id="å¹¶å‘æ¨¡å‹"><a href="#å¹¶å‘æ¨¡å‹" class="headerlink" title="å¹¶å‘æ¨¡å‹"></a>å¹¶å‘æ¨¡å‹</h2><h3 id="å¹¶è¡Œ-Worker"><a href="#å¹¶è¡Œ-Worker" class="headerlink" title="å¹¶è¡Œ Worker"></a>å¹¶è¡Œ Worker</h3><p>ç¬¬ä¸€ä¸ªå¹¶å‘æ¨¡å‹æ˜¯å¹¶è¡Œ worker æ¨¡å‹ï¼Œå®¢æˆ·ç«¯ä¼šæŠŠä»»åŠ¡äº¤ç»™ <code>ä»£ç†äºº(Delegator)</code>ï¼Œç„¶åç”±ä»£ç†äººæŠŠå·¥ä½œåˆ†é…ç»™ä¸åŒçš„ <code>å·¥äºº(worker)</code>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/YGCcIWVlJOKqdug.png" alt="13f7dbb7dab743d4bcaf54b8adf9bca0_tplv-k3u1fbpfcp-zoom-1"></p><p>å¹¶è¡Œ worker çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå®ƒä¸»è¦æœ‰ä¸¤ä¸ªè¿›ç¨‹å³ä»£ç†äººå’Œå·¥äººï¼ŒDelegator è´Ÿè´£æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„ä»»åŠ¡å¹¶æŠŠä»»åŠ¡ä¸‹å‘ï¼Œäº¤ç»™å…·ä½“çš„ Worker è¿›è¡Œå¤„ç†ï¼ŒWorker å¤„ç†å®ŒæˆåæŠŠç»“æœè¿”å›ç»™ Delegatorï¼Œåœ¨ Delegator æ¥æ”¶åˆ° Worker å¤„ç†çš„ç»“æœåå¯¹å…¶è¿›è¡Œæ±‡æ€»ï¼Œç„¶åäº¤ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¹¶è¡Œ Worker æ¨¡å‹æ˜¯ Java å¹¶å‘æ¨¡å‹ä¸­éå¸¸å¸¸è§çš„ä¸€ç§æ¨¡å‹ã€‚è®¸å¤š <code>java.util.concurrent</code> åŒ…ä¸‹çš„å¹¶å‘å·¥å…·éƒ½ä½¿ç”¨äº†è¿™ç§æ¨¡å‹ã€‚</p><h4 id="å¹¶è¡Œ-Worker-çš„ä¼˜ç‚¹"><a href="#å¹¶è¡Œ-Worker-çš„ä¼˜ç‚¹" class="headerlink" title="å¹¶è¡Œ Worker çš„ä¼˜ç‚¹"></a>å¹¶è¡Œ Worker çš„ä¼˜ç‚¹</h4><p>å¹¶è¡Œ Worker æ¨¡å‹çš„ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„å¹¶è¡Œåº¦ä½ å¯ä»¥å¢åŠ å¤šä¸ª Worker å®Œæˆä»»åŠ¡ã€‚</p><p>å¹¶è¡Œ Worker æ¨¡å‹çš„å¦å¤–ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œå®ƒä¼šå°†ä¸€ä¸ªä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œå¹¶å‘æ‰§è¡Œï¼ŒDelegator åœ¨æ¥å—åˆ° Worker çš„å¤„ç†ç»“æœåå°±ä¼šè¿”å›ç»™ Clientï¼Œæ•´ä¸ª Worker -&gt; Delegator -&gt; Client çš„è¿‡ç¨‹æ˜¯<code>å¼‚æ­¥</code>çš„ã€‚</p><h4 id="å¹¶è¡Œ-Worker-çš„ç¼ºç‚¹"><a href="#å¹¶è¡Œ-Worker-çš„ç¼ºç‚¹" class="headerlink" title="å¹¶è¡Œ Worker çš„ç¼ºç‚¹"></a>å¹¶è¡Œ Worker çš„ç¼ºç‚¹</h4><p>åŒæ ·çš„ï¼Œå¹¶è¡Œ Worker æ¨¡å¼åŒæ ·ä¼šæœ‰ä¸€äº›éšè—çš„ç¼ºç‚¹</p><p><strong>å…±äº«çŠ¶æ€ä¼šå˜å¾—å¾ˆå¤æ‚</strong></p><p>å®é™…çš„å¹¶è¡Œ Worker è¦æ¯”æˆ‘ä»¬å›¾ä¸­ç”»å‡ºçš„æ›´å¤æ‚ï¼Œä¸»è¦æ˜¯å¹¶è¡Œ Worker é€šå¸¸ä¼šè®¿é—®å†…å­˜æˆ–å…±äº«æ•°æ®åº“ä¸­çš„æŸäº›å…±äº«æ•°æ®ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/K9WgthEsODpkf3Q.png" alt="a7168759b7754ddfa50f3e4e31fe5d73_tplv-k3u1fbpfcp-zoom-1"></p><p>è¿™äº›å…±äº«çŠ¶æ€å¯èƒ½ä¼šä½¿ç”¨ä¸€äº›å·¥ä½œé˜Ÿåˆ—æ¥ä¿å­˜ä¸šåŠ¡æ•°æ®ã€æ•°æ®ç¼“å­˜ã€æ•°æ®åº“çš„è¿æ¥æ± ç­‰ã€‚åœ¨çº¿ç¨‹é€šä¿¡ä¸­ï¼Œçº¿ç¨‹éœ€è¦ç¡®ä¿å…±äº«çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿè®©å…¶ä»–çº¿ç¨‹å…±äº«ï¼Œè€Œä¸æ˜¯ä»…ä»…åœç•™åœ¨ CPU ç¼“å­˜ä¸­è®©è‡ªå·±å¯ç”¨ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯ç¨‹åºå‘˜åœ¨è®¾è®¡æ—¶å°±éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚çº¿ç¨‹éœ€è¦é¿å… <code>ç«æ€æ¡ä»¶</code>ï¼Œ<code>æ­»é”</code> å’Œè®¸å¤šå…¶ä»–å…±äº«çŠ¶æ€é€ æˆçš„å¹¶å‘é—®é¢˜ã€‚</p><p>å¤šçº¿ç¨‹åœ¨è®¿é—®å…±äº«æ•°æ®æ—¶ï¼Œä¼šä¸¢å¤±å¹¶å‘æ€§ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè¦ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´å…±äº«æ•°æ®çš„äº‰ç”¨å’ŒæŠ¢å ã€‚æœªæŠ¢å åˆ°èµ„æºçš„çº¿ç¨‹ä¼š <code>é˜»å¡</code>ã€‚</p><p>ç°ä»£çš„éé˜»å¡å¹¶å‘ç®—æ³•å¯ä»¥å‡å°‘äº‰ç”¨æé«˜æ€§èƒ½ï¼Œä½†æ˜¯éé˜»å¡ç®—æ³•æ¯”è¾ƒéš¾ä»¥å®ç°ã€‚</p><p><code>å¯æŒä¹…åŒ–çš„æ•°æ®ç»“æ„(Persistent data structures)</code> æ˜¯å¦å¤–ä¸€ä¸ªé€‰æ‹©ã€‚å¯æŒä¹…åŒ–çš„æ•°æ®ç»“æ„åœ¨ä¿®æ”¹åå§‹ç»ˆä¼šä¿ç•™å…ˆå‰ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸€ä¸ªå¯æŒä¹…åŒ–çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œåˆ™ä¿®æ”¹çš„çº¿ç¨‹ä¼šè·å¾—å¯¹æ–°æ•°æ®ç»“æ„çš„å¼•ç”¨ã€‚</p><p>è™½ç„¶å¯æŒä¹…åŒ–çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªæ–°çš„è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å®è¡Œèµ·æ¥å´æœ‰ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªæŒä¹…åˆ—è¡¨ä¼šå°†æ–°å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„å¼€å¤´ï¼Œå¹¶è¿”å›æ‰€æ·»åŠ çš„æ–°å…ƒç´ çš„å¼•ç”¨ï¼Œä½†æ˜¯å…¶ä»–çº¿ç¨‹ä»ç„¶åªæŒæœ‰åˆ—è¡¨ä¸­å…ˆå‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ï¼Œä»–ä»¬çœ‹ä¸åˆ°æ–°æ·»åŠ çš„å…ƒç´ ã€‚</p><p>æŒä¹…åŒ–çš„æ•°æ®ç»“æ„æ¯”å¦‚ <code>é“¾è¡¨(LinkedList)</code> åœ¨ç¡¬ä»¶æ€§èƒ½ä¸Šè¡¨ç°ä¸ä½³ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æ•£å¸ƒåœ¨è®¡ç®—æœºå†…å­˜ä¸­ã€‚ç°ä»£ CPU çš„é¡ºåºè®¿é—®å¾€å¾€è¦å¿«çš„å¤šï¼Œå› æ­¤ä½¿ç”¨æ•°ç»„ç­‰é¡ºåºè®¿é—®çš„æ•°æ®ç»“æ„åˆ™èƒ½å¤Ÿè·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚CPU é«˜é€Ÿç¼“å­˜å¯ä»¥å°†ä¸€ä¸ªå¤§çš„çŸ©é˜µå—åŠ è½½åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå¹¶è®© CPU åœ¨åŠ è½½åç›´æ¥è®¿é—® CPU é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®ã€‚å¯¹äºé“¾è¡¨ï¼Œå°†å…ƒç´ åˆ†æ•£åœ¨æ•´ä¸ª RAM ä¸Šï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p><strong>æ— çŠ¶æ€çš„ worker</strong></p><p>å…±äº«çŠ¶æ€å¯ä»¥ç”±å…¶ä»–çº¿ç¨‹æ‰€ä¿®æ”¹ï¼Œå› æ­¤ï¼Œworker å¿…é¡»åœ¨æ¯æ¬¡æ“ä½œå…±äº«çŠ¶æ€æ—¶é‡æ–°è¯»å–ï¼Œä»¥ç¡®ä¿åœ¨å‰¯æœ¬ä¸Šèƒ½å¤Ÿæ­£ç¡®å·¥ä½œã€‚ä¸åœ¨çº¿ç¨‹å†…éƒ¨ä¿æŒçŠ¶æ€çš„ worker æˆä¸ºæ— çŠ¶æ€çš„ workerã€‚</p><p><strong>ä½œä¸šé¡ºåºæ˜¯ä¸ç¡®å®šçš„</strong></p><p>å¹¶è¡Œå·¥ä½œæ¨¡å‹çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ä½œä¸šçš„é¡ºåºä¸ç¡®å®šï¼Œæ— æ³•ä¿è¯é¦–å…ˆæ‰§è¡Œæˆ–æœ€åæ‰§è¡Œå“ªäº›ä½œä¸šã€‚ä»»åŠ¡ A åœ¨ä»»åŠ¡ B ä¹‹å‰åˆ†é…ç»™ workerï¼Œä½†æ˜¯ä»»åŠ¡ B å¯èƒ½åœ¨ä»»åŠ¡ A ä¹‹å‰æ‰§è¡Œã€‚</p><h3 id="æµæ°´çº¿"><a href="#æµæ°´çº¿" class="headerlink" title="æµæ°´çº¿"></a>æµæ°´çº¿</h3><p>ç¬¬äºŒç§å¹¶å‘æ¨¡å‹å°±æ˜¯æˆ‘ä»¬ç»å¸¸åœ¨ç”Ÿäº§è½¦é—´é‡åˆ°çš„ <code>æµæ°´çº¿å¹¶å‘æ¨¡å‹</code>ï¼Œä¸‹é¢æ˜¯æµæ°´çº¿è®¾è®¡æ¨¡å‹çš„æµç¨‹å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/3AzKE4WknQHD7xt.png" alt="f5f95a91ebb545dc8ed501314b8de20e_tplv-k3u1fbpfcp-zoom-1"></p><p>è¿™ç§ç»„ç»‡æ¶æ„å°±åƒæ˜¯å·¥å‚ä¸­è£…é…çº¿ä¸­çš„ workerï¼Œæ¯ä¸ª worker åªå®Œæˆå…¨éƒ¨å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œå®Œæˆä¸€éƒ¨åˆ†åï¼Œworker ä¼šå°†å·¥ä½œè½¬å‘ç»™ä¸‹ä¸€ä¸ª workerã€‚</p><p>æ¯é“ç¨‹åºéƒ½åœ¨è‡ªå·±çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œå½¼æ­¤ä¹‹é—´ä¸ä¼šå…±äº«çŠ¶æ€ï¼Œè¿™ç§æ¨¡å‹ä¹Ÿè¢«ç§°ä¸ºæ— å…±äº«å¹¶å‘æ¨¡å‹ã€‚</p><p>ä½¿ç”¨æµæ°´çº¿å¹¶å‘æ¨¡å‹é€šå¸¸è¢«è®¾è®¡ä¸º<code>éé˜»å¡I/O</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ²¡æœ‰ç»™ worker åˆ†é…ä»»åŠ¡æ—¶ï¼Œworker ä¼šåšå…¶ä»–å·¥ä½œã€‚éé˜»å¡I/O æ„å‘³ç€å½“ worker å¼€å§‹ I/O æ“ä½œï¼Œä¾‹å¦‚ä»ç½‘ç»œä¸­è¯»å–æ–‡ä»¶ï¼Œworker ä¸ä¼šç­‰å¾… I/O è°ƒç”¨å®Œæˆã€‚å› ä¸º I/O æ“ä½œå¾ˆæ…¢ï¼Œæ‰€ä»¥ç­‰å¾… I/O éå¸¸è€—è´¹æ—¶é—´ã€‚åœ¨ç­‰å¾… I/O çš„åŒæ—¶ï¼ŒCPU å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼ŒI/O æ“ä½œå®Œæˆåçš„ç»“æœå°†ä¼ é€’ç»™ä¸‹ä¸€ä¸ª workerã€‚ä¸‹é¢æ˜¯éé˜»å¡ I/O çš„æµç¨‹å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/BXifTrpo7kHlSLK.png" alt="6f07fa8ce9b846b6b558070fd03cd612_tplv-k3u1fbpfcp-zoom-1"></p><p>åœ¨å®é™…æƒ…å†µä¸­ï¼Œä»»åŠ¡é€šå¸¸ä¸ä¼šæŒ‰ç€ä¸€æ¡è£…é…çº¿æµåŠ¨ï¼Œç”±äºå¤§å¤šæ•°ç¨‹åºéœ€è¦åšå¾ˆå¤šäº‹æƒ…ï¼Œå› æ­¤éœ€è¦æ ¹æ®å®Œæˆçš„ä¸åŒå·¥ä½œåœ¨ä¸åŒçš„ worker ä¹‹é—´æµåŠ¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/Gwfxork2ODgQecP.png" alt="d3b9ee0be6834771bfda46f744700076_tplv-k3u1fbpfcp-zoom-1"></p><p>ä»»åŠ¡è¿˜å¯èƒ½éœ€è¦å¤šä¸ª worker å…±åŒå‚ä¸å®Œæˆ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/kdqJHOhP6YjxLfv.png" alt="bbb73ee024ae4417b6889666a6e9e68e_tplv-k3u1fbpfcp-zoom-1"></p><h4 id="å“åº”å¼-äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ"><a href="#å“åº”å¼-äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ" class="headerlink" title="å“åº”å¼ - äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ"></a>å“åº”å¼ - äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ</h4><p>ä½¿ç”¨æµæ°´çº¿æ¨¡å‹çš„ç³»ç»Ÿæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º <code>å“åº”å¼</code> æˆ–è€… <code>äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ</code>ï¼Œè¿™ç§æ¨¡å‹ä¼šæ ¹æ®å¤–éƒ¨çš„äº‹ä»¶ä½œå‡ºå“åº”ï¼Œäº‹ä»¶å¯èƒ½æ˜¯æŸä¸ª HTTP è¯·æ±‚æˆ–è€…æŸä¸ªæ–‡ä»¶å®ŒæˆåŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h4 id="Actor-æ¨¡å‹"><a href="#Actor-æ¨¡å‹" class="headerlink" title="Actor æ¨¡å‹"></a>Actor æ¨¡å‹</h4><p>åœ¨ Actor æ¨¡å‹ä¸­ï¼Œæ¯ä¸€ä¸ª Actor å…¶å®å°±æ˜¯ä¸€ä¸ª Workerï¼Œ æ¯ä¸€ä¸ª Actor éƒ½èƒ½å¤Ÿå¤„ç†ä»»åŠ¡ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒActor æ¨¡å‹æ˜¯ä¸€ä¸ªå¹¶å‘æ¨¡å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—ç³»ç»Ÿç»„ä»¶åº”è¯¥å¦‚ä½•åŠ¨ä½œå’Œäº¤äº’çš„é€šç”¨è§„åˆ™ï¼Œæœ€è‘—åçš„ä½¿ç”¨è¿™å¥—è§„åˆ™çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Erlangã€‚ä¸€ä¸ªå‚ä¸è€…<code>Actor</code>å¯¹æ¥æ”¶åˆ°çš„æ¶ˆæ¯åšå‡ºå“åº”ï¼Œç„¶åå¯ä»¥åˆ›å»ºå‡ºæ›´å¤šçš„ Actor æˆ–å‘é€æ›´å¤šçš„æ¶ˆæ¯ï¼ŒåŒæ—¶å‡†å¤‡æ¥æ”¶ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/xczXKkt3nVUHaSs.png" alt="1ca5cc858ac84eaa97d78bd9d1e1ef8f_tplv-k3u1fbpfcp-zoom-1"></p><h4 id="Channels-æ¨¡å‹"><a href="#Channels-æ¨¡å‹" class="headerlink" title="Channels æ¨¡å‹"></a>Channels æ¨¡å‹</h4><p>åœ¨ Channel æ¨¡å‹ä¸­ï¼Œworker é€šå¸¸ä¸ä¼šç›´æ¥é€šä¿¡ï¼Œä¸æ­¤ç›¸å¯¹çš„ï¼Œä»–ä»¬é€šå¸¸å°†äº‹ä»¶å‘é€åˆ°ä¸åŒçš„ <code>é€šé“(Channel)</code>ä¸Šï¼Œç„¶åå…¶ä»– worker å¯ä»¥åœ¨è¿™äº›é€šé“ä¸Šè·å–æ¶ˆæ¯ï¼Œä¸‹é¢æ˜¯ Channel çš„æ¨¡å‹å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/xNryCdE7a2ghnkO.png" alt="7b8ea6ff301c4e2eb3f91bdbb1106f7b_tplv-k3u1fbpfcp-zoom-1"></p><p>æœ‰çš„æ—¶å€™ worker ä¸éœ€è¦æ˜ç¡®çŸ¥é“æ¥ä¸‹æ¥çš„ worker æ˜¯è°ï¼Œä»–ä»¬åªéœ€è¦å°†ä½œè€…å†™å…¥é€šé“ä¸­ï¼Œç›‘å¬ Channel çš„ worker å¯ä»¥è®¢é˜…æˆ–è€…å–æ¶ˆè®¢é˜…ï¼Œè¿™ç§æ–¹å¼é™ä½äº† worker å’Œ worker ä¹‹é—´çš„è€¦åˆæ€§ã€‚</p><h4 id="æµæ°´çº¿è®¾è®¡çš„ä¼˜ç‚¹"><a href="#æµæ°´çº¿è®¾è®¡çš„ä¼˜ç‚¹" class="headerlink" title="æµæ°´çº¿è®¾è®¡çš„ä¼˜ç‚¹"></a>æµæ°´çº¿è®¾è®¡çš„ä¼˜ç‚¹</h4><p>ä¸å¹¶è¡Œè®¾è®¡æ¨¡å‹ç›¸æ¯”ï¼Œæµæ°´çº¿æ¨¡å‹å…·æœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œå…·ä½“ä¼˜åŠ¿å¦‚ä¸‹</p><p><strong>ä¸ä¼šå­˜åœ¨å…±äº«çŠ¶æ€</strong></p><p>å› ä¸ºæµæ°´çº¿è®¾è®¡èƒ½å¤Ÿä¿è¯ worker åœ¨å¤„ç†å®Œæˆåå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ª workerï¼Œæ‰€ä»¥ worker ä¸ worker ä¹‹é—´ä¸éœ€è¦å…±äº«ä»»ä½•çŠ¶æ€ï¼Œä¹Ÿå°±æ— éœ€è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚ä½ ç”šè‡³å¯ä»¥åœ¨å®ç°ä¸ŠæŠŠæ¯ä¸ª worker çœ‹æˆæ˜¯å•çº¿ç¨‹çš„ä¸€ç§ã€‚</p><p><strong>æœ‰çŠ¶æ€ worker</strong></p><p>å› ä¸º worker çŸ¥é“æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è‡ªèº«çš„æ•°æ®ï¼Œæ‰€ä»¥æµæ°´çº¿è®¾è®¡ä¸­çš„ worker æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæœ‰çŠ¶æ€çš„æ„æ€æ˜¯ä»–ä»¬å¯ä»¥å°†éœ€è¦æ“ä½œçš„æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œæœ‰çŠ¶æ€é€šå¸¸æ¯”æ— çŠ¶æ€æ›´å¿«ã€‚</p><p><strong>æ›´å¥½çš„ç¡¬ä»¶æ•´åˆ</strong></p><p>å› ä¸ºä½ å¯ä»¥æŠŠæµæ°´çº¿çœ‹æˆæ˜¯å•çº¿ç¨‹çš„ï¼Œè€Œå•çº¿ç¨‹çš„å·¥ä½œä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿå’Œç¡¬ä»¶çš„å·¥ä½œæ–¹å¼ç›¸åŒã€‚å› ä¸ºæœ‰çŠ¶æ€çš„ worker é€šå¸¸åœ¨ CPU ä¸­ç¼“å­˜æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«åœ°è®¿é—®ç¼“å­˜çš„æ•°æ®ã€‚</p><p><strong>ä½¿ä»»åŠ¡æ›´åŠ æœ‰æ•ˆçš„è¿›è¡Œ</strong></p><p>å¯ä»¥å¯¹æµæ°´çº¿å¹¶å‘æ¨¡å‹ä¸­çš„ä»»åŠ¡è¿›è¡Œæ’åºï¼Œä¸€èˆ¬ç”¨æ¥æ—¥å¿—çš„å†™å…¥å’Œæ¢å¤ã€‚</p><h4 id="æµæ°´çº¿è®¾è®¡çš„ç¼ºç‚¹"><a href="#æµæ°´çº¿è®¾è®¡çš„ç¼ºç‚¹" class="headerlink" title="æµæ°´çº¿è®¾è®¡çš„ç¼ºç‚¹"></a>æµæ°´çº¿è®¾è®¡çš„ç¼ºç‚¹</h4><p>æµæ°´çº¿å¹¶å‘æ¨¡å‹çš„ç¼ºç‚¹æ˜¯ä»»åŠ¡ä¼šæ¶‰åŠå¤šä¸ª workerï¼Œå› æ­¤å¯èƒ½ä¼šåˆ†æ•£åœ¨é¡¹ç›®ä»£ç çš„å¤šä¸ªç±»ä¸­ã€‚å› æ­¤å¾ˆéš¾ç¡®å®šæ¯ä¸ª worker éƒ½åœ¨æ‰§è¡Œå“ªä¸ªä»»åŠ¡ã€‚æµæ°´çº¿çš„ä»£ç ç¼–å†™ä¹Ÿæ¯”è¾ƒå›°éš¾ï¼Œè®¾è®¡è®¸å¤šåµŒå¥—å›è°ƒå¤„ç†ç¨‹åºçš„ä»£ç é€šå¸¸è¢«ç§°ä¸º <code>å›è°ƒåœ°ç‹±</code>ã€‚å›è°ƒåœ°ç‹±å¾ˆéš¾è¿½è¸ª debugã€‚</p><h2 id="å‡½æ•°æ€§å¹¶è¡Œ"><a href="#å‡½æ•°æ€§å¹¶è¡Œ" class="headerlink" title="å‡½æ•°æ€§å¹¶è¡Œ"></a>å‡½æ•°æ€§å¹¶è¡Œ</h2><p>å‡½æ•°æ€§å¹¶è¡Œæ¨¡å‹æ˜¯æœ€è¿‘æ‰æå‡ºçš„ä¸€ç§å¹¶å‘æ¨¡å‹ï¼Œå®ƒçš„åŸºæœ¬æ€è·¯æ˜¯ä½¿ç”¨å‡½æ•°è°ƒç”¨æ¥å®ç°ã€‚æ¶ˆæ¯çš„ä¼ é€’å°±ç›¸å½“äºæ˜¯å‡½æ•°çš„è°ƒç”¨ã€‚ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°éƒ½ä¼šè¢«æ‹·è´ï¼Œå› æ­¤åœ¨å‡½æ•°ä¹‹å¤–çš„ä»»ä½•å®ä½“éƒ½æ— æ³•æ“çºµå‡½æ•°å†…çš„æ•°æ®ã€‚è¿™ä½¿å¾—å‡½æ•°æ‰§è¡Œç±»ä¼¼äº<code>åŸå­</code>æ“ä½œã€‚æ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½å¯ä»¥ç‹¬ç«‹äºä»»ä½•å…¶ä»–å‡½æ•°è°ƒç”¨æ‰§è¡Œã€‚</p><p>å½“æ¯ä¸ªå‡½æ•°è°ƒç”¨ç‹¬ç«‹æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥åœ¨å•ç‹¬çš„ CPU ä¸Šæ‰§è¡Œã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°å¼å¹¶è¡Œå¹¶è¡Œç›¸å½“äºæ˜¯å„ä¸ª CPU å•ç‹¬æ‰§è¡Œå„è‡ªçš„ä»»åŠ¡ã€‚</p><p>JDK 1.7 ä¸­çš„ <code>ForkAndJoinPool</code> ç±»å°±å®ç°äº†å‡½æ•°æ€§å¹¶è¡Œçš„åŠŸèƒ½ã€‚Java 8 æå‡ºäº† stream çš„æ¦‚å¿µï¼Œä½¿ç”¨å¹¶è¡Œæµä¹Ÿèƒ½å¤Ÿå®ç°å¤§é‡é›†åˆçš„è¿­ä»£ã€‚</p><p>å‡½æ•°æ€§å¹¶è¡Œçš„éš¾ç‚¹æ˜¯è¦çŸ¥é“å‡½æ•°çš„è°ƒç”¨æµç¨‹ä»¥åŠå“ªäº› CPU æ‰§è¡Œäº†å“ªäº›å‡½æ•°ï¼Œè·¨ CPU å‡½æ•°è°ƒç”¨ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œçº¿ç¨‹å°±æ˜¯è¿›ç¨‹ä¸­çš„ä¸€æ¡<code>é¡ºåºæµ</code>ï¼Œåœ¨ Java ä¸­ï¼Œæ¯ä¸€æ¡ Java çº¿ç¨‹å°±åƒæ˜¯ JVM çš„ä¸€æ¡é¡ºåºæµï¼Œå°±åƒæ˜¯è™šæ‹Ÿ CPU ä¸€æ ·æ¥æ‰§è¡Œä»£ç ã€‚Java ä¸­çš„ <code>main()</code> æ–¹æ³•æ˜¯ä¸€æ¡ç‰¹æ®Šçš„çº¿ç¨‹ï¼ŒJVM åˆ›å»ºçš„ main çº¿ç¨‹æ˜¯ä¸€æ¡<code>ä¸»æ‰§è¡Œçº¿ç¨‹</code>ï¼Œåœ¨ Java ä¸­ï¼Œæ–¹æ³•éƒ½æ˜¯ç”± main æ–¹æ³•å‘èµ·çš„ã€‚åœ¨ main æ–¹æ³•ä¸­ï¼Œä½ ç…§æ ·å¯ä»¥åˆ›å»ºå…¶ä»–çš„<code>çº¿ç¨‹</code>(æ‰§è¡Œé¡ºåºæµ)ï¼Œè¿™äº›çº¿ç¨‹å¯ä»¥å’Œ main æ–¹æ³•å…±åŒæ‰§è¡Œåº”ç”¨ä»£ç ã€‚</p><p>Java çº¿ç¨‹ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡ï¼Œå®ƒå’Œå…¶ä»–å¯¹è±¡ä¸€æ ·ã€‚Java ä¸­çš„ Thread è¡¨ç¤ºçº¿ç¨‹ï¼ŒThread æ˜¯ <code>java.lang.Thread</code> ç±»æˆ–å…¶å­ç±»çš„å®ä¾‹ã€‚é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±æ¥ä¸€èµ·æ¢è®¨ä¸€ä¸‹åœ¨ Java ä¸­å¦‚ä½•åˆ›å»ºå’Œå¯åŠ¨çº¿ç¨‹ã€‚</p><h2 id="åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹"><a href="#åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹" class="headerlink" title="åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹"></a>åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</h2><p>åœ¨ Java ä¸­ï¼Œåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§</p><ul><li>é€šè¿‡ç»§æ‰¿ <code>Thread</code> ç±»æ¥åˆ›å»ºçº¿ç¨‹</li><li>é€šè¿‡å®ç° <code>Runnable</code> æ¥å£æ¥åˆ›å»ºçº¿ç¨‹</li><li>é€šè¿‡ <code>Callable</code> å’Œ <code>Future</code> æ¥åˆ›å»ºçº¿ç¨‹</li></ul><p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¢è®¨ä¸€ä¸‹è¿™å‡ ç§åˆ›å»ºæ–¹å¼</p><h3 id="ç»§æ‰¿-Thread-ç±»æ¥åˆ›å»ºçº¿ç¨‹"><a href="#ç»§æ‰¿-Thread-ç±»æ¥åˆ›å»ºçº¿ç¨‹" class="headerlink" title="ç»§æ‰¿ Thread ç±»æ¥åˆ›å»ºçº¿ç¨‹"></a>ç»§æ‰¿ Thread ç±»æ¥åˆ›å»ºçº¿ç¨‹</h3><p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç»§æ‰¿ Thread ç±»æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚ä¸‹ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TJavaThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">10000</span>;i++)&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        TJavaThread tJavaThread = <span class="keyword">new</span> TJavaThread();</span><br><span class="line">        tJavaThread.start();</span><br><span class="line">        tJavaThread.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹çš„ä¸»è¦åˆ›å»ºæ­¥éª¤å¦‚ä¸‹</p><ul><li>å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç±»ä½¿å…¶ç»§æ‰¿ Thread ç±»ï¼Œå¹¶é‡å†™å…¶ä¸­çš„ run æ–¹æ³•ï¼Œrun æ–¹æ³•å†…éƒ¨å°±æ˜¯çº¿ç¨‹è¦å®Œæˆçš„ä»»åŠ¡ï¼Œå› æ­¤ run æ–¹æ³•ä¹Ÿè¢«ç§°ä¸º <code>æ‰§è¡Œä½“</code></li><li>åˆ›å»ºäº† Thread çš„å­ç±»ï¼Œä¸Šé¢ä»£ç ä¸­çš„å­ç±»æ˜¯ <code>TJavaThread</code></li><li>å¯åŠ¨æ–¹æ³•éœ€è¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨ <code>run</code> æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>start</code> æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ã€‚å½“ç„¶ run æ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œè¿™æ ·çš„è¯å°±ä¼šå˜æˆæ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸æ˜¯æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥è°ƒç”¨äº†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">  TJavaThread tJavaThread = <span class="keyword">new</span> TJavaThread();</span><br><span class="line">  tJavaThread.run();</span><br><span class="line">  System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œæ•´ä¸ª main æ–¹æ³•åªæœ‰ä¸€æ¡æ‰§è¡Œçº¿ç¨‹ä¹Ÿå°±æ˜¯ main çº¿ç¨‹ï¼Œç”±ä¸¤æ¡æ‰§è¡Œçº¿ç¨‹å˜ä¸ºä¸€æ¡æ‰§è¡Œçº¿ç¨‹</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/8XQcNBoHRnptimu.png" alt="4ee5fe1479de4c0e9baf0d9eea20d051_tplv-k3u1fbpfcp-zoom-1"></p><p>Thread æ„é€ å™¨åªéœ€è¦ä¸€ä¸ª Runnable å¯¹è±¡ï¼Œè°ƒç”¨ Thread å¯¹è±¡çš„ start() æ–¹æ³•ä¸ºè¯¥çº¿ç¨‹æ‰§è¡Œå¿…é¡»çš„åˆå§‹åŒ–æ“ä½œï¼Œç„¶åè°ƒç”¨ Runnable çš„ run æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­å¯åŠ¨ä»»åŠ¡ã€‚æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨äº†çº¿ç¨‹çš„ <code>join</code> æ–¹æ³•ï¼Œå®ƒç”¨æ¥ç­‰å¾…çº¿ç¨‹çš„æ‰§è¡Œç»“æŸï¼Œå¦‚æœæˆ‘ä»¬ä¸åŠ  join æ–¹æ³•ï¼Œå®ƒå°±ä¸ä¼šç­‰å¾… tJavaThread çš„æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡ºçš„ç»“æœå¯èƒ½å°±ä¸æ˜¯ <code>10000</code></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/28/lorwFOUDZKRLCny.png" alt="bb3dd164ccde4bc19e60f9cb2171078b_tplv-k3u1fbpfcp-zoom-1"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ run  æ–¹æ³•è¿˜æ²¡æœ‰ç»“æŸå‰ï¼Œrun å°±è¢«è¿”å›äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºä¸ä¼šç­‰åˆ° run æ–¹æ³•æ‰§è¡Œå®Œæ¯•å°±ä¼šæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ã€‚</p><p>ä½¿ç”¨ç»§æ‰¿æ–¹å¼åˆ›å»ºçº¿ç¨‹çš„ä¼˜åŠ¿ï¼šç¼–å†™æ¯”è¾ƒç®€å•ï¼›å¯ä»¥ä½¿ç”¨ <code>this</code> å…³é”®å­—ç›´æ¥æŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œè€Œæ— éœ€ä½¿ç”¨ <code>Thread.currentThread()</code> æ¥è·å–å½“å‰çº¿ç¨‹ã€‚</p><p>ä½¿ç”¨ç»§æ‰¿æ–¹å¼åˆ›å»ºçº¿ç¨‹çš„åŠ£åŠ¿ï¼šåœ¨ Java ä¸­ï¼Œåªå…è®¸å•ç»§æ‰¿ï¼ˆæ‹’ç»è‚›ç²¾è¯´ä½¿ç”¨å†…éƒ¨ç±»å¯ä»¥å®ç°å¤šç»§æ‰¿ï¼‰çš„åŸåˆ™ï¼Œæ‰€ä»¥ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼ï¼Œå­ç±»å°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ã€‚</p><h3 id="ä½¿ç”¨-Runnable-æ¥å£æ¥åˆ›å»ºçº¿ç¨‹"><a href="#ä½¿ç”¨-Runnable-æ¥å£æ¥åˆ›å»ºçº¿ç¨‹" class="headerlink" title="ä½¿ç”¨ Runnable æ¥å£æ¥åˆ›å»ºçº¿ç¨‹"></a>ä½¿ç”¨ Runnable æ¥å£æ¥åˆ›å»ºçº¿ç¨‹</h3><p>ç›¸å¯¹çš„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>Runnable</code> æ¥å£æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚ä¸‹ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TJavaThreadUseImplements</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">10000</span>;i++)&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> TJavaThreadUseImplements()).start();</span><br><span class="line">        System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹çš„ä¸»è¦åˆ›å»ºæ­¥éª¤å¦‚ä¸‹</p><ul><li>é¦–å…ˆå®šä¹‰ Runnable æ¥å£ï¼Œå¹¶é‡å†™ Runnable æ¥å£çš„ run æ–¹æ³•ï¼Œrun æ–¹æ³•çš„æ–¹æ³•ä½“åŒæ ·æ˜¯è¯¥çº¿ç¨‹çš„çº¿ç¨‹æ‰§è¡Œä½“ã€‚</li><li>åˆ›å»ºçº¿ç¨‹å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢ä»£ç è¿™ç§ç®€å•çš„æ–¹å¼åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ new å‡ºçº¿ç¨‹çš„å®ä¾‹æ¥åˆ›å»ºï¼Œå¦‚ä¸‹æ‰€ç¤º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TJavaThreadUseImplements tJavaThreadUseImplements = <span class="keyword">new</span> TJavaThreadUseImplements();</span><br><span class="line"><span class="keyword">new</span> Thread(tJavaThreadUseImplements).start();</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>å†è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ start æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li></ul><p>çº¿ç¨‹åœ¨ä½¿ç”¨å®ç° <code>Runnable</code> çš„åŒæ—¶ä¹Ÿèƒ½å®ç°å…¶ä»–æ¥å£ï¼Œéå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹æ¥å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å†µï¼Œä½“ç°äº†é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚</p><p>ä½¿ç”¨ Runnable å®ç°çš„åŠ£åŠ¿æ˜¯ç¼–ç¨‹ç¨å¾®ç¹çï¼Œå¦‚æœè¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ <code>Thread.currentThread()</code> æ–¹æ³•ã€‚</p><h3 id="ä½¿ç”¨-Callable-æ¥å£æ¥åˆ›å»ºçº¿ç¨‹"><a href="#ä½¿ç”¨-Callable-æ¥å£æ¥åˆ›å»ºçº¿ç¨‹" class="headerlink" title="ä½¿ç”¨ Callable æ¥å£æ¥åˆ›å»ºçº¿ç¨‹"></a>ä½¿ç”¨ Callable æ¥å£æ¥åˆ›å»ºçº¿ç¨‹</h3><p>Runnable æ¥å£æ‰§è¡Œçš„æ˜¯ç‹¬ç«‹çš„ä»»åŠ¡ï¼ŒRunnable æ¥å£ä¸ä¼šäº§ç”Ÿä»»ä½•è¿”å›å€¼ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨ä»»åŠ¡å®Œæˆåèƒ½å¤Ÿè¿”å›ä¸€ä¸ªå€¼çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å®ç° <code>Callable</code> æ¥å£è€Œä¸æ˜¯ Runnable æ¥å£ã€‚Java SE5 å¼•å…¥äº† Callable æ¥å£ï¼Œå®ƒçš„ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableTask</span> <span class="keyword">implements</span> <span class="title">Callable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CallableTask</span><span class="params">(<span class="keyword">int</span> count)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        FutureTask&lt;Integer&gt; task = <span class="keyword">new</span> FutureTask((Callable&lt;Integer&gt;) () -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">1000</span>;i++)&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125;);</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(task);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        Integer total = task.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘æƒ³ï¼Œä½¿ç”¨ Callable æ¥å£çš„å¥½å¤„ä½ å·²ç»çŸ¥é“äº†å§ï¼Œæ—¢èƒ½å¤Ÿå®ç°å¤šä¸ªæ¥å£ï¼Œä¹Ÿèƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œç»“æœçš„è¿”å›å€¼ã€‚Callable å’Œ Runnable æ¥å£è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ï¼Œä¸»è¦åŒºåˆ«å¦‚ä¸‹</p><ul><li>Callable æ‰§è¡Œçš„ä»»åŠ¡æœ‰è¿”å›å€¼ï¼Œè€Œ Runnable æ‰§è¡Œçš„ä»»åŠ¡æ²¡æœ‰è¿”å›å€¼</li><li>Callableï¼ˆé‡å†™ï¼‰çš„æ–¹æ³•æ˜¯ call æ–¹æ³•ï¼Œè€Œ Runnableï¼ˆé‡å†™ï¼‰çš„æ–¹æ³•æ˜¯ run æ–¹æ³•ã€‚</li><li>call æ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ Runnable æ–¹æ³•ä¸èƒ½æŠ›å‡ºå¼‚å¸¸</li></ul><h3 id="ä½¿ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºçº¿ç¨‹"><a href="#ä½¿ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºçº¿ç¨‹" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºçº¿ç¨‹"></a>ä½¿ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºçº¿ç¨‹</h3><p>é¦–å…ˆå…ˆæ¥è®¤è¯†ä¸€ä¸‹é¡¶çº§æ¥å£ <code>Executor</code>ï¼ŒExecutor è™½ç„¶ä¸æ˜¯ä¼ ç»Ÿçº¿ç¨‹åˆ›å»ºçš„æ–¹å¼ä¹‹ä¸€ï¼Œä½†æ˜¯å®ƒå´æˆä¸ºäº†åˆ›å»ºçº¿ç¨‹çš„æ›¿ä»£è€…ï¼Œä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„å¦‚ä¸‹</p><ul><li>åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¤ç”¨çº¿ç¨‹ã€æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ã€‚</li><li>å®ç°ä»»åŠ¡çº¿ç¨‹é˜Ÿåˆ—<code>ç¼“å­˜ç­–ç•¥</code>å’Œ<code>æ‹’ç»æœºåˆ¶</code>ã€‚</li><li>å®ç°æŸäº›ä¸æ—¶é—´ç›¸å…³çš„åŠŸèƒ½ï¼Œå¦‚å®šæ—¶æ‰§è¡Œã€å‘¨æœŸæ‰§è¡Œç­‰ã€‚</li><li>éš”ç¦»çº¿ç¨‹ç¯å¢ƒã€‚æ¯”å¦‚ï¼Œäº¤æ˜“æœåŠ¡å’Œæœç´¢æœåŠ¡åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œåˆ†åˆ«å¼€å¯ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œäº¤æ˜“çº¿ç¨‹çš„èµ„æºæ¶ˆè€—æ˜æ˜¾è¦å¤§ï¼›å› æ­¤ï¼Œé€šè¿‡é…ç½®ç‹¬ç«‹çš„çº¿ç¨‹æ± ï¼Œå°†è¾ƒæ…¢çš„äº¤æ˜“æœåŠ¡ä¸æœç´¢æœåŠ¡éš”å¼€ï¼Œé¿å…ä¸ªæœåŠ¡çº¿ç¨‹äº’ç›¸å½±å“ã€‚</li></ul><p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ“ä½œæ¥æ›¿æ¢çº¿ç¨‹åˆ›å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span>(RunnableTask())).start()</span><br><span class="line"><span class="comment">// æ›¿æ¢ä¸º</span></span><br><span class="line">Executor executor = <span class="keyword">new</span> ExecutorSubClass() <span class="comment">// çº¿ç¨‹æ± å®ç°ç±»;</span></span><br><span class="line">executor.execute(<span class="keyword">new</span> RunnableTask1());</span><br><span class="line">executor.execute(<span class="keyword">new</span> RunnableTask2());</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>ExecutorService</code> æ˜¯ Executor çš„é»˜è®¤å®ç°ï¼Œä¹Ÿæ˜¯ Executor çš„æ‰©å±•æ¥å£ï¼ŒThreadPoolExecutor ç±»æä¾›äº†çº¿ç¨‹æ± çš„æ‰©å±•å®ç°ã€‚<code>Executors</code> ç±»ä¸ºè¿™äº› Executor æä¾›äº†æ–¹ä¾¿çš„å·¥å‚æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ ExecutorService åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼</p><h4 id="CachedThreadPool"><a href="#CachedThreadPool" class="headerlink" title="CachedThreadPool"></a>CachedThreadPool</h4><p>ä»è€Œç®€åŒ–äº†å¹¶å‘ç¼–ç¨‹ã€‚Executor åœ¨å®¢æˆ·ç«¯å’Œä»»åŠ¡ä¹‹é—´æä¾›äº†ä¸€ä¸ªé—´æ¥å±‚ï¼›ä¸å®¢æˆ·ç«¯ç›´æ¥æ‰§è¡Œä»»åŠ¡ä¸åŒï¼Œè¿™ä¸ªä¸­ä»‹å¯¹è±¡å°†æ‰§è¡Œä»»åŠ¡ã€‚Executor å…è®¸ä½ ç®¡ç†<code>å¼‚æ­¥</code>ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— é¡»æ˜¾ç¤ºåœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">    service.execute(<span class="keyword">new</span> TestThread());</span><br><span class="line">  &#125;</span><br><span class="line">  service.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CachedThreadPool</code> ä¼šä¸ºæ¯ä¸ªä»»åŠ¡éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚</p><blockquote><p>æ³¨æ„ï¼šExecutorService å¯¹è±¡æ˜¯ä½¿ç”¨é™æ€çš„ <code>Executors</code> åˆ›å»ºçš„ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç¡®å®š Executor ç±»å‹ã€‚å¯¹ <code>shutDown</code> çš„è°ƒç”¨å¯ä»¥é˜²æ­¢æ–°ä»»åŠ¡æäº¤ç»™ ExecutorService ï¼Œè¿™ä¸ªçº¿ç¨‹åœ¨ Executor ä¸­æ‰€æœ‰ä»»åŠ¡å®Œæˆåé€€å‡ºã€‚</p></blockquote><h4 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h4><p>FixedThreadPool ä½¿ä½ å¯ä»¥ä½¿ç”¨<code>æœ‰é™</code>çš„çº¿ç¨‹é›†æ¥å¯åŠ¨å¤šçº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  ExecutorService service = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">    service.execute(<span class="keyword">new</span> TestThread());</span><br><span class="line">  &#125;</span><br><span class="line">  service.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº† FixedThreadPool ä½¿ä½ å¯ä»¥ä¸€æ¬¡æ€§çš„é¢„å…ˆæ‰§è¡Œé«˜æ˜‚çš„çº¿ç¨‹åˆ†é…ï¼Œå› æ­¤ä¹Ÿå°±å¯ä»¥é™åˆ¶çº¿ç¨‹çš„æ•°é‡ã€‚è¿™å¯ä»¥èŠ‚çœæ—¶é—´ï¼Œå› ä¸ºä½ ä¸å¿…ä¸ºæ¯ä¸ªä»»åŠ¡éƒ½å›ºå®šçš„ä»˜å‡ºåˆ›å»ºçº¿ç¨‹çš„å¼€é”€ã€‚</p><h4 id="SingleThreadExecutor"><a href="#SingleThreadExecutor" class="headerlink" title="SingleThreadExecutor"></a>SingleThreadExecutor</h4><p>SingleThreadExecutor å°±æ˜¯<code>çº¿ç¨‹æ•°é‡ä¸º 1</code>çš„ FixedThreadPoolï¼Œå¦‚æœå‘ SingleThreadPool ä¸€æ¬¡æ€§æäº¤äº†å¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™äº›ä»»åŠ¡å°†ä¼šæ’é˜Ÿï¼Œæ¯ä¸ªä»»åŠ¡éƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹å‰ç»“æŸï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½å°†ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹ã€‚SingleThreadPool ä¼šåºåˆ—åŒ–æ‰€æœ‰æäº¤ç»™ä»–çš„ä»»åŠ¡ï¼Œå¹¶ä¼šç»´æŠ¤å®ƒè‡ªå·±(éšè—)çš„æ‚¬æŒ‚é˜Ÿåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  ExecutorService service = Executors.newSingleThreadExecutor();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">    service.execute(<span class="keyword">new</span> TestThread());</span><br><span class="line">  &#125;</span><br><span class="line">  service.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºçš„ç»“æœå°±å¯ä»¥çœ‹åˆ°ï¼Œä»»åŠ¡éƒ½æ˜¯æŒ¨ç€æ‰§è¡Œçš„ã€‚æˆ‘ä¸ºä»»åŠ¡åˆ†é…äº†äº”ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯è¿™äº”ä¸ªçº¿ç¨‹ä¸åƒæ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„æœ‰æ¢è¿›æ¢å‡ºçš„æ•ˆæœï¼Œå®ƒæ¯æ¬¡éƒ½ä¼šå…ˆæ‰§è¡Œå®Œè‡ªå·±çš„é‚£ä¸ªçº¿ç¨‹ï¼Œç„¶åä½™ä¸‹çš„çº¿ç¨‹ç»§ç»­<code>èµ°å®Œ</code>è¿™æ¡çº¿ç¨‹çš„æ‰§è¡Œè·¯å¾„ã€‚ä½ å¯ä»¥ç”¨ SingleThreadExecutor æ¥ç¡®ä¿ä»»æ„æ—¶åˆ»éƒ½åªæœ‰å”¯ä¸€ä¸€ä¸ªä»»åŠ¡åœ¨è¿è¡Œã€‚</p><h3 id="ä¼‘çœ "><a href="#ä¼‘çœ " class="headerlink" title="ä¼‘çœ "></a>ä¼‘çœ </h3><p>å½±å“ä»»åŠ¡è¡Œä¸ºçš„ä¸€ç§ç®€å•æ–¹å¼å°±æ˜¯ä½¿çº¿ç¨‹ ä¼‘çœ ï¼Œé€‰å®šç»™å®šçš„ä¼‘çœ æ—¶é—´ï¼Œè°ƒç”¨å®ƒçš„ <code>sleep()</code> æ–¹æ³•ï¼Œ ä¸€èˆ¬ä½¿ç”¨çš„<code>TimeUnit</code> è¿™ä¸ªæ—¶é—´ç±»æ›¿æ¢ <code>Thread.sleep()</code> æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuperclassThread</span> <span class="keyword">extends</span> <span class="title">TestThread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread() + <span class="string">&quot;starting ...&quot;</span> );</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">3</span>)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread() + <span class="string">&quot;sleeping ...&quot;</span>);</span><br><span class="line">                    TimeUnit.MILLISECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread() + <span class="string">&quot;wakeup and end ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService executors = Executors.newCachedThreadPool();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">            executors.execute(<span class="keyword">new</span> SuperclassThread());</span><br><span class="line">        &#125;</span><br><span class="line">        executors.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…³äº TimeUnit ä¸­çš„ sleep() æ–¹æ³•å’Œ Thread.sleep() æ–¹æ³•çš„æ¯”è¾ƒï¼Œè¯·å‚è€ƒä¸‹é¢è¿™ç¯‡åšå®¢</p><p>(<a href="https://www.cnblogs.com/xiadongqing/p/9925567.html">www.cnblogs.com/xiadongqingâ€¦</a>)</p></blockquote><h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><p>ä¸Šé¢æåˆ°çº¿ç¨‹è°ƒåº¦å™¨å¯¹æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œéƒ½æ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œéšæœºæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•å‘Šè¯‰çº¿ç¨‹è°ƒåº¦å™¨å“ªä¸ªä»»åŠ¡æƒ³è¦ä¼˜å…ˆè¢«æ‰§è¡Œå‘¢ï¼Ÿä½ å¯ä»¥é€šè¿‡è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§çŠ¶æ€ï¼Œå‘Šè¯‰çº¿ç¨‹è°ƒåº¦å™¨å“ªä¸ªçº¿ç¨‹çš„æ‰§è¡Œä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼Œ<strong>è¯·ç»™è¿™ä¸ªéª‘æ‰‹é©¬ä¸Šæ´¾å•</strong>ï¼Œçº¿ç¨‹è°ƒåº¦å™¨å€¾å‘äºè®©ä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹ä¼˜å…ˆæ‰§è¡Œï¼Œç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä¼˜å…ˆçº§ä½çš„çº¿ç¨‹å¾—ä¸åˆ°æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼˜å…ˆçº§ä¸ä¼šå¯¼è‡´æ­»é”çš„é—®é¢˜ã€‚ä¼˜å…ˆçº§è¾ƒä½çš„çº¿ç¨‹åªæ˜¯æ‰§è¡Œé¢‘ç‡è¾ƒä½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePriorities</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> priority;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimplePriorities</span><span class="params">(<span class="keyword">int</span> priority)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.priority = priority;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread.currentThread().setPriority(priority);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">100</span>;i++)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">10</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                Thread.yield();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread() + <span class="string">&quot; &quot;</span> + priority;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">            service.execute(<span class="keyword">new</span> SimplePriorities(Thread.MAX_PRIORITY));</span><br><span class="line">        &#125;</span><br><span class="line">        service.execute(<span class="keyword">new</span> SimplePriorities(Thread.MIN_PRIORITY));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>toString() æ–¹æ³•è¢«è¦†ç›–ï¼Œä»¥ä¾¿é€šè¿‡ä½¿ç”¨ <code>Thread.toString()</code> æ–¹æ³•æ¥æ‰“å°çº¿ç¨‹çš„åç§°ã€‚ä½ å¯ä»¥æ”¹å†™çº¿ç¨‹çš„é»˜è®¤è¾“å‡ºï¼Œè¿™é‡Œé‡‡ç”¨äº† <strong>Thread[pool-1-thread-1,10,main]</strong> è¿™ç§å½¢å¼çš„è¾“å‡ºã€‚</p><p>é€šè¿‡è¾“å‡ºï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§æœ€ä½ï¼Œå…¶ä½™çš„çº¿ç¨‹ä¼˜å…ˆçº§æœ€é«˜ã€‚æ³¨æ„ï¼Œä¼˜å…ˆçº§æ˜¯åœ¨ run å¼€å¤´è®¾ç½®çš„ï¼Œåœ¨æ„é€ å™¨ä¸­è®¾ç½®å®ƒä»¬ä¸ä¼šæœ‰ä»»ä½•å¥½å¤„ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™çº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œä»»åŠ¡ã€‚</p><p>å°½ç®¡ JDK æœ‰ 10 ä¸ªä¼˜å…ˆçº§ï¼Œä½†æ˜¯ä¸€èˆ¬åªæœ‰<strong>MAX_PRIORITYï¼ŒNORM_PRIORITYï¼ŒMIN_PRIORITY</strong> ä¸‰ç§çº§åˆ«ã€‚</p><h3 id="ä½œå‡ºè®©æ­¥"><a href="#ä½œå‡ºè®©æ­¥" class="headerlink" title="ä½œå‡ºè®©æ­¥"></a>ä½œå‡ºè®©æ­¥</h3><p>æˆ‘ä»¬ä¸Šé¢æè¿‡ï¼Œå¦‚æœçŸ¥é“ä¸€ä¸ªçº¿ç¨‹å·²ç»åœ¨ run() æ–¹æ³•ä¸­è¿è¡Œçš„å·®ä¸å¤šäº†ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥ç»™çº¿ç¨‹è°ƒåº¦å™¨ä¸€ä¸ªæç¤ºï¼šæˆ‘å·²ç»å®Œæˆäº†ä»»åŠ¡ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥è®©ç»™åˆ«çš„çº¿ç¨‹ä½¿ç”¨ CPU äº†ã€‚è¿™ä¸ªæš—ç¤ºå°†é€šè¿‡ yield() æ–¹æ³•ä½œå‡ºã€‚</p><blockquote><p>æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹å°±æ˜¯ï¼ŒThread.yield() æ˜¯å»ºè®®æ‰§è¡Œåˆ‡æ¢CPUï¼Œè€Œä¸æ˜¯å¼ºåˆ¶æ‰§è¡ŒCPUåˆ‡æ¢ã€‚</p></blockquote><p>å¯¹äºä»»ä½•é‡è¦çš„æ§åˆ¶æˆ–è€…åœ¨è°ƒç”¨åº”ç”¨æ—¶ï¼Œéƒ½ä¸èƒ½ä¾èµ–äº <code>yield()</code>æ–¹æ³•ï¼Œå®é™…ä¸Šï¼Œ yield() æ–¹æ³•ç»å¸¸è¢«æ»¥ç”¨ã€‚</p><h3 id="åå°çº¿ç¨‹"><a href="#åå°çº¿ç¨‹" class="headerlink" title="åå°çº¿ç¨‹"></a>åå°çº¿ç¨‹</h3><p><code>åå°(daemon)</code>çº¿ç¨‹ï¼Œæ˜¯æŒ‡è¿è¡Œæ—¶åœ¨åå°æä¾›çš„ä¸€ç§æœåŠ¡çº¿ç¨‹ï¼Œè¿™ç§çº¿ç¨‹ä¸æ˜¯å±äºå¿…é¡»çš„ã€‚å½“æ‰€æœ‰éåå°çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±åœæ­¢äº†ï¼Œ<strong>åŒæ—¶ä¼šç»ˆæ­¢æ‰€æœ‰çš„åå°çº¿ç¨‹ã€‚</strong>åè¿‡æ¥è¯´ï¼Œåªè¦æœ‰ä»»ä½•éåå°çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œç¨‹åºå°±ä¸ä¼šç»ˆæ­¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDaemons</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">&quot; &quot;</span> + <span class="keyword">this</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;sleep() interrupted&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">10</span>;i++)&#123;</span><br><span class="line">            Thread daemon = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SimpleDaemons());</span><br><span class="line">            daemon.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">            daemon.start();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;All Daemons started&quot;</span>);</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">175</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ¯æ¬¡çš„å¾ªç¯ä¸­ä¼šåˆ›å»º 10 ä¸ªçº¿ç¨‹ï¼Œå¹¶æŠŠæ¯ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºåå°çº¿ç¨‹ï¼Œç„¶åå¼€å§‹è¿è¡Œï¼Œfor å¾ªç¯ä¼šè¿›è¡Œåæ¬¡ï¼Œç„¶åè¾“å‡ºä¿¡æ¯ï¼Œéšåä¸»çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´ååœæ­¢è¿è¡Œã€‚åœ¨æ¯æ¬¡ run å¾ªç¯ä¸­ï¼Œéƒ½ä¼šæ‰“å°å½“å‰çº¿ç¨‹çš„ä¿¡æ¯ï¼Œä¸»çº¿ç¨‹è¿è¡Œå®Œæ¯•ï¼Œç¨‹åºå°±æ‰§è¡Œå®Œæ¯•äº†ã€‚å› ä¸º <code>daemon</code> æ˜¯åå°çº¿ç¨‹ï¼Œæ— æ³•å½±å“ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚</p><p>ä½†æ˜¯å½“ä½ æŠŠ <code>daemon.setDaemon(true)</code> å»æ‰æ—¶ï¼Œwhile(true) ä¼šè¿›è¡Œæ— é™å¾ªç¯ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ä¸€ç›´åœ¨æ‰§è¡Œæœ€é‡è¦çš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä¼šä¸€ç›´å¾ªç¯ä¸‹å»æ— æ³•åœæ­¢ã€‚</p><h3 id="ThreadFactory"><a href="#ThreadFactory" class="headerlink" title="ThreadFactory"></a>ThreadFactory</h3><p>æŒ‰éœ€è¦åˆ›å»ºçº¿ç¨‹çš„å¯¹è±¡ã€‚ä½¿ç”¨çº¿ç¨‹å·¥å‚æ›¿æ¢äº† Thread æˆ–è€… Runnable æ¥å£çš„ç¡¬è¿æ¥ï¼Œä½¿ç¨‹åºèƒ½å¤Ÿä½¿ç”¨ç‰¹æ®Šçš„çº¿ç¨‹å­ç±»ï¼Œä¼˜å…ˆçº§ç­‰ã€‚ä¸€èˆ¬çš„åˆ›å»ºæ–¹å¼ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Thread(r);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>Executors.defaultThreadFactory æ–¹æ³•æä¾›äº†ä¸€ä¸ªæ›´æœ‰ç”¨çš„ç®€å•å®ç°ï¼Œå®ƒåœ¨è¿”å›ä¹‹å‰å°†åˆ›å»ºçš„çº¿ç¨‹ä¸Šä¸‹æ–‡è®¾ç½®ä¸ºå·²çŸ¥å€¼</p></blockquote><p><code>ThreadFactory</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚å®ç°ç±»å¯èƒ½åˆå§‹åŒ–ä¼˜å…ˆçº§ï¼Œåç§°ï¼Œåå°çº¿ç¨‹çŠ¶æ€å’Œ çº¿ç¨‹ç»„ç­‰</span></span><br><span class="line">    <span class="function">Thread <span class="title">newThread</span><span class="params">(Runnable r)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ª ThreadFactory çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        t.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonFromFactory</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">&quot; &quot;</span> + <span class="keyword">this</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Interrupted&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        ExecutorService service = Executors.newCachedThreadPool(<span class="keyword">new</span> DaemonThreadFactory());</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">10</span>;i++)&#123;</span><br><span class="line">            service.execute(<span class="keyword">new</span> DaemonFromFactory());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;All daemons started&quot;</span>);</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>Executors.newCachedThreadPool</code> å¯ä»¥æ¥å—ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡ï¼Œåˆ›å»ºä¸€ä¸ªæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†ä¼šåœ¨å®ƒä»¬å¯ç”¨æ—¶é‡ç”¨å…ˆå‰æ„é€ çš„çº¿ç¨‹ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä½¿ç”¨æä¾›çš„ ThreadFactory åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">(ThreadFactory threadFactory)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;(),</span><br><span class="line">                                threadFactory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åŠ å…¥ä¸€ä¸ªçº¿ç¨‹"><a href="#åŠ å…¥ä¸€ä¸ªçº¿ç¨‹" class="headerlink" title="åŠ å…¥ä¸€ä¸ªçº¿ç¨‹"></a>åŠ å…¥ä¸€ä¸ªçº¿ç¨‹</h3><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸Šè°ƒç”¨ <code>join()</code> æ–¹æ³•ï¼Œå…¶æ•ˆæœæ˜¯ç­‰å¾…ä¸€æ®µæ—¶é—´ç›´åˆ°ç¬¬äºŒä¸ªçº¿ç¨‹ç»“æŸæ‰æ­£å¸¸æ‰§è¡Œã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ t ä¸Šè°ƒç”¨ t.join() æ–¹æ³•ï¼Œæ­¤çº¿ç¨‹å°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ t ç»“æŸæ‰å›å¤(å¯ä»¥ç”¨ t.isAlive() è¿”å›ä¸ºçœŸå‡åˆ¤æ–­)ã€‚</p><p>ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ join æ—¶å¸¦ä¸Šä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œæ¥è®¾ç½®åˆ°æœŸæ—¶é—´ï¼Œæ—¶é—´åˆ°æœŸï¼Œjoinæ–¹æ³•è‡ªåŠ¨è¿”å›ã€‚</p><p>å¯¹ join çš„è°ƒç”¨ä¹Ÿå¯ä»¥è¢«ä¸­æ–­ï¼Œåšæ³•æ˜¯åœ¨çº¿ç¨‹ä¸Šè°ƒç”¨ <code>interrupted</code> æ–¹æ³•ï¼Œè¿™æ—¶éœ€è¦ç”¨åˆ° tryâ€¦catch å­å¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJoinMethod</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Interrupted sleep&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread() + <span class="string">&quot; &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TestJoinMethod join1 = <span class="keyword">new</span> TestJoinMethod();</span><br><span class="line">        TestJoinMethod join2 = <span class="keyword">new</span> TestJoinMethod();</span><br><span class="line">        TestJoinMethod join3 = <span class="keyword">new</span> TestJoinMethod();</span><br><span class="line"></span><br><span class="line">        join1.start();</span><br><span class="line"><span class="comment">//        join1.join();</span></span><br><span class="line"></span><br><span class="line">        join2.start();</span><br><span class="line">        join3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>join() æ–¹æ³•ç­‰å¾…çº¿ç¨‹æ­»äº¡ã€‚ æ¢å¥è¯è¯´ï¼Œå®ƒä¼šå¯¼è‡´å½“å‰è¿è¡Œçš„çº¿ç¨‹åœæ­¢æ‰§è¡Œï¼Œç›´åˆ°å®ƒåŠ å…¥çš„çº¿ç¨‹å®Œæˆå…¶ä»»åŠ¡ã€‚</p><h3 id="çº¿ç¨‹å¼‚å¸¸æ•è·"><a href="#çº¿ç¨‹å¼‚å¸¸æ•è·" class="headerlink" title="çº¿ç¨‹å¼‚å¸¸æ•è·"></a>çº¿ç¨‹å¼‚å¸¸æ•è·</h3><p>ç”±äºçº¿ç¨‹çš„æœ¬è´¨ï¼Œä½¿ä½ ä¸èƒ½æ•è·ä»çº¿ç¨‹ä¸­é€ƒé€¸çš„å¼‚å¸¸ï¼Œä¸€æ—¦å¼‚å¸¸é€ƒå‡ºä»»åŠ¡çš„ run æ–¹æ³•ï¼Œå®ƒå°±ä¼šå‘å¤–ä¼ æ’­åˆ°æ§åˆ¶å°ï¼Œé™¤éä½ é‡‡å–ç‰¹æ®Šçš„æ­¥éª¤æ•è·è¿™ç§é”™è¯¯çš„å¼‚å¸¸ï¼Œåœ¨ Java5 ä¹‹å‰ï¼Œä½ å¯ä»¥é€šè¿‡çº¿ç¨‹ç»„æ¥æ•è·ï¼Œä½†æ˜¯åœ¨ Java 5 ä¹‹åï¼Œå°±éœ€è¦ç”¨ Executor æ¥è§£å†³é—®é¢˜ï¼Œå› ä¸ºçº¿ç¨‹ç»„ä¸æ˜¯ä¸€æ¬¡å¥½çš„å°è¯•ã€‚</p><p>ä¸‹é¢çš„ä»»åŠ¡ä¼šåœ¨ run æ–¹æ³•çš„æ‰§è¡ŒæœŸé—´æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸ä¼šæŠ›åˆ° run æ–¹æ³•çš„å¤–é¢ï¼Œè€Œä¸” main æ–¹æ³•æ— æ³•å¯¹å®ƒè¿›è¡Œæ•è·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line">            service.execute(<span class="keyword">new</span> ExceptionThread());</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;eeeee&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ Executor äº§ç”Ÿçº¿ç¨‹çš„æ–¹å¼ï¼ŒJava5 æä¾›äº†ä¸€ä¸ªæ–°çš„æ¥å£ <code>Thread.UncaughtExceptionHandler</code> ï¼Œå®ƒå…è®¸ä½ åœ¨æ¯ä¸ª Thread ä¸Šéƒ½é™„ç€ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ã€‚<code>Thread.UncaughtExceptionHandler.uncaughtException()</code> ä¼šåœ¨çº¿ç¨‹å› æœªæ•è·ä¸´è¿‘æ­»äº¡æ—¶è¢«è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionThread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        System.out.println(<span class="string">&quot;run() by &quot;</span> + t);</span><br><span class="line">        System.out.println(<span class="string">&quot;eh = &quot;</span> + t.getUncaughtExceptionHandler());</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°Thread.UncaughtExceptionHandler æ¥å£ï¼Œåˆ›å»ºå¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUncaughtExceptionHandler</span> <span class="keyword">implements</span> <span class="title">Thread</span>.<span class="title">UncaughtExceptionHandler</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;caught &quot;</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span> + <span class="string">&quot; creating new Thread&quot;</span>);</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        System.out.println(<span class="string">&quot;created &quot;</span> + t);</span><br><span class="line">        t.setUncaughtExceptionHandler(<span class="keyword">new</span> MyUncaughtExceptionHandler());</span><br><span class="line">        System.out.println(<span class="string">&quot;ex = &quot;</span> + t.getUncaughtExceptionHandler());</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureUncaughtException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService service = Executors.newCachedThreadPool(<span class="keyword">new</span> HandlerThreadFactory());</span><br><span class="line">        service.execute(<span class="keyword">new</span> ExceptionThread2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ç¨‹åºä¸­æ·»åŠ äº†é¢å¤–çš„è¿½è¸ªæœºåˆ¶ï¼Œç”¨æ¥éªŒè¯å·¥å‚åˆ›å»ºçš„çº¿ç¨‹ä¼šä¼ é€’ç»™<code>UncaughtExceptionHandler</code>ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæœªæ•è·çš„å¼‚å¸¸æ˜¯é€šè¿‡ <code>uncaughtException</code> æ¥æ•è·çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode347.å‰Kä¸ªé«˜é¢‘å…ƒç´ </title>
      <link href="/2018/01/08/%E5%88%B7%E9%A2%98/Leetcode347-%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0/"/>
      <url>/2018/01/08/%E5%88%B7%E9%A2%98/Leetcode347-%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><h3 id="347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ "><a href="#347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ " class="headerlink" title="347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/top-k-frequent-elements/">347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ </a></h3><p>Difficulty: <strong>ä¸­ç­‰</strong></p><p>ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ <strong>k</strong>é«˜çš„å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>], k = <span class="number">2</span></span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>], k = <span class="number">1</span></span><br><span class="line">è¾“å‡º: [<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸”$1\leq k\leq m$, mä¸ºæ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚</li><li>ä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦<strong>å¿…é¡»</strong>ä¼˜äº $O(nlogn)$ , næ˜¯æ•°ç»„çš„å¤§å°ã€‚</li><li>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆå”¯ä¸€ï¼Œæ¢å¥è¯è¯´ï¼Œæ•°ç»„ä¸­å‰ k ä¸ªé«˜é¢‘å…ƒç´ çš„é›†åˆæ˜¯å”¯ä¸€çš„ã€‚</li><li>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</li></ul><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>éå†æ•°ç»„ï¼Œè®°å½•æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ï¼Œä¿å­˜åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n)$ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦æ‰¾å‡ºè¿™ä¸ªå“ˆå¸Œè¡¨ä¸­å€¼æœ€å¤§çš„kä¸ªã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨å †æ¥æ’åºã€‚å»ºç«‹ä¸€ä¸ªå°é¡¶å †ï¼Œéå†å‡ºç°æ¬¡æ•°æ•°ç»„ã€‚</p><ul><li>å †å…ƒç´ ä¸ªæ•°å°äºkï¼Œå…¥å †</li><li>å †å…ƒç´ ç­‰äºkï¼Œæ£€æŸ¥å †é¡¶ä¸å½“å‰å‡ºç°æ¬¡æ•°çš„å¤§å°ï¼Œå †é¡¶æ›´å¤§ï¼Œåˆ™è‡³å°‘æœ‰kä¸ªæ•°å­—å‡ºç°æ¬¡æ•°æ¯”å½“å‰å€¼å¤§ï¼Œèˆå¼ƒå½“å‰å€¼ï¼Œå¦åˆ™å¼¹å‡ºå †é¡¶ï¼Œæ’å…¥å½“å‰å€¼åˆ°å †ã€‚</li></ul><p>éå†å®Œæˆåï¼Œå †ä¸­å…ƒç´ çºªå§”å‡ºç°æ¬¡æ•°æ•°ç»„å‰kå¤§çš„å€¼ã€‚</p><p>éå†æ•°ç»„ï¼Œç”¨å“ˆå¸Œè¡¨çš„è®°å½•æ—¶é—´ä¸º$O(n)$ï¼Œéå†å‡ºç°æ¬¡æ•°æ•°ç»„ï¼Œå»ºç«‹å¤§å°ä¸ºkçš„å †ï¼Œæ¯æ¬¡å †æ“ä½œä¸ºæ—¶é—´å¤æ‚åº¦ä¸º$O(logk)$ï¼Œnæ¬¡æ“ä½œä¸º$O(nlogk)$ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ä¸º$O(n)+O(nlogk)=O(n)$</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">topKFrequent</span><span class="params">(nums []<span class="keyword">int</span>, k <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    occurrences := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        occurrences[num]++</span><br><span class="line">    &#125;</span><br><span class="line">    h := &amp;IHeap&#123;&#125;</span><br><span class="line">    heap.Init(h)</span><br><span class="line">    <span class="keyword">for</span> key, value := <span class="keyword">range</span> occurrences &#123;</span><br><span class="line">        heap.Push(h, [<span class="number">2</span>]<span class="keyword">int</span>&#123;key, value&#125;)</span><br><span class="line">        <span class="keyword">if</span> h.Len() &gt; k &#123;</span><br><span class="line">            heap.Pop(h)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, k)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k; i++ &#123;</span><br><span class="line">        ret[k - i - <span class="number">1</span>] = heap.Pop(h).([<span class="number">2</span>]<span class="keyword">int</span>)[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IHeap [][<span class="number">2</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IHeap)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IHeap)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> h[i][<span class="number">1</span>] &lt; h[j][<span class="number">1</span>] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IHeap)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span>      &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *IHeap)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    *h = <span class="built_in">append</span>(*h, x.([<span class="number">2</span>]<span class="keyword">int</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ·é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> å † </tag>
            
            <tag> å“ˆå¸Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode300.æœ€é•¿ä¸Šå‡å­åºåˆ—</title>
      <link href="/2018/01/08/%E5%88%B7%E9%A2%98/Leetcode300-%E6%9C%80%E9%95%BF%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97/"/>
      <url>/2018/01/08/%E5%88%B7%E9%A2%98/Leetcode300-%E6%9C%80%E9%95%BF%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<p>ç»å…¸DPé—®é¢˜ä¹‹ä¸€â€”â€”LISã€‚</p><a id="more"></a><h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><h3 id="300-æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#300-æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title="300. æœ€é•¿ä¸Šå‡å­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/">300. æœ€é•¿ä¸Šå‡å­åºåˆ—</a></h3><p>Difficulty: ä¸­ç­‰</p><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚</p><p>ç¤ºä¾‹:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">10</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">101</span>,<span class="number">18</span>]</span><br><span class="line">è¾“å‡º: <span class="number">4</span> </span><br><span class="line">è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">101</span>]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ <span class="number">4</span>ã€‚</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><ul><li>å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚</li><li>ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º $O(n^2)$ ã€‚</li></ul><p>è¿›é˜¶: ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° $O(nlogn)$å—?</p><h2 id="æ€è·¯-amp-é¢˜è§£"><a href="#æ€è·¯-amp-é¢˜è§£" class="headerlink" title="æ€è·¯&amp;é¢˜è§£"></a>æ€è·¯&amp;é¢˜è§£</h2><h3 id="ç»å…¸LIS"><a href="#ç»å…¸LIS" class="headerlink" title="ç»å…¸LIS"></a>ç»å…¸LIS</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>å¯¹äºæ‰€æœ‰çš„DPé—®é¢˜ï¼Œç»å…¸å››æ­¥èµ°ï¼š</p><ol><li><p>å®šä¹‰çŠ¶æ€</p><p>ç”±äºä¸€ä¸ªå­åºåˆ—ä¸€å®šä¼šä»¥ä¸€ä¸ªæ•°ç»“å°¾ï¼Œäºæ˜¯å°†çŠ¶æ€å®šä¹‰æˆï¼š<code>dp[i]</code> è¡¨ç¤ºä»¥ <code>nums[i]</code> ç»“å°¾çš„ã€Œä¸Šå‡å­åºåˆ—ã€çš„é•¿åº¦ã€‚æ³¨æ„ï¼šè¿™ä¸ªå®šä¹‰ä¸­ <code>`nums[i]</code> å¿…é¡»è¢«é€‰å–ï¼Œä¸”å¿…é¡»æ˜¯è¿™ä¸ªå­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p></li><li><p>è€ƒè™‘çŠ¶æ€è½¬ç§»æ–¹ç¨‹</p><p>éå†åˆ° <code>nums[i]</code> æ—¶ï¼Œéœ€è¦æŠŠä¸‹æ ‡ <code>i</code> ä¹‹å‰çš„æ‰€æœ‰çš„æ•°éƒ½çœ‹ä¸€éï¼›<br>åªè¦ <code>nums[i]</code> ä¸¥æ ¼å¤§äºåœ¨å®ƒä½ç½®ä¹‹å‰çš„æŸä¸ªæ•°ï¼Œé‚£ä¹ˆ <code>nums[i]</code> å°±å¯ä»¥æ¥åœ¨è¿™ä¸ªæ•°åé¢å½¢æˆä¸€ä¸ªæ›´é•¿çš„ä¸Šå‡å­åºåˆ—ï¼›<br>å› æ­¤ï¼Œ<code>dp[i]</code> å°±ç­‰äºä¸‹æ ‡ i ä¹‹å‰ä¸¥æ ¼å°äº<code>nums[i]</code> çš„çŠ¶æ€å€¼çš„æœ€å¤§è€… +1ã€‚<br>å› æ­¤æˆ‘ä»¬å¯ä»¥å†™å‡ºä¸‹é¢çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><script type="math/tex; mode=display">dp[i]=\max \limits_{0\leq j<i, nums[j]<nums[i]}dp[j]+1</script></li><li><p>è€ƒè™‘åˆå§‹åŒ–</p><p>dp[i] = 1ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½è‡³å°‘æ„æˆé•¿åº¦ä¸º1çš„å­åºåˆ—</p></li><li><p>è¾“å‡º</p><p>çŠ¶æ€æ•°ç»„ dp çš„æœ€å¤§å€¼æ‰æ˜¯æœ€åè¦è¾“å‡ºçš„å€¼ã€‚</p></li><li><p>çŠ¶æ€å‹ç¼©</p><p>éå†åˆ°ä¸€ä¸ªæ–°æ•°çš„æ—¶å€™ï¼Œä¹‹å‰æ‰€æœ‰çš„çŠ¶æ€å€¼éƒ½å¾—ä¿ç•™ï¼Œå› æ­¤æ— æ³•å‹ç¼©ã€‚</p></li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Max</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x &gt; y &#123;</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lengthOfLIS</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    dp := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt; <span class="built_in">len</span>(nums);i++ &#123;</span><br><span class="line">        dp[i] = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    ans := <span class="number">1</span></span><br><span class="line">    <span class="comment">// è¦æ³¨æ„è€ƒè™‘ç‰¹æ®Šæƒ…å†µ ä¾‹å¦‚é•¿åº¦ä¸º0 æˆ– 1</span></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j:=<span class="number">0</span>; j&lt;i; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> nums[i] &gt; nums[j] &#123;</span><br><span class="line">                dp[i] = Max(dp[i], dp[j]+<span class="number">1</span>)</span><br><span class="line">                ans = Max(dp[i], ans)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äºŒåˆ†æŸ¥æ‰¾-è´ªå¿ƒ"><a href="#äºŒåˆ†æŸ¥æ‰¾-è´ªå¿ƒ" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾+è´ªå¿ƒ"></a>äºŒåˆ†æŸ¥æ‰¾+è´ªå¿ƒ</h3><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>é¢˜ç›®ä¸­è¦æ‰¾$O(nlogn)$çš„åšæ³•ï¼Œè€ƒè™‘åˆ°äºŒåˆ†æŸ¥æ‰¾çš„å¤æ‚åº¦ä¸º$O(logn)$ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘åœ¨ç¬¬äºŒå±‚å¾ªç¯åšæ–‡ç« ï¼Œæ”¹æˆäºŒåˆ†æŸ¥æ‰¾ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„å‡ºå‘ç‚¹åŸºäºä¸€ä¸ªè´ªå¿ƒçš„åšæ³•ï¼šç»“å°¾çš„æ•°å°½é‡å°ï¼Œéå†åæ¥çš„æ•°å°±æœ‰æ›´å¤§çš„å¯èƒ½æ€§æ„æˆæ›´é•¿çš„åºåˆ—ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è®°å½•é•¿åº¦å›ºå®šçš„çŠ¶å†µä¸‹ï¼Œç»“å°¾æœ€å°çš„å…ƒç´ æ•°å€¼ã€‚</p><ol><li><p>å®šä¹‰çŠ¶æ€</p><p><code>tail[i]</code>è¡¨ç¤ºé•¿åº¦ä¸º<code>i+1</code>çš„æ‰€æœ‰ä¸Šå‡å­åºåˆ—çš„ç»“å°¾æœ€å°å€¼ã€‚</p><p><code>tail[0]</code> è¡¨ç¤ºé•¿åº¦ä¸º 1 çš„æ‰€æœ‰ä¸Šå‡å­åºåˆ—ä¸­ï¼Œç»“å°¾æœ€å°çš„é‚£ä¸ªå…ƒç´ çš„æ•°å€¼ï¼Œä»¥é¢˜ç›®ä¸­çš„ç¤ºä¾‹ä¸ºä¾‹ [10, 9, 2, 5, 3, 7, 101, 18] ä¸­ï¼Œå®¹æ˜“å‘ç°é•¿åº¦ä¸º 2 çš„æ‰€æœ‰ä¸Šå‡å­åºåˆ—ä¸­ï¼Œç»“å°¾æœ€å°çš„æ˜¯å­åºåˆ— [2, 3] ï¼Œå› æ­¤ tail[1] = 3<br>ä¸‹æ ‡å’Œé•¿åº¦æœ‰ä¸€ä¸ª 1 çš„åå·®ï¼›</p></li><li><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</p><p>è¿™é‡Œå¯ä»¥è¯æ˜<code>tail</code>ä¸¥æ ¼ä¸Šå‡ã€‚</p><p>è¯æ˜ï¼šå¯¹äºä»»æ„ä¸‹è¡¨$0 \leq i &lt; j &lt; len$ï¼Œéƒ½æœ‰$tail[i]&lt;tail[j]$</p><p>å‡è®¾å¯¹äºä»»æ„$i<j$ï¼Œå­˜åœ¨`tail[i]>=tail[j]`</p><p>å¯¹äº<code>tail[i]</code>ï¼Œå¯¹åº”ä¸€ä¸ªä¸Šå‡å­åºåˆ—$[a_0,a_1,â€¦,a_i]$ï¼Œ$tail[i]=a_i$</p><p>å¯¹äº<code>tail[j]</code>ï¼Œå¯¹åº”ä¸€ä¸ªä¸Šå‡å­åºåˆ—$[b_0,b_1,â€¦,b_j]$ï¼Œ$tail[j]=b_j$</p><p>ç”±äº<code>tail[i]&gt;=tail[j]</code>ï¼Œ$a_i&gt;b_j$ã€‚è€Œåœ¨$[b_0,b_1,â€¦,b_j]$ä¸­ï¼Œ$b_i<b_j$ ï¼Œåˆ™$a_i\geq b_j >b_i$ï¼Œåˆ™ä¸Šå‡å­åºåˆ—$[b_0,b_1,â€¦,b_j]$æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º<code>i+1</code>ä½†ç»“å°¾æ›´å°çš„æ•°ç»„ï¼Œä¸å‡è®¾çŸ›ç›¾ï¼Œå‘½é¢˜å¾—è¯ã€‚</p><p>æ ¹æ®å‘½é¢˜ï¼Œæˆ‘ä»¬ç»´æŠ¤<code>tail</code>å³å¯ç›´æ¥å–å¾—æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚</p></li></ol><h4 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4><p>1ã€è®¾ç½®ä¸€ä¸ªæ•°ç»„ tailï¼Œåˆå§‹æ—¶ä¸ºç©ºï¼›</p><p>æ³¨æ„ï¼šæ•°ç»„ <code>tail</code> è™½ç„¶æ˜¯æœ‰åºæ•°ç»„ï¼Œä½†å®ƒä¸æ˜¯é—®é¢˜ä¸­çš„ã€Œæœ€é•¿ä¸Šå‡å­åºåˆ—ã€ï¼ˆä¸‹æ–‡è¿˜ä¼šå¼ºè°ƒï¼‰ï¼Œä¸èƒ½å‘½åä¸º LISã€‚æœ‰åºæ•°ç»„ tail åªæ˜¯ç”¨äºæ±‚è§£ LIS é—®é¢˜çš„è¾…åŠ©æ•°ç»„ã€‚</p><p>2ã€åœ¨éå†æ•°ç»„ <code>nums</code> çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¥ä¸€ä¸ªæ–°æ•° numï¼Œå¦‚æœè¿™ä¸ªæ•°ä¸¥æ ¼å¤§äºæœ‰åºæ•°ç»„ <code>tail</code> çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°±æŠŠ num æ”¾åœ¨æœ‰åºæ•°ç»„ <code>tail</code> çš„åé¢ï¼Œå¦åˆ™è¿›å…¥ç¬¬ 3 ç‚¹ï¼›</p><p>æ³¨æ„ï¼šè¿™é‡Œçš„å¤§äºæ˜¯ã€Œä¸¥æ ¼å¤§äºã€ï¼Œä¸åŒ…æ‹¬ç­‰äºçš„æƒ…å†µã€‚</p><p>3ã€åœ¨æœ‰åºæ•°ç»„<code>tail</code>ä¸­æŸ¥æ‰¾ç¬¬ 1 ä¸ªç­‰äºå¤§äº num çš„é‚£ä¸ªæ•°ï¼Œè¯•å›¾è®©å®ƒå˜å°ï¼›</p><p>å¦‚æœæœ‰åºæ•°ç»„ <code>tail</code> ä¸­å­˜åœ¨ç­‰äº num çš„å…ƒç´ ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œå› ä¸ºä»¥ num ç»“å°¾çš„æœ€çŸ­çš„ã€Œä¸Šå‡å­åºåˆ—ã€å·²ç»å­˜åœ¨ï¼›<br>å¦‚æœæœ‰åºæ•°ç»„ <code>tail</code> ä¸­å­˜åœ¨å¤§äº num çš„å…ƒç´ ï¼Œæ‰¾åˆ°ç¬¬ 1 ä¸ªï¼Œè®©å®ƒå˜å°ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªç»“å°¾æ›´å°çš„ç›¸åŒé•¿åº¦çš„ä¸Šå‡å­åºåˆ—ã€‚<br>è¯´æ˜ï¼šæˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ•°ç»„ <code>tail[i]</code> çš„å®šä¹‰ï¼šé•¿åº¦ä¸º i + 1 çš„æ‰€æœ‰æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»“å°¾çš„æœ€å°å€¼ã€‚å› æ­¤ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾è®©ä¸€ä¸ªå¤§çš„å€¼å˜å°æ˜¯åˆç†çš„ã€‚</p><p>è¿™ä¸€æ­¥å¯ä»¥è®¤ä¸ºæ˜¯ã€Œè´ªå¿ƒç®—æ³•ã€ï¼Œæ€»æ˜¯åšå‡ºåœ¨å½“å‰çœ‹æ¥æœ€å¥½çš„é€‰æ‹©ï¼Œå½“å‰ã€Œæœ€å¥½çš„é€‰æ‹©ã€æ˜¯ï¼šå½“å‰åªè®©è®©ç¬¬ 1 ä¸ªä¸¥æ ¼å¤§äº <code>nums[i]</code> çš„æ•°å˜å°ï¼Œå˜æˆ <code>nums[i]</code>ï¼Œè¿™ä¸€æ­¥æ“ä½œæ˜¯â€œæ— åæ•ˆæ€§â€çš„ã€‚</p><p>ç”±äºæ˜¯åœ¨æœ‰åºæ•°ç»„ä¸­çš„æ“ä½œï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ã€ŒäºŒåˆ†æŸ¥æ‰¾ç®—æ³•ã€ã€‚</p><p>4ã€éå†æ–°çš„æ•° num ï¼Œå…ˆå°è¯•ä¸Šè¿°ç¬¬ 2 ç‚¹ï¼Œç¬¬ 2 ç‚¹è¡Œä¸é€šåˆ™æ‰§è¡Œç¬¬ 3 ç‚¹ï¼Œç›´åˆ°éå†å®Œæ•´ä¸ªæ•°ç»„ numsï¼Œæœ€ç»ˆæœ‰åºæ•°ç»„ tail çš„é•¿åº¦ï¼Œå°±æ˜¯æ‰€æ±‚çš„â€œæœ€é•¿ä¸Šå‡å­åºåˆ—â€çš„é•¿åº¦ã€‚</p><p>ç¬¬ 3 æ­¥ï¼šæ€è€ƒåˆå§‹åŒ–<br><code>dp[0] = nums[0]</code>ï¼Œåœ¨åªæœ‰ 1 ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹ï¼Œå®ƒå½“ç„¶æ˜¯é•¿åº¦ä¸º 1 å¹¶ä¸”ç»“å°¾æœ€å°çš„å…ƒç´ ã€‚</p><p>ç¬¬ 4 æ­¥ï¼šæ€è€ƒè¾“å‡º<br>æ•°ç»„ <code>tail</code> çš„é•¿åº¦ï¼Œä¸Šæ–‡å…¶å®ä¹Ÿå·²ç»è¯´äº†ï¼Œè¿˜æ˜¯ä¾æ®å®šä¹‰ï¼Œ<code>tail[i]</code> è¡¨ç¤ºé•¿åº¦å›ºå®šä¸º i + 1 çš„æ‰€æœ‰ã€Œä¸Šå‡å­åºåˆ—ã€çš„ç»“å°¾å…ƒç´ ä¸­æœ€å°çš„é‚£ä¸ªï¼Œé•¿åº¦æœ€å¤šå°±æ˜¯æ•°ç»„ <code>tail</code> çš„é•¿åº¦ã€‚</p><p>ç¬¬ 5 æ­¥ï¼šæ€è€ƒçŠ¶æ€å‹ç¼©<br>æ— æ³•å‹ç¼©ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸‹è¿™ä¸ªç®—æ³•åœ¨ç¤ºä¾‹ä¸Šçš„çš„æ‰§è¡Œæµç¨‹ï¼Œä»¥åŠ æ·±ä½“ä¼šï¼Œæˆ‘åœ¨ç¤ºä¾‹çš„æ•°ç»„åé¢åŠ ä¸Šäº† 4ã€8ã€6ã€12ï¼Œä¾ç„¶æ˜¯å…ˆè®©å¹»ç¯ç‰‡åŠ¨èµ·æ¥ï¼Œçœ‹æ€æƒ³å°±å¥½äº†ã€‚</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLIS</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = nums.length;</span><br><span class="line">        <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> len;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// tail æ•°ç»„çš„å®šä¹‰ï¼šé•¿åº¦ä¸º i + 1 çš„ä¸Šå‡å­åºåˆ—çš„æœ«å°¾æœ€å°æ˜¯å‡ </span></span><br><span class="line">        <span class="keyword">int</span>[] tail = <span class="keyword">new</span> <span class="keyword">int</span>[len];</span><br><span class="line">        <span class="comment">// éå†ç¬¬ 1 ä¸ªæ•°ï¼Œç›´æ¥æ”¾åœ¨æœ‰åºæ•°ç»„ tail çš„å¼€å¤´</span></span><br><span class="line">        tail[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// end è¡¨ç¤ºæœ‰åºæ•°ç»„ tail çš„æœ€åä¸€ä¸ªå·²ç»èµ‹å€¼å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">int</span> end = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="comment">// ã€é€»è¾‘ 1ã€‘æ¯” tail æ•°ç»„å®é™…æœ‰æ•ˆçš„æœ«å°¾çš„é‚£ä¸ªå…ƒç´ è¿˜å¤§</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; tail[end]) &#123;</span><br><span class="line">                <span class="comment">// ç›´æ¥æ·»åŠ åœ¨é‚£ä¸ªå…ƒç´ çš„åé¢ï¼Œæ‰€ä»¥ end å…ˆåŠ  1</span></span><br><span class="line">                end++;</span><br><span class="line">                tail[end] = nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œåœ¨æœ‰åºæ•°ç»„ tail ä¸­</span></span><br><span class="line">                <span class="comment">// æ‰¾åˆ°ç¬¬ 1 ä¸ªå¤§äºç­‰äº nums[i] çš„å…ƒç´ ï¼Œå°è¯•è®©é‚£ä¸ªå…ƒç´ æ›´å°</span></span><br><span class="line">                <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> right = end;</span><br><span class="line">                <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">                    <span class="comment">// é€‰å·¦ä¸­ä½æ•°ä¸æ˜¯å¶ç„¶ï¼Œè€Œæ˜¯æœ‰åŸå› çš„ï¼ŒåŸå› è¯·è§ LeetCode ç¬¬ 35 é¢˜é¢˜è§£</span></span><br><span class="line">                    <span class="comment">// int mid = left + (right - left) / 2;</span></span><br><span class="line">                    <span class="keyword">int</span> mid = left + ((right - left) &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (tail[mid] &lt; nums[i]) &#123;</span><br><span class="line">                        <span class="comment">// ä¸­ä½æ•°è‚¯å®šä¸æ˜¯è¦æ‰¾çš„æ•°ï¼ŒæŠŠå®ƒå†™åœ¨åˆ†æ”¯çš„å‰é¢</span></span><br><span class="line">                        left = mid + <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        right = mid;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// èµ°åˆ°è¿™é‡Œæ˜¯å› ä¸º ã€é€»è¾‘ 1ã€‘ çš„åé¢ï¼Œå› æ­¤ä¸€å®šèƒ½æ‰¾åˆ°ç¬¬ 1 ä¸ªå¤§äºç­‰äº nums[i] çš„å…ƒç´ </span></span><br><span class="line">                <span class="comment">// å› æ­¤ï¼Œæ— éœ€å†å•ç‹¬åˆ¤æ–­</span></span><br><span class="line">                tail[left] = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è°ƒè¯•æ–¹æ³•</span></span><br><span class="line">            <span class="comment">// printArray(nums[i], tail);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶ end æ˜¯æœ‰åºæ•°ç»„ tail æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">        <span class="comment">// é¢˜ç›®è¦æ±‚è¿”å›çš„æ˜¯é•¿åº¦ï¼Œå› æ­¤ +1 åè¿”å›</span></span><br><span class="line">        end++;</span><br><span class="line">        <span class="keyword">return</span> end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒè¯•æ–¹æ³•ï¼Œä»¥è§‚å¯Ÿæ˜¯å¦è¿è¡Œæ­£ç¡®</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span> num, <span class="keyword">int</span>[] tail)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;å½“å‰æ•°å­—ï¼š&quot;</span> + num);</span><br><span class="line">        System.out.print(<span class="string">&quot;\tå½“å‰ tail æ•°ç»„ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> len = tail.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tail[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(tail[i] + <span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] nums = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>&#125;;</span><br><span class="line">        Solution solution = <span class="keyword">new</span> Solution8();</span><br><span class="line">        <span class="keyword">int</span> lengthOfLIS = solution8.lengthOfLIS(nums);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ï¼š&quot;</span> + lengthOfLIS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ·é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰‘æŒ‡Offer20.è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</title>
      <link href="/2018/01/05/%E5%88%B7%E9%A2%98/%E5%89%91%E6%8C%87Offer20-%E8%A1%A8%E7%A4%BA%E6%95%B0%E5%80%BC%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2018/01/05/%E5%88%B7%E9%A2%98/%E5%89%91%E6%8C%87Offer20-%E8%A1%A8%E7%A4%BA%E6%95%B0%E5%80%BC%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<p>ä¸€é“ç»å…¸çš„è‡ªåŠ¨çŠ¶æ€æœºé¢˜ã€‚</p><a id="more"></a><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p><a href="https://leetcode-cn.com/problems/biao-shi-shu-zhi-de-zi-fu-chuan-lcof/">å‰‘æŒ‡Offer20.è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</a></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦è¡¨ç¤ºæ•°å€¼ï¼ˆåŒ…æ‹¬æ•´æ•°å’Œå°æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€+100â€ã€â€5e2â€ã€â€-123â€ã€â€3.1416â€ã€â€-1E-16â€ã€â€0123â€éƒ½è¡¨ç¤ºæ•°å€¼ï¼Œä½†â€12eâ€ã€â€1a3.14â€ã€â€1.2.3â€ã€â€+-5â€åŠâ€12e+5.4â€éƒ½ä¸æ˜¯ã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>è¿™é¢˜æ˜¯å…¸å‹çš„è‡ªåŠ¨çŠ¶æ€æœºï¼Œå®šä¹‰å½“å‰çŠ¶æ€ï¼Œä»¥å½“å‰å­—ç¬¦ä½œä¸ºçŠ¶æ€è½¬ç§»åŠ¨ä½œã€‚</p><p><strong>å­—ç¬¦ç±»å‹</strong>ï¼š</p><p>ç©ºæ ¼ ã€Œ ã€ã€æ•°å­—ã€Œ 0â€”9 ã€ ã€æ­£è´Ÿå· ã€Œ +- ã€ ã€å°æ•°ç‚¹ ã€Œ . ã€ ã€å¹‚ç¬¦å· ã€Œ eEeE ã€ ã€‚</p><p><strong>çŠ¶æ€å®šä¹‰</strong>ï¼š</p><p>æŒ‰ç…§å­—ç¬¦ä¸²ä»å·¦åˆ°å³çš„é¡ºåºï¼Œå®šä¹‰ä»¥ä¸‹ 9 ç§çŠ¶æ€ã€‚</p><ol><li>å¼€å§‹çš„ç©ºæ ¼</li><li>å¹‚ç¬¦å·å‰çš„æ­£è´Ÿå·</li><li>å°æ•°ç‚¹å‰çš„æ•°å­—</li><li>å°æ•°ç‚¹ã€å°æ•°ç‚¹åçš„æ•°å­—</li><li>å½“å°æ•°ç‚¹å‰ä¸ºç©ºæ ¼æ—¶ï¼Œå°æ•°ç‚¹ã€å°æ•°ç‚¹åçš„æ•°å­—</li><li>å¹‚ç¬¦å·</li><li>å¹‚ç¬¦å·åçš„æ­£è´Ÿå·</li><li>å¹‚ç¬¦å·åçš„æ•°å­—</li><li>ç»“å°¾çš„ç©ºæ ¼</li><li>ç»“æŸçŠ¶æ€</li></ol><p>åˆæ³•çš„ç»“æŸçŠ¶æ€æœ‰ 2, 3, 7, 8 ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/02/2JV9ULagksCuj4P.png" alt="6f41d7e46fd0344c013980e3f46429dd7a7311bb4292783a482466a90f15747b-Picture1"></p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> State <span class="keyword">int</span></span><br><span class="line"><span class="keyword">type</span> CharType <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    STATE_INITIAL State = <span class="literal">iota</span></span><br><span class="line">    STATE_INT_SIGN</span><br><span class="line">    STATE_INTEGER</span><br><span class="line">    STATE_POINT</span><br><span class="line">    STATE_POINT_WITHOUT_INT</span><br><span class="line">    STATE_FRACTION</span><br><span class="line">    STATE_EXP</span><br><span class="line">    STATE_EXP_SIGN</span><br><span class="line">    STATE_EXP_NUMBER</span><br><span class="line">    STATE_END</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    CHAR_NUMBER CharType = <span class="literal">iota</span></span><br><span class="line">    CHAR_EXP</span><br><span class="line">    CHAR_POINT</span><br><span class="line">    CHAR_SIGN</span><br><span class="line">    CHAR_SPACE</span><br><span class="line">    CHAR_ILLEGAL</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">toCharType</span><span class="params">(ch <span class="keyword">byte</span>)</span> <span class="title">CharType</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> ch &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> CHAR_NUMBER</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> CHAR_EXP</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> CHAR_POINT</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> CHAR_SIGN</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> CHAR_SPACE</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> CHAR_ILLEGAL</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isNumber</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    transfer := <span class="keyword">map</span>[State]<span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">        STATE_INITIAL: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_SPACE:  STATE_INITIAL,</span><br><span class="line">            CHAR_NUMBER: STATE_INTEGER,</span><br><span class="line">            CHAR_POINT:  STATE_POINT_WITHOUT_INT,</span><br><span class="line">            CHAR_SIGN:   STATE_INT_SIGN,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_INT_SIGN: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_INTEGER,</span><br><span class="line">            CHAR_POINT:  STATE_POINT_WITHOUT_INT,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_INTEGER: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_INTEGER,</span><br><span class="line">            CHAR_EXP:    STATE_EXP,</span><br><span class="line">            CHAR_POINT:  STATE_POINT,</span><br><span class="line">            CHAR_SPACE:  STATE_END,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_POINT: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_FRACTION,</span><br><span class="line">            CHAR_EXP:    STATE_EXP,</span><br><span class="line">            CHAR_SPACE:  STATE_END,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_POINT_WITHOUT_INT: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_FRACTION,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_FRACTION: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_FRACTION,</span><br><span class="line">            CHAR_EXP:    STATE_EXP,</span><br><span class="line">            CHAR_SPACE:  STATE_END,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_EXP: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_EXP_NUMBER,</span><br><span class="line">            CHAR_SIGN:   STATE_EXP_SIGN,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_EXP_SIGN: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_EXP_NUMBER,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_EXP_NUMBER: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_NUMBER: STATE_EXP_NUMBER,</span><br><span class="line">            CHAR_SPACE:  STATE_END,</span><br><span class="line">        &#125;,</span><br><span class="line">        STATE_END: <span class="keyword">map</span>[CharType]State&#123;</span><br><span class="line">            CHAR_SPACE: STATE_END,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    state := STATE_INITIAL</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        typ := toCharType(s[i])</span><br><span class="line">        <span class="keyword">if</span> _, ok := transfer[state][typ]; !ok &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            state = transfer[state][typ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state == STATE_INTEGER || state == STATE_POINT || state == STATE_FRACTION || state == STATE_EXP_NUMBER || state == STATE_END</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ·é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> è‡ªåŠ¨çŠ¶æ€æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode1115.äº¤æ›¿æ‰“å°FooBar</title>
      <link href="/2018/01/02/%E5%88%B7%E9%A2%98/Leetcode1115.%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0FooBar%E9%A2%98%E8%A7%A3/"/>
      <url>/2018/01/02/%E5%88%B7%E9%A2%98/Leetcode1115.%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0FooBar%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>å€ŸåŠ©è¿™é¢˜å¤ä¹ ä¸€ä¸‹Javaå¹¶å‘ç±»å’Œå·¥å…·ã€‚</p><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª FooBar å®ä¾‹ã€‚å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ foo() æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ bar() æ–¹æ³•ã€‚</p><p>è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ â€œfoobarâ€ è¢«è¾“å‡º n æ¬¡ã€‚</p><a id="more"></a><p>æˆ‘ä»¬æä¾›ä¸€ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// printFoo.run() outputs &quot;foo&quot;. Do not change or remove this line.</span></span><br><span class="line">        printFoo.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// printBar.run() outputs &quot;bar&quot;. Do not change or remove this line.</span></span><br><span class="line">        printBar.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: n = 1<br>è¾“å‡º: â€œfoobarâ€<br>è§£é‡Š: è¿™é‡Œæœ‰ä¸¤ä¸ªçº¿ç¨‹è¢«å¼‚æ­¥å¯åŠ¨ã€‚å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ foo() æ–¹æ³•, å¦ä¸€ä¸ªè°ƒç”¨ bar() æ–¹æ³•ï¼Œâ€foobarâ€ å°†è¢«è¾“å‡ºä¸€æ¬¡ã€‚</p></li><li><p>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: n = 2<br>è¾“å‡º: â€œfoobarfoobarâ€<br>è§£é‡Š: â€œfoobarâ€ å°†è¢«è¾“å‡ºä¸¤æ¬¡ã€‚</p></li></ul><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>è¿™é¢˜è€ƒçš„æ˜¯çº¿ç¨‹åŒæ­¥ï¼Œé‚£ä¹ˆæ˜¾è€Œæ˜“è§ï¼Œä¿¡å·é‡ã€äº’æ–¥é”ã€å…±äº«å†…å­˜è¿™äº›æ–¹æ¡ˆéƒ½æ˜¯å¯è¡Œçš„ã€‚</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><h3 id="ä¿¡å·é‡Semaphore"><a href="#ä¿¡å·é‡Semaphore" class="headerlink" title="ä¿¡å·é‡Semaphore"></a>ä¿¡å·é‡Semaphore</h3><p>Semaphoreç¿»è¯‘æˆå­—é¢æ„æ€ä¸º ä¿¡å·é‡ï¼ŒSemaphoreå¯ä»¥æ§åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼Œé€šè¿‡ acquire() è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼Œè€Œ release() é‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚</p><p>Semaphoreç±»ä½äºjava.util.concurrentåŒ…ä¸‹ï¼Œå®ƒæä¾›äº†2ä¸ªæ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;          <span class="comment">//å‚æ•°permitsè¡¨ç¤ºè®¸å¯æ•°ç›®ï¼Œå³åŒæ—¶å¯ä»¥å…è®¸å¤šå°‘çº¿ç¨‹è¿›è¡Œè®¿é—®</span></span><br><span class="line">    sync = <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">boolean</span> fair)</span> </span>&#123;    <span class="comment">//è¿™ä¸ªå¤šäº†ä¸€ä¸ªå‚æ•°fairè¡¨ç¤ºæ˜¯å¦æ˜¯å…¬å¹³çš„ï¼Œå³ç­‰å¾…æ—¶é—´è¶Šä¹…çš„è¶Šå…ˆè·å–è®¸å¯</span></span><br><span class="line">    sync = (fair)? <span class="keyword">new</span> FairSync(permits) : <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¯´ä¸€ä¸‹Semaphoreç±»ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆæ˜¯acquire()ã€release()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;  &#125;     <span class="comment">//è·å–ä¸€ä¸ªè®¸å¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> permits)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;    <span class="comment">//è·å–permitsä¸ªè®¸å¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123; &#125;          <span class="comment">//é‡Šæ”¾ä¸€ä¸ªè®¸å¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123; &#125;    <span class="comment">//é‡Šæ”¾permitsä¸ªè®¸å¯</span></span><br></pre></td></tr></table></figure><p>acquire()ç”¨æ¥è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥æ— è®¸å¯èƒ½å¤Ÿè·å¾—ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—è®¸å¯ã€‚</p><p>release()ç”¨æ¥é‡Šæ”¾è®¸å¯ã€‚æ³¨æ„ï¼Œåœ¨é‡Šæ”¾è®¸å¯ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·è·å¾—è®¸å¯ã€‚</p><p>è¿™4ä¸ªæ–¹æ³•éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæƒ³ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">()</span> </span>&#123; &#125;;    </span><br><span class="line"><span class="comment">//å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;;  </span><br><span class="line"><span class="comment">//å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123; &#125;; </span><br><span class="line"><span class="comment">//å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;; <span class="comment">//å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›false</span></span><br></pre></td></tr></table></figure><p>å¦å¤–è¿˜å¯ä»¥é€šè¿‡availablePermits()æ–¹æ³•å¾—åˆ°å¯ç”¨çš„è®¸å¯æ•°ç›®ã€‚</p><p>æ­¤é¢˜å¯è®¾ç½®ä¸¤ä¸ªä¿¡å·é‡åˆ†åˆ«æ ‡ç¤ºFooBarçš„å¯ç”¨çŠ¶æ€ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Semaphore foo = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line">    Semaphore bar = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            foo.acquire();</span><br><span class="line">            printFoo.run();</span><br><span class="line">            bar.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            bar.acquire();</span><br><span class="line">            printBar.run();</span><br><span class="line">            foo.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h3><p>é”æä¾›å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼šä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–é”ï¼Œå¹¶ä¸”å¯¹å…±äº«èµ„æºçš„æ‰€æœ‰è®¿é—®éƒ½è¦æ±‚é¦–å…ˆè·å–é”ã€‚ ä½†æ˜¯ï¼Œä¸€äº›é”å¯èƒ½å…è®¸å¹¶å‘è®¿é—®å…±äº«èµ„æºï¼Œå¦‚ReadWriteLockçš„è¯»å†™é”ã€‚åœ¨Lockæ¥å£å‡ºç°ä¹‹å‰ï¼ŒJavaç¨‹åºæ˜¯é synchronizedå…³é”®å­—å®ç°é”åŠŸèƒ½çš„ã€‚JDK1.5ä¹‹åå¹¶å‘åŒ…ä¸­æ–°å¢äº†Lockæ¥å£ä»¥åŠç›¸å…³å®ç°ç±»æ¥å®ç°é”åŠŸèƒ½ã€‚</p><p><strong>Lockæ¥å£çš„å®ç°ç±»ï¼š</strong> <code>ReentrantLock</code> ï¼Œ <code>ReentrantReadWriteLock.ReadLock</code> ï¼Œ <code>ReentrantReadWriteLock.WriteLock</code></p><p><strong>Lockæ¥å£æä¾›çš„synchronizedå…³é”®å­—ä¸å…·å¤‡çš„ä¸»è¦ç‰¹æ€§ï¼š</strong></p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>å°è¯•éé˜»å¡åœ°è·å–é”</td><td>å½“å‰çº¿ç¨‹å°è¯•è·å–é”ï¼Œå¦‚æœè¿™ä¸€æ—¶åˆ»é”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹è·å–åˆ°ï¼Œåˆ™æˆåŠŸè·å–å¹¶æŒæœ‰é”</td></tr><tr><td>èƒ½è¢«ä¸­æ–­åœ°è·å–é”</td><td>è·å–åˆ°é”çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå½“è·å–åˆ°é”çš„çº¿ç¨‹è¢«ä¸­æ–­æ—¶ï¼Œä¸­æ–­å¼‚å¸¸å°†ä¼šè¢«æŠ›å‡ºï¼ŒåŒæ—¶é”ä¼šè¢«é‡Šæ”¾</td></tr><tr><td>è¶…æ—¶è·å–é”</td><td>åœ¨æŒ‡å®šçš„æˆªæ­¢æ—¶é—´ä¹‹å‰è·å–é”ï¼Œ è¶…è¿‡æˆªæ­¢æ—¶é—´åä»æ—§æ— æ³•è·å–åˆ™è¿”å›</td></tr></tbody></table></div><p><strong>Lockæ¥å£åŸºæœ¬çš„æ–¹æ³•ï¼š</strong></p><div class="table-container"><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>void lock()</td><td>è·å¾—é”ã€‚å¦‚æœé”ä¸å¯ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹å°†è¢«ç¦ç”¨ä»¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦ï¼Œå¹¶å¤„äºä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°è·å–é”ã€‚</td></tr><tr><td>void lockInterruptibly()</td><td>è·å–é”ï¼Œå¦‚æœå¯ç”¨å¹¶ç«‹å³è¿”å›ã€‚å¦‚æœé”ä¸å¯ç”¨ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°†è¢«ç¦ç”¨ä»¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦ï¼Œå¹¶ä¸”å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå’Œlock()æ–¹æ³•ä¸åŒçš„æ˜¯åœ¨é”çš„è·å–ä¸­å¯ä»¥ä¸­æ–­å½“å‰çº¿ç¨‹ï¼ˆç›¸åº”ä¸­æ–­ï¼‰ã€‚</td></tr><tr><td>Condition newCondition()</td><td>è·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å’Œå½“å‰çš„é”ç»‘å®šï¼Œå½“å‰çº¿ç¨‹åªæœ‰è·å¾—äº†é”ï¼Œæ‰èƒ½è°ƒç”¨è¯¥ç»„ä»¶çš„wait()æ–¹æ³•ï¼Œè€Œè°ƒç”¨åï¼Œå½“å‰çº¿ç¨‹å°†é‡Šæ”¾é”ã€‚</td></tr><tr><td>boolean tryLock()</td><td>åªæœ‰åœ¨è°ƒç”¨æ—¶æ‰å¯ä»¥è·å¾—é”ã€‚å¦‚æœå¯ç”¨ï¼Œåˆ™è·å–é”å®šï¼Œå¹¶ç«‹å³è¿”å›å€¼ä¸ºtrueï¼›å¦‚æœé”ä¸å¯ç”¨ï¼Œåˆ™æ­¤æ–¹æ³•å°†ç«‹å³è¿”å›å€¼ä¸ºfalse ã€‚</td></tr><tr><td>boolean tryLock(long time, TimeUnit unit)</td><td>è¶…æ—¶è·å–é”ï¼Œå½“å‰çº¿ç¨‹åœ¨ä¸€ä¸‹ä¸‰ç§æƒ…å†µä¸‹ä¼šè¿”å›ï¼š 1. å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è·å¾—äº†é”ï¼›2.å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ï¼›3.è¶…æ—¶æ—¶é—´ç»“æŸï¼Œè¿”å›false.</td></tr><tr><td>void unlock()</td><td>é‡Šæ”¾é”ã€‚</td></tr></tbody></table></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Lock lock = <span class="keyword">new</span> ReentrantLock(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">boolean</span> permitFoo = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(permitFoo) &#123;</span><br><span class="line">                printFoo.run();</span><br><span class="line">                    i++;</span><br><span class="line">                    permitFoo = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(!permitFoo) &#123;</span><br><span class="line">                printBar.run();</span><br><span class="line">                i++;</span><br><span class="line">                permitFoo = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ— é”"><a href="#æ— é”" class="headerlink" title="æ— é”"></a>æ— é”</h3><p>ä»¥ä¸Šçš„å…¬å¹³é”æ–¹æ¡ˆå®Œå…¨å¯ä»¥æ”¹é€ æˆæ— é”æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">boolean</span> permitFoo = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;     </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(permitFoo) &#123;</span><br><span class="line">        printFoo.run();</span><br><span class="line">            i++;</span><br><span class="line">            permitFoo = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;       </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!permitFoo) &#123;</span><br><span class="line">        printBar.run();</span><br><span class="line">        i++;</span><br><span class="line">        permitFoo = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CyclicBarrierç±»"><a href="#CyclicBarrierç±»" class="headerlink" title="CyclicBarrierç±»"></a>CyclicBarrierç±»</h3><p>å¾ªç¯åœºæ™¯ä¸­å¸¸ç”¨CyclicBarrier</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CyclicBarrier cb = <span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">boolean</span> fin = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!fin);</span><br><span class="line">            printFoo.run();</span><br><span class="line">            fin = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">cb.await();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">cb.await();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">            printBar.run();</span><br><span class="line">            fin = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ·é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”³è¯·Let&#39;s Encryptè¯ä¹¦æ¥å®ç°ç½‘ç«™HTTPSåŒ–</title>
      <link href="/2017/11/02/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E4%B9%8B%E7%94%B3%E8%AF%B7Let&#39;s%20Encrypt%E8%AF%81%E4%B9%A6/"/>
      <url>/2017/11/02/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E4%B9%8B%E7%94%B3%E8%AF%B7Let&#39;s%20Encrypt%E8%AF%81%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯-Letâ€™s-Encrypt"><a href="#ä»€ä¹ˆæ˜¯-Letâ€™s-Encrypt" class="headerlink" title="ä»€ä¹ˆæ˜¯ Letâ€™s Encrypt"></a>ä»€ä¹ˆæ˜¯ Letâ€™s Encrypt</h3><p>Letâ€™s Encrypt æ˜¯å›½å¤–ä¸€ä¸ªå…¬å…±çš„å…è´¹ SSL é¡¹ç›®ï¼Œç”± Linux åŸºé‡‘ä¼šæ‰˜ç®¡ã€‚å®ƒçš„æ¥å¤´ä¸å°ï¼Œç”± Mozillaã€æ€ç§‘ã€Akamaiã€IdenTrust å’Œ EFF ç­‰ç»„ç»‡å‘èµ·ï¼Œç›®çš„å°±æ˜¯å‘ç½‘ç«™è‡ªåŠ¨ç­¾å‘å’Œç®¡ç†å…è´¹è¯ä¹¦ã€‚ä»¥ä¾¿åŠ é€Ÿäº’è”ç½‘ç”± HTTP è¿‡æ¸¡åˆ° HTTPSï¼Œç›®å‰ Facebook ç­‰å¤§å…¬å¸å¼€å§‹åŠ å…¥èµåŠ©è¡Œåˆ—ã€‚</p><p>Letâ€™s Encrypt å·²ç»å¾—äº† IdenTrust çš„äº¤å‰ç­¾åï¼Œè¿™æ„å‘³ç€å…¶è¯ä¹¦ç°åœ¨å·²ç»å¯ä»¥è¢« Mozillaã€Googleã€Microsoft å’Œ Apple ç­‰ä¸»æµçš„æµè§ˆå™¨æ‰€ä¿¡ä»»ã€‚ç”¨æˆ·åªéœ€è¦åœ¨ Web æœåŠ¡å™¨è¯ä¹¦é“¾ä¸­é…ç½®äº¤å‰ç­¾åï¼Œæµè§ˆå™¨å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¤„ç†å¥½å…¶å®ƒçš„ä¸€åˆ‡ï¼ŒLetâ€™s Encrypt å®‰è£…ç®€å•ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚</p><p>æœ¬æ–‡å°†ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•å…è´¹ç”³è¯· Letâ€™s Encrypt é€šé…ç¬¦è¯ä¹¦ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯é€šé…ç¬¦è¯ä¹¦"><a href="#ä»€ä¹ˆæ˜¯é€šé…ç¬¦è¯ä¹¦" class="headerlink" title="ä»€ä¹ˆæ˜¯é€šé…ç¬¦è¯ä¹¦"></a>ä»€ä¹ˆæ˜¯é€šé…ç¬¦è¯ä¹¦</h3><p>åŸŸåé€šé…ç¬¦è¯ä¹¦ç±»ä¼¼ DNS è§£æçš„æ³›åŸŸåæ¦‚å¿µï¼Œé€šé…ç¬¦è¯ä¹¦å°±æ˜¯è¯ä¹¦ä¸­å¯ä»¥åŒ…å«ä¸€ä¸ªé€šé…ç¬¦ã€‚ä¸»åŸŸåç­¾å‘çš„é€šé…ç¬¦è¯ä¹¦å¯ä»¥åœ¨æ‰€æœ‰å­åŸŸåä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>.example.com</code>ã€<code>bbs.example.com</code>ã€‚</p><h3 id="ç”³è¯·é€šé…ç¬¦è¯ä¹¦"><a href="#ç”³è¯·é€šé…ç¬¦è¯ä¹¦" class="headerlink" title="ç”³è¯·é€šé…ç¬¦è¯ä¹¦"></a>ç”³è¯·é€šé…ç¬¦è¯ä¹¦</h3><p>Letâ€™s Encrypt ä¸Šçš„è¯ä¹¦ç”³è¯·æ˜¯é€šè¿‡ ACME åè®®æ¥å®Œæˆçš„ã€‚ACME åè®®è§„èŒƒåŒ–äº†è¯ä¹¦ç”³è¯·ã€æ›´æ–°ã€æ’¤é”€ç­‰æµç¨‹ï¼Œå®ç°äº† Letâ€™s Encrypt CA è‡ªåŠ¨åŒ–æ“ä½œã€‚è§£å†³äº†ä¼ ç»Ÿçš„ CA æœºæ„æ˜¯äººå·¥æ‰‹åŠ¨å¤„ç†è¯ä¹¦ç”³è¯·ã€è¯ä¹¦æ›´æ–°ã€è¯ä¹¦æ’¤é”€çš„æ•ˆç‡å’Œæˆæœ¬é—®é¢˜ã€‚</p><p>ACME v2 æ˜¯ ACME åè®®çš„æ›´æ–°ç‰ˆæœ¬ï¼Œé€šé…ç¬¦è¯ä¹¦åªèƒ½é€šè¿‡ ACME v2 è·å¾—ã€‚è¦ä½¿ç”¨ ACME v2 åè®®ç”³è¯·é€šé…ç¬¦è¯ä¹¦ï¼Œåªéœ€ä¸€ä¸ªæ”¯æŒè¯¥åè®®çš„å®¢æˆ·ç«¯å°±å¯ä»¥äº†ï¼Œå®˜æ–¹æ¨èçš„å®¢æˆ·ç«¯æ˜¯ Certbotã€‚</p><h4 id="è·å–-Certbot-å®¢æˆ·ç«¯"><a href="#è·å–-Certbot-å®¢æˆ·ç«¯" class="headerlink" title="è·å– Certbot å®¢æˆ·ç«¯"></a>è·å– Certbot å®¢æˆ·ç«¯</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ Certbot å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">https:</span>/<span class="regexp">/dl.eff.org/certbot</span>-auto</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ä¸ºå¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="variable">$ </span>chmod a+x certbot-auto</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šCertbot ä» 0.22.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ ACME v2ï¼Œå¦‚æœä½ ä¹‹å‰å·²å®‰è£…æ—§ç‰ˆæœ¬å®¢æˆ·ç«¯ç¨‹åºéœ€æ›´æ–°åˆ°æ–°ç‰ˆæœ¬ã€‚</p></blockquote><p>æ›´è¯¦ç»†çš„å®‰è£…å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://certbot.eff.org/">https://certbot.eff.org/</a></p><h4 id="ç”³è¯·é€šé…ç¬¦è¯ä¹¦-1"><a href="#ç”³è¯·é€šé…ç¬¦è¯ä¹¦-1" class="headerlink" title="ç”³è¯·é€šé…ç¬¦è¯ä¹¦"></a>ç”³è¯·é€šé…ç¬¦è¯ä¹¦</h4><p>å®¢æˆ·åœ¨ç”³è¯· Letâ€™s Encrypt è¯ä¹¦çš„æ—¶å€™ï¼Œéœ€è¦æ ¡éªŒåŸŸåçš„æ‰€æœ‰æƒï¼Œè¯æ˜æ“ä½œè€…æœ‰æƒåˆ©ä¸ºè¯¥åŸŸåç”³è¯·è¯ä¹¦ï¼Œç›®å‰æ”¯æŒä¸‰ç§éªŒè¯æ–¹å¼ï¼š</p><ul><li>dns-01ï¼šç»™åŸŸåæ·»åŠ ä¸€ä¸ª DNS TXT è®°å½•ã€‚</li><li>http-01ï¼šåœ¨åŸŸåå¯¹åº”çš„ Web æœåŠ¡å™¨ä¸‹æ”¾ç½®ä¸€ä¸ª HTTP well-known URL èµ„æºæ–‡ä»¶ã€‚</li><li>tls-sni-01ï¼šåœ¨åŸŸåå¯¹åº”çš„ Web æœåŠ¡å™¨ä¸‹æ”¾ç½®ä¸€ä¸ª HTTPS well-known URL èµ„æºæ–‡ä»¶ã€‚</li></ul><p>ä½¿ç”¨ Certbot å®¢æˆ·ç«¯ç”³è¯·è¯ä¹¦æ–¹æ³•éå¸¸çš„ç®€å•ï¼Œåªéœ€å¦‚ä¸‹ä¸€è¡Œå‘½ä»¤å°±æå®šäº†ã€‚</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="string">./certbot-auto</span> certonly  -d <span class="string">&quot;*.xxx.com&quot;</span> <span class="params">--manual</span> <span class="params">--preferred-challenges</span> dns-01  <span class="params">--server</span> https:<span class="string">//acme-v02.api.letsencrypt.org/directory</span></span><br></pre></td></tr></table></figure><blockquote><p>1.ç”³è¯·é€šé…ç¬¦è¯ä¹¦ï¼Œåªèƒ½ä½¿ç”¨ dns-01 çš„æ–¹å¼ã€‚<br>2.<code>xxx.com</code> è¯·æ ¹æ®è‡ªå·±çš„åŸŸåè‡ªè¡Œæ›´æ”¹ã€‚</p></blockquote><p>ç›¸å…³å‚æ•°è¯´æ˜ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">certonly è¡¨ç¤ºæ’ä»¶ï¼ŒCertbot æœ‰å¾ˆå¤šæ’ä»¶ã€‚ä¸åŒçš„æ’ä»¶éƒ½å¯ä»¥ç”³è¯·è¯ä¹¦ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©ã€‚</span><br><span class="line">-d ä¸ºå“ªäº›ä¸»æœºç”³è¯·è¯ä¹¦ã€‚å¦‚æœæ˜¯é€šé…ç¬¦ï¼Œè¾“å…¥ *.xxx.com (æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢ä¸ºä½ è‡ªå·±çš„åŸŸå)ã€‚</span><br><span class="line">--preferred-challenges dns-01ï¼Œä½¿ç”¨<span class="built_in"> DNS </span>æ–¹å¼æ ¡éªŒåŸŸåæ‰€æœ‰æƒã€‚</span><br><span class="line">--serverï¼ŒLet<span class="string">&#x27;s Encrypt ACME v2 ç‰ˆæœ¬ä½¿ç”¨çš„æœåŠ¡å™¨ä¸åŒäº v1 ç‰ˆæœ¬ï¼Œéœ€è¦æ˜¾ç¤ºæŒ‡å®šã€‚</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œè¿™ä¸€æ­¥ä¹‹åï¼Œå°±æ˜¯å‘½ä»¤è¡Œçš„è¾“å‡ºï¼Œè¯·æ ¹æ®æç¤ºè¾“å…¥ç›¸åº”å†…å®¹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://www.hi-linux.com/img/linux/le_ssl_01.png" alt="img"></p><p>æ‰§è¡Œåˆ°ä¸Šå›¾æœ€åä¸€æ­¥æ—¶ï¼Œå…ˆæš‚æ—¶ä¸è¦å›è½¦ã€‚ç”³è¯·é€šé…ç¬¦è¯ä¹¦æ˜¯è¦ç»è¿‡ DNS è®¤è¯çš„ï¼Œæ¥ä¸‹æ¥éœ€è¦æŒ‰ç…§æç¤ºåœ¨åŸŸååå°æ·»åŠ å¯¹åº”çš„ DNS TXT è®°å½•ã€‚æ·»åŠ å®Œæˆåï¼Œå…ˆè¾“å…¥ä»¥ä¸‹å‘½ä»¤ç¡®è®¤ TXT è®°å½•æ˜¯å¦ç”Ÿæ•ˆï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ dig  -t txt _acme-challenge.xxx.com @<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>    </span><br><span class="line">...</span><br><span class="line">;; OPT <span class="attr">PSEUDOSECTION:</span></span><br><span class="line">; <span class="attr">EDNS:</span> <span class="attr">version:</span> <span class="number">0</span>, <span class="attr">flags:</span>; <span class="attr">udp:</span> <span class="number">512</span></span><br><span class="line">;; QUESTION <span class="attr">SECTION:</span></span><br><span class="line">;_acme-challenge.xxx.com.        IN      TXT</span><br><span class="line"></span><br><span class="line">;; ANSWER <span class="attr">SECTION:</span></span><br><span class="line">_acme-challenge.xxx.com. <span class="number">599</span> IN  TXT     <span class="string">&quot;xxUHdwoZ6IaU_ab87h67rvbU2yJgdRyRe9zEA3jw&quot;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ç¡®è®¤ç”Ÿæ•ˆåï¼Œå›è½¦ç»§ç»­æ‰§è¡Œï¼Œæœ€åä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">   <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>xxx.com/fullchain.pem</span><br><span class="line">   Your key <span class="keyword">file</span> has been saved at:</span><br><span class="line">   <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>xxx.com/privkey.pem</span><br><span class="line">   Your cert will expire on <span class="number">2018</span>-<span class="number">06</span>-<span class="number">12</span>. To obtain a <span class="keyword">new</span> or tweaked</span><br><span class="line">   version of <span class="keyword">this</span> certificate in the future, simply run certbot-auto</span><br><span class="line">   again. To non-interactively renew *all* of your certificates, run</span><br><span class="line">   <span class="string">&quot;certbot-auto renew&quot;</span></span><br><span class="line"> - <span class="keyword">If</span> you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG <span class="regexp">/ Let&#x27;s Encrypt:   https:/</span><span class="regexp">/letsencrypt.org/</span>donate</span><br><span class="line">   Donating to EFF:                    https:<span class="comment">//eff.org/donate-le</span></span><br></pre></td></tr></table></figure><p>åˆ°äº†è¿™ä¸€æ­¥åï¼Œæ­å–œæ‚¨ï¼Œè¯ä¹¦ç”³è¯·æˆåŠŸã€‚ è¯ä¹¦å’Œå¯†é’¥ä¿å­˜åœ¨ä¸‹åˆ—ç›®å½•ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tree <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>xxx.com/</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ cert.pem</span><br><span class="line">â”œâ”€â”€ chain.pem</span><br><span class="line">â”œâ”€â”€ fullchain.pem</span><br><span class="line">â””â”€â”€ privkey.pem</span><br></pre></td></tr></table></figure><p>æ ¡éªŒè¯ä¹¦ä¿¡æ¯ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -<span class="keyword">in</span>  <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>xxx.com/cert.pem -noout -text </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°è¯ä¹¦åŒ…å«äº† SAN æ‰©å±•ï¼Œè¯¥æ‰©å±•çš„å€¼å°±æ˜¯ *.xxx.com</span></span><br><span class="line">...</span><br><span class="line">Authority Information Access: </span><br><span class="line">        OCSP - URI:http:<span class="regexp">//</span>ocsp.int-x3.letsencrypt.org</span><br><span class="line">        CA Issuers - URI:http:<span class="regexp">//</span>cert.int-x3.letsencrypt.org/</span><br><span class="line"></span><br><span class="line">X509v3 Subject Alternative Name: </span><br><span class="line">    DNS:*.xxx.com</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºäº†å¦‚ä½•åœ¨ Letâ€™s Encrypt ç”³è¯·å…è´¹çš„é€šé…ç¬¦è¯ä¹¦ã€‚</p><h3 id="å…¶å®ƒç›¸å…³"><a href="#å…¶å®ƒç›¸å…³" class="headerlink" title="å…¶å®ƒç›¸å…³"></a>å…¶å®ƒç›¸å…³</h3><ul><li>è¯ä¹¦ç»­æœŸ</li></ul><p>Letâ€™s encrypt çš„å…è´¹è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸä¸º 90 å¤©ï¼Œåˆ°æœŸåå¦‚æœè¦ç»­æœŸå¯ä»¥æ‰§è¡Œï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ certbot-<span class="built_in">auto</span> renew</span><br></pre></td></tr></table></figure><ul><li>åœ¨ Nginx ä¸­ é…ç½® Letâ€™s Encrypt è¯ä¹¦</li></ul><p>Nginx é…ç½®æ–‡ä»¶ç‰‡æ–­ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name xxx.com;</span><br><span class="line">    listen <span class="number">443</span> http2 ssl;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate <span class="regexp">/etc/</span>cert<span class="regexp">/xxx.com/</span>fullchain.pem;</span><br><span class="line">    ssl_certificate_key <span class="regexp">/etc/</span>cert<span class="regexp">/xxx.com/</span>privkey.pem;</span><br><span class="line">    ssl_trusted_certificate  <span class="regexp">/etc/</span>cert<span class="regexp">/xxx.com/</span>chain.pem;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_pass http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6666</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://www.google.com/">https://www.google.com</a><br><a href="https://www.jianshu.com/p/c5c9d071e395">https://www.jianshu.com/p/c5c9d071e395</a><br><a href="https://my.oschina.net/kimver/blog/1634575">https://my.oschina.net/kimver/blog/1634575</a></p><h1 id="å…è´¹-https-è¯ä¹¦ï¼ˆLetâ€™s-Encryptï¼‰ç”³è¯·ä¸é…ç½®"><a href="#å…è´¹-https-è¯ä¹¦ï¼ˆLetâ€™s-Encryptï¼‰ç”³è¯·ä¸é…ç½®" class="headerlink" title="å…è´¹ https è¯ä¹¦ï¼ˆLetâ€™s Encryptï¼‰ç”³è¯·ä¸é…ç½®"></a>å…è´¹ https è¯ä¹¦ï¼ˆLetâ€™s Encryptï¼‰ç”³è¯·ä¸é…ç½®</h1><p>2016-6-12 18:04 PM</p><p>ä¹‹å‰è¦ç”³è¯·å…è´¹çš„ https è¯ä¹¦æ“ä½œæ­¥éª¤ç›¸å½“éº»çƒ¦ï¼Œä»Šå¤©çœ‹åˆ°æœ‰äººåœ¨è®¨è®ºï¼Œå°±æœç´¢äº†ä¸€ä¸‹ã€‚å‘ç°ç°åœ¨ç”³è¯·æ­¥éª¤ç®€å•å¤šäº†ã€‚</p><h2 id="1-ä¸‹è½½-certbot"><a href="#1-ä¸‹è½½-certbot" class="headerlink" title="1. ä¸‹è½½ certbot"></a>1. ä¸‹è½½ certbot</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/certbot/certbot</span><br><span class="line"><span class="built_in">cd</span> certbot</span><br><span class="line">./certbot-auto --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>è§£å‹æ‰“å¼€æ‰§è¡Œå°±ä¼šæœ‰ç›¸å…³æç¤º</p><h2 id="2-ç”Ÿæˆå…è´¹è¯ä¹¦"><a href="#2-ç”Ÿæˆå…è´¹è¯ä¹¦" class="headerlink" title="2. ç”Ÿæˆå…è´¹è¯ä¹¦"></a>2. ç”Ÿæˆå…è´¹è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./certbot-auto certonly --webroot --agree-tos -v -t --email é‚®ç®±åœ°å€ -w ç½‘ç«™æ ¹ç›®å½• -d ç½‘ç«™åŸŸå</span><br><span class="line">./certbot-auto certonly --webroot --agree-tos -v -t --email keeliizhou@gmail.com -w /path/to/your/web/root -d note.crazy4code.com</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong> è¿™é‡Œ é»˜è®¤ä¼šè‡ªåŠ¨ç”Ÿæˆåˆ° /<strong>ç½‘ç«™æ ¹ç›®å½•</strong>/.well-known/acme-challenge æ–‡ä»¶å¤¹ï¼Œç„¶å shell è„šæœ¬ä¼šå¯¹åº”çš„è®¿é—® <strong>ç½‘ç«™åŸŸå</strong>/.well-known/acme-challenge æ˜¯å¦å­˜åœ¨æ¥ç¡®å®šä½ å¯¹ç½‘ç«™çš„æ‰€å±æƒ</p><p>æ¯”å¦‚ï¼šæˆ‘çš„åŸŸåæ˜¯ <strong>note.crazy4code.com</strong> é‚£æˆ‘å°±å¾—ä¿è¯åŸŸåä¸‹é¢çš„ <strong>.well-known/acme-challenge/</strong> ç›®å½•æ˜¯å¯è®¿é—®çš„</p><p>å¦‚æœè¿”å›æ­£å¸¸å°±ç¡®è®¤äº†ä½ å¯¹è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰æƒï¼Œå°±èƒ½é¡ºåˆ©ç”Ÿæˆï¼Œå®Œæˆåè¿™ä¸ªç›®å½•ä¼šè¢«æ¸…ç©º</p><h2 id="3-è·å–è¯ä¹¦"><a href="#3-è·å–è¯ä¹¦" class="headerlink" title="3. è·å–è¯ä¹¦"></a>3. è·å–è¯ä¹¦</h2><p>å¦‚æœä¸Šé¢çš„æ­¥éª¤æ­£å¸¸ shell è„šæœ¬ä¼šå±•ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Congratulations! Your certificate and chain have been saved at</span><br><span class="line"><span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>ç½‘ç«™åŸŸå/fullchain.pem</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="4-ç”Ÿæˆ-dhparams"><a href="#4-ç”Ÿæˆ-dhparams" class="headerlink" title="4. ç”Ÿæˆ dhparams"></a>4. ç”Ÿæˆ dhparams</h2><p>ä½¿ç”¨ openssl å·¥å…·ç”Ÿæˆ dhparams</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl dhparam -out /etc/ssl/certs/dhparams.pem 2048</span><br></pre></td></tr></table></figure><h2 id="5-é…ç½®-Nginx"><a href="#5-é…ç½®-Nginx" class="headerlink" title="5. é…ç½® Nginx"></a>5. é…ç½® Nginx</h2><p>æ‰“å¼€ nginx server é…ç½®æ–‡ä»¶åŠ å…¥å¦‚ä¸‹è®¾ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span> <span class="number">443</span></span><br><span class="line"></span><br><span class="line">ssl <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/ç½‘ç«™åŸŸå/fullchain.pem;</span><br><span class="line"><span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/ç½‘ç«™åŸŸå/privkey.pem;</span><br><span class="line"><span class="attribute">ssl_dhparam</span> /etc/ssl/certs/dhparams.pem;</span><br><span class="line"><span class="attribute">ssl_protocols</span> SSLv3 TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line"><span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ nginx æœåŠ¡å°±å¯ä»¥äº†</p><h2 id="6-å¼ºåˆ¶è·³è½¬-https"><a href="#6-å¼ºåˆ¶è·³è½¬-https" class="headerlink" title="6. å¼ºåˆ¶è·³è½¬ https"></a>6. å¼ºåˆ¶è·³è½¬ https</h2><p>https é»˜è®¤æ˜¯ç›‘å¬ 443 ç«¯å£çš„ï¼Œæ²¡å¼€å¯ https è®¿é—®çš„è¯ä¸€èˆ¬é»˜è®¤æ˜¯ 80 ç«¯å£ã€‚å¦‚æœä½ ç¡®å®šç½‘ç«™ 80 ç«¯å£ä¸Šçš„ç«™ç‚¹éƒ½æ”¯æŒ https çš„è¯åŠ å…¥ä¸‹é¢çš„é…ä»¶å¯ä»¥è‡ªåŠ¨é‡å®šå‘åˆ° https</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> your.domain.com;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-è¯ä¹¦æ›´æ–°"><a href="#7-è¯ä¹¦æ›´æ–°" class="headerlink" title="7. è¯ä¹¦æ›´æ–°"></a>7. è¯ä¹¦æ›´æ–°</h2><p>å…è´¹è¯ä¹¦åªæœ‰ 90 å¤©çš„æœ‰æ•ˆæœŸï¼Œåˆ°æ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–° renewã€‚åˆšå¥½ Letâ€™s encrypt æ——ä¸‹è¿˜æœ‰ä¸€ä¸ª <a href="https://letsmonitor.org/">Letâ€™s monitor</a> å…è´¹æœåŠ¡ï¼Œæ³¨å†Œè´¦å·æ·»åŠ éœ€è¦ç›‘æ§çš„åŸŸåï¼Œç³»ç»Ÿä¼šåœ¨è¯ä¹¦é©¬ä¸Šåˆ°æœŸæ—¶å‘å‡ºæé†’é‚®ä»¶ï¼Œéå¸¸æ–¹ä¾¿ã€‚æ”¶åˆ°é‚®ä»¶åå»åå°æ‰§è¡Œ renew å³å¯ï¼Œå¦‚æœæç¤ºæˆåŠŸå°±è¡¨ç¤º renew æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./certbot-auto renew</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> HTTP/HTTPS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿä¹‹ç¼ºé¡µä¸­æ–­åŠç½®æ¢</title>
      <link href="/2017/10/16/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD%E5%8F%8A%E7%BD%AE%E6%8D%A2/"/>
      <url>/2017/10/16/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD%E5%8F%8A%E7%BD%AE%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<p>ç¼ºé¡µä¸­æ–­ï¼ˆè‹±è¯­ï¼šPage faultï¼Œåˆåç¡¬é”™è¯¯ã€ç¡¬ä¸­æ–­ã€åˆ†é¡µé”™è¯¯ã€å¯»é¡µç¼ºå¤±ã€ç¼ºé¡µä¸­æ–­ã€é¡µæ•…éšœç­‰ï¼‰æŒ‡çš„æ˜¯å½“è½¯ä»¶è¯•å›¾è®¿é—®å·²æ˜ å°„åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œä½†æ˜¯ç›®å‰å¹¶æœªè¢«åŠ è½½åœ¨ç‰©ç†å†…å­˜ä¸­çš„ä¸€ä¸ªåˆ†é¡µæ—¶ï¼Œç”±ä¸­å¤®å¤„ç†å™¨çš„å†…å­˜ç®¡ç†å•å…ƒæ‰€å‘å‡ºçš„ä¸­æ–­ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨äºå¤„ç†æ­¤ä¸­æ–­çš„ç¨‹åºæ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœæ“ä½œç³»ç»Ÿåˆ¤æ–­æ­¤æ¬¡è®¿é—®æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šå°è¯•å°†ç›¸å…³çš„åˆ†é¡µä»ç¡¬ç›˜ä¸Šçš„è™šæ‹Ÿå†…å­˜æ–‡ä»¶ä¸­è°ƒå…¥å†…å­˜ã€‚è€Œå¦‚æœè®¿é—®æ˜¯ä¸è¢«å…è®¸çš„ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šç»“æŸç›¸å…³çš„è¿›ç¨‹ã€‚</p><p>è™½ç„¶å…¶åä¸ºâ€œé¡µç¼ºå¤±â€é”™è¯¯ï¼Œä½†å®é™…ä¸Šè¿™å¹¶ä¸ä¸€å®šæ˜¯ä¸€ç§é”™è¯¯ã€‚è€Œä¸”è¿™ä¸€æœºåˆ¶å¯¹äºåˆ©ç”¨è™šæ‹Ÿå†…å­˜æ¥å¢åŠ ç¨‹åºå¯ç”¨å†…å­˜ç©ºé—´çš„æ“ä½œç³»ç»Ÿï¼ˆæ¯”å¦‚Microsoft Windowså’Œå„ç§ç±»Unixç³»ç»Ÿï¼‰ä¸­éƒ½æ˜¯å¸¸è§ä¸”æœ‰å¿…è¦çš„ã€‚</p><p>å¾®è½¯åœ¨è¾ƒæ–°ç‰ˆWindowsçš„èµ„æºç›‘è§†å™¨ä¸­ä½¿ç”¨â€œç¡¬é”™è¯¯â€ï¼ˆWindows VistaåŠä»¥ä¸Šï¼‰ã€â€œç¡¬ä¸­æ–­â€ï¼ˆWindows 8åŠä»¥ä¸Šï¼‰è¿™ä¸€æœ¯è¯­æ¥æŒ‡ä»£â€œé¡µç¼ºå¤±â€ã€‚</p><a id="more"></a><h2 id="ç¼ºé¡µåˆ†ç±»"><a href="#ç¼ºé¡µåˆ†ç±»" class="headerlink" title="ç¼ºé¡µåˆ†ç±»"></a>ç¼ºé¡µåˆ†ç±»</h2><h3 id="è½¯æ€§é¡µç¼ºå¤±"><a href="#è½¯æ€§é¡µç¼ºå¤±" class="headerlink" title="è½¯æ€§é¡µç¼ºå¤±"></a>è½¯æ€§é¡µç¼ºå¤±</h3><p>è½¯æ€§é¡µç¼ºå¤±æŒ‡é¡µç¼ºå¤±å‘ç”Ÿæ—¶ï¼Œç›¸å…³çš„é¡µå·²ç»è¢«åŠ è½½è¿›å†…å­˜ï¼Œä½†æ˜¯æ²¡æœ‰å‘MMUæ³¨å†Œçš„æƒ…å†µã€‚æ“ä½œç³»ç»Ÿåªéœ€è¦åœ¨MMUä¸­æ³¨å†Œç›¸å…³é¡µå¯¹åº”çš„ç‰©ç†åœ°å€å³å¯ã€‚</p><p>å‘ç”Ÿè¿™ç§æƒ…å†µçš„å¯èƒ½æ€§ä¹‹ä¸€ï¼Œæ˜¯ä¸€å—ç‰©ç†å†…å­˜è¢«ä¸¤ä¸ªæˆ–å¤šä¸ªç¨‹åºå…±äº«ï¼Œæ“ä½œç³»ç»Ÿå·²ç»ä¸ºå…¶ä¸­çš„ä¸€ä¸ªè£…è½½å¹¶æ³¨å†Œäº†ç›¸åº”çš„é¡µï¼Œä½†æ˜¯æ²¡æœ‰ä¸ºå¦ä¸€ä¸ªç¨‹åºæ³¨å†Œã€‚</p><p>å¯èƒ½æ€§ä¹‹äºŒï¼Œæ˜¯è¯¥é¡µå·²è¢«ä»CPUçš„å·¥ä½œé›†ä¸­ç§»é™¤ï¼Œä½†æ˜¯å°šæœªè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šã€‚æ¯”å¦‚OpenVMSè¿™æ ·çš„ä½¿ç”¨æ¬¡çº§é¡µç¼“å­˜çš„ç³»ç»Ÿï¼Œå°±æœ‰å¯èƒ½ä¼šåœ¨å·¥ä½œé›†è¿‡å¤§çš„æƒ…å†µä¸‹ï¼Œå°†æŸé¡µä»å·¥ä½œé›†ä¸­å»é™¤ï¼Œä½†æ˜¯ä¸å†™å…¥ç¡¬ç›˜ä¹Ÿä¸æ“¦é™¤ï¼ˆæ¯”å¦‚è¯´è¿™ä¸€é¡µè¢«è¯»å‡ºç¡¬ç›˜åæ²¡è¢«ä¿®æ”¹è¿‡ï¼‰ï¼Œåªæ˜¯æ”¾å…¥ç©ºé—²é¡µè¡¨ã€‚é™¤éæœ‰å…¶ä»–ç¨‹åºéœ€è¦ï¼Œå¯¼è‡´è¿™ä¸€é¡µè¢«åˆ†é…å‡ºå»äº†ï¼Œä¸ç„¶è¿™ä¸€é¡µçš„å†…å®¹ä¸ä¼šè¢«ä¿®æ”¹ã€‚å½“åŸç¨‹åºå†æ¬¡éœ€è¦è¯¥é¡µå†…çš„æ•°æ®æ—¶ï¼Œå¦‚æœè¿™ä¸€é¡µç¡®å®æ²¡æœ‰è¢«åˆ†é…å‡ºå»ï¼Œé‚£ä¹ˆç³»ç»Ÿåªéœ€è¦é‡æ–°ä¸ºè¯¥é¡µåœ¨MMUå†…æ³¨å†Œæ˜ å°„å³å¯ã€‚</p><h3 id="ç¡¬æ€§é¡µç¼ºå¤±"><a href="#ç¡¬æ€§é¡µç¼ºå¤±" class="headerlink" title="ç¡¬æ€§é¡µç¼ºå¤±"></a>ç¡¬æ€§é¡µç¼ºå¤±</h3><p>ä¸è½¯æ€§é¡µç¼ºå¤±ç›¸åï¼Œç¡¬æ€§é¡µç¼ºå¤±æ˜¯æŒ‡ç›¸å…³çš„é¡µåœ¨é¡µç¼ºå¤±å‘ç”Ÿæ—¶æœªè¢«åŠ è½½è¿›å†…å­˜çš„æƒ…å†µã€‚è¿™æ—¶æ“ä½œç³»ç»Ÿéœ€è¦ï¼š</p><ol><li>å¯»æ‰¾åˆ°ä¸€ä¸ªç©ºé—²çš„é¡µã€‚æˆ–è€…æŠŠå¦å¤–ä¸€ä¸ªä½¿ç”¨ä¸­çš„é¡µå†™åˆ°ç£ç›˜ä¸Šï¼ˆå¦‚æœå…¶åœ¨æœ€åä¸€æ¬¡å†™å…¥åå‘ç”Ÿäº†å˜åŒ–çš„è¯ï¼‰ï¼Œå¹¶æ³¨é”€åœ¨MMUå†…çš„è®°å½•</li><li>å°†æ•°æ®è¯»å…¥è¢«é€‰å®šçš„é¡µ</li><li>å‘MMUæ³¨å†Œè¯¥é¡µ</li></ol><p>ç¡¬æ€§é¡µç¼ºå¤±å¯¼è‡´çš„æ€§èƒ½æŸå¤±æ˜¯å¾ˆå¤§çš„ã€‚ä»¥ä¸€å—7200rpmçš„ä¸»æµæœºæ¢°ç¡¬ç›˜ä¸ºä¾‹ï¼Œå…¶å¹³å‡å¯»é“æ—¶é—´ä¸º8.5æ¯«ç§’ï¼Œè¯»å…¥å†…å­˜éœ€è¦0.05æ¯«ç§’ã€‚ç›¸å¯¹çš„ï¼ŒDDR3å†…å­˜çš„è®¿é—®å»¶è¿Ÿé€šå¸¸åœ¨æ•°ååˆ°100çº³ç§’ä¹‹é—´ï¼Œæ€§èƒ½å·®è·å¯èƒ½ä¼šè¾¾åˆ°8ä¸‡åˆ°22ä¸‡å€ã€‚</p><p>å¦å¤–ï¼Œæœ‰äº›æ“ä½œç³»ç»Ÿä¼šå°†ç¨‹åºçš„ä¸€éƒ¨åˆ†å»¶è¿Ÿåˆ°éœ€è¦ä½¿ç”¨çš„æ—¶å€™å†åŠ è½½å…¥å†…å­˜æ‰§è¡Œï¼Œä»¥æ­¤æ¥æå‡æ€§èƒ½ã€‚è¿™ä¸€ç‰¹æ€§ä¹Ÿæ˜¯é€šè¿‡æ•è·ç¡¬æ€§é¡µç¼ºå¤±è¾¾åˆ°çš„ã€‚</p><p>å½“ç¡¬æ€§é¡µç¼ºå¤±è¿‡äºé¢‘ç¹çš„å‘ç”Ÿæ—¶ï¼Œç§°å‘ç”Ÿ<strong>ç³»ç»Ÿé¢ ç°¸</strong>ã€‚</p><h3 id="æ— æ•ˆé¡µç¼ºå¤±"><a href="#æ— æ•ˆé¡µç¼ºå¤±" class="headerlink" title="æ— æ•ˆé¡µç¼ºå¤±"></a>æ— æ•ˆé¡µç¼ºå¤±</h3><p>å½“ç¨‹åºè®¿é—®çš„è™šæ‹Ÿåœ°å€æ˜¯ä¸å­˜åœ¨äºè™šæ‹Ÿåœ°å€ç©ºé—´å†…çš„æ—¶å€™ï¼Œåˆ™å‘ç”Ÿæ— æ•ˆé¡µç¼ºå¤±ã€‚ä¸€èˆ¬æ¥è¯´è¿™æ˜¯ä¸ªè½¯ä»¶é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿä¸æ’é™¤ç¡¬ä»¶å¯èƒ½ï¼Œæ¯”å¦‚å› ä¸ºå†…å­˜æ•…éšœè€ŒæŸåäº†ä¸€ä¸ªæ­£ç¡®çš„æŒ‡é’ˆã€‚</p><p>å…·ä½“åŠ¨ä½œä¸æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œæ¯”å¦‚Windowsä¼šä½¿ç”¨å¼‚å¸¸æœºåˆ¶å‘ç¨‹åºæŠ¥å‘Šï¼Œè€Œç±»Unixç³»ç»Ÿåˆ™ä¼šä½¿ç”¨ä¿¡å·æœºåˆ¶ã€‚å¦‚æœç¨‹åºæœªå¤„ç†ç›¸å…³é—®é¢˜ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šæ‰§è¡Œé»˜è®¤å¤„ç†æ–¹å¼ï¼Œé€šå¸¸æ˜¯è½¬å‚¨å†…å­˜ã€ç»ˆæ­¢ç›¸å…³çš„ç¨‹åºï¼Œç„¶åå‘ç”¨æˆ·æŠ¥å‘Šã€‚</p><h2 id="ç¼ºé¡µä¸­æ–­"><a href="#ç¼ºé¡µä¸­æ–­" class="headerlink" title="ç¼ºé¡µä¸­æ–­"></a>ç¼ºé¡µä¸­æ–­</h2><p>ä¸­æ–­æ˜¯æŒ‡æ˜¯æŒ‡è®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œå½“å‡ºç°å¼‚å¸¸æƒ…å†µæˆ–ç‰¹æ®Šè¯·æ±‚æ—¶ï¼Œè®¡ç®—æœºåœæ­¢ç°è¡Œç¨‹åºçš„è¿è¡Œï¼Œè½¬å‘å¯¹è¿™äº›å¼‚å¸¸æƒ…å†µæˆ–ç‰¹æ®Šè¯·æ±‚çš„å¤„ç†ï¼Œå¤„ç†ç»“æŸåå†è¿”å›ç°è¡Œç¨‹åºçš„é—´æ–­å¤„ï¼Œç»§ç»­æ‰§è¡ŒåŸç¨‹åºã€‚</p><p>å¯¹äºç¼ºé¡µä¸­æ–­è€Œè¨€ï¼š</p><p>ä¸­æ–­æ¬¡æ•°=è¿›ç¨‹çš„ç‰©ç†å—æ•°Ã—é¡µé¢ç½®æ¢æ¬¡æ•°ã€‚</p><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶çš„äº‹ä»¶é¡ºåºå¦‚ä¸‹ï¼š</p><ol><li>ç¡¬ä»¶é™·å…¥å†…æ ¸ï¼Œåœ¨å†…æ ¸å †æ ˆä¸­ä¿å­˜ç¨‹åºè®¡æ•°å™¨ã€‚å¤§å¤šæ•°æœºå™¨å°†å½“å‰æŒ‡ä»¤çš„å„ç§çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨ç‰¹æ®Šçš„CPUå¯„å­˜å™¨ä¸­ã€‚</li><li>å¯åŠ¨ä¸€ä¸ªæ±‡ç¼–ä»£ç ä¾‹ç¨‹ä¿å­˜é€šç”¨å¯„å­˜å™¨å’Œå…¶ä»–æ˜“å¤±çš„ä¿¡æ¯ï¼Œä»¥å…è¢«æ“ä½œç³»ç»Ÿç ´åã€‚è¿™ä¸ªä¾‹ç¨‹å°†æ“ä½œç³»ç»Ÿä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚</li><li>å½“æ“ä½œç³»ç»Ÿå‘ç°ä¸€ä¸ªç¼ºé¡µä¸­æ–­æ—¶ï¼Œå°è¯•å‘ç°éœ€è¦å“ªä¸ªè™šæ‹Ÿé¡µé¢ã€‚é€šå¸¸ä¸€ä¸ªç¡¬ä»¶å¯„å­˜å™¨åŒ…å«äº†è¿™ä¸€ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»æ£€ç´¢ç¨‹åºè®¡æ•°å™¨ï¼Œå–å‡ºè¿™æ¡æŒ‡ä»¤ï¼Œç”¨è½¯ä»¶åˆ†æè¿™æ¡æŒ‡ä»¤ï¼Œçœ‹çœ‹å®ƒåœ¨ç¼ºé¡µä¸­æ–­æ—¶æ­£åœ¨åšä»€ä¹ˆã€‚</li><li>ä¸€æ—¦çŸ¥é“äº†å‘ç”Ÿç¼ºé¡µä¸­æ–­çš„è™šæ‹Ÿåœ°å€ï¼Œæ“ä½œç³»ç»Ÿæ£€æŸ¥è¿™ä¸ªåœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶æ£€æŸ¥å­˜å–ä¸ä¿æŠ¤æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå‘è¿›ç¨‹å‘å‡ºä¸€ä¸ªä¿¡å·æˆ–æ€æ‰è¯¥è¿›ç¨‹ã€‚å¦‚æœåœ°å€æœ‰æ•ˆä¸”æ²¡æœ‰ä¿æŠ¤é”™è¯¯å‘ç”Ÿï¼Œç³»ç»Ÿåˆ™æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²é¡µæ¡†ã€‚å¦‚æœæ²¡æœ‰ç©ºé—²é¡µæ¡†ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢ç®—æ³•å¯»æ‰¾ä¸€ä¸ªé¡µé¢æ¥æ·˜æ±°ã€‚</li><li>å¦‚æœé€‰æ‹©çš„é¡µæ¡†â€œè„â€äº†ï¼Œå®‰æ’è¯¥é¡µå†™å›ç£ç›˜ï¼Œå¹¶å‘ç”Ÿä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒæŒ‚èµ·äº§ç”Ÿç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ï¼Œè®©å…¶ä»–è¿›ç¨‹è¿è¡Œç›´è‡³ç£ç›˜ä¼ è¾“ç»“æŸã€‚æ— è®ºå¦‚ä½•ï¼Œè¯¥é¡µæ¡†è¢«æ ‡è®°ä¸ºå¿™ï¼Œä»¥å…å› ä¸ºå…¶ä»–åŸå› è€Œè¢«å…¶ä»–è¿›ç¨‹å ç”¨ã€‚</li><li>ä¸€æ—¦é¡µæ¡†â€œå¹²å‡€â€åï¼ˆæ— è®ºæ˜¯ç«‹åˆ»è¿˜æ˜¯åœ¨å†™å›ç£ç›˜åï¼‰ï¼Œæ“ä½œç³»ç»ŸæŸ¥æ‰¾æ‰€éœ€é¡µé¢åœ¨ç£ç›˜ä¸Šçš„åœ°å€ï¼Œé€šè¿‡ç£ç›˜æ“ä½œå°†å…¶è£…å…¥ã€‚è¯¥é¡µé¢è¢«è£…å…¥åï¼Œäº§ç”Ÿç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ä»ç„¶è¢«æŒ‚èµ·ï¼Œå¹¶ä¸”å¦‚æœæœ‰å…¶ä»–å¯è¿è¡Œçš„ç”¨æˆ·è¿›ç¨‹ï¼Œåˆ™é€‰æ‹©å¦ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹è¿è¡Œã€‚</li><li>å½“ç£ç›˜ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œè¡¨æ˜è¯¥é¡µå·²ç»è¢«è£…å…¥ï¼Œé¡µè¡¨å·²ç»æ›´æ–°å¯ä»¥åæ˜ å®ƒçš„ä½ç½®ï¼Œé¡µæ¡†ä¹Ÿè¢«æ ‡è®°ä¸ºæ­£å¸¸çŠ¶æ€ã€‚</li><li>æ¢å¤å‘ç”Ÿç¼ºé¡µä¸­æ–­æŒ‡ä»¤ä»¥å‰çš„çŠ¶æ€ï¼Œç¨‹åºè®¡æ•°å™¨é‡æ–°æŒ‡å‘è¿™æ¡æŒ‡ä»¤ã€‚</li><li>è°ƒåº¦å¼•å‘ç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿè¿”å›è°ƒç”¨å®ƒçš„æ±‡ç¼–è¯­è¨€ä¾‹ç¨‹ã€‚</li><li>è¯¥ä¾‹ç¨‹æ¢å¤å¯„å­˜å™¨å’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯</li></ol><h3 id="ä¸å…¶ä»–ä¸­æ–­åŒºåˆ«"><a href="#ä¸å…¶ä»–ä¸­æ–­åŒºåˆ«" class="headerlink" title="ä¸å…¶ä»–ä¸­æ–­åŒºåˆ«"></a>ä¸å…¶ä»–ä¸­æ–­åŒºåˆ«</h3><p>åœ¨è¯·æ±‚åˆ†é¡µç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢é¡µè¡¨ä¸­çš„çŠ¶æ€ä½æ¥ç¡®å®šæ‰€è¦è®¿é—®çš„é¡µé¢æ˜¯å¦å­˜åœ¨äºå†…å­˜ä¸­ã€‚æ¯å½“æ‰€è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜æ—¶ï¼Œä¼šäº§ç”Ÿä¸€æ¬¡ç¼ºé¡µä¸­æ–­ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šæ ¹æ®é¡µè¡¨ä¸­çš„å¤–å­˜åœ°å€åœ¨å¤–å­˜ä¸­æ‰¾åˆ°æ‰€ç¼ºçš„ä¸€é¡µï¼Œå°†å…¶è°ƒå…¥å†…å­˜ã€‚<br>ç¼ºé¡µæœ¬èº«æ˜¯ä¸€ç§ä¸­æ–­ï¼Œä¸ä¸€èˆ¬çš„ä¸­æ–­ä¸€æ ·ï¼Œéœ€è¦ç»è¿‡4ä¸ªå¤„ç†æ­¥éª¤ï¼š </p><ol><li>ä¿æŠ¤CPUç°åœº </li><li>åˆ†æä¸­æ–­åŸå›  </li><li>è½¬å…¥ç¼ºé¡µä¸­æ–­å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç† </li><li>æ¢å¤CPUç°åœºï¼Œç»§ç»­æ‰§è¡Œ </li></ol><p>ä½†æ˜¯ç¼ºé¡µä¸­æ–­æ—¶ç”±äºæ‰€è¦è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨äºå†…å­˜æ—¶ï¼Œæœ‰ç¡¬ä»¶æ‰€äº§ç”Ÿçš„ä¸€ç§ç‰¹æ®Šçš„ä¸­æ–­ï¼Œå› æ­¤ï¼Œä¸ä¸€èˆ¬çš„ä¸­æ–­å­˜åœ¨åŒºåˆ«ï¼š </p><ol><li>åœ¨æŒ‡ä»¤æ‰§è¡ŒæœŸé—´äº§ç”Ÿå’Œå¤„ç†ç¼ºé¡µä¸­æ–­ä¿¡å· </li><li>ä¸€æ¡æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡ç¼ºé¡µä¸­æ–­ </li><li>ç¼ºé¡µä¸­æ–­è¿”å›æ—¶ï¼Œæ‰§è¡Œäº§ç”Ÿä¸­æ–­çš„é‚£ä¸€æ¡æŒ‡ä»¤ï¼Œè€Œä¸€èˆ¬çš„ä¸­æ–­è¿”å›æ—¶ï¼Œæ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤</li></ol><h2 id="é¡µé¢ç½®æ¢ç®—æ³•"><a href="#é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="é¡µé¢ç½®æ¢ç®—æ³•"></a>é¡µé¢ç½®æ¢ç®—æ³•</h2><p>è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œè€Œæ­¤æ—¶å†…å­˜ä¸­æœ‰æ²¡æœ‰ç©ºé—²çš„ç‰©ç†å—æ˜¯ï¼Œä¸ºäº†èƒ½å¤ŸæŠŠæ‰€ç¼ºçš„é¡µé¢è£…å…¥å†…å­˜ï¼Œç³»ç»Ÿå¿…é¡»ä»å†…å­˜ä¸­é€‰æ‹©ä¸€é¡µè°ƒå‡ºåˆ°ç£ç›˜çš„å¯¹æ¢åŒºã€‚ä½†æ­¤æ—¶åº”è¯¥æŠŠé‚£ä¸ªé¡µé¢æ¢å‡ºï¼Œåˆ™éœ€è¦æ ¹æ®ä¸€å®šçš„é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆPage Replacement Algorithm)æ¥ç¡®å®šã€‚</p><h3 id="æœ€ä½³ç½®æ¢ï¼ˆOptimalï¼Œ-OPT"><a href="#æœ€ä½³ç½®æ¢ï¼ˆOptimalï¼Œ-OPT" class="headerlink" title="æœ€ä½³ç½®æ¢ï¼ˆOptimalï¼Œ OPT)"></a>æœ€ä½³ç½®æ¢ï¼ˆOptimalï¼Œ OPT)</h3><p>ç½®æ¢ä»¥åä¸å†è¢«è®¿é—®ï¼Œæˆ–è€…åœ¨å°†æ¥æœ€è¿Ÿæ‰è¢«å›è®¿çš„é¡µé¢ï¼Œç¼ºé¡µä¸­æ–­ç‡æœ€ä½ã€‚ä½†æ˜¯è¯¥ç®—æ³•éœ€è¦ä¾æ®ä»¥åå„ä¸šçš„ä½¿ç”¨æƒ…å†µï¼Œè€Œå½“ä¸€ä¸ªè¿›ç¨‹è¿˜æœªè¿è¡Œå®Œæˆæ˜¯ï¼Œå¾ˆéš¾ä¼°è®¡å“ªä¸€ä¸ªé¡µé¢æ˜¯ä»¥åä¸å†ä½¿ç”¨æˆ–åœ¨æœ€é•¿æ—¶é—´ä»¥åæ‰ä¼šç”¨åˆ°çš„é¡µé¢ã€‚æ‰€ä»¥è¯¥ç®—æ³•æ˜¯ä¸èƒ½å®ç°çš„ã€‚ä½†è¯¥ç®—æ³•ä»ç„¶æœ‰æ„ä¹‰ï¼Œä½œä¸ºå¾ˆäº®å…¶ä»–ç®—æ³•ä¼˜åŠ£çš„ä¸€ä¸ªæ ‡å‡†ã€‚</p><p>æœ€ä½³ç½®æ¢é‡‡ç”¨å›ºå®šåˆ†é…å±€éƒ¨ç½®æ¢çš„ç­–ç•¥ï¼Œå˜‰å®šç³»ç»Ÿä¸ºæŸè¿›ç¨‹åœ¨å†…å­˜ä¸­åˆ†é…äº†3ä¸ªç‰©ç†å—ï¼Œé¡µé¢è®¿é—®é¡ºåºä¸º2ã€3ã€2ã€1ã€5ã€2ã€4ã€5ã€3ã€2ã€5ã€2ã€‚å‡å®šç³»ç»Ÿæœªé‡‡ç”¨é¢„è°ƒé¡µç­–ç•¥ï¼Œå³æœªäº‹å…ˆè°ƒå…¥ä»»ä½•é¡µé¢ã€‚è¿›ç¨‹è¿è¡Œæ—¶ï¼Œä¸€æ¬¡å°†2ã€3ã€1ä¸‰ä¸ªé¡µé¢è°ƒå…¥å†…å­˜ï¼Œå‘ç”Ÿ3æ¬¡ç¼ºé¡µä¸­æ–­ã€‚å½“ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢5æ—¶ï¼Œäº§ç”Ÿç¬¬4æ¬¡ç¼ºé¡µä¸­æ–­ï¼Œæ ¹æ®OPTç®—æ³•ï¼Œæ·˜æ±°é¡µé¢1ï¼Œå› ä¸ºå®ƒåœ¨ä»¥åä¸ä¼šåœ¨ä½¿ç”¨äº†ï¼›ç¬¬5æ¬¡ç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ·˜æ±°é¡µé¢2ï¼Œå› ä¸ºå®ƒåœ¨5ã€3ã€2ä¸‰ä¸ªé¡µé¢ä¸­ï¼Œæ˜¯åœ¨å°†æ¥æœ€è¿Ÿæ‰ä¼šè¢«é¡µé¢è®¿é—®çš„é¡µé¢ã€‚ä»¥æ­¤ç±»æ¨ï¼š<br>æ³¨æ„ï¼šç¬¬4æ¬¡ä¸­æ–­æ—¶å°†æœ€åä¸ä¼šè®¿é—®çš„1å‰”é™¤ï¼Œå°†æœ€åæ‰è®¿é—®çš„3æ”¾å…¥æœ€ä¸‹é¢çš„å†…å­˜å—ä¸­ï¼Œä»¥åçš„è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œæœ€åä¸ä¼šè®¿é—®æˆ–æœ€åæ‰è¢«è®¿é—®çš„é¡µé¢æ€»æ˜¯æ”¾åœ¨æœ€ä¸‹é¢çš„å†…å­˜å—ä¸­ã€‚å†…å­˜å—ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å­˜æ”¾æœ€å…ˆè®¿é—®çš„é¡µé¢ã€‚<br>ä¸­æ–­æ¬¡æ•°ä¸º6ï¼Œç¼ºé¡µä¸­æ–­ç‡ä¸º6/12*100% = 50%ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">P:</th><th style="text-align:center">2</th><th style="text-align:center">3</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">5</th><th style="text-align:center">2</th><th style="text-align:center">4</th><th style="text-align:center">5</th><th style="text-align:center">3</th><th style="text-align:center">2</th><th style="text-align:center">5</th><th style="text-align:center">2</th></tr></thead><tbody><tr><td style="text-align:center">M=3</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">5</td><td style="text-align:center">5</td><td style="text-align:center">3</td><td style="text-align:center">5</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">5</td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">5</td><td style="text-align:center">4</td><td style="text-align:center">2</td><td style="text-align:center">5</td><td style="text-align:center">5</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">3</td><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">F=5</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center"></td></tr></tbody></table></div><h3 id="å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•ï¼ˆFirst-In-First-Out-FIFO"><a href="#å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•ï¼ˆFirst-In-First-Out-FIFO" class="headerlink" title="å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•ï¼ˆFirst In First Out, FIFO)"></a>å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•ï¼ˆFirst In First Out, FIFO)</h3><p>FIFOç½®æ¢æœ€å…ˆè°ƒå…¥å†…å­˜çš„é¡µé¢ï¼Œå³ç½®æ¢åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢ã€‚æŒ‰ç…§è¿›å…¥å†…å­˜çš„å…ˆåæ¬¡åºæ’åˆ—æˆé˜Ÿåˆ—ï¼Œä»é˜Ÿå°¾è¿›å…¥ï¼Œä»é˜Ÿé¦–åˆ é™¤ã€‚ä½†æ˜¯è¯¥ç®—æ³•ä¼šæ·˜æ±°ç»å¸¸è®¿é—®çš„é¡µé¢ï¼Œä¸é€‚åº”è¿›ç¨‹å®é™…è¿è¡Œçš„è§„å¾‹ï¼Œç›®å‰å·²ç»å¾ˆå°‘ä½¿ç”¨ã€‚</p><p>ä»¥OPTç®—ä¾‹ä¸ºä¾‹å­ã€‚ ä¸­æ–­æ¬¡æ•°ä¸º6ï¼Œç¼ºé¡µä¸­æ–­ç‡ä¸º9/12*100% = 75%ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">P:</th><th style="text-align:center">2</th><th style="text-align:center">3</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">5</th><th style="text-align:center">2</th><th style="text-align:center">4</th><th style="text-align:center">5</th><th style="text-align:center">3</th><th style="text-align:center">2</th><th style="text-align:center">5</th><th style="text-align:center">2</th></tr></thead><tbody><tr><td style="text-align:center">M=3</td><td style="text-align:center">2</td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">1</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">5</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">3</td><td style="text-align:center">1</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">3</td><td style="text-align:center">5</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">2</td><td style="text-align:center">3</td><td style="text-align:center">1</td><td style="text-align:center">5</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">3</td></tr><tr><td style="text-align:center">F=9</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">Y</td></tr></tbody></table></div><h4 id="Beladyå¼‚å¸¸"><a href="#Beladyå¼‚å¸¸" class="headerlink" title="Beladyå¼‚å¸¸"></a>Beladyå¼‚å¸¸</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†é…ç»™è¿›ç¨‹çš„ç‰©ç†å—è¶Šå¤šï¼Œè¿è¡Œæ—¶çš„ç¼ºé¡µæ¬¡æ•°åº”è¯¥è¶Šå°‘ï¼Œä½¿ç”¨FIFOæ—¶ï¼Œå¯èƒ½å­˜åœ¨ç›¸åæƒ…å†µï¼Œåˆ†é…4ä¸ªç‰©ç†å—çš„ç¼ºé¡µç«Ÿç„¶æ¯”3ä¸ªç‰©ç†å—çš„ç¼ºé¡µæ¬¡æ•°è¿˜å¤šï¼<br>ä¾‹å¦‚ï¼šè¿›ç¨‹è®¿é—®é¡ºåºä¸º0ã€2ã€1ã€3ã€0ã€2ã€4ã€0ã€2ã€1ã€3ã€4ã€‚<br>M=3æ—¶ï¼Œç¼ºé¡µä¸­æ–­9æ¬¡ã€‚ç¼ºé¡µä¸­æ–­ç‡9/12*100% = 75%ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">P:</th><th style="text-align:center">0</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">3</th><th style="text-align:center">0</th><th style="text-align:center">2</th><th style="text-align:center">4</th><th style="text-align:center">0</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">3</th><th style="text-align:center">4</th></tr></thead><tbody><tr><td style="text-align:center">M=3</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">3</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">1</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">F=9</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center">Y</td></tr></tbody></table></div><p>ï¼­=4æ—¶ï¼Œç¼ºé¡µä¸­æ–­10æ¬¡ã€‚ç¼ºé¡µä¸­æ–­ç‡10/12*100% = 83.3%ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">P:</th><th style="text-align:center">0</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">3</th><th style="text-align:center">0</th><th style="text-align:center">2</th><th style="text-align:center">4</th><th style="text-align:center">0</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">3</th><th style="text-align:center">4</th></tr></thead><tbody><tr><td style="text-align:center">M=4</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">4</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">4</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">4</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">4</td><td style="text-align:center">0</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">F=10</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td></tr></tbody></table></div><h3 id="æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼ˆLeast-Recently-Usedï¼Œ-LRUï¼‰"><a href="#æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼ˆLeast-Recently-Usedï¼Œ-LRUï¼‰" class="headerlink" title="æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼ˆLeast Recently Usedï¼Œ LRUï¼‰"></a>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼ˆLeast Recently Usedï¼Œ LRUï¼‰</h3><p>LRUçš„æ€æƒ³æ˜¯ç½®æ¢æœ€è¿‘ä¸€æ®µæ—¶é—´ä»¥æ¥æœ€é•¿æ—¶é—´æœªè®¿é—®è¿‡çš„é¡µé¢ã€‚æ ¹æ®ç¨‹åºå±€éƒ¨æ€§åŸç†ï¼Œåˆšè¢«è®¿é—®çš„é¡µé¢ï¼Œå¯èƒ½é©¬ä¸Šåˆè¦è¢«è®¿é—®ï¼›è€Œè¾ƒé•¿æ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®çš„é¡µé¢ï¼Œå¯èƒ½æœ€è¿‘ä¸ä¼šè¢«è®¿é—®ã€‚ LRUç®—æ³•æ™®ååœ°é€‚ç”¨äºå„ç§ç±»å‹çš„ç¨‹åºï¼Œä½†æ˜¯ç³»ç»Ÿè¦æ—¶æ—¶åˆ»åˆ»å¯¹å„é¡µçš„è®¿é—®å†å²æƒ…å†µåŠ ä»¥è®°å½•å’Œæ›´æ–°ï¼Œå¼€é”€å¤ªå¤§ï¼Œå› æ­¤LRUç®—æ³•å¿…é¡»è¦æœ‰ç¡¬ä»¶çš„æ”¯æŒã€‚</p><p>ä»¥OPTç®—ä¾‹ä¸ºä¾‹å­ã€‚ä¸­æ–­æ¬¡æ•°ä¸º6ï¼Œç¼ºé¡µä¸­æ–­ç‡ä¸º7/12*100% = 58.3%ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">P:</th><th style="text-align:center">2</th><th style="text-align:center">3</th><th style="text-align:center">2</th><th style="text-align:center">1</th><th style="text-align:center">5</th><th style="text-align:center">2</th><th style="text-align:center">4</th><th style="text-align:center">5</th><th style="text-align:center">3</th><th style="text-align:center">2</th><th style="text-align:center">5</th><th style="text-align:center">2</th></tr></thead><tbody><tr><td style="text-align:center">M=3</td><td style="text-align:center">2</td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">5</td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">5</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">2</td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">5</td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">5</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">1</td><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">4</td><td style="text-align:center">5</td><td style="text-align:center">3</td><td style="text-align:center">3</td></tr><tr><td style="text-align:center">F=7</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center"></td><td style="text-align:center">Y</td><td style="text-align:center">Y</td><td style="text-align:center"></td></tr></tbody></table></div><p>å †æ ˆå®ç°LRUï¼š<br>ç³»ç»Ÿä½¿ç”¨ç‰¹æ®Šçš„å †æ ˆæ¥å­˜æ”¾å†…å­˜ä¸­æ¯ä¸€ä¸ªé¡µé¢çš„é¡µå·ã€‚æ¯å½“è®¿é—®ä¸€é¡µæ—¶å°±è°ƒæ•´ä¸€æ¬¡ï¼Œå³æŠŠè¢«è®¿é—®é¡µé¢çš„é¡µå·ä»æ ˆä¸­ç§»å‡ºå†å‹å…¥æ ˆé¡¶ã€‚å› æ­¤ï¼Œæ ˆé¡¶å§‹ç»ˆæ˜¯æœ€æ–°è¢«è®¿é—®é¡µé¢çš„é¡µå·ï¼Œæ ˆåº•å§‹ç»ˆæ˜¯æœ€è¿‘æœ€ä¹…æœªè¢«è®¿é—®çš„é¡µå·ã€‚å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ€»æ˜¯æ·˜æ±°æ ˆåº•é¡µå·æ‰€å¯¹åº”çš„é¡µé¢ã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿè™šæ‹Ÿå­˜å‚¨å™¨æœºåˆ¶</title>
      <link href="/2017/10/15/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E8%99%9A%E6%8B%9F%E5%AD%98%E5%82%A8%E5%99%A8/"/>
      <url>/2017/10/15/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E8%99%9A%E6%8B%9F%E5%AD%98%E5%82%A8%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>æ¯å½“æˆ‘ä»¬å®‰å¿ƒçš„ä½¿ç”¨LINUXç³»ç»Ÿæˆ–è€…åœ¨ç¼–å†™Cè¯­è¨€çš„æ—¶å€™ï¼Œå®‰å¿ƒçš„ä½¿ç”¨mallocæˆ–è€…freeçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆå°‘å…³æ³¨è¿‡å…¶åº•å±‚çš„å†…å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼ŒCPUæ˜¯å¦‚ä½•è·å–ä»ä¸»å­˜ä¸­è·å–æ•°æ®çš„ï¼Œæˆ‘ä»¬çš„å¯»å€æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥å¯»æ‰¾åˆ°å¯¹åº”çš„æ•°æ®ï¼Œè¿˜æ˜¯é€šè¿‡æŸç§è½¬åŒ–æœºåˆ¶ã€‚å®é™…ä¸Šï¼Œå¯¹äºæ¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒæ‰€èƒ½æ¥è§¦åˆ°çš„åœ°å€éƒ½ä¸æ˜¯å®é™…çš„ç‰©ç†åœ°å€ï¼Œè€Œæ˜¯é€šè¿‡è™šæ‹Ÿåœ°å€è¿›è¡Œæ˜ å°„è€Œæ¥çš„ã€‚è¿™é‡Œæ¥ç ”ç©¶ä¸€ä¸‹è™šæ‹Ÿå­˜å‚¨å™¨çš„æŠ€æœ¯ç»†èŠ‚ã€‚</p><a id="more"></a><h3 id="ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜"><a href="#ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜" class="headerlink" title="ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜"></a>ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜</h3><h4 id="ç‰©ç†å†…å­˜"><a href="#ç‰©ç†å†…å­˜" class="headerlink" title="ç‰©ç†å†…å­˜"></a>ç‰©ç†å†…å­˜</h4><p>ç‰©ç†å†…å­˜å°±æ˜¯æˆ‘ä»¬ç”µè„‘ä¸Šçš„RAMæä¾›çš„å†…å­˜ã€‚ä»–æ˜¯å›ºå®šçš„ï¼Œå†…å­˜æ¡çš„å®¹é‡å¤šå¤§ï¼Œç‰©ç†å†…å­˜å°±æœ‰å¤šå¤§ï¼ˆé›†æˆæ˜¾å¡ç³»ç»Ÿé™¤å¤–ï¼‰ã€‚ä½†æ˜¯å¦‚æœç¨‹åºè¿è¡Œå¾ˆå¤šæˆ–è€…ç¨‹åºæœ¬èº«å¾ˆå¤§çš„è¯ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡çš„ç‰©ç†å†…å­˜å ç”¨ï¼Œç”šè‡³å¯¼è‡´ç‰©ç†å†…å­˜æ¶ˆè€—æ®†å°½ã€‚</p><h4 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h4><p>ç®€æ˜çš„è¯´ï¼Œè™šæ‹Ÿå†…å­˜å°±æ˜¯åœ¨ç¡¬ç›˜ä¸Šåˆ’åˆ†ä¸€å—é¡µé¢æ–‡ä»¶ï¼Œå……å½“å†…å­˜ã€‚å½“ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œæœ‰ä¸€éƒ¨åˆ†èµ„æºè¿˜æ²¡æœ‰ç”¨ä¸Šæˆ–è€…åŒæ—¶æ‰“å¼€å‡ ä¸ªç¨‹åºå´åªæ“ä½œå…¶ä¸­ä¸€ä¸ªç¨‹åºæ—¶ï¼Œç³»ç»Ÿæ²¡å¿…è¦å°†ç¨‹åºæ‰€æœ‰çš„èµ„æºéƒ½å¡åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œäºæ˜¯ï¼Œç³»ç»Ÿå°†è¿™äº›æš‚æ—¶ä¸ç”¨çš„èµ„æºæ”¾åœ¨è™šæ‹Ÿå†…å­˜ä¸Šï¼Œç­‰åˆ°éœ€è¦æ—¶åœ¨è°ƒå‡ºæ¥ç”¨ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶å¯ä»¥ç›´æ¥æŠŠç‰©ç†åœ°å€ç†è§£æˆæ’åœ¨æœºå™¨ä¸Šé‚£æ ¹å†…å­˜æœ¬èº«ï¼ŒæŠŠå†…å­˜çœ‹æˆä¸€ä¸ªä»0å­—èŠ‚ä¸€ç›´åˆ°æœ€å¤§ç©ºé‡é€å­—èŠ‚çš„ç¼–å·çš„å¤§æ•°ç»„ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°ç»„å«åšç‰©ç†åœ°å€ï¼Œä½†æ˜¯äº‹å®ä¸Šï¼Œè¿™åªæ˜¯ä¸€ä¸ªç¡¬ä»¶æä¾›ç»™è½¯ä»¶çš„æŠ½åƒï¼Œå†…å­˜çš„å¯»å€æ–¹å¼å¹¶ä¸æ˜¯è¿™æ ·ã€‚æ‰€ä»¥ï¼Œè¯´å®ƒæ˜¯â€œä¸ åœ°å€æ€»çº¿ç›¸å¯¹åº”â€ï¼Œæ˜¯æ›´è´´åˆ‡ä¸€äº›ï¼Œä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œè¿™ç§æ¨¡å‹çš„ç†è§£ä¹Ÿä¸ç®—é”™è¯¯ã€‚</p><h3 id="ç‰©ç†åœ°å€ä¸é€»è¾‘åœ°å€"><a href="#ç‰©ç†åœ°å€ä¸é€»è¾‘åœ°å€" class="headerlink" title="ç‰©ç†åœ°å€ä¸é€»è¾‘åœ°å€"></a>ç‰©ç†åœ°å€ä¸é€»è¾‘åœ°å€</h3><p><strong>ç‰©ç†åœ°å€(physical address)</strong>ï¼šç”¨äºå†…å­˜èŠ¯ç‰‡çº§çš„å•å…ƒå¯»å€ï¼Œä¸å¤„ç†å™¨å’ŒCPUè¿æ¥çš„åœ°å€æ€»çº¿ç›¸å¯¹åº”ã€‚å®ƒæ˜¯åŠ è½½åˆ°å†…å­˜åœ°å€å¯„å­˜å™¨ä¸­çš„åœ°å€ï¼Œå†…å­˜å•å…ƒçš„çœŸæ­£åœ°å€ã€‚åœ¨å‰ç«¯æ€»çº¿ä¸Šä¼ è¾“çš„å†…å­˜åœ°å€éƒ½æ˜¯ç‰©ç†å†…å­˜åœ°å€ï¼Œç¼–å·ä»0å¼€å§‹ä¸€ç›´åˆ°å¯ç”¨ç‰©ç†å†…å­˜çš„æœ€é«˜ç«¯ã€‚è¿™äº›æ•°å­—è¢«åŒ—æ¡¥(Nortbridge chip)æ˜ å°„åˆ°å®é™…çš„å†…å­˜æ¡ä¸Šã€‚ç‰©ç†åœ°å€æ˜¯æ˜ç¡®çš„ã€æœ€ç»ˆç”¨åœ¨æ€»çº¿ä¸Šçš„ç¼–å·ï¼Œä¸å¿…è½¬æ¢ï¼Œä¸å¿…åˆ†é¡µï¼Œä¹Ÿæ²¡æœ‰ç‰¹æƒçº§æ£€æŸ¥(no translation, no paging, no privilege checks)ã€‚</p><p><strong>é€»è¾‘åœ°å€(logical address)</strong>ï¼šæ˜¯æŒ‡ç”±ç¨‹åºäº§ç”Ÿçš„ä¸æ®µç›¸å…³çš„åç§»åœ°å€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ åœ¨è¿›è¡ŒCè¯­è¨€æŒ‡é’ˆ<a href="http://www.2cto.com/kf">ç¼–ç¨‹</a>ä¸­ï¼Œå¯ä»¥è¯»å–æŒ‡é’ˆå˜é‡æœ¬èº«å€¼(&amp;æ“ä½œ)ï¼Œå®é™…ä¸Šè¿™ä¸ªå€¼å°±æ˜¯é€»è¾‘åœ°å€ï¼Œå®ƒæ˜¯ç›¸å¯¹äºä½ å½“å‰è¿›ç¨‹æ•°æ®æ®µçš„åœ°å€ï¼Œä¸å’Œç»å¯¹ç‰©ç†åœ°å€ç›¸å¹²ã€‚<br><strong>çº¿æ€§åœ°å€(linear address)æˆ–ä¹Ÿå«è™šæ‹Ÿåœ°å€(virtual address)</strong><br>è·Ÿé€»è¾‘åœ°å€ç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªä¸çœŸå®çš„åœ°å€ï¼Œå¦‚æœé€»è¾‘åœ°å€æ˜¯å¯¹åº”çš„ç¡¬ä»¶å¹³å°æ®µå¼ç®¡ç†è½¬æ¢å‰åœ°å€çš„è¯ï¼Œé‚£ä¹ˆçº¿æ€§åœ°å€åˆ™å¯¹åº”äº†ç¡¬ä»¶é¡µå¼å†…å­˜çš„è½¬æ¢å‰åœ°å€ã€‚</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€"></a>ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€</h4><ul><li>ä¸»å­˜çš„å®¹é‡æœ‰é™ã€‚è™½ç„¶æˆ‘ä»¬ç°åœ¨çš„ä¸»å­˜å®¹é‡åœ¨ä¸æ–­ä¸Šå‡ï¼Œ4Gï¼Œ8Gï¼Œ16Gçš„ä¸»å­˜éƒ½å‡ºç°åœ¨å¸‚é¢ä¸Šã€‚ä½†æ˜¯æˆ‘ä»¬çš„è¿›ç¨‹æ˜¯æ— é™ï¼Œå¦‚æœè®¡ç®—æœºä¸Šçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½ç‹¬å ä¸€å—ç‰©ç†å­˜å‚¨å™¨(å³ç‰©ç†åœ°å€ç©ºé—´)ã€‚é‚£ä¹ˆï¼Œä¸»å­˜å°±ä¼šå¾ˆå¿«è¢«ç”¨å®Œã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨ä¸åŒçš„æ—¶åˆ»éƒ½æ˜¯åªä¼šç”¨åŒä¸€å—ä¸»å­˜çš„æ•°æ®ï¼Œè¿™å°±è¯´æ˜äº†å…¶å®åªè¦åœ¨è¿›ç¨‹æƒ³è¦ä¸»å­˜æ•°æ®çš„æ—¶å€™æˆ‘ä»¬æŠŠéœ€è¦çš„ä¸»å­˜åŠ è½½ä¸Šå°±å¥½ï¼Œæ¢è¿›æ¢å‡ºã€‚é’ˆå¯¹è¿™æ ·çš„éœ€æ±‚ï¼Œç›´æ¥æä¾›ä¸€æ•´å—ä¸»å­˜çš„ç‰©ç†åœ°å€å°±æ˜æ˜¾ä¸ç¬¦åˆã€‚</li><li>è¿›ç¨‹é—´é€šä¿¡çš„éœ€æ±‚ã€‚å¦‚æœæ¯ä¸ªè¿›ç¨‹éƒ½ ç‹¬å ä¸€å—ç‰©ç†åœ°å€ï¼Œè¿™æ ·å°±åªèƒ½é€šè¿‡socketè¿™æ ·çš„æ‰‹æ®µè¿›è¡Œè¿›ç¨‹é€šä¿¡ï¼Œä½†å¦‚æœè¿›ç¨‹é—´èƒ½ä½¿ç”¨åŒä¸€å—ç‰©ç†åœ°å€å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li><li>ä¸»å­˜çš„ä¿æŠ¤é—®é¢˜ã€‚å¯¹äºä¸»å­˜æ¥è¯´ï¼Œéœ€è¦è¯´æ˜è¿™æ®µå†…å­˜æ˜¯å¯è¯»çš„ï¼Œå¯å†™çš„ï¼Œè¿˜æ˜¯å¯æ‰§è¡Œçš„ã€‚é’ˆå¯¹è¿™ç‚¹ï¼Œå…‰ç”¨ç‰©ç†åœ°å€ä¹Ÿæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚</li></ul><p>é’ˆå¯¹ç‰©ç†åœ°å€çš„ç›´æ¥æ˜ å°„çš„è®¸å¤šå¼Šç«¯ï¼Œè®¡ç®—æœºçš„è®¾è®¡ä¸­å°±é‡‡å–äº†ä¸€ä¸ªè™šæ‹ŸåŒ–è®¾è®¡ï¼Œå°±æ˜¯è™šæ‹Ÿå†…å­˜ã€‚CPUé€šè¿‡å‘å‡ºè™šæ‹Ÿåœ°å€ï¼Œè™šæ‹Ÿåœ°å€å†é€šè¿‡MMUç¿»è¯‘æˆç‰©ç†åœ°å€ï¼Œæœ€åè·å¾—æ•°æ®ï¼Œå…·ä½“çš„æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/VNLy6mGz5qMOX3h.jpg" alt="20171106142548425 (2)"></p><p>åˆ©ç”¨äº†è™šæ‹Ÿå†…å­˜å°±å¯ä»¥æ¯”è¾ƒæœ‰æ•ˆçš„è§£å†³ä»¥ä¸Šä¸‰ä¸ªé—®é¢˜ï¼Œåœ¨æ¯ä¸€ä¸ªè¿›ç¨‹å¼€å§‹åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ†é…ä¸€ä¸ªè™šæ‹Ÿå­˜å‚¨å™¨ï¼ˆå°±æ˜¯ä¸€æ®µè™šæ‹Ÿåœ°å€ï¼‰ç„¶åé€šè¿‡è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„æ¥è·å–çœŸå®æ•°æ®ï¼Œè¿™æ ·è¿›ç¨‹å°±ä¸ä¼šç›´æ¥æ¥è§¦åˆ°ç‰©ç†åœ°å€ï¼Œç”šè‡³ä¸çŸ¥é“è‡ªå·±è°ƒç”¨çš„é‚£å—ç‰©ç†åœ°å€çš„æ•°æ®ã€‚</p><h4 id="è™šæ‹Ÿåœ°å€ç©ºé—´"><a href="#è™šæ‹Ÿåœ°å€ç©ºé—´" class="headerlink" title="è™šæ‹Ÿåœ°å€ç©ºé—´"></a>è™šæ‹Ÿåœ°å€ç©ºé—´</h4><p>å½“å¤„ç†å™¨è¯»å–æˆ–å†™å…¥å†…å­˜ä½ç½®æ—¶ï¼Œå®ƒä¼šä½¿ç”¨è™šæ‹Ÿåœ°å€ã€‚ åœ¨è¯»å–æˆ–å†™å…¥æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå¤„ç†å™¨ä¼šå°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ é€šè¿‡è™šæ‹Ÿåœ°å€è®¿é—®å†…å­˜æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ul><li>ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—è¿ç»­çš„è™šæ‹Ÿåœ°å€æ¥è®¿é—®ç‰©ç†å†…å­˜ä¸­ä¸è¿ç»­çš„å¤§å†…å­˜ç¼“å†²åŒºã€‚</li><li>ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—è™šæ‹Ÿåœ°å€æ¥è®¿é—®å¤§äºå¯ç”¨ç‰©ç†å†…å­˜çš„å†…å­˜ç¼“å†²åŒºã€‚ å½“ç‰©ç†å†…å­˜çš„ä¾›åº”é‡å˜å°æ—¶ï¼Œå†…å­˜ç®¡ç†å™¨ä¼šå°†ç‰©ç†å†…å­˜é¡µï¼ˆé€šå¸¸å¤§å°ä¸º 4 KBï¼‰ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ã€‚ æ•°æ®æˆ–ä»£ç é¡µä¼šæ ¹æ®éœ€è¦åœ¨ç‰©ç†å†…å­˜ä¸ç£ç›˜ä¹‹é—´ç§»åŠ¨ã€‚</li><li>ä¸åŒè¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿåœ°å€å½¼æ­¤éš”ç¦»ã€‚ ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä»£ç æ— æ³•æ›´æ”¹æ­£åœ¨ç”±å¦ä¸€è¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚</li></ul><p>è¿›ç¨‹å¯ç”¨çš„è™šæ‹Ÿåœ°å€èŒƒå›´ç§°ä¸ºè¯¥è¿›ç¨‹çš„â€œè™šæ‹Ÿåœ°å€ç©ºé—´â€ ã€‚ æ¯ä¸ªç”¨æˆ·æ¨¡å¼è¿›ç¨‹éƒ½æœ‰å…¶å„è‡ªçš„ä¸“ç”¨è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ å¯¹äº 32 ä½è¿›ç¨‹ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´é€šå¸¸ä¸º 2 GBï¼ŒèŒƒå›´ä» 0x00000000 è‡³ 0x7FFFFFFFã€‚ å¯¹äº 64 ä½ Windows ä¸Šçš„ 64 ä½è¿›ç¨‹ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´ä¸º 128 TBï¼ŒèŒƒå›´ä» 0x000â€™00000000 è‡³ 0x7FFFâ€™FFFFFFFFã€‚ ä¸€ç³»åˆ—è™šæ‹Ÿåœ°å€æœ‰æ—¶ç§°ä¸ºä¸€ç³»åˆ—â€œè™šæ‹Ÿå†…å­˜â€ ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/SupEMq4Jgi6Waol.png" alt="å›¾ï¼šä¸¤ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´"></p><p>è¯¥å›¾æ˜¾ç¤ºäº†ä¸¤ä¸ª 64 ä½è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼šNotepad.exe å’Œ MyApp.exeã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å…¶å„è‡ªçš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒèŒƒå›´ä» 0x000â€™0000000 è‡³ 0x7FFâ€™FFFFFFFFã€‚ æ¯ä¸ªé˜´å½±å—éƒ½è¡¨ç¤ºè™šæ‹Ÿå†…å­˜æˆ–ç‰©ç†å†…å­˜çš„ä¸€ä¸ªé¡µï¼ˆå¤§å°ä¸º 4 KBï¼‰ã€‚ æ³¨æ„ï¼ŒNotepad è¿›ç¨‹ä½¿ç”¨ä» 0x7F7â€™93950000 å¼€å§‹çš„è™šæ‹Ÿåœ°å€çš„ä¸‰ä¸ªè¿ç»­é¡µé¢ã€‚ ä½†è™šæ‹Ÿåœ°å€çš„è¿™ä¸‰ä¸ªè¿ç»­é¡µé¢ä¼šæ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸­çš„éè¿ç»­é¡µé¢ã€‚ å¦è¯·æ³¨æ„ï¼Œä¸¤ä¸ªè¿›ç¨‹éƒ½ä½¿ç”¨ä» 0x7F7â€™93950000 å¼€å§‹çš„è™šæ‹Ÿå†…å­˜é¡µé¢ï¼Œä½†è¿™äº›è™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„ä¸åŒé¡µé¢ã€‚</p><h4 id="åœ°å€åˆ†é¡µ"><a href="#åœ°å€åˆ†é¡µ" class="headerlink" title="åœ°å€åˆ†é¡µ"></a>åœ°å€åˆ†é¡µ</h4><p>å¯¹äºä¸€æ•´å—è¿ç»­çš„å†…å­˜ï¼Œç›´æ¥è¿ç»­ä½¿ç”¨ä¹Ÿæ˜¯ä¸å¤ªç¬¦åˆå®é™…çš„ã€‚äºæ˜¯ï¼Œå°±æœ‰åˆ†é¡µçš„æ¦‚å¿µã€‚å°†1024ä¸ªåœ°å€åˆ†æˆä¸€é¡µï¼Œé€šè¿‡è®¿é—®é¡µæ¥è®¿é—®æ•°æ®ã€‚é‚£ä¹ˆæœ‰äº†é¡µå°±è¦æœ‰å¦‚ä½•å¯»æ‰¾é¡µçš„æ¦‚å¿µäº†ã€‚æˆ‘ä»¬é€šè¿‡æ¯ä¸€é¡µçš„é¦–åœ°å€ä½œä¸ºé¡µå…¥å£ï¼Œå³(PTE)æ¥æ£€ç´¢é¡µã€‚é‚£ä¹ˆï¼Œå¯¹äºè¿™äº›PTEï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„æ¥è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·çš„æ•°æ®ç»“æ„å°±æ˜¯é¡µè¡¨(page table)ã€‚</p><h3 id="è™šæ‹Ÿå­˜å‚¨å™¨ç¼“å­˜"><a href="#è™šæ‹Ÿå­˜å‚¨å™¨ç¼“å­˜" class="headerlink" title="è™šæ‹Ÿå­˜å‚¨å™¨ç¼“å­˜"></a>è™šæ‹Ÿå­˜å‚¨å™¨ç¼“å­˜</h3><p>é™æ€éšæœºå­˜å‚¨å™¨ ï¼ˆSRAMï¼‰ çš„é€Ÿåº¦æ˜¯åŠ¨æ€éšæœºå­˜å‚¨å™¨ï¼ˆDRAMï¼‰çš„10å€ï¼ŒDRAMæ˜¯ç£ç›˜é€Ÿåº¦çš„ç™¾æ¥å€ï¼Œæ‰€ä»¥SRAMå¸¸ä½œä¸ºCPUä¸ŠL1ï¼ŒL2ï¼ŒL3ç¼“å­˜çš„ææ–™ï¼ŒDRAMä½œä¸ºä¸»å­˜ï¼Œé’ˆå¯¹äºSRAMå’ŒDRAMï¼Œcache MISSçš„æƒ©ç½šè€Œè¨€ï¼ŒDRAMçš„æƒ©ç½šæ›´å¤§ï¼Œå› ä¸ºDRAMçš„è¯»å†™é€Ÿåº¦æ˜¯ç£ç›˜çš„å‡ ç™¾å€ï¼Œæ‰€ä»¥åˆ©ç”¨åœ¨DRAMçš„ç¼“å­˜çš„ä½œç”¨å°±æ›´å¤§äº†ï¼Œé’ˆå¯¹äºè™šæ‹Ÿå­˜å‚¨å™¨çš„ç¼“å­˜ä½œç”¨å¯ä»¥ç”¨ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/aEXmFkuPO1Y8v7f.png" alt="20171106150701652"></p><h4 id="ç¼ºé¡µä¸­æ–­"><a href="#ç¼ºé¡µä¸­æ–­" class="headerlink" title="ç¼ºé¡µä¸­æ–­"></a>ç¼ºé¡µä¸­æ–­</h4><p>è™šæ‹Ÿå­˜å‚¨å™¨ä¸­çš„å—åˆ†ä¸ºï¼šæœªåˆ†é…çš„ï¼Œç¼“å­˜çš„ï¼Œæœªç¼“å­˜çš„ã€‚<br>æœªåˆ†é…çš„ï¼šé¡¾åæ€ä¹‰ï¼Œè¿™ä¸€å—çš„è™šæ‹Ÿå­˜å‚¨å™¨ä¸æ˜ å°„äºä»»ä½•å—ã€‚<br>ç¼“å­˜çš„ï¼šè¿™ä¸€å—çš„è™šæ‹Ÿå­˜å‚¨å™¨æ˜ å°„äºå·²ç»å­˜åœ¨äºDRAMä¸­çš„ç‰©ç†é¡µã€‚<br>æœªç¼“å­˜çš„ï¼šè¿™ä¸€å—çš„è™šæ‹Ÿå­˜å‚¨å™¨æ˜ å°„äºå­˜åœ¨äºç£ç›˜ä¸­çš„è™šæ‹Ÿé¡µã€‚ï¼ˆä¹Ÿå°±æ˜¯è¦ä½¿ç”¨å°±è¦æŠŠç£ç›˜ä¸­çš„è™šæ‹Ÿé¡µæ›¿æ¢åˆ°DRAMä¸­çš„ç‰©ç†é¡µï¼Œä¼šå‘ç”ŸPage Fault ï¼‰<br>æœ‰æ•ˆå’Œæ— æ•ˆé€šè¿‡ä¸€ä¸ªvalid bit(æœ‰æ•ˆä½)æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/hf9zc1nRVw6BSLG.png" alt="20171106151241526"></p><p>ä¸Šå›¾ä¸­ï¼ŒVMç¼ºé¡µï¼Œå¯¹VP3ä¸­çš„å­—çš„å¼•ç”¨ä¸å‘½ä¸­ï¼Œè§¦å‘ç¼ºé¡µã€‚</p><h4 id="ç¼ºé¡µç½®æ¢"><a href="#ç¼ºé¡µç½®æ¢" class="headerlink" title="ç¼ºé¡µç½®æ¢"></a>ç¼ºé¡µç½®æ¢</h4><p>DRAMé‡Œé¢æœ‰ï¼šé¡µè¡¨ï¼ŒPTEï¼ˆé¡µè¡¨å…¥å£ï¼‰ï¼Œç‰©ç†å­˜å‚¨å™¨<br>ç£ç›˜é‡Œé¢ï¼šè™šæ‹Ÿé¡µè¡¨</p><p>é‚£ä¹ˆå¯¹äºç¼“å­˜æ¥è¯´ï¼šå°±æœ‰é¡µå‘½ä¸­ï¼Œå’Œé¡µä¸å‘½ä¸­ä¸¤ç§æƒ…å†µ<br>é¡µå‘½ä¸­ï¼šåœ¨å›¾ä¸­å°±ç±»ä¼¼äºVP1,VP2,è¿™ç±»çš„é¡µè¡¨ï¼Œç›´æ¥ç¼“å­˜åœ¨DRAMä¸­çš„ç‰©ç†å­˜å‚¨å™¨ä¸­ï¼Œå¯ä»¥ç›´æ¥ä»DRAMä¸­è·å–é€Ÿåº¦å°±å¿«äº†ã€‚<br>é¡µä¸å‘½ä¸­ï¼šå°±æ˜¯è®¿é—®é¡µè¡¨ä¸­æœªç¼“å­˜çš„PTEï¼Œå¦‚VP3,VP6ä¹‹ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€è¯´æ˜çš„æƒ…å†µ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/JimQ8bnewxrafUG.png" alt="20171106151903458"></p><p>è™šæ‹Ÿåœ°å€æƒ³è®¿é—®VP3çš„æ—¶å€™ï¼Œå‘ç°VP3æœªåœ¨ç¼“å­˜ä¸­ï¼Œå‘ç”Ÿç¼ºé¡µé”™è¯¯ï¼Œåˆ©ç”¨æ›¿æ¢ç®—æ³•(æ›¿æ¢ç®—æ³•å¯èƒ½æ˜¯FIFOï¼Œæˆ–è€…LRU)å°†ç‰©ç†å­˜å‚¨å™¨ä¸­çš„ä¸€ä¸ªVP3ä»ç‰©ç†å­˜å‚¨å™¨ä¸­å¯¼å‡ºï¼ŒVP4ä»ç£ç›˜å¯¼å…¥DRAMä¸­ã€‚æ­¤æ—¶,PTE3å°±å˜æˆäº†å·²ç¼“å­˜ï¼ŒPTE4å˜æˆäº†æœªç¼“å­˜ã€‚è¿™æ—¶å€™åœ¨è¿›è¡Œåœ°å€ç¿»è¯‘ï¼Œå°±å˜æˆé¡µå‘½ä¸­äº†ã€‚<br>å¯è§ï¼Œç¼ºé¡µé”™è¯¯ä»ç£ç›˜å¯¼å…¥çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œä½†æ˜¯ç”±äºå±€éƒ¨æ€§åŸç†ï¼Œè¿›ç¨‹å¾€å¾€æ›´å¤šçš„åœ¨è¾ƒå°çš„æ´»åŠ¨é¡µé¢ä¸Šå·¥ä½œï¼Œå¾ˆå°‘æœ‰å¤§è·¨åº¦çš„è®¿é—®å†…å­˜ï¼Œä½¿å¾—ç¼ºé¡µé”™è¯¯äº§ç”Ÿçš„å¯èƒ½æ€§é™ä½ã€‚é¡µå‘½ä¸­çš„å¯èƒ½æ€§æé«˜ã€‚è·å–æ•°æ®çš„æ•ˆç‡å°±å¿«äº†å¾ˆå¤šã€‚</p><h3 id="è™šæ‹Ÿå­˜å‚¨å™¨ä½œç”¨"><a href="#è™šæ‹Ÿå­˜å‚¨å™¨ä½œç”¨" class="headerlink" title="è™šæ‹Ÿå­˜å‚¨å™¨ä½œç”¨"></a>è™šæ‹Ÿå­˜å‚¨å™¨ä½œç”¨</h3><p>è™šæ‹Ÿå­˜å‚¨å™¨çš„ä½œç”¨æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p>ç®€åŒ–å…±äº«ï¼šåˆ©ç”¨è™šæ‹Ÿåœ°å€æ¥æ˜ å°„ç‰©ç†åœ°å€ï¼Œä½¿å¾—å¯ä»¥è®©å¤šä¸ªè¿›ç¨‹çš„ä¸åŒè™šæ‹Ÿåœ°å€æ˜ å°„åŒä¸€å—ç‰©ç†åœ°å€ï¼Œæ¯”å¦‚ç±»ä¼¼äºprintfï¼Œè¿™ä¸€ç±»å¸¸ç”¨çš„åº“ï¼Œä¸ä¼šæŠŠprintfçš„ä»£ç æ‹·è´åˆ°æ¯ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯è®©ä¸åŒè¿›ç¨‹éƒ½ä½¿ç”¨åŒä¸€å—printf.</p></li><li><p>è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ä¿æŠ¤çš„å·¥å…·ï¼Œåœ¨è™šæ‹Ÿå­˜å‚¨å™¨é‡Œé¢å¯ä»¥è®¾è®¡è¯¥PTEæ˜¯å¯è¯»ï¼Œå¯å†™ï¼Œè¿˜æ˜¯å¯æ‰§è¡Œçš„ã€‚å¦‚æœä¸€æ—¦å‡ºç°åªè¯»çš„PTEè¢«å†™å…¥äº†ï¼ŒCPUå°±ä¼šå‘é€å‡ºç°segmentation fault(æ®µé”™è¯¯)ä½†å¹¶ä¸ä¼šå½±å“åˆ°å®é™…å­˜æ”¾æ•°æ®çš„ç‰©ç†å†…å­˜ï¼Œ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/mzVwEvieXfNkrLS.png" alt="20171106154635188"></p></li></ol><h3 id="åœ°å€è½¬æ¢"><a href="#åœ°å€è½¬æ¢" class="headerlink" title="åœ°å€è½¬æ¢"></a>åœ°å€è½¬æ¢</h3><p>åœ°å€ç¿»è¯‘çš„ç›®çš„æ˜¯é€šè¿‡MMUå°†è™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ã€‚</p><h4 id="è™šæ‹Ÿåœ°å€çš„åœ°å€ä½"><a href="#è™šæ‹Ÿåœ°å€çš„åœ°å€ä½" class="headerlink" title="è™šæ‹Ÿåœ°å€çš„åœ°å€ä½"></a>è™šæ‹Ÿåœ°å€çš„åœ°å€ä½</h4><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/Z6IApWlGDs5ca8X.png" alt="20171106165015337"></p><h4 id="ä¸€çº§é¡µè¡¨åœ°å€è½¬æ¢"><a href="#ä¸€çº§é¡µè¡¨åœ°å€è½¬æ¢" class="headerlink" title="ä¸€çº§é¡µè¡¨åœ°å€è½¬æ¢"></a>ä¸€çº§é¡µè¡¨åœ°å€è½¬æ¢</h4><p>æ— è®ºæ˜¯è™šæ‹Ÿåœ°å€è¿˜æ˜¯ç‰©ç†åœ°å€éƒ½è¢«åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªé¡µå·(PN)ï¼Œç”¨æ¥å¯»æ‰¾å¯¹åº”çš„å­˜å‚¨é¡µï¼Œè¿˜æœ‰ä¸€ä¸ªåç§»é‡(PO)ç”¨æ¥å¯»æ‰¾åœ¨å¯¹åº”é¡µä¸­çš„åç§»é‡ã€‚å¯¹äºåç§»é‡æ¥è¯´ï¼Œè™šæ‹Ÿé¡µçš„åç§»é‡å’Œç‰©ç†é¡µçš„åç§»é‡æ˜¯ç›¸åŒçš„ã€‚é‚£ä¹ˆï¼Œè¯´æ˜æˆ‘ä»¬æ‰€éœ€è¦çš„è½¬åŒ–å°±æ˜¯ä»è™šæ‹Ÿé¡µå·è½¬åŒ–åˆ°ç‰©ç†é¡µå·ã€‚</p><p>   <img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/v1X839J2wiKNW5Q.png" alt="20171106165756623"></p><p>è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå°trickåŠ é€Ÿç¿»è¯‘çš„é€Ÿåº¦ï¼Œåˆ†åˆ«å°†VPN,VPOåˆ†å¼€ä¼ è¾“ï¼ŒVPNä¼ è¾“åˆ°MMUè¿›è¡Œç¿»è¯‘ï¼ŒVPOç›´æ¥ä¼ è¾“åˆ°L1 cacheè¿›è¡Œåç§»æ£€ç´¢ï¼Œè€Œä¸æ˜¯ç­‰åˆ°VPNç¿»è¯‘æˆPPNå†è¿›è¡Œç¿»è¯‘ï¼Œè¿™ä¸ªç§°ä½œæ˜¯<strong>ä¼˜åŒ–åœ°å€ç¿»è¯‘</strong></p><h5 id="ç¿»è¯‘é¡µå·"><a href="#ç¿»è¯‘é¡µå·" class="headerlink" title="ç¿»è¯‘é¡µå·"></a>ç¿»è¯‘é¡µå·</h5><p>ç¿»è¯‘é¡µå·çš„æ­¥éª¤å°±æ˜¯é€šè¿‡VPNåœ¨é¡µè¡¨ä¸­è¿›è¡Œå¯»æ‰¾æ‰¾åˆ°å¯¹åº”çš„PTE,å¦‚æœå‘ç°PTEçš„æœ‰æ•ˆä½ä¸º0,è¯´æ˜é¡µé¢ä¸å­˜åœ¨ï¼Œå°±å‡ºç°ç¼ºé¡µé”™è¯¯ï¼Œé‡æ–°åŠ è½½é¡µé¢åˆ°ç‰©ç†å­˜å‚¨å™¨ä¸­ï¼Œç„¶åè®¾æœ‰æ•ˆä½ä¸º1ï¼ˆä¸Šé¢çš„ç¼ºé¡µé”™è¯¯è¯´çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼‰ã€‚åä¹‹ï¼Œæœ‰æ•ˆä½ä¸º1ï¼Œè¯´æ˜é¡µå‘½ä¸­ï¼Œå–å‡ºPPNå’ŒVPOä¸€åˆï¼Œå¾—åˆ°ç‰©ç†åœ°å€ï¼Œä¸‹å›¾åˆ†åˆ«è¯´æ˜äº†ï¼Œé¡µå‘½ä¸­ä¸ç¼ºé¡µå¼‚å¸¸ä¸¤ç§æƒ…å†µçš„ç¿»è¯‘æƒ…å†µï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/lxEHDnFzj3g5wGL.png" alt="20171106171923231"></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/BJYeXUE5OIsSrdA.png" alt="20171106171934562"></p><h4 id="TLBåŠ é€Ÿåœ°å€ç¿»è¯‘"><a href="#TLBåŠ é€Ÿåœ°å€ç¿»è¯‘" class="headerlink" title="TLBåŠ é€Ÿåœ°å€ç¿»è¯‘"></a>TLBåŠ é€Ÿåœ°å€ç¿»è¯‘</h4><p>é€šè¿‡DRAMä¸­çš„é¡µè¡¨æ¥è¿›è¡Œåœ°å€ç¿»è¯‘çš„é€Ÿåº¦æœ‰å¯èƒ½å¤ªæ…¢äº†ï¼Œæ— æ³•æ»¡è¶³é€Ÿåº¦çš„éœ€æ±‚ã€‚è¿™ä¸ªæ—¶å€™å°±è¦TLBä¸­æ´¾ä¸Šç”¨åœºäº†ï¼ŒTLBå®é™…ä½äºCPUç¼“å­˜å¯„å­˜å™¨Cacheä¸­ï¼Œä½œä¸ºSRAMçš„ä¸€éƒ¨åˆ†ï¼Œé€Ÿåº¦æ˜¯å¿«äºé¡µè¡¨æŸ¥è¯¢çš„ã€‚TLBçš„å®é™…ä½œç”¨ï¼Œåšä¸€ä¸ªæ˜ å°„ï¼Œå°†VPNåœ¨TLBä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„PPNã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒTLBæ˜¯æ€ä¹ˆåšçš„æ˜ å°„çš„å‘¢ï¼Ÿè¿™æ—¶å€™å°±è¦è¯´æ˜ä¸€ä¸‹VPNå¯¹äºTLBæ¥è¯´å¯ä»¥åˆ†æˆé‚£å‡ å—ï¼Œè¯·çœ‹ä¸‹å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/tWgEMXiYOsorfln.png" alt="20171106173628712"></p><p>å¯ä»¥çœ‹è§VPNè¢«åˆ†ä¸º(TLBT:TLBæ ‡è®°ï¼ŒTLBI:TLBç´¢å¼•)<br>è¿™æ—¶å€™å†æ¥çœ‹çœ‹TLBæ„æˆæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ<br>è¿™é‡Œå±•ç¤ºçš„æ˜¯ä¸€ä¸ªå››è·¯ç»„ç›¸è¿çš„ä¸€ä¸ªTLB</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/W1QKoHsaiVGC89F.png" alt="20171106174024990"></p><p>TLBIçš„ä¸¤ä½å°±è¯´æ˜è¯¥é€‰TLBçš„é‚£ä¸€ç»„ï¼Œå‰é¢çš„6ä½TLBTè¯´æ˜æ ‡è®°ä½ã€‚</p><h4 id="äºŒçº§å’Œå¤šçº§é¡µè¡¨åœ°å€è½¬æ¢"><a href="#äºŒçº§å’Œå¤šçº§é¡µè¡¨åœ°å€è½¬æ¢" class="headerlink" title="äºŒçº§å’Œå¤šçº§é¡µè¡¨åœ°å€è½¬æ¢"></a>äºŒçº§å’Œå¤šçº§é¡µè¡¨åœ°å€è½¬æ¢</h4><p>äºŒçº§é¡µè¡¨æˆ–è€…å¤šçº§é¡µè¡¨éƒ½æ˜¯ä¸ºäº†æ›´å¿«çš„æ£€ç´¢å’Œæ›´èŠ‚çº¦ç©ºé—´ï¼Œè¯·å…ˆçœ‹ä¸‹é¢ä¸€ä¸ªäºŒçº§é¡µè¡¨çš„ä¾‹å­ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/i3vRDMFNL1JjVSa.png" alt="20171106174828443"></p><p>é¦–å…ˆäºŒçº§é¡µè¡¨å¹¶ä¸å¤æ‚ï¼Œå°±ç›¸å½“äºå¤šäº†ä¸€æ¬¡æ˜ å°„ï¼Œæˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„è®¡ç®—æ¥è¯´æ˜äºŒçº§é¡µè¡¨å®¹é‡å…³ç³»ï¼Œåœ¨ä¸€çº§é¡µè¡¨ä¸­ï¼Œä¸€ä¸ªPTEæŒ‡å‘çš„æ˜¯äºŒçº§é¡µè¡¨ä¸­ï¼Œ1024ä¸ªPTEçš„ä¸€é¡µï¼Œé‚£ä¹ˆäºŒçº§é¡µè¡¨ä¸­çš„ä¸€ä¸ªPTEä¹Ÿå°±æŒ‡å‘è™šæ‹Ÿå­˜å‚¨å™¨ä¸­çš„ä¸€é¡µï¼Œä¹Ÿå°±æ˜¯1KBçš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªåœ°å€ä¸­æœ‰32ä½ï¼Œä¹Ÿå°±æ˜¯4ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆåœ¨äºŒçº§é¡µè¡¨ä¸­çš„ä¸€ä¸ªPTEæ‰€åŒ…å«çš„å®¹é‡å°±ä¸º4KBå­—èŠ‚ã€‚å¯¹äºä¸€çº§é¡µè¡¨è€Œè¨€ï¼Œä¸€ä¸ªPTEå°±ä»£è¡¨ç€4MBå­—èŠ‚çš„ç©ºé—´ï¼Œ1Kçš„ä¸€çº§é¡µè¡¨å°±ä»£è¡¨äº†4GBå­—èŠ‚çš„ç©ºé—´ï¼Œ4GBå·²ç»æ˜¯ç°åœ¨å¾ˆå¤šå†…å­˜æ¡çš„å®¹é‡äº†ã€‚</p><p>é‚£ä¹ˆå¯¹äºå¤šçº§é¡µè¡¨ï¼Œä¸€ä¸ªVPNåˆæ˜¯æ€ä¹ˆåˆ†é…å’Œæ˜ å°„çš„å‘¢ã€‚ç›¸ä¿¡ä¸‹é¢çš„ä¸€å¼ å›¾å°±å¯ä»¥è¯´æ˜æ¸…æ¥šã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/sqMklVFunyQ46oe.png" alt="20171106180207151"></p><h4 id="ç‰©ç†åœ°å€å¤„ç†"><a href="#ç‰©ç†åœ°å€å¤„ç†" class="headerlink" title="ç‰©ç†åœ°å€å¤„ç†"></a>ç‰©ç†åœ°å€å¤„ç†</h4><p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†ç‰©ç†åœ°å€ï¼Œé‚£ä¹ˆé€šè¿‡ç‰©ç†åœ°å€åˆæ€ä¹ˆåœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­å¯»æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•°æ®å‘¢ï¼Ÿ<br>å…ˆæ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ç‰©ç†åœ°å€åˆ†æˆé‚£å‡ ä¸ªéƒ¨åˆ†</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/8v37wVRaNFrnZWS.png" alt="20171106180519329"></p><p>å¯ä»¥çœ‹åˆ°ç‰©ç†åœ°å€è¢«åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šCO(å—åç§»)ï¼ŒCIï¼ˆç´¢å¼•ï¼‰ï¼ŒCTï¼ˆæ ‡ç­¾ï¼‰ä¸‰ä¸ªéƒ¨åˆ†<br>é‚£ä¹ˆç‰©ç†å­˜å‚¨å™¨åˆé•¿ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="/Users/maywzh/Downloads/v2-d0aff2a40985bcb402b9335e07e05eaf_r.jpg" alt="v2-d0aff2a40985bcb402b9335e07e05eaf_r"></p><p>ç‰©ç†åœ°å€å…ˆæ‰¾åˆ°CIç´¢å¼•ï¼Œæ‰¾åˆ°å¯¹åº”çš„seté›†åˆï¼Œç„¶ååˆ¤æ–­è¿™ä¸ªé›†åˆçš„valid bitæ˜¯å¦ç­‰äºä¸€å¹¶ä¸”tagæ˜¯å¦ä¸CTä¸€è‡´ã€‚å¦‚æœè¿™äº›æ¡ä»¶éƒ½ç¬¦åˆï¼Œåœ¨é€šè¿‡COåç§»æ‰¾åˆ°æƒ³è¦çš„æ•°æ®ã€‚</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„ç¿»è¯‘å®ä¾‹æ˜¯åŸºäºä¸€çº§é¡µè¡¨ä¹‹é—´çš„è½¬æ¢ï¼Œå…³äºè™šæ‹Ÿåœ°å€ä»¥åŠç‰©ç†åœ°å€çš„é•¿åº¦åŠä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/1HfOaQLxwrEyAhd.png" alt="20171106182322110"></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/Ou8KtNv6jRTIrCi.png" alt="20171106182336973"><br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å®é™…ç¿»è¯‘çš„è™šæ‹Ÿåœ°å€ã€‚<br>æˆ‘ä»¬ç¿»è¯‘çš„åœ°å€ä¸º:0x03d4</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/WtzSrwiD7NgKu8b.jpg" alt="å®ä¾‹1"></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/26/jGdLQOwtuEeP5Za.jpg" alt="fd59ed9f-db1b-3ee3-8f7e-2d6e4935645c"></p><p>æˆ‘ä»¬å¾—åˆ°äº†CO=0x0, CI=0x5, CT=0x0d<br>æˆ‘ä»¬å…ˆé€šè¿‡CIæ‰¾ç´¢å¼•ï¼Œç„¶åå†é€šè¿‡CTå¯¹ç…§ï¼Œå¾ˆé«˜å…´ï¼Œæˆ‘ä»¬å‘ç°æ ‡è®°ä½ç›¸åŒï¼Œéƒ½ä¸º0x0D,ä¸”æœ‰æ•ˆä½ä¸º1ï¼Œäºæ˜¯ä¹æˆ‘ä»¬å†é€šè¿‡CO=0çš„åç§»ï¼Œå–å‡ºäº†æ•°æ®0x36ã€‚<br>è¿™ä¸ªå°±æ˜¯ç¿»è¯‘çš„å…¨è¿‡ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºçš„ç¼–è¯‘ã€é“¾æ¥å’Œè£…å…¥</title>
      <link href="/2017/10/13/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E5%85%A5%20/"/>
      <url>/2017/10/13/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E5%85%A5%20/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œè¦ä½¿ç¨‹åºè¿è¡Œï¼Œå¿…é¡»å…ˆä¸ºä¹‹åˆ›å»ºè¿›ç¨‹ã€‚è€Œåˆ›å»ºè¿›ç¨‹çš„ç¬¬ä¸€ä»¶äº‹ï¼Œä¾¿æ˜¯å°†ç¨‹åºå’Œæ•°æ®è£…å…¥å†…å­˜ã€‚å¦‚ä½•å°†ä¸€ä¸ªç”¨æˆ·æºç¨‹åºå˜ä¸ºä¸€ä¸ªå¯åœ¨å†…å­˜ä¸­æ‰§è¡Œçš„ç¨‹åºï¼Œé€šå¸¸éƒ½è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p>ç¼–è¯‘ã€é“¾æ¥å’Œè£…å…¥ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/Ns5epoAd6GafEyX.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTEvMTM0OTkzNjcyMF80NzYzLmpwZw"></p><a id="more"></a><h2 id="ç¨‹åºä»ç¼–è¯‘åˆ°è¿è¡Œè¿‡ç¨‹"><a href="#ç¨‹åºä»ç¼–è¯‘åˆ°è¿è¡Œè¿‡ç¨‹" class="headerlink" title="ç¨‹åºä»ç¼–è¯‘åˆ°è¿è¡Œè¿‡ç¨‹"></a>ç¨‹åºä»ç¼–è¯‘åˆ°è¿è¡Œè¿‡ç¨‹</h2><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>ç¼–è¯‘ï¼šæºç¨‹åº -&gt;ç›®æ ‡æ¨¡å—ï¼ˆObject modulesï¼‰â€”â€”â€”â€”Compiler</p><p>ç”±ç¼–è¯‘ç¨‹åº(Compiler)å°†ç”¨æˆ·æºä»£ç ç¼–è¯‘æˆcpuå¯æ‰§è¡Œçš„ç›®æ ‡ä»£ç ï¼Œäº§ç”Ÿäº†è‹¥å¹²ä¸ªç›®æ ‡æ¨¡å—(Object Module)ï¼ˆå³è‹¥å¹²ç¨‹åºæ®µï¼‰ã€‚å½¢æˆçš„ç›®æ ‡ä»£ç ï¼Œæ¯ä¸ªç›®æ ‡ä»£ç éƒ½æ˜¯ä»¥0ä¸ºåŸºå€é¡ºåºè¿›è¡Œç¼–å€ï¼ŒåŸæ¥ç”¨ç¬¦å·åè®¿é—®çš„å•å…ƒç”¨å…·ä½“çš„æ•°æ®â€”â€”å•å…ƒå·å–ä»£ã€‚è¿™æ ·ç”Ÿæˆçš„ç›®æ ‡ç¨‹åºå æ®ä¸€å®šçš„åœ°å€ç©ºé—´ï¼Œç§°ä¸ºä½œä¸šçš„é€»è¾‘åœ°å€ç©ºé—´ï¼Œç®€ç§°é€»è¾‘ç©ºé—´ã€‚</p><p>åœ¨é€»è¾‘ç©ºé—´ä¸­æ¯æ¡æŒ‡ä»¤çš„åœ°å€å’ŒæŒ‡ä»¤ä¸­è¦è®¿é—®çš„æ“ä½œæ•°åœ°å€ç»Ÿç§°ä¸º<strong>é€»è¾‘åœ°å€</strong> ã€‚å¾ˆç®€å•ï¼Œ<strong>é€»è¾‘åœ°å€</strong>å°±æ˜¯ä½ æºç¨‹åºé‡Œä½¿ç”¨çš„åœ°å€ï¼Œæˆ–è€…æºä»£ç ç»è¿‡ç¼–è¯‘ä»¥åç¼–è¯‘å™¨å°†ä¸€äº›æ ‡å·ï¼Œå˜é‡è½¬æ¢æˆçš„åœ°å€ã€‚</p><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p>é“¾æ¥ï¼šä¸€ç»„ç›®æ ‡æ¨¡å— -&gt;è£…å…¥æ¨¡å— ï¼ˆLoad Moduleï¼‰â€”â€”â€”â€”â€”Linker</p><p>ç”±é“¾æ¥ç¨‹åº(Linker)å°†ç¼–è¯‘åå½¢æˆçš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼ˆç¨‹åºæ®µï¼‰ï¼Œä»¥åŠå®ƒä»¬æ‰€éœ€è¦çš„åº“å‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è£…å…¥æ¨¡å—(Load Module)ï¼›</p><h3 id="è£…å…¥"><a href="#è£…å…¥" class="headerlink" title="è£…å…¥"></a>è£…å…¥</h3><p>è£…å…¥ï¼šè£…å…¥æ¨¡å— -&gt;å†…å­˜  â€”â€”â€”â€”Loader</p><p>ç”±è£…å…¥ç¨‹åº(Loader)å°†è£…å…¥æ¨¡å—è£…å…¥<strong>ç‰©ç†å†…å­˜</strong>ã€‚<strong>ç‰©ç†å†…å­˜</strong>æ˜¯çœŸå®å­˜åœ¨çš„æ’åœ¨ä¸»æ¿å†…å­˜æ§½ä¸Šçš„å†…å­˜æ¡çš„å®¹é‡çš„å¤§å°ã€‚</p><p><strong>ç‰©ç†å†…å­˜</strong>å†…å­˜æ˜¯ç”±è‹¥å¹²ä¸ªå­˜å‚¨å•å…ƒç»„æˆçš„ï¼Œæ¯ä¸ªå­˜å‚¨å•å…ƒæœ‰ä¸€ä¸ªç¼–å·ï¼Œè¿™ç§ç¼–å·å¯å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼Œç§°ä¸º<strong>å†…å­˜åœ°å€ï¼ˆæˆ–ç‰©ç†åœ°å€ï¼‰ã€‚</strong>æˆ‘ä»¬å¯ä»¥æŠŠå†…å­˜çœ‹æˆä¸€ä¸ªä»0å­—èŠ‚ä¸€ç›´åˆ°å†…å­˜æœ€å¤§å®¹é‡é€å­—èŠ‚ç¼–å·çš„å­˜å‚¨å•å…ƒæ•°ç»„ï¼Œå³æ¯ä¸ªå­˜å‚¨å•å…ƒä¸å†…å­˜åœ°å€çš„ç¼–å·ç›¸å¯¹åº”ã€‚</p><p>è£…å…¥æ¨¡å—è™½ç„¶å…·æœ‰ç»Ÿä¸€çš„åœ°å€ç©ºé—´ï¼Œä½†å®ƒä»æ˜¯ä»¥â€œ0â€ä½œä¸ºå‚è€ƒåœ°å€ï¼Œå³æ˜¯æµ®åŠ¨çš„ã€‚è¦æŠŠå®ƒè£…å…¥å†…å­˜æ‰§è¡Œï¼Œå°±è¦ç¡®å®šè£…å…¥å†…å­˜çš„<strong>å®é™…ç‰©ç†åœ°å€</strong>ï¼Œå¹¶ä¿®æ”¹ç¨‹åºä¸­ä¸ åœ°å€æœ‰å…³çš„ä»£ç ï¼Œè¿™ä¸€è¿‡ç¨‹å«<strong>åšåœ°å€é‡å®šä½</strong>ã€‚åœ°å€é‡å®šä½ä¸»è¦æ˜¯æŠŠé€»è¾‘åœ°å€è½¬æ¢æˆç‰©ç†å†…å­˜ç»å¯¹åœ°å€ï¼Œè¿™ä¸ªå·¥ä½œåˆç§°ä¸ºåœ°å€æ˜ å°„ã€‚</p><h2 id="ç¨‹åºçš„é“¾æ¥"><a href="#ç¨‹åºçš„é“¾æ¥" class="headerlink" title="ç¨‹åºçš„é“¾æ¥"></a>ç¨‹åºçš„é“¾æ¥</h2><p>æºç¨‹åºç»è¿‡ç¼–è¯‘åï¼Œå¯å¾—åˆ°ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œå†åˆ©ç”¨é“¾æ¥ç¨‹åºå°†è¿™ç»„ç›®æ ‡æ¨¡å—é“¾æ¥ï¼Œå½¢æˆè£…å…¥æ¨¡å—ã€‚æ ¹æ®é“¾æ¥æ—¶é—´çš„ä¸åŒï¼Œå¯æŠŠé“¾æ¥åˆ†æˆå¦‚ä¸‹ä¸‰ç§ï¼š</p><ol><li>é™æ€é“¾æ¥ã€‚åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œå…ˆå°†å„ç›®æ ‡æ¨¡å—åŠå®ƒä»¬æ‰€éœ€çš„åº“å‡½æ•°ï¼Œé“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„è£…é…æ¨¡å—ï¼Œä»¥åä¸å†æ‹†å¼€ã€‚æˆ‘ä»¬æŠŠè¿™ç§äº‹å…ˆè¿›è¡Œé“¾æ¥çš„æ–¹å¼ç§°ä¸ºé™æ€é“¾æ¥æ–¹å¼ã€‚</li><li>è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ã€‚è¿™æ˜¯æŒ‡å°†ç”¨æˆ·æºç¨‹åºç¼–è¯‘åæ‰€å¾—åˆ°çš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œåœ¨è£…å…¥å†…å­˜æ—¶ï¼Œé‡‡ç”¨è¾¹è£…å…¥è¾¹é“¾æ¥çš„é“¾æ¥æ–¹å¼ã€‚</li><li>è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ã€‚è¿™æ˜¯æŒ‡å¯¹æŸäº›ç›®æ ‡æ¨¡å—çš„é“¾æ¥ï¼Œæ˜¯åœ¨ç¨‹åºæ‰§è¡Œä¸­éœ€è¦è¯¥(ç›®æ ‡)æ¨¡å—æ—¶ï¼Œæ‰å¯¹å®ƒè¿›è¡Œçš„é“¾æ¥ã€‚</li></ol><h3 id="é™æ€é“¾æ¥æ–¹å¼-Static-Linking"><a href="#é™æ€é“¾æ¥æ–¹å¼-Static-Linking" class="headerlink" title="é™æ€é“¾æ¥æ–¹å¼ Static Linking"></a>é™æ€é“¾æ¥æ–¹å¼ Static Linking</h3><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜åœ¨å®ç°é™æ€é“¾æ¥æ—¶åº”è§£å†³çš„ä¸€äº›é—®é¢˜ã€‚ä¸‹å›¾ä¸­ï¼Œç»è¿‡ç¼–è¯‘åæ‰€å¾—åˆ°çš„ä¸‰ä¸ªç›®æ ‡æ¨¡å—Aã€Bã€Cï¼Œå®ƒä»¬çš„é•¿åº¦åˆ†åˆ«ä¸º Lã€Må’ŒNã€‚åœ¨æ¨¡å—Aä¸­æœ‰ä¸€æ¡è¯­å¥CALL Bï¼Œç”¨äºè°ƒç”¨æ¨¡å—Bã€‚åœ¨æ¨¡å—Bä¸­æœ‰ä¸€æ¡è¯­å¥CALL Cï¼Œç”¨äºè°ƒç”¨æ¨¡å—Cã€‚Bå’ŒCéƒ½å±äºå¤–éƒ¨è°ƒç”¨ç¬¦å·ï¼Œåœ¨å°†è¿™å‡ ä¸ªç›®æ ‡æ¨¡å—è£…é…æˆä¸€ä¸ªè£…å…¥æ¨¡å—æ—¶ï¼Œé¡»è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å¯¹ç›¸å¯¹åœ°å€è¿›è¡Œä¿®æ”¹ã€‚åœ¨ç”±ç¼–è¯‘ç¨‹åºæ‰€äº§ç”Ÿçš„æ‰€æœ‰ç›®æ ‡æ¨¡å—ä¸­ï¼Œä½¿ç”¨çš„éƒ½æ˜¯ç›¸å¯¹åœ°å€ï¼Œå…¶èµ·å§‹åœ°å€éƒ½ä¸º 0ï¼Œæ¯ä¸ªæ¨¡å—ä¸­çš„åœ°å€éƒ½æ˜¯ç›¸å¯¹äºèµ·å§‹åœ°å€è®¡ç®—çš„ã€‚åœ¨é“¾æ¥æˆä¸€ä¸ªè£…å…¥æ¨¡å—åï¼ŒåŸæ¨¡å—Bå’Œ Cåœ¨è£…å…¥æ¨¡å—çš„èµ·å§‹åœ°å€ä¸å†æ˜¯ 0ï¼Œè€Œåˆ†åˆ«æ˜¯ Lå’Œ L+Mï¼Œæ‰€ä»¥æ­¤æ—¶é¡»ä¿®æ”¹æ¨¡å—Bå’ŒCä¸­çš„ç›¸å¯¹åœ°å€ï¼Œå³æŠŠåŸBä¸­çš„æ‰€æœ‰ç›¸å¯¹åœ°å€éƒ½åŠ ä¸Š Lï¼ŒæŠŠåŸ Cä¸­çš„æ‰€æœ‰ç›¸å¯¹åœ°å€éƒ½åŠ ä¸ŠL+Mã€‚ </li><li>å˜æ¢å¤–éƒ¨è°ƒç”¨ç¬¦å·ã€‚å°†æ¯ä¸ªæ¨¡å—ä¸­æ‰€ç”¨çš„å¤–éƒ¨è°ƒç”¨ç¬¦å·ä¹Ÿéƒ½å˜æ¢ä¸ºç›¸å¯¹åœ°å€ï¼Œå¦‚æŠŠB çš„èµ·å§‹åœ°å€å˜æ¢ä¸º Lï¼ŒæŠŠ C çš„èµ·å§‹åœ°å€å˜æ¢ä¸º L+Mï¼Œå¦‚å›¾ 4-4(b)æ‰€ç¤ºã€‚è¿™ç§å…ˆè¿›è¡Œé“¾æ¥æ‰€å½¢æˆçš„ä¸€ä¸ªå®Œæ•´çš„è£…å…¥æ¨¡å—ï¼Œåˆç§°ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚é€šå¸¸éƒ½ä¸å†æ‹†å¼€å®ƒï¼Œè¦è¿è¡Œæ—¶å¯ç›´æ¥å°†å®ƒè£…å…¥å†…å­˜ã€‚è¿™ç§äº‹å…ˆè¿›è¡Œé“¾æ¥ï¼Œä»¥åä¸å†æ‹†å¼€çš„é“¾æ¥æ–¹å¼ï¼Œç§°ä¸ºé™æ€é“¾æ¥æ–¹å¼ã€‚</li></ol><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/cN7RFWCGxUlyv1P.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTEvMTM0OTkzODE4Ml83MzIxLmpwZw"></p><h3 id="è£…å…¥æ—¶åŠ¨æ€é“¾æ¥-Load-time-Dynamic-Linking"><a href="#è£…å…¥æ—¶åŠ¨æ€é“¾æ¥-Load-time-Dynamic-Linking" class="headerlink" title="è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ Load-time Dynamic Linking"></a>è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ Load-time Dynamic Linking</h3><p>ç”¨æˆ·æºç¨‹åºç»ç¼–è¯‘åæ‰€å¾—çš„ç›®æ ‡æ¨¡å—ï¼Œæ˜¯åœ¨è£…å…¥å†…å­˜æ—¶è¾¹è£…å…¥è¾¹é“¾æ¥çš„ï¼Œå³åœ¨è£…å…¥ä¸€ä¸ªç›®æ ‡æ¨¡å—æ—¶ï¼Œè‹¥å‘ç”Ÿä¸€ä¸ªå¤–éƒ¨æ¨¡å—è°ƒç”¨äº‹ä»¶ï¼Œå°†å¼•èµ·è£…å…¥ç¨‹åºå»æ‰¾å‡ºç›¸åº”çš„å¤–éƒ¨ç›®æ ‡æ¨¡å—ï¼Œå¹¶å°†å®ƒè£…å…¥å†…å­˜ï¼Œè¿˜è¦æŒ‰ç…§å›¾4-4æ‰€ç¤ºçš„æ–¹å¼æ¥ä¿®æ”¹ç›®æ ‡æ¨¡å—ä¸­çš„ç›¸å¯¹åœ°å€ã€‚è£…å…¥æ—¶åŠ¨æ€é“¾æ¥æ–¹å¼æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>ä¾¿äºä¿®æ”¹å’Œæ›´æ–°ã€‚å¯¹äºç»é™æ€é“¾æ¥è£…é…åœ¨ä¸€èµ·çš„è£…å…¥æ¨¡å—ï¼Œå¦‚æœè¦ä¿®æ”¹æˆ–æ›´æ–°å…¶ä¸­çš„æŸä¸ªç›®æ ‡æ¨¡å—ï¼Œåˆ™è¦æ±‚é‡æ–°æ‰“å¼€è£…å…¥æ¨¡å—ã€‚è¿™ä¸ä»…æ˜¯ä½æ•ˆçš„ï¼Œè€Œä¸”æœ‰æ—¶æ˜¯ä¸å¯èƒ½çš„ã€‚è‹¥é‡‡ç”¨åŠ¨æ€é“¾æ¥æ–¹å¼ï¼Œç”±äºå„ç›®æ ‡æ¨¡å—æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ‰€ä»¥è¦ä¿®æ”¹æˆ–æ›´æ–°å„ç›®æ ‡æ¨¡å—æ˜¯ä»¶éå¸¸å®¹æ˜“çš„äº‹ã€‚</li><li>ä¾¿äºå®ç°å¯¹ç›®æ ‡æ¨¡å—çš„å…±äº«ã€‚åœ¨é‡‡ç”¨é™æ€é“¾æ¥æ–¹å¼æ—¶ï¼Œæ¯ä¸ªåº”ç”¨æ¨¡å—éƒ½å¿…é¡»å«æœ‰å…¶ç›®æ ‡æ¨¡å—çš„æ‹·è´ï¼Œæ— æ³•å®ç°å¯¹ç›®æ ‡æ¨¡å—çš„å…±äº«ã€‚ä½†é‡‡ç”¨è£…å…¥æ—¶åŠ¨æ€é“¾æ¥æ–¹å¼ï¼ŒOSåˆ™å¾ˆå®¹æ˜“å°†ä¸€ä¸ªç›®æ ‡æ¨¡å—é“¾æ¥åˆ°å‡ ä¸ªåº”ç”¨æ¨¡å—ä¸Šï¼Œå®ç°å¤šä¸ªåº”ç”¨ç¨‹åºå¯¹è¯¥æ¨¡å—çš„å…±äº«ã€‚</li></ol><h3 id="è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥-Runtime-Dynamic-Linking"><a href="#è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥-Runtime-Dynamic-Linking" class="headerlink" title="è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ Runtime Dynamic Linking"></a>è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ Runtime Dynamic Linking</h3><p>åŠ¨æ€é“¾æ¥æ˜¯è™šæ‹Ÿå­˜å‚¨çš„åŸºç¡€ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œæ¯æ¬¡è¦è¿è¡Œçš„æ¨¡å—å¯èƒ½æ˜¯ä¸ç›¸åŒçš„ã€‚ä½†ç”±äºäº‹å…ˆæ— æ³•çŸ¥é“æœ¬æ¬¡è¦è¿è¡Œå“ªäº›æ¨¡å—ï¼Œæ•…åªèƒ½æ˜¯å°†æ‰€æœ‰å¯èƒ½è¦è¿è¡Œåˆ°çš„æ¨¡å—éƒ½å…¨éƒ¨è£…å…¥å†…å­˜ï¼Œå¹¶åœ¨è£…å…¥æ—¶å…¨éƒ¨é“¾æ¥åœ¨ä¸€èµ·ã€‚æ˜¾ç„¶è¿™æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºå¾€å¾€ä¼šæœ‰äº›ç›®æ ‡æ¨¡å—æ ¹æœ¬å°±ä¸è¿è¡Œã€‚æ¯”è¾ƒå…¸å‹çš„ä¾‹å­æ˜¯ä½œä¸ºé”™è¯¯å¤„ç†ç”¨çš„ç›®æ ‡æ¨¡å—ï¼Œå¦‚æœç¨‹åºåœ¨æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­éƒ½ä¸å‡ºç°é”™è¯¯ï¼Œåˆ™æ˜¾ç„¶å°±ä¸ä¼šç”¨åˆ°è¯¥æ¨¡å—ã€‚è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥è¿™ç§é“¾æ¥æ–¹å¼æ˜¯å°†å¯¹æŸäº›æ¨¡å—çš„é“¾æ¥æ¨è¿Ÿåˆ°ç¨‹åºæ‰§è¡Œæ—¶æ‰è¿›è¡Œé“¾æ¥ï¼Œäº¦å³ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“å‘ç°ä¸€ä¸ªè¢«è°ƒç”¨æ¨¡å—å°šæœªè£…å…¥å†…å­˜æ—¶ï¼Œç«‹å³ç”±OSå»æ‰¾åˆ°è¯¥æ¨¡å—å¹¶å°†ä¹‹è£…å…¥å†…å­˜ï¼ŒæŠŠå®ƒé“¾æ¥åˆ°è°ƒç”¨è€…æ¨¡å—ä¸Šã€‚å‡¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœªè¢«ç”¨åˆ°çš„ç›®æ ‡æ¨¡å—ï¼Œéƒ½ä¸ä¼šè¢«è°ƒå…¥å†…å­˜å’Œè¢«é“¾æ¥åˆ°è£…å…¥æ¨¡å—ä¸Šï¼Œè¿™æ ·ä¸ä»…å¯åŠ å¿«ç¨‹åºçš„è£…å…¥è¿‡ç¨‹ï¼Œè€Œä¸”å¯èŠ‚çœå¤§é‡çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="ç¨‹åºè£…å…¥"><a href="#ç¨‹åºè£…å…¥" class="headerlink" title="ç¨‹åºè£…å…¥"></a>ç¨‹åºè£…å…¥</h2><p>ä¸ºäº†é˜è¿°ä¸Šçš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸ªæ— éœ€è¿›è¡Œé“¾æ¥çš„å•ä¸ªç›®æ ‡æ¨¡å—çš„è£…å…¥è¿‡ç¨‹ã€‚è¯¥ç›®æ ‡æ¨¡å—ä¹Ÿå°±æ˜¯è£…å…¥æ¨¡å—ã€‚åœ¨å°†ä¸€ä¸ªè£…å…¥æ¨¡å—è£…å…¥å†…å­˜æ—¶ï¼Œå¯ä»¥æœ‰ç»å¯¹è£…å…¥æ–¹å¼ã€å¯é‡å®šä½è£…å…¥æ–¹å¼å’ŒåŠ¨æ€è¿è¡Œæ—¶è£…å…¥æ–¹å¼ï¼Œä¸‹é¢åˆ†åˆ«ç®€è¿°ä¹‹ã€‚</p><h3 id="ç»å¯¹è£…å…¥æ¨¡å¼-Absolute-Loading-Mode"><a href="#ç»å¯¹è£…å…¥æ¨¡å¼-Absolute-Loading-Mode" class="headerlink" title="ç»å¯¹è£…å…¥æ¨¡å¼ Absolute Loading Mode"></a>ç»å¯¹è£…å…¥æ¨¡å¼ Absolute Loading Mode</h3><p>åœ¨ç¼–è¯‘æ—¶ï¼Œå¦‚æœçŸ¥é“ç¨‹åºå°†é©»ç•™åœ¨å†…å­˜çš„ä»€ä¹ˆä½ç½®ï¼Œé‚£ä¹ˆï¼Œç¼–è¯‘ç¨‹åºå°†äº§ç”Ÿç»å¯¹åœ°å€çš„ç›®æ ‡ä»£ç ã€‚å³æŒ‰ç…§ç‰©ç†å†…å­˜çš„ä½ç½®èµ‹äºˆå®é™…çš„ç‰©ç†åœ°å€ã€‚ä¾‹å¦‚ï¼Œäº‹å…ˆå·²çŸ¥ç”¨æˆ·ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰é©»ç•™åœ¨ä»Rå¤„å¼€å§‹çš„ä½ç½®ï¼Œåˆ™ç¼–è¯‘ç¨‹åºæ‰€äº§ç”Ÿçš„ç›®æ ‡æ¨¡å—ï¼ˆå³è£…å…¥æ¨¡å—ï¼‰ä¾¿ä»Rå¤„å¼€å§‹å‘ä¸Šæ‰©å±•ã€‚ç»å¯¹è£…å…¥ç¨‹åºæŒ‰ç…§è£…å…¥æ¨¡å—ä¸­çš„åœ°å€ï¼Œå°†ç¨‹åºå’Œæ•°æ®è£…å…¥å†…å­˜ã€‚è£…å…¥æ¨¡å—è¢«è£…å…¥å†…å­˜åï¼Œç”±äºç¨‹åºä¸­çš„é€»è¾‘åœ°å€ä¸å®é™…å†…å­˜åœ°å€å®Œå…¨ç›¸åŒï¼Œæ•…ä¸é¡»å¯¹ç¨‹åºå’Œæ•°æ®çš„åœ°å€è¿›è¡Œä¿®æ”¹ã€‚ç¨‹åºä¸­æ‰€ä½¿ç”¨çš„ç»å¯¹åœ°å€ï¼Œæ—¢å¯åœ¨ç¼–è¯‘æˆ–æ±‡ç¼–æ—¶ç»™å‡ºï¼Œä¹Ÿå¯ç”±ç¨‹åºå‘˜ç›´æ¥èµ‹äºˆã€‚</p><p>è¿™ä¸ªæ–¹å¼çš„ä¼˜ç‚¹æ˜¯CPUæ‰§è¡Œç›®æ ‡ä»£ç å¿«ã€‚ç¼ºç‚¹æœ‰äºŒï¼šä¸€æ˜¯ç”±äºå†…å­˜å¤§å°é™åˆ¶ï¼Œèƒ½è£…å…¥å†…å­˜å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹æ•°å¤§å¤§å‡å°‘ï¼ŒäºŒæ˜¯ç¼–è¯‘ç¨‹åºå¿…é¡»çŸ¥é“å†…å­˜çš„å½“å‰ç©ºé—²åœ°å€éƒ¨åˆ†å’Œå…¶åœ°å€ï¼Œå¹¶ä¸”æŠŠè¿›ç¨‹çš„ä¸åŒç¨‹åºæ®µè¿ç»­åœ°å­˜æ”¾èµ·æ¥ï¼Œç¼–è¯‘éå¸¸å¤æ‚ã€‚</p><p>å› æ­¤ï¼Œé€šå¸¸æ˜¯å®å¯åœ¨ç¨‹åºä¸­é‡‡ç”¨ç¬¦å·åœ°å€ï¼Œç„¶ååœ¨ç¼–è¯‘æˆ–æ±‡ç¼–æ—¶ï¼Œå†å°†è¿™äº›ç¬¦å·åœ°å€è½¬æ¢ä¸ºç»å¯¹åœ°å€ã€‚</p><p>æŠŠè™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´å˜æ¢åˆ°å†…å­˜å”¯ä¸€çš„ä¸€ç»´ç‰©ç†çº¿æ€§ç©ºé—´ï¼Ÿæ¶‰åŠåˆ°ä¸¤ä¸ªé—®é¢˜ï¼šä¸€æ˜¯è™šæ‹Ÿç©ºé—´çš„åˆ’åˆ†é—®é¢˜ï¼ŒäºŒæ˜¯æŠŠè™šæ‹Ÿç©ºé—´ä¸­å·²ç»é“¾æ¥å’Œåˆ’åˆ†å¥½çš„å†…å®¹è£…å…¥å†…å­˜ï¼Œå¹¶å°†è™šæ‹Ÿç©ºé—´åœ°å€æ˜ å°„å†…å­˜åœ°å€çš„é—®é¢˜ã€‚å³åœ°å€æ˜ å°„ã€‚æ˜ å°„å°±æ˜¯å»ºç«‹è™šæ‹Ÿåœ°å€ä¸å†…å­˜åœ°å€çš„å…³ç³»ã€‚</p><h3 id="é™æ€åœ°å€é‡å®šä½-Relocation-Loading-Mode"><a href="#é™æ€åœ°å€é‡å®šä½-Relocation-Loading-Mode" class="headerlink" title="é™æ€åœ°å€é‡å®šä½ Relocation Loading Mode"></a>é™æ€åœ°å€é‡å®šä½ Relocation Loading Mode</h3><p>ç»å¯¹è£…å…¥æ–¹å¼åªèƒ½å°†ç›®æ ‡æ¨¡å—è£…å…¥åˆ°å†…å­˜ä¸­äº‹å…ˆæŒ‡å®šçš„ä½ç½®ã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œç¼–è¯‘ç¨‹åºä¸å¯èƒ½é¢„çŸ¥æ‰€ç¼–è¯‘çš„ç›®æ ‡æ¨¡å—åº”æ”¾åœ¨å†…å­˜çš„ä½•å¤„ï¼Œå› æ­¤ï¼Œ<strong>ç»å¯¹è£…å…¥æ–¹å¼åªé€‚ç”¨äºå•é“ç¨‹åºç¯å¢ƒ</strong>ã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œæ‰€å¾—åˆ°çš„ç›®æ ‡æ¨¡å—çš„èµ·å§‹åœ°å€é€šå¸¸æ˜¯ä» 0 å¼€å§‹çš„ï¼Œç¨‹åºä¸­çš„å…¶å®ƒåœ°å€ä¹Ÿéƒ½æ˜¯ç›¸å¯¹äºèµ·å§‹åœ°å€è®¡ç®—çš„ã€‚æ­¤æ—¶åº”é‡‡ç”¨å¯é‡å®šä½è£…å…¥æ–¹å¼ï¼Œæ ¹æ®å†…å­˜çš„å½“å‰æƒ…å†µï¼Œå°†è£…å…¥æ¨¡å—è£…å…¥åˆ°å†…å­˜çš„é€‚å½“ä½ç½®ã€‚ </p><p><strong>é™æ€åœ°å€é‡å®šä½</strong>ï¼šå³åœ¨ç¨‹åºè£…å…¥å¯¹ç›®æ ‡ä»£ç è£…å…¥å†…å­˜çš„è¿‡ç¨‹ä¸­å®Œæˆï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºå¼€å§‹è¿è¡Œå‰ï¼Œç¨‹åºä¸­<strong>æŒ‡ä»¤å’Œæ•°æ®</strong>çš„å„ä¸ªåœ°å€å‡å·²å®Œæˆé‡å®šä½ï¼Œå³å®Œæˆè™šæ‹Ÿåœ°å€åˆ°å†…å­˜åœ°å€æ˜ å°„ã€‚åœ°å€å˜æ¢é€šå¸¸æ˜¯åœ¨è£…å…¥æ—¶ä¸€æ¬¡å®Œæˆçš„ï¼Œä»¥åä¸å†æ”¹å˜ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ åœ¨é‡‡ç”¨å¯é‡å®šä½<strong>è£…å…¥ç¨‹åº</strong>å°†è£…å…¥æ¨¡å—è£…å…¥å†…å­˜åï¼Œ ä¼šä½¿è£…å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰é€»è¾‘åœ°å€ä¸å®é™…è£…å…¥å†…å­˜çš„ç‰©ç†åœ°å€ä¸åŒï¼Œä¸‹å›¾è¡¨ç¤ºäº†è¿™ä¸€æƒ…å†µã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/24/QPvraXxkWZ8fdq9.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTEvMTM0OTkzNjY4N185NDQxLmpwZw"></p><p>åœ¨ç”¨æˆ·ç¨‹åºçš„ 1000 å·å•å…ƒå¤„æœ‰ä¸€æ¡æŒ‡ä»¤LOAD 1ï¼Œ2500ï¼Œè¯¥æŒ‡ä»¤çš„åŠŸèƒ½æ˜¯å°† 2500 å•å…ƒä¸­çš„æ•´æ•° 365 å–è‡³å¯„å­˜å™¨ 1ã€‚ä½†è‹¥å°†è¯¥ç”¨æˆ·ç¨‹åºè£…å…¥åˆ°å†…å­˜çš„ 10000ï½15000å·å•å…ƒè€Œä¸è¿›è¡Œåœ°å€å˜æ¢ï¼Œ åˆ™åœ¨æ‰§è¡Œ11000å·å•å…ƒä¸­çš„æŒ‡ä»¤æ—¶ï¼Œå®ƒå°†ä»ä» 2500 å·å•å…ƒä¸­æŠŠæ•°æ®å–è‡³å¯„å­˜å™¨1è€Œå¯¼è‡´æ•°æ®é”™è¯¯ã€‚ç”±å›¾4-3 å¯è§ï¼Œæ­£ç¡®çš„æ–¹æ³•åº”è¯¥æ˜¯å°†å–æ•°æŒ‡ä»¤ä¸­çš„åœ°å€ 2500 ä¿®æ”¹æˆ 12500ï¼Œå³æŠŠæŒ‡ä»¤ä¸­çš„ç›¸å¯¹åœ°å€ 2500 ä¸æœ¬ç¨‹åºåœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ 10000 ç›¸åŠ ï¼Œæ‰å¾—åˆ°æ­£ç¡®çš„ç‰©ç†åœ°å€12500ã€‚é™¤äº†æ•°æ®åœ°å€åº”ä¿®æ”¹å¤–ï¼ŒæŒ‡ä»¤åœ°å€ä¹Ÿé¡»åšåŒæ ·çš„ä¿®æ”¹ï¼Œå³å°†æŒ‡ä»¤çš„ç›¸å¯¹åœ°å€ 1000 ä¸èµ·å§‹åœ°å€ 10000 ç›¸åŠ ï¼Œå¾—åˆ°ç»å¯¹åœ°å€ 11000ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong>æ— éœ€ç¡¬ä»¶æ”¯æŒ</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>ç¨‹åºé‡å®šä½ä¹‹åå°±ä¸èƒ½åœ¨å†…å­˜ä¸­æ¬åŠ¨äº†ï¼›</li><li>è¦æ±‚ç¨‹åºçš„å­˜å‚¨ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œä¸èƒ½æŠŠç¨‹åºæ”¾åœ¨è‹¥å¹²ä¸ªä¸è¿ç»­çš„åŒºåŸŸä¸­ã€‚</li></ol><h3 id="åŠ¨æ€è¿è¡Œæ—¶è£…å…¥æ–¹å¼-Dynamic-Run-time-Loading"><a href="#åŠ¨æ€è¿è¡Œæ—¶è£…å…¥æ–¹å¼-Dynamic-Run-time-Loading" class="headerlink" title="åŠ¨æ€è¿è¡Œæ—¶è£…å…¥æ–¹å¼ Dynamic Run-time Loading"></a>åŠ¨æ€è¿è¡Œæ—¶è£…å…¥æ–¹å¼ Dynamic Run-time Loading</h3><p>å¯é‡å®šä½è£…å…¥æ–¹å¼å¯å°†è£…å…¥æ¨¡å—è£…å…¥åˆ°å†…å­˜ä¸­ä»»ä½•å…è®¸çš„ä½ç½®ï¼Œæ•…å¯ç”¨äºå¤šé“ç¨‹åºç¯å¢ƒï¼›ä½†è¿™ç§æ–¹å¼å¹¶ä¸å…è®¸ç¨‹åºè¿è¡Œæ—¶åœ¨å†…å­˜ä¸­ç§»åŠ¨ä½ç½®ã€‚å› ä¸ºï¼Œç¨‹åºåœ¨å†…å­˜ä¸­çš„ç§»åŠ¨ï¼Œæ„å‘³ç€å®ƒçš„ç‰©ç†ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œ è¿™æ—¶å¿…é¡»å¯¹ç¨‹åºå’Œæ•°æ®çš„åœ°å€(æ˜¯ç»å¯¹åœ°å€)è¿›è¡Œä¿®æ”¹åæ–¹èƒ½è¿è¡Œã€‚ç„¶è€Œï¼Œå®é™…æƒ…å†µæ˜¯ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å®ƒåœ¨å†…å­˜ä¸­çš„ä½ç½®å¯èƒ½ç»å¸¸è¦æ”¹å˜ï¼Œæ­¤æ—¶å°±åº”é‡‡ç”¨åŠ¨æ€è¿è¡Œæ—¶è£…å…¥çš„æ–¹å¼ã€‚</p><p>   <strong>åŠ¨æ€åœ°å€é‡å®šä½ï¼š</strong>ä¸æ˜¯åœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰è€Œæ˜¯åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œåœ°å€å˜æ¢ã€‚æ›´ç¡®åˆ‡çš„è¯´ï¼Œæ˜¯æŠŠè¿™ç§åœ°å€è½¬æ¢æ¨è¿Ÿåˆ°ç¨‹åºçœŸæ­£è¦æ‰§è¡Œæ—¶æ‰è¿›è¡Œï¼Œå³åœ¨æ¯æ¬¡è®¿é—®å†…å­˜å•å…ƒå‰æ‰å°†è¦è®¿é—®çš„ç¨‹åºæˆ–æ•°æ®åœ°å€å˜æ¢æˆå†…å­˜åœ°å€ã€‚åŠ¨æ€é‡å®šä½å¯ä½¿è£…é…æ¨¡å—ä¸åŠ ä»»ä½•ä¿®æ”¹è€Œè£…å…¥å†…å­˜ã€‚ä¸ºä½¿åœ°å€è½¬æ¢ä¸å½±å“æŒ‡ä»¤çš„æ‰§è¡Œé€Ÿåº¦ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä¸€ä¸ªé‡å®šä½å¯„å­˜å™¨çš„æ”¯æŒï¼Œ</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li>ç›®æ ‡æ¨¡å—è£…å…¥å†…å­˜æ—¶æ— éœ€ä»»ä½•ä¿®æ”¹ï¼Œå› è€Œè£…å…¥ä¹‹åå†æ¬è¿ä¹Ÿä¸ä¼šå½±å“å…¶æ­£ç¡®æ‰§è¡Œï¼Œè¿™å¯¹äºå­˜å‚¨å™¨ç´§ç¼©ã€è§£å†³ç¢ç‰‡é—®é¢˜æ˜¯æå…¶æœ‰åˆ©çš„ï¼›</li><li>ä¸€ä¸ªç¨‹åºç”±è‹¥å¹²ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ç›®æ ‡æ¨¡å—ç»„æˆæ—¶ï¼Œæ¯ä¸ªç›®æ ‡æ¨¡å—å„è£…å…¥ä¸€ä¸ªå­˜å‚¨åŒºåŸŸï¼Œè¿™äº›å­˜å‚¨åŒºåŸŸå¯ä»¥ä¸æ˜¯é¡ºåºç›¸é‚»çš„ï¼Œåªè¦å„ä¸ªæ¨¡å—æœ‰è‡ªå·±å¯¹åº”çš„å®šä½å¯„å­˜å™¨å°±è¡Œã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong>éœ€è¦ç¡¬ä»¶æ”¯æŒã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç¨‹åºä»æºç¨‹åºåˆ°è£…å…¥å†…å­˜è¿è¡Œåˆ†ä¸ºä¸‰æ­¥ï¼š<strong>ç¼–è¯‘ã€é“¾æ¥å’Œè£…å…¥</strong>ã€‚</p><p>é“¾æ¥æœ‰<strong>é™æ€é“¾æ¥ã€è£…å…¥æ—¶åŠ¨æ€é“¾æ¥å’Œè¿è¡Œæ—¶åŠ¨æ€é“¾æ¥</strong>ä¸‰ç§æ–¹å¼ã€‚</p><p>è£…å…¥æœ‰<strong>ç»å¯¹è£…å…¥ã€é™æ€åœ°å€é‡å®šä½å’ŒåŠ¨æ€è¿è¡Œæ—¶è£…å…¥</strong>ä¸‰ç§æ–¹å¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†</title>
      <link href="/2017/10/12/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
      <url>/2017/10/12/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†åˆ†ä¸ºç‰©ç†å†…å­˜ç®¡ç†å’Œè™šæ‹Ÿå†…å­˜ç®¡ç†ã€‚</p><p>ç‰©ç†å†…å­˜ç®¡ç†åŒ…æ‹¬ç¨‹åºè£…å…¥ç­‰æ¦‚å¿µã€äº¤æ¢æŠ€æœ¯ã€è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼å’Œéè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ï¼ˆåˆ†é¡µã€åˆ†æ®µã€æ®µé¡µå¼ï¼‰ã€‚</p><p>è™šæ‹Ÿå†…å­˜ç®¡ç†åŒ…æ‹¬è™šæ‹Ÿå†…å­˜æ¦‚å¿µã€è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼ã€é¡µé¢ç½®æ¢ç®—æ³•ã€é¡µé¢åˆ†é…ç­–ç•¥ã€å·¥ä½œé›†å’ŒæŠ–åŠ¨ã€‚</p><p>æˆ‘ä»¬ä»¥è®¡ç®—æœºå­˜å‚¨ç»“æ„æ¥å¼€å§‹æ¢è®¨ã€‚<br><a id="more"></a><br><!-- ttoc --></p><h2 id="è®¡ç®—æœºå­˜å‚¨ä½“ç³»"><a href="#è®¡ç®—æœºå­˜å‚¨ä½“ç³»" class="headerlink" title="è®¡ç®—æœºå­˜å‚¨ä½“ç³»"></a>è®¡ç®—æœºå­˜å‚¨ä½“ç³»</h2><p>å†…å­˜æ˜¯è®¡ç®—æœºå¾ˆé‡è¦çš„ä¸€ä¸ªèµ„æºï¼Œå› ä¸ºç¨‹åºåªæœ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­æ‰å¯ä»¥è¿è¡Œï¼›æ­¤å¤–ï¼ŒCPUæ‰€éœ€è¦çš„æŒ‡ä»¤ä¸æ•°æ®ä¹Ÿéƒ½æ˜¯æ¥è‡ªå†…å­˜çš„ã€‚å¯ä»¥è¯´ï¼Œå†…å­˜æ˜¯å½±å“è®¡ç®—æœºæ€§èƒ½çš„ä¸€ä¸ªå¾ˆé‡è¦çš„å› ç´ ã€‚</p><h3 id="åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»"><a href="#åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»" class="headerlink" title="åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»"></a>åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»</h3><p>åœ¨ä»‹ç»å†…å­˜ç®¡ç†çš„ç»†èŠ‚å‰ï¼Œå…ˆè¦äº†è§£ä¸€ä¸‹åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»ï¼š</p><p>å¤§éƒ¨åˆ†çš„è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ï¼Œå³å°‘é‡çš„éå¸¸å¿«é€Ÿã€æ˜‚è´µã€æ˜“å˜çš„é«˜é€Ÿç¼“å­˜(cache)ï¼›è‹¥å¹²å…†å­—èŠ‚çš„ä¸­ç­‰é€Ÿåº¦ã€ä¸­ç­‰ä»·æ ¼ã€æ˜“å˜çš„ä¸»å­˜å‚¨å™¨(RAM)ï¼›æ•°ç™¾å…†æˆ–æ•°åƒå…†çš„ä½é€Ÿã€å»‰ä»·ã€ä¸æ˜“å˜çš„ç£ç›˜ã€‚è¿™äº›èµ„æºçš„åˆç†ä½¿ç”¨ä¸å¦ç›´æ¥å…³ç³»ç€ç³»ç»Ÿçš„æ•ˆç‡ã€‚</p><p>CPUç¼“å­˜ï¼ˆCache Memoryï¼‰ï¼šæ˜¯ä½äºCPUä¸å†…å­˜ä¹‹é—´çš„ä¸´æ—¶å­˜å‚¨å™¨ï¼Œå®ƒçš„å®¹é‡æ¯”å†…å­˜å°çš„å¤šä½†æ˜¯äº¤æ¢é€Ÿåº¦å´æ¯”å†…å­˜è¦å¿«å¾—å¤šã€‚ç¼“å­˜çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³CPUè¿ç®—é€Ÿåº¦ä¸å†…å­˜ è¯»å†™é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ï¼Œå› ä¸ºCPUè¿ç®—é€Ÿåº¦è¦æ¯”å†…å­˜è¯»å†™é€Ÿåº¦å¿«å¾ˆå¤šï¼Œè¿™æ ·ä¼šä½¿CPUèŠ±è´¹å¾ˆé•¿æ—¶é—´ç­‰å¾…æ•°æ®åˆ°æ¥æˆ–æŠŠæ•°æ®å†™å…¥å†…å­˜ã€‚</p><p>è®¡ç®—æœºæ˜¯ä¸€ç§æ•°æ®å¤„ç†è®¾å¤‡ï¼Œå®ƒç”±CPUå’Œå†…å­˜ä»¥åŠå¤–éƒ¨è®¾å¤‡ç»„æˆã€‚CPUè´Ÿè´£æ•°æ®å¤„ç†ï¼Œå†…å­˜è´Ÿè´£å­˜å‚¨ï¼Œå¤–éƒ¨è®¾å¤‡è´Ÿè´£æ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡æ€»çº¿è¿æ¥åœ¨ä¸€èµ·ã€‚CPUå†…éƒ¨ä¸»è¦ç”±æ§åˆ¶å™¨ã€è¿ç®—å™¨å’Œå¯„å­˜å™¨ç»„æˆã€‚æ§åˆ¶å™¨è´Ÿè´£æŒ‡ä»¤çš„è¯»å–å’Œè°ƒåº¦ï¼Œè¿ç®—å™¨è´Ÿè´£æŒ‡ä»¤çš„è¿ç®—æ‰§è¡Œï¼Œå¯„å­˜å™¨è´Ÿè´£æ•°æ®çš„å­˜å‚¨ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡CPUå†…çš„æ€»çº¿è¿æ¥åœ¨ä¸€èµ·ã€‚æ¯ä¸ªå¤–éƒ¨è®¾å¤‡(ä¾‹å¦‚ï¼šæ˜¾ç¤ºå™¨ã€ç¡¬ç›˜ã€é”®ç›˜ã€é¼ æ ‡ã€ç½‘å¡ç­‰ç­‰)åˆ™æ˜¯ç”±å¤–è®¾æ§åˆ¶å™¨ã€I/Oç«¯å£ã€å’Œè¾“å…¥è¾“å‡ºç¡¬ä»¶ç»„æˆã€‚å¤–è®¾æ§åˆ¶å™¨è´Ÿè´£è®¾å¤‡çš„æ§åˆ¶å’Œæ“ä½œï¼ŒI/Oç«¯å£è´Ÿè´£æ•°æ®çš„ä¸´æ—¶å­˜å‚¨ï¼Œè¾“å…¥è¾“å‡ºç¡¬ä»¶åˆ™è´Ÿè´£å…·ä½“çš„è¾“å…¥è¾“å‡ºï¼Œå®ƒä»¬é—´ä¹Ÿé€šè¿‡å¤–éƒ¨è®¾å¤‡å†…çš„æ€»çº¿è¿æ¥åœ¨ä¸€èµ·ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/4hBHAztiTFZW9y1.png" alt="20191014095110829"></p><p>ä¸Šé¢è®¡ç®—æœºç³»ç»Ÿç»“æ„å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºç¡¬ä»¶ç³»ç»Ÿçš„è¿™ç§ç»„ä»¶åŒ–çš„è®¾è®¡æ€è·¯æ€»æ˜¯è´¯å½»åˆ°å„ä¸ªç¯èŠ‚ã€‚</p><p><strong>åœ¨å†¯è¯ºä¼Šæ›¼è®¾è®¡ä½“ç³»ä¸­ï¼šæ€»æ˜¯æœ‰ä¸€éƒ¨åˆ†è´Ÿè´£æ§åˆ¶ã€ä¸€éƒ¨åˆ†è´Ÿè´£æ‰§è¡Œã€ä¸€éƒ¨åˆ†åˆ™è´Ÿè´£å­˜å‚¨ï¼Œå®ƒä¹‹é—´è¿›è¡Œäº¤äº’ä»¥åŠæ¥å£é€šä¿¡åˆ™æ€»æ˜¯é€šè¿‡æ€»çº¿æ¥å®Œæˆ</strong>ã€‚è¿™ç§è®¾è®¡æ€è·¯ä¸€æ ·çš„å¯ä»¥åº”ç”¨åœ¨æˆ‘ä»¬çš„è½¯ä»¶è®¾è®¡ä½“ç³»é‡Œé¢ï¼šç»„ä»¶å’Œç»„ä»¶ä¹‹é—´é€šä¿¡é€šè¿‡äº‹ä»¶çš„æ–¹å¼æ¥è¿›è¡Œè§£è€¦å¤„ç†ï¼Œè€Œä¸€ä¸ªç»„ä»¶å†…éƒ¨åŒæ ·ä¹Ÿéœ€è¦æ˜ç¡®å¥½å„ä¸ªéƒ¨åˆ†çš„èŒè´£(ä¸€éƒ¨åˆ†è´Ÿè´£è°ƒåº¦æ§åˆ¶ã€ä¸€éƒ¨åˆ†è´Ÿè´£æ‰§è¡Œå®ç°ã€ä¸€éƒ¨åˆ†è´Ÿè´£æ•°æ®å­˜å‚¨)ã€‚</p><h3 id="è®¡ç®—å­˜å‚¨çš„å±‚æ¬¡ç»“æ„"><a href="#è®¡ç®—å­˜å‚¨çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="è®¡ç®—å­˜å‚¨çš„å±‚æ¬¡ç»“æ„"></a>è®¡ç®—å­˜å‚¨çš„å±‚æ¬¡ç»“æ„</h3><p>å½“å‰æŠ€æœ¯æ²¡æœ‰èƒ½å¤Ÿæä¾›è¿™æ ·çš„å­˜å‚¨å™¨ï¼Œå› æ­¤å¤§éƒ¨åˆ†çš„è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„:</p><p>é«˜é€Ÿç¼“å­˜(cache): å°‘é‡çš„éå¸¸å¿«é€Ÿã€æ˜‚è´µã€æ˜“å˜çš„é«˜é€Ÿç¼“å­˜(cache)ï¼›</p><p>ä¸»å­˜å‚¨å™¨(RAM): è‹¥å¹²å…†å­—èŠ‚çš„ä¸­ç­‰é€Ÿåº¦ã€ä¸­ç­‰ä»·æ ¼ã€æ˜“å˜çš„ä¸»å­˜å‚¨å™¨(RAM)ï¼›</p><p>ç£ç›˜: æ•°ç™¾å…†æˆ–æ•°åƒå…†çš„ä½é€Ÿã€å»‰ä»·ã€ä¸æ˜“å˜çš„ç£ç›˜ã€‚</p><p>è¿™äº›èµ„æºçš„åˆç†ä½¿ç”¨ä¸å¦ç›´æ¥å…³ç³»ç€ç³»ç»Ÿçš„æ•ˆç‡ã€‚</p><p> <img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/TkhiHs5lWJj6Kg9.png" alt="20200616002500431"></p><h2 id="å†…å­˜ä½¿ç”¨æ¼”åŒ–"><a href="#å†…å­˜ä½¿ç”¨æ¼”åŒ–" class="headerlink" title="å†…å­˜ä½¿ç”¨æ¼”åŒ–"></a>å†…å­˜ä½¿ç”¨æ¼”åŒ–</h2><h3 id="æ²¡æœ‰å†…å­˜æŠ½è±¡"><a href="#æ²¡æœ‰å†…å­˜æŠ½è±¡" class="headerlink" title="æ²¡æœ‰å†…å­˜æŠ½è±¡"></a>æ²¡æœ‰å†…å­˜æŠ½è±¡</h3><p>åœ¨æ—©äº›çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå¹¶æ²¡æœ‰å¼•å…¥å†…å­˜æŠ½è±¡çš„æ¦‚å¿µã€‚<strong>ç¨‹åºç›´æ¥è®¿é—®å’Œæ“ä½œçš„éƒ½æ˜¯ç‰©ç†å†…å­˜</strong>ï¼Œå†…å­˜çš„ç®¡ç†ä¹Ÿéå¸¸ç®€å•ï¼Œé™¤å»æ“ä½œç³»ç»Ÿæ‰€ç”¨çš„å†…å­˜ä¹‹å¤–ï¼Œå…¨éƒ¨ç»™ç”¨æˆ·ç¨‹åºä½¿ç”¨ï¼Œæƒ³æ€ä¹ˆæŠ˜è…¾éƒ½è¡Œï¼Œåªè¦åˆ«è¶…å‡ºæœ€å¤§çš„å®¹é‡ã€‚æ¯”å¦‚å½“æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤æ—¶ï¼š<code>mov reg1,1000</code></p><p><strong>1ã€æ— å†…å­˜æŠ½è±¡å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p><p>è¿™æ¡æŒ‡ä»¤ä¼šæ¯«æ— æƒ³è±¡åŠ›çš„å°†ç‰©ç†åœ°å€1000ä¸­çš„å†…å®¹èµ‹å€¼ç»™å¯„å­˜å™¨ã€‚ä¸éš¾æƒ³è±¡ï¼Œè¿™ç§å†…å­˜æ“ä½œæ–¹å¼ä½¿å¾—æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨å¤šè¿›ç¨‹å˜å¾—å®Œå…¨ä¸å¯èƒ½ï¼Œæ¯”å¦‚MS-DOSï¼Œä½ å¿…é¡»æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤åæ‰èƒ½æ¥ç€æ‰§è¡Œä¸‹ä¸€æ¡ã€‚å¦‚æœæ˜¯å¤šè¿›ç¨‹çš„è¯ï¼Œç”±äºç›´æ¥æ“ä½œç‰©ç†å†…å­˜åœ°å€ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ç»™å†…å­˜åœ°å€1000èµ‹å€¼åï¼Œå¦ä¸€ä¸ªè¿›ç¨‹ä¹ŸåŒæ ·ç»™å†…å­˜åœ°å€èµ‹å€¼ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè¿›ç¨‹å¯¹å†…å­˜çš„èµ‹å€¼ä¼šè¦†ç›–ç¬¬ä¸€ä¸ªè¿›ç¨‹æ‰€èµ‹çš„å€¼ï¼Œè¿™å›é€ æˆä¸¤æ¡è¿›ç¨‹åŒæ—¶å´©æºƒã€‚</p><p><strong>å¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</strong></p><ol><li>ç”¨æˆ·ç¨‹åºå¯ä»¥è®¿é—®ä»»æ„å†…å­˜ï¼Œå®¹æ˜“ç ´åæ“ä½œç³»ç»Ÿï¼Œé€ æˆå´©æºƒ</li><li>åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºç‰¹åˆ«å›°éš¾</li></ol><p>éšç€è®¡ç®—æœºæŠ€æœ¯å‘å±•ï¼Œè¦æ±‚æ“ä½œç³»ç»Ÿæ”¯æŒå¤šè¿›ç¨‹çš„éœ€æ±‚ï¼Œæ‰€è°“å¤šè¿›ç¨‹ï¼Œå¹¶ä¸éœ€è¦åŒæ—¶è¿è¡Œè¿™äº›è¿›ç¨‹ï¼Œåªè¦å®ƒä»¬éƒ½å¤„äº ready çŠ¶æ€ï¼Œæ“ä½œç³»ç»Ÿå¿«é€Ÿåœ°åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ï¼Œå°±èƒ½è¾¾åˆ°åŒæ—¶è¿è¡Œçš„å‡è±¡ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦å†…å­˜ï¼ŒContext Switch æ—¶ï¼Œä¹‹å‰å†…å­˜é‡Œçš„å†…å®¹æ€ä¹ˆåŠï¼Ÿç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯å…ˆ dump åˆ°ç£ç›˜ä¸Šï¼Œç„¶åå†ä»ç£ç›˜ä¸Š restore ä¹‹å‰ dump çš„å†…å®¹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œä½†æ•ˆæœå¹¶ä¸å¥½ï¼Œå¤ªæ…¢äº†ï¼</p><h3 id="å†…å­˜æŠ½è±¡ï¼šåœ°å€ç©ºé—´"><a href="#å†…å­˜æŠ½è±¡ï¼šåœ°å€ç©ºé—´" class="headerlink" title="å†…å­˜æŠ½è±¡ï¼šåœ°å€ç©ºé—´"></a>å†…å­˜æŠ½è±¡ï¼šåœ°å€ç©ºé—´</h3><p>é‚£æ€ä¹ˆæ‰èƒ½ä¸æ…¢å‘¢ï¼ŸæŠŠè¿›ç¨‹å¯¹åº”çš„å†…å­˜ä¾æ—§ç•™åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œéœ€è¦çš„æ—¶å€™å°±åˆ‡æ¢åˆ°ç‰¹å®šçš„åŒºåŸŸã€‚è¿™å°±æ¶‰åŠåˆ°äº†å†…å­˜çš„ä¿æŠ¤æœºåˆ¶ï¼Œæ¯•ç«Ÿè¿›ç¨‹ä¹‹é—´å¯ä»¥éšæ„è¯»å–ã€å†™å…¥å†…å®¹å°±ä¹±å¥—äº†ï¼Œéå¸¸ä¸å®‰å…¨ã€‚å› æ­¤æ“ä½œç³»ç»Ÿéœ€è¦å¯¹ç‰©ç†å†…å­˜åšä¸€å±‚æŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯ã€Œåœ°å€ç©ºé—´ã€(Address Space)ï¼Œä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åŒ…å«äº†è¯¥è¿›ç¨‹æ‰€æœ‰ç›¸å…³å†…å­˜ï¼Œæ¯”å¦‚ code / stack / heapã€‚ä¸€ä¸ª 16 KB çš„åœ°å€ç©ºé—´å¯èƒ½é•¿è¿™æ ·ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/CxqIod9BtTOuYKA.jpg" alt="aHR0cDovL3d3dy50ZWNodWcuY29tL3dvcmRwcmVzcy93cC1jb250ZW50L3VwbG9hZHMvMjAxOC8wOS8yLmpwZw"></p><p>å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œheap å’Œ stack å…±ç”¨ä¸­é—´ free çš„åŒºåŸŸï¼Œå½“ç„¶è¿™åªæ˜¯ OS å±‚é¢çš„æŠ½è±¡ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x;</span><br><span class="line">x = x + <span class="number">3</span>; <span class="comment">// this is the line of code we are interested in</span></span><br></pre></td></tr></table></figure><p>å˜æˆæ±‡ç¼–æŒ‡ä»¤åï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">128: movl 0x0(%ebx), %eax  ;load 0+ebx into eax</span><br><span class="line">132: addl $0x03, %eax ;add 3 to eax register</span><br><span class="line">135: movl %eax, 0x0(%ebx) ;store eax back to mem</span><br></pre></td></tr></table></figure><p>æœ€å‰é¢çš„æ˜¯ PC (Program Counter)ï¼Œç”¨æ¥è¡¨ç¤ºå½“å‰ code çš„ç´¢å¼•ï¼Œæ¯”å¦‚ CPU æ‰§è¡Œåˆ° 128 æ—¶ï¼Œè¿›è¡Œäº† Context Switchï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ï¼Œé‚£ä¹ˆåœ¨ Switch å›æ¥åï¼Œè¿˜å¯ä»¥æ¥ç€ä» 132 å¼€å§‹æ‰§è¡Œï¼ˆå½“ç„¶éœ€è¦å…ˆæŠŠ PC å­˜èµ·æ¥ï¼‰ã€‚ä¹‹åçš„å°±æ˜¯æ±‡ç¼–ä»£ç ï¼Œå‘Šè¯‰ CPU è¯¥å¦‚ä½•æ“ä½œã€‚</p><p>ä»è¿›ç¨‹çš„è§’åº¦çœ‹ï¼Œå†…å­˜å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/xZ4tQLTicmazWGf.png" alt="20191012183602799"></p><p><strong>åŸºå€å¯„å­˜å™¨ä¸ç•Œé™å¯„å­˜å™¨å¯ä»¥ç®€å•çš„åŠ¨æ€é‡å®šä½ï¼š</strong>æ¯ä¸ªå†…å­˜åœ°å€é€åˆ°å†…å­˜ä¹‹å‰ï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ ä¸ŠåŸºå€å¯„å­˜å™¨çš„å†…å®¹ã€‚</p><p>ä» 32KB å¤„ä½œä¸ºå¼€å§‹ï¼Œ48KB ä½œä¸ºç»“æŸã€‚é‚£ 32 / 48 å¯ä¸å¯ä»¥åŠ¨æ€è®¾ç½®å‘¢ï¼Œåªè¦åœ¨ CPU ä¸Šæ•´ä¸¤ä¸ªå¯„å­˜å™¨ï¼Œ<strong>åŸºå€å¯„å­˜å™¨</strong>base å’Œ <strong>ç•Œé™å¯„å­˜å™¨</strong>bounds å°±å¯ä»¥äº†ï¼Œbase æŒ‡æ˜ä»å“ªé‡Œå¼€å§‹ï¼Œbounds æŒ‡å®šå“ªé‡Œæ˜¯è¾¹ç•Œã€‚ å› æ­¤çœŸå®ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€ä¹‹é—´çš„å…³ç³»æ˜¯ï¼š</p><p>å› æ­¤çœŸå®ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€ä¹‹é—´çš„å…³ç³»æ˜¯ï¼š</p><blockquote><p>physical address = virtual address + base</p></blockquote><p>æœ‰æ—¶ï¼ŒCPU ä¸Šç”¨æ¥åšå†…å­˜åœ°å€ç¿»è¯‘çš„ä¹Ÿä¼šè¢«å«åšã€Œå†…å­˜ç®¡ç†å•å…ƒ MMUã€(Memory Management Unit)ï¼Œéšç€åŠŸèƒ½è¶Šæ¥è¶Šå¼ºå¤§ï¼ŒMMU ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚</p><p>base and bounds è¿™ç§åšæ³•æœ€å¤§çš„é—®é¢˜åœ¨äºç©ºé—´æµªè´¹ï¼ŒStack å’Œ Heap ä¸­é—´æœ‰ä¸€å— free spaceï¼Œå³ä½¿æ²¡æœ‰ç”¨ï¼Œä¹Ÿè¢«å ç€ï¼Œé‚£å¦‚ä½•æ‰èƒ½è§£æ”¾è¿™å—åŒºåŸŸå‘¢ï¼Œè¿›å…¥è™šæ‹Ÿå†…å­˜ã€‚</p><h3 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h3><p>è™šæ‹Ÿå†…å­˜æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿæ™®éä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚å‰é¢æ‰€è®²çš„<strong>æŠ½è±¡æ»¡è¶³äº†å¤šè¿›ç¨‹çš„è¦æ±‚ï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç°æœ‰å†…å­˜æ— æ³•æ»¡è¶³ä»…ä»…ä¸€ä¸ªå¤§è¿›ç¨‹çš„å†…å­˜è¦æ±‚</strong>ã€‚ç‰©ç†å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p><strong>è¦†ç›–overlaysï¼š</strong>åœ¨æ—©æœŸçš„æ“ä½œç³»ç»Ÿæ›¾ä½¿ç”¨è¦†ç›–æŠ€æœ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†ä¸€ä¸ªç¨‹åºåˆ†ä¸ºå¤šä¸ªå—ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯å…ˆå°†å—0åŠ å…¥å†…å­˜ï¼Œå—0æ‰§è¡Œå®Œåï¼Œå°†å—1åŠ å…¥å†…å­˜ã€‚ä¾æ¬¡å¾€å¤ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜æ˜¯éœ€è¦ç¨‹åºå‘˜å»ç¨‹åºè¿›è¡Œåˆ†å—ï¼Œè¿™æ˜¯ä¸€ä¸ªè´¹æ—¶è´¹åŠ›è®©äººç—›è‹¦ä¸å ªçš„è¿‡ç¨‹ã€‚åæ¥è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„ä¿®æ­£ç‰ˆå°±æ˜¯è™šæ‹Ÿå†…å­˜ã€‚</p><p><strong>äº¤æ¢swappingï¼š</strong>å¯ä»¥å°†æš‚æ—¶ä¸èƒ½æ‰§è¡Œçš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰é€åˆ°å¤–å­˜ä¸­ï¼Œä»è€Œè·å¾—ç©ºé—²å†…å­˜ç©ºé—´æ¥è£…å…¥æ–°ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ï¼Œæˆ–è¯»å…¥ä¿å­˜åœ¨å¤–å­˜ä¸­è€Œå¤„äºå°±ç»ªçŠ¶æ€çš„ç¨‹åºã€‚</p><p><strong>è™šæ‹Ÿå†…å­˜ï¼š</strong>è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ç”¨ç‹¬ç«‹çš„é€»è¾‘åœ°å€ç©ºé—´ï¼Œå†…å­˜è¢«åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„å¤šä¸ªå—,ç§°ä¸º<strong>é¡µ</strong>(Page).æ¯ä¸ªé¡µéƒ½æ˜¯ä¸€æ®µè¿ç»­çš„åœ°å€ã€‚å¯¹äºè¿›ç¨‹æ¥çœ‹,é€»è¾‘ä¸Šè²Œä¼¼æœ‰å¾ˆå¤šå†…å­˜ç©ºé—´ï¼Œå…¶ä¸­<strong>ä¸€éƒ¨åˆ†å¯¹åº”ç‰©ç†å†…å­˜ä¸Šçš„ä¸€å—(ç§°ä¸ºé¡µæ¡†ï¼Œé€šå¸¸é¡µå’Œé¡µæ¡†å¤§å°ç›¸ç­‰)</strong>ï¼Œè¿˜æœ‰ä¸€äº›æ²¡åŠ è½½åœ¨å†…å­˜ä¸­çš„å¯¹åº”åœ¨ç¡¬ç›˜ä¸Šã€‚</p><h2 id="ç‰©ç†å†…å­˜åˆ†é…æ–¹å¼"><a href="#ç‰©ç†å†…å­˜åˆ†é…æ–¹å¼" class="headerlink" title="ç‰©ç†å†…å­˜åˆ†é…æ–¹å¼"></a>ç‰©ç†å†…å­˜åˆ†é…æ–¹å¼</h2><p>ç‰©ç†å†…å­˜åˆ†é…åˆ†ä¸ºè¿ç»­å†…å­˜åˆ†é…ç®¡ç†å’Œéè¿ç»­å†…å­˜åˆ†é…ç®¡ç†ï¼Œå…¶ä¸­éè¿ç»­å†…å­˜åˆ†é…åˆ†ä¸ºé¡µå¼ã€æ®µå¼å’Œæ®µé¡µå¼ã€‚</p><h3 id="è¿ç»­å†…å­˜åˆ†é…ç®¡ç†"><a href="#è¿ç»­å†…å­˜åˆ†é…ç®¡ç†" class="headerlink" title="è¿ç»­å†…å­˜åˆ†é…ç®¡ç†"></a>è¿ç»­å†…å­˜åˆ†é…ç®¡ç†</h3><p>è¿ç»­åˆ†é…æ˜¯æŒ‡ä¸ºä¸€ä¸ªç”¨æˆ·ç¨‹åºåˆ†é…è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚è¿ç»­åˆ†é…æœ‰å•ä¸€è¿ç»­å­˜å‚¨ç®¡ç†å’Œåˆ†åŒºå¼å‚¨ç®¡ç†ä¸¤ç§æ–¹å¼ã€‚</p><h4 id="å•ä¸€è¿ç»­å­˜å‚¨ç®¡ç†"><a href="#å•ä¸€è¿ç»­å­˜å‚¨ç®¡ç†" class="headerlink" title="å•ä¸€è¿ç»­å­˜å‚¨ç®¡ç†"></a>å•ä¸€è¿ç»­å­˜å‚¨ç®¡ç†</h4><p>åœ¨è¿™ç§ç®¡ç†æ–¹å¼ä¸­ï¼Œå†…å­˜è¢«åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼šç³»ç»ŸåŒºå’Œç”¨æˆ·åŒºã€‚åº”ç”¨ç¨‹åºè£…å…¥åˆ°ç”¨æˆ·åŒºï¼Œå¯ä½¿ç”¨ç”¨æˆ·åŒºå…¨éƒ¨ç©ºé—´ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼Œæœ€ç®€å•ï¼Œé€‚ç”¨äºå•ç”¨æˆ·ã€å•ä»»åŠ¡çš„æ“ä½œç³»ç»Ÿã€‚CPï¼Må’Œ DOS 2ï¼0ä»¥ä¸‹å°±æ˜¯é‡‡ç”¨æ­¤ç§æ–¹å¼ã€‚è¿™ç§æ–¹å¼çš„æœ€å¤§ä¼˜ç‚¹å°±æ˜¯æ˜“äºç®¡ç†ã€‚ä½†ä¹Ÿå­˜åœ¨ç€ä¸€äº›é—®é¢˜å’Œä¸è¶³ä¹‹å¤„ï¼Œä¾‹å¦‚å¯¹è¦æ±‚å†…å­˜ç©ºé—´å°‘çš„ç¨‹åºï¼Œé€ æˆå†…å­˜æµªè´¹ï¼›ç¨‹åºå…¨éƒ¨è£…å…¥ï¼Œä½¿å¾—å¾ˆå°‘ä½¿ç”¨çš„ç¨‹åºéƒ¨åˆ†ä¹Ÿå ç”¨â€”å®šæ•°é‡çš„å†…å­˜ã€‚</p><h4 id="åˆ†åŒºå¼å­˜å‚¨ç®¡ç†"><a href="#åˆ†åŒºå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="åˆ†åŒºå¼å­˜å‚¨ç®¡ç†"></a>åˆ†åŒºå¼å­˜å‚¨ç®¡ç†</h4><p>ä¸ºäº†æ”¯æŒå¤šé“ç¨‹åºç³»ç»Ÿå’Œåˆ†æ—¶ç³»ç»Ÿï¼Œæ”¯æŒå¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå¼•å…¥äº†åˆ†åŒºå¼å­˜å‚¨ç®¡ç†ã€‚åˆ†åŒºå¼å­˜å‚¨ç®¡ç†æ˜¯æŠŠå†…å­˜åˆ†ä¸ºä¸€äº›å¤§å°ç›¸ç­‰æˆ–ä¸ç­‰çš„åˆ†åŒºï¼Œæ“ä½œç³»ç»Ÿå ç”¨å…¶ä¸­ä¸€ä¸ªåˆ†åŒºï¼Œå…¶ä½™çš„åˆ†åŒºç”±åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå ç”¨ä¸€ä¸ªæˆ–å‡ ä¸ªåˆ†åŒºã€‚åˆ†åŒºå¼å­˜å‚¨ç®¡ç†è™½ç„¶å¯ä»¥æ”¯æŒå¹¶å‘ï¼Œä½†éš¾ä»¥è¿›è¡Œå†…å­˜åˆ†åŒºçš„å…±äº«ã€‚</p><p>åˆ†åŒºå¼å­˜å‚¨ç®¡ç†å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„é—®é¢˜ï¼šå†…ç¢ç‰‡å’Œå¤–ç¢ç‰‡ã€‚å†…ç¢ç‰‡æ˜¯å ç”¨åˆ†åŒºå†…æœªè¢«åˆ©ç”¨çš„ç©ºé—´ï¼Œå¤–ç¢ç‰‡æ˜¯å ç”¨åˆ†åŒºä¹‹é—´éš¾ä»¥åˆ©ç”¨çš„ç©ºé—²åˆ†åŒº(é€šå¸¸æ˜¯å°ç©ºé—²åˆ†åŒº)ã€‚</p><p>ä¸ºå®ç°åˆ†åŒºå¼å­˜å‚¨ç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿåº”ç»´æŠ¤çš„æ•°æ®ç»“æ„ä¸ºåˆ†åŒºè¡¨æˆ–åˆ†åŒºé“¾è¡¨ã€‚è¡¨ä¸­å„è¡¨é¡¹ä¸€èˆ¬åŒ…æ‹¬æ¯ä¸ªåˆ†åŒºçš„èµ·å§‹åœ°å€ã€å¤§å°åŠçŠ¶æ€(æ˜¯å¦å·²åˆ†é…)ã€‚</p><p>åˆ†åŒºå¼å­˜å‚¨ç®¡ç†å¸¸é‡‡ç”¨çš„ä¸€é¡¹æŠ€æœ¯å°±æ˜¯<strong>å†…å­˜ç´§ç¼©(compaction)ã€‚</strong></p><h5 id="å›ºå®šåˆ†åŒº"><a href="#å›ºå®šåˆ†åŒº" class="headerlink" title="å›ºå®šåˆ†åŒº"></a>å›ºå®šåˆ†åŒº</h5><p>å›ºå®šå¼åˆ†åŒºçš„ç‰¹ç‚¹æ˜¯æŠŠå†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„è¿ç»­åˆ†åŒºã€‚åˆ†åŒºå¤§å°å¯ä»¥ç›¸ç­‰ï¼šè¿™ç§ä½œæ³•åªé€‚åˆäºå¤šä¸ªç›¸åŒç¨‹åºçš„å¹¶å‘æ‰§è¡Œ(å¤„ç†å¤šä¸ªç±»å‹ç›¸åŒçš„å¯¹è±¡)ã€‚åˆ†åŒºå¤§å°ä¹Ÿå¯ä»¥ä¸ç­‰ï¼šæœ‰å¤šä¸ªå°åˆ†åŒºã€é€‚é‡çš„ä¸­ç­‰åˆ†åŒºä»¥åŠå°‘é‡çš„å¤§åˆ†åŒºã€‚æ ¹æ®ç¨‹åºçš„å¤§å°ï¼Œåˆ†é…å½“å‰ç©ºé—²çš„ã€é€‚å½“å¤§å°çš„åˆ†åŒºã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šæ˜“äºå®ç°ï¼Œå¼€é”€å°ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šå†…ç¢ç‰‡é€ æˆæµªè´¹ï¼›åˆ†åŒºæ€»æ•°å›ºå®šï¼Œé™åˆ¶äº†å¹¶å‘æ‰§è¡Œçš„ç¨‹åºæ•°ç›®</p><h5 id="åŠ¨æ€åˆ†åŒº"><a href="#åŠ¨æ€åˆ†åŒº" class="headerlink" title="åŠ¨æ€åˆ†åŒº"></a>åŠ¨æ€åˆ†åŒº</h5><p>åŠ¨æ€åˆ†åŒºçš„ç‰¹ç‚¹æ˜¯åŠ¨æ€åˆ›å»ºåˆ†åŒºï¼šåœ¨è£…å…¥ç¨‹åºæ—¶æŒ‰å…¶åˆå§‹è¦æ±‚åˆ†é…ï¼Œæˆ–åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›è¡Œåˆ†é…æˆ–æ”¹å˜åˆ†åŒºå¤§å°ã€‚ä¸å›ºå®šåˆ†åŒºç›¸æ¯”è¾ƒå…¶ä¼˜ç‚¹æ˜¯ï¼šæ²¡æœ‰å†…ç¢ç‰‡ã€‚ä½†å®ƒå´å¼•å…¥äº†å¦ä¸€ç§ç¢ç‰‡â€”â€”å¤–ç¢ç‰‡ã€‚åŠ¨æ€åˆ†åŒºçš„åˆ†åŒºåˆ†é…å°±æ˜¯å¯»æ‰¾æŸä¸ªç©ºé—²åˆ†åŒºï¼Œå…¶å¤§å°éœ€å¤§äºæˆ–ç­‰äºç¨‹åºçš„è¦æ±‚ã€‚è‹¥æ˜¯å¤§äºè¦æ±‚ï¼Œåˆ™å°†è¯¥åˆ†åŒºåˆ†å‰²æˆä¸¤ä¸ªåˆ†åŒºï¼Œå…¶ä¸­ä¸€ä¸ªåˆ†åŒºä¸ºè¦æ±‚çš„å¤§å°å¹¶æ ‡è®°ä¸ºâ€œå ç”¨â€ï¼Œè€Œå¦ä¸€ä¸ªåˆ†åŒºä¸ºä½™ä¸‹éƒ¨åˆ†å¹¶æ ‡è®°ä¸ºâ€œç©ºé—²â€ã€‚åˆ†åŒºåˆ†é…çš„å…ˆåæ¬¡åºé€šå¸¸æ˜¯ä»å†…å­˜ä½ç«¯åˆ°é«˜ç«¯ã€‚åŠ¨æ€åˆ†åŒºçš„åˆ†åŒºé‡Šæ”¾è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œå°†ç›¸é‚»çš„ç©ºé—²åˆ†åŒºåˆå¹¶æˆä¸€ä¸ªå¤§çš„ç©ºé—²åˆ†åŒºã€‚</p><p>ä¸‹é¢åˆ—å‡ºäº†å‡ ç§å¸¸ç”¨çš„åˆ†åŒºåˆ†é…ç®—æ³•ï¼š</p><p><strong>æœ€å…ˆé€‚é…æ³•(nrst-fit)ï¼š</strong>æŒ‰åˆ†åŒºåœ¨å†…å­˜çš„å…ˆåæ¬¡åºä»å¤´æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ç¬¬ä¸€ä¸ªåˆ†åŒºè¿›è¡Œåˆ†é…ã€‚è¯¥ç®—æ³•çš„åˆ†é…å’Œé‡Šæ”¾çš„æ—¶é—´æ€§èƒ½è¾ƒå¥½ï¼Œè¾ƒå¤§çš„ç©ºé—²åˆ†åŒºå¯ä»¥è¢«ä¿ç•™åœ¨å†…å­˜é«˜ç«¯ã€‚ä½†éšç€ä½ç«¯åˆ†åŒºä¸æ–­åˆ’åˆ†ä¼šäº§ç”Ÿè¾ƒå¤šå°åˆ†åŒºï¼Œæ¯æ¬¡åˆ†é…æ—¶æŸ¥æ‰¾æ—¶é—´å¼€é”€ä¾¿ä¼šå¢å¤§ã€‚</p><p><strong>ä¸‹æ¬¡é€‚é…æ³•(å¾ªç¯é¦–æ¬¡é€‚åº”ç®—æ³• next fit)ï¼š</strong>æŒ‰åˆ†åŒºåœ¨å†…å­˜çš„å…ˆåæ¬¡åºï¼Œä»ä¸Šæ¬¡åˆ†é…çš„åˆ†åŒºèµ·æŸ¥æ‰¾(åˆ°æœ€å{åŒºæ—¶å†ä»å¤´å¼€å§‹}ï¼Œæ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ç¬¬ä¸€ä¸ªåˆ†åŒºè¿›è¡Œåˆ†é…ã€‚è¯¥ç®—æ³•çš„åˆ†é…å’Œé‡Šæ”¾çš„æ—¶é—´æ€§èƒ½è¾ƒå¥½ï¼Œä½¿ç©ºé—²åˆ†åŒºåˆ†å¸ƒå¾—æ›´å‡åŒ€ï¼Œä½†è¾ƒå¤§ç©ºé—²åˆ†åŒºä¸æ˜“ä¿ç•™ã€‚</p><p><strong>æœ€ä½³é€‚é…æ³•(best-fit)ï¼š</strong>æŒ‰åˆ†åŒºåœ¨å†…å­˜çš„å…ˆåæ¬¡åºä»å¤´æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å…¶å¤§å°ä¸è¦æ±‚ç›¸å·®æœ€å°çš„ç©ºé—²åˆ†åŒºè¿›è¡Œåˆ†é…ã€‚ä»ä¸ªåˆ«æ¥çœ‹ï¼Œå¤–ç¢ç‰‡è¾ƒå°ï¼›ä½†ä»æ•´ä½“æ¥çœ‹ï¼Œä¼šå½¢æˆè¾ƒå¤šå¤–ç¢ç‰‡ä¼˜ç‚¹æ˜¯è¾ƒå¤§çš„ç©ºé—²åˆ†åŒºå¯ä»¥è¢«ä¿ç•™ã€‚</p><p><strong>æœ€åé€‚é…æ³•(worst- fit)ï¼š</strong>æŒ‰åˆ†åŒºåœ¨å†…å­˜çš„å…ˆåæ¬¡åºä»å¤´æŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ€å¤§çš„ç©ºé—²åˆ†åŒºè¿›è¡Œåˆ†é…ã€‚åŸºæœ¬ä¸ç•™ä¸‹å°ç©ºé—²åˆ†åŒºï¼Œä¸æ˜“å½¢æˆå¤–ç¢ç‰‡ã€‚ä½†ç”±äºè¾ƒå¤§çš„ç©ºé—²åˆ†åŒºä¸è¢«ä¿ç•™ï¼Œå½“å¯¹å†…å­˜éœ€æ±‚è¾ƒå¤§çš„è¿›ç¨‹éœ€è¦è¿è¡Œæ—¶ï¼Œå…¶è¦æ±‚ä¸æ˜“è¢«æ»¡è¶³ã€‚</p><h4 id="ä¼™ä¼´ç³»ç»Ÿ"><a href="#ä¼™ä¼´ç³»ç»Ÿ" class="headerlink" title="ä¼™ä¼´ç³»ç»Ÿ"></a>ä¼™ä¼´ç³»ç»Ÿ</h4><p>å›ºå®šåˆ†åŒºå’ŒåŠ¨æ€åˆ†åŒºæ–¹å¼éƒ½æœ‰ä¸è¶³ä¹‹å¤„ã€‚å›ºå®šåˆ†åŒºæ–¹å¼é™åˆ¶äº†æ´»åŠ¨è¿›ç¨‹çš„æ•°ç›®ï¼Œå½“è¿›ç¨‹å¤§å°ä¸ç©ºé—²åˆ†åŒºå¤§å°ä¸åŒ¹é…æ—¶ï¼Œå†…å­˜ç©ºé—´åˆ©ç”¨ç‡å¾ˆä½ã€‚åŠ¨æ€åˆ†åŒºæ–¹å¼ç®—æ³•å¤æ‚ï¼Œå›æ”¶ç©ºé—²åˆ†åŒºæ—¶éœ€è¦è¿›è¡Œåˆ†åŒºåˆå¹¶ç­‰ï¼Œç³»ç»Ÿå¼€é”€è¾ƒå¤§ã€‚ä¼™ä¼´ç³»ç»Ÿæ–¹å¼æ˜¯å¯¹ä»¥ä¸Šä¸¤ç§å†…å­˜æ–¹å¼çš„ä¸€ç§æŠ˜è¡·æ–¹æ¡ˆã€‚<br>ä¼™ä¼´ç³»ç»Ÿè§„å®šï¼Œæ— è®ºå·²åˆ†é…åˆ†åŒºæˆ–ç©ºé—²åˆ†åŒºï¼Œå…¶å¤§å°å‡ä¸º $2^k$ï¼Œ$k$ ä¸ºæ•´æ•°ï¼Œ $lâ‰¤kâ‰¤m$ï¼Œå…¶ä¸­ï¼š</p><p>$2^l$ è¡¨ç¤ºåˆ†é…çš„æœ€å°åˆ†åŒºçš„å¤§å°ï¼Œ</p><p>$2^m$ è¡¨ç¤ºåˆ†é…çš„æœ€å¤§åˆ†åŒºçš„å¤§å°ï¼Œ</p><p>é€šå¸¸ $2^m$æ˜¯æ•´ä¸ªå¯åˆ†é…å†…å­˜çš„å¤§å°ã€‚<br>å‡è®¾ç³»ç»Ÿçš„å¯åˆ©ç”¨ç©ºé—´å®¹é‡ä¸º$2^m$ä¸ªå­—ï¼Œ åˆ™ç³»ç»Ÿå¼€å§‹è¿è¡Œæ—¶ï¼Œ æ•´ä¸ªå†…å­˜åŒºæ˜¯ä¸€ä¸ªå¤§å°ä¸º$2^m$çš„ç©ºé—²åˆ†åŒºã€‚åœ¨ç³»ç»Ÿè¿è¡Œè¿‡ä¸­ï¼Œ ç”±äºä¸æ–­çš„åˆ’åˆ†ï¼Œå¯èƒ½ä¼šå½¢æˆè‹¥å¹²ä¸ªä¸è¿ç»­çš„ç©ºé—²åˆ†åŒºï¼Œå°†è¿™äº›ç©ºé—²åˆ†åŒºæ ¹æ®åˆ†åŒºçš„å¤§å°è¿›è¡Œåˆ†ç±»ï¼Œå¯¹äºæ¯ä¸€ç±»å…·æœ‰ç›¸åŒå¤§å°çš„æ‰€æœ‰ç©ºé—²åˆ†åŒºï¼Œå•ç‹¬è®¾ç«‹ä¸€ä¸ªç©ºé—²åˆ†åŒºåŒå‘é“¾è¡¨ã€‚è¿™æ ·ï¼Œä¸åŒå¤§å°çš„ç©ºé—²åˆ†åŒºå½¢æˆäº†$k(0â‰¤kâ‰¤m)$ä¸ªç©ºé—²åˆ†åŒºé“¾è¡¨ã€‚ </p><h5 id="åˆ†é…æ­¥éª¤"><a href="#åˆ†é…æ­¥éª¤" class="headerlink" title="åˆ†é…æ­¥éª¤"></a>åˆ†é…æ­¥éª¤</h5><p>å½“éœ€è¦ä¸ºè¿›ç¨‹åˆ†é…ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„å­˜å‚¨ç©ºé—´æ—¶:</p><p>é¦–å…ˆè®¡ç®—ä¸€ä¸ª $i$ å€¼ï¼Œä½¿ $2^{iï¼1} &lt;n â‰¤ 2^i$ï¼Œ</p><p>ç„¶ååœ¨ç©ºé—²åˆ†åŒºå¤§å°ä¸º $2^i$ çš„ç©ºé—²åˆ†åŒºé“¾è¡¨ä¸­æŸ¥æ‰¾ã€‚</p><p>è‹¥æ‰¾åˆ°ï¼Œå³æŠŠè¯¥ç©ºé—²åˆ†åŒºåˆ†é…ç»™è¿›ç¨‹ã€‚</p><p>å¦åˆ™ï¼Œè¡¨æ˜é•¿åº¦ä¸º $2^i$ çš„ç©ºé—²åˆ†åŒºå·²ç»è€—å°½ï¼Œåˆ™åœ¨åˆ†åŒºå¤§å°ä¸º $2^{iï¼‹1}$ çš„ç©ºé—²åˆ†åŒºé“¾è¡¨ä¸­å¯»æ‰¾ã€‚</p><p>è‹¥å­˜åœ¨ $2^{iï¼‹1}$ çš„ä¸€ä¸ªç©ºé—²åˆ†åŒºï¼Œåˆ™æŠŠè¯¥ç©ºé—²åˆ†åŒºåˆ†ä¸ºç›¸ç­‰çš„ä¸¤ä¸ªåˆ†åŒºï¼Œè¿™ä¸¤ä¸ªåˆ†åŒºç§°ä¸ºä¸€å¯¹ä¼™ä¼´ï¼Œå…¶ä¸­çš„ä¸€ä¸ªåˆ†åŒºç”¨äºåˆ†é…ï¼Œ  è€ŒæŠŠå¦ä¸€ä¸ªåŠ å…¥åˆ†åŒºå¤§å°ä¸º $2^i$ çš„ç©ºé—²åˆ†åŒºé“¾è¡¨ä¸­ã€‚</p><p>è‹¥å¤§å°ä¸º $2^{iï¼‹1}$ çš„ç©ºé—²åˆ†åŒºä¹Ÿä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦æŸ¥æ‰¾å¤§å°ä¸º $2^{iï¼‹2}$ çš„ç©ºé—²åˆ†åŒºï¼Œ è‹¥æ‰¾åˆ°åˆ™å¯¹å…¶è¿›è¡Œä¸¤æ¬¡åˆ†å‰²ï¼š</p><p>ç¬¬ä¸€æ¬¡ï¼Œå°†å…¶åˆ†å‰²ä¸ºå¤§å°ä¸º $2^{iï¼‹1}$ çš„ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªç”¨äºåˆ†é…ï¼Œä¸€ä¸ªåŠ å…¥åˆ°å¤§å°ä¸º $2^{iï¼‹1}$ çš„ç©ºé—²åˆ†åŒºé“¾è¡¨ä¸­ï¼›</p><p>ç¬¬äºŒæ¬¡ï¼Œå°†ç¬¬ä¸€æ¬¡ç”¨äºåˆ†é…çš„ç©ºé—²åŒºåˆ†å‰²ä¸º $2^i$ çš„ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªç”¨äºåˆ†é…ï¼Œä¸€ä¸ªåŠ å…¥åˆ°å¤§å°ä¸º $2^i$ çš„ç©ºé—²åˆ†åŒºé“¾è¡¨ä¸­ã€‚</p><p>è‹¥ä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­æŸ¥æ‰¾å¤§å°ä¸º $2^{iï¼‹3}$ çš„ç©ºé—²åˆ†åŒºï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦å¯¹ $2^k$ çš„ç©ºé—²åˆ†åŒºè¿›è¡Œ $k$ æ¬¡åˆ†å‰²æ‰èƒ½å¾—åˆ°æ‰€éœ€åˆ†åŒºã€‚</p><p>ä¸ä¸€æ¬¡åˆ†é…å¯èƒ½è¦è¿›è¡Œå¤šæ¬¡åˆ†å‰²ä¸€æ ·ï¼Œä¸€æ¬¡å›æ”¶ä¹Ÿå¯èƒ½è¦è¿›è¡Œå¤šæ¬¡åˆå¹¶ï¼Œå¦‚å›æ”¶å¤§å°ä¸º $2^i$ çš„ç©ºé—²åˆ†åŒºæ—¶ï¼Œè‹¥äº‹å…ˆå·²å­˜åœ¨ $2^i$ çš„ç©ºé—²åˆ†åŒºæ—¶ï¼Œåˆ™åº”å°†å…¶ä¸ä¼™ä¼´åˆ†åŒºåˆå¹¶ä¸ºå¤§å°ä¸º$2^{iï¼‹1}$ çš„ç©ºé—²åˆ†åŒºï¼Œè‹¥äº‹å…ˆå·²å­˜åœ¨ $2^{iï¼‹1}$ çš„ç©ºé—²åˆ†åŒºæ—¶ï¼Œåˆåº”ç»§ç»­ä¸å…¶ä¼™ä¼´åˆ†åŒºåˆå¹¶ä¸ºå¤§å°ä¸º $2^{iï¼‹2}$ çš„ç©ºé—²åˆ†åŒºï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p>åœ¨ä¼™ä¼´ç³»ç»Ÿä¸­ï¼Œå…¶åˆ†é…å’Œå›æ”¶çš„æ—¶é—´æ€§èƒ½å–å†³äºæŸ¥æ‰¾ç©ºé—²åˆ†åŒºçš„ä½ç½®å’Œåˆ†å‰²ã€åˆå¹¶ç©ºé—²åˆ†åŒºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ä¸å‰é¢æ‰€è¿°çš„å¤šç§æ–¹æ³•ç›¸æ¯”è¾ƒï¼Œç”±äºè¯¥ç®—æ³•åœ¨å›æ”¶ç©ºé—²åˆ†åŒºæ—¶ï¼Œéœ€è¦å¯¹ç©ºé—²åˆ†åŒºè¿›è¡Œåˆå¹¶ï¼Œæ‰€ä»¥å…¶æ—¶é—´æ€§èƒ½æ¯”å‰é¢æ‰€è¿°çš„åˆ†ç±»æœç´¢ç®—æ³•å·®ï¼Œä½†æ¯”é¡ºåºæœç´¢ç®—æ³•å¥½ï¼Œè€Œå…¶ç©ºé—´æ€§èƒ½åˆ™è¿œä¼˜äºå‰é¢æ‰€è¿°çš„åˆ†ç±»æœç´¢æ³•ï¼Œæ¯”é¡ºåºæœç´¢æ³•ç•¥å·®ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œåœ¨å½“å‰çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œæ™®éé‡‡ç”¨çš„æ˜¯ä¸‹é¢å°†è¦è®²è¿°çš„åŸºäºåˆ†é¡µå’Œåˆ†æ®µæœºåˆ¶çš„è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œè¯¥æœºåˆ¶è¾ƒä¼™ä¼´ç®—æ³•æ›´ä¸ºåˆç†å’Œé«˜æ•ˆï¼Œä½†åœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œä¼™ä¼´ç³»ç»Ÿä»ä¸å¤±ä¸ºä¸€ç§æœ‰æ•ˆçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„æ–¹æ³•ï¼Œå¾—åˆ°äº†å¤§é‡çš„åº”ç”¨ã€‚</p><h4 id="å†…å­˜ç´§ç¼©"><a href="#å†…å­˜ç´§ç¼©" class="headerlink" title="å†…å­˜ç´§ç¼©"></a>å†…å­˜ç´§ç¼©</h4><p>å†…å­˜ç´§ç¼©æ˜¯ä¸€ç§å†…å­˜ç¢ç‰‡åŒ–å¤„ç†çš„æ–¹æ¡ˆã€‚å®ƒå°†å„ä¸ªå ç”¨åˆ†åŒºå‘å†…å­˜ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åå°†å„ä¸ªç©ºé—²åˆ†åŒºåˆå¹¶æˆä¸ºä¸€ä¸ªç©ºé—²åˆ†åŒºã€‚è¿™ç§æŠ€æœ¯åœ¨æä¾›äº†æŸç§ç¨‹åº¦ä¸Šçš„çµæ´»æ€§çš„åŒæ—¶ï¼Œä¹Ÿå­˜åœ¨ç€ä¸€äº›å¼Šç«¯ï¼Œä¾‹å¦‚ï¼šå¯¹å ç”¨åˆ†åŒºè¿›è¡Œå†…å­˜æ•°æ®æ¬ç§»å ç”¨CPUæ—¶é—´ï¼›å¦‚æœå¯¹å ç”¨åˆ†åŒºä¸­çš„ç¨‹åºè¿›è¡Œâ€œæµ®åŠ¨â€ï¼Œåˆ™å…¶é‡å®šä½éœ€è¦ç¡¬ä»¶æ”¯æŒã€‚</p><p>ç´§ç¼©æ—¶æœºï¼šæ¯ä¸ªåˆ†åŒºé‡Šæ”¾åï¼Œæˆ–å†…å­˜åˆ†é…æ‰¾ä¸åˆ°æ»¡è¶³æ¡ä»¶çš„ç©ºé—²åˆ†åŒºæ—¶ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/TiQOxfhp4YAnckV.jpg" alt="å›¾"></p><h5 id="å †ç»“æ„çš„å­˜å‚¨ç®¡ç†çš„åˆ†é…ç®—æ³•"><a href="#å †ç»“æ„çš„å­˜å‚¨ç®¡ç†çš„åˆ†é…ç®—æ³•" class="headerlink" title="å †ç»“æ„çš„å­˜å‚¨ç®¡ç†çš„åˆ†é…ç®—æ³•"></a>å †ç»“æ„çš„å­˜å‚¨ç®¡ç†çš„åˆ†é…ç®—æ³•</h5><p>åœ¨åŠ¨æ€å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œä¸ç®¡å“ªä¸ªæ—¶åˆ»ï¼Œå¯åˆ©ç”¨ç©ºé—´éƒ½æ˜¯-ä¸€ä¸ªåœ°å€è¿ç»­çš„å­˜å‚¨åŒºï¼Œåœ¨ç¼–è¯‘ç¨‹åºä¸­ç§°ä¹‹ä¸ºâ€å †â€ï¼Œæ¯æ¬¡åˆ†é…éƒ½æ˜¯ä»è¿™ä¸ªå¯åˆ©ç”¨ç©ºé—´ä¸­åˆ’å‡ºä¸€å—ã€‚å…¶å®ç°åŠæ³•æ˜¯ï¼šè®¾ç«‹ä¸€ä¸ªæŒ‡é‡ï¼Œç§°ä¹‹ä¸ºå †æŒ‡é’ˆï¼Œå§‹ç»ˆæŒ‡å‘å †çš„æœ€ä½ï¼ˆæˆ–é”»è”ï¼‰åœ°å€ã€‚å½“ç”¨æˆ·ç”³è¯·Nä¸ªå•ä½çš„å­˜å‚¨å—æ—¶ï¼Œå †æŒ‡é’ˆå‘é«˜åœ°å€ï¼ˆæˆ– ä½åœ°å€ï¼‰ç§°åŠ¨Nä¸ªå­˜å‚¨å•ä½ï¼Œè€Œç§»åŠ¨ä¹‹å‰çš„å †æŒ‡é’ˆçš„å€¼å°±æ˜¯åˆ†é…ç»™ç”¨æˆ·çš„å ç”¨å—çš„åˆå§‹åœ°å€ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªä¸²å¤„ç†ç³»ç»Ÿä¸­æœ‰Aã€Bã€Cã€Dè¿™4ä¸ªä¸²ï¼Œå…¶ä¸²å€¼é•¿åº¦åˆ†åˆ«ç‚º12, 6, 10å’Œ8. å‡è®¾å †æŒ‡é’ˆfreeçš„åˆå€¼ä¸ºé›¶ï¼Œåˆ™åˆ†é…ç»™è¿™4ä¸ªä¸²å€¼çš„å­˜å‚¨ç©ºé—´çš„åˆå§‹åœ°å€åˆ†åˆ«ä¸º0.12.18å’Œ 28,å¦‚å›¾æ‰€ç¤ºï¼Œåˆ†é…åçš„å †æŒ‡é’ˆçš„å€¼ä¸º36ã€‚ å› æ­¤ï¼Œ<strong>è¿™ç§å †ç»“æ„çš„å­˜å‚¨ç®¡ç†çš„åˆ†é…ç®—æ³•éå¸¸ç®€å•</strong>ï¼Œ</p><h5 id="é‡Šæ”¾å†…å­˜ç©ºé—´æ‰§è¡Œå†…å­˜ç´§ç¼©"><a href="#é‡Šæ”¾å†…å­˜ç©ºé—´æ‰§è¡Œå†…å­˜ç´§ç¼©" class="headerlink" title="é‡Šæ”¾å†…å­˜ç©ºé—´æ‰§è¡Œå†…å­˜ç´§ç¼©"></a>é‡Šæ”¾å†…å­˜ç©ºé—´æ‰§è¡Œå†…å­˜ç´§ç¼©</h5><p>å›æ”¶ç”¨æˆ·é‡Šæ”¾çš„ç©ºé—²å—å°±æ¯”è¾ƒéº»çƒ¦.ç”±äºç³»ç»Ÿçš„å¯åˆ©ç”¨ç©ºé—´å§‹ç»ˆæ˜¯ä¸€ä¸ªç»å€è¿ç»­çš„å­˜å‚¨å—ï¼Œå› æ­¤å›æ”¶æ—¶å¿…é¡»å°†æ‰€é‡Šæ”¾çš„ç©ºé—´å—åˆå¹¶åˆ°æ•´ä¸ªå †ä¸Šå»æ‰ èƒ½é‡æ–°ä½¿ç”¨ï¼Œè¿™å°±æ˜¯â€å­˜å‚¨ç­–ç¼©â€çš„ä»»åŠ¡.é€šå¸¸ï¼Œæœ‰ä¸¤ç§åšæ³•ï¼š</p><p>ä¸€ç§æ˜¯ä¸€æ—¦æœ‰ç”¨æˆ·é‡Šæ”¾å­˜å‚¨å—å³è¿›è¡Œå›æ”¶ç´§ç¼©ï¼Œä¾‹å§‹ï¼Œä¸Šå›¾ä¸­açš„å †ï¼Œåœ¨cä¸²é‡Šæ”¾å­˜å‚¨å—æ—¶å³å›æ”¶ç´§ç¼©ï¼Œä¾‹å¦‚bçš„å †ï¼ŒåŒæ—¶ä¿®æ”¹ä¸²çš„å­˜å‚¨æ˜ åƒæˆcçš„çŠ¶æ€ï¼›</p><p>å¦ä¸€ç§æ˜¯åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å›æ”¶ç”¨æˆ·éšæ—¶é‡Šæ”¾çš„å­˜å‚¨å—ï¼Œç›´åˆ°å¯åˆ©ç”¨ç©ºåŒä¸å¤Ÿåˆ†é…æˆ–å †æŒ‡é’ˆæŒ‡å‘æœ€é«˜åœ°å€æ—¶æ‰è¿›è¡Œå­˜å‚¨ç´§ç¼©ã€‚æ­¤æ—¶ç´§ç¼©çš„ç›®çš„æ˜¯å°†å †ä¸­æ‰€æœ‰çš„ç©ºé—´å—è¿æˆä¸€å—ï¼Œå³å°†æ‰€æœ‰çš„å ç”¨å—éƒ¨é›†ä¸­åˆ° å¯åˆ©ç”¨ç©ºé—´çš„ä½åœ°åœ°åŒºï¼Œè€Œå‰©ä½™çš„é«˜åœ°å€åŒºæˆä¸ºä¸€æ•´ä¸ªåœ°ç»§è¿ç»­çš„ç©ºé—²å—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­ï¼ˆaï¼‰ä¸ºç´§ç¼©å‰çš„çŠ¶æ€ï¼Œ(b)ä¸ºç´§ç¼©åçš„çŠ¶æ€</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/hrMuO3gatlBIdk8.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTUvMTM1MDMwNzkyNV8xMzg5LmpwZw"></p><p>å’Œæ— ç”¨å•å…ƒæ”¶é›†ç±»ä¼¼ï¼Œä¸ºå®ç°å­˜å‚¨ç´§ç¼–,é¦–å…ˆè¦å¯¹å ç”¨å—è¿›è¡Œâ€œæ ‡å¿—â€ï¼Œæ ‡å¿—ç®—æ³•å’Œæ— ç”¨å•å…ƒæ”¶é›†ç±»åŒ(å­˜å‚¨å—çš„ç»“æ„å¯èƒ½ä¸åŒï¼‰,å…¶æ¬¡éœ€è¿›è¡Œä¸‹åˆ—4æ­¥é›„ä½œï¼š</p><ol><li>è®¡ç®—å ç”¨å—çš„æ–°åœ°å€ã€‚ä»æœ€ä½åœ°å€å¼€å§‹å·¡æŸ»æ•´ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå¯¹æ¯ä¸€ä¸ªå ç”¨å—æ‰¾åˆ°å®ƒåœ¨ç´§ç¼©åçš„æ–°åœ°å€ã€‚ ä¸ºæ­¤,éœ€è®¾ç«‹ä¸¤ä¸ªæŒ‡é’ˆéšå·¡æŸ¥å‘å‰ç§»åŠ¨,è¿™ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡ç¤ºå ç”¨ å—åœ¨ç´§ç¼©ä¹‹å‰å’Œä¹‹åçš„åŸåœ°å€å’Œæ–°åœ°å€ã€‚å› æ­¤,åœ¨æ¯ä¸ªå ç”¨å—çš„ç¬¬-Â·ä¸ªå­˜å‚¨å•ä½ä¸­ï¼Œé™¤äº† è®¾ç«‹é•¿åº¦åŸŸ(å­˜å‚¨è¯¥å ç”¨æ¢çš„å¤§å°ï¼‰å’Œæ ‡å¿—åŸŸ(å­˜å‚¨åŒºåˆ«è¯¥å­˜å‚¨å—æ˜¯å ç”¨å—æˆ–ç©ºé—²å—çš„æ ‡ å¿—ï¼‰ä¹‹å¤–ï¼Œè¿˜éœ€è®¾ç«‹ä¸€ä¸ªæ–°åœ°å€åŸï¼Œä»¥å­˜å‚¨å ç”¨å—åœ¨ç´§ç¼©ååº”æœ‰çš„æ–°åœ°å€ï¼Œå³å»ºç«‹ä¸€å¼ æ–°ï¼Œ æ—§åœ°å€çš„å¯¹ç…§è¡¨m</li><li>ä¿®æ”¹ç”¨æˆ·è§¦åˆå§‹å˜é‡è¡¨ï¼Œä»¥ä¾¿åœ¨å­˜å‚¨ç´§ç¼©åç”¨æˆ·ç¨‹åºèƒ½ç»§ç»­æ­£å¸¸è¿è¡Œã€‚</li><li>æ£€æŸ¥æ¯ä¸ªå ç”¨å—ä¸­å­˜å‚¨çš„æ•°æ®ï¼Œ è‹¥æœ‰æŒ‡å‘å…¶ä»–å­˜å‚¨æ¢çš„æŒ‡é’ˆï¼Œåˆ™éœ€ä½œç›¸åº”ä¿®æ”¹ã€‚</li><li>å°†æ‰€æœ‰å ç”¨å—è¿ç§»åˆ°æ–°åœ°å€èµ°ï¼Œè¿™å®è´¨ä¸Šæ˜¯ä½œä¼ é€æ•°æ®çš„å·¥ä½œã€‚</li></ol><p>è‡³æ­¤ï¼Œå®Œæˆäº†å­˜å‚¨ç´§ç¼©çš„æ“ä½œï¼Œæœ€å,å°†å †æŒ‡é’ˆèµ‹ä»¥æ–°å€¼ï¼ˆå³ç´§ç¼©åçš„ç©ºé—²å­˜å‚¨åŒºçš„æœ€ä½åœ°å€ï¼‰ã€‚</p><p>å¯è§,å­˜å‚¨ç´§ç¼©æ³•æ¯”æ— ç”¨å•å…ƒæ”¶é›†æ³•æ›´ä¸ºå¤æ‚ï¼Œå‰è€…ä¸ä»…è¦ä¼ é€æ•°æ®ï¼ˆè¿›è¡Œå ç”¨å—è¿ç§»ï¼‰ï¼Œè€Œä¸”è¿˜æœ‰éœ€è¦ä¿®æ”¹æ‰€æœ‰å ç”¨å—ä¸­çš„æŒ‡é’ˆå€¼ã€‚å› æ­¤ï¼Œå­˜å‚¨ç´§ç¼©ä¹Ÿæ˜¯ä¸ªç³»ç»Ÿæ“ä½œï¼Œä¸”éä¸å¾—å·²å°±ä¸ç”¨ã€‚</p><h4 id="è¦†ç›–æŠ€æœ¯"><a href="#è¦†ç›–æŠ€æœ¯" class="headerlink" title="è¦†ç›–æŠ€æœ¯"></a>è¦†ç›–æŠ€æœ¯</h4><p><strong>å¼•å…¥è¦†ç›–</strong> <strong>(overlay)</strong>æŠ€æœ¯çš„ç›®æ ‡æ˜¯åœ¨è¾ƒå°çš„å¯ç”¨å†…å­˜ä¸­è¿è¡Œè¾ƒå¤§çš„ç¨‹åºã€‚è¿™ç§æŠ€æœ¯å¸¸ç”¨äºå¤šé“ç¨‹åºç³»ç»Ÿä¹‹ä¸­ï¼Œä¸åˆ†åŒºå¼å­˜å‚¨ç®¡ç†é…åˆä½¿ç”¨ã€‚</p><p>è¦†ç›–æŠ€æœ¯çš„åŸç†ï¼šä¸€ä¸ªç¨‹åºçš„å‡ ä¸ªä»£ç æ®µæˆ–æ•°æ®æ®µï¼ŒæŒ‰ç…§æ—¶é—´å…ˆåæ¥å ç”¨å…¬å…±çš„å†…å­˜ç©ºé—´ã€‚å°†ç¨‹åºå¿…è¦éƒ¨åˆ†(å¸¸ç”¨åŠŸèƒ½)çš„ä»£ç å’Œæ•°æ®å¸¸é©»å†…å­˜ï¼›å¯é€‰éƒ¨åˆ†(ä¸å¸¸ç”¨åŠŸèƒ½)å¹³æ—¶å­˜æ”¾åœ¨å¤–å­˜(è¦†ç›–æ–‡ä»¶)ä¸­ï¼Œåœ¨éœ€è¦æ—¶æ‰è£…å…¥å†…å­˜ã€‚ä¸å­˜åœ¨è°ƒç”¨å…³ç³»çš„æ¨¡å—ä¸å¿…åŒæ—¶è£…å…¥åˆ°å†…å­˜ï¼Œä»è€Œå¯ä»¥ç›¸äº’è¦†ç›–ã€‚</p><p>åœ¨ä»»ä½•æ—¶å€™åªåœ¨å†…å­˜ä¸­ä¿ç•™æ‰€éœ€çš„æŒ‡ä»¤å’Œæ•°æ®ï¼›å½“éœ€è¦å…¶å®ƒæŒ‡ä»¤æ—¶ï¼Œå®ƒä»¬ä¼šè£…å…¥åˆ°åˆšåˆšä¸å†éœ€è¦çš„æŒ‡ä»¤æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼›</p><p>å¦‚åœ¨åŒä¸€æ—¶åˆ»ï¼ŒCPUåªèƒ½æ‰§è¡ŒBï¼ŒCä¸­æŸä¸€æ¡ã€‚Bï¼ŒCä¹‹é—´å°±å¯ä»¥åšè¦†ç›–ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/RY2srW83VcawoFk.png" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTYvMTM1MDM1NzUzOV83MjI5LnBuZw"></p><p>è¦†ç›–æŠ€æœ¯çš„ç¼ºç‚¹æ˜¯ç¼–ç¨‹æ—¶å¿…é¡»åˆ’åˆ†ç¨‹åºæ¨¡å—å’Œç¡®å®šç¨‹åºæ¨¡å—ä¹‹é—´çš„è¦†ç›–å…³ç³»ï¼Œå¢åŠ ç¼–ç¨‹å¤æ‚åº¦ï¼›ä»å¤–å­˜è£…å…¥è¦†ç›–æ–‡ä»¶ï¼Œä»¥æ—¶é—´å»¶é•¿æ¢å–ç©ºé—´èŠ‚çœã€‚</p><p>è¦†ç›–çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼šä»¥å‡½æ•°åº“æ–¹å¼å®ç°æˆ–æ“ä½œç³»ç»Ÿæ”¯æŒã€‚</p><h4 id="äº¤æ¢æŠ€æœ¯"><a href="#äº¤æ¢æŠ€æœ¯" class="headerlink" title="äº¤æ¢æŠ€æœ¯"></a>äº¤æ¢æŠ€æœ¯</h4><p><strong>äº¤æ¢ (swapping)</strong>æŠ€æœ¯åœ¨å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å°†æš‚æ—¶ä¸èƒ½æ‰§è¡Œçš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰é€åˆ°å¤–å­˜ä¸­ï¼Œä»è€Œè·å¾—ç©ºé—²å†…å­˜ç©ºé—´æ¥è£…å…¥æ–°ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ï¼Œæˆ–è¯»å…¥ä¿å­˜åœ¨å¤–å­˜ä¸­è€Œå¤„äºå°±ç»ªçŠ¶æ€çš„ç¨‹åºã€‚äº¤æ¢å•ä½ä¸ºæ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚äº¤æ¢æŠ€æœ¯å¸¸ç”¨äºå¤šé“ç¨‹åºç³»ç»Ÿæˆ–å°å‹åˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œå› ä¸ºè¿™äº›ç³»ç»Ÿå¤§å¤šé‡‡ç”¨åˆ†åŒºå­˜å‚¨ç®¡ç†æ–¹å¼ã€‚ä¸åˆ†åŒºå¼å­˜å‚¨ç®¡ç†é…åˆä½¿ç”¨åˆç§°ä½œâ€œå¯¹æ¢â€æˆ–â€œæ»šè¿›ï¼æ»šå‡ºâ€ (roll-inï¼roll-out)ã€‚</p><p><strong>åŸç†ï¼š</strong>æš‚åœæ‰§è¡Œå†…å­˜ä¸­çš„è¿›ç¨‹ï¼Œå°†æ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¿å­˜åˆ°å¤–å­˜çš„äº¤æ¢åŒºä¸­ï¼ˆæ¢å‡ºswap outï¼‰ï¼Œè€Œå°†å¤–å­˜ä¸­ç”±é˜»å¡å˜ä¸ºå°±ç»ªçš„è¿›ç¨‹çš„åœ°å€ç©ºé—´è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¯¥è¿›ç¨‹é€åˆ°å°±ç»ªé˜Ÿåˆ—ï¼ˆæ¢å…¥swap inï¼‰ã€‚</p><p><strong>äº¤æ¢</strong>æŠ€æœ¯ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å¢åŠ å¹¶å‘è¿è¡Œçš„ç¨‹åºæ•°ç›®ï¼Œå¹¶ç»™ç”¨æˆ·æä¾›é€‚å½“çš„å“åº”æ—¶é—´ï¼›ä¸è¦†ç›–æŠ€æœ¯ç›¸æ¯”äº¤æ¢æŠ€æœ¯å¦ä¸€ä¸ªæ˜¾è‘—çš„ä¼˜ç‚¹æ˜¯ä¸å½±å“ç¨‹åºç»“æ„ã€‚äº¤æ¢æŠ€æœ¯æœ¬èº«ä¹Ÿå­˜åœ¨ç€ä¸è¶³ï¼Œä¾‹å¦‚ï¼šå¯¹æ¢å…¥å’Œæ¢å‡ºçš„æ§åˆ¶å¢åŠ å¤„ç†å™¨å¼€é”€ï¼›ç¨‹åºæ•´ä¸ªåœ°å€ç©ºé—´éƒ½è¿›è¡Œå¯¹æ¢ï¼Œæ²¡æœ‰è€ƒè™‘æ‰§è¡Œè¿‡ç¨‹ä¸­åœ°å€è®¿é—®çš„ç»Ÿè®¡ç‰¹æ€§ã€‚</p><p>ä¸è¦†ç›–æŠ€æœ¯ç›¸æ¯”ï¼Œäº¤æ¢ä¸è¦æ±‚ç¨‹åºå‘˜ç»™å‡ºç¨‹åºæ®µä¹‹é—´çš„è¦†ç›–ç»“æ„ã€‚äº¤æ¢ä¸»è¦æ˜¯åœ¨è¿›ç¨‹ä¸ä½œä¸šä¹‹é—´è¿›è¡Œï¼Œè€Œè¦†ç›–åˆ™ä¸»è¦åœ¨åŒä¸€ä½œä¸šæˆ–è¿›ç¨‹å†…è¿›è¡Œã€‚ å¦å¤–è¦†ç›–åªèƒ½è¦†ç›–é‚£äº›ä¸è¦†ç›–ç¨‹åºæ®µæ— å…³çš„ç¨‹åºæ®µã€‚</p><h3 id="éè¿ç»­å†…å­˜åˆ†é…ç®¡ç†"><a href="#éè¿ç»­å†…å­˜åˆ†é…ç®¡ç†" class="headerlink" title="éè¿ç»­å†…å­˜åˆ†é…ç®¡ç†"></a>éè¿ç»­å†…å­˜åˆ†é…ç®¡ç†</h3><p>åœ¨å‰é¢çš„å‡ ç§å­˜å‚¨ç®¡ç†æ–¹æ³•ä¸­ï¼Œ<strong>ä¸ºè¿›ç¨‹åˆ†é…çš„ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œä½¿ç”¨çš„åœ°å€éƒ½æ˜¯ç‰©ç†åœ°å€</strong>ã€‚å¦‚æœå…è®¸å°†ä¸€ä¸ªè¿›ç¨‹åˆ†æ•£åˆ°è®¸å¤šä¸è¿ç»­çš„ç©ºé—´ï¼Œå°±å¯ä»¥é¿å…å†…å­˜ç´§ç¼©ï¼Œå‡å°‘ç¢ç‰‡ã€‚åŸºäºè¿™ä¸€æ€æƒ³ï¼Œé€šè¿‡å¼•å…¥è¿›ç¨‹çš„é€»è¾‘åœ°å€ï¼ŒæŠŠè¿›ç¨‹åœ°å€ç©ºé—´ä¸å®é™…å­˜å‚¨ç©ºé—´åˆ†ç¦»ï¼Œå¢åŠ å­˜å‚¨ç®¡ç†çš„çµæ´»æ€§ã€‚åœ°å€ç©ºé—´å’Œå­˜å‚¨ç©ºé—´ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><p>åœ°å€ç©ºé—´ï¼šå°†æºç¨‹åºç»è¿‡ç¼–è¯‘åå¾—åˆ°çš„ç›®æ ‡ç¨‹åºï¼Œå­˜åœ¨äºå®ƒæ‰€é™å®šçš„åœ°å€èŒƒå›´å†…ï¼Œè¿™ä¸ªèŒƒå›´ç§°ä¸ºåœ°å€ç©ºé—´ã€‚åœ°å€ç©ºé—´æ˜¯é€»è¾‘åœ°å€çš„é›†åˆã€‚</p><p>å­˜å‚¨ç©ºé—´ï¼šæŒ‡ä¸»å­˜ä¸­ä¸€ç³»åˆ—å­˜å‚¨ä¿¡æ¯çš„ç‰©ç†å•å…ƒçš„é›†åˆï¼Œè¿™äº›å•å…ƒçš„ç¼–å·ç§°ä¸ºç‰©ç†åœ°å€å­˜å‚¨ç©ºé—´æ˜¯ç‰©ç†åœ°å€çš„é›†åˆã€‚</p><p>æ ¹æ®åˆ†é…æ—¶æ‰€é‡‡ç”¨çš„åŸºæœ¬å•ä½ä¸åŒï¼Œå¯å°†ç¦»æ•£åˆ†é…çš„ç®¡ç†æ–¹å¼åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p><p><strong>é¡µå¼å­˜å‚¨ç®¡ç†ã€æ®µå¼å­˜å‚¨ç®¡ç†å’Œæ®µé¡µå¼å­˜å‚¨ç®¡ç†ã€‚å…¶ä¸­æ®µé¡µå¼å­˜å‚¨ç®¡ç†æ˜¯å‰ä¸¤ç§ç»“åˆçš„äº§ç‰©ã€‚</strong></p><h4 id="é¡µå¼å­˜å‚¨ç®¡ç†"><a href="#é¡µå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="é¡µå¼å­˜å‚¨ç®¡ç†"></a>é¡µå¼å­˜å‚¨ç®¡ç†</h4><p>å°†ç¨‹åºçš„é€»è¾‘åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µ(page)ï¼Œè€Œç‰©ç†å†…å­˜åˆ’åˆ†ä¸ºåŒæ ·å¤§å°çš„é¡µæ¡†(page frame)ã€‚ç¨‹åºåŠ è½½æ—¶ï¼Œå¯å°†ä»»æ„ä¸€é¡µæ”¾å…¥å†…å­˜ä¸­ä»»æ„ä¸€ä¸ªé¡µæ¡†ï¼Œè¿™äº›é¡µæ¡†ä¸å¿…è¿ç»­ï¼Œä»è€Œå®ç°äº†ç¦»æ•£åˆ†é…ã€‚è¯¥æ–¹æ³•éœ€è¦CPUçš„ç¡¬ä»¶æ”¯æŒï¼Œæ¥å®ç°é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€ä¹‹é—´çš„æ˜ å°„ã€‚åœ¨é¡µå¼å­˜å‚¨ç®¡ç†æ–¹å¼ä¸­åœ°å€ç»“æ„ç”±ä¸¤éƒ¨æ„æˆï¼Œå‰ä¸€éƒ¨åˆ†æ˜¯é¡µå·ï¼Œåä¸€éƒ¨åˆ†ä¸ºé¡µå†…åœ°å€wï¼ˆä½ç§»é‡ï¼‰ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/D5HJrxfIRU3nsGe.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTUvMTM1MDI5ODA0MF8zNDQwLmpwZw"></p><p><strong>é¡µå¼ç®¡ç†æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼š</strong></p><ol><li>æ²¡æœ‰å¤–ç¢ç‰‡ï¼Œæ¯ä¸ªå†…ç¢ç‰‡ä¸è¶…è¿‡é¡µå¤§</li><li>ä¸€ä¸ªç¨‹åºä¸å¿…è¿ç»­å­˜æ”¾ã€‚</li><li>ä¾¿äºæ”¹å˜ç¨‹åºå ç”¨ç©ºé—´çš„å¤§å°(ä¸»è¦æŒ‡éšç€ç¨‹åºè¿è¡Œï¼ŒåŠ¨æ€ç”Ÿæˆçš„æ•°æ®å¢å¤šï¼Œæ‰€è¦æ±‚çš„åœ°å€ç©ºé—´ç›¸åº”å¢é•¿)ã€‚</li></ol><p><strong>ç¼ºç‚¹</strong>æ˜¯ï¼šè¦æ±‚ç¨‹åºå…¨éƒ¨è£…å…¥å†…å­˜ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œç¨‹åºå°±ä¸èƒ½æ‰§è¡Œã€‚</p><h5 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h5><p>åœ¨é¡µå¼ç³»ç»Ÿä¸­è¿›ç¨‹å»ºç«‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ºè¿›ç¨‹ä¸­æ‰€æœ‰çš„é¡µåˆ†é…é¡µæ¡†ã€‚å½“è¿›ç¨‹æ’¤é”€æ—¶æ”¶å›æ‰€æœ‰åˆ†é…ç»™å®ƒçš„é¡µæ¡†ã€‚åœ¨ç¨‹åºçš„è¿è¡ŒæœŸé—´ï¼Œå¦‚æœå…è®¸è¿›ç¨‹åŠ¨æ€åœ°ç”³è¯·ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿè¿˜è¦ä¸ºè¿›ç¨‹ç”³è¯·çš„ç©ºé—´åˆ†é…ç‰©ç†é¡µæ¡†ã€‚æ“ä½œç³»ç»Ÿä¸ºäº†å®Œæˆè¿™äº›åŠŸèƒ½ï¼Œå¿…é¡»è®°å½•ç³»ç»Ÿå†…å­˜ä¸­å®é™…çš„é¡µæ¡†ä½¿ç”¨æƒ…å†µã€‚æ“ä½œç³»ç»Ÿè¿˜è¦åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ­£ç¡®åœ°åˆ‡æ¢ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹åœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜ç©ºé—´çš„æ˜ å°„ã€‚è¿™å°±è¦æ±‚æ“ä½œç³»ç»Ÿè¦è®°å½•æ¯ä¸ªè¿›ç¨‹é¡µè¡¨çš„ç›¸å…³ä¿¡æ¯ã€‚ä¸ºäº†å®Œæˆä¸Šè¿°çš„åŠŸèƒ½ï¼Œâ€”ä¸ªé¡µå¼ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬è¦é‡‡ç”¨å¦‚ä¸‹çš„æ•°æ®ç»“æ„ã€‚</p><p><strong>è¿›ç¨‹é¡µè¡¨</strong>ï¼šå®Œæˆé€»è¾‘é¡µå·(æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´)åˆ°ç‰©ç†é¡µé¢å·(å®é™…å†…å­˜ç©ºé—´ï¼Œä¹Ÿå«å—å·)çš„æ˜ å°„ã€‚åœ¨è¿›ç¨‹æœªæ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹å¯¹åº”çš„é¡µè¡¨çš„å§‹å€å’Œé•¿åº¦å­˜æ”¾åœ¨è¿›ç¨‹çš„PCBä¸­ï¼Œå½“è¯¥è¿›ç¨‹è¢«è°ƒåº¦æ—¶ï¼Œå°±å°†å®ƒä»¬è£…å…¥é¡µè¡¨å¯„å­˜å™¨ã€‚<br>æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œæè¿°è¯¥è¿›ç¨‹å ç”¨çš„ç‰©ç†é¡µé¢åŠé€»è¾‘æ’åˆ—é¡ºåºï¼Œå¦‚å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/ELZsFn9WKQXSYHP.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTUvMTM1MDI5ODI0MF80MTI3LmpwZw"></p><p><strong>ç‰©ç†é¡µé¢è¡¨ï¼š</strong>æ•´ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ªç‰©ç†é¡µé¢è¡¨ï¼Œæè¿°ç‰©ç†å†…å­˜ç©ºé—´çš„åˆ†é…ä½¿ç”¨çŠ¶å†µï¼Œå…¶æ•°æ®ç»“æ„å¯<strong>é‡‡ç”¨ä½ç¤ºå›¾å’Œç©ºé—²é¡µé“¾è¡¨</strong>ã€‚</p><p>å¯¹äºä½ç¤ºå›¾æ³•ï¼Œå³å¦‚æœè¯¥é¡µé¢å·²è¢«åˆ†é…ï¼Œåˆ™å¯¹åº”æ¯”ç‰¹ä½ç½®1ï¼Œå¦ç½®0.</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/DYKkzTCBXlnjb45.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTUvMTM1MDI5ODQ4M18zNTM2LmpwZw"></p><p><strong>è¯·æ±‚è¡¨ï¼š</strong>æ•´ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ªè¯·æ±‚è¡¨ï¼Œæè¿°ç³»ç»Ÿå†…å„ä¸ªè¿›ç¨‹é¡µè¡¨çš„ä½ç½®å’Œå¤§å°ï¼Œç”¨äºåœ°å€è½¬æ¢ä¹Ÿå¯ä»¥ç»“åˆåˆ°å„è¿›ç¨‹çš„PCB(è¿›ç¨‹æ§åˆ¶å—)é‡Œã€‚å¦‚å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/7vXAMBziLPGdDxJ.jpg" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTUvMTM1MDI5ODY5OF8yMzY3LmpwZw"></p><h5 id="åœ°å€å˜æ¢"><a href="#åœ°å€å˜æ¢" class="headerlink" title="åœ°å€å˜æ¢"></a>åœ°å€å˜æ¢</h5><p>åœ¨é¡µå¼ç³»ç»Ÿä¸­ï¼ŒæŒ‡ä»¤æ‰€ç»™å‡ºçš„åœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé€»è¾‘é¡µå·å’Œé¡µå†…åœ°å€ã€‚CPUä¸­çš„å†…å­˜ç®¡ç†å•å…ƒ(MMU)æŒ‰é€»è¾‘é¡µå·é€šè¿‡æŸ¥è¿›ç¨‹é¡µè¡¨å¾—åˆ°ç‰©ç†é¡µæ¡†å·ï¼Œå°†ç‰©ç†é¡µæ¡†å·ä¸é¡µå†…åœ°å€ç›¸åŠ å½¢æˆç‰©ç†åœ°å€ã€‚é€»è¾‘é¡µå·ï¼Œé¡µå†…åç§»åœ°å€ï¼&gt;æŸ¥è¿›ç¨‹é¡µè¡¨ï¼Œå¾—ç‰©ç†é¡µå·ï¼&gt;ç‰©ç†åœ°å€ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/LHryoqOBdNEKk3h.png" alt="aHR0cHM6Ly9pbWctbXkuY3Nkbi5uZXQvdXBsb2Fkcy8yMDEyMTAvMTUvMTM1MDI4MTMyMF85MDk1LnBuZw"></p><p>ä¸Šè¿°è¿‡ç¨‹é€šå¸¸ç”±å¤„ç†å™¨çš„ç¡¬ä»¶ç›´æ¥å®Œæˆï¼Œä¸éœ€è¦è½¯ä»¶å‚ä¸ã€‚é€šå¸¸ï¼Œæ“ä½œç³»ç»Ÿåªéœ€åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼ŒæŠŠè¿›ç¨‹é¡µè¡¨çš„é¦–åœ°å€è£…å…¥å¤„ç†å™¨ç‰¹å®šçš„å¯„å­˜å™¨ä¸­å³å¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé¡µè¡¨å­˜å‚¨åœ¨ä¸»å­˜ä¹‹ä¸­ã€‚è¿™æ ·å¤„ç†å™¨æ¯è®¿é—®ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„æ“ä½œæ•°ï¼Œå°±è¦è®¿é—®ä¸¤æ¬¡å†…å­˜ã€‚</p><p>ç¬¬ä¸€æ¬¡ç”¨æ¥æŸ¥æ‰¾é¡µè¡¨å°†æ“ä½œæ•°çš„é€»è¾‘åœ°å€å˜æ¢ä¸ºç‰©ç†åœ°å€ï¼›</p><p>ç¬¬äºŒæ¬¡å®ŒæˆçœŸæ­£çš„è¯»å†™æ“ä½œã€‚    </p><p>è¿™æ ·åšæ—¶é—´ä¸Šè€—è´¹ä¸¥é‡ã€‚ä¸ºç¼©çŸ­æŸ¥æ‰¾æ—¶é—´ï¼Œå¯ä»¥å°†é¡µè¡¨ä»å†…å­˜è£…å…¥CPUå†…éƒ¨çš„å…³è”å­˜å‚¨å™¨(ä¾‹å¦‚ï¼Œå¿«è¡¨) ä¸­ï¼Œå®ç°æŒ‰å†…å®¹æŸ¥æ‰¾ã€‚æ­¤æ—¶çš„åœ°å€å˜æ¢è¿‡ç¨‹æ˜¯ï¼šåœ¨CPUç»™å‡ºæœ‰æ•ˆåœ°å€åï¼Œç”±åœ°å€å˜æ¢æœºæ„è‡ªåŠ¨å°†é¡µå·é€å…¥å¿«è¡¨ï¼Œå¹¶å°†æ­¤é¡µå·ä¸å¿«è¡¨ä¸­çš„æ‰€æœ‰é¡µå·è¿›è¡Œæ¯”è¾ƒï¼Œè€Œä¸”è¿™ ç§æ¯”è¾ƒæ˜¯åŒæ—¶è¿›è¡Œçš„ã€‚è‹¥å…¶ä¸­æœ‰ä¸æ­¤ç›¸åŒ¹é…çš„é¡µå·ï¼Œè¡¨ç¤ºè¦è®¿é—®çš„é¡µçš„é¡µè¡¨é¡¹åœ¨å¿«è¡¨ä¸­ã€‚äºæ˜¯å¯ç›´æ¥è¯»å‡ºè¯¥é¡µæ‰€å¯¹åº”çš„ç‰©ç†é¡µå·ï¼Œè¿™æ ·å°±æ— éœ€è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ã€‚ç”±äºå…³è”å­˜å‚¨å™¨çš„è®¿é—®é€Ÿåº¦æ¯”å†…å­˜çš„è®¿é—®é€Ÿåº¦å¿«å¾—å¤šã€‚</p><h5 id="å¿«è¡¨"><a href="#å¿«è¡¨" class="headerlink" title="å¿«è¡¨"></a>å¿«è¡¨</h5><p>å¦‚æœé¡µè¡¨å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œåˆ™æ¯æ¬¡è®¿é—®å†…å­˜æ—¶ï¼Œéƒ½è¦å…ˆè®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œç„¶åæ ¹æ®æ‰€å½¢æˆçš„ç‰©ç†åœ°å€å†è®¿é—®å†…å­˜ã€‚è¿™æ ·CPUå­˜ä¸€ä¸ªæ•°æ®å¿…é¡»è®¿é—®ä¸¤æ¬¡å†…å­˜ï¼Œä»è€Œä½¿è®¡ç®—æœºçš„å¤„ç†é€Ÿåº¦é™ä½äº†1/2ã€‚</p><p>ä¸ºäº†æé«˜åœ°å€å˜æ¢çš„é€Ÿåº¦ï¼Œåœ¨åœ°å€å˜æ¢æœºæ„ä¸­å¢è®¾äº†ä¸€ä¸ªå…·æœ‰å¹¶è¡ŒæŸ¥è¯¢åŠŸèƒ½çš„ç‰¹æ®Šçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼Œç§°ä¸ºâ€œè”æƒ³å­˜å‚¨å™¨â€æˆ–â€œå¿«è¡¨â€ï¼Œç”¨ä»¥å­˜æ”¾å½“å‰è®¿é—®çš„é‚£äº›é¡µè¡¨é¡¹ã€‚</p><p>å…¶åœ°å€å˜æ¢è¿‡ç¨‹ï¼š</p><ol><li>CPUç»™å‡ºæœ‰æ•ˆåœ°å€</li><li>åœ°å€å˜æ¢æœºæ„è‡ªåŠ¨åœ°å°†é¡µå·é€å…¥é«˜é€Ÿç¼“å­˜ï¼Œç¡®å®šæ‰€éœ€è¦çš„é¡µæ˜¯å¦åœ¨å¿«è¡¨ä¸­</li><li>è‹¥æ˜¯ï¼Œåˆ™ç›´æ¥è¯»å‡ºè¯¥é¡µæ‰€å¯¹åº”çš„ç‰©ç†å—å·ï¼Œé€å…¥ç‰©ç†åœ°å€å¯„å­˜å™¨</li><li>è‹¥å¿«è¡¨ä¸­æœªæ‰¾åˆ°å¯¹åº”çš„é¡µè¡¨é¡¹ï¼Œåˆ™éœ€å†è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨</li><li>æ‰¾åˆ°åï¼ŒæŠŠä»é¡µè¡¨ä¸­è¯»å‡ºçš„é¡µè¡¨é¡¹å­˜å…¥å¿«è¡¨ä¸­çš„ä¸€ä¸ªå¯„å­˜å™¨å•å…ƒä¸­ï¼Œä»¥å–ä»£ä¸€ä¸ªæ—§çš„é¡µè¡¨é¡¹</li></ol><h5 id="ä¸¤çº§å’Œå¤šçº§é¡µè¡¨"><a href="#ä¸¤çº§å’Œå¤šçº§é¡µè¡¨" class="headerlink" title="ä¸¤çº§å’Œå¤šçº§é¡µè¡¨"></a>ä¸¤çº§å’Œå¤šçº§é¡µè¡¨</h5><p>ä¸»è¦æ˜¯æœ‰çš„æ—¶å€™é¡µè¡¨å¤ªå¤šäº†ï¼Œè¦åŒ–ç®€ã€‚æ ¼å¼ï¼šå¤–å±‚é¡µå·P1+å¤–å±‚é¡µå†…åœ°å€P2+é¡µå†…åœ°å€d</p><p>åŸºæœ¬æ–¹æ³•ï¼šå°†é¡µè¡¨è¿›è¡Œåˆ†é¡µï¼Œæ¯ä¸ªé¡µé¢çš„å¤§å°ä¸å†…å­˜ç‰©ç†å—çš„å¤§å°ç›¸åŒï¼Œå¹¶ä¸ºå®ƒä»¬è¿›è¡Œç¼–å·ï¼Œå¯ä»¥ç¦»æ•£åœ°å°†å„ä¸ªé¡µé¢åˆ†åˆ«å­˜æ”¾åœ¨ä¸åŒçš„ç‰©ç†å—ä¸­ã€‚</p><h5 id="åç½®é¡µè¡¨"><a href="#åç½®é¡µè¡¨" class="headerlink" title="åç½®é¡µè¡¨"></a>åç½®é¡µè¡¨</h5><p>ä¸ºæ¯ä¸€ä¸ªç‰©ç†å—ï¼ˆé¡µæ¡†ï¼‰è®¾ç½®ä¸€ä¸ªé¡µè¡¨é¡¹ï¼Œå¹¶æŒ‰ç‰©ç†å—æ’åºï¼Œå…¶å†…å®¹åˆ™æ˜¯é¡µå·å’Œå…¶æ‰€å±è¿›ç¨‹çš„æ ‡è¯†ã€‚</p><h4 id="æ®µå¼å­˜å‚¨ç®¡ç†"><a href="#æ®µå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="æ®µå¼å­˜å‚¨ç®¡ç†"></a>æ®µå¼å­˜å‚¨ç®¡ç†</h4><p>åœ¨æ®µå¼å­˜å‚¨ç®¡ç†ä¸­ï¼Œå°†ç¨‹åºçš„åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ®µ(segment)ï¼Œè¿™æ ·æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªäºŒç»´çš„åœ°å€ç©ºé—´ã€‚åœ¨å‰é¢æ‰€ä»‹ç»çš„åŠ¨æ€åˆ†åŒºåˆ†é…æ–¹å¼ä¸­ï¼Œç³»ç»Ÿä¸ºæ•´ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚è€Œåœ¨æ®µå¼å­˜å‚¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œåˆ™ä¸ºæ¯ä¸ªæ®µåˆ†é…ä¸€ä¸ªè¿ç»­çš„åˆ†åŒºï¼Œè€Œè¿›ç¨‹ä¸­çš„å„ä¸ªæ®µå¯ä»¥ä¸è¿ç»­åœ°å­˜æ”¾åœ¨å†…å­˜çš„ä¸åŒåˆ†åŒºä¸­ã€‚ç¨‹åºåŠ è½½æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ºæ‰€æœ‰æ®µåˆ†é…å…¶æ‰€éœ€å†…å­˜ï¼Œè¿™äº›æ®µä¸å¿…è¿ç»­ï¼Œç‰©ç†å†…å­˜çš„ç®¡ç†é‡‡ç”¨åŠ¨æ€åˆ†åŒºçš„ç®¡ç†æ–¹æ³•ã€‚</p><p>åœ¨ä¸ºæŸä¸ªæ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶ï¼Œå¯ä»¥é‡‡ç”¨é¦–å…ˆé€‚é…æ³•ã€ä¸‹æ¬¡é€‚é…æ³•ã€æœ€ä½³é€‚é…æ³•ç­‰æ–¹æ³•ã€‚</p><p>åœ¨å›æ”¶æŸä¸ªæ®µæ‰€å ç”¨çš„ç©ºé—´æ—¶ï¼Œè¦æ³¨æ„å°†æ”¶å›çš„ç©ºé—´ä¸å…¶ç›¸é‚»çš„ç©ºé—´åˆå¹¶ã€‚</p><p>æ®µå¼å­˜å‚¨ç®¡ç†ä¹Ÿéœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œå®ç°é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚</p><p>ç¨‹åºé€šè¿‡åˆ†æ®µåˆ’åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œå¦‚ä»£ç æ®µã€æ•°æ®æ®µã€å…±äº«æ®µï¼š</p><ul><li>å¯ä»¥åˆ†åˆ«ç¼–å†™å’Œç¼–è¯‘</li><li>å¯ä»¥é’ˆå¯¹ä¸åŒç±»å‹çš„æ®µé‡‡å–ä¸åŒçš„ä¿æŠ¤</li><li>å¯ä»¥æŒ‰æ®µä¸ºå•ä½æ¥è¿›è¡Œå…±äº«ï¼ŒåŒ…æ‹¬é€šè¿‡åŠ¨æ€é“¾æ¥è¿›è¡Œä»£ç å…±äº«</li></ul><p>è¿™æ ·åšçš„ä¼˜ç‚¹æ˜¯ï¼šå¯ä»¥åˆ†åˆ«ç¼–å†™å’Œç¼–è¯‘æºç¨‹åºçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é’ˆå¯¹ä¸åŒç±»å‹çš„æ®µé‡‡å–ä¸åŒçš„ä¿æŠ¤ï¼Œä¹Ÿå¯ä»¥æŒ‰æ®µä¸ºå•ä½æ¥è¿›è¡Œå…±äº«ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<strong>æ®µå¼å­˜å‚¨ç®¡ç†çš„ä¼˜ç‚¹æ˜¯</strong>ï¼šæ²¡æœ‰å†…ç¢ç‰‡ï¼Œå¤–ç¢ç‰‡å¯ä»¥é€šè¿‡å†…å­˜ç´§ç¼©æ¥æ¶ˆé™¤ï¼›ä¾¿äºå®ç°å†…å­˜å…±äº«ã€‚ç¼ºç‚¹ä¸é¡µå¼å­˜å‚¨ç®¡ç†çš„ç¼ºç‚¹ç›¸åŒï¼Œè¿›ç¨‹å¿…é¡»å…¨éƒ¨è£…å…¥å†…å­˜ã€‚</p><h5 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h5><p>ä¸ºäº†å®ç°æ®µå¼ç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å¦‚ä¸‹çš„æ•°æ®ç»“æ„æ¥å®ç°è¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜ç©ºé—´çš„æ˜ å°„ï¼Œå¹¶è·Ÿè¸ªç‰©ç†å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œä»¥ä¾¿åœ¨è£…å…¥æ–°çš„æ®µçš„æ—¶å€™ï¼Œåˆç†åœ°åˆ†é…å†…å­˜ç©ºé—´ã€‚</p><p><strong>è¿›ç¨‹æ®µè¡¨</strong>ï¼šæè¿°ç»„æˆè¿›ç¨‹åœ°å€ç©ºé—´çš„å„æ®µï¼Œå¯ä»¥æ˜¯æŒ‡å‘ç³»ç»Ÿæ®µè¡¨ä¸­è¡¨é¡¹çš„ç´¢å¼•ã€‚æ¯æ®µæœ‰æ®µåŸºå€(baseaddress)ï¼Œå³æ®µå†…åœ°å€ã€‚åœ¨ç³»ç»Ÿä¸­ä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ æ®µæ˜ å°„è¡¨ï¼Œå¦‚å›¾ï¼š</p><p>â€‹     <img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/uFYaBxo7hv36qer.jpg" alt="img"></p><p><strong>ç³»ç»Ÿæ®µè¡¨</strong>ï¼šç³»ç»Ÿæ‰€æœ‰å ç”¨æ®µï¼ˆå·²ç»åˆ†é…çš„æ®µï¼‰ã€‚</p><p><strong>ç©ºé—²æ®µè¡¨</strong>ï¼šå†…å­˜ä¸­æ‰€æœ‰ç©ºé—²æ®µï¼Œå¯ä»¥ç»“åˆåˆ°ç³»ç»Ÿæ®µè¡¨ä¸­ã€‚</p><h5 id="åœ°å€å˜æ¢-1"><a href="#åœ°å€å˜æ¢-1" class="headerlink" title="åœ°å€å˜æ¢"></a>åœ°å€å˜æ¢</h5><p>â€‹    <img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/rEelMt4JRhT8jyW.png" alt="img"></p><p>åœ¨æ®µå¼ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜¯äºŒç»´çš„ï¼Œå³å…¶é€»è¾‘åœ°å€ç”±æ®µå·å’Œæ®µå†…åœ°å€ä¸¤éƒ¨åˆ†ç»„æˆã€‚ä¸ºäº†å®Œæˆè¿›ç¨‹é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œå¤„ç†å™¨ä¼šæŸ¥æ‰¾å†…å­˜ä¸­çš„æ®µè¡¨ï¼Œç”±æ®µå·å¾—åˆ°æ®µçš„é¦–åœ°å€ï¼ŒåŠ ä¸Šæ®µå†…åœ°å€ï¼Œå¾—åˆ°å®é™…çš„ç‰©ç†åœ°å€ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯ç”±å¤„ç†å™¨çš„ç¡¬ä»¶ç›´æ¥å®Œæˆçš„ï¼Œæ“ä½œç³»ç»Ÿåªéœ€åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œå°†è¿›ç¨‹æ®µè¡¨çš„é¦–åœ°å€è£…å…¥å¤„ç†å™¨çš„ç‰¹å®šå¯„å­˜å™¨å½“ä¸­ã€‚è¿™ä¸ªå¯„å­˜å™¨ä¸€èˆ¬è¢«ç§°ä½œæ®µè¡¨åœ°å€å¯„å­˜å™¨ã€‚</p><h4 id="é¡µå¼å’Œæ®µå¼çš„åŒºåˆ«"><a href="#é¡µå¼å’Œæ®µå¼çš„åŒºåˆ«" class="headerlink" title="é¡µå¼å’Œæ®µå¼çš„åŒºåˆ«"></a>é¡µå¼å’Œæ®µå¼çš„åŒºåˆ«</h4><p>é¡µå¼å’Œæ®µå¼ç³»ç»Ÿæœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚æ¯”å¦‚ï¼Œä¸¤è€…éƒ½é‡‡ç”¨ç¦»æ•£åˆ†é…æ–¹å¼ï¼Œä¸”éƒ½é€šè¿‡åœ°å€æ˜ å°„æœºæ„æ¥å®ç°åœ°å€å˜æ¢ã€‚ä½†æ¦‚å¿µä¸Šä¸¤è€…ä¹Ÿæœ‰å¾ˆå¤šåŒºåˆ«ï¼Œä¸»è¦è¡¨ç°åœ¨ï¼š</p><ol><li>éœ€æ±‚ï¼šæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼Œåˆ†é¡µæ˜¯ä¸ºäº†å®ç°ç¦»æ•£åˆ†é…æ–¹å¼ï¼Œä»¥å‡å°‘å†…å­˜çš„ç¢ç‰‡ï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨ç‡ã€‚æˆ–è€…è¯´ï¼Œåˆ†é¡µä»…ä»…æ˜¯ç”±äºç³»ç»Ÿç®¡ç†çš„éœ€è¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·çš„éœ€è¦ã€‚æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œå®ƒå«æœ‰ä¸€ç»„å…¶æ„ä¹‰ç›¸å¯¹å®Œæ•´çš„ä¿¡æ¯ã€‚åˆ†æ®µçš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„éœ€è¦ã€‚</li><li>ä¸€æ¡æŒ‡ä»¤æˆ–ä¸€ä¸ªæ“ä½œæ•°å¯èƒ½ä¼šè·¨è¶Šä¸¤ä¸ªé¡µçš„åˆ†ç•Œå¤„ï¼Œè€Œä¸ä¼šè·¨è¶Šä¸¤ä¸ªæ®µçš„åˆ†ç•Œå¤„ã€‚</li><li>å¤§å°ï¼šé¡µå¤§å°å›ºå®šä¸”ç”±ç³»ç»Ÿå†³å®šï¼ŒæŠŠé€»è¾‘åœ°å€åˆ’åˆ†ä¸ºé¡µå·å’Œé¡µå†…åœ°å€ä¸¤éƒ¨åˆ†ï¼Œæ˜¯ç”±æœºå™¨ç¡¬ä»¶å®ç°çš„ã€‚æ®µçš„é•¿åº¦ä¸å›ºå®šï¼Œä¸”å†³å®šäºç”¨æˆ·æ‰€ç¼–å†™çš„ç¨‹åºï¼Œé€šå¸¸ç”±ç¼–è¯‘ç³»ç»Ÿåœ¨å¯¹æºç¨‹åºè¿›è¡Œç¼–è¯‘æ—¶æ ¹æ®ä¿¡æ¯çš„æ€§è´¨æ¥åˆ’åˆ†ã€‚</li><li>é€»è¾‘åœ°å€è¡¨ç¤ºï¼šé¡µå¼ç³»ç»Ÿåœ°å€ç©ºé—´æ˜¯ä¸€ç»´çš„ï¼Œå³å•ä¸€çš„çº¿æ€§åœ°å€ç©ºé—´ï¼Œç¨‹åºå‘˜åªéœ€åˆ©ç”¨ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå³å¯è¡¨ç¤ºä¸€ä¸ªåœ°å€ã€‚åˆ†æ®µçš„ä½œä¸šåœ°å€ç©ºé—´æ˜¯äºŒç»´çš„ï¼Œç¨‹åºå‘˜åœ¨æ ‡è¯†ä¸€ä¸ªåœ°å€æ—¶ï¼Œæ—¢éœ€ç»™å‡ºæ®µåï¼Œåˆéœ€ç»™å‡ºæ®µå†…åœ°å€ã€‚</li><li>æ¯”é¡µå¤§ï¼Œå› è€Œæ®µè¡¨æ¯”é¡µè¡¨çŸ­ï¼Œå¯ä»¥ç¼©çŸ­æŸ¥æ‰¾æ—¶é—´ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</li></ol><h4 id="æ®µé¡µå¼å­˜å‚¨ç®¡ç†"><a href="#æ®µé¡µå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="æ®µé¡µå¼å­˜å‚¨ç®¡ç†"></a>æ®µé¡µå¼å­˜å‚¨ç®¡ç†</h4><p><strong>é¡µå¼å­˜å‚¨ç®¡ç†èƒ½æœ‰æ•ˆåœ°æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè€Œåˆ†æ®µå­˜å‚¨ç®¡ç†èƒ½åæ˜ ç¨‹åºçš„é€»è¾‘ç»“æ„å¹¶æœ‰åˆ©äºæ®µçš„å…±äº«</strong>ã€‚å¦‚æœå°†è¿™ä¸¤ç§å­˜å‚¨ç®¡ç†æ–¹æ³•ç»“åˆèµ·æ¥ï¼Œå°±å½¢æˆäº†æ®µé¡µå¼å­˜å‚¨ç®¡ç†æ–¹å¼ã€‚æ®µé¡µå¼ç®¡ç†å°±æ˜¯<strong>å°†ç¨‹åºåˆ†ä¸ºå¤šä¸ªé€»è¾‘æ®µï¼Œåœ¨æ¯ä¸ªæ®µé‡Œé¢åˆè¿›è¡Œåˆ†é¡µï¼Œå³å°†åˆ†æ®µå’Œåˆ†é¡µç»„åˆèµ·æ¥ä½¿ç”¨</strong>ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯æƒ³åŒæ—¶è·å¾—åˆ†æ®µå’Œåˆ†é¡µçš„å¥½å¤„ï¼Œä½†åˆé¿å…äº†å•ç‹¬åˆ†æ®µæˆ–å•ç‹¬åˆ†é¡µçš„ç¼ºé™·ã€‚å¦‚æœæˆ‘ä»¬å°†æ¯ä¸ªæ®µçœ‹åšä¸€ä¸ªå•ç‹¬çš„ç¨‹åºï¼Œåˆ™é€»è¾‘åˆ†æ®µå°±ç›¸å½“äºåŒæ—¶åŠ è½½å¤šä¸ªç¨‹åºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/JXQL5gPaymSxYCs.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="æ•°æ®ç»“æ„-2"><a href="#æ•°æ®ç»“æ„-2" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h5><p>åœ¨æ®µé¡µå¼ç³»ç»Ÿä¸­ï¼Œä½œä¸šçš„é€»è¾‘åœ°å€åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ®µå·ã€é¡µå·å’Œé¡µå†…åç§»é‡ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/VUKg5aXRm9ZqcG6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="åœ°å€å˜æ¢-2"><a href="#åœ°å€å˜æ¢-2" class="headerlink" title="åœ°å€å˜æ¢"></a>åœ°å€å˜æ¢</h5><p><strong>ä¸ºäº†å®ç°åœ°å€å˜æ¢ï¼Œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ æ®µè¡¨ï¼Œè€Œæ¯ä¸ªåˆ†æ®µæœ‰ä¸€å¼ é¡µè¡¨ï¼ˆåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ®µè¡¨åªæœ‰ä¸€ä¸ªï¼Œè€Œé¡µè¡¨å¯èƒ½æœ‰å¤šä¸ªï¼‰</strong>ã€‚æ®µè¡¨è¡¨é¡¹ä¸­è‡³å°‘åŒ…æ‹¬æ®µå·ã€é¡µè¡¨é•¿åº¦å’Œé¡µè¡¨èµ·å§‹åœ°å€ï¼Œé¡µè¡¨è¡¨é¡¹ä¸­è‡³å°‘åŒ…æ‹¬é¡µå·å’Œå—å·ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿä¸­è¿˜åº”æœ‰ä¸€ä¸ªæ®µè¡¨å¯„å­˜å™¨ï¼ŒæŒ‡å‡ºä½œä¸šçš„æ®µè¡¨èµ·å§‹åœ°å€å’Œæ®µè¡¨é•¿åº¦ã€‚</p><p>åœ¨è¿›è¡Œåœ°å€å˜æ¢æ—¶ï¼Œé¦–å…ˆé€šè¿‡<strong>æ®µè¡¨æŸ¥åˆ°é¡µè¡¨èµ·å§‹åœ°å€ï¼Œç„¶åé€šè¿‡é¡µè¡¨æ‰¾åˆ°é¡µå¸§å·ï¼Œæœ€åå½¢æˆç‰©ç†åœ°å€</strong>ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¿›è¡Œä¸€æ¬¡è®¿é—®å®é™…éœ€è¦ä¸‰æ¬¡è®¿é—®ä¸»å­˜ï¼Œè¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨å¿«è¡¨ä»¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ï¼Œå…¶å…³é”®å­—ç”±æ®µå·ã€é¡µå·ç»„æˆï¼Œå€¼æ˜¯å¯¹åº”çš„é¡µå¸§å·å’Œä¿æŠ¤ç ã€‚<br><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/1E2kzDQFg6wscxe.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨æ®µé¡µå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†è·å¾—ä¸€æ¡æŒ‡ä»¤æˆ–æ•°æ®ï¼Œéœ€ä¸‰æ¬¡è®¿é—®å†…å­˜ï¼šç¬¬ä¸€æ¬¡è®¿é—®å†…å­˜ä¸­çš„æ®µè¡¨ï¼Œä»ä¸­å–å¾—é¡µè¡¨å§‹å€ï¼›ç¬¬äºŒæ¬¡è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œä»ä¸­å–å‡ºè¯¥é¡µæ‰€åœ¨çš„ç‰©ç†å—å·ï¼Œå¹¶å°†è¯¥å—å·ä¸é¡µå†…åœ°å€ä¸€èµ·å½¢æˆæŒ‡ä»¤æˆ–æ•°æ®çš„ç‰©ç†åœ°å€ï¼›ç¬¬ä¸‰æ¬¡è®¿é—®æ‰æ˜¯çœŸæ­£æ ¹æ®æ‰€å¾—çš„ç‰©ç†åœ°å€å–å‡ºæŒ‡ä»¤æˆ–æ•°æ®ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/25/euGV9ATN6PqyDQW.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…å­˜çš„å·¥ä½œåŸç†</title>
      <link href="/2017/10/11/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E4%B9%8B%E5%86%85%E5%AD%98/"/>
      <url>/2017/10/11/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E4%B9%8B%E5%86%85%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<p>æŠŠCPUä½œä¸ºå¤§è„‘çš„è¯ï¼ŒCPUç¼“å­˜æ˜¯äººçš„ç¬æ—¶è®°å¿†ï¼Œå†…å­˜æ˜¯äººçš„çŸ­æ—¶è®°å¿†ï¼Œç£ç›˜æ˜¯äººçš„é•¿æ—¶è®°å¿†ã€‚é‚£ä¹ˆCPUå¦‚ä½•ä¸å†…å­˜äº¤äº’?</p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯å†…å­˜"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜"></a>ä»€ä¹ˆæ˜¯å†…å­˜</h3><p>å†…å­˜ï¼ˆMemoryï¼‰æ˜¯è®¡ç®—æœºä¸­æœ€é‡è¦çš„éƒ¨ä»¶ä¹‹ä¸€ï¼Œå®ƒæ˜¯ç¨‹åºä¸CPUè¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢ã€‚è®¡ç®—æœºä¸­æ‰€æœ‰ç¨‹åºçš„è¿è¡Œéƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤å†…å­˜å¯¹è®¡ç®—æœºçš„å½±å“éå¸¸å¤§ï¼Œå†…å­˜åˆè¢«ç§°ä¸º<code>ä¸»å­˜</code>ï¼Œå…¶ä½œç”¨æ˜¯å­˜æ”¾ CPU ä¸­çš„è¿ç®—æ•°æ®ï¼Œä»¥åŠä¸ç¡¬ç›˜ç­‰å¤–éƒ¨å­˜å‚¨è®¾å¤‡äº¤æ¢çš„æ•°æ®ã€‚åªè¦è®¡ç®—æœºåœ¨è¿è¡Œä¸­ï¼ŒCPU å°±ä¼šæŠŠéœ€è¦è¿ç®—çš„æ•°æ®è°ƒåˆ°ä¸»å­˜ä¸­è¿›è¡Œè¿ç®—ï¼Œå½“è¿ç®—å®ŒæˆåCPUå†å°†ç»“æœä¼ é€å‡ºæ¥ï¼Œä¸»å­˜çš„è¿è¡Œä¹Ÿå†³å®šäº†è®¡ç®—æœºçš„ç¨³å®šè¿è¡Œã€‚</p><p>å†…å­˜æ˜¯æ˜“å¤±æ€§å­˜å‚¨ï¼Œä¸ç£ç›˜ä¸åŒï¼Œæ‰ç”µåˆ™å¤±å»æ‰€æœ‰æ•°æ®ã€‚</p><h3 id="å†…å­˜çš„ç‰©ç†ç»“æ„"><a href="#å†…å­˜çš„ç‰©ç†ç»“æ„" class="headerlink" title="å†…å­˜çš„ç‰©ç†ç»“æ„"></a>å†…å­˜çš„ç‰©ç†ç»“æ„</h3><p>å†…å­˜çš„å†…éƒ¨æ˜¯ç”±å„ç§ IC ç”µè·¯ç»„æˆçš„ï¼Œå®ƒçš„ç§ç±»å¾ˆåºå¤§ï¼Œä½†æ˜¯å…¶ä¸»è¦åˆ†ä¸ºä¸‰ç§å­˜å‚¨å™¨</p><ul><li>éšæœºå­˜å‚¨å™¨ï¼ˆRAMï¼‰ï¼š å†…å­˜ä¸­æœ€é‡è¦çš„ä¸€ç§ï¼Œè¡¨ç¤ºæ—¢å¯ä»¥ä»ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ã€‚å½“æœºå™¨å…³é—­æ—¶ï¼Œå†…å­˜ä¸­çš„ä¿¡æ¯ä¼š <code>ä¸¢å¤±</code>ã€‚</li><li>åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ï¼šROM ä¸€èˆ¬åªèƒ½ç”¨äºæ•°æ®çš„è¯»å–ï¼Œä¸èƒ½å†™å…¥æ•°æ®ï¼Œä½†æ˜¯å½“æœºå™¨åœç”µæ—¶ï¼Œè¿™äº›æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</li><li>é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰ï¼šCache ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸è§åˆ°çš„ï¼Œå®ƒåˆ†ä¸ºä¸€çº§ç¼“å­˜ï¼ˆL1 Cacheï¼‰ã€äºŒçº§ç¼“å­˜ï¼ˆL2 Cacheï¼‰ã€ä¸‰çº§ç¼“å­˜ï¼ˆL3 Cacheï¼‰è¿™äº›æ•°æ®ï¼Œå®ƒä½äºå†…å­˜å’Œ CPU ä¹‹é—´ï¼Œæ˜¯ä¸€ä¸ªè¯»å†™é€Ÿåº¦æ¯”å†…å­˜<code>æ›´å¿«</code>çš„å­˜å‚¨å™¨ã€‚å½“ CPU å‘å†…å­˜å†™å…¥æ•°æ®æ—¶ï¼Œè¿™äº›æ•°æ®ä¹Ÿä¼šè¢«å†™å…¥é«˜é€Ÿç¼“å­˜ä¸­ã€‚å½“ CPU éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œä¼šç›´æ¥ä»é«˜é€Ÿç¼“å­˜ä¸­ç›´æ¥è¯»å–ï¼Œå½“ç„¶ï¼Œå¦‚éœ€è¦çš„æ•°æ®åœ¨Cacheä¸­æ²¡æœ‰ï¼ŒCPUä¼šå†å»è¯»å–å†…å­˜ä¸­çš„æ•°æ®ã€‚</li></ul><p>å†…å­˜ IC æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç»“æ„ï¼Œå®ƒå†…éƒ¨ä¹Ÿæœ‰ç”µæºã€åœ°å€ä¿¡å·ã€æ•°æ®ä¿¡å·ã€æ§åˆ¶ä¿¡å·å’Œç”¨äºå¯»å€çš„ IC å¼•è„šæ¥è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ IC å¼•è„šç¤ºæ„å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/Lch5xOsutFeQYB9.jpg" alt="ç‰©ç†æ¨¡å‹"></p><p>å›¾ä¸­ VCC å’Œ GND è¡¨ç¤ºç”µæºï¼ŒA0 - A9 æ˜¯åœ°å€ä¿¡å·çš„å¼•è„šï¼ŒD0 - D7 è¡¨ç¤ºçš„æ˜¯æ§åˆ¶ä¿¡å·ã€RD å’Œ WR éƒ½æ˜¯å¥½æ§åˆ¶ä¿¡å·ï¼Œæˆ‘ç”¨ä¸åŒçš„é¢œè‰²è¿›è¡Œäº†åŒºåˆ†ï¼Œå°†ç”µæºè¿æ¥åˆ° VCC å’Œ GND åï¼Œå°±å¯ä»¥å¯¹å…¶ä»–å¼•è„šä¼ é€’ 0 å’Œ 1 çš„ä¿¡å·ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<strong>+5V è¡¨ç¤º1ï¼Œ0V è¡¨ç¤º 0</strong>ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“å†…å­˜æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªå†…å­˜ IC ä¸­èƒ½å­˜å‚¨å¤šå°‘æ•°æ®å‘¢ï¼ŸD0 - D7 è¡¨ç¤ºçš„æ˜¯æ•°æ®ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ¬¡å¯ä»¥è¾“å…¥è¾“å‡º 8 bit = 1 byte çš„æ•°æ®ã€‚A0 - A9 æ˜¯åœ°å€ä¿¡å·å…±åä¸ªï¼Œè¡¨ç¤ºå¯ä»¥æŒ‡å®š 00000 00000 - 11111 11111 å…± 2 çš„ 10æ¬¡æ–¹ = <code>1024ä¸ªåœ°å€</code>ã€‚æ¯ä¸ªåœ°å€éƒ½ä¼šå­˜æ”¾ 1 byte çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºå†…å­˜ IC çš„å®¹é‡å°±æ˜¯ 1 KBã€‚</p><h3 id="å†…å­˜çš„è¯»å†™è¿‡ç¨‹"><a href="#å†…å­˜çš„è¯»å†™è¿‡ç¨‹" class="headerlink" title="å†…å­˜çš„è¯»å†™è¿‡ç¨‹"></a>å†…å­˜çš„è¯»å†™è¿‡ç¨‹</h3><p>è®©æˆ‘ä»¬æŠŠå…³æ³¨ç‚¹æ”¾åœ¨å†…å­˜ IC å¯¹æ•°æ®çš„è¯»å†™è¿‡ç¨‹ä¸Šæ¥å§ï¼æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¯¹å†…å­˜IC è¿›è¡Œæ•°æ®å†™å…¥å’Œè¯»å–çš„æ¨¡å‹</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/u1vzTSMIFcqfehA.jpg" alt="è¯»å†™è¿‡ç¨‹"></p><p>æ¥è¯¦ç»†æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œå‡è®¾æˆ‘ä»¬è¦å‘å†…å­˜ IC ä¸­å†™å…¥ 1byte çš„æ•°æ®çš„è¯ï¼Œå®ƒçš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é¦–å…ˆç»™ VCC æ¥é€š +5V çš„ç”µæºï¼Œç»™ GND æ¥é€š 0V çš„ç”µæºï¼Œä½¿ç”¨ <code>A0 - A9</code> æ¥æŒ‡å®šæ•°æ®çš„å­˜å‚¨åœºæ‰€ï¼Œç„¶åå†æŠŠæ•°æ®çš„å€¼è¾“å…¥ç»™ <code>D0 - D7</code> çš„æ•°æ®ä¿¡å·ï¼Œå¹¶æŠŠ <code>WRï¼ˆwriteï¼‰</code>çš„å€¼ç½®ä¸º 1ï¼Œæ‰§è¡Œå®Œè¿™äº›æ“ä½œåï¼Œå³å¯ä»¥å‘å†…å­˜ IC å†™å…¥æ•°æ®</li><li>è¯»å‡ºæ•°æ®æ—¶ï¼Œåªéœ€è¦é€šè¿‡ A0 - A9 çš„åœ°å€ä¿¡å·æŒ‡å®šæ•°æ®çš„å­˜å‚¨åœºæ‰€ï¼Œç„¶åå†å°† RD çš„å€¼ç½®ä¸º 1 å³å¯ã€‚</li><li>å›¾ä¸­çš„ RD å’Œ WR åˆè¢«ç§°ä¸ºæ§åˆ¶ä¿¡å·ã€‚å…¶ä¸­å½“WR å’Œ RD éƒ½ä¸º 0 æ—¶ï¼Œæ— æ³•è¿›è¡Œå†™å…¥å’Œè¯»å–æ“ä½œã€‚</li></ul><h3 id="å†…å­˜çš„ç°å®æ¨¡å‹"><a href="#å†…å­˜çš„ç°å®æ¨¡å‹" class="headerlink" title="å†…å­˜çš„ç°å®æ¨¡å‹"></a>å†…å­˜çš„ç°å®æ¨¡å‹</h3><p>ä¸ºäº†ä¾¿äºè®°å¿†ï¼Œæˆ‘ä»¬æŠŠå†…å­˜æ¨¡å‹æ˜ å°„æˆä¸ºæˆ‘ä»¬ç°å®ä¸–ç•Œçš„æ¨¡å‹ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå†…å­˜çš„æ¨¡å‹å¾ˆæƒ³æˆ‘ä»¬ç”Ÿæ´»çš„æ¥¼æˆ¿ã€‚åœ¨è¿™ä¸ªæ¥¼æˆ¿ä¸­ï¼Œ1å±‚å¯ä»¥å­˜å‚¨ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œæ¥¼å±‚å·å°±æ˜¯<code>åœ°å€</code>ï¼Œä¸‹é¢æ˜¯å†…å­˜å’Œæ¥¼å±‚æ•´åˆçš„æ¨¡å‹å›¾</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/wy5ebZ4inc3QAHh.jpg" alt="å†…å­˜æ¨¡å‹"></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œç¨‹åºä¸­çš„æ•°æ®ä¸ä»…åªæœ‰æ•°å€¼ï¼Œè¿˜æœ‰<code>æ•°æ®ç±»å‹</code>çš„æ¦‚å¿µï¼Œä»å†…å­˜ä¸Šæ¥çœ‹ï¼Œå°±æ˜¯å ç”¨å†…å­˜å¤§å°ï¼ˆå ç”¨æ¥¼å±‚æ•°ï¼‰çš„æ„æ€ã€‚å³ä½¿ç‰©ç†ä¸Šå¼ºåˆ¶ä»¥ 1 ä¸ªå­—èŠ‚ä¸ºå•ä½æ¥é€ä¸€è¯»å†™æ•°æ®çš„å†…å­˜ï¼Œåœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡æŒ‡å®šå…¶æ•°æ®ç±»å‹ï¼Œä¹Ÿèƒ½å®ç°ä»¥ç‰¹å®šå­—èŠ‚æ•°ä¸ºå•ä½æ¥è¿›è¡Œè¯»å†™ã€‚ã€</p><h3 id="å†…å­˜ä¸ç£ç›˜çš„å…³ç³»"><a href="#å†…å­˜ä¸ç£ç›˜çš„å…³ç³»" class="headerlink" title="å†…å­˜ä¸ç£ç›˜çš„å…³ç³»"></a>å†…å­˜ä¸ç£ç›˜çš„å…³ç³»</h3><p>è®¡ç®—æœºæœ€ä¸»è¦çš„å­˜å‚¨éƒ¨ä»¶æ˜¯å†…å­˜å’Œç£ç›˜ã€‚<strong>ç£ç›˜ä¸­å­˜å‚¨çš„ç¨‹åºå¿…é¡»åŠ è½½åˆ°å†…å­˜ä¸­æ‰èƒ½è¿è¡Œ</strong>ï¼Œåœ¨ç£ç›˜ä¸­ä¿å­˜çš„ç¨‹åºæ˜¯æ— æ³•ç›´æ¥è¿è¡Œçš„ï¼Œè¿™æ˜¯å› ä¸ºè´Ÿè´£è§£æå’Œè¿è¡Œç¨‹åºå†…å®¹çš„ CPU æ˜¯éœ€è¦é€šè¿‡ç¨‹åºè®¡æ•°å™¨æ¥æŒ‡å®šå†…å­˜åœ°å€ä»è€Œè¯»å‡ºç¨‹åºæŒ‡ä»¤çš„ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/lPBhsc7DZFxkMzC.jpg" alt="1ae073cb-2a7f-4404-8f8a-681fed48f2c3"></p><h3 id="ç£ç›˜ç¼“å­˜"><a href="#ç£ç›˜ç¼“å­˜" class="headerlink" title="ç£ç›˜ç¼“å­˜"></a>ç£ç›˜ç¼“å­˜</h3><p>æˆ‘ä»¬ä¸Šé¢æåˆ°ï¼Œç£ç›˜å¾€å¾€å’Œå†…å­˜æ˜¯äº’åˆ©å…±ç”Ÿçš„å…³ç³»ï¼Œç›¸äº’åä½œï¼Œå½¼æ­¤æŒæœ‰è‰¯å¥½çš„åˆä½œå…³ç³»ã€‚æ¯æ¬¡å†…å­˜éƒ½éœ€è¦ä»ç£ç›˜ä¸­è¯»å–æ•°æ®ï¼Œå¿…ç„¶ä¼šè¯»åˆ°ç›¸åŒçš„å†…å®¹ï¼Œæ‰€ä»¥ä¸€å®šä¼šæœ‰ä¸€ä¸ªè§’è‰²è´Ÿè´£å­˜å‚¨æˆ‘ä»¬ç»å¸¸éœ€è¦è¯»åˆ°çš„å†…å®¹ã€‚ æˆ‘ä»¬å¤§å®¶åšè½¯ä»¶çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°<code>ç¼“å­˜æŠ€æœ¯</code>ï¼Œé‚£ä¹ˆç¡¬ä»¶å±‚é¢ä¹Ÿä¸ä¾‹å¤–ï¼Œç£ç›˜ä¹Ÿæœ‰ç¼“å­˜ï¼Œç£ç›˜çš„ç¼“å­˜å«åš<code>ç£ç›˜ç¼“å­˜</code>ã€‚</p><p>ç£ç›˜ç¼“å­˜æŒ‡çš„æ˜¯æŠŠä»ç£ç›˜ä¸­è¯»å‡ºçš„æ•°æ®å­˜å‚¨åˆ°å†…å­˜çš„æ–¹å¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“æ¥ä¸‹æ¥éœ€è¦è¯»å–ç›¸åŒçš„å†…å®¹æ—¶ï¼Œå°±ä¸ä¼šå†é€šè¿‡å®é™…çš„ç£ç›˜ï¼Œè€Œæ˜¯é€šè¿‡ç£ç›˜ç¼“å­˜æ¥è¯»å–ã€‚æŸä¸€ç§æŠ€æœ¯æˆ–è€…æ¡†æ¶çš„å‡ºç°åŠ¿å¿…è¦è§£å†³æŸç§é—®é¢˜çš„ï¼Œé‚£ä¹ˆç£ç›˜ç¼“å­˜å°±å¤§å¤§<strong>æ”¹å–„äº†ç£ç›˜è®¿é—®çš„é€Ÿåº¦</strong>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/nv6VdCAOwjXh3W1.jpg" alt="3cfa9bac-5a56-44ed-b3f9-49db0d00b005"></p><h3 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h3><p>è™šæ‹Ÿå†…å­˜çš„ç›®çš„æ˜¯ä¸ºäº†è®©ç‰©ç†å†…å­˜æ‰©å……æˆæ›´å¤§çš„é€»è¾‘å†…å­˜ï¼Œä»è€Œè®©ç¨‹åºè·å¾—æ›´å¤šçš„å¯ç”¨å†…å­˜ã€‚å®ƒæ˜¯å†…å­˜å’Œç£ç›˜äº¤äº’çš„ç¬¬äºŒä¸ªåª’ä»‹ã€‚è™šæ‹Ÿå†…å­˜æ˜¯æŒ‡æŠŠç£ç›˜çš„ä¸€éƒ¨åˆ†ä½œä¸º<code>å‡æƒ³å†…å­˜</code>æ¥ä½¿ç”¨ã€‚è¿™ä¸ç£ç›˜ç¼“å­˜æ˜¯å‡æƒ³çš„ç£ç›˜ï¼ˆå®é™…ä¸Šæ˜¯å†…å­˜ï¼‰ç›¸å¯¹ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯å‡æƒ³çš„å†…å­˜ï¼ˆå®é™…ä¸Šæ˜¯ç£ç›˜ï¼‰ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿå°†å†…å­˜æŠ½è±¡æˆåœ°å€ç©ºé—´ã€‚æ¯ä¸ªç¨‹åºæ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´è¢«åˆ†å‰²æˆå¤šä¸ªå—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µã€‚è¿™äº›é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä½†ä¸éœ€è¦æ˜ å°„åˆ°è¿ç»­çš„ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸éœ€è¦æ‰€æœ‰é¡µéƒ½å¿…é¡»åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚å½“ç¨‹åºå¼•ç”¨åˆ°ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„é¡µæ—¶ï¼Œç”±ç¡¬ä»¶æ‰§è¡Œå¿…è¦çš„æ˜ å°„ï¼Œå°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚</p><p>ä»ä¸Šé¢çš„æè¿°ä¸­å¯ä»¥çœ‹å‡ºï¼Œè™šæ‹Ÿå†…å­˜å…è®¸ç¨‹åºä¸ç”¨å°†åœ°å€ç©ºé—´ä¸­çš„æ¯ä¸€é¡µéƒ½æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç¨‹åºä¸éœ€è¦å…¨éƒ¨è°ƒå…¥å†…å­˜å°±å¯ä»¥è¿è¡Œï¼Œè¿™ä½¿å¾—æœ‰é™çš„å†…å­˜è¿è¡Œå¤§ç¨‹åºæˆä¸ºå¯èƒ½ã€‚ä¾‹å¦‚æœ‰ä¸€å°è®¡ç®—æœºå¯ä»¥äº§ç”Ÿ 16 ä½åœ°å€ï¼Œé‚£ä¹ˆä¸€ä¸ªç¨‹åºçš„åœ°å€ç©ºé—´èŒƒå›´æ˜¯ 0~64Kã€‚è¯¥è®¡ç®—æœºåªæœ‰ 32KB çš„ç‰©ç†å†…å­˜ï¼Œè™šæ‹Ÿå†…å­˜æŠ€æœ¯å…è®¸è¯¥è®¡ç®—æœºè¿è¡Œä¸€ä¸ª 64K å¤§å°çš„ç¨‹åºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/c3j2rNJyp5xvaq1.png" alt="è™šæ‹Ÿåœ°å€æ˜ å°„"></p><h4 id="è™šæ‹Ÿå†…å­˜ä¸å†…å­˜çš„äº¤æ¢æ–¹å¼"><a href="#è™šæ‹Ÿå†…å­˜ä¸å†…å­˜çš„äº¤æ¢æ–¹å¼" class="headerlink" title="è™šæ‹Ÿå†…å­˜ä¸å†…å­˜çš„äº¤æ¢æ–¹å¼"></a>è™šæ‹Ÿå†…å­˜ä¸å†…å­˜çš„äº¤æ¢æ–¹å¼</h4><p>è™šæ‹Ÿå†…å­˜çš„æ–¹æ³•æœ‰<code>åˆ†é¡µå¼</code> å’Œ <code>åˆ†æ®µå¼</code> ä¸¤ç§ã€‚Windows é‡‡ç”¨çš„æ˜¯åˆ†é¡µå¼ã€‚è¯¥æ–¹å¼æ˜¯æŒ‡åœ¨ä¸è€ƒè™‘ç¨‹åºæ„é€ çš„æƒ…å†µä¸‹ï¼ŒæŠŠè¿è¡Œçš„ç¨‹åºæŒ‰ç…§ä¸€å®šå¤§å°çš„é¡µè¿›è¡Œåˆ†å‰²ï¼Œå¹¶ä»¥<code>é¡µ</code>ä¸ºå•ä½è¿›è¡Œç½®æ¢ã€‚åœ¨åˆ†é¡µå¼ä¸­ï¼Œæˆ‘ä»¬æŠŠç£ç›˜çš„å†…å®¹è¯»åˆ°å†…å­˜ä¸­ç§°ä¸º <code>Page In</code>ï¼ŒæŠŠå†…å­˜çš„å†…å®¹å†™å…¥ç£ç›˜ç§°ä¸º <code>Page Out</code>ã€‚Windows è®¡ç®—æœºçš„é¡µå¤§å°ä¸º 4KB ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦æŠŠåº”ç”¨ç¨‹åºæŒ‰ç…§ 4KB çš„é¡µæ¥è¿›è¡Œåˆ‡åˆ†ï¼Œä»¥é¡µï¼ˆpageï¼‰ä¸ºå•ä½æ”¾åˆ°ç£ç›˜ä¸­ï¼Œç„¶åè¿›è¡Œç½®æ¢ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/tJE5glHcFyeYjUO.jpg" alt="60a51c98-4dbd-4813-a3a3-172c159f2174"> </p><p>ä¸ºäº†å®ç°å†…å­˜åŠŸèƒ½ï¼ŒWindows åœ¨ç£ç›˜ä¸Šæä¾›äº†è™šæ‹Ÿå†…å­˜ä½¿ç”¨çš„æ–‡ä»¶ï¼ˆpage fileï¼Œé¡µæ–‡ä»¶ï¼‰ã€‚è¯¥æ–‡ä»¶ç”± Windows ç”Ÿæˆå’Œç®¡ç†ï¼Œæ–‡ä»¶çš„å¤§å°å’Œè™šæ‹Ÿå†…å­˜å¤§å°ç›¸åŒï¼Œé€šå¸¸å¤§å°æ˜¯å†…å­˜çš„ 1 - 2 å€ã€‚</p><h4 id="åœ°å€æ˜ å°„"><a href="#åœ°å€æ˜ å°„" class="headerlink" title="åœ°å€æ˜ å°„"></a>åœ°å€æ˜ å°„</h4><p>å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ç®¡ç†ç€åœ°å€ç©ºé—´å’Œç‰©ç†å†…å­˜çš„è½¬æ¢ï¼Œå…¶ä¸­çš„é¡µè¡¨ï¼ˆPage tableï¼‰å­˜å‚¨ç€é¡µï¼ˆç¨‹åºåœ°å€ç©ºé—´ï¼‰å’Œé¡µæ¡†ï¼ˆç‰©ç†å†…å­˜ç©ºé—´ï¼‰çš„æ˜ å°„è¡¨ã€‚</p><p>ä¸€ä¸ªè™šæ‹Ÿåœ°å€åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†å­˜å‚¨é¡µé¢å·ï¼Œä¸€éƒ¨åˆ†å­˜å‚¨åç§»é‡ã€‚</p><p>ä¸‹å›¾çš„é¡µè¡¨å­˜æ”¾ç€ 16 ä¸ªé¡µï¼Œè¿™ 16 ä¸ªé¡µéœ€è¦ç”¨ 4 ä¸ªæ¯”ç‰¹ä½æ¥è¿›è¡Œç´¢å¼•å®šä½ã€‚ä¾‹å¦‚å¯¹äºè™šæ‹Ÿåœ°å€ï¼ˆ0010 000000000100ï¼‰ï¼Œå‰ 4 ä½æ˜¯å­˜å‚¨é¡µé¢å· 2ï¼Œè¯»å–è¡¨é¡¹å†…å®¹ä¸ºï¼ˆ110 1ï¼‰ï¼Œé¡µè¡¨é¡¹æœ€åä¸€ä½è¡¨ç¤ºæ˜¯å¦å­˜åœ¨äºå†…å­˜ä¸­ï¼Œ1 è¡¨ç¤ºå­˜åœ¨ã€‚å 12 ä½å­˜å‚¨åç§»é‡ã€‚è¿™ä¸ªé¡µå¯¹åº”çš„é¡µæ¡†çš„åœ°å€ä¸º ï¼ˆ110 000000000100ï¼‰ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="http://www.c-jump.com/CIS77/asm_images/memory_paging.png" alt="memory_paging"></p><p><img src= "/img/loading2.gif" data-lazy-src="http://www.c-jump.com/CIS77/asm_images/virtual_2_physical.png" alt="virtual_2_physical"></p><h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><p><a href="https://www.cnblogs.com/felixfang/p/3420462.html">https://www.cnblogs.com/felixfang/p/3420462.html</a></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç»„æˆåŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜ </tag>
            
            <tag> ç»„æˆåŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPUçš„å·¥ä½œåŸç†</title>
      <link href="/2017/10/10/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E4%B9%8BCPU/"/>
      <url>/2017/10/10/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E4%B9%8BCPU/</url>
      
        <content type="html"><![CDATA[<p>CPU çš„å…¨ç§°æ˜¯ <code>Central Processing Unit</code>ï¼Œå³ä¸­å¤®å¤„ç†å•å…ƒï¼Œæ˜¯è®¡ç®—æœºçš„æ ¸å¿ƒéƒ¨ä»¶-è®¡ç®—éƒ¨ä»¶ã€‚CPU çš„æ ¸å¿ƒæ˜¯ä»ç¨‹åºæˆ–åº”ç”¨ç¨‹åºè·å–æŒ‡ä»¤å¹¶æ‰§è¡Œè®¡ç®—ã€‚æ­¤è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå…³é”®é˜¶æ®µï¼š<strong>æå–ï¼Œè§£ç å’Œæ‰§è¡Œ</strong>ã€‚CPUä»ç³»ç»Ÿçš„ä¸»å­˜ä¸­æå–æŒ‡ä»¤ï¼Œç„¶åè§£ç è¯¥æŒ‡ä»¤çš„å®é™…å†…å®¹ï¼Œç„¶åå†ç”± CPU çš„ç›¸å…³éƒ¨åˆ†æ‰§è¡Œè¯¥æŒ‡ä»¤ã€‚</p><a id="more"></a><h3 id="è®¡ç®—æœºå†…éƒ¨å¤„ç†è¿‡ç¨‹"><a href="#è®¡ç®—æœºå†…éƒ¨å¤„ç†è¿‡ç¨‹" class="headerlink" title="è®¡ç®—æœºå†…éƒ¨å¤„ç†è¿‡ç¨‹"></a>è®¡ç®—æœºå†…éƒ¨å¤„ç†è¿‡ç¨‹</h3><p>ä»¥Cè¯­è¨€ä¸ºä¾‹æ¥è¯´æ˜ç¨‹åºè¿è¡Œæµç¨‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/NHXAQos2fRl53ZL.jpg" alt="è¿è¡Œæµç¨‹"></p><p>åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼ŒCPU è´Ÿè´£çš„å°±æ˜¯è§£é‡Šå’Œè¿è¡Œæœ€ç»ˆè½¬æ¢æˆæœºå™¨è¯­è¨€çš„å†…å®¹ã€‚<br>CPU ä¸»è¦ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼šæ§åˆ¶å•å…ƒ å’Œ ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALUï¼‰</p><p>æ§åˆ¶å•å…ƒï¼šä»å†…å­˜ä¸­æå–æŒ‡ä»¤å¹¶è§£ç æ‰§è¡Œ<br>ç®—æ•°é€»è¾‘å•å…ƒï¼ˆALUï¼‰ï¼šå¤„ç†ç®—æ•°å’Œé€»è¾‘è¿ç®—</p><p>CPU æ˜¯è®¡ç®—æœºçš„å¿ƒè„å’Œå¤§è„‘ï¼Œå®ƒå’Œå†…å­˜éƒ½æ˜¯ç”±è®¸å¤šæ™¶ä½“ç®¡ç»„æˆçš„ç”µå­éƒ¨ä»¶ã€‚å®ƒæ¥æ”¶æ•°æ®è¾“å…¥ï¼Œæ‰§è¡ŒæŒ‡ä»¤å¹¶å¤„ç†ä¿¡æ¯ã€‚å®ƒä¸è¾“å…¥/è¾“å‡ºï¼ˆI / Oï¼‰è®¾å¤‡è¿›è¡Œé€šä¿¡ï¼Œè¿™äº›è®¾å¤‡å‘ CPU å‘é€æ•°æ®å’Œä» CPU æ¥æ”¶æ•°æ®ã€‚<br>ä»åŠŸèƒ½æ¥çœ‹ï¼ŒCPU çš„å†…éƒ¨ç”±å¯„å­˜å™¨ã€æ§åˆ¶å™¨ã€è¿ç®—å™¨å’Œæ—¶é’Ÿå››éƒ¨åˆ†ç»„æˆï¼Œå„éƒ¨åˆ†ä¹‹é—´é€šè¿‡ç”µä¿¡å·è¿é€šã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/hHwJPmTrgZDXafE.jpg" alt="cpuéƒ¨ä»¶"></p><p><strong>å¯„å­˜å™¨</strong>æ˜¯ä¸­å¤®å¤„ç†å™¨å†…çš„ç»„æˆéƒ¨åˆ†ã€‚å®ƒä»¬å¯ä»¥ç”¨æ¥æš‚å­˜æŒ‡ä»¤ã€æ•°æ®å’Œåœ°å€ã€‚å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯å†…å­˜çš„ä¸€ç§ã€‚æ ¹æ®ç§ç±»çš„ä¸åŒï¼Œä¸€ä¸ª CPU å†…éƒ¨ä¼šæœ‰ 20 - 100ä¸ªå¯„å­˜å™¨ã€‚</p><p><strong>æ§åˆ¶å™¨</strong>è´Ÿè´£æŠŠå†…å­˜ä¸Šçš„æŒ‡ä»¤ã€æ•°æ®è¯»å…¥å¯„å­˜å™¨ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤çš„ç»“æœæ§åˆ¶è®¡ç®—æœº</p><p><strong>è¿ç®—å™¨</strong>è´Ÿè´£è¿ç®—ä»å†…å­˜ä¸­è¯»å…¥å¯„å­˜å™¨çš„æ•°æ®</p><p><strong>æ—¶é’Ÿ</strong>è´Ÿè´£å‘å‡º CPU å¼€å§‹è®¡æ—¶çš„æ—¶é’Ÿä¿¡å·</p><h3 id="CPU-æ˜¯ä¸€ç³»åˆ—å¯„å­˜å™¨çš„é›†åˆä½“"><a href="#CPU-æ˜¯ä¸€ç³»åˆ—å¯„å­˜å™¨çš„é›†åˆä½“" class="headerlink" title="CPU æ˜¯ä¸€ç³»åˆ—å¯„å­˜å™¨çš„é›†åˆä½“"></a>CPU æ˜¯ä¸€ç³»åˆ—å¯„å­˜å™¨çš„é›†åˆä½“</h3><p>æ§åˆ¶å™¨ã€è¿ç®—å™¨ã€æ—¶é’Ÿéƒ½æ˜¯åŸºäºæ•°å­—ç”µè·¯åŸç†ï¼Œåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ä¸»è¦å…³æ³¨å¯„å­˜å™¨ã€‚</p><div class="table-container"><table><thead><tr><th>ç§ç±»</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>ç´¯åŠ å¯„å­˜å™¨</td><td>å­˜å‚¨è¿è¡Œçš„æ•°æ®å’Œè¿ç®—åçš„æ•°æ®ã€‚</td></tr><tr><td>æ ‡å¿—å¯„å­˜å™¨</td><td>ç”¨äºååº”å¤„ç†å™¨çš„çŠ¶æ€å’Œè¿ç®—ç»“æœçš„æŸäº›ç‰¹å¾ä»¥åŠæ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œã€‚</td></tr><tr><td>ç¨‹åºè®¡æ•°å™¨</td><td>ç¨‹åºè®¡æ•°å™¨æ˜¯ç”¨äºå­˜æ”¾ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨å•å…ƒçš„åœ°å€çš„åœ°æ–¹ã€‚</td></tr><tr><td>åŸºå€å¯„å­˜å™¨</td><td>å­˜å‚¨æ•°æ®å†…å­˜çš„èµ·å§‹ä½ç½®</td></tr><tr><td>å˜å€å¯„å­˜å™¨</td><td>å­˜å‚¨åŸºå€å¯„å­˜å™¨çš„ç›¸å¯¹åœ°å€</td></tr><tr><td>é€šç”¨å¯„å­˜å™¨</td><td>å­˜å‚¨ä»»æ„æ•°æ®</td></tr><tr><td>æŒ‡ä»¤å¯„å­˜å™¨</td><td>å‚¨å­˜æ­£åœ¨è¢«è¿è¡Œçš„æŒ‡ä»¤ï¼ŒCPUå†…éƒ¨ä½¿ç”¨ï¼Œç¨‹åºå‘˜æ— æ³•å¯¹è¯¥å¯„å­˜å™¨è¿›è¡Œè¯»å†™</td></tr><tr><td>æ ˆå¯„å­˜å™¨</td><td>å­˜å‚¨æ ˆåŒºåŸŸçš„èµ·å§‹ä½ç½®</td></tr></tbody></table></div><p>å…¶ä¸­<strong>ç¨‹åºè®¡æ•°å™¨ã€ç´¯åŠ å¯„å­˜å™¨ã€æ ‡å¿—å¯„å­˜å™¨ã€æŒ‡ä»¤å¯„å­˜å™¨å’Œæ ˆå¯„å­˜å™¨</strong>éƒ½åªæœ‰ä¸€ä¸ªï¼Œå…¶ä»–å¯„å­˜å™¨ä¸€èˆ¬æœ‰å¤šä¸ªã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/6TfRVKgohB1EdUI.jpg" alt="CPUå¯„å­˜å™¨"></p><h4 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h4><p><code>ç¨‹åºè®¡æ•°å™¨(Program Counter)</code>æ˜¯ç”¨æ¥å­˜å‚¨ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨å•å…ƒçš„åœ°å€ã€‚</p><p>ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒPCçš„åˆå€¼ä¸ºç¨‹åºç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œåœ¨é¡ºåºæ‰§è¡Œç¨‹åºæ—¶ï¼Œ<code>æ§åˆ¶å™¨</code>é¦–å…ˆæŒ‰ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡å‡ºçš„æŒ‡ä»¤åœ°å€ä»å†…å­˜ä¸­å–å‡ºä¸€æ¡æŒ‡ä»¤ï¼Œç„¶ååˆ†æå’Œæ‰§è¡Œè¯¥æŒ‡ä»¤ï¼ŒåŒæ—¶å°†PCçš„å€¼åŠ 1æŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸€ä¸ªäº‹ä¾‹ä¸ºå‡†æ¥è¯¦ç»†çš„çœ‹ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨çš„æ‰§è¡Œè¿‡ç¨‹</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/b9s4MyeLopKfaJE.jpg" alt="ç¨‹åºè®¡æ•°å™¨"></p><p>è¿™æ˜¯ä¸€æ®µè¿›è¡Œç›¸åŠ çš„æ“ä½œï¼Œç¨‹åºå¯åŠ¨ï¼Œåœ¨ç»è¿‡ç¼–è¯‘è§£æåä¼šç”±æ“ä½œç³»ç»ŸæŠŠç¡¬ç›˜ä¸­çš„ç¨‹åºå¤åˆ¶åˆ°å†…å­˜ä¸­ï¼Œç¤ºä¾‹ä¸­çš„ç¨‹åºæ˜¯å°† 123 å’Œ 456 æ‰§è¡Œç›¸åŠ æ“ä½œï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚</p><p>åœ°å€ <code>0100</code> æ˜¯ç¨‹åºè¿è¡Œçš„èµ·å§‹ä½ç½®ã€‚Windows ç­‰æ“ä½œç³»ç»ŸæŠŠç¨‹åºä»ç¡¬ç›˜å¤åˆ¶åˆ°å†…å­˜åï¼Œä¼šå°†ç¨‹åºè®¡æ•°å™¨ä½œä¸ºè®¾å®šä¸ºèµ·å§‹ä½ç½® 0100ï¼Œç„¶åæ‰§è¡Œç¨‹åºï¼Œæ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤åï¼Œç¨‹åºè®¡æ•°å™¨çš„æ•°å€¼ä¼šå¢åŠ 1ï¼ˆæˆ–è€…ç›´æ¥æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼‰ï¼Œç„¶åï¼ŒCPU å°±ä¼šæ ¹æ®ç¨‹åºè®¡æ•°å™¨çš„æ•°å€¼ï¼Œä»å†…å­˜ä¸­è¯»å–å‘½ä»¤å¹¶æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç¨‹åºè®¡æ•°å™¨æ§åˆ¶ç€ç¨‹åºçš„æµç¨‹</strong>ã€‚</p><h4 id="æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯æœºåˆ¶"><a href="#æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯æœºåˆ¶" class="headerlink" title="æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯æœºåˆ¶"></a>æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯æœºåˆ¶</h4><p>é«˜çº§è¯­è¨€ä¸­çš„æ¡ä»¶æ§åˆ¶æµç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ç§ï¼š<code>é¡ºåºæ‰§è¡Œã€æ¡ä»¶åˆ†æ”¯ã€å¾ªç¯åˆ¤æ–­</code>ä¸‰ç§ï¼Œé¡ºåºæ‰§è¡Œæ˜¯æŒ‰ç…§åœ°å€çš„å†…å®¹é¡ºåºçš„æ‰§è¡ŒæŒ‡ä»¤ã€‚æ¡ä»¶åˆ†æ”¯æ˜¯æ ¹æ®æ¡ä»¶æ‰§è¡Œä»»æ„åœ°å€çš„æŒ‡ä»¤ã€‚å¾ªç¯æ˜¯é‡å¤æ‰§è¡ŒåŒä¸€åœ°å€çš„æŒ‡ä»¤ã€‚</p><ul><li>é¡ºåºæ‰§è¡Œçš„æƒ…å†µæ¯”è¾ƒç®€å•ï¼Œæ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ç¨‹åºè®¡æ•°å™¨çš„å€¼å°±æ˜¯ + 1ã€‚</li><li>æ¡ä»¶å’Œå¾ªç¯åˆ†æ”¯ä¼šä½¿ç¨‹åºè®¡æ•°å™¨çš„å€¼æŒ‡å‘ä»»æ„çš„åœ°å€ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç¨‹åºä¾¿å¯ä»¥è¿”å›åˆ°ä¸Šä¸€ä¸ªåœ°å€æ¥é‡å¤æ‰§è¡ŒåŒä¸€ä¸ªæŒ‡ä»¤ï¼Œæˆ–è€…è·³è½¬åˆ°ä»»æ„æŒ‡ä»¤ã€‚</li></ul><p>ä¸‹é¢ä»¥æ¡ä»¶åˆ†æ”¯ä¸ºä¾‹æ¥è¯´æ˜ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆå¾ªç¯ä¹Ÿå¾ˆç›¸ä¼¼ï¼‰</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/muNPLRZGkgwisQ8.jpg" alt="æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯æœºåˆ¶"></p><p>ç¨‹åºçš„å¼€å§‹è¿‡ç¨‹å’Œé¡ºåºæµç¨‹æ˜¯ä¸€æ ·çš„ï¼ŒCPU ä»0100å¤„å¼€å§‹æ‰§è¡Œå‘½ä»¤ï¼Œåœ¨0100å’Œ0101éƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼ŒPC çš„å€¼é¡ºåº+1ï¼Œæ‰§è¡Œåˆ°0102åœ°å€çš„æŒ‡ä»¤æ—¶ï¼Œåˆ¤æ–­0106å¯„å­˜å™¨çš„æ•°å€¼å¤§äº0ï¼Œè·³è½¬ï¼ˆjumpï¼‰åˆ°0104åœ°å€çš„æŒ‡ä»¤ï¼Œå°†æ•°å€¼è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ä¸­ï¼Œç„¶åç»“æŸç¨‹åºï¼Œ0103 çš„æŒ‡ä»¤è¢«è·³è¿‡äº†ï¼Œè¿™å°±å’Œæˆ‘ä»¬ç¨‹åºä¸­çš„ <code>if()</code> åˆ¤æ–­æ˜¯ä¸€æ ·çš„ï¼Œåœ¨ä¸æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼ŒæŒ‡ä»¤ä¼šç›´æ¥è·³è¿‡ã€‚æ‰€ä»¥ PC çš„æ‰§è¡Œè¿‡ç¨‹ä¹Ÿå°±æ²¡æœ‰ç›´æ¥+1ï¼Œè€Œæ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p><h4 id="æ ‡å¿—å¯„å­˜å™¨"><a href="#æ ‡å¿—å¯„å­˜å™¨" class="headerlink" title="æ ‡å¿—å¯„å­˜å™¨"></a>æ ‡å¿—å¯„å­˜å™¨</h4><p>æ¡ä»¶å’Œå¾ªç¯åˆ†æ”¯ä¼šä½¿ç”¨åˆ° <code>jumpï¼ˆè·³è½¬æŒ‡ä»¤ï¼‰</code>ï¼Œä¼šæ ¹æ®å½“å‰çš„æŒ‡ä»¤æ¥åˆ¤æ–­æ˜¯å¦è·³è½¬ï¼Œä¸Šé¢æˆ‘ä»¬æåˆ°äº†<code>æ ‡å¿—å¯„å­˜å™¨</code>ï¼Œæ— è®ºå½“å‰ç´¯åŠ å¯„å­˜å™¨çš„è¿ç®—ç»“æœæ˜¯æ­£æ•°ã€è´Ÿæ•°è¿˜æ˜¯é›¶ï¼Œæ ‡å¿—å¯„å­˜å™¨éƒ½ä¼šå°†å…¶ä¿å­˜</p><p>CPU åœ¨è¿›è¡Œè¿ç®—æ—¶ï¼Œæ ‡å¿—å¯„å­˜å™¨çš„æ•°å€¼ä¼šæ ¹æ®å½“å‰è¿ç®—çš„ç»“æœè‡ªåŠ¨è®¾å®šï¼Œè¿ç®—ç»“æœçš„æ­£ã€è´Ÿå’Œé›¶ä¸‰ç§çŠ¶æ€ç”±æ ‡å¿—å¯„å­˜å™¨çš„ä¸‰ä¸ªä½è¡¨ç¤ºã€‚æ ‡å¿—å¯„å­˜å™¨çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä½ã€ç¬¬äºŒä¸ªå­—èŠ‚ä½ã€ç¬¬ä¸‰ä¸ªå­—èŠ‚ä½å„è‡ªçš„ç»“æœéƒ½ä¸º1æ—¶ï¼Œåˆ†åˆ«ä»£è¡¨ç€æ­£æ•°ã€é›¶å’Œè´Ÿæ•°ã€‚</p><p>CPU çš„æ‰§è¡Œæœºåˆ¶æ¯”è¾ƒæœ‰æ„æ€ï¼Œå‡è®¾ç´¯åŠ å¯„å­˜å™¨ä¸­å­˜å‚¨çš„ XXX å’Œé€šç”¨å¯„å­˜å™¨ä¸­å­˜å‚¨çš„ YYY åšæ¯”è¾ƒï¼Œæ‰§è¡Œæ¯”è¾ƒçš„èƒŒåï¼ŒCPU çš„è¿ç®—æœºåˆ¶å°±ä¼šåšå‡æ³•è¿ç®—ã€‚è€Œæ— è®ºå‡æ³•è¿ç®—çš„ç»“æœæ˜¯æ­£æ•°ã€é›¶è¿˜æ˜¯è´Ÿæ•°ï¼Œéƒ½ä¼šä¿å­˜åˆ°æ ‡å¿—å¯„å­˜å™¨ä¸­ã€‚ç»“æœä¸ºæ­£è¡¨ç¤º XXX æ¯” YYY å¤§ï¼Œç»“æœä¸ºé›¶è¡¨ç¤º XXX å’Œ YYY ç›¸ç­‰ï¼Œç»“æœä¸ºè´Ÿè¡¨ç¤º XXX æ¯” YYY å°ã€‚<strong>ç¨‹åºæ¯”è¾ƒçš„æŒ‡ä»¤ï¼Œå®é™…ä¸Šæ˜¯åœ¨ CPU å†…éƒ¨åšå‡æ³•è¿ç®—ã€‚</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/6B2wr1Zh3okmODN.jpg" alt="æ ‡å¿—å¯„å­˜å™¨"></p><h4 id="å‡½æ•°è°ƒç”¨æœºåˆ¶"><a href="#å‡½æ•°è°ƒç”¨æœºåˆ¶" class="headerlink" title="å‡½æ•°è°ƒç”¨æœºåˆ¶"></a>å‡½æ•°è°ƒç”¨æœºåˆ¶</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­ä»‹ç»å‡½æ•°è°ƒç”¨æœºåˆ¶ï¼Œå“ªæ€•æ˜¯é«˜çº§è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå‡½æ•°è°ƒç”¨å¤„ç†ä¹Ÿæ˜¯é€šè¿‡æŠŠç¨‹åºè®¡æ•°å™¨çš„å€¼è®¾å®šæˆå‡½æ•°çš„å­˜å‚¨åœ°å€æ¥å®ç°çš„ã€‚å‡½æ•°æ‰§è¡Œè·³è½¬æŒ‡ä»¤åï¼Œå¿…é¡»è¿›è¡Œè¿”å›å¤„ç†ï¼Œå•çº¯çš„æŒ‡ä»¤è·³è½¬æ²¡æœ‰æ„ä¹‰ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°å‡½æ•°è·³è½¬çš„ä¾‹å­</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/8cruihwQzUC1HAM.jpg" alt="ç¨‹åºè°ƒç”¨"></p><p>å›¾ä¸­å°†å˜é‡ a å’Œ b åˆ†åˆ«èµ‹å€¼ä¸º 123 å’Œ 456 ï¼Œè°ƒç”¨ MyFun(a,b) æ–¹æ³•ï¼Œè¿›è¡ŒæŒ‡ä»¤è·³è½¬ã€‚å›¾ä¸­çš„åœ°å€æ˜¯å°† C è¯­è¨€ç¼–è¯‘æˆæœºå™¨è¯­è¨€åè¿è¡Œæ—¶çš„åœ°å€ï¼Œç”±äº1è¡Œ C ç¨‹åºåœ¨ç¼–è¯‘åé€šå¸¸ä¼šå˜ä¸ºå¤šè¡Œæœºå™¨è¯­è¨€ï¼Œæ‰€ä»¥å›¾ä¸­çš„åœ°å€æ˜¯åˆ†æ•£çš„ã€‚åœ¨æ‰§è¡Œå®Œ MyFun(a,b)æŒ‡ä»¤åï¼Œç¨‹åºä¼šè¿”å›åˆ° MyFun(a,b) çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ŒCPU ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ã€‚</p><p>å‡½æ•°çš„è°ƒç”¨å’Œè¿”å›å¾ˆé‡è¦çš„ä¸¤ä¸ªæŒ‡ä»¤æ˜¯ <code>call</code> å’Œ <code>return</code> æŒ‡ä»¤ï¼Œå†å°†å‡½æ•°çš„å…¥å£åœ°å€è®¾å®šåˆ°ç¨‹åºè®¡æ•°å™¨ä¹‹å‰ï¼Œcall æŒ‡ä»¤ä¼šæŠŠè°ƒç”¨å‡½æ•°åè¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€å­˜å‚¨åœ¨åä¸ºæ ˆçš„ä¸»å­˜å†…ã€‚å‡½æ•°å¤„ç†å®Œæ¯•åï¼Œå†é€šè¿‡å‡½æ•°çš„å‡ºå£æ¥æ‰§è¡Œ return æŒ‡ä»¤ã€‚return æŒ‡ä»¤çš„åŠŸèƒ½æ˜¯æŠŠä¿å­˜åœ¨æ ˆä¸­çš„åœ°å€è®¾å®šåˆ°ç¨‹åºè®¡æ•°å™¨ã€‚MyFun å‡½æ•°åœ¨è¢«è°ƒç”¨ä¹‹å‰ï¼Œ0154 åœ°å€ä¿å­˜åœ¨æ ˆä¸­ï¼ŒMyFun å‡½æ•°å¤„ç†å®Œæˆåï¼Œä¼šæŠŠ 0154 çš„åœ°å€ä¿å­˜åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­ã€‚è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/vnrEX81DhKyRsjM.jpg" alt="callä¸return"></p><p>åœ¨ä¸€äº›é«˜çº§è¯­è¨€çš„æ¡ä»¶æˆ–è€…å¾ªç¯è¯­å¥ä¸­ï¼Œå‡½æ•°è°ƒç”¨çš„å¤„ç†ä¼šè½¬æ¢æˆ call æŒ‡ä»¤ï¼Œå‡½æ•°ç»“æŸåçš„å¤„ç†åˆ™ä¼šè½¬æ¢æˆ return æŒ‡ä»¤ã€‚</p><h4 id="é€šè¿‡åœ°å€å’Œç´¢å¼•å®ç°æ•°ç»„"><a href="#é€šè¿‡åœ°å€å’Œç´¢å¼•å®ç°æ•°ç»„" class="headerlink" title="é€šè¿‡åœ°å€å’Œç´¢å¼•å®ç°æ•°ç»„"></a>é€šè¿‡åœ°å€å’Œç´¢å¼•å®ç°æ•°ç»„</h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹åŸºå€å¯„å­˜å™¨å’Œå˜å€å¯„å­˜å™¨ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå¯„å­˜å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸»å­˜ä¸Šçš„ç‰¹å®šåŒºåŸŸè¿›è¡Œåˆ’åˆ†ï¼Œæ¥å®ç°ç±»ä¼¼æ•°ç»„çš„æ“ä½œï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ç”¨åå…­è¿›åˆ¶æ•°å°†è®¡ç®—æœºå†…å­˜ä¸Šçš„ 00000000 - FFFFFFFF çš„åœ°å€åˆ’åˆ†å‡ºæ¥ã€‚é‚£ä¹ˆï¼Œå‡¡æ˜¯è¯¥èŒƒå›´çš„å†…å­˜åœ°å€ï¼Œåªè¦æœ‰ä¸€ä¸ª 32 ä½çš„å¯„å­˜å™¨ï¼Œä¾¿å¯æŸ¥çœ‹å…¨éƒ¨åœ°å€ã€‚ä½†å¦‚æœæƒ³è¦æƒ³æ•°ç»„é‚£æ ·åˆ†å‰²ç‰¹å®šçš„å†…å­˜åŒºåŸŸä»¥è¾¾åˆ°è¿ç»­æŸ¥çœ‹çš„ç›®çš„çš„è¯ï¼Œä½¿ç”¨ä¸¤ä¸ªå¯„å­˜å™¨ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç”¨ä¸¤ä¸ªå¯„å­˜å™¨ï¼ˆåŸºå€å¯„å­˜å™¨å’Œå˜å€å¯„å­˜å™¨ï¼‰æ¥è¡¨ç¤ºå†…å­˜çš„å€¼</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/8mMGZuRozht7e5p.jpg" alt="æ•°ç»„"></p><p>è¿™ç§è¡¨ç¤ºæ–¹å¼å¾ˆç±»ä¼¼æ•°ç»„çš„æ„é€ ï¼Œ<code>æ•°ç»„</code>æ˜¯æŒ‡åŒæ ·é•¿åº¦çš„æ•°æ®åœ¨å†…å­˜ä¸­è¿›è¡Œè¿ç»­æ’åˆ—çš„æ•°æ®æ„é€ ã€‚ç”¨æ•°ç»„åè¡¨ç¤ºæ•°ç»„å…¨éƒ¨çš„å€¼ï¼Œé€šè¿‡ç´¢å¼•æ¥åŒºåˆ†æ•°ç»„çš„å„ä¸ªæ•°æ®å…ƒç´ ï¼Œä¾‹å¦‚: a[0] - a[4]ï¼Œ<code>[]</code>å†…çš„ 0 - 4 å°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡ã€‚</p><h3 id="CPU-æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹"><a href="#CPU-æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="CPU æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹"></a>CPU æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹</h3><p>å‡ ä¹æ‰€æœ‰çš„å†¯Â·è¯ºä¼Šæ›¼å‹è®¡ç®—æœºçš„CPUï¼Œå…¶å·¥ä½œéƒ½å¯ä»¥åˆ†ä¸º5ä¸ªé˜¶æ®µï¼š<strong>å–æŒ‡ä»¤ã€æŒ‡ä»¤è¯‘ç ã€æ‰§è¡ŒæŒ‡ä»¤ã€è®¿å­˜å–æ•°ã€ç»“æœå†™å›</strong>ã€‚</p><ul><li><code>å–æŒ‡ä»¤</code>é˜¶æ®µæ˜¯å°†å†…å­˜ä¸­çš„æŒ‡ä»¤è¯»å–åˆ° CPU ä¸­å¯„å­˜å™¨çš„è¿‡ç¨‹ï¼Œç¨‹åºå¯„å­˜å™¨ç”¨äºå­˜å‚¨ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨çš„åœ°å€</li><li><code>æŒ‡ä»¤è¯‘ç </code>é˜¶æ®µï¼Œåœ¨å–æŒ‡ä»¤å®Œæˆåï¼Œç«‹é©¬è¿›å…¥æŒ‡ä»¤è¯‘ç é˜¶æ®µï¼Œåœ¨æŒ‡ä»¤è¯‘ç é˜¶æ®µï¼ŒæŒ‡ä»¤è¯‘ç å™¨æŒ‰ç…§é¢„å®šçš„æŒ‡ä»¤æ ¼å¼ï¼Œå¯¹å–å›çš„æŒ‡ä»¤è¿›è¡Œæ‹†åˆ†å’Œè§£é‡Šï¼Œè¯†åˆ«åŒºåˆ†å‡ºä¸åŒçš„æŒ‡ä»¤ç±»åˆ«ä»¥åŠå„ç§è·å–æ“ä½œæ•°çš„æ–¹æ³•ã€‚</li><li><code>æ‰§è¡ŒæŒ‡ä»¤</code>é˜¶æ®µï¼Œè¯‘ç å®Œæˆåï¼Œå°±éœ€è¦æ‰§è¡Œè¿™ä¸€æ¡æŒ‡ä»¤äº†ï¼Œæ­¤é˜¶æ®µçš„ä»»åŠ¡æ˜¯å®ŒæˆæŒ‡ä»¤æ‰€è§„å®šçš„å„ç§æ“ä½œï¼Œå…·ä½“å®ç°æŒ‡ä»¤çš„åŠŸèƒ½ã€‚</li><li><code>è®¿é—®å–æ•°</code>é˜¶æ®µï¼Œæ ¹æ®æŒ‡ä»¤çš„éœ€è¦ï¼Œæœ‰å¯èƒ½éœ€è¦ä»å†…å­˜ä¸­æå–æ•°æ®ï¼Œæ­¤é˜¶æ®µçš„ä»»åŠ¡æ˜¯ï¼šæ ¹æ®æŒ‡ä»¤åœ°å€ç ï¼Œå¾—åˆ°æ“ä½œæ•°åœ¨ä¸»å­˜ä¸­çš„åœ°å€ï¼Œå¹¶ä»ä¸»å­˜ä¸­è¯»å–è¯¥æ“ä½œæ•°ç”¨äºè¿ç®—ã€‚</li><li><code>ç»“æœå†™å›</code>é˜¶æ®µï¼Œä½œä¸ºæœ€åä¸€ä¸ªé˜¶æ®µï¼Œç»“æœå†™å›ï¼ˆWrite Backï¼ŒWBï¼‰é˜¶æ®µæŠŠæ‰§è¡ŒæŒ‡ä»¤é˜¶æ®µçš„è¿è¡Œç»“æœæ•°æ®â€œå†™å›â€åˆ°æŸç§å­˜å‚¨å½¢å¼ï¼šç»“æœæ•°æ®ç»å¸¸è¢«å†™åˆ°CPUçš„å†…éƒ¨å¯„å­˜å™¨ä¸­ï¼Œä»¥ä¾¿è¢«åç»­çš„æŒ‡ä»¤å¿«é€Ÿåœ°å­˜å–ï¼›</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç»„æˆåŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPU </tag>
            
            <tag> ç»„æˆåŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼åè®®ä¹‹Raftç®—æ³•</title>
      <link href="/2017/09/28/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%AE%AE%E4%B9%8BRaft%E7%AE%97%E6%B3%95/"/>
      <url>/2017/09/28/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%AE%AE%E4%B9%8BRaft%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>Raftæ˜¯ä¸€ç§åˆ†å¸ƒå¼å…±è¯†ç®—æ³•ã€‚ç›¸å¯¹äºä¹‹å‰çš„Paxosåè®®ï¼Œå®ƒçš„è®¾è®¡æ˜“äºç†è§£ã€‚å®ƒè§£å†³äº†å³ä½¿é¢å¯¹æ•…éšœä¹Ÿä½¿å¤šä¸ªæœåŠ¡å™¨åœ¨å…±äº«çŠ¶æ€ä¸Šè¾¾æˆä¸€è‡´çš„é—®é¢˜ã€‚å…±äº«çŠ¶æ€é€šå¸¸æ˜¯å¤åˆ¶æ—¥å¿—æ”¯æŒçš„æ•°æ®ç»“æ„ã€‚åªè¦å¤§å¤šæ•°æœåŠ¡å™¨éƒ½å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæˆ‘ä»¬å°±éœ€è¦ç³»ç»Ÿèƒ½å¤Ÿå®Œå…¨è¿è¡Œã€‚</p><p>Rafté€šè¿‡é€‰ä¸¾é›†ç¾¤ä¸­çš„ä¸€ä½leaderæ¥å·¥ä½œã€‚leaderè´Ÿè´£æ¥å—clientè¯·æ±‚å¹¶ç®¡ç†å°†æ—¥å¿—å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚æ•°æ®ä»…åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼šä»leaderæµå‘å…¶ä»–æœåŠ¡å™¨ã€‚</p><a id="more"></a><p>Raftå°†å…±è¯†åˆ†è§£ä¸ºä¸‰ä¸ªå­é—®é¢˜ï¼š</p><ul><li>leaderé€‰ä¸¾ï¼šå¦‚æœç°æœ‰leaderå¤±è´¥ï¼Œåˆ™éœ€è¦é€‰ä¸¾ä¸€åæ–°leaderã€‚</li><li>æ—¥å¿—å¤åˆ¶ï¼šleaderéœ€è¦é€šè¿‡å¤åˆ¶ä½¿æ‰€æœ‰æœåŠ¡å™¨çš„æ—¥å¿—ä¸å…¶è‡ªå·±çš„æœåŠ¡å™¨ä¿æŒåŒæ­¥ã€‚</li><li>å®‰å…¨æ€§ï¼šå¦‚æœå…¶ä¸­ä¸€å°æœåŠ¡å™¨å·²åœ¨ç‰¹å®šç´¢å¼•ä¸Šæäº¤äº†æ—¥å¿—æ¡ç›®ï¼Œåˆ™å…¶ä»–ä»»ä½•æœåŠ¡å™¨éƒ½æ— æ³•å¯¹è¯¥ç´¢å¼•åº”ç”¨å…¶ä»–æ—¥å¿—æ¡ç›®ã€‚</li></ul><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>æ¯ä¸ªæœåŠ¡å™¨éƒ½å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼šleaderï¼Œfolloweræˆ–candidateã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/xoBVRrGPyQzFDAY.png" alt="oN6xZLkKQrVnaWWlp7I8w9aep2NNgMz5fR9D"></p><blockquote><p>åœ¨æ­£å¸¸æ“ä½œä¸­ï¼Œåªæœ‰ä¸€ä¸ªleaderï¼Œå…¶ä»–æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯followerã€‚followeræ˜¯è¢«åŠ¨çš„ï¼šä»–ä»¬è‡ªå·±ä¸å‘å‡ºè¯·æ±‚ï¼Œè€Œåªæ˜¯å“åº”leaderå’Œcandidateçš„è¯·æ±‚ã€‚leaderå¤„ç†æ‰€æœ‰å®¢æˆ·è¯·æ±‚ï¼ˆå¦‚æœå®¢æˆ·è”ç³»followerï¼Œåˆ™followerå°†å…¶é‡å®šå‘åˆ°leaderï¼‰ã€‚ç¬¬ä¸‰ç§çŠ¶æ€ï¼Œcandidateï¼Œç”¨äºé€‰ä¸¾æ–°leaderã€‚</p></blockquote><p>Raftå°†æ—¶é—´åˆ†ä¸ºä»»æ„é•¿åº¦ï¼Œæ¯ä¸ªé•¿åº¦ä»¥é€‰ä¸¾å¼€å§‹ã€‚å¦‚æœcandidateèµ¢å¾—é€‰ä¸¾ï¼Œåˆ™åœ¨å‰©ä½™ä»»æœŸä¸­ä»å°†æ˜¯leaderã€‚å¦‚æœè¡¨å†³åˆ†è£‚ï¼Œåˆ™è¯¥ä»»æœŸåœ¨æ²¡æœ‰leaderçš„æƒ…å†µä¸‹ç»“æŸã€‚</p><p><strong>termå·</strong>å•è°ƒå¢åŠ ã€‚æ¯ä¸ªæœåŠ¡å™¨å­˜å‚¨å½“å‰çš„termç¼–å·ï¼Œè¯¥ç¼–å·ä¹Ÿåœ¨æ¯æ¬¡é€šä¿¡ä¸­äº¤æ¢ã€‚</p><blockquote><p>..å¦‚æœä¸€å°æœåŠ¡å™¨çš„å½“å‰æœŸé™å°äºå¦ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å®ƒå°†å…¶å½“å‰æœŸé™æ›´æ–°ä¸ºè¾ƒå¤§çš„å€¼ã€‚å¦‚æœcandidateæˆ–leaderå‘ç°å…¶ä»»æœŸå·²è¿‡æ—¶ï¼Œå®ƒå°†ç«‹å³æ¢å¤ä¸ºfollowerçŠ¶æ€ã€‚å¦‚æœæœåŠ¡å™¨æ”¶åˆ°å¸¦æœ‰è¿‡æœŸæ¡æ¬¾ç¼–å·çš„è¯·æ±‚ï¼Œåˆ™è¯¥æœåŠ¡å™¨å°†æ‹’ç»è¯¥è¯·æ±‚ã€‚</p></blockquote><p>Raftåˆ©ç”¨ä¸¤ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æ¥æ‰§è¡Œå…¶åŸºæœ¬æ“ä½œã€‚</p><p>candidateåœ¨é€‰ä¸¾æœŸé—´ä½¿ç”¨RequestVotes<br>leaderå°†AppendEntriesç”¨äºå¤åˆ¶æ—¥å¿—æ¡ç›®ï¼Œå¹¶ç”¨ä½œæ£€æµ‹ä¿¡å·ï¼ˆæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨çš„ä¿¡å·-å®ƒä¸åŒ…å«ä»»ä½•æ—¥å¿—æ¡ç›®ï¼‰</p><h2 id="leaderé€‰ä¸¾"><a href="#leaderé€‰ä¸¾" class="headerlink" title="leaderé€‰ä¸¾"></a>leaderé€‰ä¸¾</h2><p>leaderå®šæœŸå‘å…¶followerå‘é€å¿ƒè·³ï¼Œä»¥ä¿æŒæƒå¨ã€‚å½“followeråœ¨ç­‰å¾…leaderçš„å¿ƒè·³åè¶…æ—¶æ—¶ï¼Œå°†è§¦å‘leaderé€‰ä¸¾ã€‚è¯¥followerè½¬æ¢ä¸ºcandidateçŠ¶æ€å¹¶å¢åŠ å…¶ä»»æœŸç¼–å·ã€‚åœ¨ä¸ºè‡ªå·±æŠ•ç¥¨ä¹‹åï¼Œå®ƒä¸é›†ç¾¤ä¸­çš„å…¶ä»–è¿›ç¨‹å¹¶è¡Œåœ°å‘å‡ºRequestVotes RPCã€‚å¯èƒ½æœ‰ä»¥ä¸‹ä¸‰ç§ç»“æœï¼š</p><ol><li>candidateä»å¤§å¤šæ•°æœåŠ¡å™¨ä¸­è·å¾—é€‰ç¥¨å¹¶æˆä¸ºleaderã€‚ç„¶åï¼Œå®ƒå°†å¿ƒè·³æ¶ˆæ¯å‘é€ç»™é›†ç¾¤ä¸­çš„å…¶ä»–äººä»¥å»ºç«‹æƒé™ã€‚</li><li>å¦‚æœå…¶ä»–candidateæ”¶åˆ°AppendEntries RPCï¼Œä»–ä»¬å°†æ£€æŸ¥termå·ã€‚å¦‚æœtermå·å¤§äºè‡ªå·±çš„termå·ï¼Œåˆ™ä»–ä»¬æ¥å—æœåŠ¡å™¨ä½œä¸ºleaderå¹¶è¿”å›åˆ°followerçŠ¶æ€ã€‚å¦‚æœtermå·æ•°é‡è¾ƒå°ï¼Œåˆ™ä»–ä»¬æ‹’ç»RPCï¼Œå¹¶ä¸”ä»ç„¶æ˜¯candidateã€‚</li><li>candidateæ—¢ä¸è¾“ä¹Ÿä¸èµ¢ã€‚å¦‚æœåŒæ—¶æœ‰å¤šä¸ªæœåŠ¡å™¨æˆä¸ºcandidateæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥åœ¨æ²¡æœ‰æ˜æ˜¾å¤šæ•°çš„æƒ…å†µä¸‹è¿›è¡Œè¡¨å†³ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä¸­ä¸€åcandidateè¶…æ—¶åä¾¿ä¼šå¼€å§‹æ–°çš„é€‰ä¸¾ã€‚</li></ol><blockquote><p>Raftä½¿ç”¨éšæœºçš„é€‰ä¸¾è¶…æ—¶æ¥ç¡®ä¿åˆ†å‰²ç¥¨å¾ˆå°‘å‘ç”Ÿï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿè§£å†³ã€‚ä¸ºäº†é¿å…ä¸€ç¥¨åˆ†è£‚ï¼Œé¦–å…ˆä»å›ºå®šé—´éš”ï¼ˆä¾‹å¦‚150-300æ¯«ç§’ï¼‰ä¸­éšæœºé€‰æ‹©é€‰ä¸¾è¶…æ—¶ã€‚è¿™æ ·ä¼šåˆ†æ•£æœåŠ¡å™¨ï¼Œå› æ­¤åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€å°æœåŠ¡å™¨ä¼šè¶…æ—¶ï¼›å®ƒä¼šèµ¢å¾—é€‰ä¸¾å¹¶åœ¨å…¶ä»–ä»»ä½•æœåŠ¡å™¨è¶…æ—¶ä¹‹å‰å‘é€å¿ƒè·³ä¿¡å·ã€‚ä½¿ç”¨ç›¸åŒçš„æœºåˆ¶æ¥å¤„ç†æ‹†åˆ†æŠ•ç¥¨ã€‚æ¯ä½candidateåœ¨é€‰ä¸¾å¼€å§‹æ—¶éƒ½ä¼šé‡æ–°å¯åŠ¨å…¶éšæœºé€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œå¹¶ç­‰å¾…è¯¥è¶…æ—¶æ—¶é—´è¿‡å»åæ‰å¼€å§‹ä¸‹ä¸€æ¬¡é€‰ä¸¾ï¼›è¿™å‡å°‘äº†åœ¨æ–°é€‰ä¸¾ä¸­å†æ¬¡è¿›è¡Œåˆ†è£‚è¡¨å†³çš„å¯èƒ½æ€§ã€‚</p></blockquote><h2 id="æ—¥å¿—å¤åˆ¶"><a href="#æ—¥å¿—å¤åˆ¶" class="headerlink" title="æ—¥å¿—å¤åˆ¶"></a>æ—¥å¿—å¤åˆ¶</h2><p>clientè¯·æ±‚ç°åœ¨å‡å®šä¸ºä»…å†™ã€‚æ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªå‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç†æƒ³åœ°ç”±æ‰€æœ‰æœåŠ¡å™¨çš„å¤åˆ¶çŠ¶æ€æœºæ‰§è¡Œã€‚leaderæ”¶åˆ°å®¢æˆ·è¯·æ±‚åï¼Œä¼šå°†å…¶ä½œä¸ºæ–°æ¡ç›®æ·»åŠ åˆ°è‡ªå·±çš„æ—¥å¿—ä¸­ã€‚æ—¥å¿—ä¸­çš„æ¯ä¸ªæ¡ç›®ï¼š</p><ul><li>åŒ…å«clientæŒ‡å®šçš„å‘½ä»¤</li><li>æœ‰ä¸€ä¸ªç´¢å¼•æ¥æ ‡è¯†æ—¥å¿—ä¸­æ¡ç›®çš„ä½ç½®ï¼ˆç´¢å¼•ä»1å¼€å§‹ï¼‰</li><li>æœ‰ä¸€ä¸ªtermå·å¯ä»¥ä»é€»è¾‘ä¸Šè¯†åˆ«æ¡ç›®çš„å†™å…¥æ—¶</li></ul><p>å®ƒéœ€è¦å°†æ¡ç›®å¤åˆ¶åˆ°æ‰€æœ‰followerèŠ‚ç‚¹ï¼Œä»¥ä¿æŒæ—¥å¿—ä¸€è‡´ã€‚leaderå°†AppendEntries RPCå¹¶è¡Œå‘å¸ƒåˆ°æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨ã€‚leaderå°†é‡è¯•æ­¤æ“ä½œï¼Œç›´åˆ°æ‰€æœ‰followerå®‰å…¨åœ°å¤åˆ¶æ–°æ¡ç›®ä¸ºæ­¢ã€‚</p><p>å½“æ¡ç›®ç”±åˆ›å»ºå®ƒçš„leaderå¤åˆ¶åˆ°å¤§å¤šæ•°æœåŠ¡å™¨æ—¶ï¼Œå°±è¢«è§†ä¸ºå·²æäº¤ã€‚æ‰€æœ‰ä»¥å‰çš„æ¡ç›®ï¼ŒåŒ…æ‹¬ç”±æ—©æœŸleaderåˆ›å»ºçš„æ¡ç›®ï¼Œä¹Ÿéƒ½è§†ä¸ºå·²æäº¤ã€‚è´Ÿè´£äººä¸€æ—¦æäº¤å°±æ‰§è¡Œè¯¥æ¡ç›®ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™clientã€‚</p><p>leaderåœ¨å…¶æ—¥å¿—ä¸­ç»´æŠ¤å®ƒçŸ¥é“è¦æäº¤çš„æœ€é«˜ç´¢å¼•ï¼Œå¹¶å°†å…¶ä¸AppendEntries RPCä¸€èµ·å‘é€ç»™å…¶followerã€‚ä¸€æ—¦followerå‘ç°æ¡ç›®å·²æäº¤ï¼Œå®ƒå°†æŒ‰é¡ºåºå°†æ¡ç›®åº”ç”¨äºå…¶çŠ¶æ€æœºã€‚</p><p>Raft ç»´æŠ¤ä»¥ä¸‹å±æ€§ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†æ—¥å¿—åŒ¹é…å±æ€§ã€‚</p><ul><li>å¦‚æœä¸åŒæ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®å…·æœ‰ç›¸åŒçš„ç´¢å¼•å’Œtermï¼Œé‚£ä¹ˆå®ƒä»¬å­˜å‚¨çš„æ˜¯åŒä¸€ä¸ªå‘½ä»¤ã€‚</li><li>å¦‚æœä¸åŒæ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®å…·æœ‰ç›¸åŒçš„ç´¢å¼•å’Œtermï¼Œé‚£ä¹ˆåœ¨å‰é¢çš„æ‰€æœ‰æ¡ç›®ä¸­ï¼Œæ—¥å¿—æ˜¯ç›¸åŒçš„ã€‚</li></ul><p>å½“å‘é€AppendEntries RPCæ—¶ï¼ŒleaderåŒ…æ‹¬ç´§æ¥åœ¨æ–°æ¡ç›®ä¹‹å‰çš„æ¡ç›®çš„termå·å’Œç´¢å¼•ã€‚å¦‚æœfolloweråœ¨è‡ªå·±çš„æ—¥å¿—ä¸­æ‰¾ä¸åˆ°ä¸è¯¥æ¡ç›®åŒ¹é…çš„æ¡ç›®ï¼Œå®ƒå°±ä¼šæ‹’ç»é™„åŠ æ–°æ¡ç›®çš„è¯·æ±‚ã€‚</p><p>è¿™ç§ä¸€è‡´æ€§æ£€æŸ¥å¯ä»¥è®©leaderå¾—å‡ºè¿™æ ·çš„ç»“è®ºï¼šæ¯å½“AppendEntriesä»followeræˆåŠŸè¿”å›æ—¶ï¼Œå®ƒä»¬çš„æ—¥å¿—éƒ½æ˜¯ç›¸åŒçš„ï¼Œç›´åˆ°RPCä¸­åŒ…å«çš„ç´¢å¼•ã€‚</p><p>ä½†æ˜¯åœ¨é¢å¯¹leaderå´©æºƒçš„æƒ…å†µä¸‹ï¼Œleaderå’Œfollowerçš„æ—¥å¿—å¯èƒ½ä¼šå˜å¾—ä¸ä¸€è‡´ã€‚</p><blockquote><p> åœ¨Raftä¸­ï¼Œleaderé€šè¿‡å¼ºåˆ¶followerçš„æ—¥å¿—å¤åˆ¶è‡ªå·±çš„æ—¥å¿—æ¥å¤„ç†ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™æ„å‘³ç€ï¼Œfolloweræ—¥å¿—ä¸­çš„å†²çªæ¡ç›®å°†è¢«leaderæ—¥å¿—ä¸­çš„æ¡ç›®è¦†ç›–ã€‚</p></blockquote><p>leaderè¯•å›¾æ‰¾åˆ°å…¶æ—¥å¿—ä¸followeræ—¥å¿—ç›¸åŒ¹é…çš„æœ€åä¸€ä¸ªç´¢å¼•ï¼Œåˆ é™¤å¤šä½™çš„æ¡ç›®ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¹¶æ·»åŠ æ–°çš„æ¡ç›®ã€‚</p><blockquote><p>leaderä¸ºæ¯ä¸ªfollowerç»´æŠ¤ä¸€ä¸ªnextIndexï¼Œå®ƒæ˜¯leaderå°†å‘é€ç»™è¯¥followerçš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ç´¢å¼•ã€‚å½“leaderç¬¬ä¸€æ¬¡ä¸Šç”µæ—¶ï¼Œå®ƒå°†æ‰€æœ‰çš„ nextIndex å€¼åˆå§‹åŒ–ä¸ºå…¶æ—¥å¿—ä¸­æœ€åä¸€æ¡åçš„ç´¢å¼•ã€‚</p></blockquote><p>æ¯å½“AppendRPCè¿”å›ä¸€ä¸ªfollowerå¤±è´¥æ—¶ï¼Œleaderå°±ä¼šé€’å‡nextIndexï¼Œå¹¶å‘å‡ºå¦ä¸€ä¸ªAppendEntries RPCã€‚æœ€ç»ˆï¼ŒnextIndexä¼šè¾¾åˆ°ä¸€ä¸ªå€¼ï¼Œåœ¨è¿™ä¸ªå€¼ä¸Šï¼Œæ—¥å¿—ä¼šè¶‹äºä¸€è‡´ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒAppendEntrieså°†ä¼šæˆåŠŸï¼Œå®ƒå¯ä»¥ä»leaderçš„æ—¥å¿—ä¸­åˆ é™¤æ— å…³çš„æ¡ç›®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¹¶æ·»åŠ æ–°çš„æ¡ç›®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å› æ­¤ï¼Œä»ä¸€ä¸ªfolloweræˆåŠŸçš„AppendEntrieså¯ä»¥ä¿è¯leaderçš„æ—¥å¿—ä¸å®ƒä¸€è‡´ã€‚</p><blockquote><p>é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œleaderåœ¨ä¸Šç”µæ—¶ä¸éœ€è¦é‡‡å–ä»»ä½•ç‰¹æ®Šçš„æ“ä½œæ¥æ¢å¤æ—¥å¿—ä¸€è‡´æ€§ã€‚å®ƒåªéœ€å¼€å§‹æ­£å¸¸çš„æ“ä½œï¼Œæ—¥å¿—å°±ä¼šè‡ªåŠ¨æ”¶æ•›ï¼Œä»¥åº”å¯¹Append-Entriesä¸€è‡´æ€§æ£€æŸ¥çš„å¤±è´¥ã€‚leaderä»ä¸è¦†ç›–æˆ–åˆ é™¤è‡ªå·±æ—¥å¿—ä¸­çš„æ¡ç›®ã€‚</p></blockquote><h2 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h2><p>Raftç¡®ä¿ä¸€ä¸ªtermçš„leaderåœ¨å…¶æ—¥å¿—ä¸­æ‰¿è¯ºäº†ä»¥å‰æ‰€æœ‰termçš„æ¡ç›®ã€‚<br>Raftç¡®ä¿ä¸€ä¸ªtermçš„leaderåœ¨å…¶æ—¥å¿—ä¸­å·²ç»æäº¤äº†ä»¥å‰æ‰€æœ‰termçš„æ¡ç›®ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ‰€æœ‰çš„æ—¥å¿—æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”çŠ¶æ€æœºæ‰§è¡Œç›¸åŒçš„å‘½ä»¤é›†ã€‚</p><p>åœ¨leaderé€‰ä¸¾æœŸé—´ï¼ŒRequestVote RPCåŒ…å«äº†candidateçš„æ—¥å¿—ä¿¡æ¯ã€‚å¦‚æœæŠ•ç¥¨è€…å‘ç°å®ƒçš„æ—¥å¿—æ¯”candidateçš„æ›´æ–°ï¼Œå®ƒå°±ä¸ä¼šæŠ•ç»™å®ƒã€‚</p><p>Raft é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªæ—¥å¿—ä¸­æœ€åæ¡ç›®çš„ç´¢å¼•å’Œtermæ¥ç¡®å®šå“ªä¸ªæ—¥å¿—æ›´åŠæ—¶ã€‚å¦‚æœæ—¥å¿—çš„æœ€åæ¡ç›®æœ‰ä¸åŒçš„termï¼Œé‚£ä¹ˆtermè¾ƒæ™šçš„æ—¥å¿—æ›´åŠæ—¶ã€‚å¦‚æœä¸¤ä¸ªæ—¥å¿—çš„æœ€åæ¡ç›®æœ‰ç›¸åŒçš„termï¼Œé‚£ä¹ˆå“ªä¸ªæ—¥å¿—æ›´é•¿ï¼Œå“ªä¸ªæ—¥å¿—å°±æ›´æœ€æ–°ã€‚</p><h2 id="é›†ç¾¤æˆå‘˜"><a href="#é›†ç¾¤æˆå‘˜" class="headerlink" title="é›†ç¾¤æˆå‘˜"></a>é›†ç¾¤æˆå‘˜</h2><p>ä¸ºäº†ä½¿é…ç½®å˜æ›´æœºåˆ¶å®‰å…¨ï¼Œåœ¨è¿‡æ¸¡æœŸé—´å¿…é¡»æ²¡æœ‰ä»»ä½•ä¸€ç‚¹å¯ä»¥è®©ä¸¤ä¸ªleaderåœ¨åŒä¸€termå†…å½“é€‰ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä»»ä½•æœåŠ¡å™¨ç›´æ¥ä»æ—§é…ç½®åˆ‡æ¢åˆ°æ–°é…ç½®çš„æ–¹æ³•éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚<br>Raftä½¿ç”¨äº†ä¸€ä¸ªä¸¤é˜¶æ®µçš„æ–¹æ³•æ¥æ”¹å˜é›†ç¾¤æˆå‘˜ã€‚é¦–å…ˆï¼Œå®ƒåˆ‡æ¢åˆ°ä¸€ä¸ªç§°ä¸ºè”åˆå…±è¯†çš„ä¸­é—´é…ç½®ã€‚ç„¶åï¼Œä¸€æ—¦è¿™ä¸€ç‚¹è¢«æ»¡è¶³ï¼Œå®ƒå°±ä¼šåˆ‡æ¢åˆ°æ–°çš„é…ç½®ã€‚</p><p>è”åˆå…±è¯†å…è®¸å„ä¸ªæœåŠ¡å™¨åœ¨ä¸åŒçš„æ—¶é—´åœ¨é…ç½®ä¹‹é—´è½¬æ¢ï¼Œè€Œä¸å½±å“å®‰å…¨ã€‚æ­¤å¤–ï¼Œè”åˆå…±è¯†è¿˜å…è®¸é›†ç¾¤åœ¨æ•´ä¸ªé…ç½®å˜åŒ–è¿‡ç¨‹ä¸­ç»§ç»­æœåŠ¡äºclientè¯·æ±‚ã€‚<br>è”åˆå…±è¯†å°†æ–°æ—§é…ç½®ç»“åˆèµ·æ¥ï¼Œå…·ä½“å¦‚ä¸‹ã€‚</p><ul><li>æ—¥å¿—æ¡ç›®è¢«å¤åˆ¶åˆ°ä¸¤ä¸ªé…ç½®ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨ä¸Šã€‚</li><li>ä»»ä½•æ–°æ—§æœåŠ¡å™¨éƒ½å¯ä»¥æˆä¸ºleaderã€‚</li><li>åè®®è¦æ±‚æ–°è€ç»„åˆåˆ†åˆ«è·å¾—å¤šæ•°ç¥¨ã€‚</li></ul><p>å½“leaderæ”¶åˆ°é…ç½®å˜æ›´æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šå­˜å‚¨å¹¶å¤åˆ¶åŠ å…¥å…±è¯†<code>C&lt;oldï¼Œnew&gt;</code>çš„æ¡ç›®ã€‚æœåŠ¡å™¨æ€»æ˜¯ä½¿ç”¨å…¶æ—¥å¿—ä¸­çš„æœ€æ–°é…ç½®æ¥åšå†³ç­–ï¼Œå³ä½¿å®ƒæ²¡æœ‰è¢«æäº¤ã€‚å½“è”åˆå…±è¯†è¢«æäº¤æ—¶ï¼Œåªæœ‰æ—¥å¿—ä¸­å«æœ‰<code>C&lt;oldï¼Œnew&gt;</code>çš„æœåŠ¡å™¨æ‰èƒ½æˆä¸ºleaderã€‚</p><p>ç°åœ¨ï¼Œleaderå¯ä»¥å®‰å…¨åœ°åˆ›å»ºä¸€ä¸ªæè¿°<code>C&lt;new&gt;</code>çš„æ—¥å¿—æ¡ç›®ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°é›†ç¾¤ä¸­ã€‚åŒæ ·ï¼Œè¿™ä¸ªé…ç½®ä¸€æ—¦è¢«çœ‹åˆ°ï¼Œå°±ä¼šåœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šç”Ÿæ•ˆã€‚å½“æ–°é…ç½®åœ¨<code>C&lt;new&gt;</code>çš„è§„åˆ™ä¸‹æäº¤åï¼Œæ—§é…ç½®å°±æ— å…³ç´§è¦äº†ï¼Œä¸åœ¨æ–°é…ç½®ä¸­çš„æœåŠ¡å™¨å¯ä»¥è¢«å…³é—­ã€‚</p><h2 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h2><p>è§<a href="http://thesecretlivesofdata.com/raft/">Raftåè®®å›¾è§£</a></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WakaTime - æ—¶é—´è®°å½•å·¥å…·</title>
      <link href="/2017/09/28/%E5%B7%A5%E5%85%B7/%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7%E4%B9%8BWakaTime/"/>
      <url>/2017/09/28/%E5%B7%A5%E5%85%B7/%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7%E4%B9%8BWakaTime/</url>
      
        <content type="html"><![CDATA[<p>æé«˜è‡ªåˆ¶åŠ›çš„ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹å¼å°±æ˜¯è‡ªæˆ‘é‡åŒ–ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„ç»´åº¦å³æ˜¯æ—¶é—´è®°å½•ï¼Œé€šè¿‡å¯¹æˆ‘ä»¬çš„å·¥ä½œã€ç”Ÿæ´»å„ä¸ªæ–¹é¢è¿›è¡Œæ•°æ®è®°å½•å’Œåˆ†æï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–è‡ªå·±çš„æ—¶é—´ç®¡ç†ç­–ç•¥ï¼Œæé«˜ç”Ÿäº§åŠ›ã€‚<br>å¯¹ç¨‹åºå‘˜è€Œè¨€ï¼Œæˆ‘ä»¬è¿«åˆ‡éœ€æ±‚æœ‰ä¸€ä¸ªå·¥å…·èƒ½å¤Ÿè®°å½•æˆ‘ä»¬åœ¨å·¥ä½œä¸­çš„æ—¶é—´åˆ†é…å’Œåˆ©ç”¨ç‡ã€‚å¯¹äºé¡¹ç›®ç®¡ç†è€Œè¨€ï¼Œä¹Ÿæœ‰äº†è§£å¼€å‘äººå‘˜å¼€å‘æ•ˆç‡çš„éœ€æ±‚ã€‚<br><a href="WakaTime.com">WakaTime</a>æ­£æ˜¯è¿™æ ·ä¸€ä¸ªå·¥å…·ã€‚å®ƒä¸“ä¸ºç¨‹åºå‘˜å’Œå¼€å‘è€…è€Œè®¾è®¡ï¼Œé€šè¿‡ç®€å•é…ç½®ï¼Œå®ƒå°±å¯ä»¥è®°å½•æˆ‘ä»¬èŠ±åœ¨å„ä¸ªé¡¹ç›®ã€å„ç§å·¥å…·(IDEã€æµè§ˆå™¨ã€ç¼–è¾‘å™¨ç­‰)ä»¥åŠå…·ä½“å·¥ä½œå†…å®¹çš„æ—¶é—´ã€‚<br>å¯¹æ¯”Rescuetimeçš„å¤§è€Œå…¨ï¼ŒWakatimeä¸“ç²¾äºè®°å½•ç¼–ç¨‹å’Œç¼–è¾‘çš„æ–¹é¢ã€‚æ¨èå¼€å‘è€…éƒ½å»è¯•è¯•ï¼Œè‡³å°‘å¯ä»¥å¸®åŠ©æå‡è‡ªåˆ¶åŠ›â€¦ :)</p><a id="more"></a><p>ã€‚</p><center>â–³ WakaTime ä»ªè¡¨ç›˜</center><h3 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h3><p>é¦–å…ˆå»<a href="WakaTime.com">WakaTime</a>æ³¨å†Œä¸€ä¸ªè´¦æˆ·ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è‡ªå·±çš„Githubè´¦æˆ·æ¥æˆæƒç™»é™†WakaTimeã€‚ç„¶åæˆ‘ä»¬éœ€è¦ç»™æˆ‘ä»¬çš„IDEæˆ–è€…ç¼–è¾‘å™¨å®‰è£…WakaTimeæ—¶é—´è®°å½•æ’ä»¶ï¼Œç›®å‰WakaTimeå·²ç»åŸºæœ¬æ”¯æŒä¸»æµçš„IDEã€‚</p><h3 id="å®‰è£…IDEæ’ä»¶"><a href="#å®‰è£…IDEæ’ä»¶" class="headerlink" title="å®‰è£…IDEæ’ä»¶"></a>å®‰è£…IDEæ’ä»¶</h3><p>æˆ‘ä»¬ä»¥VS Codeå’ŒChromeä¸ºä¾‹ï¼Œåˆ†åˆ«ç»™IDEå’Œæµè§ˆå™¨å®‰è£…æ’ä»¶ã€‚</p><p>ç‚¹å‡»å·¦è¾¹æ Supported IDESè¿™ä¸ªé€‰é¡¹ï¼Œç„¶åç‚¹å‡»VS Codeé€‰é¡¹ã€‚</p><p>æŒ‰ç…§å®˜ç½‘çš„æç¤ºï¼Œæˆ‘ä»¬åœ¨VS Code ä¸­ä¸‹è½½å¥½æ’ä»¶ï¼Œé‡å¯VS Code</p><p>æŒ‰<code>F1</code>ï¼Œå‡ºç°é€‰é¡¹æ¡†</p><p>é€‰æ‹©WakaTime API Keyï¼Œ æ­¤æ—¶æˆ‘ä»¬éœ€è¦å»<a href="https://WakaTime.com/settings/account">WakaTime Account</a>é¡µé¢è·å–æˆ‘ä»¬çš„API Keyï¼Œæ¥å…³è”æˆ‘ä»¬çš„è´¦æˆ·ã€‚</p><p>æŠŠAPI Keyå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°VS Codeçš„WakaTime API Keyæ¡†ï¼Œç„¶å<code>Enter</code>ã€‚</p><p>æ­¤æ—¶VS Codeçš„WakaTimeå°±é…ç½®å®Œæˆäº†ã€‚</p><h3 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h3><p>åˆ°<a href="https://WakaTime.com/dashboard">WakaTime Dashboard</a>é¡µé¢æŸ¥çœ‹ï¼Œæˆ‘ä»¬çš„VS Codeå·²ç»å¼€å§‹è®°å½•äº†ã€‚</p><p>(æˆ‘è¿™é‡Œæ˜¯å·²ç»å®‰è£…äº†å¤šä¸ªIDEæ’ä»¶çš„ç»“æœ)</p><p>å¦‚æœVS Codeæ‰“å¼€äº†ä¸€ä¸ªé¡¹ç›®ï¼Œä¾‹å¦‚æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªtcpudpçš„demoã€‚</p><p>åœ¨<a href="https://WakaTime.com/dashboard">WakaTime Dashboard</a>çš„ä¸‹é¢çš„Projectsæ å°±ä¼šå¤šå‡ºä¸€ä¸ª</p><p>é‡Œé¢ä¹Ÿæœ‰é¡¹ç›®æ‰€ç”¨è¯­è¨€ã€ç¼–è¾‘å™¨çš„ç»†èŠ‚ã€‚</p><p><a href="https://WakaTime.com/dashboard">WakaTime Dashboard</a>ä¹Ÿæœ‰å„ä¸ªé¡¹ç›®çš„æ—¶é—´è½´ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘ä»¬åœ¨æ¯ä¸ªé¡¹ç›®ä¸ŠèŠ±çš„æ—¶é—´ã€‚</p><h3 id="è®¾ç½®ç›®æ ‡"><a href="#è®¾ç½®ç›®æ ‡" class="headerlink" title="è®¾ç½®ç›®æ ‡"></a>è®¾ç½®ç›®æ ‡</h3><p>æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªé¡¹ç›®è®¾ç½®æ¯æ—¥è¦å®Œæˆçš„ç›®æ ‡ï¼Œä¾‹å¦‚æ¯å·¥ä½œæ—¥èŠ±ä¸‰å°æ—¶ã€‚</p><p>å¯ä»¥è®¢é˜…è¿™ä¸ªç›®æ ‡ï¼Œç„¶åç³»ç»Ÿä¼šå‘é€é‚®ä»¶ç»™æˆ‘ä»¬æé†’ã€‚</p><h3 id="é›†æˆåˆ°å…¶ä»–ç½‘ç«™"><a href="#é›†æˆåˆ°å…¶ä»–ç½‘ç«™" class="headerlink" title="é›†æˆåˆ°å…¶ä»–ç½‘ç«™"></a>é›†æˆåˆ°å…¶ä»–ç½‘ç«™</h3><p>WakaTimeæä¾›äº†ç»Ÿè®¡ç»“æœçš„HTMLä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ†äº«åˆ°Facebookç­‰ç¤¾äº¤ç½‘ç«™ä¸Šï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‚åœ¨æˆ‘ä»¬çš„åšå®¢ä¸Šã€‚</p><h3 id="ç§¯åˆ†æ¦œ"><a href="#ç§¯åˆ†æ¦œ" class="headerlink" title="ç§¯åˆ†æ¦œ"></a>ç§¯åˆ†æ¦œ</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠè‡ªå·±çš„æ•°æ®æ”¾åœ¨Leaderboardsä¸Šå»æ’ä½ã€‚</p><h3 id="APIæ–‡æ¡£"><a href="#APIæ–‡æ¡£" class="headerlink" title="APIæ–‡æ¡£"></a>APIæ–‡æ¡£</h3><p>å¯ä»¥åœ¨<a href="https://WakaTime.com/developers">WakaTime API</a>é‡Œé¢æŸ¥è¯¢WakaTimeæä¾›çš„APIï¼Œæ¥è¿›è¡Œä¸°å¯Œçš„åŠŸèƒ½å®šåˆ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶é—´ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¹‹CAPå®šç†</title>
      <link href="/2017/09/20/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B9%8BCAP%E5%AE%9A%E7%90%86/"/>
      <url>/2017/09/20/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B9%8BCAP%E5%AE%9A%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯CAPå®šç†"><a href="#ä»€ä¹ˆæ˜¯CAPå®šç†" class="headerlink" title="ä»€ä¹ˆæ˜¯CAPå®šç†"></a>ä»€ä¹ˆæ˜¯CAPå®šç†</h2><blockquote><p>CAPç”±<a href="https://en.wikipedia.org/wiki/Eric_Brewer_(scientist">Eric Brewer</a>)åœ¨2000å¹´PODCä¼šè®®ä¸Šæå‡ºï¼Œæ˜¯Eric Breweråœ¨InktomiæœŸé—´ç ”å‘æœç´¢å¼•æ“ã€åˆ†å¸ƒå¼webç¼“å­˜æ—¶å¾—å‡ºçš„å…³äºæ•°æ®ä¸€è‡´æ€§(consistency)ã€æœåŠ¡å¯ç”¨æ€§(availability)ã€åˆ†åŒºå®¹é”™æ€§(partition-tolerance)çš„çŒœæƒ³ï¼š</p><p>It is impossible for a web service to provide the three following guarantees : Consistency, Availability and Partition-tolerance.</p></blockquote><p>C ä»£è¡¨ Consistency ä¸€è‡´æ€§ï¼Œ A ä»£è¡¨ Availability å¯ç”¨æ€§ï¼Œ P ä»£è¡¨ partition-tolerance åˆ†åŒºå®¹é”™æ€§ã€‚<br><a id="more"></a></p><ul><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>(consistency)ï¼šå¦‚æœç³»ç»Ÿå¯¹ä¸€ä¸ªå†™æ“ä½œè¿”å›æˆåŠŸï¼Œé‚£ä¹ˆä¹‹åçš„è¯»è¯·æ±‚éƒ½å¿…é¡»è¯»åˆ°è¿™ä¸ªæ–°æ•°æ®ï¼›å¦‚æœè¿”å›å¤±è´¥ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯»æ“ä½œéƒ½ä¸èƒ½è¯»åˆ°è¿™ä¸ªæ•°æ®ï¼Œå¯¹è°ƒç”¨è€…è€Œè¨€æ•°æ®å…·æœ‰å¼ºä¸€è‡´æ€§(strong consistency) (åˆå«åŸå­æ€§ atomicã€çº¿æ€§ä¸€è‡´æ€§ linearizable consistency)</li><li><strong>æœåŠ¡å¯ç”¨æ€§</strong>(availability)ï¼šæ‰€æœ‰è¯»å†™è¯·æ±‚åœ¨ä¸€å®šæ—¶é—´å†…å¾—åˆ°å“åº”ï¼Œå¯ç»ˆæ­¢ã€ä¸ä¼šä¸€ç›´ç­‰å¾…</li><li><strong>åˆ†åŒºå®¹é”™æ€§</strong>(partition-tolerance)ï¼šåœ¨ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œè¢«åˆ†éš”çš„èŠ‚ç‚¹ä»èƒ½æ­£å¸¸å¯¹å¤–æœåŠ¡</li></ul><p>åœ¨æŸæ—¶åˆ»å¦‚æœæ»¡è¶³APï¼Œåˆ†éš”çš„èŠ‚ç‚¹åŒæ—¶å¯¹å¤–æœåŠ¡ä½†ä¸èƒ½ç›¸äº’é€šä¿¡ï¼Œå°†å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ï¼Œå³ä¸èƒ½æ»¡è¶³Cï¼›å¦‚æœæ»¡è¶³CPï¼Œç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ä¸ºè¾¾æˆCï¼Œè¯·æ±‚åªèƒ½ä¸€ç›´ç­‰å¾…ï¼Œå³ä¸æ»¡è¶³Aï¼›å¦‚æœè¦æ»¡è¶³CAï¼Œåœ¨ä¸€å®šæ—¶é—´å†…è¦è¾¾åˆ°èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ï¼Œè¦æ±‚ä¸èƒ½å‡ºç°ç½‘ç»œåˆ†åŒºï¼Œåˆ™ä¸èƒ½æ»¡è¶³Pã€‚å³Cã€Aã€Pä¸‰è€…æœ€å¤šåªèƒ½æ»¡è¶³å…¶ä¸­ä¸¤ä¸ªã€‚</p><h2 id="è®ºè¯"><a href="#è®ºè¯" class="headerlink" title="è®ºè¯"></a>è®ºè¯</h2><p>å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯æˆ‘ä»¬è¯æ˜CAPçš„åŸºæœ¬åœºæ™¯ï¼Œç½‘ç»œä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹N1å’ŒN2ï¼Œå¯ä»¥ç®€å•çš„ç†è§£N1å’ŒN2åˆ†åˆ«æ˜¯ä¸¤å°è®¡ç®—æœºï¼Œä»–ä»¬ä¹‹é—´ç½‘ç»œå¯ä»¥è¿é€šï¼ŒN1ä¸­æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºAï¼Œå’Œä¸€ä¸ªæ•°æ®åº“Vï¼ŒN2ä¹Ÿæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºBå’Œä¸€ä¸ªæ•°æ®åº“Vã€‚ç°åœ¨ï¼ŒAå’ŒBæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒVæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®å­˜å‚¨çš„ä¸¤ä¸ªå­æ•°æ®åº“ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/aOhnCg5yRKJikSm.jpg" alt="fb6d8e8e-1cc2-4ab2-8691-6010d8a4c0cd"></p><p>åœ¨æ»¡è¶³ä¸€è‡´æ€§çš„æ—¶å€™ï¼ŒN1å’ŒN2ä¸­çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼ŒV0=V0ã€‚<br>åœ¨æ»¡è¶³å¯ç”¨æ€§çš„æ—¶å€™ï¼Œç”¨æˆ·ä¸ç®¡æ˜¯è¯·æ±‚N1æˆ–è€…N2ï¼Œéƒ½ä¼šå¾—åˆ°ç«‹å³å“åº”ã€‚<br>åœ¨æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„æƒ…å†µä¸‹ï¼ŒN1å’ŒN2æœ‰ä»»ä½•ä¸€æ–¹å®•æœºï¼Œæˆ–è€…ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œéƒ½ä¸ä¼šå½±å“N1å’ŒN2å½¼æ­¤ä¹‹é—´çš„æ­£å¸¸è¿ä½œã€‚</p><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¿™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ­£å¸¸è¿è½¬çš„æµç¨‹ï¼Œç”¨æˆ·å‘N1æœºå™¨è¯·æ±‚æ•°æ®æ›´æ–°ï¼Œç¨‹åºAæ›´æ–°æ•°æ®åº“V0ä¸ºV1ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿå°†æ•°æ®è¿›è¡ŒåŒæ­¥æ“ä½œMï¼Œå°†V1åŒæ­¥çš„N2ä¸­V0ï¼Œä½¿å¾—N2ä¸­çš„æ•°æ®V0ä¹Ÿæ›´æ–°ä¸ºV1ï¼ŒN2ä¸­çš„æ•°æ®å†å“åº”N2çš„è¯·æ±‚ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/Vul7CZY5i4AxeH8.jpg" alt="04910e6c-a768-4b8c-b9a0-0149006803d4"></p><p>æ ¹æ®CAPåŸåˆ™å®šä¹‰ï¼Œç³»ç»Ÿçš„ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ç»†åˆ†å¦‚ä¸‹ï¼š</p><p>ä¸€è‡´æ€§ï¼šN1å’ŒN2çš„æ•°æ®åº“Vä¹‹é—´çš„æ•°æ®æ˜¯å¦å®Œå…¨ä¸€æ ·ã€‚<br>å¯ç”¨æ€§ï¼šN1å’ŒN2çš„å¯¹å¤–éƒ¨çš„è¯·æ±‚èƒ½å¦åšå‡ºæ­£å¸¸çš„å“åº”ã€‚<br>åˆ†åŒºå®¹é”™æ€§ï¼šN1å’ŒN2ä¹‹é—´çš„ç½‘ç»œæ˜¯å¦äº’é€šã€‚</p><p>è¿™æ˜¯æ­£å¸¸è¿ä½œçš„åœºæ™¯ï¼Œä¹Ÿæ˜¯ç†æƒ³çš„åœºæ™¯ã€‚ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒå’Œå•æœºç³»ç»Ÿçš„æœ€å¤§åŒºåˆ«ï¼Œå°±åœ¨äºç½‘ç»œã€‚ç°åœ¨å‡è®¾ä¸€ç§æç«¯æƒ…å†µï¼ŒN1å’ŒN2ä¹‹é—´çš„ç½‘ç»œæ–­å¼€äº†ï¼Œæˆ‘ä»¬è¦æ”¯æŒè¿™ç§ç½‘ç»œå¼‚å¸¸ã€‚ç›¸å½“äºè¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§ï¼Œèƒ½ä¸èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§å‘¢ï¼Ÿè¿˜æ˜¯è¯´è¦å¯¹ä»–ä»¬è¿›è¡Œå–èˆï¼Ÿ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/22/oBEMSxLCYl98QfU.jpg" alt="bcf62eb4-d42e-4380-95de-dd4bdad228d8"></p><p>å‡è®¾åœ¨N1å’ŒN2ä¹‹é—´ç½‘ç»œæ–­å¼€çš„æ—¶å€™ï¼Œæœ‰ç”¨æˆ·å‘N1å‘é€æ•°æ®æ›´æ–°è¯·æ±‚ï¼Œé‚£N1ä¸­çš„æ•°æ®V0å°†è¢«æ›´æ–°ä¸ºV1ã€‚ç”±äºç½‘ç»œæ˜¯æ–­å¼€çš„ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼ç³»ç»ŸåŒæ­¥æ“ä½œMï¼Œæ‰€ä»¥N2ä¸­çš„æ•°æ®ä¾æ—§æ˜¯V0ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæœ‰ç”¨æˆ·å‘N2å‘é€æ•°æ®è¯»å–è¯·æ±‚ï¼Œç”±äºæ•°æ®è¿˜æ²¡æœ‰è¿›è¡ŒåŒæ­¥ï¼Œåº”ç”¨ç¨‹åºæ²¡åŠæ³•ç«‹å³ç»™ç”¨æˆ·è¿”å›æœ€æ–°çš„æ•°æ®V1ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ<br>è¿™é‡Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><p>ç¬¬ä¸€ï¼šç‰ºç‰²æ•°æ®ä¸€è‡´æ€§ï¼Œä¿è¯å¯ç”¨æ€§ã€‚å“åº”æ—§çš„æ•°æ®V0ç»™ç”¨æˆ·ã€‚<br>ç¬¬äºŒï¼šç‰ºç‰²å¯ç”¨æ€§ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç½‘ç»œè¿æ¥æ¢å¤ï¼Œæ•°æ®æ›´æ–°æ“ä½œMå®Œæˆä¹‹åï¼Œå†ç»™ç”¨æˆ·å“åº”æœ€æ–°çš„æ•°æ®V1ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯æ˜äº†è¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¸¤è€…ä¸­ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚</p><h2 id="æƒè¡¡-Trade-off"><a href="#æƒè¡¡-Trade-off" class="headerlink" title="æƒè¡¡ Trade-off"></a>æƒè¡¡ Trade-off</h2><p>é€šè¿‡CAPç†è®ºï¼Œæˆ‘ä»¬çŸ¥é“æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œé‚£è¦èˆå¼ƒå“ªä¸ªå‘¢ï¼Ÿ</p><h3 id="CA-without-P"><a href="#CA-without-P" class="headerlink" title="CA without P"></a>CA without P</h3><p>å¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†å…¶å®åˆ†åŒºä¸æ˜¯ä½ æƒ³ä¸æƒ³çš„é—®é¢˜ï¼Œè€Œæ˜¯å§‹ç»ˆä¼šå­˜åœ¨ï¼Œå› æ­¤CAçš„ç³»ç»Ÿæ›´å¤šçš„æ˜¯å…è®¸åˆ†åŒºåå„å­ç³»ç»Ÿä¾ç„¶ä¿æŒCAã€‚</p><h3 id="CP-without-A"><a href="#CP-without-A" class="headerlink" title="CP without A"></a>CP without A</h3><p>å¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨Serverä¹‹é—´å¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿ï¼Œå¦‚æ­¤CPä¹Ÿæ˜¯å¯ä»¥ä¿è¯çš„ã€‚å¾ˆå¤šä¼ ç»Ÿçš„æ•°æ®åº“åˆ†å¸ƒå¼äº‹åŠ¡éƒ½å±äºè¿™ç§æ¨¡å¼ã€‚</p><h3 id="AP-wihtout-C"><a href="#AP-wihtout-C" class="headerlink" title="AP wihtout C"></a>AP wihtout C</h3><p>è¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ç°åœ¨ä¼—å¤šçš„NoSQLéƒ½å±äºæ­¤ç±»ã€‚</p><h3 id="æœ€ç»ˆä¸€è‡´æ€§"><a href="#æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§"></a>æœ€ç»ˆä¸€è‡´æ€§</h3><p>æ ¹æ®CAPå®šç†ï¼Œæˆ‘ä»¬è¦ä¸æ˜¯é€‰æ‹©Cï¼ˆä¸€è‡´æ€§ï¼‰è€Œæ”¾å¼ƒAï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œå°±æ˜¯åè¿‡æ¥ã€‚ä½†ç°å®ä¸–ç•Œçš„æƒ…å†µï¼Œå¾€å¾€ä¸æ˜¯è¿™ä¹ˆåœ°éé»‘å³ç™½ã€‚ä¾ç…§ä¸åŒçš„å•†ä¸šé€»è¾‘ä¸ä½¿ç”¨æƒ…å¢ƒï¼Œåœ¨ä¸¤è€…é—´å–å¾—å¹³è¡¡çš„è®¾è®¡æ˜¯éå¸¸æ™®éçš„ã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºCï¼ˆä¸€è‡´æ€§ï¼‰è€Œè¨€ï¼Œæˆ‘ä»¬æŠŠCAPå®šç†æ‰€å®šä¹‰çš„ä¸€è‡´æ€§ç§°ä¸º<strong>å¼ºä¸€è‡´æ€§ï¼ˆstrong consistencyï¼‰</strong>ã€‚é€‚åˆå¤„ç†åƒæ˜¯é‡‘é’±ã€ä»˜æ¬¾è¿™ç§å¯¹èµ„æ–™åŒæ­¥é«˜åº¦è¦æ±‚çš„ä»»åŠ¡ã€‚ä½†ç›¸å¯¹çš„ï¼Œæ‰©å±•æ€§ã€å¯ç”¨æ€§å°±ä¼šæ¯”è¾ƒå±€é™ï¼ˆæƒ³åƒä¸€ä¸‹ï¼Œè‹¥æ•°æ®åº“çš„æ•°é‡æŒç»­åœ°å¢åŠ ï¼ŒåŒæ­¥æ‰€æœ‰æ•°æ®çš„æˆæœ¬ä¹Ÿä¼šä¸æ–­ä¸Šå‡ï¼‰ã€‚<br>ä¸å¼ºä¸€è‡´æ€§ç›¸å¯¹çš„æ˜¯æ‰€è°“çš„æœ€ç»ˆä¸€è‡´æ€§ï¼ˆeventually consistencyï¼‰ã€‚å½“ä½¿ç”¨è€…æ›´æ–°æŸç¬”èµ„æ–™æ—¶ï¼Œä¹Ÿè®¸å› ä¸ºç½‘è·¯æš‚æ—¶ä¸­æ–­æˆ–å»¶è¿Ÿï¼Œæ²¡æœ‰å³æ—¶åŒæ­¥åˆ°å¦ä¸€ä¸ªèµ„æ–™åº“ã€‚æˆ‘ä»¬è¿˜æ˜¯è®©å…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç»§ç»­å­˜å–èµ„æ–™ï¼ˆä¸æ˜¯æœ€æ–°çš„ä¹Ÿæ²¡å…³ç³»ï¼‰ï¼Œä½†æœ€ç»ˆï¼Œæˆ‘ä»¬ä¿è¯è¿™ç¬”èµ„æ–™ä¸€å®šä¼šåŒæ­¥ï¼ˆæœ€åçš„ç»“æœè¿˜æ˜¯å¯¹çš„ï¼‰ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬ä»ä½†ä¸€ç³»ç»Ÿå¼€å§‹ï¼Œéšç€æµé‡å¢é•¿ï¼Œæ¼”å˜ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸‹ï¼Œä¼šé‡åˆ°ç½‘ç»œé—®é¢˜å¯¼è‡´çš„æ•°æ®åˆ†åŒºã€‚CAPå®šç†å°±æ˜¯ç”¨æ¥æ¢è®¨åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿåœ¨è®¾è®¡ä¸Šå¿…é¡»åšå‡ºçš„å–èˆã€‚å…¶ä¸­CAçš„ç³»ç»Ÿå¯¹äºCAPå®šç†æ„ä¹‰ä¸å¤§ï¼Œäºæ˜¯æˆ‘ä»¬åˆ†åˆ«æ¢è®¨CPå’ŒAPçš„æƒ…å†µã€‚</p><p>å¯¹äºæŸäº›ç‰¹æ®Šæƒ…å†µï¼Œä¾‹å¦‚å¯¹äºæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰ä¸€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒCå¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯CAï¼Œèˆå¼ƒPã€‚è²Œä¼¼è¿™å‡ å¹´å›½å†…é“¶è¡Œä¸šå‘ç”Ÿäº†ä¸ä¸‹10èµ·äº‹æ•…ï¼Œä½†å½±å“é¢ä¸å¤§ï¼ŒæŠ¥åˆ°ä¹Ÿä¸å¤šï¼Œå¹¿å¤§ç¾¤ä¼—çŸ¥é“çš„å°‘ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ä¿è¯CPï¼Œèˆå¼ƒAï¼Œä¾‹å¦‚ç½‘ç»œæ•…éšœæ—¶åªè¯»ä¸å†™ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé¢è¯•é¢˜è¯¦è§£</title>
      <link href="/2017/09/09/MySQL/MySQL%E9%9D%A2%E8%AF%95%E9%A2%98%E8%AF%A6%E8%A7%A3/"/>
      <url>/2017/09/09/MySQL/MySQL%E9%9D%A2%E8%AF%95%E9%A2%98%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>æ€»ç»“ä¸€æ³¢MySQLé¢è¯•é¢˜ã€‚</p><a id="more"></a><h2 id="æ•°æ®åº“åŸºç¡€çŸ¥è¯†"><a href="#æ•°æ®åº“åŸºç¡€çŸ¥è¯†" class="headerlink" title="æ•°æ®åº“åŸºç¡€çŸ¥è¯†"></a>æ•°æ®åº“åŸºç¡€çŸ¥è¯†</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“</h3><p><strong>æ•°æ®ä¿å­˜åœ¨å†…å­˜</strong></p><p>ä¼˜ç‚¹ï¼š å­˜å–é€Ÿåº¦å¿«</p><p>ç¼ºç‚¹ï¼š æ•°æ®ä¸èƒ½æ°¸ä¹…ä¿å­˜</p><p><strong>æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶</strong></p><p>ä¼˜ç‚¹ï¼š æ•°æ®æ°¸ä¹…ä¿å­˜</p><p>ç¼ºç‚¹ï¼š1ï¼‰é€Ÿåº¦æ¯”å†…å­˜æ“ä½œæ…¢ï¼Œé¢‘ç¹çš„IOæ“ä½œã€‚2ï¼‰æŸ¥è¯¢æ•°æ®ä¸æ–¹ä¾¿</p><p><strong>æ•°æ®ä¿å­˜åœ¨æ•°æ®åº“</strong></p><p>1ï¼‰æ•°æ®æ°¸ä¹…ä¿å­˜</p><p>2ï¼‰ä½¿ç”¨SQLè¯­å¥ï¼ŒæŸ¥è¯¢æ–¹ä¾¿æ•ˆç‡é«˜ã€‚</p><p>3ï¼‰ç®¡ç†æ•°æ®æ–¹ä¾¿</p><h3 id="ä»€ä¹ˆæ˜¯SQLï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SQLï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SQLï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SQLï¼Ÿ</h3><p>ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€(Structured Query Language)ç®€ç§°SQLï¼Œæ˜¯ä¸€ç§æ•°æ®åº“æŸ¥è¯¢è¯­è¨€ã€‚</p><p>ä½œç”¨ï¼šç”¨äºå­˜å–æ•°æ®ã€æŸ¥è¯¢ã€æ›´æ–°å’Œç®¡ç†å…³ç³»æ•°æ®åº“ç³»ç»Ÿã€‚</p><h3 id="ä»€ä¹ˆæ˜¯MySQL"><a href="#ä»€ä¹ˆæ˜¯MySQL" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQL?"></a>ä»€ä¹ˆæ˜¯MySQL?</h3><p>MySQLæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œç”±ç‘å…¸MySQL AB å…¬å¸å¼€å‘ï¼Œå±äº Oracle æ——ä¸‹äº§å“ã€‚MySQL æ˜¯æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¹‹ä¸€ï¼Œåœ¨ WEB åº”ç”¨æ–¹é¢ï¼ŒMySQLæ˜¯æœ€å¥½çš„ RDBMS (Relational Database Management Systemï¼Œå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ) åº”ç”¨è½¯ä»¶ä¹‹ä¸€ã€‚åœ¨Javaä¼ä¸šçº§å¼€å‘ä¸­éå¸¸å¸¸ç”¨ï¼Œå› ä¸º MySQL æ˜¯å¼€æºå…è´¹çš„ï¼Œå¹¶ä¸”æ–¹ä¾¿æ‰©å±•ã€‚</p><h3 id="æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ"><a href="#æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ"></a>æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ</h3><p>ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªåˆ—éƒ½ä¸å¯ä»¥å†æ‹†åˆ†ã€‚</p><p>ç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸èƒ½æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—åªä¾èµ–äºä¸»é”®ï¼Œä¸ä¾èµ–äºå…¶ä»–éä¸»é”®ã€‚</p><p>åœ¨è®¾è®¡æ•°æ®åº“ç»“æ„çš„æ—¶å€™ï¼Œè¦å°½é‡éµå®ˆä¸‰èŒƒå¼ï¼Œå¦‚æœä¸éµå®ˆï¼Œå¿…é¡»æœ‰è¶³å¤Ÿçš„ç†ç”±ã€‚æ¯”å¦‚æ€§èƒ½ã€‚äº‹å®ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šä¸ºäº†æ€§èƒ½è€Œå¦¥åæ•°æ®åº“çš„è®¾è®¡ã€‚</p><h3 id="mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª"><a href="#mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª" class="headerlink" title="mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª"></a>mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª</h3><p>MySQLæœåŠ¡å™¨é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œæƒé™è¡¨å­˜æ”¾åœ¨mysqlæ•°æ®åº“é‡Œï¼Œç”±mysql_install_dbè„šæœ¬åˆå§‹åŒ–ã€‚è¿™äº›æƒé™è¡¨åˆ†åˆ«userï¼Œdbï¼Œtable_privï¼Œcolumns_privå’Œhostã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™äº›è¡¨çš„ç»“æ„å’Œå†…å®¹ï¼š</p><ul><li>useræƒé™è¡¨ï¼šè®°å½•å…è®¸è¿æ¥åˆ°æœåŠ¡å™¨çš„ç”¨æˆ·å¸å·ä¿¡æ¯ï¼Œé‡Œé¢çš„æƒé™æ˜¯å…¨å±€çº§çš„ã€‚</li><li>dbæƒé™è¡¨ï¼šè®°å½•å„ä¸ªå¸å·åœ¨å„ä¸ªæ•°æ®åº“ä¸Šçš„æ“ä½œæƒé™ã€‚</li><li>table_privæƒé™è¡¨ï¼šè®°å½•æ•°æ®è¡¨çº§çš„æ“ä½œæƒé™ã€‚</li><li>columns_privæƒé™è¡¨ï¼šè®°å½•æ•°æ®åˆ—çº§çš„æ“ä½œæƒé™ã€‚</li><li>hostæƒé™è¡¨ï¼šé…åˆdbæƒé™è¡¨å¯¹ç»™å®šä¸»æœºä¸Šæ•°æ®åº“çº§æ“ä½œæƒé™ä½œæ›´ç»†è‡´çš„æ§åˆ¶ã€‚è¿™ä¸ªæƒé™è¡¨ä¸å—GRANTå’ŒREVOKEè¯­å¥çš„å½±å“ã€‚</li></ul><h3 id="MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>æœ‰ä¸‰ç§æ ¼å¼ï¼Œstatementï¼Œrowå’Œmixedã€‚</p><ul><li>statementæ¨¡å¼ä¸‹ï¼Œæ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½ã€‚ç”±äºsqlçš„æ‰§è¡Œæ˜¯æœ‰ä¸Šä¸‹æ–‡çš„ï¼Œå› æ­¤åœ¨ä¿å­˜çš„æ—¶å€™éœ€è¦ä¿å­˜ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€äº›ä½¿ç”¨äº†å‡½æ•°ä¹‹ç±»çš„è¯­å¥æ— æ³•è¢«è®°å½•å¤åˆ¶ã€‚</li><li>rowçº§åˆ«ä¸‹ï¼Œä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚è®°å½•å•å…ƒä¸ºæ¯ä¸€è¡Œçš„æ”¹åŠ¨ï¼ŒåŸºæœ¬æ˜¯å¯ä»¥å…¨éƒ¨è®°ä¸‹æ¥ä½†æ˜¯ç”±äºå¾ˆå¤šæ“ä½œï¼Œä¼šå¯¼è‡´å¤§é‡è¡Œçš„æ”¹åŠ¨(æ¯”å¦‚alter table)ï¼Œå› æ­¤è¿™ç§æ¨¡å¼çš„æ–‡ä»¶ä¿å­˜çš„ä¿¡æ¯å¤ªå¤šï¼Œæ—¥å¿—é‡å¤ªå¤§ã€‚</li><li>mixedï¼Œä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œæ™®é€šæ“ä½œä½¿ç”¨statementè®°å½•ï¼Œå½“æ— æ³•ä½¿ç”¨statementçš„æ—¶å€™ä½¿ç”¨rowã€‚</li></ul><p>æ­¤å¤–ï¼Œæ–°ç‰ˆçš„MySQLä¸­å¯¹rowçº§åˆ«ä¹Ÿåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå½“è¡¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¼šè®°å½•è¯­å¥è€Œä¸æ˜¯é€è¡Œè®°å½•ã€‚</p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹"><a href="#mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹" class="headerlink" title="mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹"></a>mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹</h3><div class="table-container"><table><thead><tr><th><strong>åˆ†ç±»</strong></th><th><strong>ç±»å‹åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>æ•´æ•°ç±»å‹</strong></td><td>tinyInt</td><td>å¾ˆå°çš„æ•´æ•°(8ä½äºŒè¿›åˆ¶)</td></tr><tr><td></td><td>smallint</td><td>å°çš„æ•´æ•°(16ä½äºŒè¿›åˆ¶)</td></tr><tr><td></td><td>mediumint</td><td>ä¸­ç­‰å¤§å°çš„æ•´æ•°(24ä½äºŒè¿›åˆ¶)</td></tr><tr><td></td><td>int(integer)</td><td>æ™®é€šå¤§å°çš„æ•´æ•°(32ä½äºŒè¿›åˆ¶)</td></tr><tr><td><strong>å°æ•°ç±»å‹</strong></td><td>float</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td></td><td>double</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td></td><td>decimal(m,d)</td><td>å‹ç¼©ä¸¥æ ¼çš„å®šç‚¹æ•°</td></tr><tr><td><strong>æ—¥æœŸç±»å‹</strong></td><td>year</td><td>YYYY 1901~2155</td></tr><tr><td></td><td>time</td><td>HH:MM:SS -838:59:59~838:59:59</td></tr><tr><td></td><td>date</td><td>YYYY-MM-DD 1000-01-01~9999-12-3</td></tr><tr><td></td><td>datetime</td><td>YYYY-MM-DD HH:MM:SS 1000-01-01 00:00:00~ 9999-12-31 23:59:59</td></tr><tr><td></td><td>timestamp</td><td>YYYY-MM-DD HH:MM:SS 19700101 00:00:01 UTC~2038-01-19 03:14:07UTC</td></tr><tr><td><strong>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</strong></td><td>CHAR(M)</td><td>Mä¸º0~255ä¹‹é—´çš„æ•´æ•°</td></tr><tr><td></td><td>VARCHAR(M)</td><td>Mä¸º0~65535ä¹‹é—´çš„æ•´æ•°</td></tr><tr><td></td><td>TINYBLOB</td><td>å…è®¸é•¿åº¦0~255å­—èŠ‚</td></tr><tr><td></td><td>BLOB</td><td>å…è®¸é•¿åº¦0~65535å­—èŠ‚</td></tr><tr><td></td><td>MEDIUMBLOB</td><td>å…è®¸é•¿åº¦0~167772150å­—èŠ‚</td></tr><tr><td></td><td>LONGBLOB</td><td>å…è®¸é•¿åº¦0~4294967295å­—èŠ‚</td></tr><tr><td></td><td>TINYTEXT</td><td>å…è®¸é•¿åº¦0~255å­—èŠ‚</td></tr><tr><td></td><td>TEXT</td><td>å…è®¸é•¿åº¦0~65535å­—èŠ‚</td></tr><tr><td></td><td>MEDIUMTEXT</td><td>å…è®¸é•¿åº¦0~167772150å­—èŠ‚</td></tr><tr><td></td><td>LONGTEXT</td><td>å…è®¸é•¿åº¦0~4294967295å­—èŠ‚</td></tr><tr><td></td><td>VARBINARY(M)</td><td>å…è®¸é•¿åº¦0~Mä¸ªå­—èŠ‚çš„å˜é•¿å­—èŠ‚å­—ç¬¦ä¸²</td></tr><tr><td></td><td>BINARY(M)</td><td>å…è®¸é•¿åº¦0~Mä¸ªå­—èŠ‚çš„å®šé•¿å­—èŠ‚å­—ç¬¦ä¸²</td></tr></tbody></table></div><ul><li><p><code>1ã€æ•´æ•°ç±»å‹</code>ï¼ŒåŒ…æ‹¬TINYINTã€SMALLINTã€MEDIUMINTã€INTã€BIGINTï¼Œåˆ†åˆ«è¡¨ç¤º1å­—èŠ‚ã€2å­—èŠ‚ã€3å­—èŠ‚ã€4å­—èŠ‚ã€8å­—èŠ‚æ•´æ•°ã€‚ä»»ä½•æ•´æ•°ç±»å‹éƒ½å¯ä»¥åŠ ä¸ŠUNSIGNEDå±æ€§ï¼Œè¡¨ç¤ºæ•°æ®æ˜¯æ— ç¬¦å·çš„ï¼Œå³éè´Ÿæ•´æ•°ã€‚<br><code>é•¿åº¦</code>ï¼šæ•´æ•°ç±»å‹å¯ä»¥è¢«æŒ‡å®šé•¿åº¦ï¼Œä¾‹å¦‚ï¼šINT(11)è¡¨ç¤ºé•¿åº¦ä¸º11çš„INTç±»å‹ã€‚é•¿åº¦åœ¨å¤§å¤šæ•°åœºæ™¯æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå®ƒä¸ä¼šé™åˆ¶å€¼çš„åˆæ³•èŒƒå›´ï¼Œåªä¼šå½±å“æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼Œè€Œä¸”éœ€è¦å’ŒUNSIGNED ZEROFILLå±æ€§é…åˆä½¿ç”¨æ‰æœ‰æ„ä¹‰ã€‚<br><code>ä¾‹å­</code>ï¼Œå‡å®šç±»å‹è®¾å®šä¸ºINT(5)ï¼Œå±æ€§ä¸ºUNSIGNED ZEROFILLï¼Œå¦‚æœç”¨æˆ·æ’å…¥çš„æ•°æ®ä¸º12çš„è¯ï¼Œé‚£ä¹ˆæ•°æ®åº“å®é™…å­˜å‚¨æ•°æ®ä¸º00012ã€‚</p></li><li><p><code>2ã€å®æ•°ç±»å‹</code>ï¼ŒåŒ…æ‹¬FLOATã€DOUBLEã€DECIMALã€‚<br>DECIMALå¯ä»¥ç”¨äºå­˜å‚¨æ¯”BIGINTè¿˜å¤§çš„æ•´å‹ï¼Œèƒ½å­˜å‚¨ç²¾ç¡®çš„å°æ•°ã€‚<br>è€ŒFLOATå’ŒDOUBLEæ˜¯æœ‰å–å€¼èŒƒå›´çš„ï¼Œå¹¶æ”¯æŒä½¿ç”¨æ ‡å‡†çš„æµ®ç‚¹è¿›è¡Œè¿‘ä¼¼è®¡ç®—ã€‚<br>è®¡ç®—æ—¶FLOATå’ŒDOUBLEç›¸æ¯”DECIMALæ•ˆç‡æ›´é«˜ä¸€äº›ï¼ŒDECIMALä½ å¯ä»¥ç†è§£æˆæ˜¯ç”¨å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚</p></li><li><p><code>3ã€å­—ç¬¦ä¸²ç±»å‹</code>ï¼ŒåŒ…æ‹¬VARCHARã€CHARã€TEXTã€BLOB<br>VARCHARç”¨äºå­˜å‚¨å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œå®ƒæ¯”å®šé•¿ç±»å‹æ›´èŠ‚çœç©ºé—´ã€‚<br>VARCHARä½¿ç”¨é¢å¤–1æˆ–2ä¸ªå­—èŠ‚å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦ã€‚åˆ—é•¿åº¦å°äº255å­—èŠ‚æ—¶ï¼Œä½¿ç”¨1å­—èŠ‚è¡¨ç¤ºï¼Œå¦åˆ™ä½¿ç”¨2å­—èŠ‚è¡¨ç¤ºã€‚<br>VARCHARå­˜å‚¨çš„å†…å®¹è¶…å‡ºè®¾ç½®çš„é•¿åº¦æ—¶ï¼Œå†…å®¹ä¼šè¢«æˆªæ–­ã€‚<br>CHARæ˜¯å®šé•¿çš„ï¼Œæ ¹æ®å®šä¹‰çš„å­—ç¬¦ä¸²é•¿åº¦åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ã€‚<br>CHARä¼šæ ¹æ®éœ€è¦ä½¿ç”¨ç©ºæ ¼è¿›è¡Œå¡«å……æ–¹ä¾¿æ¯”è¾ƒã€‚<br>CHARé€‚åˆå­˜å‚¨å¾ˆçŸ­çš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ‰€æœ‰å€¼éƒ½æ¥è¿‘åŒä¸€ä¸ªé•¿åº¦ã€‚<br>CHARå­˜å‚¨çš„å†…å®¹è¶…å‡ºè®¾ç½®çš„é•¿åº¦æ—¶ï¼Œå†…å®¹åŒæ ·ä¼šè¢«æˆªæ–­ã€‚</p><p><strong>ä½¿ç”¨ç­–ç•¥ï¼š</strong><br>å¯¹äºç»å¸¸å˜æ›´çš„æ•°æ®æ¥è¯´ï¼ŒCHARæ¯”VARCHARæ›´å¥½ï¼Œå› ä¸ºCHARä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ã€‚<br>å¯¹äºéå¸¸çŸ­çš„åˆ—ï¼ŒCHARæ¯”VARCHARåœ¨å­˜å‚¨ç©ºé—´ä¸Šæ›´æœ‰æ•ˆç‡ã€‚<br>ä½¿ç”¨æ—¶è¦æ³¨æ„åªåˆ†é…éœ€è¦çš„ç©ºé—´ï¼Œæ›´é•¿çš„åˆ—æ’åºæ—¶ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ã€‚<br>å°½é‡é¿å…ä½¿ç”¨TEXT/BLOBç±»å‹ï¼ŒæŸ¥è¯¢æ—¶ä¼šä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½å¼€é”€ã€‚</p></li><li><p><code>4ã€æšä¸¾ç±»å‹ï¼ˆENUMï¼‰</code>ï¼ŒæŠŠä¸é‡å¤çš„æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªé¢„å®šä¹‰çš„é›†åˆã€‚<br>æœ‰æ—¶å¯ä»¥ä½¿ç”¨ENUMä»£æ›¿å¸¸ç”¨çš„å­—ç¬¦ä¸²ç±»å‹ã€‚<br>ENUMå­˜å‚¨éå¸¸ç´§å‡‘ï¼Œä¼šæŠŠåˆ—è¡¨å€¼å‹ç¼©åˆ°ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­—èŠ‚ã€‚<br>ENUMåœ¨å†…éƒ¨å­˜å‚¨æ—¶ï¼Œå…¶å®å­˜çš„æ˜¯æ•´æ•°ã€‚<br>å°½é‡é¿å…ä½¿ç”¨æ•°å­—ä½œä¸ºENUMæšä¸¾çš„å¸¸é‡ï¼Œå› ä¸ºå®¹æ˜“æ··ä¹±ã€‚<br>æ’åºæ˜¯æŒ‰ç…§å†…éƒ¨å­˜å‚¨çš„æ•´æ•°</p></li><li><p><code>5ã€æ—¥æœŸå’Œæ—¶é—´ç±»å‹</code>ï¼Œå°½é‡ä½¿ç”¨timestampï¼Œç©ºé—´æ•ˆç‡é«˜äºdatetimeï¼Œ<br>ç”¨æ•´æ•°ä¿å­˜æ—¶é—´æˆ³é€šå¸¸ä¸æ–¹ä¾¿å¤„ç†ã€‚<br>å¦‚æœéœ€è¦å­˜å‚¨å¾®å¦™ï¼Œå¯ä»¥ä½¿ç”¨bigintå­˜å‚¨ã€‚<br>çœ‹åˆ°è¿™é‡Œï¼Œè¿™é“çœŸé¢˜æ˜¯ä¸æ˜¯å°±æ¯”è¾ƒå®¹æ˜“å›ç­”äº†ã€‚</p></li></ul><h2 id="å¼•æ“"><a href="#å¼•æ“" class="headerlink" title="å¼•æ“"></a>å¼•æ“</h2><h3 id="MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«"><a href="#MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«" class="headerlink" title="MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«"></a>MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«</h3><p>å­˜å‚¨å¼•æ“Storage engineï¼šMySQLä¸­çš„æ•°æ®ã€ç´¢å¼•ä»¥åŠå…¶ä»–å¯¹è±¡æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œæ˜¯ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ã€‚</p><p>å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æœ‰ä»¥ä¸‹ï¼š</p><ul><li><strong>Innodbå¼•æ“</strong>ï¼šInnodbå¼•æ“æä¾›äº†å¯¹æ•°æ®åº“ACIDäº‹åŠ¡çš„æ”¯æŒã€‚å¹¶ä¸”è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸã€‚å®ƒçš„è®¾è®¡çš„ç›®æ ‡å°±æ˜¯å¤„ç†å¤§æ•°æ®å®¹é‡çš„æ•°æ®åº“ç³»ç»Ÿã€‚</li><li><strong>MyIASMå¼•æ“</strong>(åŸæœ¬Mysqlçš„é»˜è®¤å¼•æ“)ï¼šä¸æä¾›äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚</li><li><strong>MEMORYå¼•æ“</strong>ï¼šæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„å¤„ç†é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å®‰å…¨æ€§ä¸é«˜ã€‚</li></ul><p><strong>MyISAMä¸InnoDBåŒºåˆ«</strong></p><div class="table-container"><table><thead><tr><th></th><th>MyISAM</th><th>Innodb</th></tr></thead><tbody><tr><td>å­˜å‚¨ç»“æ„</td><td>æ¯å¼ è¡¨è¢«å­˜æ”¾åœ¨ä¸‰ä¸ªæ–‡ä»¶ï¼šfrm-è¡¨æ ¼å®šä¹‰ã€MYD(MYData)-æ•°æ®æ–‡ä»¶ã€MYI(MYIndex)-ç´¢å¼•æ–‡ä»¶</td><td>æ‰€æœ‰çš„è¡¨éƒ½ä¿å­˜åœ¨åŒä¸€ä¸ªæ•°æ®æ–‡ä»¶ä¸­ï¼ˆä¹Ÿå¯èƒ½æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œæˆ–è€…æ˜¯ç‹¬ç«‹çš„è¡¨ç©ºé—´æ–‡ä»¶ï¼‰ï¼ŒInnoDBè¡¨çš„å¤§å°åªå—é™äºæ“ä½œç³»ç»Ÿæ–‡ä»¶çš„å¤§å°ï¼Œä¸€èˆ¬ä¸º2GB</td></tr><tr><td>å­˜å‚¨ç©ºé—´</td><td>MyISAMå¯è¢«å‹ç¼©ï¼Œå­˜å‚¨ç©ºé—´è¾ƒå°</td><td>InnoDBçš„è¡¨éœ€è¦æ›´å¤šçš„å†…å­˜å’Œå­˜å‚¨ï¼Œå®ƒä¼šåœ¨ä¸»å†…å­˜ä¸­å»ºç«‹å…¶ä¸“ç”¨çš„ç¼“å†²æ± ç”¨äºé«˜é€Ÿç¼“å†²æ•°æ®å’Œç´¢å¼•</td></tr><tr><td>å¯ç§»æ¤æ€§ã€å¤‡ä»½åŠæ¢å¤</td><td>ç”±äºMyISAMçš„æ•°æ®æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨è·¨å¹³å°çš„æ•°æ®è½¬ç§»ä¸­ä¼šå¾ˆæ–¹ä¾¿ã€‚åœ¨å¤‡ä»½å’Œæ¢å¤æ—¶å¯å•ç‹¬é’ˆå¯¹æŸä¸ªè¡¨è¿›è¡Œæ“ä½œ</td><td>å…è´¹çš„æ–¹æ¡ˆå¯ä»¥æ˜¯æ‹·è´æ•°æ®æ–‡ä»¶ã€å¤‡ä»½ binlogï¼Œæˆ–è€…ç”¨ mysqldumpï¼Œåœ¨æ•°æ®é‡è¾¾åˆ°å‡ åGçš„æ—¶å€™å°±ç›¸å¯¹ç—›è‹¦äº†</td></tr><tr><td>æ–‡ä»¶æ ¼å¼</td><td>æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†åˆ«å­˜å‚¨çš„ï¼Œæ•°æ®<code>.MYD</code>ï¼Œç´¢å¼•<code>.MYI</code></td><td>æ•°æ®å’Œç´¢å¼•æ˜¯é›†ä¸­å­˜å‚¨çš„ï¼Œ<code>.ibd</code></td></tr><tr><td>è®°å½•å­˜å‚¨é¡ºåº</td><td>æŒ‰è®°å½•æ’å…¥é¡ºåºä¿å­˜</td><td>æŒ‰ä¸»é”®å¤§å°æœ‰åºæ’å…¥</td></tr><tr><td>å¤–é”®</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é”æ”¯æŒï¼ˆé”æ˜¯é¿å…èµ„æºäº‰ç”¨çš„ä¸€ä¸ªæœºåˆ¶ï¼ŒMySQLé”å¯¹ç”¨æˆ·å‡ ä¹æ˜¯é€æ˜çš„ï¼‰</td><td>è¡¨çº§é”å®š</td><td>è¡Œçº§é”å®šã€è¡¨çº§é”å®šï¼Œé”å®šåŠ›åº¦å°å¹¶å‘èƒ½åŠ›é«˜</td></tr><tr><td>SELECT</td><td>MyISAMæ›´ä¼˜</td><td></td></tr><tr><td>INSERTã€UPDATEã€DELETE</td><td></td><td>InnoDBæ›´ä¼˜</td></tr><tr><td>select count(*)</td><td>myisamæ›´å¿«ï¼Œå› ä¸ºmyisamå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥ç›´æ¥è°ƒå–ã€‚</td><td></td></tr><tr><td>ç´¢å¼•çš„å®ç°æ–¹å¼</td><td>B+æ ‘ç´¢å¼•ï¼Œmyisam æ˜¯å †è¡¨</td><td>B+æ ‘ç´¢å¼•ï¼ŒInnodb æ˜¯ç´¢å¼•ç»„ç»‡è¡¨</td></tr><tr><td>å“ˆå¸Œç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table></div><h3 id="MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ"><a href="#MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ"></a>MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ</h3><ul><li>InnoDBç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼ŒMyISAMç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ã€‚</li><li>InnoDBçš„ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç€è¡Œæ•°æ®ï¼Œå› æ­¤ä¸»é”®ç´¢å¼•éå¸¸é«˜æ•ˆã€‚</li><li>MyISAMç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®åœ°å€ï¼Œéœ€è¦å†å¯»å€ä¸€æ¬¡æ‰èƒ½å¾—åˆ°æ•°æ®ã€‚</li><li>InnoDBéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å’Œå…¶ä»–å¸¦ç´¢å¼•çš„åˆ—æ•°æ®ï¼Œå› æ­¤æŸ¥è¯¢æ—¶åšåˆ°è¦†ç›–ç´¢å¼•ä¼šéå¸¸é«˜æ•ˆã€‚</li></ul><h3 id="InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§"><a href="#InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§" class="headerlink" title="InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§"></a>InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§</h3><ul><li>æ’å…¥ç¼“å†²ï¼ˆinsert buffer)</li><li>äºŒæ¬¡å†™(double write)</li><li>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•(ahi)</li><li>é¢„è¯»(read ahead)</li></ul><h3 id="å­˜å‚¨å¼•æ“é€‰æ‹©"><a href="#å­˜å‚¨å¼•æ“é€‰æ‹©" class="headerlink" title="å­˜å‚¨å¼•æ“é€‰æ‹©"></a>å­˜å‚¨å¼•æ“é€‰æ‹©</h3><p>å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œä½¿ç”¨é»˜è®¤çš„<code>Innodb</code>å³å¯ã€‚</p><p>MyISAMï¼šä»¥è¯»å†™æ’å…¥ä¸ºä¸»çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åšå®¢ç³»ç»Ÿã€æ–°é—»é—¨æˆ·ç½‘ç«™ã€‚</p><p>Innodbï¼šæ›´æ–°ï¼ˆåˆ é™¤ï¼‰æ“ä½œé¢‘ç‡ä¹Ÿé«˜ï¼Œæˆ–è€…è¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼›å¹¶å‘é‡é«˜ï¼Œæ”¯æŒäº‹åŠ¡å’Œå¤–é”®ã€‚æ¯”å¦‚OAè‡ªåŠ¨åŒ–åŠå…¬ç³»ç»Ÿã€‚</p><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h3><p>ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶(InnoDBæ•°æ®è¡¨ä¸Šçš„ç´¢å¼•æ˜¯è¡¨ç©ºé—´çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†)ï¼Œå®ƒä»¬åŒ…å«ç€å¯¹æ•°æ®è¡¨é‡Œæ‰€æœ‰è®°å½•çš„å¼•ç”¨æŒ‡é’ˆã€‚</p><p>ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ã€‚æ•°æ®åº“ç´¢å¼•ï¼Œæ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ä¸€ä¸ªæ’åºçš„æ•°æ®ç»“æ„ï¼Œä»¥ååŠ©å¿«é€ŸæŸ¥è¯¢ã€æ›´æ–°æ•°æ®åº“è¡¨ä¸­æ•°æ®ã€‚ç´¢å¼•çš„å®ç°é€šå¸¸ä½¿ç”¨Bæ ‘åŠå…¶å˜ç§B+æ ‘ã€‚</p><p>æ›´é€šä¿—çš„è¯´ï¼Œç´¢å¼•å°±ç›¸å½“äºç›®å½•ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ä¹¦ä¸­çš„å†…å®¹ï¼Œé€šè¿‡å¯¹å†…å®¹å»ºç«‹ç´¢å¼•å½¢æˆç›®å½•ã€‚ç´¢å¼•æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæ˜¯è¦å æ®ç‰©ç†ç©ºé—´çš„ã€‚</p><h3 id="ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>ç´¢å¼•çš„ä¼˜ç‚¹</p><ul><li>å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ã€‚</li><li>é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</li></ul><p>ç´¢å¼•çš„ç¼ºç‚¹</p><ul><li>æ—¶é—´æ–¹é¢ï¼šåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œå…·ä½“åœ°ï¼Œå½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œä¼šé™ä½å¢/æ”¹/åˆ çš„æ‰§è¡Œæ•ˆç‡ï¼›</li><li>ç©ºé—´æ–¹é¢ï¼šç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ã€‚</li></ul><h3 id="ç´¢å¼•ä½¿ç”¨åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰"><a href="#ç´¢å¼•ä½¿ç”¨åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="ç´¢å¼•ä½¿ç”¨åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰"></a>ç´¢å¼•ä½¿ç”¨åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰</h3><p>where</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS8yLzE5LzE2OTA0NTk2ZTFiNTU4YjI?x-oss-process=image/format,png" alt="img"></p><p>ä¸Šå›¾ä¸­ï¼Œæ ¹æ®<code>id</code>æŸ¥è¯¢è®°å½•ï¼Œå› ä¸º<code>id</code>å­—æ®µä»…å»ºç«‹äº†ä¸»é”®ç´¢å¼•ï¼Œå› æ­¤æ­¤SQLæ‰§è¡Œå¯é€‰çš„ç´¢å¼•åªæœ‰ä¸»é”®ç´¢å¼•ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œæœ€ç»ˆä¼šé€‰ä¸€ä¸ªè¾ƒä¼˜çš„ä½œä¸ºæ£€ç´¢çš„ä¾æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¢åŠ ä¸€ä¸ªæ²¡æœ‰å»ºç«‹ç´¢å¼•çš„å­—æ®µ</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> innodb1 <span class="keyword">add</span> sex <span class="built_in">char</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">-- æŒ‰sexæ£€ç´¢æ—¶å¯é€‰çš„ç´¢å¼•ä¸ºnull</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">from</span> innodb1 <span class="keyword">where</span> sex=<span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">1234</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS8yLzE5LzE2OTA0NTk2Zjk1YTdmOTk?x-oss-process=image/format,png" alt="img"></p><blockquote><p>å¯ä»¥å°è¯•åœ¨ä¸€ä¸ªå­—æ®µæœªå»ºç«‹ç´¢å¼•æ—¶ï¼Œæ ¹æ®è¯¥å­—æ®µæŸ¥è¯¢çš„æ•ˆç‡ï¼Œç„¶åå¯¹è¯¥å­—æ®µå»ºç«‹ç´¢å¼•ï¼ˆ<code>alter table è¡¨å add index(å­—æ®µå)</code>ï¼‰ï¼ŒåŒæ ·çš„SQLæ‰§è¡Œçš„æ•ˆç‡ï¼Œä½ ä¼šå‘ç°æŸ¥è¯¢æ•ˆç‡ä¼šæœ‰æ˜æ˜¾çš„æå‡ï¼ˆæ•°æ®é‡è¶Šå¤§è¶Šæ˜æ˜¾ï¼‰ã€‚</p></blockquote><p>order by</p><p>å½“æˆ‘ä»¬ä½¿ç”¨<code>order by</code>å°†æŸ¥è¯¢ç»“æœæŒ‰ç…§æŸä¸ªå­—æ®µæ’åºæ—¶ï¼Œå¦‚æœè¯¥å­—æ®µæ²¡æœ‰å»ºç«‹ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œè®¡åˆ’ä¼šå°†æŸ¥è¯¢å‡ºçš„æ‰€æœ‰æ•°æ®ä½¿ç”¨å¤–éƒ¨æ’åºï¼ˆå°†æ•°æ®ä»ç¡¬ç›˜åˆ†æ‰¹è¯»å–åˆ°å†…å­˜ä½¿ç”¨å†…éƒ¨æ’åºï¼Œæœ€ååˆå¹¶æ’åºç»“æœï¼‰ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å¾ˆå½±å“æ€§èƒ½çš„ï¼Œå› ä¸ºéœ€è¦å°†æŸ¥è¯¢æ¶‰åŠåˆ°çš„æ‰€æœ‰æ•°æ®ä»ç£ç›˜ä¸­è¯»åˆ°å†…å­˜ï¼ˆå¦‚æœå•æ¡æ•°æ®è¿‡å¤§æˆ–è€…æ•°æ®é‡è¿‡å¤šéƒ½ä¼šé™ä½æ•ˆç‡ï¼‰ï¼Œæ›´æ— è®ºè¯»åˆ°å†…å­˜ä¹‹åçš„æ’åºäº†ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¯¹è¯¥å­—æ®µå»ºç«‹ç´¢å¼•<code>alter table è¡¨å add index(å­—æ®µå)</code>ï¼Œé‚£ä¹ˆç”±äºç´¢å¼•æœ¬èº«æ˜¯æœ‰åºçš„ï¼Œå› æ­¤ç›´æ¥æŒ‰ç…§ç´¢å¼•çš„é¡ºåºå’Œæ˜ å°„å…³ç³»é€æ¡å–å‡ºæ•°æ®å³å¯ã€‚è€Œä¸”å¦‚æœåˆ†é¡µçš„ï¼Œé‚£ä¹ˆåªç”¨<strong>å–å‡ºç´¢å¼•è¡¨æŸä¸ªèŒƒå›´å†…çš„ç´¢å¼•å¯¹åº”çš„æ•°æ®</strong>ï¼Œè€Œä¸ç”¨åƒä¸Šè¿°é‚£<strong>å–å‡ºæ‰€æœ‰æ•°æ®</strong>è¿›è¡Œæ’åºå†è¿”å›æŸä¸ªèŒƒå›´å†…çš„æ•°æ®ã€‚ï¼ˆä»ç£ç›˜å–æ•°æ®æ˜¯æœ€å½±å“æ€§èƒ½çš„ï¼‰</p><p>join</p><blockquote><p>å¯¹<code>join</code>è¯­å¥åŒ¹é…å…³ç³»ï¼ˆ<code>on</code>ï¼‰æ¶‰åŠçš„å­—æ®µå»ºç«‹ç´¢å¼•èƒ½å¤Ÿæé«˜æ•ˆç‡</p></blockquote><p>ç´¢å¼•è¦†ç›–</p><p>å¦‚æœè¦æŸ¥è¯¢çš„å­—æ®µéƒ½å»ºç«‹è¿‡ç´¢å¼•ï¼Œé‚£ä¹ˆå¼•æ“ä¼šç›´æ¥åœ¨ç´¢å¼•è¡¨ä¸­æŸ¥è¯¢è€Œä¸ä¼šè®¿é—®åŸå§‹æ•°æ®ï¼ˆå¦åˆ™åªè¦æœ‰ä¸€ä¸ªå­—æ®µæ²¡æœ‰å»ºç«‹ç´¢å¼•å°±ä¼šåšå…¨è¡¨æ‰«æï¼‰ï¼Œè¿™å«ç´¢å¼•è¦†ç›–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„åœ¨<code>select</code>ååªå†™å¿…è¦çš„æŸ¥è¯¢å­—æ®µï¼Œä»¥å¢åŠ ç´¢å¼•è¦†ç›–çš„å‡ ç‡ã€‚</p><p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¸è¦æƒ³ç€ä¸ºæ¯ä¸ªå­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºä¼˜å…ˆä½¿ç”¨ç´¢å¼•çš„ä¼˜åŠ¿å°±åœ¨äºå…¶ä½“ç§¯å°ã€‚</p><h3 id="ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ"><a href="#ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ" class="headerlink" title="ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ"></a>ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ</h3><p><strong>ä¸»é”®ç´¢å¼•:</strong> æ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ä¸ºNULLï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</p><p><strong>å”¯ä¸€ç´¢å¼•:</strong> æ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸ºNULLå€¼ï¼Œä¸€ä¸ªè¡¨å…è®¸å¤šä¸ªåˆ—åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</p><ul><li>å¯ä»¥é€šè¿‡ <code>ALTER TABLE table_name ADD UNIQUE (column);</code> åˆ›å»ºå”¯ä¸€ç´¢å¼•</li><li>å¯ä»¥é€šè¿‡ <code>ALTER TABLE table_name ADD UNIQUE (column1,column2);</code> åˆ›å»ºå”¯ä¸€ç»„åˆç´¢å¼•</li></ul><p><strong>æ™®é€šç´¢å¼•:</strong> åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰å”¯ä¸€æ€§çš„é™åˆ¶ï¼Œå…è®¸ä¸ºNULLå€¼ã€‚</p><ul><li>å¯ä»¥é€šè¿‡<code>ALTER TABLE table_name ADD INDEX index_name (column);</code>åˆ›å»ºæ™®é€šç´¢å¼•</li><li>å¯ä»¥é€šè¿‡<code>ALTER TABLE table_name ADD INDEX index_name(column1, column2, column3);</code>åˆ›å»ºç»„åˆç´¢å¼•</li></ul><p><strong>å…¨æ–‡ç´¢å¼•ï¼š</strong> æ˜¯ç›®å‰æœç´¢å¼•æ“ä½¿ç”¨çš„ä¸€ç§å…³é”®æŠ€æœ¯ã€‚</p><ul><li>å¯ä»¥é€šè¿‡<code>ALTER TABLE table_name ADD FULLTEXT (column);</code>åˆ›å»ºå…¨æ–‡ç´¢å¼•</li></ul><h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰</h3><p>ç´¢å¼•çš„æ•°æ®ç»“æ„å’Œå…·ä½“å­˜å‚¨å¼•æ“çš„å®ç°æœ‰å…³ï¼Œåœ¨MySQLä¸­ä½¿ç”¨è¾ƒå¤šçš„ç´¢å¼•æœ‰<strong>Hashç´¢å¼•</strong>ï¼Œ<strong>B+æ ‘ç´¢å¼•</strong>ç­‰ï¼Œè€Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•å®ç°ä¸ºï¼šB+æ ‘ç´¢å¼•ã€‚å¯¹äºå“ˆå¸Œç´¢å¼•æ¥è¯´ï¼Œåº•å±‚çš„æ•°æ®ç»“æ„å°±æ˜¯å“ˆå¸Œè¡¨ï¼Œå› æ­¤åœ¨ç»å¤§å¤šæ•°éœ€æ±‚ä¸ºå•æ¡è®°å½•æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©å“ˆå¸Œç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½æœ€å¿«ï¼›å…¶ä½™å¤§éƒ¨åˆ†åœºæ™¯ï¼Œå»ºè®®é€‰æ‹©BTreeç´¢å¼•ã€‚</p><p>1ï¼‰Bæ ‘ç´¢å¼•</p><p>mysqlé€šè¿‡å­˜å‚¨å¼•æ“å–æ•°æ®ï¼ŒåŸºæœ¬ä¸Š90%çš„äººç”¨çš„å°±æ˜¯InnoDBäº†ï¼ŒæŒ‰ç…§å®ç°æ–¹å¼åˆ†ï¼ŒInnoDBçš„ç´¢å¼•ç±»å‹ç›®å‰åªæœ‰ä¸¤ç§ï¼šBTREEï¼ˆBæ ‘ï¼‰ç´¢å¼•å’ŒHASHç´¢å¼•ã€‚Bæ ‘ç´¢å¼•æ˜¯Mysqlæ•°æ®åº“ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„ç´¢å¼•ç±»å‹ï¼ŒåŸºæœ¬æ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½æ”¯æŒBTreeç´¢å¼•ã€‚é€šå¸¸æˆ‘ä»¬è¯´çš„ç´¢å¼•ä¸å‡ºæ„å¤–æŒ‡çš„å°±æ˜¯ï¼ˆBæ ‘ï¼‰ç´¢å¼•ï¼ˆå®é™…æ˜¯ç”¨B+æ ‘å®ç°çš„ï¼Œå› ä¸ºåœ¨æŸ¥çœ‹è¡¨ç´¢å¼•æ—¶ï¼Œmysqlä¸€å¾‹æ‰“å°BTREEï¼Œæ‰€ä»¥ç®€ç§°ä¸ºBæ ‘ç´¢å¼•ï¼‰</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC85LzI0LzE2NjBjMGYxNGRhY2Y2ZjU?x-oss-process=image/format,png" alt="img"></p><p>æŸ¥è¯¢æ–¹å¼ï¼š</p><p>ä¸»é”®ç´¢å¼•åŒº:PI(å…³è”ä¿å­˜çš„æ—¶æ•°æ®çš„åœ°å€)æŒ‰ä¸»é”®æŸ¥è¯¢,</p><p>æ™®é€šç´¢å¼•åŒº:si(å…³è”çš„idçš„åœ°å€,ç„¶åå†åˆ°è¾¾ä¸Šé¢çš„åœ°å€)ã€‚æ‰€ä»¥æŒ‰ä¸»é”®æŸ¥è¯¢,é€Ÿåº¦æœ€å¿«</p><p>B+treeæ€§è´¨ï¼š</p><p>1.ï¼‰næ£µå­treeçš„èŠ‚ç‚¹åŒ…å«nä¸ªå…³é”®å­—ï¼Œä¸ç”¨æ¥ä¿å­˜æ•°æ®è€Œæ˜¯ä¿å­˜æ•°æ®çš„ç´¢å¼•ã€‚</p><p>2.ï¼‰æ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…³é”®å­—çš„ä¿¡æ¯ï¼ŒåŠæŒ‡å‘å«è¿™äº›å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œä¸”å¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§é¡ºåºé“¾æ¥ã€‚</p><p>3.ï¼‰æ‰€æœ‰çš„éç»ˆç«¯ç»“ç‚¹å¯ä»¥çœ‹æˆæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œç»“ç‚¹ä¸­ä»…å«å…¶å­æ ‘ä¸­çš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…³é”®å­—ã€‚</p><p>4.ï¼‰B+ æ ‘ä¸­ï¼Œæ•°æ®å¯¹è±¡çš„æ’å…¥å’Œåˆ é™¤ä»…åœ¨å¶èŠ‚ç‚¹ä¸Šè¿›è¡Œã€‚</p><p>5.ï¼‰B+æ ‘æœ‰2ä¸ªå¤´æŒ‡é’ˆï¼Œä¸€ä¸ªæ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯æœ€å°å…³é”®ç çš„å¶èŠ‚ç‚¹ã€‚</p><p>2ï¼‰å“ˆå¸Œç´¢å¼•</p><p>ç®€è¦è¯´ä¸‹ï¼Œç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­ç®€å•å®ç°çš„HASHè¡¨ï¼ˆæ•£åˆ—è¡¨ï¼‰ä¸€æ ·ï¼Œå½“æˆ‘ä»¬åœ¨mysqlä¸­ç”¨å“ˆå¸Œç´¢å¼•æ—¶ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡Hashç®—æ³•ï¼ˆå¸¸è§çš„Hashç®—æ³•æœ‰ç›´æ¥å®šå€æ³•ã€å¹³æ–¹å–ä¸­æ³•ã€æŠ˜å æ³•ã€é™¤æ•°å–ä½™æ³•ã€éšæœºæ•°æ³•ï¼‰ï¼Œå°†æ•°æ®åº“å­—æ®µæ•°æ®è½¬æ¢æˆå®šé•¿çš„Hashå€¼ï¼Œä¸è¿™æ¡æ•°æ®çš„è¡ŒæŒ‡é’ˆä¸€å¹¶å­˜å…¥Hashè¡¨çš„å¯¹åº”ä½ç½®ï¼›å¦‚æœå‘ç”ŸHashç¢°æ’ï¼ˆä¸¤ä¸ªä¸åŒå…³é”®å­—çš„Hashå€¼ç›¸åŒï¼‰ï¼Œåˆ™åœ¨å¯¹åº”Hashé”®ä¸‹ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚å½“ç„¶è¿™åªæ˜¯ç®€ç•¥æ¨¡æ‹Ÿå›¾ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC85LzI0LzE2NjBjMGYxNThhNzZmOTQ?x-oss-process=image/format,png" alt="img"></p><h3 id="ç´¢å¼•çš„åŸºæœ¬åŸç†"><a href="#ç´¢å¼•çš„åŸºæœ¬åŸç†" class="headerlink" title="ç´¢å¼•çš„åŸºæœ¬åŸç†"></a>ç´¢å¼•çš„åŸºæœ¬åŸç†</h3><p>ç´¢å¼•ç”¨æ¥å¿«é€Ÿåœ°å¯»æ‰¾é‚£äº›å…·æœ‰ç‰¹å®šå€¼çš„è®°å½•ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œä¸€èˆ¬æ¥è¯´æ‰§è¡ŒæŸ¥è¯¢æ—¶éå†æ•´å¼ è¡¨ã€‚</p><p>ç´¢å¼•çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠæ— åºçš„æ•°æ®å˜æˆæœ‰åºçš„æŸ¥è¯¢</p><ol><li>æŠŠåˆ›å»ºäº†ç´¢å¼•çš„åˆ—çš„å†…å®¹è¿›è¡Œæ’åº</li><li>å¯¹æ’åºç»“æœç”Ÿæˆå€’æ’è¡¨</li><li>åœ¨å€’æ’è¡¨å†…å®¹ä¸Šæ‹¼ä¸Šæ•°æ®åœ°å€é“¾</li><li>åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…ˆæ‹¿åˆ°å€’æ’è¡¨å†…å®¹ï¼Œå†å–å‡ºæ•°æ®åœ°å€é“¾ï¼Œä»è€Œæ‹¿åˆ°å…·ä½“æ•°æ®</li></ol><h3 id="ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h3><p>ç´¢å¼•ç®—æ³•æœ‰ BTreeç®—æ³•å’ŒHashç®—æ³•</p><p><strong>BTreeç®—æ³•</strong></p><p>BTreeæ˜¯æœ€å¸¸ç”¨çš„mysqlæ•°æ®åº“ç´¢å¼•ç®—æ³•ï¼Œä¹Ÿæ˜¯mysqlé»˜è®¤çš„ç®—æ³•ã€‚å› ä¸ºå®ƒä¸ä»…å¯ä»¥è¢«ç”¨åœ¨=,&gt;,&gt;=,&lt;,&lt;=å’Œbetweenè¿™äº›æ¯”è¾ƒæ“ä½œç¬¦ä¸Šï¼Œè€Œä¸”è¿˜å¯ä»¥ç”¨äºlikeæ“ä½œç¬¦ï¼Œåªè¦å®ƒçš„æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªä¸ä»¥é€šé…ç¬¦å¼€å¤´çš„å¸¸é‡ï¼Œ ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åªè¦å®ƒçš„æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªä¸ä»¥é€šé…ç¬¦å¼€å¤´çš„å¸¸é‡</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">&#x27;jack%&#x27;</span>; </span><br><span class="line"><span class="comment">-- å¦‚æœä¸€é€šé…ç¬¦å¼€å¤´ï¼Œæˆ–è€…æ²¡æœ‰ä½¿ç”¨å¸¸é‡ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œä¾‹å¦‚ï¼š </span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">&#x27;%jack&#x27;</span>; </span><br><span class="line">1234</span><br></pre></td></tr></table></figure><p><strong>Hashç®—æ³•</strong></p><p>Hash Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒï¼Œä¾‹å¦‚=,&lt;=&gt;ï¼ˆç›¸å½“äº=ï¼‰æ“ä½œç¬¦ã€‚ç”±äºæ˜¯ä¸€æ¬¡å®šä½æ•°æ®ï¼Œä¸åƒBTreeç´¢å¼•éœ€è¦ä»æ ¹èŠ‚ç‚¹åˆ°æèŠ‚ç‚¹ï¼Œæœ€åæ‰èƒ½è®¿é—®åˆ°é¡µèŠ‚ç‚¹è¿™æ ·å¤šæ¬¡IOè®¿é—®ï¼Œæ‰€ä»¥æ£€ç´¢æ•ˆç‡è¿œé«˜äºBTreeç´¢å¼•ã€‚</p><h3 id="ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ"><a href="#ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ" class="headerlink" title="ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ"></a>ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ</h3><ol><li>é€‚åˆç´¢å¼•çš„åˆ—æ˜¯å‡ºç°åœ¨whereå­å¥ä¸­çš„åˆ—ï¼Œæˆ–è€…è¿æ¥å­å¥ä¸­æŒ‡å®šçš„åˆ—</li><li>åŸºæ•°è¾ƒå°çš„ç±»ï¼Œç´¢å¼•æ•ˆæœè¾ƒå·®ï¼Œæ²¡æœ‰å¿…è¦åœ¨æ­¤åˆ—å»ºç«‹ç´¢å¼•</li><li>ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œå¦‚æœå¯¹é•¿å­—ç¬¦ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œåº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çœå¤§é‡ç´¢å¼•ç©ºé—´</li><li>ä¸è¦è¿‡åº¦ç´¢å¼•ã€‚ç´¢å¼•éœ€è¦é¢å¤–çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶é™ä½å†™æ“ä½œçš„æ€§èƒ½ã€‚åœ¨ä¿®æ”¹è¡¨å†…å®¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¼šè¿›è¡Œæ›´æ–°ç”šè‡³é‡æ„ï¼Œç´¢å¼•åˆ—è¶Šå¤šï¼Œè¿™ä¸ªæ—¶é—´å°±ä¼šè¶Šé•¿ã€‚æ‰€ä»¥åªä¿æŒéœ€è¦çš„ç´¢å¼•æœ‰åˆ©äºæŸ¥è¯¢å³å¯ã€‚</li></ol><h3 id="åˆ›å»ºç´¢å¼•çš„åŸåˆ™ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰"><a href="#åˆ›å»ºç´¢å¼•çš„åŸåˆ™ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰" class="headerlink" title="åˆ›å»ºç´¢å¼•çš„åŸåˆ™ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰"></a>åˆ›å»ºç´¢å¼•çš„åŸåˆ™ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰</h3><p>ç´¢å¼•è™½å¥½ï¼Œä½†ä¹Ÿä¸æ˜¯æ— é™åˆ¶çš„ä½¿ç”¨ï¼Œæœ€å¥½ç¬¦åˆä¸€ä¸‹å‡ ä¸ªåŸåˆ™</p><p>1ï¼‰ æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œç»„åˆç´¢å¼•éå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a = 1 and b = 2 and c &gt; 3 and d = 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚</p><p>2ï¼‰è¾ƒé¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µæ‰å»åˆ›å»ºç´¢å¼•</p><p>3ï¼‰æ›´æ–°é¢‘ç¹å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•</p><p>4ï¼‰è‹¥æ˜¯ä¸èƒ½æœ‰æ•ˆåŒºåˆ†æ•°æ®çš„åˆ—ä¸é€‚åˆåšç´¢å¼•åˆ—(å¦‚æ€§åˆ«ï¼Œç”·å¥³æœªçŸ¥ï¼Œæœ€å¤šä¹Ÿå°±ä¸‰ç§ï¼ŒåŒºåˆ†åº¦å®åœ¨å¤ªä½)</p><p>5ï¼‰å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚æ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚</p><p>6ï¼‰å®šä¹‰æœ‰å¤–é”®çš„æ•°æ®åˆ—ä¸€å®šè¦å»ºç«‹ç´¢å¼•ã€‚</p><p>7ï¼‰å¯¹äºé‚£äº›æŸ¥è¯¢ä¸­å¾ˆå°‘æ¶‰åŠçš„åˆ—ï¼Œé‡å¤å€¼æ¯”è¾ƒå¤šçš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ã€‚</p><p>8ï¼‰å¯¹äºå®šä¹‰ä¸ºtextã€imageå’Œbitçš„æ•°æ®ç±»å‹çš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ã€‚</p><h3 id="åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼ï¼Œåˆ é™¤ç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼ï¼Œåˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼ï¼Œåˆ é™¤ç´¢å¼•"></a>åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼ï¼Œåˆ é™¤ç´¢å¼•</h3><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šåœ¨æ‰§è¡ŒCREATE TABLEæ—¶åˆ›å»ºç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_index2 (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> auto_increment PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">first_name <span class="built_in">VARCHAR</span> (<span class="number">16</span>),</span><br><span class="line">last_name <span class="built_in">VARCHAR</span> (<span class="number">16</span>),</span><br><span class="line">id_card <span class="built_in">VARCHAR</span> (<span class="number">18</span>),</span><br><span class="line">information <span class="built_in">text</span>,</span><br><span class="line"><span class="keyword">KEY</span> <span class="keyword">name</span> (first_name, last_name),</span><br><span class="line">FULLTEXT <span class="keyword">KEY</span> (information),</span><br><span class="line"><span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (id_card)</span><br><span class="line">);</span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ALTER TABLEå‘½ä»¤å»å¢åŠ ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name (column_list);</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>ALTER TABLEç”¨æ¥åˆ›å»ºæ™®é€šç´¢å¼•ã€UNIQUEç´¢å¼•æˆ–PRIMARY KEYç´¢å¼•ã€‚</p><p>å…¶ä¸­table_nameæ˜¯è¦å¢åŠ ç´¢å¼•çš„è¡¨åï¼Œcolumn_listæŒ‡å‡ºå¯¹å“ªäº›åˆ—è¿›è¡Œç´¢å¼•ï¼Œå¤šåˆ—æ—¶å„åˆ—ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚</p><p>ç´¢å¼•åindex_nameå¯è‡ªå·±å‘½åï¼Œç¼ºçœæ—¶ï¼ŒMySQLå°†æ ¹æ®ç¬¬ä¸€ä¸ªç´¢å¼•åˆ—èµ‹ä¸€ä¸ªåç§°ã€‚å¦å¤–ï¼ŒALTER TABLEå…è®¸åœ¨å•ä¸ªè¯­å¥ä¸­æ›´æ”¹å¤šä¸ªè¡¨ï¼Œå› æ­¤å¯ä»¥åœ¨åŒæ—¶åˆ›å»ºå¤šä¸ªç´¢å¼•ã€‚</p><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨CREATE INDEXå‘½ä»¤åˆ›å»º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name (column_list);</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>CREATE INDEXå¯å¯¹è¡¨å¢åŠ æ™®é€šç´¢å¼•æˆ–UNIQUEç´¢å¼•ã€‚ï¼ˆä½†æ˜¯ï¼Œä¸èƒ½åˆ›å»ºPRIMARY KEYç´¢å¼•ï¼‰</p><p>åˆ é™¤ç´¢å¼•</p><p>æ ¹æ®ç´¢å¼•ååˆ é™¤æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ï¼š<code>alter table è¡¨å drop KEY ç´¢å¼•å</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> <span class="keyword">KEY</span> <span class="keyword">name</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> <span class="keyword">KEY</span> id_card;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> <span class="keyword">KEY</span> information;</span><br><span class="line">123</span><br></pre></td></tr></table></figure><p>åˆ é™¤ä¸»é”®ç´¢å¼•ï¼š<code>alter table è¡¨å drop primary key</code>ï¼ˆå› ä¸ºä¸»é”®åªæœ‰ä¸€ä¸ªï¼‰ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸»é”®è‡ªå¢é•¿ï¼Œé‚£ä¹ˆä¸èƒ½ç›´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼ˆè‡ªå¢é•¿ä¾èµ–äºä¸»é”®ç´¢å¼•ï¼‰ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS8yLzE5LzE2OTA0NTk2YjIxZTIwOWM?x-oss-process=image/format,png" alt="img"></p><p>éœ€è¦å–æ¶ˆè‡ªå¢é•¿å†è¡Œåˆ é™¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index</span><br><span class="line"><span class="comment">-- é‡æ–°å®šä¹‰å­—æ®µ</span></span><br><span class="line"><span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">drop</span> PRIMARY <span class="keyword">KEY</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure><p>ä½†é€šå¸¸ä¸ä¼šåˆ é™¤ä¸»é”®ï¼Œå› ä¸ºè®¾è®¡ä¸»é”®ä¸€å®šä¸ä¸šåŠ¡é€»è¾‘æ— å…³ã€‚</p><h3 id="åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h3><ul><li>éç©ºå­—æ®µï¼šåº”è¯¥æŒ‡å®šåˆ—ä¸ºNOT NULLï¼Œé™¤éä½ æƒ³å­˜å‚¨NULLã€‚åœ¨mysqlä¸­ï¼Œå«æœ‰ç©ºå€¼çš„åˆ—å¾ˆéš¾è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒä»¬ä½¿å¾—ç´¢å¼•ã€ç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ¯”è¾ƒè¿ç®—æ›´åŠ å¤æ‚ã€‚ä½ åº”è¯¥ç”¨0ã€ä¸€ä¸ªç‰¹æ®Šçš„å€¼æˆ–è€…ä¸€ä¸ªç©ºä¸²ä»£æ›¿ç©ºå€¼ï¼›</li><li>å–å€¼ç¦»æ•£å¤§çš„å­—æ®µï¼šï¼ˆå˜é‡å„ä¸ªå–å€¼ä¹‹é—´çš„å·®å¼‚ç¨‹åº¦ï¼‰çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å‰é¢ï¼Œå¯ä»¥é€šè¿‡count()å‡½æ•°æŸ¥çœ‹å­—æ®µçš„å·®å¼‚å€¼ï¼Œè¿”å›å€¼è¶Šå¤§è¯´æ˜å­—æ®µçš„å”¯ä¸€å€¼è¶Šå¤šå­—æ®µçš„ç¦»æ•£ç¨‹åº¦é«˜ï¼›</li><li>ç´¢å¼•å­—æ®µè¶Šå°è¶Šå¥½ï¼šæ•°æ®åº“çš„æ•°æ®å­˜å‚¨ä»¥é¡µä¸ºå•ä½ä¸€é¡µå­˜å‚¨çš„æ•°æ®è¶Šå¤šä¸€æ¬¡IOæ“ä½œè·å–çš„æ•°æ®è¶Šå¤§æ•ˆç‡è¶Šé«˜ã€‚</li></ul><h3 id="ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ"><a href="#ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ"></a>ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ</h3><p>é€šå¸¸ï¼Œé€šè¿‡ç´¢å¼•æŸ¥è¯¢æ•°æ®æ¯”å…¨è¡¨æ‰«æè¦å¿«ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¿…é¡»æ³¨æ„åˆ°å®ƒçš„ä»£ä»·ã€‚</p><ul><li>ç´¢å¼•éœ€è¦ç©ºé—´æ¥å­˜å‚¨ï¼Œä¹Ÿéœ€è¦å®šæœŸç»´æŠ¤ï¼Œ æ¯å½“æœ‰è®°å½•åœ¨è¡¨ä¸­å¢å‡æˆ–ç´¢å¼•åˆ—è¢«ä¿®æ”¹æ—¶ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚ è¿™æ„å‘³ç€æ¯æ¡è®°å½•çš„INSERTï¼ŒDELETEï¼ŒUPDATEå°†ä¸ºæ­¤å¤šä»˜å‡º4ï¼Œ5 æ¬¡çš„ç£ç›˜I/Oã€‚ å› ä¸ºç´¢å¼•éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´å’Œå¤„ç†ï¼Œé‚£äº›ä¸å¿…è¦çš„ç´¢å¼•åè€Œä¼šä½¿æŸ¥è¯¢ååº”æ—¶é—´å˜æ…¢ã€‚ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸ä¸€å®šèƒ½æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç´¢å¼•èŒƒå›´æŸ¥è¯¢(INDEX RANGE SCAN)é€‚ç”¨äºä¸¤ç§æƒ…å†µ:</li><li>åŸºäºä¸€ä¸ªèŒƒå›´çš„æ£€ç´¢ï¼Œä¸€èˆ¬æŸ¥è¯¢è¿”å›ç»“æœé›†å°äºè¡¨ä¸­è®°å½•æ•°çš„30%</li><li>åŸºäºéå”¯ä¸€æ€§ç´¢å¼•çš„æ£€ç´¢</li></ul><h3 id="ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤"><a href="#ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤" class="headerlink" title="ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤"></a>ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤</h3><p>å…³äºç´¢å¼•ï¼šç”±äºç´¢å¼•éœ€è¦é¢å¤–çš„ç»´æŠ¤æˆæœ¬ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶æ˜¯å•ç‹¬å­˜åœ¨çš„æ–‡ä»¶,æ‰€ä»¥å½“æˆ‘ä»¬å¯¹æ•°æ®çš„å¢åŠ ,ä¿®æ”¹,åˆ é™¤,éƒ½ä¼šäº§ç”Ÿé¢å¤–çš„å¯¹ç´¢å¼•æ–‡ä»¶çš„æ“ä½œ,è¿™äº›æ“ä½œéœ€è¦æ¶ˆè€—é¢å¤–çš„IO,ä¼šé™ä½å¢/æ”¹/åˆ çš„æ‰§è¡Œæ•ˆç‡ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬åˆ é™¤æ•°æ®åº“ç™¾ä¸‡çº§åˆ«æ•°æ®çš„æ—¶å€™ï¼ŒæŸ¥è¯¢MySQLå®˜æ–¹æ‰‹å†Œå¾—çŸ¥åˆ é™¤æ•°æ®çš„é€Ÿåº¦å’Œåˆ›å»ºçš„ç´¢å¼•æ•°é‡æ˜¯æˆæ­£æ¯”çš„ã€‚</p><ol><li>æ‰€ä»¥æˆ‘ä»¬æƒ³è¦åˆ é™¤ç™¾ä¸‡æ•°æ®çš„æ—¶å€™å¯ä»¥å…ˆåˆ é™¤ç´¢å¼•ï¼ˆæ­¤æ—¶å¤§æ¦‚è€—æ—¶ä¸‰åˆ†å¤šé’Ÿï¼‰</li><li>ç„¶ååˆ é™¤å…¶ä¸­æ— ç”¨æ•°æ®ï¼ˆæ­¤è¿‡ç¨‹éœ€è¦ä¸åˆ°ä¸¤åˆ†é’Ÿï¼‰</li><li>åˆ é™¤å®Œæˆåé‡æ–°åˆ›å»ºç´¢å¼•(æ­¤æ—¶æ•°æ®è¾ƒå°‘äº†)åˆ›å»ºç´¢å¼•ä¹Ÿéå¸¸å¿«ï¼Œçº¦ååˆ†é’Ÿå·¦å³ã€‚</li><li>ä¸ä¹‹å‰çš„ç›´æ¥åˆ é™¤ç»å¯¹æ˜¯è¦å¿«é€Ÿå¾ˆå¤šï¼Œæ›´åˆ«è¯´ä¸‡ä¸€åˆ é™¤ä¸­æ–­,ä¸€åˆ‡åˆ é™¤ä¼šå›æ»šã€‚é‚£æ›´æ˜¯å‘äº†ã€‚</li></ol><h3 id="å‰ç¼€ç´¢å¼•"><a href="#å‰ç¼€ç´¢å¼•" class="headerlink" title="å‰ç¼€ç´¢å¼•"></a>å‰ç¼€ç´¢å¼•</h3><p>è¯­æ³•ï¼š<code>index(field(10))</code>ï¼Œä½¿ç”¨å­—æ®µå€¼çš„å‰10ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨å­—æ®µçš„å…¨éƒ¨å†…å®¹å»ºç«‹ç´¢å¼•ã€‚</p><p>å‰æï¼šå‰ç¼€çš„æ ‡è¯†åº¦é«˜ã€‚æ¯”å¦‚å¯†ç å°±é€‚åˆå»ºç«‹å‰ç¼€ç´¢å¼•ï¼Œå› ä¸ºå¯†ç å‡ ä¹å„ä¸ç›¸åŒã€‚</p><p>å®æ“çš„éš¾åº¦ï¼šåœ¨äºå‰ç¼€æˆªå–çš„é•¿åº¦ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>select count(*)/count(distinct left(password,prefixLen));</code>ï¼Œé€šè¿‡ä»è°ƒæ•´<code>prefixLen</code>çš„å€¼ï¼ˆä»1è‡ªå¢ï¼‰æŸ¥çœ‹ä¸åŒå‰ç¼€é•¿åº¦çš„ä¸€ä¸ªå¹³å‡åŒ¹é…åº¦ï¼Œæ¥è¿‘1æ—¶å°±å¯ä»¥äº†ï¼ˆè¡¨ç¤ºä¸€ä¸ªå¯†ç çš„å‰<code>prefixLen</code>ä¸ªå­—ç¬¦å‡ ä¹èƒ½ç¡®å®šå”¯ä¸€ä¸€æ¡è®°å½•ï¼‰</p><h3 id="ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™"></a>ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™</h3><ul><li>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æœ€å·¦ä¼˜å…ˆï¼Œåœ¨åˆ›å»ºå¤šåˆ—ç´¢å¼•æ—¶ï¼Œè¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œwhereå­å¥ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„ä¸€åˆ—æ”¾åœ¨æœ€å·¦è¾¹ã€‚</li><li>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œéå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a = 1 and b = 2 and c &gt; 3 and d = 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚</li><li>=å’Œinå¯ä»¥ä¹±åºï¼Œæ¯”å¦‚a = 1 and b = 2 and c = 3 å»ºç«‹(a,b,c)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼</li></ul><h3 id="Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«"><a href="#Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«" class="headerlink" title="Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«"></a>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«</h3><ul><li><p>åœ¨Bæ ‘ä¸­ï¼Œä½ å¯ä»¥å°†é”®å’Œå€¼å­˜æ”¾åœ¨å†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ï¼›ä½†åœ¨B+æ ‘ä¸­ï¼Œå†…éƒ¨èŠ‚ç‚¹éƒ½æ˜¯é”®ï¼Œæ²¡æœ‰å€¼ï¼Œå¶å­èŠ‚ç‚¹åŒæ—¶å­˜æ”¾é”®å’Œå€¼ã€‚</p></li><li><p>B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡é“¾ç›¸è¿ï¼Œè€ŒBæ ‘çš„å¶å­èŠ‚ç‚¹å„è‡ªç‹¬ç«‹ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC85LzIxLzE2NWZiNjgyZTc1OWNmMTI?x-oss-process=image/format,png" alt="img"></p></li></ul><h3 id="ä½¿ç”¨Bæ ‘çš„å¥½å¤„"><a href="#ä½¿ç”¨Bæ ‘çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨Bæ ‘çš„å¥½å¤„"></a>ä½¿ç”¨Bæ ‘çš„å¥½å¤„</h3><p>Bæ ‘å¯ä»¥åœ¨å†…éƒ¨èŠ‚ç‚¹åŒæ—¶å­˜å‚¨é”®å’Œå€¼ï¼Œå› æ­¤ï¼ŒæŠŠé¢‘ç¹è®¿é—®çš„æ•°æ®æ”¾åœ¨é è¿‘æ ¹èŠ‚ç‚¹çš„åœ°æ–¹å°†ä¼šå¤§å¤§æé«˜çƒ­ç‚¹æ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—Bæ ‘åœ¨ç‰¹å®šæ•°æ®é‡å¤å¤šæ¬¡æŸ¥è¯¢çš„åœºæ™¯ä¸­æ›´åŠ é«˜æ•ˆã€‚</p><h3 id="ä½¿ç”¨B-æ ‘çš„å¥½å¤„"><a href="#ä½¿ç”¨B-æ ‘çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨B+æ ‘çš„å¥½å¤„"></a>ä½¿ç”¨B+æ ‘çš„å¥½å¤„</h3><p>ç”±äºB+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹åªå­˜æ”¾é”®ï¼Œä¸å­˜æ”¾å€¼ï¼Œå› æ­¤ï¼Œä¸€æ¬¡è¯»å–ï¼Œå¯ä»¥åœ¨å†…å­˜é¡µä¸­è·å–æ›´å¤šçš„é”®ï¼Œæœ‰åˆ©äºæ›´å¿«åœ°ç¼©å°æŸ¥æ‰¾èŒƒå›´ã€‚ B+æ ‘çš„å¶èŠ‚ç‚¹ç”±ä¸€æ¡é“¾ç›¸è¿ï¼Œå› æ­¤ï¼Œå½“éœ€è¦è¿›è¡Œä¸€æ¬¡å…¨æ•°æ®éå†çš„æ—¶å€™ï¼ŒB+æ ‘åªéœ€è¦ä½¿ç”¨O(logN)æ—¶é—´æ‰¾åˆ°æœ€å°çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡é“¾è¿›è¡ŒO(N)çš„é¡ºåºéå†å³å¯ã€‚è€ŒBæ ‘åˆ™éœ€è¦å¯¹æ ‘çš„æ¯ä¸€å±‚è¿›è¡Œéå†ï¼Œè¿™ä¼šéœ€è¦æ›´å¤šçš„å†…å­˜ç½®æ¢æ¬¡æ•°ï¼Œå› æ­¤ä¹Ÿå°±éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´</p><h3 id="Hashç´¢å¼•å’ŒB-æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢"><a href="#Hashç´¢å¼•å’ŒB-æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢" class="headerlink" title="Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?"></a>Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?</h3><p>é¦–å…ˆè¦çŸ¥é“Hashç´¢å¼•å’ŒB+æ ‘ç´¢å¼•çš„åº•å±‚å®ç°åŸç†ï¼š</p><p>hashç´¢å¼•åº•å±‚å°±æ˜¯hashè¡¨ï¼Œè¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡hashå‡½æ•°å°±å¯ä»¥è·å–åˆ°ç›¸åº”çš„é”®å€¼ï¼Œä¹‹åè¿›è¡Œå›è¡¨æŸ¥è¯¢è·å¾—å®é™…æ•°æ®ã€‚B+æ ‘åº•å±‚å®ç°æ˜¯å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å¯¹äºæ¯ä¸€æ¬¡çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼ŒæŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹æ–¹å¯ä»¥è·å¾—æ‰€æŸ¥é”®å€¼ï¼Œç„¶åæ ¹æ®æŸ¥è¯¢åˆ¤æ–­æ˜¯å¦éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ã€‚</p><p>é‚£ä¹ˆå¯ä»¥çœ‹å‡ºä»–ä»¬æœ‰ä»¥ä¸‹çš„ä¸åŒï¼š</p><ul><li>hashç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ›´å¿«(ä¸€èˆ¬æƒ…å†µä¸‹)ï¼Œä½†æ˜¯å´æ— æ³•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚</li></ul><p>å› ä¸ºåœ¨hashç´¢å¼•ä¸­ç»è¿‡hashå‡½æ•°å»ºç«‹ç´¢å¼•ä¹‹åï¼Œç´¢å¼•çš„é¡ºåºä¸åŸé¡ºåºæ— æ³•ä¿æŒä¸€è‡´ï¼Œä¸èƒ½æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚è€ŒB+æ ‘çš„çš„æ‰€æœ‰èŠ‚ç‚¹çš†éµå¾ª(å·¦èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹ï¼Œå³èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œå¤šå‰æ ‘ä¹Ÿç±»ä¼¼)ï¼Œå¤©ç„¶æ”¯æŒèŒƒå›´ã€‚</p><ul><li>hashç´¢å¼•ä¸æ”¯æŒä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºï¼ŒåŸç†åŒä¸Šã€‚</li><li>hashç´¢å¼•ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ä»¥åŠå¤šåˆ—ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é…ã€‚åŸç†ä¹Ÿæ˜¯å› ä¸ºhashå‡½æ•°çš„ä¸å¯é¢„æµ‹ã€‚AAAAå’ŒAAAABçš„ç´¢å¼•æ²¡æœ‰ç›¸å…³æ€§ã€‚</li><li>hashç´¢å¼•ä»»ä½•æ—¶å€™éƒ½é¿å…ä¸äº†å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œè€ŒB+æ ‘åœ¨ç¬¦åˆæŸäº›æ¡ä»¶(èšç°‡ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ç­‰)çš„æ—¶å€™å¯ä»¥åªé€šè¿‡ç´¢å¼•å®ŒæˆæŸ¥è¯¢ã€‚</li><li>hashç´¢å¼•è™½ç„¶åœ¨ç­‰å€¼æŸ¥è¯¢ä¸Šè¾ƒå¿«ï¼Œä½†æ˜¯ä¸ç¨³å®šã€‚æ€§èƒ½ä¸å¯é¢„æµ‹ï¼Œå½“æŸä¸ªé”®å€¼å­˜åœ¨å¤§é‡é‡å¤çš„æ—¶å€™ï¼Œå‘ç”Ÿhashç¢°æ’ï¼Œæ­¤æ—¶æ•ˆç‡å¯èƒ½æå·®ã€‚è€ŒB+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒç¨³å®šï¼Œå¯¹äºæ‰€æœ‰çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¸”æ ‘çš„é«˜åº¦è¾ƒä½ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç›´æ¥é€‰æ‹©B+æ ‘ç´¢å¼•å¯ä»¥è·å¾—ç¨³å®šä¸”è¾ƒå¥½çš„æŸ¥è¯¢é€Ÿåº¦ã€‚è€Œä¸éœ€è¦ä½¿ç”¨hashç´¢å¼•ã€‚</p><h3 id="æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘è€Œä¸æ˜¯Bæ ‘"><a href="#æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘è€Œä¸æ˜¯Bæ ‘" class="headerlink" title="æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘"></a>æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘</h3><ul><li>Bæ ‘åªé€‚åˆéšæœºæ£€ç´¢ï¼Œè€ŒB+æ ‘åŒæ—¶æ”¯æŒéšæœºæ£€ç´¢å’Œé¡ºåºæ£€ç´¢ï¼›</li><li>B+æ ‘ç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œå¯å‡å°‘I/Oæ¬¡æ•°ï¼Œç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚è¿™æ ·çš„è¯ï¼Œç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ä¸­å°±è¦äº§ç”Ÿç£ç›˜I/Oæ¶ˆè€—ã€‚B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œåªæ˜¯ä½œä¸ºç´¢å¼•ä½¿ç”¨ï¼Œå…¶å†…éƒ¨ç»“ç‚¹æ¯”Bæ ‘å°ï¼Œç›˜å—èƒ½å®¹çº³çš„ç»“ç‚¹ä¸­å…³é”®å­—æ•°é‡æ›´å¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­å¯ä»¥æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œç›¸å¯¹çš„ï¼ŒIOè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ã€‚è€ŒIOè¯»å†™æ¬¡æ•°æ˜¯å½±å“ç´¢å¼•æ£€ç´¢æ•ˆç‡çš„æœ€å¤§å› ç´ ï¼›</li><li>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šã€‚Bæ ‘æœç´¢æœ‰å¯èƒ½ä¼šåœ¨éå¶å­ç»“ç‚¹ç»“æŸï¼Œè¶Šé è¿‘æ ¹èŠ‚ç‚¹çš„è®°å½•æŸ¥æ‰¾æ—¶é—´è¶ŠçŸ­ï¼Œåªè¦æ‰¾åˆ°å…³é”®å­—å³å¯ç¡®å®šè®°å½•çš„å­˜åœ¨ï¼Œå…¶æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚è€Œåœ¨B+æ ‘ä¸­ï¼Œé¡ºåºæ£€ç´¢æ¯”è¾ƒæ˜æ˜¾ï¼Œéšæœºæ£€ç´¢æ—¶ï¼Œä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾éƒ½å¿…é¡»èµ°ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯ï¼Œæ‰€æœ‰å…³é”®å­—çš„æŸ¥æ‰¾è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªå…³é”®å­—çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</li><li>B-æ ‘åœ¨æé«˜äº†ç£ç›˜IOæ€§èƒ½çš„åŒæ—¶å¹¶æ²¡æœ‰è§£å†³å…ƒç´ éå†çš„æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚B+æ ‘çš„å¶å­èŠ‚ç‚¹ä½¿ç”¨æŒ‡é’ˆé¡ºåºè¿æ¥åœ¨ä¸€èµ·ï¼Œåªè¦éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®ç°æ•´æ£µæ ‘çš„éå†ã€‚è€Œä¸”åœ¨æ•°æ®åº“ä¸­åŸºäºèŒƒå›´çš„æŸ¥è¯¢æ˜¯éå¸¸é¢‘ç¹çš„ï¼Œè€ŒBæ ‘ä¸æ”¯æŒè¿™æ ·çš„æ“ä½œã€‚</li><li>å¢åˆ æ–‡ä»¶ï¼ˆèŠ‚ç‚¹ï¼‰æ—¶ï¼Œæ•ˆç‡æ›´é«˜ã€‚å› ä¸ºB+æ ‘çš„å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰å…³é”®å­—ï¼Œå¹¶ä»¥æœ‰åºçš„é“¾è¡¨ç»“æ„å­˜å‚¨ï¼Œè¿™æ ·å¯å¾ˆå¥½æé«˜å¢åˆ æ•ˆç‡ã€‚</li></ul><h3 id="B-æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ"><a href="#B-æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ" class="headerlink" title="B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ"></a>B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ</h3><p>åœ¨B+æ ‘çš„ç´¢å¼•ä¸­ï¼Œå¶å­èŠ‚ç‚¹å¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼ï¼Œä¹Ÿå¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼ä»¥åŠæ•´è¡Œçš„æ•°æ®ï¼Œè¿™å°±æ˜¯èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚ åœ¨InnoDBä¸­ï¼Œåªæœ‰ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œåˆ™æŒ‘é€‰ä¸€ä¸ªå”¯ä¸€é”®å»ºç«‹èšç°‡ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œåˆ™éšå¼çš„ç”Ÿæˆä¸€ä¸ªé”®æ¥å»ºç«‹èšç°‡ç´¢å¼•ã€‚</p><p>å½“æŸ¥è¯¢ä½¿ç”¨èšç°‡ç´¢å¼•æ—¶ï¼Œåœ¨å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥è·å–åˆ°æ•´è¡Œæ•°æ®ï¼Œå› æ­¤ä¸ç”¨å†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•"></a>ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•</h3><ul><li>èšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œæ‰¾åˆ°ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ®</li><li>éèšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨äºç´¢å¼•åˆ†å¼€ç»“æ„ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹æŒ‡å‘äº†æ•°æ®çš„å¯¹åº”è¡Œï¼Œmyisamé€šè¿‡key_bufferæŠŠç´¢å¼•å…ˆç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå½“éœ€è¦è®¿é—®æ•°æ®æ—¶ï¼ˆé€šè¿‡ç´¢å¼•è®¿é—®æ•°æ®ï¼‰ï¼Œåœ¨å†…å­˜ä¸­ç›´æ¥æœç´¢ç´¢å¼•ï¼Œç„¶åé€šè¿‡ç´¢å¼•æ‰¾åˆ°ç£ç›˜ç›¸åº”æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç´¢å¼•ä¸åœ¨key bufferå‘½ä¸­æ—¶ï¼Œé€Ÿåº¦æ…¢çš„åŸå› </li></ul><p>æ¾„æ¸…ä¸€ä¸ªæ¦‚å¿µï¼šinnodbä¸­ï¼Œåœ¨èšç°‡ç´¢å¼•ä¹‹ä¸Šåˆ›å»ºçš„ç´¢å¼•ç§°ä¹‹ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•è®¿é—®æ•°æ®æ€»æ˜¯éœ€è¦äºŒæ¬¡æŸ¥æ‰¾ï¼Œéèšç°‡ç´¢å¼•éƒ½æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œåƒå¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„ä¸å†æ˜¯è¡Œçš„ç‰©ç†ä½ç½®ï¼Œè€Œæ˜¯ä¸»é”®å€¼</p><p>ä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMDE1NDQ5OS1kNTNhNWNlOWNlY2YyMmYzLnBuZw?x-oss-process=image/format,png" alt="img"></p><h3 id="éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ"><a href="#éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ" class="headerlink" title="éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ"></a>éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ</h3><p>ä¸ä¸€å®šï¼Œè¿™æ¶‰åŠåˆ°æŸ¥è¯¢è¯­å¥æ‰€è¦æ±‚çš„å­—æ®µæ˜¯å¦å…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•ï¼Œå¦‚æœå…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•ï¼Œé‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨å‘˜å·¥è¡¨çš„å¹´é¾„ä¸Šå»ºç«‹äº†ç´¢å¼•ï¼Œé‚£ä¹ˆå½“è¿›è¡Œ<code>select age from employee where age &lt; 20</code>çš„æŸ¥è¯¢æ—¶ï¼Œåœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œå·²ç»åŒ…å«äº†ageä¿¡æ¯ï¼Œä¸ä¼šå†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p><h3 id="è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ"><a href="#è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ" class="headerlink" title="è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ"></a>è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ</h3><p>MySQLå¯ä»¥ä½¿ç”¨å¤šä¸ªå­—æ®µåŒæ—¶å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œå«åšè”åˆç´¢å¼•ã€‚åœ¨è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœæƒ³è¦å‘½ä¸­ç´¢å¼•ï¼Œéœ€è¦æŒ‰ç…§å»ºç«‹ç´¢å¼•æ—¶çš„å­—æ®µé¡ºåºæŒ¨ä¸ªä½¿ç”¨ï¼Œå¦åˆ™æ— æ³•å‘½ä¸­ç´¢å¼•ã€‚</p><p>å…·ä½“åŸå› ä¸º:</p><p>MySQLä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦ç´¢å¼•æœ‰åºï¼Œå‡è®¾ç°åœ¨å»ºç«‹äº†â€nameï¼Œageï¼Œschoolâ€çš„è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•çš„æ’åºä¸º: å…ˆæŒ‰ç…§nameæ’åºï¼Œå¦‚æœnameç›¸åŒï¼Œåˆ™æŒ‰ç…§ageæ’åºï¼Œå¦‚æœageçš„å€¼ä¹Ÿç›¸ç­‰ï¼Œåˆ™æŒ‰ç…§schoolè¿›è¡Œæ’åºã€‚</p><p>å½“è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ­¤æ—¶ç´¢å¼•ä»…ä»…æŒ‰ç…§nameä¸¥æ ¼æœ‰åºï¼Œå› æ­¤å¿…é¡»é¦–å…ˆä½¿ç”¨nameå­—æ®µè¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œä¹‹åå¯¹äºåŒ¹é…åˆ°çš„åˆ—è€Œè¨€ï¼Œå…¶æŒ‰ç…§ageå­—æ®µä¸¥æ ¼æœ‰åºï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ageå­—æ®µç”¨åšç´¢å¼•æŸ¥æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ã€‚å› æ­¤åœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™åº”è¯¥æ³¨æ„ç´¢å¼•åˆ—çš„é¡ºåºï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†æŸ¥è¯¢éœ€æ±‚é¢‘ç¹æˆ–è€…å­—æ®µé€‰æ‹©æ€§é«˜çš„åˆ—æ”¾åœ¨å‰é¢ã€‚æ­¤å¤–å¯ä»¥æ ¹æ®ç‰¹ä¾‹çš„æŸ¥è¯¢æˆ–è€…è¡¨ç»“æ„è¿›è¡Œå•ç‹¬çš„è°ƒæ•´ã€‚</p><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ</h3><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•°æ®åº“æ“ä½œåºåˆ—ï¼Œä¹Ÿæ˜¯æ•°æ®åº“å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ï¼Œå…¶æ‰§è¡Œçš„ç»“æœå¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€ã€‚äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p><p>äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚</p><p>å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼šå°†å°æ˜çš„ä½™é¢å‡å°‘1000å…ƒï¼Œå°†å°çº¢çš„ä½™é¢å¢åŠ 1000å…ƒã€‚ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚</p><h3 id="äº‹ç‰©çš„å››å¤§ç‰¹æ€§-ACID-ä»‹ç»ä¸€ä¸‹"><a href="#äº‹ç‰©çš„å››å¤§ç‰¹æ€§-ACID-ä»‹ç»ä¸€ä¸‹" class="headerlink" title="äº‹ç‰©çš„å››å¤§ç‰¹æ€§(ACID)ä»‹ç»ä¸€ä¸‹?"></a>äº‹ç‰©çš„å››å¤§ç‰¹æ€§(ACID)ä»‹ç»ä¸€ä¸‹?</h3><p>å…³ç³»æ€§æ•°æ®åº“éœ€è¦éµå¾ªACIDè§„åˆ™ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC81LzIwLzE2MzdiMDhiOTg2MTk0NTU?x-oss-process=image/format,png" alt="äº‹åŠ¡çš„ç‰¹æ€§"></p><ol><li><strong>åŸå­æ€§ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</li><li><strong>ä¸€è‡´æ€§ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼›</li><li><strong>éš”ç¦»æ€§ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</li><li><strong>æŒä¹…æ€§ï¼š</strong> ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li></ol><h3 id="ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ</h3><ul><li>è„è¯»(Drity Read)ï¼šæŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚</li><li>ä¸å¯é‡å¤è¯»(Non-repeatable read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚</li><li>å¹»è¯»(Phantom Read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¸­æ•°æ®ç¬”æ•°ä¸ä¸€è‡´ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†å‡ åˆ—(Row)æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡å´åœ¨æ­¤æ—¶æ’å…¥äº†æ–°çš„å‡ åˆ—æ•°æ®ï¼Œå…ˆå‰çš„äº‹åŠ¡åœ¨æ¥ä¸‹æ¥çš„æŸ¥è¯¢ä¸­ï¼Œå°±ä¼šå‘ç°æœ‰å‡ åˆ—æ•°æ®æ˜¯å®ƒå…ˆå‰æ‰€æ²¡æœ‰çš„ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä¸ºäº†è¾¾åˆ°äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Œæ•°æ®åº“å®šä¹‰äº†4ç§ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œç”±ä½åˆ°é«˜ä¾æ¬¡ä¸ºRead uncommittedã€Read committedã€Repeatable readã€Serializableï¼Œè¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚</p><div class="table-container"><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»å½±è¯»</th></tr></thead><tbody><tr><td>READ-UNCOMMITTED</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>READ-COMMITTED</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>REPEATABLE-READ</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>SERIALIZABLE</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table></div><p><strong>SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š</strong></p><ul><li><strong>READ-UNCOMMITTED(è¯»å–æœªæäº¤)ï¼š</strong> æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</strong>ã€‚</li><li><strong>READ-COMMITTED(è¯»å–å·²æäº¤)ï¼š</strong> å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong>ã€‚</li><li><strong>REPEATABLE-READ(å¯é‡å¤è¯»)ï¼š</strong> å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong>ã€‚</li><li><strong>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)ï¼š</strong> æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»</strong>ã€‚</li></ul><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šMysql é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«</p><p>äº‹åŠ¡éš”ç¦»æœºåˆ¶çš„å®ç°åŸºäºé”æœºåˆ¶å’Œå¹¶å‘è°ƒåº¦ã€‚å…¶ä¸­å¹¶å‘è°ƒåº¦ä½¿ç”¨çš„æ˜¯MVVCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼Œé€šè¿‡ä¿å­˜ä¿®æ”¹çš„æ—§ç‰ˆæœ¬ä¿¡æ¯æ¥æ”¯æŒå¹¶å‘ä¸€è‡´æ€§è¯»å’Œå›æ»šç­‰ç‰¹æ€§ã€‚</p><p>å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯<strong>READ-COMMITTED(è¯»å–æäº¤å†…å®¹):</strong>ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“åœ¨ <strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong> çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ°<strong>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)</strong>éš”ç¦»çº§åˆ«ã€‚</p><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><h3 id="å¯¹MySQLçš„é”äº†è§£å—"><a href="#å¯¹MySQLçš„é”äº†è§£å—" class="headerlink" title="å¯¹MySQLçš„é”äº†è§£å—"></a>å¯¹MySQLçš„é”äº†è§£å—</h3><p>å½“æ•°æ®åº“æœ‰å¹¶å‘äº‹åŠ¡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™éœ€è¦ä¸€äº›æœºåˆ¶æ¥ä¿è¯è®¿é—®çš„æ¬¡åºï¼Œé”æœºåˆ¶å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ã€‚</p><p>å°±åƒé…’åº—çš„æˆ¿é—´ï¼Œå¦‚æœå¤§å®¶éšæ„è¿›å‡ºï¼Œå°±ä¼šå‡ºç°å¤šäººæŠ¢å¤ºåŒä¸€ä¸ªæˆ¿é—´çš„æƒ…å†µï¼Œè€Œåœ¨æˆ¿é—´ä¸Šè£…ä¸Šé”ï¼Œç”³è¯·åˆ°é’¥åŒ™çš„äººæ‰å¯ä»¥å…¥ä½å¹¶ä¸”å°†æˆ¿é—´é”èµ·æ¥ï¼Œå…¶ä»–äººåªæœ‰ç­‰ä»–ä½¿ç”¨å®Œæ¯•æ‰å¯ä»¥å†æ¬¡ä½¿ç”¨ã€‚</p><h3 id="éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»"><a href="#éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»" class="headerlink" title="éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»"></a>éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»</h3><p>åœ¨Read Uncommittedçº§åˆ«ä¸‹ï¼Œè¯»å–æ•°æ®ä¸éœ€è¦åŠ å…±äº«é”ï¼Œè¿™æ ·å°±ä¸ä¼šè·Ÿè¢«ä¿®æ”¹çš„æ•°æ®ä¸Šçš„æ’ä»–é”å†²çª</p><p>åœ¨Read Committedçº§åˆ«ä¸‹ï¼Œè¯»æ“ä½œéœ€è¦åŠ å…±äº«é”ï¼Œä½†æ˜¯åœ¨è¯­å¥æ‰§è¡Œå®Œä»¥åé‡Šæ”¾å…±äº«é”ï¼›</p><p>åœ¨Repeatable Readçº§åˆ«ä¸‹ï¼Œè¯»æ“ä½œéœ€è¦åŠ å…±äº«é”ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å¹¶ä¸é‡Šæ”¾å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»ç­‰å¾…äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ä»¥åæ‰é‡Šæ”¾å…±äº«é”ã€‚</p><p>SERIALIZABLE æ˜¯é™åˆ¶æ€§æœ€å¼ºçš„éš”ç¦»çº§åˆ«ï¼Œå› ä¸ºè¯¥çº§åˆ«<strong>é”å®šæ•´ä¸ªèŒƒå›´çš„é”®</strong>ï¼Œå¹¶ä¸€ç›´æŒæœ‰é”ï¼Œç›´åˆ°äº‹åŠ¡å®Œæˆã€‚</p><h3 id="æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•"><a href="#æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•" class="headerlink" title="æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•"></a>æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•</h3><p>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå¯ä»¥<strong>æŒ‰ç…§é”çš„ç²’åº¦æŠŠæ•°æ®åº“é”åˆ†</strong>ä¸ºè¡Œçº§é”(INNODBå¼•æ“)ã€è¡¨çº§é”(MYISAMå¼•æ“)å’Œé¡µçº§é”(BDBå¼•æ“ )ã€‚</p><p><strong>MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨çš„é”ï¼š</strong></p><ul><li>MyISAMé‡‡ç”¨è¡¨çº§é”(table-level locking)ã€‚</li><li>InnoDBæ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”</li></ul><p>è¡Œçº§é”ï¼Œè¡¨çº§é”å’Œé¡µçº§é”å¯¹æ¯”</p><p><strong>è¡Œçº§é”</strong> è¡Œçº§é”æ˜¯Mysqlä¸­é”å®šç²’åº¦æœ€ç»†çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ã€‚è¡Œçº§é”åˆ†ä¸ºå…±äº«é” å’Œ æ’ä»–é”ã€‚</p><p>ç‰¹ç‚¹ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</p><p><strong>è¡¨çº§é”</strong> è¡¨çº§é”æ˜¯MySQLä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ƒå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—è¾ƒå°‘ï¼Œè¢«å¤§éƒ¨åˆ†MySQLå¼•æ“æ”¯æŒã€‚æœ€å¸¸ä½¿ç”¨çš„MYISAMä¸INNODBéƒ½æ”¯æŒè¡¨çº§é”å®šã€‚è¡¨çº§é”å®šåˆ†ä¸ºè¡¨å…±äº«è¯»é”ï¼ˆå…±äº«é”ï¼‰ä¸è¡¨ç‹¬å å†™é”ï¼ˆæ’ä»–é”ï¼‰ã€‚</p><p>ç‰¹ç‚¹ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘å‡ºé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ã€‚</p><p><strong>é¡µçº§é”</strong> é¡µçº§é”æ˜¯MySQLä¸­é”å®šç²’åº¦ä»‹äºè¡Œçº§é”å’Œè¡¨çº§é”ä¸­é—´çš„ä¸€ç§é”ã€‚è¡¨çº§é”é€Ÿåº¦å¿«ï¼Œä½†å†²çªå¤šï¼Œè¡Œçº§å†²çªå°‘ï¼Œä½†é€Ÿåº¦æ…¢ã€‚æ‰€ä»¥å–äº†æŠ˜è¡·çš„é¡µçº§ï¼Œä¸€æ¬¡é”å®šç›¸é‚»çš„ä¸€ç»„è®°å½•ã€‚</p><p>ç‰¹ç‚¹ï¼šå¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬</p><h3 id="ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿåƒä¸Šé¢é‚£æ ·å­è¿›è¡Œé”å®šå²‚ä¸æ˜¯æœ‰ç‚¹é˜»ç¢å¹¶å‘æ•ˆç‡äº†"><a href="#ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿåƒä¸Šé¢é‚£æ ·å­è¿›è¡Œé”å®šå²‚ä¸æ˜¯æœ‰ç‚¹é˜»ç¢å¹¶å‘æ•ˆç‡äº†" class="headerlink" title="ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿåƒä¸Šé¢é‚£æ ·å­è¿›è¡Œé”å®šå²‚ä¸æ˜¯æœ‰ç‚¹é˜»ç¢å¹¶å‘æ•ˆç‡äº†"></a>ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿåƒä¸Šé¢é‚£æ ·å­è¿›è¡Œé”å®šå²‚ä¸æ˜¯æœ‰ç‚¹é˜»ç¢å¹¶å‘æ•ˆç‡äº†</h3><p><strong>ä»é”çš„ç±»åˆ«ä¸Šæ¥è®²</strong>ï¼Œæœ‰å…±äº«é”å’Œæ’ä»–é”ã€‚</p><p>å…±äº«é”: åˆå«åšè¯»é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„è¯»å–æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šå…±äº«é”ã€‚å…±äº«é”å¯ä»¥åŒæ—¶åŠ ä¸Šå¤šä¸ªã€‚</p><p>æ’ä»–é”: åˆå«åšå†™é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„å†™å…¥æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šæ’ä»–é”ã€‚æ’ä»–é”åªå¯ä»¥åŠ ä¸€ä¸ªï¼Œä»–å’Œå…¶ä»–çš„æ’ä»–é”ï¼Œå…±äº«é”éƒ½ç›¸æ–¥ã€‚</p><p>ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´å°±æ˜¯ç”¨æˆ·çš„è¡Œä¸ºæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¥çœ‹æˆ¿ï¼Œå¤šä¸ªç”¨æˆ·ä¸€èµ·çœ‹æˆ¿æ˜¯å¯ä»¥æ¥å—çš„ã€‚ ä¸€ç§æ˜¯çœŸæ­£çš„å…¥ä½ä¸€æ™šï¼Œåœ¨è¿™æœŸé—´ï¼Œæ— è®ºæ˜¯æƒ³å…¥ä½çš„è¿˜æ˜¯æƒ³çœ‹æˆ¿çš„éƒ½ä¸å¯ä»¥ã€‚</p><p>é”çš„ç²’åº¦å–å†³äºå…·ä½“çš„å­˜å‚¨å¼•æ“ï¼ŒInnoDBå®ç°äº†è¡Œçº§é”ï¼Œé¡µçº§é”ï¼Œè¡¨çº§é”ã€‚</p><p>ä»–ä»¬çš„åŠ é”å¼€é”€ä»å¤§åˆ°å°ï¼Œå¹¶å‘èƒ½åŠ›ä¹Ÿæ˜¯ä»å¤§åˆ°å°ã€‚</p><h3 id="MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>ç­”ï¼šInnoDBæ˜¯åŸºäºç´¢å¼•æ¥å®Œæˆè¡Œé”</p><p>ä¾‹: select * from tab_with_index where id = 1 for update;</p><p>for update å¯ä»¥æ ¹æ®æ¡ä»¶æ¥å®Œæˆè¡Œé”é”å®šï¼Œå¹¶ä¸” id æ˜¯æœ‰ç´¢å¼•é”®çš„åˆ—ï¼Œå¦‚æœ id ä¸æ˜¯ç´¢å¼•é”®é‚£ä¹ˆInnoDBå°†å®Œæˆè¡¨é”ï¼Œå¹¶å‘å°†æ— ä»è°ˆèµ·</p><h3 id="InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§"><a href="#InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§" class="headerlink" title="InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§"></a>InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§</h3><ul><li>Record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”</li><li>Gap lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«</li><li>Next-key lockï¼šrecord+gap é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«</li></ul><p><strong>ç›¸å…³çŸ¥è¯†ç‚¹ï¼š</strong></p><ol><li>innodbå¯¹äºè¡Œçš„æŸ¥è¯¢ä½¿ç”¨next-key lock</li><li>Next-locking keyingä¸ºäº†è§£å†³Phantom Problemå¹»è¯»é—®é¢˜</li><li>å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key</li><li>Gapé”è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€èŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜çš„äº§ç”Ÿ</li><li>æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰ A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</li></ol><h3 id="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h3><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯çš„ç°è±¡ã€‚</p><p>å¸¸è§çš„è§£å†³æ­»é”çš„æ–¹æ³•</p><p>1ã€å¦‚æœä¸åŒç¨‹åºä¼šå¹¶å‘å­˜å–å¤šä¸ªè¡¨ï¼Œå°½é‡çº¦å®šä»¥ç›¸åŒçš„é¡ºåºè®¿é—®è¡¨ï¼Œå¯ä»¥å¤§å¤§é™ä½æ­»é”æœºä¼šã€‚</p><p>2ã€åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå°½å¯èƒ½åšåˆ°ä¸€æ¬¡é”å®šæ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œå‡å°‘æ­»é”äº§ç”Ÿæ¦‚ç‡ï¼›</p><p>3ã€å¯¹äºéå¸¸å®¹æ˜“äº§ç”Ÿæ­»é”çš„ä¸šåŠ¡éƒ¨åˆ†ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å‡çº§é”å®šé¢—ç²’åº¦ï¼Œé€šè¿‡è¡¨çº§é”å®šæ¥å‡å°‘æ­»é”äº§ç”Ÿçš„æ¦‚ç‡ï¼›</p><p>å¦‚æœä¸šåŠ¡å¤„ç†ä¸å¥½å¯ä»¥ç”¨åˆ†å¸ƒå¼äº‹åŠ¡é”æˆ–è€…ä½¿ç”¨ä¹è§‚é”</p><h3 id="æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä¸­çš„å¹¶å‘æ§åˆ¶çš„ä»»åŠ¡æ˜¯ç¡®ä¿åœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–æ•°æ®åº“ä¸­åŒä¸€æ•°æ®æ—¶ä¸ç ´åäº‹åŠ¡çš„éš”ç¦»æ€§å’Œç»Ÿä¸€æ€§ä»¥åŠæ•°æ®åº“çš„ç»Ÿä¸€æ€§ã€‚ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆä¹è§‚é”ï¼‰å’Œæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ˆæ‚²è§‚é”ï¼‰æ˜¯å¹¶å‘æ§åˆ¶ä¸»è¦é‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚</p><p><strong>æ‚²è§‚é”</strong>ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚åœ¨æŸ¥è¯¢å®Œæ•°æ®çš„æ—¶å€™å°±æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œç›´åˆ°æäº¤äº‹åŠ¡ã€‚å®ç°æ–¹å¼ï¼šä½¿ç”¨æ•°æ®åº“ä¸­çš„é”æœºåˆ¶</p><p><strong>ä¹è§‚é”</strong>ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œé€šè¿‡versionçš„æ–¹å¼æ¥è¿›è¡Œé”å®šã€‚å®ç°æ–¹å¼ï¼šä¹ä¸€èˆ¬ä¼šä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ–CASç®—æ³•å®ç°ã€‚</p><p><strong>ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</strong></p><p>ä»ä¸Šé¢å¯¹ä¸¤ç§é”çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒ<strong>ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰</strong>ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚</p><p>ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥<strong>ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</strong></p><h2 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ</h3><p>ä¸ºäº†æé«˜å¤æ‚SQLè¯­å¥çš„å¤ç”¨æ€§å’Œè¡¨æ“ä½œçš„å®‰å…¨æ€§ï¼ŒMySQLæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†è§†å›¾ç‰¹æ€§ã€‚æ‰€è°“è§†å›¾ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§è™šæ‹Ÿè¡¨ï¼Œåœ¨ç‰©ç†ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œå…¶å†…å®¹ä¸çœŸå®çš„è¡¨ç›¸ä¼¼ï¼ŒåŒ…å«ä¸€ç³»åˆ—å¸¦æœ‰åç§°çš„åˆ—å’Œè¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­ä»¥å‚¨å­˜çš„æ•°æ®å€¼å½¢å¼å­˜åœ¨ã€‚è¡Œå’Œåˆ—æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢æ‰€å¼•ç”¨åŸºæœ¬è¡¨ï¼Œå¹¶ä¸”åœ¨å…·ä½“å¼•ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆã€‚</p><p>è§†å›¾ä½¿å¼€å‘è€…åªå…³å¿ƒæ„Ÿå…´è¶£çš„æŸäº›ç‰¹å®šæ•°æ®å’Œæ‰€è´Ÿè´£çš„ç‰¹å®šä»»åŠ¡ï¼Œåªèƒ½çœ‹åˆ°è§†å›¾ä¸­æ‰€å®šä¹‰çš„æ•°æ®ï¼Œè€Œä¸æ˜¯è§†å›¾æ‰€å¼•ç”¨è¡¨ä¸­çš„æ•°æ®ï¼Œä»è€Œæé«˜äº†æ•°æ®åº“ä¸­æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h3 id="è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"><a href="#è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"></a>è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ</h3><p>è§†å›¾çš„ç‰¹ç‚¹å¦‚ä¸‹:</p><ul><li>è§†å›¾çš„åˆ—å¯ä»¥æ¥è‡ªä¸åŒçš„è¡¨ï¼Œæ˜¯è¡¨çš„æŠ½è±¡å’Œåœ¨é€»è¾‘æ„ä¹‰ä¸Šå»ºç«‹çš„æ–°å…³ç³»ã€‚</li><li>è§†å›¾æ˜¯ç”±åŸºæœ¬è¡¨(å®è¡¨)äº§ç”Ÿçš„è¡¨(è™šè¡¨)ã€‚</li><li>è§†å›¾çš„å»ºç«‹å’Œåˆ é™¤ä¸å½±å“åŸºæœ¬è¡¨ã€‚</li><li>å¯¹è§†å›¾å†…å®¹çš„æ›´æ–°(æ·»åŠ ï¼Œåˆ é™¤å’Œä¿®æ”¹)ç›´æ¥å½±å“åŸºæœ¬è¡¨ã€‚</li><li>å½“è§†å›¾æ¥è‡ªå¤šä¸ªåŸºæœ¬è¡¨æ—¶ï¼Œä¸å…è®¸æ·»åŠ å’Œåˆ é™¤æ•°æ®ã€‚</li></ul><p>è§†å›¾çš„æ“ä½œåŒ…æ‹¬åˆ›å»ºè§†å›¾ï¼ŒæŸ¥çœ‹è§†å›¾ï¼Œåˆ é™¤è§†å›¾å’Œä¿®æ”¹è§†å›¾ã€‚</p><h3 id="è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><p>è§†å›¾æ ¹æœ¬ç”¨é€”ï¼šç®€åŒ–sqlæŸ¥è¯¢ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚å¦‚æœè¯´è¿˜æœ‰å¦å¤–ä¸€ä¸ªç”¨é€”é‚£å°±æ˜¯å…¼å®¹è€çš„è¡¨ç»“æ„ã€‚</p><p>ä¸‹é¢æ˜¯è§†å›¾çš„å¸¸è§ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>é‡ç”¨SQLè¯­å¥ï¼›</li><li>ç®€åŒ–å¤æ‚çš„SQLæ“ä½œã€‚åœ¨ç¼–å†™æŸ¥è¯¢åï¼Œå¯ä»¥æ–¹ä¾¿çš„é‡ç”¨å®ƒè€Œä¸å¿…çŸ¥é“å®ƒçš„åŸºæœ¬æŸ¥è¯¢ç»†èŠ‚ï¼›</li><li>ä½¿ç”¨è¡¨çš„ç»„æˆéƒ¨åˆ†è€Œä¸æ˜¯æ•´ä¸ªè¡¨ï¼›</li><li>ä¿æŠ¤æ•°æ®ã€‚å¯ä»¥ç»™ç”¨æˆ·æˆäºˆè¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„è®¿é—®æƒé™è€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™ï¼›</li><li>æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚è§†å›¾å¯è¿”å›ä¸åº•å±‚è¡¨çš„è¡¨ç¤ºå’Œæ ¼å¼ä¸åŒçš„æ•°æ®ã€‚</li></ul><h3 id="è§†å›¾çš„ä¼˜ç‚¹"><a href="#è§†å›¾çš„ä¼˜ç‚¹" class="headerlink" title="è§†å›¾çš„ä¼˜ç‚¹"></a>è§†å›¾çš„ä¼˜ç‚¹</h3><ol><li>æŸ¥è¯¢ç®€å•åŒ–ã€‚è§†å›¾èƒ½ç®€åŒ–ç”¨æˆ·çš„æ“ä½œ</li><li>æ•°æ®å®‰å…¨æ€§ã€‚è§†å›¾ä½¿ç”¨æˆ·èƒ½ä»¥å¤šç§è§’åº¦çœ‹å¾…åŒä¸€æ•°æ®ï¼Œèƒ½å¤Ÿå¯¹æœºå¯†æ•°æ®æä¾›å®‰å…¨ä¿æŠ¤</li><li>é€»è¾‘æ•°æ®ç‹¬ç«‹æ€§ã€‚è§†å›¾å¯¹é‡æ„æ•°æ®åº“æä¾›äº†ä¸€å®šç¨‹åº¦çš„é€»è¾‘ç‹¬ç«‹æ€§</li></ol><h3 id="è§†å›¾çš„ç¼ºç‚¹"><a href="#è§†å›¾çš„ç¼ºç‚¹" class="headerlink" title="è§†å›¾çš„ç¼ºç‚¹"></a>è§†å›¾çš„ç¼ºç‚¹</h3><ol><li><p>æ€§èƒ½ã€‚æ•°æ®åº“å¿…é¡»æŠŠè§†å›¾çš„æŸ¥è¯¢è½¬åŒ–æˆå¯¹åŸºæœ¬è¡¨çš„æŸ¥è¯¢ï¼Œå¦‚æœè¿™ä¸ªè§†å›¾æ˜¯ç”±ä¸€ä¸ªå¤æ‚çš„å¤šè¡¨æŸ¥è¯¢æ‰€å®šä¹‰ï¼Œé‚£ä¹ˆï¼Œå³ä½¿æ˜¯è§†å›¾çš„ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œæ•°æ®åº“ä¹ŸæŠŠå®ƒå˜æˆä¸€ä¸ªå¤æ‚çš„ç»“åˆä½“ï¼Œéœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ã€‚</p></li><li><p>ä¿®æ”¹é™åˆ¶ã€‚å½“ç”¨æˆ·è¯•å›¾ä¿®æ”¹è§†å›¾çš„æŸäº›è¡Œæ—¶ï¼Œæ•°æ®åº“å¿…é¡»æŠŠå®ƒè½¬åŒ–ä¸ºå¯¹åŸºæœ¬è¡¨çš„æŸäº›è¡Œçš„ä¿®æ”¹ã€‚äº‹å®ä¸Šï¼Œå½“ä»è§†å›¾ä¸­æ’å…¥æˆ–è€…åˆ é™¤æ—¶ï¼Œæƒ…å†µä¹Ÿæ˜¯è¿™æ ·ã€‚å¯¹äºç®€å•è§†å›¾æ¥è¯´ï¼Œè¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯ï¼Œå¯¹äºæ¯”è¾ƒå¤æ‚çš„è§†å›¾ï¼Œå¯èƒ½æ˜¯ä¸å¯ä¿®æ”¹çš„</p><p>è¿™äº›è§†å›¾æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š1.æœ‰UNIQUEç­‰é›†åˆæ“ä½œç¬¦çš„è§†å›¾ã€‚2.æœ‰GROUP BYå­å¥çš„è§†å›¾ã€‚3.æœ‰è¯¸å¦‚AVG\SUM\MAXç­‰èšåˆå‡½æ•°çš„è§†å›¾ã€‚ 4.ä½¿ç”¨DISTINCTå…³é”®å­—çš„è§†å›¾ã€‚5.è¿æ¥è¡¨çš„è§†å›¾ï¼ˆå…¶ä¸­æœ‰äº›ä¾‹å¤–ï¼‰</p></li></ol><h3 id="ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ</h3><p>æ¸¸æ ‡æ˜¯ç³»ç»Ÿä¸ºç”¨æˆ·å¼€è®¾çš„ä¸€ä¸ªæ•°æ®ç¼“å†²åŒºï¼Œå­˜æ”¾SQLè¯­å¥çš„æ‰§è¡Œç»“æœï¼Œæ¯ä¸ªæ¸¸æ ‡åŒºéƒ½æœ‰ä¸€ä¸ªåå­—ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ¸¸æ ‡é€ä¸€è·å–è®°å½•å¹¶èµ‹ç»™ä¸»å˜é‡ï¼Œäº¤ç”±ä¸»è¯­è¨€è¿›ä¸€æ­¥å¤„ç†ã€‚</p><h2 id="å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°"><a href="#å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°"></a>å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°</h2><h3 id="ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼Œä¼˜ç‚¹æ˜¯å…è®¸æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œå°±æ˜¯è¯´åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼Œä»¥ååœ¨è¯¥ç¨‹åºä¸­å°±å¯ä»¥è°ƒç”¨å¤šæ¬¡ã€‚å¦‚æœæŸæ¬¡æ“ä½œéœ€è¦æ‰§è¡Œå¤šæ¬¡SQLï¼Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¯”å•çº¯SQLè¯­å¥æ‰§è¡Œè¦å¿«ã€‚</p><p><strong>ä¼˜ç‚¹</strong></p><p>1ï¼‰å­˜å‚¨è¿‡ç¨‹æ˜¯é¢„ç¼–è¯‘è¿‡çš„ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</p><p>2ï¼‰å­˜å‚¨è¿‡ç¨‹çš„ä»£ç ç›´æ¥å­˜æ”¾äºæ•°æ®åº“ä¸­ï¼Œé€šè¿‡å­˜å‚¨è¿‡ç¨‹åç›´æ¥è°ƒç”¨ï¼Œå‡å°‘ç½‘ç»œé€šè®¯ã€‚</p><p>3ï¼‰å®‰å…¨æ€§é«˜ï¼Œæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éœ€è¦æœ‰ä¸€å®šæƒé™çš„ç”¨æˆ·ã€‚</p><p>4ï¼‰å­˜å‚¨è¿‡ç¨‹å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå‡å°‘æ•°æ®åº“å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚</p><p><strong>ç¼ºç‚¹</strong></p><p>1ï¼‰è°ƒè¯•éº»çƒ¦ï¼Œä½†æ˜¯ç”¨ PL/SQL Developer è°ƒè¯•å¾ˆæ–¹ä¾¿ï¼å¼¥è¡¥è¿™ä¸ªç¼ºç‚¹ã€‚</p><p>2ï¼‰ç§»æ¤é—®é¢˜ï¼Œæ•°æ®åº“ç«¯ä»£ç å½“ç„¶æ˜¯ä¸æ•°æ®åº“ç›¸å…³çš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯åšå·¥ç¨‹å‹é¡¹ç›®ï¼ŒåŸºæœ¬ä¸å­˜åœ¨ç§»æ¤é—®é¢˜ã€‚</p><p>3ï¼‰é‡æ–°ç¼–è¯‘é—®é¢˜ï¼Œå› ä¸ºåç«¯ä»£ç æ˜¯è¿è¡Œå‰ç¼–è¯‘çš„ï¼Œå¦‚æœå¸¦æœ‰å¼•ç”¨å…³ç³»çš„å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå—å½±å“çš„å­˜å‚¨è¿‡ç¨‹ã€åŒ…å°†éœ€è¦é‡æ–°ç¼–è¯‘ï¼ˆä¸è¿‡ä¹Ÿå¯ä»¥è®¾ç½®æˆè¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¼–è¯‘ï¼‰ã€‚</p><p>4ï¼‰å¦‚æœåœ¨ä¸€ä¸ªç¨‹åºç³»ç»Ÿä¸­å¤§é‡çš„ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ°ç¨‹åºäº¤ä»˜ä½¿ç”¨çš„æ—¶å€™éšç€ç”¨æˆ·éœ€æ±‚çš„å¢åŠ ä¼šå¯¼è‡´æ•°æ®ç»“æ„çš„å˜åŒ–ï¼Œæ¥ç€å°±æ˜¯ç³»ç»Ÿçš„ç›¸å…³é—®é¢˜äº†ï¼Œæœ€åå¦‚æœç”¨æˆ·æƒ³ç»´æŠ¤è¯¥ç³»ç»Ÿå¯ä»¥è¯´æ˜¯å¾ˆéš¾å¾ˆéš¾ã€è€Œä¸”ä»£ä»·æ˜¯ç©ºå‰çš„ï¼Œç»´æŠ¤èµ·æ¥æ›´éº»çƒ¦ã€‚</p><h2 id="è§¦å‘å™¨"><a href="#è§¦å‘å™¨" class="headerlink" title="è§¦å‘å™¨"></a>è§¦å‘å™¨</h2><h3 id="ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><p>è§¦å‘å™¨æ˜¯ç”¨æˆ·å®šä¹‰åœ¨å…³ç³»è¡¨ä¸Šçš„ä¸€ç±»ç”±äº‹ä»¶é©±åŠ¨çš„ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ã€‚è§¦å‘å™¨æ˜¯æŒ‡ä¸€æ®µä»£ç ï¼Œå½“è§¦å‘æŸä¸ªäº‹ä»¶æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œè¿™äº›ä»£ç ã€‚</p><p>ä½¿ç”¨åœºæ™¯</p><ul><li>å¯ä»¥é€šè¿‡æ•°æ®åº“ä¸­çš„ç›¸å…³è¡¨å®ç°çº§è”æ›´æ”¹ã€‚</li><li>å®æ—¶ç›‘æ§æŸå¼ è¡¨ä¸­çš„æŸä¸ªå­—æ®µçš„æ›´æ”¹è€Œéœ€è¦åšå‡ºç›¸åº”çš„å¤„ç†ã€‚</li><li>ä¾‹å¦‚å¯ä»¥ç”ŸæˆæŸäº›ä¸šåŠ¡çš„ç¼–å·ã€‚</li><li>æ³¨æ„ä¸è¦æ»¥ç”¨ï¼Œå¦åˆ™ä¼šé€ æˆæ•°æ®åº“åŠåº”ç”¨ç¨‹åºçš„ç»´æŠ¤å›°éš¾ã€‚</li><li>å¤§å®¶éœ€è¦ç‰¢è®°ä»¥ä¸ŠåŸºç¡€çŸ¥è¯†ç‚¹ï¼Œé‡ç‚¹æ˜¯ç†è§£æ•°æ®ç±»å‹CHARå’ŒVARCHARçš„å·®å¼‚ï¼Œè¡¨å­˜å‚¨å¼•æ“InnoDBå’ŒMyISAMçš„åŒºåˆ«ã€‚</li></ul><h3 id="MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ"><a href="#MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ" class="headerlink" title="MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ"></a>MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ</h3><p>åœ¨MySQLæ•°æ®åº“ä¸­æœ‰å¦‚ä¸‹å…­ç§è§¦å‘å™¨ï¼š</p><ul><li>Before Insert</li><li>After Insert</li><li>Before Update</li><li>After Update</li><li>Before Delete</li><li>After Delete</li></ul><h2 id="å¸¸ç”¨SQLè¯­å¥"><a href="#å¸¸ç”¨SQLè¯­å¥" class="headerlink" title="å¸¸ç”¨SQLè¯­å¥"></a>å¸¸ç”¨SQLè¯­å¥</h2><h3 id="SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»"><a href="#SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»" class="headerlink" title="SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»"></a>SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»</h3><p>æ•°æ®å®šä¹‰è¯­è¨€DDLï¼ˆData Ddefinition Languageï¼‰CREATEï¼ŒDROPï¼ŒALTER</p><p>ä¸»è¦ä¸ºä»¥ä¸Šæ“ä½œ å³å¯¹é€»è¾‘ç»“æ„ç­‰æœ‰æ“ä½œçš„ï¼Œå…¶ä¸­åŒ…æ‹¬è¡¨ç»“æ„ï¼Œè§†å›¾å’Œç´¢å¼•ã€‚</p><p>æ•°æ®æŸ¥è¯¢è¯­è¨€DQLï¼ˆData Query Languageï¼‰SELECT</p><p>è¿™ä¸ªè¾ƒä¸ºå¥½ç†è§£ å³æŸ¥è¯¢æ“ä½œï¼Œä»¥selectå…³é”®å­—ã€‚å„ç§ç®€å•æŸ¥è¯¢ï¼Œè¿æ¥æŸ¥è¯¢ç­‰ éƒ½å±äºDQLã€‚</p><p>æ•°æ®æ“çºµè¯­è¨€DMLï¼ˆData Manipulation Languageï¼‰INSERTï¼ŒUPDATEï¼ŒDELETE</p><p>ä¸»è¦ä¸ºä»¥ä¸Šæ“ä½œ å³å¯¹æ•°æ®è¿›è¡Œæ“ä½œçš„ï¼Œå¯¹åº”ä¸Šé¢æ‰€è¯´çš„æŸ¥è¯¢æ“ä½œ DQLä¸DMLå…±åŒæ„å»ºäº†å¤šæ•°åˆçº§ç¨‹åºå‘˜å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚è€ŒæŸ¥è¯¢æ˜¯è¾ƒä¸ºç‰¹æ®Šçš„ä¸€ç§ è¢«åˆ’åˆ†åˆ°DQLä¸­ã€‚</p><p>æ•°æ®æ§åˆ¶åŠŸèƒ½DCLï¼ˆData Control Languageï¼‰GRANTï¼ŒREVOKEï¼ŒCOMMITï¼ŒROLLBACK</p><p>ä¸»è¦ä¸ºä»¥ä¸Šæ“ä½œ å³å¯¹æ•°æ®åº“å®‰å…¨æ€§å®Œæ•´æ€§ç­‰æœ‰æ“ä½œçš„ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæƒé™æ§åˆ¶ç­‰ã€‚</p><h3 id="è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>è¶…é”®ï¼šåœ¨å…³ç³»ä¸­èƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†ç§°ä¸ºå…³ç³»æ¨¡å¼çš„è¶…é”®ã€‚ä¸€ä¸ªå±æ€§å¯ä»¥ä¸ºä½œä¸ºä¸€ä¸ªè¶…é”®ï¼Œå¤šä¸ªå±æ€§ç»„åˆåœ¨ä¸€èµ·ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªè¶…é”®ã€‚è¶…é”®åŒ…å«å€™é€‰é”®å’Œä¸»é”®ã€‚</li><li>å€™é€‰é”®ï¼šæ˜¯æœ€å°è¶…é”®ï¼Œå³æ²¡æœ‰å†—ä½™å…ƒç´ çš„è¶…é”®ã€‚</li><li>ä¸»é”®ï¼šæ•°æ®åº“è¡¨ä¸­å¯¹å‚¨å­˜æ•°æ®å¯¹è±¡äºˆä»¥å”¯ä¸€å’Œå®Œæ•´æ ‡è¯†çš„æ•°æ®åˆ—æˆ–å±æ€§çš„ç»„åˆã€‚ä¸€ä¸ªæ•°æ®åˆ—åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä¸”ä¸»é”®çš„å–å€¼ä¸èƒ½ç¼ºå¤±ï¼Œå³ä¸èƒ½ä¸ºç©ºå€¼ï¼ˆNullï¼‰ã€‚</li><li>å¤–é”®ï¼šåœ¨ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨çš„å¦ä¸€ä¸ªè¡¨çš„ä¸»é”®ç§°æ­¤è¡¨çš„å¤–é”®ã€‚</li></ul><h3 id="SQL-çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ"><a href="#SQL-çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ" class="headerlink" title="SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ"></a>SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ</h3><blockquote><p>SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ</p></blockquote><ul><li>NOT NULL: ç”¨äºæ§åˆ¶å­—æ®µçš„å†…å®¹ä¸€å®šä¸èƒ½ä¸ºç©ºï¼ˆNULLï¼‰ã€‚</li><li>UNIQUE: æ§ä»¶å­—æ®µå†…å®¹ä¸èƒ½é‡å¤ï¼Œä¸€ä¸ªè¡¨å…è®¸æœ‰å¤šä¸ª Unique çº¦æŸã€‚</li><li>PRIMARY KEY: ä¹Ÿæ˜¯ç”¨äºæ§ä»¶å­—æ®µå†…å®¹ä¸èƒ½é‡å¤ï¼Œä½†å®ƒåœ¨ä¸€ä¸ªè¡¨åªå…è®¸å‡ºç°ä¸€ä¸ªã€‚</li><li>FOREIGN KEY: ç”¨äºé¢„é˜²ç ´åè¡¨ä¹‹é—´è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿèƒ½é˜²æ­¢éæ³•æ•°æ®æ’å…¥å¤–é”®åˆ—ï¼Œå› ä¸ºå®ƒå¿…é¡»æ˜¯å®ƒæŒ‡å‘çš„é‚£ä¸ªè¡¨ä¸­çš„å€¼ä¹‹ä¸€ã€‚</li><li>CHECK: ç”¨äºæ§åˆ¶å­—æ®µçš„å€¼èŒƒå›´ã€‚</li></ul><h3 id="å…­ç§å…³è”æŸ¥è¯¢"><a href="#å…­ç§å…³è”æŸ¥è¯¢" class="headerlink" title="å…­ç§å…³è”æŸ¥è¯¢"></a>å…­ç§å…³è”æŸ¥è¯¢</h3><ul><li>äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰</li><li>å†…è¿æ¥ï¼ˆINNER JOINï¼‰</li><li>å¤–è¿æ¥ï¼ˆLEFT JOIN/RIGHT JOINï¼‰</li><li>è”åˆæŸ¥è¯¢ï¼ˆUNIONä¸UNION ALLï¼‰</li><li>å…¨è¿æ¥ï¼ˆFULL JOINï¼‰</li><li>äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A,B(,C)æˆ–è€…<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> B (<span class="keyword">CROSS</span> <span class="keyword">JOIN</span> C)#æ²¡æœ‰ä»»ä½•å…³è”æ¡ä»¶ï¼Œç»“æœæ˜¯ç¬›å¡å°”ç§¯ï¼Œç»“æœé›†ä¼šå¾ˆå¤§ï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œå¾ˆå°‘ä½¿ç”¨å†…è¿æ¥ï¼ˆ<span class="keyword">INNER</span> <span class="keyword">JOIN</span>ï¼‰<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A,B <span class="keyword">WHERE</span> A.id=B.idæˆ–è€…<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> A.id=B.idå¤šè¡¨ä¸­åŒæ—¶ç¬¦åˆæŸç§æ¡ä»¶çš„æ•°æ®è®°å½•çš„é›†åˆï¼Œ<span class="keyword">INNER</span> <span class="keyword">JOIN</span>å¯ä»¥ç¼©å†™ä¸º<span class="keyword">JOIN</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>å†…è¿æ¥åˆ†ä¸ºä¸‰ç±»</p><ul><li>ç­‰å€¼è¿æ¥ï¼šON A.id=B.id</li><li>ä¸ç­‰å€¼è¿æ¥ï¼šON A.id &gt; B.id</li><li>è‡ªè¿æ¥ï¼šSELECT * FROM A T1 INNER JOIN A T2 ON T1.id=T2.pid</li></ul><p>å¤–è¿æ¥ï¼ˆLEFT JOIN/RIGHT JOINï¼‰</p><ul><li>å·¦å¤–è¿æ¥ï¼šLEFT OUTER JOIN, ä»¥å·¦è¡¨ä¸ºä¸»ï¼Œå…ˆæŸ¥è¯¢å‡ºå·¦è¡¨ï¼ŒæŒ‰ç…§ONåçš„å…³è”æ¡ä»¶åŒ¹é…å³è¡¨ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ç”¨NULLå¡«å……ï¼Œå¯ä»¥ç®€å†™æˆLEFT JOIN</li><li>å³å¤–è¿æ¥ï¼šRIGHT OUTER JOIN, ä»¥å³è¡¨ä¸ºä¸»ï¼Œå…ˆæŸ¥è¯¢å‡ºå³è¡¨ï¼ŒæŒ‰ç…§ONåçš„å…³è”æ¡ä»¶åŒ¹é…å·¦è¡¨ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ç”¨NULLå¡«å……ï¼Œå¯ä»¥ç®€å†™æˆRIGHT JOIN</li></ul><p>è”åˆæŸ¥è¯¢ï¼ˆUNIONä¸UNION ALLï¼‰</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A <span class="keyword">UNION</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> B <span class="keyword">UNION</span> ...</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>å°±æ˜¯æŠŠå¤šä¸ªç»“æœé›†é›†ä¸­åœ¨ä¸€èµ·ï¼ŒUNIONå‰çš„ç»“æœä¸ºåŸºå‡†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è”åˆæŸ¥è¯¢çš„åˆ—æ•°è¦ç›¸ç­‰ï¼Œç›¸åŒçš„è®°å½•è¡Œä¼šåˆå¹¶</li><li>å¦‚æœä½¿ç”¨UNION ALLï¼Œä¸ä¼šåˆå¹¶é‡å¤çš„è®°å½•è¡Œ</li><li>æ•ˆç‡ UNION é«˜äº UNION ALL</li></ul><p>å…¨è¿æ¥ï¼ˆFULL JOINï¼‰</p><ul><li>mysqlä¸æ”¯æŒå…¨è¿æ¥</li><li>å¯ä»¥ä½¿ç”¨LEFT JOIN å’ŒUNIONå’ŒRIGHT JOINè”åˆä½¿ç”¨</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> A.id=B.id UNIONSELECT * <span class="keyword">FROM</span> A <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> A.id=B.id</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¡¨è¿æ¥é¢è¯•é¢˜</p><p>æœ‰2å¼ è¡¨ï¼Œ1å¼ Rã€1å¼ Sï¼ŒRè¡¨æœ‰ABCä¸‰åˆ—ï¼ŒSè¡¨æœ‰CDä¸¤åˆ—ï¼Œè¡¨ä¸­å„æœ‰ä¸‰æ¡è®°å½•ã€‚</p><p>Rè¡¨</p><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td></tr></tbody></table></div><p>Sè¡¨</p><div class="table-container"><table><thead><tr><th>C</th><th>D</th></tr></thead><tbody><tr><td>c1</td><td>d1</td></tr><tr><td>c2</td><td>d2</td></tr><tr><td>c4</td><td>d3</td></tr></tbody></table></div><ol><li>äº¤å‰è¿æ¥(ç¬›å¡å°”ç§¯):</li></ol><p>select r.<code>*</code>,s.<code>*</code> from r,s</p><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c1</td><td>d1</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td>c1</td><td>d1</td></tr><tr><td>a1</td><td>b1</td><td>c1</td><td>c2</td><td>d2</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td>c2</td><td>d2</td></tr><tr><td>a1</td><td>b1</td><td>c1</td><td>c4</td><td>d3</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c4</td><td>d3</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td>c4</td><td>d3</td></tr></tbody></table></div><ol><li><p>å†…è¿æ¥ç»“æœï¼š</p><p>select r.<code>*</code>,s.<code>*</code> from r inner join s on r.c=s.c</p></li></ol><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr></tbody></table></div><ol><li><p>å·¦è¿æ¥ç»“æœï¼š</p><p>select r.<code>*</code>,s.<code>*</code> from r left join s on r.c=s.c</p></li></ol><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td></td></tr></tbody></table></div><ol><li><p>å³è¿æ¥ç»“æœï¼š</p><p>select r.<code>*</code>,s.<code>*</code> from r right join s on r.c=s.c</p></li></ol><div class="table-container"><table><thead><tr><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>A</td><td>B</td><td>C</td><td>C</td><td>D</td></tr><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td></td><td></td><td></td><td>c4</td><td>d3</td></tr></tbody></table></div><ol><li><p>å…¨è¡¨è¿æ¥çš„ç»“æœï¼ˆMySqlä¸æ”¯æŒï¼ŒOracleæ”¯æŒï¼‰ï¼š</p><p>select r.<code>*</code>,s.<code>*</code> from r full join s on r.c=s.c</p></li></ol><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td>c4</td><td>d3</td></tr></tbody></table></div><h3 id="ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢"><a href="#ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢" class="headerlink" title="ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢"></a>ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢</h3><ol><li>æ¡ä»¶ï¼šä¸€æ¡SQLè¯­å¥çš„æŸ¥è¯¢ç»“æœåšä¸ºå¦ä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶æˆ–æŸ¥è¯¢ç»“æœ</li><li>åµŒå¥—ï¼šå¤šæ¡SQLè¯­å¥åµŒå¥—ä½¿ç”¨ï¼Œå†…éƒ¨çš„SQLæŸ¥è¯¢è¯­å¥ç§°ä¸ºå­æŸ¥è¯¢ã€‚</li></ol><h3 id="å­æŸ¥è¯¢çš„ä¸‰ç§æƒ…å†µ"><a href="#å­æŸ¥è¯¢çš„ä¸‰ç§æƒ…å†µ" class="headerlink" title="å­æŸ¥è¯¢çš„ä¸‰ç§æƒ…å†µ"></a>å­æŸ¥è¯¢çš„ä¸‰ç§æƒ…å†µ</h3><ol><li>å­æŸ¥è¯¢æ˜¯å•è¡Œå•åˆ—çš„æƒ…å†µï¼šç»“æœé›†æ˜¯ä¸€ä¸ªå€¼ï¼Œçˆ¶æŸ¥è¯¢ä½¿ç”¨ï¼š=ã€ &lt;ã€ &gt; ç­‰è¿ç®—ç¬¦</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å·¥èµ„æœ€é«˜çš„å‘˜å·¥æ˜¯è°ï¼Ÿ </span></span><br><span class="line"><span class="keyword">select</span>  * <span class="keyword">from</span> employee <span class="keyword">where</span> salary=(<span class="keyword">select</span> <span class="keyword">max</span>(salary) <span class="keyword">from</span> employee);   </span><br><span class="line">12</span><br></pre></td></tr></table></figure><ol><li>å­æŸ¥è¯¢æ˜¯å¤šè¡Œå•åˆ—çš„æƒ…å†µï¼šç»“æœé›†ç±»ä¼¼äºä¸€ä¸ªæ•°ç»„ï¼Œçˆ¶æŸ¥è¯¢ä½¿ç”¨ï¼šin è¿ç®—ç¬¦</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å·¥èµ„æœ€é«˜çš„å‘˜å·¥æ˜¯è°ï¼Ÿ </span></span><br><span class="line"><span class="keyword">select</span>  * <span class="keyword">from</span> employee <span class="keyword">where</span> salary=(<span class="keyword">select</span> <span class="keyword">max</span>(salary) <span class="keyword">from</span> employee);    </span><br><span class="line">12</span><br></pre></td></tr></table></figure><ol><li>å­æŸ¥è¯¢æ˜¯å¤šè¡Œå¤šåˆ—çš„æƒ…å†µï¼šç»“æœé›†ç±»ä¼¼äºä¸€å¼ è™šæ‹Ÿè¡¨ï¼Œä¸èƒ½ç”¨äºwhereæ¡ä»¶ï¼Œç”¨äºselectå­å¥ä¸­åšä¸ºå­è¡¨</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1) æŸ¥è¯¢å‡º2011å¹´ä»¥åå…¥èŒçš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">-- 2) æŸ¥è¯¢æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯ï¼Œä¸ä¸Šé¢çš„è™šæ‹Ÿè¡¨ä¸­çš„ä¿¡æ¯æ¯”å¯¹ï¼Œæ‰¾å‡ºæ‰€æœ‰éƒ¨é—¨IDç›¸ç­‰çš„å‘˜å·¥ã€‚</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dept d,  (<span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> join_date &gt; <span class="string">&#x27;2011-1-1&#x27;</span>) e <span class="keyword">where</span> e.dept_id =  d.id;    </span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨è¡¨è¿æ¥ï¼š</span></span><br><span class="line"><span class="keyword">select</span> d.*, e.* <span class="keyword">from</span>  dept d <span class="keyword">inner</span> <span class="keyword">join</span> employee e <span class="keyword">on</span> d.id = e.dept_id <span class="keyword">where</span> e.join_date &gt;  <span class="string">&#x27;2011-1-1&#x27;</span>  </span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><h3 id="mysqlä¸­-in-å’Œ-exists-åŒºåˆ«"><a href="#mysqlä¸­-in-å’Œ-exists-åŒºåˆ«" class="headerlink" title="mysqlä¸­ in å’Œ exists åŒºåˆ«"></a>mysqlä¸­ in å’Œ exists åŒºåˆ«</h3><p>mysqlä¸­çš„inè¯­å¥æ˜¯æŠŠå¤–è¡¨å’Œå†…è¡¨ä½œhash è¿æ¥ï¼Œè€Œexistsè¯­å¥æ˜¯å¯¹å¤–è¡¨ä½œloopå¾ªç¯ï¼Œæ¯æ¬¡loopå¾ªç¯å†å¯¹å†…è¡¨è¿›è¡ŒæŸ¥è¯¢ã€‚ä¸€ç›´å¤§å®¶éƒ½è®¤ä¸ºexistsæ¯”inè¯­å¥çš„æ•ˆç‡è¦é«˜ï¼Œè¿™ç§è¯´æ³•å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚è¿™ä¸ªæ˜¯è¦åŒºåˆ†ç¯å¢ƒçš„ã€‚</p><ol><li>å¦‚æœæŸ¥è¯¢çš„ä¸¤ä¸ªè¡¨å¤§å°ç›¸å½“ï¼Œé‚£ä¹ˆç”¨inå’Œexistså·®åˆ«ä¸å¤§ã€‚</li><li>å¦‚æœä¸¤ä¸ªè¡¨ä¸­ä¸€ä¸ªè¾ƒå°ï¼Œä¸€ä¸ªæ˜¯å¤§è¡¨ï¼Œåˆ™å­æŸ¥è¯¢è¡¨å¤§çš„ç”¨existsï¼Œå­æŸ¥è¯¢è¡¨å°çš„ç”¨inã€‚</li><li>not in å’Œnot existsï¼šå¦‚æœæŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†not inï¼Œé‚£ä¹ˆå†…å¤–è¡¨éƒ½è¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼›è€Œnot extstsçš„å­æŸ¥è¯¢ä¾ç„¶èƒ½ç”¨åˆ°è¡¨ä¸Šçš„ç´¢å¼•ã€‚æ‰€ä»¥æ— è®ºé‚£ä¸ªè¡¨å¤§ï¼Œç”¨not existséƒ½æ¯”not inè¦å¿«ã€‚</li></ol><h3 id="varcharä¸charçš„åŒºåˆ«"><a href="#varcharä¸charçš„åŒºåˆ«" class="headerlink" title="varcharä¸charçš„åŒºåˆ«"></a>varcharä¸charçš„åŒºåˆ«</h3><p><strong>charçš„ç‰¹ç‚¹</strong></p><ul><li>charè¡¨ç¤ºå®šé•¿å­—ç¬¦ä¸²ï¼Œé•¿åº¦æ˜¯å›ºå®šçš„ï¼›</li><li>å¦‚æœæ’å…¥æ•°æ®çš„é•¿åº¦å°äºcharçš„å›ºå®šé•¿åº¦æ—¶ï¼Œåˆ™ç”¨ç©ºæ ¼å¡«å……ï¼›</li><li>å› ä¸ºé•¿åº¦å›ºå®šï¼Œæ‰€ä»¥å­˜å–é€Ÿåº¦è¦æ¯”varcharå¿«å¾ˆå¤šï¼Œç”šè‡³èƒ½å¿«50%ï¼Œä½†æ­£å› ä¸ºå…¶é•¿åº¦å›ºå®šï¼Œæ‰€ä»¥ä¼šå æ®å¤šä½™çš„ç©ºé—´ï¼Œæ˜¯ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼›</li><li>å¯¹äºcharæ¥è¯´ï¼Œæœ€å¤šèƒ½å­˜æ”¾çš„å­—ç¬¦ä¸ªæ•°ä¸º255ï¼Œå’Œç¼–ç æ— å…³</li></ul><p><strong>varcharçš„ç‰¹ç‚¹</strong></p><ul><li>varcharè¡¨ç¤ºå¯å˜é•¿å­—ç¬¦ä¸²ï¼Œé•¿åº¦æ˜¯å¯å˜çš„ï¼›</li><li>æ’å…¥çš„æ•°æ®æ˜¯å¤šé•¿ï¼Œå°±æŒ‰ç…§å¤šé•¿æ¥å­˜å‚¨ï¼›</li><li>varcharåœ¨å­˜å–æ–¹é¢ä¸charç›¸åï¼Œå®ƒå­˜å–æ…¢ï¼Œå› ä¸ºé•¿åº¦ä¸å›ºå®šï¼Œä½†æ­£å› å¦‚æ­¤ï¼Œä¸å æ®å¤šä½™çš„ç©ºé—´ï¼Œæ˜¯æ—¶é—´æ¢ç©ºé—´çš„åšæ³•ï¼›</li><li>å¯¹äºvarcharæ¥è¯´ï¼Œæœ€å¤šèƒ½å­˜æ”¾çš„å­—ç¬¦ä¸ªæ•°ä¸º65532</li></ul><p>æ€»ä¹‹ï¼Œç»“åˆæ€§èƒ½è§’åº¦ï¼ˆcharæ›´å¿«ï¼‰å’ŒèŠ‚çœç£ç›˜ç©ºé—´è§’åº¦ï¼ˆvarcharæ›´å°ï¼‰ï¼Œå…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“æ¥è®¾è®¡æ•°æ®åº“æ‰æ˜¯å¦¥å½“çš„åšæ³•ã€‚</p><h3 id="varchar-50-ä¸­50çš„æ¶µä¹‰"><a href="#varchar-50-ä¸­50çš„æ¶µä¹‰" class="headerlink" title="varchar(50)ä¸­50çš„æ¶µä¹‰"></a>varchar(50)ä¸­50çš„æ¶µä¹‰</h3><p>æœ€å¤šå­˜æ”¾50ä¸ªå­—ç¬¦ï¼Œvarchar(50)å’Œ(200)å­˜å‚¨helloæ‰€å ç©ºé—´ä¸€æ ·ï¼Œä½†åè€…åœ¨æ’åºæ—¶ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œå› ä¸ºorder by colé‡‡ç”¨fixed_lengthè®¡ç®—colé•¿åº¦(memoryå¼•æ“ä¹Ÿä¸€æ ·)ã€‚åœ¨æ—©æœŸ MySQL ç‰ˆæœ¬ä¸­ï¼Œ 50 ä»£è¡¨å­—èŠ‚æ•°ï¼Œç°åœ¨ä»£è¡¨å­—ç¬¦æ•°ã€‚</p><h3 id="int-20-ä¸­20çš„æ¶µä¹‰"><a href="#int-20-ä¸­20çš„æ¶µä¹‰" class="headerlink" title="int(20)ä¸­20çš„æ¶µä¹‰"></a>int(20)ä¸­20çš„æ¶µä¹‰</h3><p>æ˜¯æŒ‡æ˜¾ç¤ºå­—ç¬¦çš„é•¿åº¦ã€‚20è¡¨ç¤ºæœ€å¤§æ˜¾ç¤ºå®½åº¦ä¸º20ï¼Œä½†ä»å 4å­—èŠ‚å­˜å‚¨ï¼Œå­˜å‚¨èŒƒå›´ä¸å˜ï¼›</p><p>ä¸å½±å“å†…éƒ¨å­˜å‚¨ï¼Œåªæ˜¯å½±å“å¸¦ zerofill å®šä¹‰çš„ int æ—¶ï¼Œå‰é¢è¡¥å¤šå°‘ä¸ª 0ï¼Œæ˜“äºæŠ¥è¡¨å±•ç¤º</p><h3 id="mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡"><a href="#mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡" class="headerlink" title="mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡"></a>mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡</h3><p>å¯¹å¤§å¤šæ•°åº”ç”¨æ²¡æœ‰æ„ä¹‰ï¼Œåªæ˜¯è§„å®šä¸€äº›å·¥å…·ç”¨æ¥æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼›int(1)å’Œint(20)å­˜å‚¨å’Œè®¡ç®—å‡ä¸€æ ·ï¼›</p><h3 id="mysqlä¸­int-10-å’Œchar-10-ä»¥åŠvarchar-10-çš„åŒºåˆ«"><a href="#mysqlä¸­int-10-å’Œchar-10-ä»¥åŠvarchar-10-çš„åŒºåˆ«" class="headerlink" title="mysqlä¸­int(10)å’Œchar(10)ä»¥åŠvarchar(10)çš„åŒºåˆ«"></a>mysqlä¸­int(10)å’Œchar(10)ä»¥åŠvarchar(10)çš„åŒºåˆ«</h3><ul><li><p>int(10)çš„10è¡¨ç¤ºæ˜¾ç¤ºçš„æ•°æ®çš„é•¿åº¦ï¼Œä¸æ˜¯å­˜å‚¨æ•°æ®çš„å¤§å°ï¼›chart(10)å’Œvarchar(10)çš„10è¡¨ç¤ºå­˜å‚¨æ•°æ®çš„å¤§å°ï¼Œå³è¡¨ç¤ºå­˜å‚¨å¤šå°‘ä¸ªå­—ç¬¦ã€‚</p><p>int(10) 10ä½çš„æ•°æ®é•¿åº¦ 9999999999ï¼Œå 32ä¸ªå­—èŠ‚ï¼Œintå‹4ä½<br>char(10) 10ä½å›ºå®šå­—ç¬¦ä¸²ï¼Œä¸è¶³è¡¥ç©ºæ ¼ æœ€å¤š10ä¸ªå­—ç¬¦<br>varchar(10) 10ä½å¯å˜å­—ç¬¦ä¸²ï¼Œä¸è¶³è¡¥ç©ºæ ¼ æœ€å¤š10ä¸ªå­—ç¬¦</p></li><li><p>char(10)è¡¨ç¤ºå­˜å‚¨å®šé•¿çš„10ä¸ªå­—ç¬¦ï¼Œä¸è¶³10ä¸ªå°±ç”¨ç©ºæ ¼è¡¥é½ï¼Œå ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´</p></li><li><p>varchar(10)è¡¨ç¤ºå­˜å‚¨10ä¸ªå˜é•¿çš„å­—ç¬¦ï¼Œå­˜å‚¨å¤šå°‘ä¸ªå°±æ˜¯å¤šå°‘ä¸ªï¼Œç©ºæ ¼ä¹ŸæŒ‰ä¸€ä¸ªå­—ç¬¦å­˜å‚¨ï¼Œè¿™ä¸€ç‚¹æ˜¯å’Œchar(10)çš„ç©ºæ ¼ä¸åŒçš„ï¼Œchar(10)çš„ç©ºæ ¼è¡¨ç¤ºå ä½ä¸ç®—ä¸€ä¸ªå­—ç¬¦</p></li></ul><h3 id="FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>FLOATç±»å‹æ•°æ®å¯ä»¥å­˜å‚¨è‡³å¤š8ä½åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å 4å­—èŠ‚ã€‚</li><li>DOUBLEç±»å‹æ•°æ®å¯ä»¥å­˜å‚¨è‡³å¤š18ä½åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å 8å­—èŠ‚ã€‚</li></ul><h3 id="dropã€deleteä¸truncateçš„åŒºåˆ«"><a href="#dropã€deleteä¸truncateçš„åŒºåˆ«" class="headerlink" title="dropã€deleteä¸truncateçš„åŒºåˆ«"></a>dropã€deleteä¸truncateçš„åŒºåˆ«</h3><p>ä¸‰è€…éƒ½è¡¨ç¤ºåˆ é™¤ï¼Œä½†æ˜¯ä¸‰è€…æœ‰ä¸€äº›å·®åˆ«ï¼š</p><div class="table-container"><table><thead><tr><th></th><th>Delete</th><th>Truncate</th><th>Drop</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>å±äºDML</td><td>å±äºDDL</td><td>å±äºDDL</td></tr><tr><td>å›æ»š</td><td>å¯å›æ»š</td><td>ä¸å¯å›æ»š</td><td>ä¸å¯å›æ»š</td></tr><tr><td>åˆ é™¤å†…å®¹</td><td>è¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤è¡¨çš„å…¨éƒ¨æˆ–è€…ä¸€éƒ¨åˆ†æ•°æ®è¡Œ</td><td>è¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®</td><td>ä»æ•°æ®åº“ä¸­åˆ é™¤è¡¨ï¼Œæ‰€æœ‰çš„æ•°æ®è¡Œï¼Œç´¢å¼•å’Œæƒé™ä¹Ÿä¼šè¢«åˆ é™¤</td></tr><tr><td>åˆ é™¤é€Ÿåº¦</td><td>åˆ é™¤é€Ÿåº¦æ…¢ï¼Œéœ€è¦é€è¡Œåˆ é™¤</td><td>åˆ é™¤é€Ÿåº¦å¿«</td><td>åˆ é™¤é€Ÿåº¦æœ€å¿«</td></tr></tbody></table></div><p>å› æ­¤ï¼Œåœ¨ä¸å†éœ€è¦ä¸€å¼ è¡¨çš„æ—¶å€™ï¼Œç”¨dropï¼›åœ¨æƒ³åˆ é™¤éƒ¨åˆ†æ•°æ®è¡Œæ—¶å€™ï¼Œç”¨deleteï¼›åœ¨ä¿ç•™è¡¨è€Œåˆ é™¤æ‰€æœ‰æ•°æ®çš„æ—¶å€™ç”¨truncateã€‚</p><h3 id="UNIONä¸UNION-ALLçš„åŒºåˆ«ï¼Ÿ"><a href="#UNIONä¸UNION-ALLçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="UNIONä¸UNION ALLçš„åŒºåˆ«ï¼Ÿ"></a>UNIONä¸UNION ALLçš„åŒºåˆ«ï¼Ÿ</h3><ul><li>å¦‚æœä½¿ç”¨UNION ALLï¼Œä¸ä¼šåˆå¹¶é‡å¤çš„è®°å½•è¡Œ</li><li>æ•ˆç‡ UNION é«˜äº UNION ALL</li></ul><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><h3 id="å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°-æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ"><a href="#å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°-æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°?æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ"></a>å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°?æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ</h3><p>å¯¹äºä½æ€§èƒ½çš„SQLè¯­å¥çš„å®šä½ï¼Œæœ€é‡è¦ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ‰§è¡Œè®¡åˆ’ï¼ŒMySQLæä¾›äº†explainå‘½ä»¤æ¥æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸ç®¡æ˜¯å“ªç§æ•°æ®åº“ï¼Œæˆ–è€…æ˜¯å“ªç§æ•°æ®åº“å¼•æ“ï¼Œåœ¨å¯¹ä¸€æ¡SQLè¯­å¥è¿›è¡Œæ‰§è¡Œçš„è¿‡ç¨‹ä¸­éƒ½ä¼šåšå¾ˆå¤šç›¸å…³çš„ä¼˜åŒ–ï¼Œ<strong>å¯¹äºæŸ¥è¯¢è¯­å¥ï¼Œæœ€é‡è¦çš„ä¼˜åŒ–æ–¹å¼å°±æ˜¯ä½¿ç”¨ç´¢å¼•</strong>ã€‚ è€Œ<strong>æ‰§è¡Œè®¡åˆ’ï¼Œå°±æ˜¯æ˜¾ç¤ºæ•°æ®åº“å¼•æ“å¯¹äºSQLè¯­å¥çš„æ‰§è¡Œçš„è¯¦ç»†æƒ…å†µï¼Œå…¶ä¸­åŒ…å«äº†æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œä½¿ç”¨ä»€ä¹ˆç´¢å¼•ï¼Œä½¿ç”¨çš„ç´¢å¼•çš„ç›¸å…³ä¿¡æ¯ç­‰</strong>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200310171131582.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoaW5rV29u,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰§è¡Œè®¡åˆ’åŒ…å«çš„ä¿¡æ¯ <strong>id</strong> æœ‰ä¸€ç»„æ•°å­—ç»„æˆã€‚è¡¨ç¤ºä¸€ä¸ªæŸ¥è¯¢ä¸­å„ä¸ªå­æŸ¥è¯¢çš„æ‰§è¡Œé¡ºåº;</p><ul><li>idç›¸åŒæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ã€‚</li><li>idä¸åŒï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œã€‚</li><li>idä¸ºnullæ—¶è¡¨ç¤ºä¸€ä¸ªç»“æœé›†ï¼Œä¸éœ€è¦ä½¿ç”¨å®ƒæŸ¥è¯¢ï¼Œå¸¸å‡ºç°åœ¨åŒ…å«unionç­‰æŸ¥è¯¢è¯­å¥ä¸­ã€‚</li></ul><p><strong>select_type</strong> æ¯ä¸ªå­æŸ¥è¯¢çš„æŸ¥è¯¢ç±»å‹ï¼Œä¸€äº›å¸¸è§çš„æŸ¥è¯¢ç±»å‹ã€‚</p><div class="table-container"><table><thead><tr><th>id</th><th>select_type</th><th>description</th></tr></thead><tbody><tr><td>1</td><td>SIMPLE</td><td>ä¸åŒ…å«ä»»ä½•å­æŸ¥è¯¢æˆ–unionç­‰æŸ¥è¯¢</td></tr><tr><td>2</td><td>PRIMARY</td><td>åŒ…å«å­æŸ¥è¯¢æœ€å¤–å±‚æŸ¥è¯¢å°±æ˜¾ç¤ºä¸º PRIMARY</td></tr><tr><td>3</td><td>SUBQUERY</td><td>åœ¨selectæˆ– whereå­—å¥ä¸­åŒ…å«çš„æŸ¥è¯¢</td></tr><tr><td>4</td><td>DERIVED</td><td>fromå­—å¥ä¸­åŒ…å«çš„æŸ¥è¯¢</td></tr><tr><td>5</td><td>UNION</td><td>å‡ºç°åœ¨unionåçš„æŸ¥è¯¢è¯­å¥ä¸­</td></tr><tr><td>6</td><td>UNION RESULT</td><td>ä»UNIONä¸­è·å–ç»“æœé›†ï¼Œä¾‹å¦‚ä¸Šæ–‡çš„ç¬¬ä¸‰ä¸ªä¾‹å­</td></tr></tbody></table></div><p><strong>table</strong> æŸ¥è¯¢çš„æ•°æ®è¡¨ï¼Œå½“ä»è¡ç”Ÿè¡¨ä¸­æŸ¥æ•°æ®æ—¶ä¼šæ˜¾ç¤º x è¡¨ç¤ºå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’id <strong>partitions</strong> è¡¨åˆ†åŒºã€è¡¨åˆ›å»ºçš„æ—¶å€™å¯ä»¥æŒ‡å®šé€šè¿‡é‚£ä¸ªåˆ—è¿›è¡Œè¡¨åˆ†åŒºã€‚ ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tmp (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</span><br><span class="line">) <span class="keyword">engine</span> = <span class="keyword">innodb</span></span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">key</span> (<span class="keyword">id</span>) <span class="keyword">partitions</span> <span class="number">5</span>;</span><br><span class="line">123456</span><br></pre></td></tr></table></figure><p><strong>type</strong>(éå¸¸é‡è¦ï¼Œå¯ä»¥çœ‹åˆ°æœ‰æ²¡æœ‰èµ°ç´¢å¼•) è®¿é—®ç±»å‹</p><ul><li>ALL æ‰«æå…¨è¡¨æ•°æ®</li><li>index éå†ç´¢å¼•</li><li>range ç´¢å¼•èŒƒå›´æŸ¥æ‰¾</li><li>index_subquery åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ ref</li><li>unique_subquery åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ eq_ref</li><li>ref_or_null å¯¹Nullè¿›è¡Œç´¢å¼•çš„ä¼˜åŒ–çš„ ref</li><li>fulltext ä½¿ç”¨å…¨æ–‡ç´¢å¼•</li><li>ref ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾æ•°æ®</li><li>eq_ref åœ¨joinæŸ¥è¯¢ä¸­ä½¿ç”¨PRIMARY KEYorUNIQUE NOT NULLç´¢å¼•å…³è”ã€‚</li></ul><p><strong>possible_keys</strong> å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ï¼Œæ³¨æ„ä¸ä¸€å®šä¼šä½¿ç”¨ã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºæ¥ã€‚å½“è¯¥åˆ—ä¸º NULLæ—¶å°±è¦è€ƒè™‘å½“å‰çš„SQLæ˜¯å¦éœ€è¦ä¼˜åŒ–äº†ã€‚</p><p><strong>key</strong> æ˜¾ç¤ºMySQLåœ¨æŸ¥è¯¢ä¸­å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œè‹¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ˜¾ç¤ºä¸ºNULLã€‚</p><p><strong>TIPS</strong>:æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•(è¦†ç›–ç´¢å¼•ï¼šç´¢å¼•çš„æ•°æ®è¦†ç›–äº†éœ€è¦æŸ¥è¯¢çš„æ‰€æœ‰æ•°æ®)ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨keyåˆ—è¡¨ä¸­</p><p><strong>key_length</strong> ç´¢å¼•é•¿åº¦</p><p><strong>ref</strong> è¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</p><p><strong>rows</strong> è¿”å›ä¼°ç®—çš„ç»“æœé›†æ•°ç›®ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå‡†ç¡®çš„å€¼ã€‚</p><p><strong>extra</strong> çš„ä¿¡æ¯éå¸¸ä¸°å¯Œï¼Œå¸¸è§çš„æœ‰ï¼š</p><ol><li>Using index ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>Using where ä½¿ç”¨äº†ç”¨whereå­å¥æ¥è¿‡æ»¤ç»“æœé›†</li><li>Using filesort ä½¿ç”¨æ–‡ä»¶æ’åºï¼Œä½¿ç”¨éç´¢å¼•åˆ—è¿›è¡Œæ’åºæ—¶å‡ºç°ï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ï¼Œå°½é‡ä¼˜åŒ–ã€‚</li><li>Using temporary ä½¿ç”¨äº†ä¸´æ—¶è¡¨ sqlä¼˜åŒ–çš„ç›®æ ‡å¯ä»¥å‚è€ƒé˜¿é‡Œå¼€å‘æ‰‹å†Œ</li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ã€æ¨èã€‘<span class="keyword">SQL</span>æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯<span class="keyword">ref</span>çº§åˆ«ï¼Œå¦‚æœå¯ä»¥æ˜¯constsæœ€å¥½ã€‚ </span><br><span class="line">è¯´æ˜ï¼š </span><br><span class="line"><span class="number">1</span>ï¼‰ consts å•è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼ˆä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œåœ¨ä¼˜åŒ–é˜¶æ®µå³å¯è¯»å–åˆ°æ•°æ®ã€‚ </span><br><span class="line"><span class="number">2</span>ï¼‰ <span class="keyword">ref</span> æŒ‡çš„æ˜¯ä½¿ç”¨æ™®é€šçš„ç´¢å¼•ï¼ˆnormal <span class="keyword">index</span>ï¼‰ã€‚ </span><br><span class="line"><span class="number">3</span>ï¼‰ range å¯¹ç´¢å¼•è¿›è¡ŒèŒƒå›´æ£€ç´¢ã€‚ </span><br><span class="line">åä¾‹ï¼š<span class="keyword">explain</span>è¡¨çš„ç»“æœï¼Œ<span class="keyword">type</span>=<span class="keyword">index</span>ï¼Œç´¢å¼•ç‰©ç†æ–‡ä»¶å…¨æ‰«æï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œè¿™ä¸ª<span class="keyword">index</span>çº§åˆ«æ¯”è¾ƒrangeè¿˜ä½ï¼Œä¸å…¨è¡¨æ‰«ææ˜¯å°å·«è§å¤§å·«ã€‚</span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><h3 id="SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"><a href="#SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ" class="headerlink" title="SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"></a>SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</h3><ol><li><p>åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®åº“æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªè¿æ¥</p></li><li><p>æ•°æ®åº“è¿›ç¨‹æ‹¿åˆ°è¯·æ±‚sql</p></li><li><p>è§£æå¹¶ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡Œ</p></li><li><p>è¯»å–æ•°æ®åˆ°å†…å­˜å¹¶è¿›è¡Œé€»è¾‘å¤„ç†</p></li><li><p>é€šè¿‡æ­¥éª¤ä¸€çš„è¿æ¥ï¼Œå‘é€ç»“æœåˆ°å®¢æˆ·ç«¯</p></li><li><p>å…³æ‰è¿æ¥ï¼Œé‡Šæ”¾èµ„æº</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200310170936478.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoaW5rV29u,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ol><h3 id="å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–"><a href="#å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–" class="headerlink" title="å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–"></a>å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–</h3><ol><li>ä¼˜åŒ–shemaã€sqlè¯­å¥+ç´¢å¼•ï¼›</li><li>ç¬¬äºŒåŠ ç¼“å­˜ï¼Œmemcached, redisï¼›</li><li>ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»ï¼›</li><li>å‚ç›´æ‹†åˆ†ï¼Œæ ¹æ®ä½ æ¨¡å—çš„è€¦åˆåº¦ï¼Œå°†ä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†ä¸ºå¤šä¸ªå°çš„ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼›</li><li>æ°´å¹³åˆ‡åˆ†ï¼Œé’ˆå¯¹æ•°æ®é‡å¤§çš„è¡¨ï¼Œè¿™ä¸€æ­¥æœ€éº»çƒ¦ï¼Œæœ€èƒ½è€ƒéªŒæŠ€æœ¯æ°´å¹³ï¼Œè¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„sharding key, ä¸ºäº†æœ‰å¥½çš„æŸ¥è¯¢æ•ˆç‡ï¼Œè¡¨ç»“æ„ä¹Ÿè¦æ”¹åŠ¨ï¼Œåšä¸€å®šçš„å†—ä½™ï¼Œåº”ç”¨ä¹Ÿè¦æ”¹ï¼Œsqlä¸­å°½é‡å¸¦sharding keyï¼Œå°†æ•°æ®å®šä½åˆ°é™å®šçš„è¡¨ä¸Šå»æŸ¥ï¼Œè€Œä¸æ˜¯æ‰«æå…¨éƒ¨çš„è¡¨ï¼›</li></ol><h3 id="è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ"><a href="#è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ" class="headerlink" title="è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ"></a>è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ</h3><p>è¶…å¤§çš„åˆ†é¡µä¸€èˆ¬ä»ä¸¤ä¸ªæ–¹å‘ä¸Šæ¥è§£å†³.</p><ul><li>æ•°æ®åº“å±‚é¢,è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸»è¦é›†ä¸­å…³æ³¨çš„(è™½ç„¶æ”¶æ•ˆæ²¡é‚£ä¹ˆå¤§),ç±»ä¼¼äº<code>select * from table where age &gt; 20 limit 1000000,10</code>è¿™ç§æŸ¥è¯¢å…¶å®ä¹Ÿæ˜¯æœ‰å¯ä»¥ä¼˜åŒ–çš„ä½™åœ°çš„. è¿™æ¡è¯­å¥éœ€è¦load1000000æ•°æ®ç„¶ååŸºæœ¬ä¸Šå…¨éƒ¨ä¸¢å¼ƒ,åªå–10æ¡å½“ç„¶æ¯”è¾ƒæ…¢. å½“æ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸º<code>select * from table where id in (select id from table where age &gt; 20 limit 1000000,10)</code>.è¿™æ ·è™½ç„¶ä¹Ÿloadäº†ä¸€ç™¾ä¸‡çš„æ•°æ®,ä½†æ˜¯ç”±äºç´¢å¼•è¦†ç›–,è¦æŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­,æ‰€ä»¥é€Ÿåº¦ä¼šå¾ˆå¿«. åŒæ—¶å¦‚æœIDè¿ç»­çš„å¥½,æˆ‘ä»¬è¿˜å¯ä»¥<code>select * from table where id &gt; 1000000 limit 10</code>,æ•ˆç‡ä¹Ÿæ˜¯ä¸é”™çš„,ä¼˜åŒ–çš„å¯èƒ½æ€§æœ‰è®¸å¤šç§,ä½†æ˜¯æ ¸å¿ƒæ€æƒ³éƒ½ä¸€æ ·,å°±æ˜¯å‡å°‘loadçš„æ•°æ®.</li><li>ä»éœ€æ±‚çš„è§’åº¦å‡å°‘è¿™ç§è¯·æ±‚â€¦ä¸»è¦æ˜¯ä¸åšç±»ä¼¼çš„éœ€æ±‚(ç›´æ¥è·³è½¬åˆ°å‡ ç™¾ä¸‡é¡µä¹‹åçš„å…·ä½“æŸä¸€é¡µ.åªå…è®¸é€é¡µæŸ¥çœ‹æˆ–è€…æŒ‰ç…§ç»™å®šçš„è·¯çº¿èµ°,è¿™æ ·å¯é¢„æµ‹,å¯ç¼“å­˜)ä»¥åŠé˜²æ­¢IDæ³„æ¼ä¸”è¿ç»­è¢«äººæ¶æ„æ”»å‡».</li></ul><p>è§£å†³è¶…å¤§åˆ†é¡µ,å…¶å®ä¸»è¦æ˜¯é ç¼“å­˜,å¯é¢„æµ‹æ€§çš„æå‰æŸ¥åˆ°å†…å®¹,ç¼“å­˜è‡³redisç­‰k-Væ•°æ®åº“ä¸­,ç›´æ¥è¿”å›å³å¯.</p><p>åœ¨é˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¸­,å¯¹è¶…å¤§åˆ†é¡µçš„è§£å†³åŠæ³•æ˜¯ç±»ä¼¼äºä¸Šé¢æåˆ°çš„ç¬¬ä¸€ç§.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ã€æ¨èã€‘åˆ©ç”¨å»¶è¿Ÿå…³è”æˆ–è€…å­æŸ¥è¯¢ä¼˜åŒ–è¶…å¤šåˆ†é¡µåœºæ™¯ã€‚ </span><br><span class="line"></span><br><span class="line">è¯´æ˜ï¼šMySQLå¹¶ä¸æ˜¯è·³è¿‡offsetè¡Œï¼Œè€Œæ˜¯å–offset+Nè¡Œï¼Œç„¶åè¿”å›æ”¾å¼ƒå‰offsetè¡Œï¼Œè¿”å›Nè¡Œï¼Œé‚£å½“offsetç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œæ•ˆç‡å°±éå¸¸çš„ä½ä¸‹ï¼Œè¦ä¹ˆæ§åˆ¶è¿”å›çš„æ€»é¡µæ•°ï¼Œè¦ä¹ˆå¯¹è¶…è¿‡ç‰¹å®šé˜ˆå€¼çš„é¡µæ•°è¿›è¡ŒSQLæ”¹å†™ã€‚ </span><br><span class="line"></span><br><span class="line">æ­£ä¾‹ï¼šå…ˆå¿«é€Ÿå®šä½éœ€è¦è·å–çš„idæ®µï¼Œç„¶åå†å…³è”ï¼š </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> a.* <span class="keyword">FROM</span> è¡¨<span class="number">1</span> a, (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> è¡¨<span class="number">1</span> <span class="keyword">where</span> æ¡ä»¶ <span class="keyword">LIMIT</span> <span class="number">100000</span>,<span class="number">20</span> ) b <span class="keyword">where</span> a.id=b.id</span><br><span class="line"><span class="number">1234567</span></span><br></pre></td></tr></table></figure><h3 id="mysql-åˆ†é¡µ"><a href="#mysql-åˆ†é¡µ" class="headerlink" title="mysql åˆ†é¡µ"></a>mysql åˆ†é¡µ</h3><p>LIMIT å­å¥å¯ä»¥è¢«ç”¨äºå¼ºåˆ¶ SELECT è¯­å¥è¿”å›æŒ‡å®šçš„è®°å½•æ•°ã€‚LIMIT æ¥å—ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å­—å‚æ•°ã€‚å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªæ•´æ•°å¸¸é‡ã€‚å¦‚æœç»™å®šä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šç¬¬ä¸€ä¸ªè¿”å›è®°å½•è¡Œçš„åç§»é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¿”å›è®°å½•è¡Œçš„æœ€å¤§æ•°ç›®ã€‚åˆå§‹è®°å½•è¡Œçš„åç§»é‡æ˜¯ 0(è€Œä¸æ˜¯ 1)</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM table LIMIT <span class="number">5</span>,<span class="number">10</span>; <span class="comment">// æ£€ç´¢è®°å½•è¡Œ 6-15 </span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ£€ç´¢ä»æŸä¸€ä¸ªåç§»é‡åˆ°è®°å½•é›†çš„ç»“æŸæ‰€æœ‰çš„è®°å½•è¡Œï¼Œå¯ä»¥æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä¸º -1ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM table LIMIT <span class="number">95</span>,<span class="number">-1</span>; <span class="comment">// æ£€ç´¢è®°å½•è¡Œ 96-last. </span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåªç»™å®šä¸€ä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤ºè¿”å›æœ€å¤§çš„è®°å½•è¡Œæ•°ç›®ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM <span class="keyword">table</span> LIMIT <span class="comment">5</span>; //æ£€ç´¢å‰<span class="comment"> 5</span> ä¸ªè®°å½•è¡Œ </span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>æ¢å¥è¯è¯´ï¼ŒLIMIT n ç­‰ä»·äº LIMIT 0,nã€‚</p><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h3><blockquote><p>ç”¨äºè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŸä¸ªä¸´ç•Œå€¼çš„SQLæ—¥å¿—ï¼Œç”¨äºå¿«é€Ÿå®šä½æ…¢æŸ¥è¯¢ï¼Œä¸ºæˆ‘ä»¬çš„ä¼˜åŒ–åšå‚è€ƒã€‚</p></blockquote><p>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</p><p>é…ç½®é¡¹ï¼š<code>slow_query_log</code></p><p>å¯ä»¥ä½¿ç”¨<code>show variables like â€˜slov_query_logâ€™</code>æŸ¥çœ‹æ˜¯å¦å¼€å¯ï¼Œå¦‚æœçŠ¶æ€å€¼ä¸º<code>OFF</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>set GLOBAL slow_query_log = on</code>æ¥å¼€å¯ï¼Œå®ƒä¼šåœ¨<code>datadir</code>ä¸‹äº§ç”Ÿä¸€ä¸ª<code>xxx-slow.log</code>çš„æ–‡ä»¶ã€‚</p><p>è®¾ç½®ä¸´ç•Œæ—¶é—´</p><p>é…ç½®é¡¹ï¼š<code>long_query_time</code></p><p>æŸ¥çœ‹ï¼š<code>show VARIABLES like &#39;long_query_time&#39;</code>ï¼Œå•ä½ç§’</p><p>è®¾ç½®ï¼š<code>set long_query_time=0.5</code></p><p>å®æ“æ—¶åº”è¯¥ä»é•¿æ—¶é—´è®¾ç½®åˆ°çŸ­çš„æ—¶é—´ï¼Œå³å°†æœ€æ…¢çš„SQLä¼˜åŒ–æ‰</p><p>æŸ¥çœ‹æ—¥å¿—ï¼Œä¸€æ—¦SQLè¶…è¿‡äº†æˆ‘ä»¬è®¾ç½®çš„ä¸´ç•Œæ—¶é—´å°±ä¼šè¢«è®°å½•åˆ°<code>xxx-slow.log</code>ä¸­</p><h3 id="å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ"><a href="#å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ" class="headerlink" title="å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ"></a>å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ</h3><p>åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œé™¤äº†ä½¿ç”¨ä¸»é”®è¿›è¡Œçš„æŸ¥è¯¢ï¼Œå…¶ä»–çš„æˆ‘éƒ½ä¼šåœ¨æµ‹è¯•åº“ä¸Šæµ‹è¯•å…¶è€—æ—¶ï¼Œæ…¢æŸ¥è¯¢çš„ç»Ÿè®¡ä¸»è¦ç”±è¿ç»´åœ¨åšï¼Œä¼šå®šæœŸå°†ä¸šåŠ¡ä¸­çš„æ…¢æŸ¥è¯¢åé¦ˆç»™æˆ‘ä»¬ã€‚</p><p>æ…¢æŸ¥è¯¢çš„ä¼˜åŒ–é¦–å…ˆè¦ææ˜ç™½æ…¢çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ æ˜¯æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰å‘½ä¸­ç´¢å¼•ï¼Ÿæ˜¯loadäº†ä¸éœ€è¦çš„æ•°æ®åˆ—ï¼Ÿè¿˜æ˜¯æ•°æ®é‡å¤ªå¤§ï¼Ÿ</p><p>æ‰€ä»¥ä¼˜åŒ–ä¹Ÿæ˜¯é’ˆå¯¹è¿™ä¸‰ä¸ªæ–¹å‘æ¥çš„ï¼Œ</p><ul><li>é¦–å…ˆåˆ†æè¯­å¥ï¼Œçœ‹çœ‹æ˜¯å¦loadäº†é¢å¤–çš„æ•°æ®ï¼Œå¯èƒ½æ˜¯æŸ¥è¯¢äº†å¤šä½™çš„è¡Œå¹¶ä¸”æŠ›å¼ƒæ‰äº†ï¼Œå¯èƒ½æ˜¯åŠ è½½äº†è®¸å¤šç»“æœä¸­å¹¶ä¸éœ€è¦çš„åˆ—ï¼Œå¯¹è¯­å¥è¿›è¡Œåˆ†æä»¥åŠé‡å†™ã€‚</li><li>åˆ†æè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åè·å¾—å…¶ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µï¼Œä¹‹åä¿®æ”¹è¯­å¥æˆ–è€…ä¿®æ”¹ç´¢å¼•ï¼Œä½¿å¾—è¯­å¥å¯ä»¥å°½å¯èƒ½çš„å‘½ä¸­ç´¢å¼•ã€‚</li><li>å¦‚æœå¯¹è¯­å¥çš„ä¼˜åŒ–å·²ç»æ— æ³•è¿›è¡Œï¼Œå¯ä»¥è€ƒè™‘è¡¨ä¸­çš„æ•°æ®é‡æ˜¯å¦å¤ªå¤§ï¼Œå¦‚æœæ˜¯çš„è¯å¯ä»¥è¿›è¡Œæ¨ªå‘æˆ–è€…çºµå‘çš„åˆ†è¡¨ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ</h3><p>ä¸»é”®æ˜¯æ•°æ®åº“ç¡®ä¿æ•°æ®è¡Œåœ¨æ•´å¼ è¡¨å”¯ä¸€æ€§çš„ä¿éšœï¼Œå³ä½¿ä¸šåŠ¡ä¸Šæœ¬å¼ è¡¨æ²¡æœ‰ä¸»é”®ï¼Œä¹Ÿå»ºè®®æ·»åŠ ä¸€ä¸ªè‡ªå¢é•¿çš„IDåˆ—ä½œä¸ºä¸»é”®ã€‚è®¾å®šäº†ä¸»é”®ä¹‹åï¼Œåœ¨åç»­çš„åˆ æ”¹æŸ¥çš„æ—¶å€™å¯èƒ½æ›´åŠ å¿«é€Ÿä»¥åŠç¡®ä¿æ“ä½œæ•°æ®èŒƒå›´å®‰å…¨ã€‚</p><h3 id="ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ"><a href="#ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ" class="headerlink" title="ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ"></a>ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ</h3><p>æ¨èä½¿ç”¨è‡ªå¢IDï¼Œä¸è¦ä½¿ç”¨UUIDã€‚</p><p>å› ä¸ºåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•æ˜¯ä½œä¸ºèšç°‡ç´¢å¼•å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»é”®ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹ä¸Šå­˜å‚¨äº†ä¸»é”®ç´¢å¼•ä»¥åŠå…¨éƒ¨çš„æ•°æ®(æŒ‰ç…§é¡ºåº)ï¼Œå¦‚æœä¸»é”®ç´¢å¼•æ˜¯è‡ªå¢IDï¼Œé‚£ä¹ˆåªéœ€è¦ä¸æ–­å‘åæ’åˆ—å³å¯ï¼Œå¦‚æœæ˜¯UUIDï¼Œç”±äºåˆ°æ¥çš„IDä¸åŸæ¥çš„å¤§å°ä¸ç¡®å®šï¼Œä¼šé€ æˆéå¸¸å¤šçš„æ•°æ®æ’å…¥ï¼Œæ•°æ®ç§»åŠ¨ï¼Œç„¶åå¯¼è‡´äº§ç”Ÿå¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ï¼Œè¿›è€Œé€ æˆæ’å…¥æ€§èƒ½çš„ä¸‹é™ã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨æ•°æ®é‡å¤§ä¸€äº›çš„æƒ…å†µä¸‹ï¼Œç”¨è‡ªå¢ä¸»é”®æ€§èƒ½ä¼šå¥½ä¸€äº›ã€‚</p><p>å…³äºä¸»é”®æ˜¯èšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œä¼šç”Ÿæˆä¸€ä¸ªéšå¼çš„ä¸»é”®ã€‚</p><h3 id="å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot-nullï¼Ÿ"><a href="#å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot-nullï¼Ÿ" class="headerlink" title="å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot nullï¼Ÿ"></a>å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot nullï¼Ÿ</h3><p>nullå€¼ä¼šå ç”¨æ›´å¤šçš„å­—èŠ‚ï¼Œä¸”ä¼šåœ¨ç¨‹åºä¸­é€ æˆå¾ˆå¤šä¸é¢„æœŸä¸ç¬¦çš„æƒ…å†µã€‚</p><h3 id="å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ"><a href="#å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ" class="headerlink" title="å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ"></a>å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ</h3><p>å¯†ç æ•£åˆ—ï¼Œç›ï¼Œç”¨æˆ·èº«ä»½è¯å·ç­‰å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²åº”è¯¥ä½¿ç”¨charè€Œä¸æ˜¯varcharæ¥å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœç©ºé—´ä¸”æé«˜æ£€ç´¢æ•ˆç‡ã€‚</p><h3 id="ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®"><a href="#ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®" class="headerlink" title="ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®"></a>ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®</h3><ul><li>è®¿é—®æ•°æ®å¤ªå¤šå¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™</li><li>ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦åœ¨æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ï¼Œå¯èƒ½æ˜¯å¤ªå¤šè¡Œæˆ–åˆ—</li><li>ç¡®è®¤MySQLæœåŠ¡å™¨æ˜¯å¦åœ¨åˆ†æå¤§é‡ä¸å¿…è¦çš„æ•°æ®è¡Œ</li><li>é¿å…çŠ¯å¦‚ä¸‹SQLè¯­å¥é”™è¯¯</li><li>æŸ¥è¯¢ä¸éœ€è¦çš„æ•°æ®ã€‚è§£å†³åŠæ³•ï¼šä½¿ç”¨limitè§£å†³</li><li>å¤šè¡¨å…³è”è¿”å›å…¨éƒ¨åˆ—ã€‚è§£å†³åŠæ³•ï¼šæŒ‡å®šåˆ—å</li><li>æ€»æ˜¯è¿”å›å…¨éƒ¨åˆ—ã€‚è§£å†³åŠæ³•ï¼šé¿å…ä½¿ç”¨SELECT *</li><li>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®ã€‚è§£å†³åŠæ³•ï¼šå¯ä»¥ç¼“å­˜æ•°æ®ï¼Œä¸‹æ¬¡ç›´æ¥è¯»å–ç¼“å­˜</li><li>æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•ã€‚è§£å†³åŠæ³•ï¼š</li><li>ä½¿ç”¨explainè¿›è¡Œåˆ†æï¼Œå¦‚æœå‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ï¼Œä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æŠ€å·§å»ä¼˜åŒ–ï¼š</li><li>ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼ŒæŠŠæ‰€æœ‰çš„åˆ—éƒ½æ”¾åˆ°ç´¢å¼•ä¸­ï¼Œè¿™æ ·å­˜å‚¨å¼•æ“ä¸éœ€è¦å›è¡¨è·å–å¯¹åº”è¡Œå°±å¯ä»¥è¿”å›ç»“æœã€‚</li><li>æ”¹å˜æ•°æ®åº“å’Œè¡¨çš„ç»“æ„ï¼Œä¿®æ”¹æ•°æ®è¡¨èŒƒå¼</li><li>é‡å†™SQLè¯­å¥ï¼Œè®©ä¼˜åŒ–å™¨å¯ä»¥ä»¥æ›´ä¼˜çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚</li></ul><h3 id="ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥"><a href="#ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥" class="headerlink" title="ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥"></a>ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥</h3><ul><li>ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢</li><li>mysqlå†…éƒ¨æ¯ç§’èƒ½æ‰«æå†…å­˜ä¸­ä¸Šç™¾ä¸‡è¡Œæ•°æ®ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œå“åº”æ•°æ®ç»™å®¢æˆ·ç«¯å°±è¦æ…¢å¾—å¤š</li><li>ä½¿ç”¨å°½å¯èƒ½å°çš„æŸ¥è¯¢æ˜¯å¥½çš„ï¼Œä½†æ˜¯æœ‰æ—¶å°†ä¸€ä¸ªå¤§çš„æŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªå°çš„æŸ¥è¯¢æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</li><li>åˆ‡åˆ†æŸ¥è¯¢</li><li>å°†ä¸€ä¸ªå¤§çš„æŸ¥è¯¢åˆ†ä¸ºå¤šä¸ªå°çš„ç›¸åŒçš„æŸ¥è¯¢</li><li>ä¸€æ¬¡æ€§åˆ é™¤1000ä¸‡çš„æ•°æ®è¦æ¯”ä¸€æ¬¡åˆ é™¤1ä¸‡ï¼Œæš‚åœä¸€ä¼šçš„æ–¹æ¡ˆæ›´åŠ æŸè€—æœåŠ¡å™¨å¼€é”€ã€‚</li><li>åˆ†è§£å…³è”æŸ¥è¯¢ï¼Œè®©ç¼“å­˜çš„æ•ˆç‡æ›´é«˜ã€‚</li><li>æ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰ã€‚</li><li>åœ¨åº”ç”¨å±‚åšå…³è”æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡ä¼šæœ‰å¤§å¹…æå‡ã€‚</li><li>è¾ƒå°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚</li></ul><h3 id="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥"><a href="#ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥" class="headerlink" title="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥"></a>ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥</h3><ul><li>count(*)ä¼šå¿½ç•¥æ‰€æœ‰çš„åˆ—ï¼Œç›´æ¥ç»Ÿè®¡æ‰€æœ‰åˆ—æ•°ï¼Œä¸è¦ä½¿ç”¨count(åˆ—å)</li><li>MyISAMä¸­ï¼Œæ²¡æœ‰ä»»ä½•whereæ¡ä»¶çš„count(*)éå¸¸å¿«ã€‚</li><li>å½“æœ‰whereæ¡ä»¶æ—¶ï¼ŒMyISAMçš„countç»Ÿè®¡ä¸ä¸€å®šæ¯”å…¶å®ƒå¼•æ“å¿«ã€‚</li><li>å¯ä»¥ä½¿ç”¨explainæŸ¥è¯¢è¿‘ä¼¼å€¼ï¼Œç”¨è¿‘ä¼¼å€¼æ›¿ä»£count(*)</li><li>å¢åŠ æ±‡æ€»è¡¨</li><li>ä½¿ç”¨ç¼“å­˜</li></ul><h3 id="ä¼˜åŒ–å…³è”æŸ¥è¯¢"><a href="#ä¼˜åŒ–å…³è”æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–å…³è”æŸ¥è¯¢"></a>ä¼˜åŒ–å…³è”æŸ¥è¯¢</h3><ul><li>ç¡®å®šONæˆ–è€…USINGå­å¥ä¸­æ˜¯å¦æœ‰ç´¢å¼•ã€‚</li><li>ç¡®ä¿GROUP BYå’ŒORDER BYåªæœ‰ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·MySQLæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•ã€‚</li></ul><h3 id="ä¼˜åŒ–å­æŸ¥è¯¢"><a href="#ä¼˜åŒ–å­æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–å­æŸ¥è¯¢"></a>ä¼˜åŒ–å­æŸ¥è¯¢</h3><ul><li>ç”¨å…³è”æŸ¥è¯¢æ›¿ä»£</li><li>ä¼˜åŒ–GROUP BYå’ŒDISTINCT</li><li>è¿™ä¸¤ç§æŸ¥è¯¢æ®å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ï¼Œæ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•</li><li>å…³è”æŸ¥è¯¢ä¸­ï¼Œä½¿ç”¨æ ‡è¯†åˆ—åˆ†ç»„çš„æ•ˆç‡æ›´é«˜</li><li>å¦‚æœä¸éœ€è¦ORDER BYï¼Œè¿›è¡ŒGROUP BYæ—¶åŠ ORDER BY NULLï¼ŒMySQLä¸ä¼šå†è¿›è¡Œæ–‡ä»¶æ’åºã€‚</li><li>WITH ROLLUPè¶…çº§èšåˆï¼Œå¯ä»¥æŒªåˆ°åº”ç”¨ç¨‹åºå¤„ç†</li></ul><h3 id="ä¼˜åŒ–LIMITåˆ†é¡µ"><a href="#ä¼˜åŒ–LIMITåˆ†é¡µ" class="headerlink" title="ä¼˜åŒ–LIMITåˆ†é¡µ"></a>ä¼˜åŒ–LIMITåˆ†é¡µ</h3><ul><li>LIMITåç§»é‡å¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•ˆç‡è¾ƒä½</li><li>å¯ä»¥è®°å½•ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å¤§IDï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ç›´æ¥æ ¹æ®è¯¥IDæ¥æŸ¥è¯¢</li></ul><h3 id="ä¼˜åŒ–UNIONæŸ¥è¯¢"><a href="#ä¼˜åŒ–UNIONæŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–UNIONæŸ¥è¯¢"></a>ä¼˜åŒ–UNIONæŸ¥è¯¢</h3><ul><li>UNION ALLçš„æ•ˆç‡é«˜äºUNION</li></ul><h3 id="ä¼˜åŒ–WHEREå­å¥"><a href="#ä¼˜åŒ–WHEREå­å¥" class="headerlink" title="ä¼˜åŒ–WHEREå­å¥"></a>ä¼˜åŒ–WHEREå­å¥</h3><p>è§£é¢˜æ–¹æ³•</p><p>å¯¹äºæ­¤ç±»è€ƒé¢˜ï¼Œå…ˆè¯´æ˜å¦‚ä½•å®šä½ä½æ•ˆSQLè¯­å¥ï¼Œç„¶åæ ¹æ®SQLè¯­å¥å¯èƒ½ä½æ•ˆçš„åŸå› åšæ’æŸ¥ï¼Œå…ˆä»ç´¢å¼•ç€æ‰‹ï¼Œå¦‚æœç´¢å¼•æ²¡æœ‰é—®é¢˜ï¼Œè€ƒè™‘ä»¥ä¸Šå‡ ä¸ªæ–¹é¢ï¼Œæ•°æ®è®¿é—®çš„é—®é¢˜ï¼Œé•¿éš¾æŸ¥è¯¢å¥çš„é—®é¢˜è¿˜æ˜¯ä¸€äº›ç‰¹å®šç±»å‹ä¼˜åŒ–çš„é—®é¢˜ï¼Œé€ä¸€å›ç­”ã€‚</p><p>SQLè¯­å¥ä¼˜åŒ–çš„ä¸€äº›æ–¹æ³•ï¼Ÿ</p><ul><li>1.å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚</li><li>2.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">is</span> <span class="literal">null</span></span><br><span class="line"><span class="comment">-- å¯ä»¥åœ¨numä¸Šè®¾ç½®é»˜è®¤å€¼0ï¼Œç¡®ä¿è¡¨ä¸­numåˆ—æ²¡æœ‰nullå€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼š</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure><ul><li>3.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–&lt;&gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å¼•æ“å°†æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>4.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">10</span> <span class="keyword">or</span> <span class="keyword">num</span>=<span class="number">20</span></span><br><span class="line"><span class="comment">-- å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼š</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">10</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">20</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure><ul><li>5.in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¦‚ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) </span><br><span class="line"><span class="comment">-- å¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼š</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure><ul><li>6.ä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼šselect id from t where name like â€˜%æ%â€™è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚</li><li>7.å¦‚æœåœ¨ where å­å¥ä¸­ä½¿ç”¨å‚æ•°ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚å› ä¸ºSQLåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šè§£æå±€éƒ¨å˜é‡ï¼Œä½†ä¼˜åŒ–ç¨‹åºä¸èƒ½å°†è®¿é—®è®¡åˆ’çš„é€‰æ‹©æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼›å®ƒå¿…é¡»åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé€‰æ‹©ã€‚ç„¶ è€Œï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å»ºç«‹è®¿é—®è®¡åˆ’ï¼Œå˜é‡çš„å€¼è¿˜æ˜¯æœªçŸ¥çš„ï¼Œå› è€Œæ— æ³•ä½œä¸ºç´¢å¼•é€‰æ‹©çš„è¾“å…¥é¡¹ã€‚å¦‚ä¸‹é¢è¯­å¥å°†è¿›è¡Œå…¨è¡¨æ‰«æï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=@<span class="keyword">num</span></span><br><span class="line"><span class="comment">-- å¯ä»¥æ”¹ä¸ºå¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼š</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">with</span>(<span class="keyword">index</span>(ç´¢å¼•å)) <span class="keyword">where</span> <span class="keyword">num</span>=@<span class="keyword">num</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure><ul><li>8.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>/<span class="number">2</span>=<span class="number">100</span></span><br><span class="line"><span class="comment">-- åº”æ”¹ä¸º:</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">100</span>*<span class="number">2</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure><ul><li>9.åº”å°½é‡é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">substring</span>(<span class="keyword">name</span>,<span class="number">1</span>,<span class="number">3</span>)=â€™abcâ€™</span><br><span class="line"><span class="comment">-- nameä»¥abcå¼€å¤´çš„idåº”æ”¹ä¸º:</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> â€˜abc%â€™</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure><ul><li>10.ä¸è¦åœ¨ where å­å¥ä¸­çš„â€œ=â€å·¦è¾¹è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—ï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨ç´¢å¼•ã€‚</li></ul><h2 id="æ•°æ®åº“ä¼˜åŒ–"><a href="#æ•°æ®åº“ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“ä¼˜åŒ–"></a>æ•°æ®åº“ä¼˜åŒ–</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–"><a href="#ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–"></a>ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–</h3><ul><li>ç³»ç»Ÿçš„ååé‡ç“¶é¢ˆå¾€å¾€å‡ºç°åœ¨æ•°æ®åº“çš„è®¿é—®é€Ÿåº¦ä¸Š</li><li>éšç€åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œæ•°æ®åº“çš„ä¸­çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå¤šï¼Œå¤„ç†æ—¶é—´ä¼šç›¸åº”å˜æ…¢</li><li>æ•°æ®æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ï¼Œè¯»å†™é€Ÿåº¦æ— æ³•å’Œå†…å­˜ç›¸æ¯”</li></ul><p>ä¼˜åŒ–åŸåˆ™ï¼šå‡å°‘ç³»ç»Ÿç“¶é¢ˆï¼Œå‡å°‘èµ„æºå ç”¨ï¼Œå¢åŠ ç³»ç»Ÿçš„ååº”é€Ÿåº¦ã€‚</p><h3 id="æ•°æ®åº“ç»“æ„ä¼˜åŒ–"><a href="#æ•°æ®åº“ç»“æ„ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“ç»“æ„ä¼˜åŒ–"></a>æ•°æ®åº“ç»“æ„ä¼˜åŒ–</h3><p>ä¸€ä¸ªå¥½çš„æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆå¯¹äºæ•°æ®åº“çš„æ€§èƒ½å¾€å¾€ä¼šèµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p><p>éœ€è¦è€ƒè™‘æ•°æ®å†—ä½™ã€æŸ¥è¯¢å’Œæ›´æ–°çš„é€Ÿåº¦ã€å­—æ®µçš„æ•°æ®ç±»å‹æ˜¯å¦åˆç†ç­‰å¤šæ–¹é¢çš„å†…å®¹ã€‚</p><p><strong>å°†å­—æ®µå¾ˆå¤šçš„è¡¨åˆ†è§£æˆå¤šä¸ªè¡¨</strong></p><p>å¯¹äºå­—æ®µè¾ƒå¤šçš„è¡¨ï¼Œå¦‚æœæœ‰äº›å­—æ®µçš„ä½¿ç”¨é¢‘ç‡å¾ˆä½ï¼Œå¯ä»¥å°†è¿™äº›å­—æ®µåˆ†ç¦»å‡ºæ¥å½¢æˆæ–°è¡¨ã€‚</p><p>å› ä¸ºå½“ä¸€ä¸ªè¡¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä¼šç”±äºä½¿ç”¨é¢‘ç‡ä½çš„å­—æ®µçš„å­˜åœ¨è€Œå˜æ…¢ã€‚</p><p><strong>å¢åŠ ä¸­é—´è¡¨</strong></p><p>å¯¹äºéœ€è¦ç»å¸¸è”åˆæŸ¥è¯¢çš„è¡¨ï¼Œå¯ä»¥å»ºç«‹ä¸­é—´è¡¨ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>é€šè¿‡å»ºç«‹ä¸­é—´è¡¨ï¼Œå°†éœ€è¦é€šè¿‡è”åˆæŸ¥è¯¢çš„æ•°æ®æ’å…¥åˆ°ä¸­é—´è¡¨ä¸­ï¼Œç„¶åå°†åŸæ¥çš„è”åˆæŸ¥è¯¢æ”¹ä¸ºå¯¹ä¸­é—´è¡¨çš„æŸ¥è¯¢ã€‚</p><p><strong>å¢åŠ å†—ä½™å­—æ®µ</strong></p><p>è®¾è®¡æ•°æ®è¡¨æ—¶åº”å°½é‡éµå¾ªèŒƒå¼ç†è®ºçš„è§„çº¦ï¼Œå°½å¯èƒ½çš„å‡å°‘å†—ä½™å­—æ®µï¼Œè®©æ•°æ®åº“è®¾è®¡çœ‹èµ·æ¥ç²¾è‡´ã€ä¼˜é›…ã€‚ä½†æ˜¯ï¼Œåˆç†çš„åŠ å…¥å†—ä½™å­—æ®µå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>è¡¨çš„è§„èŒƒåŒ–ç¨‹åº¦è¶Šé«˜ï¼Œè¡¨å’Œè¡¨ä¹‹é—´çš„å…³ç³»è¶Šå¤šï¼Œéœ€è¦è¿æ¥æŸ¥è¯¢çš„æƒ…å†µä¹Ÿå°±è¶Šå¤šï¼Œæ€§èƒ½ä¹Ÿå°±è¶Šå·®ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p><strong>å†—ä½™å­—æ®µçš„å€¼åœ¨ä¸€ä¸ªè¡¨ä¸­ä¿®æ”¹äº†ï¼Œå°±è¦æƒ³åŠæ³•åœ¨å…¶ä»–è¡¨ä¸­æ›´æ–°ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</strong></p><h3 id="MySQLæ•°æ®åº“cpué£™å‡åˆ°500-çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ"><a href="#MySQLæ•°æ®åº“cpué£™å‡åˆ°500-çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ" class="headerlink" title="MySQLæ•°æ®åº“cpué£™å‡åˆ°500%çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ"></a>MySQLæ•°æ®åº“cpué£™å‡åˆ°500%çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ</h3><p>å½“ cpu é£™å‡åˆ° 500%æ—¶ï¼Œå…ˆç”¨æ“ä½œç³»ç»Ÿå‘½ä»¤ top å‘½ä»¤è§‚å¯Ÿæ˜¯ä¸æ˜¯ mysqld å ç”¨å¯¼è‡´çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œæ‰¾å‡ºå ç”¨é«˜çš„è¿›ç¨‹ï¼Œå¹¶è¿›è¡Œç›¸å…³å¤„ç†ã€‚</p><p>å¦‚æœæ˜¯ mysqld é€ æˆçš„ï¼Œ show processlistï¼Œçœ‹çœ‹é‡Œé¢è·‘çš„ session æƒ…å†µï¼Œæ˜¯ä¸æ˜¯æœ‰æ¶ˆè€—èµ„æºçš„ sql åœ¨è¿è¡Œã€‚æ‰¾å‡ºæ¶ˆè€—é«˜çš„ sqlï¼Œçœ‹çœ‹æ‰§è¡Œè®¡åˆ’æ˜¯å¦å‡†ç¡®ï¼Œ index æ˜¯å¦ç¼ºå¤±ï¼Œæˆ–è€…å®åœ¨æ˜¯æ•°æ®é‡å¤ªå¤§é€ æˆã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè‚¯å®šè¦ kill æ‰è¿™äº›çº¿ç¨‹(åŒæ—¶è§‚å¯Ÿ cpu ä½¿ç”¨ç‡æ˜¯å¦ä¸‹é™)ï¼Œç­‰è¿›è¡Œç›¸åº”çš„è°ƒæ•´(æ¯”å¦‚è¯´åŠ ç´¢å¼•ã€æ”¹ sqlã€æ”¹å†…å­˜å‚æ•°)ä¹‹åï¼Œå†é‡æ–°è·‘è¿™äº› SQLã€‚</p><p>ä¹Ÿæœ‰å¯èƒ½æ˜¯æ¯ä¸ª sql æ¶ˆè€—èµ„æºå¹¶ä¸å¤šï¼Œä½†æ˜¯çªç„¶ä¹‹é—´ï¼Œæœ‰å¤§é‡çš„ session è¿è¿›æ¥å¯¼è‡´ cpu é£™å‡ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦è·Ÿåº”ç”¨ä¸€èµ·æ¥åˆ†æä¸ºä½•è¿æ¥æ•°ä¼šæ¿€å¢ï¼Œå†åšå‡ºç›¸åº”çš„è°ƒæ•´ï¼Œæ¯”å¦‚è¯´é™åˆ¶è¿æ¥æ•°ç­‰</p><h3 id="å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼ŸæŸä¸ªè¡¨æœ‰è¿‘åƒä¸‡æ•°æ®ï¼ŒCRUDæ¯”è¾ƒæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ"><a href="#å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼ŸæŸä¸ªè¡¨æœ‰è¿‘åƒä¸‡æ•°æ®ï¼ŒCRUDæ¯”è¾ƒæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ" class="headerlink" title="å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼ŸæŸä¸ªè¡¨æœ‰è¿‘åƒä¸‡æ•°æ®ï¼ŒCRUDæ¯”è¾ƒæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ"></a>å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼ŸæŸä¸ªè¡¨æœ‰è¿‘åƒä¸‡æ•°æ®ï¼ŒCRUDæ¯”è¾ƒæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ</h3><p>å½“MySQLå•è¡¨è®°å½•æ•°è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“çš„CRUDæ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ï¼Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–æªæ–½å¦‚ä¸‹ï¼š</p><ol><li><strong>é™å®šæ•°æ®çš„èŒƒå›´ï¼š</strong> åŠ¡å¿…ç¦æ­¢ä¸å¸¦ä»»ä½•é™åˆ¶æ•°æ®èŒƒå›´æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å½“ç”¨æˆ·åœ¨æŸ¥è¯¢è®¢å•å†å²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ¨ä¸€ä¸ªæœˆçš„èŒƒå›´å†…ã€‚ï¼›</li><li><strong>è¯»/å†™åˆ†ç¦»ï¼š</strong> ç»å…¸çš„æ•°æ®åº“æ‹†åˆ†æ–¹æ¡ˆï¼Œä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ï¼›</li><li><strong>ç¼“å­˜ï¼š</strong> ä½¿ç”¨MySQLçš„ç¼“å­˜ï¼Œå¦å¤–å¯¹é‡é‡çº§ã€æ›´æ–°å°‘çš„æ•°æ®å¯ä»¥è€ƒè™‘ä½¿ç”¨åº”ç”¨çº§åˆ«çš„ç¼“å­˜ï¼›</li></ol><p>è¿˜æœ‰å°±æ˜¯é€šè¿‡åˆ†åº“åˆ†è¡¨çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œä¸»è¦æœ‰å‚ç›´åˆ†è¡¨å’Œæ°´å¹³åˆ†è¡¨</p><ol><li><p><strong>å‚ç›´åˆ†åŒºï¼š</strong></p><p><strong>æ ¹æ®æ•°æ®åº“é‡Œé¢æ•°æ®è¡¨çš„ç›¸å…³æ€§è¿›è¡Œæ‹†åˆ†ã€‚</strong> ä¾‹å¦‚ï¼Œç”¨æˆ·è¡¨ä¸­æ—¢æœ‰ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯åˆæœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥å°†ç”¨æˆ·è¡¨æ‹†åˆ†æˆä¸¤ä¸ªå•ç‹¬çš„è¡¨ï¼Œç”šè‡³æ”¾åˆ°å•ç‹¬çš„åº“åšåˆ†åº“ã€‚</p><p><strong>ç®€å•æ¥è¯´å‚ç›´æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨åˆ—çš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ åˆ—æ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ã€‚</strong> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ ·æ¥è¯´å¤§å®¶åº”è¯¥å°±æ›´å®¹æ˜“ç†è§£äº†ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC82LzE2LzE2NDA4NDM1NGJhMmUwZmQ?x-oss-process=image/format,png" alt="img"></p><p><strong>å‚ç›´æ‹†åˆ†çš„ä¼˜ç‚¹ï¼š</strong> å¯ä»¥ä½¿å¾—è¡Œæ•°æ®å˜å°ï¼Œåœ¨æŸ¥è¯¢æ—¶å‡å°‘è¯»å–çš„Blockæ•°ï¼Œå‡å°‘I/Oæ¬¡æ•°ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºå¯ä»¥ç®€åŒ–è¡¨çš„ç»“æ„ï¼Œæ˜“äºç»´æŠ¤ã€‚</p><p><strong>å‚ç›´æ‹†åˆ†çš„ç¼ºç‚¹ï¼š</strong> ä¸»é”®ä¼šå‡ºç°å†—ä½™ï¼Œéœ€è¦ç®¡ç†å†—ä½™åˆ—ï¼Œå¹¶ä¼šå¼•èµ·Joinæ“ä½œï¼Œå¯ä»¥é€šè¿‡åœ¨åº”ç”¨å±‚è¿›è¡ŒJoinæ¥è§£å†³ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºä¼šè®©äº‹åŠ¡å˜å¾—æ›´åŠ å¤æ‚ï¼›</p><h4 id="å‚ç›´åˆ†è¡¨"><a href="#å‚ç›´åˆ†è¡¨" class="headerlink" title="å‚ç›´åˆ†è¡¨"></a>å‚ç›´åˆ†è¡¨</h4><p>æŠŠä¸»é”®å’Œä¸€äº›åˆ—æ”¾åœ¨ä¸€ä¸ªè¡¨ï¼Œç„¶åæŠŠä¸»é”®å’Œå¦å¤–çš„åˆ—æ”¾åœ¨å¦ä¸€ä¸ªè¡¨ä¸­</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy90dVNhS2M2U2ZQcjh0NFBaVVFJVUszVHl0aWF3T0VRa2dFZnBCTm4xZkNtdEVhMkRaNTlISFNSaWN2SEIzeU43Yk5LY1hkc3NWZGFNb25TOEFKanY5cFdBLzY0MA?x-oss-process=image/format,png" alt="img"></p><h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul><li>1ã€å¦‚æœä¸€ä¸ªè¡¨ä¸­æŸäº›åˆ—å¸¸ç”¨ï¼Œå¦å¤–ä¸€äº›åˆ—ä¸å¸¸ç”¨</li><li>2ã€å¯ä»¥ä½¿æ•°æ®è¡Œå˜å°ï¼Œä¸€ä¸ªæ•°æ®é¡µèƒ½å­˜å‚¨æ›´å¤šæ•°æ®ï¼ŒæŸ¥è¯¢æ—¶å‡å°‘I/Oæ¬¡æ•°</li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>æœ‰äº›åˆ†è¡¨çš„ç­–ç•¥åŸºäºåº”ç”¨å±‚çš„é€»è¾‘ç®—æ³•ï¼Œä¸€æ—¦é€»è¾‘ç®—æ³•æ”¹å˜ï¼Œæ•´ä¸ªåˆ†è¡¨é€»è¾‘éƒ½ä¼šæ”¹å˜ï¼Œæ‰©å±•æ€§è¾ƒå·®</li><li>å¯¹äºåº”ç”¨å±‚æ¥è¯´ï¼Œé€»è¾‘ç®—æ³•å¢åŠ å¼€å‘æˆæœ¬</li><li>ç®¡ç†å†—ä½™åˆ—ï¼ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®éœ€è¦joinæ“ä½œ</li></ul></li><li><p><strong>æ°´å¹³åˆ†åŒºï¼š</strong></p><p><strong>ä¿æŒæ•°æ®è¡¨ç»“æ„ä¸å˜ï¼Œé€šè¿‡æŸç§ç­–ç•¥å­˜å‚¨æ•°æ®åˆ†ç‰‡ã€‚è¿™æ ·æ¯ä¸€ç‰‡æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„è¡¨æˆ–è€…åº“ä¸­ï¼Œè¾¾åˆ°äº†åˆ†å¸ƒå¼çš„ç›®çš„ã€‚ æ°´å¹³æ‹†åˆ†å¯ä»¥æ”¯æ’‘éå¸¸å¤§çš„æ•°æ®é‡ã€‚</strong></p><p>æ°´å¹³æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨è¡Œçš„æ‹†åˆ†ï¼Œè¡¨çš„è¡Œæ•°è¶…è¿‡200ä¸‡è¡Œæ—¶ï¼Œå°±ä¼šå˜æ…¢ï¼Œè¿™æ—¶å¯ä»¥æŠŠä¸€å¼ çš„è¡¨çš„æ•°æ®æ‹†æˆå¤šå¼ è¡¨æ¥å­˜æ”¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨æ‹†åˆ†æˆå¤šä¸ªç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC82LzE2LzE2NDA4NGI3ZTllNDIzZTM?x-oss-process=image/format,png" alt="æ•°æ®åº“æ°´å¹³æ‹†åˆ†"></p><p>æ°´å“æ‹†åˆ†å¯ä»¥æ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯:åˆ†è¡¨ä»…ä»…æ˜¯è§£å†³äº†å•ä¸€è¡¨æ•°æ®è¿‡å¤§çš„é—®é¢˜ï¼Œä½†ç”±äºè¡¨çš„æ•°æ®è¿˜æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå…¶å®å¯¹äºæå‡MySQLå¹¶å‘èƒ½åŠ›æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæ‰€ä»¥ <strong>æ°´å¹³æ‹†åˆ†æœ€å¥½åˆ†åº“</strong> ã€‚</p><p>æ°´å¹³æ‹†åˆ†èƒ½å¤Ÿ <strong>æ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡å­˜å‚¨ï¼Œåº”ç”¨ç«¯æ”¹é€ ä¹Ÿå°‘</strong>ï¼Œä½† <strong>åˆ†ç‰‡äº‹åŠ¡éš¾ä»¥è§£å†³</strong> ï¼Œè·¨ç•Œç‚¹Joinæ€§èƒ½è¾ƒå·®ï¼Œé€»è¾‘å¤æ‚ã€‚</p><p>ã€ŠJavaå·¥ç¨‹å¸ˆä¿®ç‚¼ä¹‹é“ã€‹çš„ä½œè€…æ¨è <strong>å°½é‡ä¸è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå› ä¸ºæ‹†åˆ†ä¼šå¸¦æ¥é€»è¾‘ã€éƒ¨ç½²ã€è¿ç»´çš„å„ç§å¤æ‚åº¦</strong> ï¼Œä¸€èˆ¬çš„æ•°æ®è¡¨åœ¨ä¼˜åŒ–å¾—å½“çš„æƒ…å†µä¸‹æ”¯æ’‘åƒä¸‡ä»¥ä¸‹çš„æ•°æ®é‡æ˜¯æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ã€‚å¦‚æœå®åœ¨è¦åˆ†ç‰‡ï¼Œå°½é‡é€‰æ‹©å®¢æˆ·ç«¯åˆ†ç‰‡æ¶æ„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸€æ¬¡å’Œä¸­é—´ä»¶çš„ç½‘ç»œI/Oã€‚</p><h4 id="æ°´å¹³åˆ†è¡¨ï¼š"><a href="#æ°´å¹³åˆ†è¡¨ï¼š" class="headerlink" title="æ°´å¹³åˆ†è¡¨ï¼š"></a>æ°´å¹³åˆ†è¡¨ï¼š</h4><p>è¡¨å¾ˆå¤§ï¼Œåˆ†å‰²åå¯ä»¥é™ä½åœ¨æŸ¥è¯¢æ—¶éœ€è¦è¯»çš„æ•°æ®å’Œç´¢å¼•çš„é¡µæ•°ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†ç´¢å¼•çš„å±‚æ•°ï¼Œæé«˜æŸ¥è¯¢æ¬¡æ•°</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy90dVNhS2M2U2ZQcjh0NFBaVVFJVUszVHl0aWF3T0VRa2dkQVpyU1Y3M2liMWZkRENYS2M3QUd6Wmhid3FjS0ZVWkpGWThwMFZkVXRPM3JNYzZ2eDFBdzVBLzY0MA?x-oss-process=image/format,png" alt="img"></p><h5 id="é€‚ç”¨åœºæ™¯-1"><a href="#é€‚ç”¨åœºæ™¯-1" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul><li>1ã€è¡¨ä¸­çš„æ•°æ®æœ¬èº«å°±æœ‰ç‹¬ç«‹æ€§ï¼Œä¾‹å¦‚è¡¨ä¸­åˆ†è¡¨è®°å½•å„ä¸ªåœ°åŒºçš„æ•°æ®æˆ–è€…ä¸åŒæ—¶æœŸçš„æ•°æ®ï¼Œç‰¹åˆ«æ˜¯æœ‰äº›æ•°æ®å¸¸ç”¨ï¼Œæœ‰äº›ä¸å¸¸ç”¨ã€‚</li><li>2ã€éœ€è¦æŠŠæ•°æ®å­˜æ”¾åœ¨å¤šä¸ªä»‹è´¨ä¸Šã€‚</li></ul><h5 id="æ°´å¹³åˆ‡åˆ†çš„ç¼ºç‚¹"><a href="#æ°´å¹³åˆ‡åˆ†çš„ç¼ºç‚¹" class="headerlink" title="æ°´å¹³åˆ‡åˆ†çš„ç¼ºç‚¹"></a>æ°´å¹³åˆ‡åˆ†çš„ç¼ºç‚¹</h5><ul><li>1ã€ç»™åº”ç”¨å¢åŠ å¤æ‚åº¦ï¼Œé€šå¸¸æŸ¥è¯¢æ—¶éœ€è¦å¤šä¸ªè¡¨åï¼ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®éƒ½éœ€UNIONæ“ä½œ</li><li>2ã€åœ¨è®¸å¤šæ•°æ®åº“åº”ç”¨ä¸­ï¼Œè¿™ç§å¤æ‚åº¦ä¼šè¶…è¿‡å®ƒå¸¦æ¥çš„ä¼˜ç‚¹ï¼ŒæŸ¥è¯¢æ—¶ä¼šå¢åŠ è¯»ä¸€ä¸ªç´¢å¼•å±‚çš„ç£ç›˜æ¬¡æ•°</li></ul><p><strong>ä¸‹é¢è¡¥å……ä¸€ä¸‹æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š</strong></p><ul><li><strong>å®¢æˆ·ç«¯ä»£ç†ï¼š</strong> <strong>åˆ†ç‰‡é€»è¾‘åœ¨åº”ç”¨ç«¯ï¼Œå°è£…åœ¨jaråŒ…ä¸­ï¼Œé€šè¿‡ä¿®æ”¹æˆ–è€…å°è£…JDBCå±‚æ¥å®ç°ã€‚</strong> å½“å½“ç½‘çš„ <strong>Sharding-JDBC</strong> ã€é˜¿é‡Œçš„TDDLæ˜¯ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„å®ç°ã€‚</li><li><strong>ä¸­é—´ä»¶ä»£ç†ï¼š</strong> <strong>åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åˆ†ç‰‡é€»è¾‘ç»Ÿä¸€ç»´æŠ¤åœ¨ä¸­é—´ä»¶æœåŠ¡ä¸­ã€‚</strong> æˆ‘ä»¬ç°åœ¨è°ˆçš„ <strong>Mycat</strong> ã€360çš„Atlasã€ç½‘æ˜“çš„DDBç­‰ç­‰éƒ½æ˜¯è¿™ç§æ¶æ„çš„å®ç°ã€‚</li></ul></li></ol><p><strong>åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜</strong></p><ul><li><p><strong>äº‹åŠ¡æ”¯æŒ</strong> åˆ†åº“åˆ†è¡¨åï¼Œå°±æˆäº†åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚å¦‚æœä¾èµ–æ•°æ®åº“æœ¬èº«çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†åŠŸèƒ½å»æ‰§è¡Œäº‹åŠ¡ï¼Œå°†ä»˜å‡ºé«˜æ˜‚çš„æ€§èƒ½ä»£ä»·ï¼› å¦‚æœç”±åº”ç”¨ç¨‹åºå»ååŠ©æ§åˆ¶ï¼Œå½¢æˆç¨‹åºé€»è¾‘ä¸Šçš„äº‹åŠ¡ï¼Œåˆä¼šé€ æˆç¼–ç¨‹æ–¹é¢çš„è´Ÿæ‹…ã€‚</p></li><li><p><strong>è·¨åº“join</strong></p><p>åªè¦æ˜¯è¿›è¡Œåˆ‡åˆ†ï¼Œè·¨èŠ‚ç‚¹Joinçš„é—®é¢˜æ˜¯ä¸å¯é¿å…çš„ã€‚ä½†æ˜¯è‰¯å¥½çš„è®¾è®¡å’Œåˆ‡åˆ†å´å¯ä»¥å‡å°‘æ­¤ç±»æƒ…å†µçš„å‘ç”Ÿã€‚è§£å†³è¿™ä¸€é—®é¢˜çš„æ™®éåšæ³•æ˜¯åˆ†ä¸¤æ¬¡æŸ¥è¯¢å®ç°ã€‚åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœé›†ä¸­æ‰¾å‡ºå…³è”æ•°æ®çš„id,æ ¹æ®è¿™äº›idå‘èµ·ç¬¬äºŒæ¬¡è¯·æ±‚å¾—åˆ°å…³è”æ•°æ®ã€‚ åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆäº§å“</p></li><li><p><strong>è·¨èŠ‚ç‚¹çš„count,order by,group byä»¥åŠèšåˆå‡½æ•°é—®é¢˜</strong> è¿™äº›æ˜¯ä¸€ç±»é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬éƒ½éœ€è¦åŸºäºå…¨éƒ¨æ•°æ®é›†åˆè¿›è¡Œè®¡ç®—ã€‚å¤šæ•°çš„ä»£ç†éƒ½ä¸ä¼šè‡ªåŠ¨å¤„ç†åˆå¹¶å·¥ä½œã€‚è§£å†³æ–¹æ¡ˆï¼šä¸è§£å†³è·¨èŠ‚ç‚¹joiné—®é¢˜çš„ç±»ä¼¼ï¼Œåˆ†åˆ«åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°ç»“æœååœ¨åº”ç”¨ç¨‹åºç«¯è¿›è¡Œåˆå¹¶ã€‚å’Œjoinä¸åŒçš„æ˜¯æ¯ä¸ªç»“ç‚¹çš„æŸ¥è¯¢å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™å®ƒçš„é€Ÿåº¦è¦æ¯”å•ä¸€å¤§è¡¨å¿«å¾ˆå¤šã€‚ä½†å¦‚æœç»“æœé›†å¾ˆå¤§ï¼Œå¯¹åº”ç”¨ç¨‹åºå†…å­˜çš„æ¶ˆè€—æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p></li><li><p><strong>æ•°æ®è¿ç§»ï¼Œå®¹é‡è§„åˆ’ï¼Œæ‰©å®¹ç­‰é—®é¢˜</strong> æ¥è‡ªæ·˜å®ç»¼åˆä¸šåŠ¡å¹³å°å›¢é˜Ÿï¼Œå®ƒåˆ©ç”¨å¯¹2çš„å€æ•°å–ä½™å…·æœ‰å‘å‰å…¼å®¹çš„ç‰¹æ€§ï¼ˆå¦‚å¯¹4å–ä½™å¾—1çš„æ•°å¯¹2å–ä½™ä¹Ÿæ˜¯1ï¼‰æ¥åˆ†é…æ•°æ®ï¼Œé¿å…äº†è¡Œçº§åˆ«çš„æ•°æ®è¿ç§»ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è¿›è¡Œè¡¨çº§åˆ«çš„è¿ç§»ï¼ŒåŒæ—¶å¯¹æ‰©å®¹è§„æ¨¡å’Œåˆ†è¡¨æ•°é‡éƒ½æœ‰é™åˆ¶ã€‚æ€»å¾—æ¥è¯´ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½ä¸æ˜¯ååˆ†çš„ç†æƒ³ï¼Œå¤šå¤šå°‘å°‘éƒ½å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œè¿™ä¹Ÿä»ä¸€ä¸ªä¾§é¢åæ˜ å‡ºäº†Shardingæ‰©å®¹çš„éš¾åº¦ã€‚</p></li><li><p><strong>IDé—®é¢˜</strong></p></li><li><p>ä¸€æ—¦æ•°æ®åº“è¢«åˆ‡åˆ†åˆ°å¤šä¸ªç‰©ç†ç»“ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä¾èµ–æ•°æ®åº“è‡ªèº«çš„ä¸»é”®ç”Ÿæˆæœºåˆ¶ã€‚ä¸€æ–¹é¢ï¼ŒæŸä¸ªåˆ†åŒºæ•°æ®åº“è‡ªç”Ÿæˆçš„IDæ— æ³•ä¿è¯åœ¨å…¨å±€ä¸Šæ˜¯å”¯ä¸€çš„ï¼›å¦ä¸€æ–¹é¢ï¼Œåº”ç”¨ç¨‹åºåœ¨æ’å…¥æ•°æ®ä¹‹å‰éœ€è¦å…ˆè·å¾—ID,ä»¥ä¾¿è¿›è¡ŒSQLè·¯ç”±. ä¸€äº›å¸¸è§çš„ä¸»é”®ç”Ÿæˆç­–ç•¥</p></li></ul><p><strong>UUID</strong> ä½¿ç”¨UUIDä½œä¸»é”®æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ç”±äºUUIDéå¸¸çš„é•¿ï¼Œé™¤å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´å¤–ï¼Œæœ€ä¸»è¦çš„é—®é¢˜æ˜¯åœ¨ç´¢å¼•ä¸Šï¼Œåœ¨å»ºç«‹ç´¢å¼•å’ŒåŸºäºç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶éƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ <strong>Twitterçš„åˆ†å¸ƒå¼è‡ªå¢IDç®—æ³•Snowflake</strong> åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦ç”Ÿæˆå…¨å±€UIDçš„åœºåˆè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œtwitterçš„snowflakeè§£å†³äº†è¿™ç§éœ€æ±‚ï¼Œå®ç°ä¹Ÿè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé™¤å»é…ç½®ä¿¡æ¯ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯æ¯«ç§’çº§æ—¶é—´41ä½ æœºå™¨ID 10ä½ æ¯«ç§’å†…åºåˆ—12ä½ã€‚</p><ul><li><p>è·¨åˆ†ç‰‡çš„æ’åºåˆ†é¡µ</p><p>èˆ¬æ¥è®²ï¼Œåˆ†é¡µæ—¶éœ€è¦æŒ‰ç…§æŒ‡å®šå­—æ®µè¿›è¡Œæ’åºã€‚å½“æ’åºå­—æ®µå°±æ˜¯åˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†ç‰‡è§„åˆ™å¯ä»¥æ¯”è¾ƒå®¹æ˜“å®šä½åˆ°æŒ‡å®šçš„åˆ†ç‰‡ï¼Œè€Œå½“æ’åºå­—æ®µéåˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œæƒ…å†µå°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚ä¸ºäº†æœ€ç»ˆç»“æœçš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„åˆ†ç‰‡èŠ‚ç‚¹ä¸­å°†æ•°æ®è¿›è¡Œæ’åºå¹¶è¿”å›ï¼Œå¹¶å°†ä¸åŒåˆ†ç‰‡è¿”å›çš„ç»“æœé›†è¿›è¡Œæ±‡æ€»å’Œå†æ¬¡æ’åºï¼Œæœ€åå†è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200310170753848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoaW5rV29u,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ul><h3 id="MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹"><a href="#MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹" class="headerlink" title="MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹"></a>MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹</h3><p>ä¸»ä»å¤åˆ¶ï¼šå°†ä¸»æ•°æ®åº“ä¸­çš„DDLå’ŒDMLæ“ä½œé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰ä¼ è¾“åˆ°ä»æ•°æ®åº“ä¸Šï¼Œç„¶åå°†è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆé‡åšï¼‰ï¼›ä»è€Œä½¿å¾—ä»æ•°æ®åº“çš„æ•°æ®ä¸ä¸»æ•°æ®åº“ä¿æŒä¸€è‡´ã€‚</p><p><strong>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</strong></p><ol><li>ä¸»æ•°æ®åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»æ•°æ®åº“ã€‚</li><li>å¯ä»¥è¿›è¡Œæ•°æ®åº“å±‚é¢çš„è¯»å†™åˆ†ç¦»ã€‚</li><li>å¯ä»¥åœ¨ä»æ•°æ®åº“ä¸Šè¿›è¡Œæ—¥å¸¸å¤‡ä»½ã€‚</li></ol><p><strong>MySQLä¸»ä»å¤åˆ¶è§£å†³çš„é—®é¢˜</strong></p><ul><li>æ•°æ®åˆ†å¸ƒï¼šéšæ„å¼€å§‹æˆ–åœæ­¢å¤åˆ¶ï¼Œå¹¶åœ¨ä¸åŒåœ°ç†ä½ç½®åˆ†å¸ƒæ•°æ®å¤‡ä»½</li><li>è´Ÿè½½å‡è¡¡ï¼šé™ä½å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›</li><li>é«˜å¯ç”¨å’Œæ•…éšœåˆ‡æ¢ï¼šå¸®åŠ©åº”ç”¨ç¨‹åºé¿å…å•ç‚¹å¤±è´¥</li><li>å‡çº§æµ‹è¯•ï¼šå¯ä»¥ç”¨æ›´é«˜ç‰ˆæœ¬çš„MySQLä½œä¸ºä»åº“</li></ul><p><strong>MySQLä¸»ä»å¤åˆ¶å·¥ä½œåŸç†</strong></p><ul><li>åœ¨ä¸»åº“ä¸ŠæŠŠæ•°æ®æ›´é«˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—</li><li>ä»åº“å°†ä¸»åº“çš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—</li><li>ä»åº“è¯»å–ä¸­ç»§æ—¥å¿—çš„äº‹ä»¶ï¼Œå°†å…¶é‡æ”¾åˆ°ä»åº“æ•°æ®ä¸­</li></ul><p><strong>åŸºæœ¬åŸç†æµç¨‹ï¼Œ3ä¸ªçº¿ç¨‹ä»¥åŠä¹‹é—´çš„å…³è”</strong></p><p><strong>ä¸»</strong>ï¼šbinlogçº¿ç¨‹â€”â€”è®°å½•ä¸‹æ‰€æœ‰æ”¹å˜äº†æ•°æ®åº“æ•°æ®çš„è¯­å¥ï¼Œæ”¾è¿›masterä¸Šçš„binlogä¸­ï¼›</p><p><strong>ä»</strong>ï¼šioçº¿ç¨‹â€”â€”åœ¨ä½¿ç”¨start slave ä¹‹åï¼Œè´Ÿè´£ä»masterä¸Šæ‹‰å– binlog å†…å®¹ï¼Œæ”¾è¿›è‡ªå·±çš„relay logä¸­ï¼›</p><p><strong>ä»</strong>ï¼šsqlæ‰§è¡Œçº¿ç¨‹â€”â€”æ‰§è¡Œrelay logä¸­çš„è¯­å¥ï¼›</p><p><strong>å¤åˆ¶è¿‡ç¨‹</strong></p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC85LzIxLzE2NWZiNjgzMjIyMDViMmU?x-oss-process=image/format,png" alt="img"></p><p>Binary logï¼šä¸»æ•°æ®åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</p><p>Relay logï¼šä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—</p><p>ç¬¬ä¸€æ­¥ï¼šmasteråœ¨æ¯ä¸ªäº‹åŠ¡æ›´æ–°æ•°æ®å®Œæˆä¹‹å‰ï¼Œå°†è¯¥æ“ä½œè®°å½•ä¸²è¡Œåœ°å†™å…¥åˆ°binlogæ–‡ä»¶ä¸­ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šsalveå¼€å¯ä¸€ä¸ªI/O Threadï¼Œè¯¥çº¿ç¨‹åœ¨masteræ‰“å¼€ä¸€ä¸ªæ™®é€šè¿æ¥ï¼Œä¸»è¦å·¥ä½œæ˜¯binlog dump processã€‚å¦‚æœè¯»å–çš„è¿›åº¦å·²ç»è·Ÿä¸Šäº†masterï¼Œå°±è¿›å…¥ç¡çœ çŠ¶æ€å¹¶ç­‰å¾…masteräº§ç”Ÿæ–°çš„äº‹ä»¶ã€‚I/Oçº¿ç¨‹æœ€ç»ˆçš„ç›®çš„æ˜¯å°†è¿™äº›äº‹ä»¶å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ä¸­ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼šSQL Threadä¼šè¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶é¡ºåºæ‰§è¡Œè¯¥æ—¥å¿—ä¸­çš„SQLäº‹ä»¶ï¼Œä»è€Œä¸ä¸»æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚</p><h3 id="è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ"></a>è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ</h3><p>è¯»å†™åˆ†ç¦»æ˜¯ä¾èµ–äºä¸»ä»å¤åˆ¶ï¼Œè€Œä¸»ä»å¤åˆ¶åˆæ˜¯ä¸ºè¯»å†™åˆ†ç¦»æœåŠ¡çš„ã€‚å› ä¸ºä¸»ä»å¤åˆ¶è¦æ±‚<code>slave</code>ä¸èƒ½å†™åªèƒ½è¯»ï¼ˆå¦‚æœå¯¹<code>slave</code>æ‰§è¡Œå†™æ“ä½œï¼Œé‚£ä¹ˆ<code>show slave status</code>å°†ä¼šå‘ˆç°<code>Slave_SQL_Running=NO</code>ï¼Œæ­¤æ—¶ä½ éœ€è¦æŒ‰ç…§å‰é¢æåˆ°çš„æ‰‹åŠ¨åŒæ­¥ä¸€ä¸‹<code>slave</code>ï¼‰ã€‚</p><p><strong>æ–¹æ¡ˆä¸€</strong></p><p>ä½¿ç”¨mysql-proxyä»£ç†</p><p>ä¼˜ç‚¹ï¼šç›´æ¥å®ç°è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡ï¼Œä¸ç”¨ä¿®æ”¹ä»£ç ï¼Œmasterå’Œslaveç”¨ä¸€æ ·çš„å¸å·ï¼Œmysqlå®˜æ–¹ä¸å»ºè®®å®é™…ç”Ÿäº§ä¸­ä½¿ç”¨</p><p>ç¼ºç‚¹ï¼šé™ä½æ€§èƒ½ï¼Œ ä¸æ”¯æŒäº‹åŠ¡</p><p><strong>æ–¹æ¡ˆäºŒ</strong></p><p>ä½¿ç”¨AbstractRoutingDataSource+aop+annotationåœ¨daoå±‚å†³å®šæ•°æ®æºã€‚<br>å¦‚æœé‡‡ç”¨äº†mybatisï¼Œ å¯ä»¥å°†è¯»å†™åˆ†ç¦»æ”¾åœ¨ORMå±‚ï¼Œæ¯”å¦‚mybatiså¯ä»¥é€šè¿‡mybatis pluginæ‹¦æˆªsqlè¯­å¥ï¼Œæ‰€æœ‰çš„insert/update/deleteéƒ½è®¿é—®masteråº“ï¼Œæ‰€æœ‰çš„select éƒ½è®¿é—®salveåº“ï¼Œè¿™æ ·å¯¹äºdaoå±‚éƒ½æ˜¯é€æ˜ã€‚ pluginå®ç°æ—¶å¯ä»¥é€šè¿‡æ³¨è§£æˆ–è€…åˆ†æè¯­å¥æ˜¯è¯»å†™æ–¹æ³•æ¥é€‰å®šä¸»ä»åº“ã€‚ä¸è¿‡è¿™æ ·ä¾ç„¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ ä¹Ÿå°±æ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼Œ æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦é‡å†™ä¸€ä¸‹DataSourceTransactionManagerï¼Œ å°†read-onlyçš„äº‹åŠ¡æ‰”è¿›è¯»åº“ï¼Œ å…¶ä½™çš„æœ‰è¯»æœ‰å†™çš„æ‰”è¿›å†™åº“ã€‚</p><p><strong>æ–¹æ¡ˆä¸‰</strong></p><p>ä½¿ç”¨AbstractRoutingDataSource+aop+annotationåœ¨serviceå±‚å†³å®šæ•°æ®æºï¼Œå¯ä»¥æ”¯æŒäº‹åŠ¡.</p><p>ç¼ºç‚¹ï¼šç±»å†…éƒ¨æ–¹æ³•é€šè¿‡this.xx()æ–¹å¼ç›¸äº’è°ƒç”¨æ—¶ï¼Œaopä¸ä¼šè¿›è¡Œæ‹¦æˆªï¼Œéœ€è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</p><h3 id="å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†"><a href="#å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†" class="headerlink" title="å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†"></a>å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†</h3><p><strong>(1)å¤‡ä»½è®¡åˆ’</strong></p><p>è§†åº“çš„å¤§å°æ¥å®šï¼Œä¸€èˆ¬æ¥è¯´ 100G å†…çš„åº“ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ mysqldump æ¥åšï¼Œå› ä¸º mysqldumpæ›´åŠ è½»å·§çµæ´»ï¼Œå¤‡ä»½æ—¶é—´é€‰åœ¨ä¸šåŠ¡ä½å³°æœŸï¼Œå¯ä»¥æ¯å¤©è¿›è¡Œéƒ½è¿›è¡Œå…¨é‡å¤‡ä»½(mysqldump å¤‡ä»½å‡ºæ¥çš„æ–‡ä»¶æ¯”è¾ƒå°ï¼Œå‹ç¼©ä¹‹åæ›´å°)ã€‚</p><p>100G ä»¥ä¸Šçš„åº“ï¼Œå¯ä»¥è€ƒè™‘ç”¨ xtranbackup æ¥åšï¼Œå¤‡ä»½é€Ÿåº¦æ˜æ˜¾è¦æ¯” mysqldump è¦å¿«ã€‚ä¸€èˆ¬æ˜¯é€‰æ‹©ä¸€å‘¨ä¸€ä¸ªå…¨å¤‡ï¼Œå…¶ä½™æ¯å¤©è¿›è¡Œå¢é‡å¤‡ä»½ï¼Œå¤‡ä»½æ—¶é—´ä¸ºä¸šåŠ¡ä½å³°æœŸã€‚</p><p><strong>(2)å¤‡ä»½æ¢å¤æ—¶é—´</strong></p><p>ç‰©ç†å¤‡ä»½æ¢å¤å¿«ï¼Œé€»è¾‘å¤‡ä»½æ¢å¤æ…¢</p><p>è¿™é‡Œè·Ÿæœºå™¨ï¼Œå°¤å…¶æ˜¯ç¡¬ç›˜çš„é€Ÿç‡æœ‰å…³ç³»ï¼Œä»¥ä¸‹åˆ—ä¸¾å‡ ä¸ªä»…ä¾›å‚è€ƒ</p><p>20Gçš„2åˆ†é’Ÿï¼ˆmysqldumpï¼‰</p><p>80Gçš„30åˆ†é’Ÿ(mysqldump)</p><p>111Gçš„30åˆ†é’Ÿï¼ˆmysqldump)</p><p>288Gçš„3å°æ—¶ï¼ˆxtra)</p><p>3Tçš„4å°æ—¶ï¼ˆxtra)</p><p>é€»è¾‘å¯¼å…¥æ—¶é—´ä¸€èˆ¬æ˜¯å¤‡ä»½æ—¶é—´çš„5å€ä»¥ä¸Š</p><p><strong>(3)å¤‡ä»½æ¢å¤å¤±è´¥å¦‚ä½•å¤„ç†</strong></p><p>é¦–å…ˆåœ¨æ¢å¤ä¹‹å‰å°±åº”è¯¥åšè¶³å‡†å¤‡å·¥ä½œï¼Œé¿å…æ¢å¤çš„æ—¶å€™å‡ºé”™ã€‚æ¯”å¦‚è¯´å¤‡ä»½ä¹‹åçš„æœ‰æ•ˆæ€§æ£€æŸ¥ã€æƒé™æ£€æŸ¥ã€ç©ºé—´æ£€æŸ¥ç­‰ã€‚å¦‚æœä¸‡ä¸€æŠ¥é”™ï¼Œå†æ ¹æ®æŠ¥é”™çš„æç¤ºæ¥è¿›è¡Œç›¸åº”çš„è°ƒæ•´ã€‚</p><p><strong>(4)mysqldumpå’Œxtrabackupå®ç°åŸç†</strong></p><p>mysqldump</p><p>mysqldump å±äºé€»è¾‘å¤‡ä»½ã€‚åŠ å…¥â€“single-transaction é€‰é¡¹å¯ä»¥è¿›è¡Œä¸€è‡´æ€§å¤‡ä»½ã€‚åå°è¿›ç¨‹ä¼šå…ˆè®¾ç½® session çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º RR(SET SESSION TRANSACTION ISOLATION LEVELREPEATABLE READ)ï¼Œä¹‹åæ˜¾å¼å¼€å¯ä¸€ä¸ªäº‹åŠ¡(START TRANSACTION /<em>!40100 WITH CONSISTENTSNAPSHOT </em>/)ï¼Œè¿™æ ·å°±ä¿è¯äº†è¯¥äº‹åŠ¡é‡Œè¯»åˆ°çš„æ•°æ®éƒ½æ˜¯äº‹åŠ¡äº‹åŠ¡æ—¶å€™çš„å¿«ç…§ã€‚ä¹‹åå†æŠŠè¡¨çš„æ•°æ®è¯»å–å‡ºæ¥ã€‚å¦‚æœåŠ ä¸Šâ€“master-data=1 çš„è¯ï¼Œåœ¨åˆšå¼€å§‹çš„æ—¶å€™è¿˜ä¼šåŠ ä¸€ä¸ªæ•°æ®åº“çš„è¯»é”(FLUSH TABLES WITH READ LOCK),ç­‰å¼€å¯äº‹åŠ¡åï¼Œå†è®°å½•ä¸‹æ•°æ®åº“æ­¤æ—¶ binlog çš„ä½ç½®(showmaster status)ï¼Œé©¬ä¸Šè§£é”ï¼Œå†è¯»å–è¡¨çš„æ•°æ®ã€‚ç­‰æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»å¯¼å®Œï¼Œå°±å¯ä»¥ç»“æŸäº‹åŠ¡</p><p>Xtrabackup:</p><p>xtrabackup å±äºç‰©ç†å¤‡ä»½ï¼Œç›´æ¥æ‹·è´è¡¨ç©ºé—´æ–‡ä»¶ï¼ŒåŒæ—¶ä¸æ–­æ‰«æäº§ç”Ÿçš„ redo æ—¥å¿—å¹¶ä¿å­˜ä¸‹æ¥ã€‚æœ€åå®Œæˆ innodb çš„å¤‡ä»½åï¼Œä¼šåšä¸€ä¸ª flush engine logs çš„æ“ä½œ(è€ç‰ˆæœ¬åœ¨æœ‰ bugï¼Œåœ¨5.6 ä¸Šä¸åšæ­¤æ“ä½œä¼šä¸¢æ•°æ®)ï¼Œç¡®ä¿æ‰€æœ‰çš„ redo log éƒ½å·²ç»è½ç›˜(æ¶‰åŠåˆ°äº‹åŠ¡çš„ä¸¤é˜¶æ®µæäº¤</p><p>æ¦‚å¿µï¼Œå› ä¸º xtrabackup å¹¶ä¸æ‹·è´ binlogï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯æ‰€æœ‰çš„ redo log éƒ½è½ç›˜ï¼Œå¦åˆ™å¯èƒ½ä¼šä¸¢æœ€åä¸€ç»„æäº¤äº‹åŠ¡çš„æ•°æ®)ã€‚è¿™ä¸ªæ—¶é—´ç‚¹å°±æ˜¯ innodb å®Œæˆå¤‡ä»½çš„æ—¶é—´ç‚¹ï¼Œæ•°æ®æ–‡ä»¶è™½ç„¶ä¸æ˜¯ä¸€è‡´æ€§çš„ï¼Œä½†æ˜¯æœ‰è¿™æ®µæ—¶é—´çš„ redo å°±å¯ä»¥è®©æ•°æ®æ–‡ä»¶è¾¾åˆ°ä¸€è‡´æ€§(æ¢å¤çš„æ—¶å€™åšçš„äº‹</p><p>æƒ…)ã€‚ç„¶åè¿˜éœ€è¦ flush tables with read lockï¼ŒæŠŠ myisam ç­‰å…¶ä»–å¼•æ“çš„è¡¨ç»™å¤‡ä»½å‡ºæ¥ï¼Œå¤‡ä»½å®Œåè§£é”ã€‚è¿™æ ·å°±åšåˆ°äº†å®Œç¾çš„çƒ­å¤‡ã€‚</p><h3 id="æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h3><p>ä½¿ç”¨ myisamchk æ¥ä¿®å¤ï¼Œå…·ä½“æ­¥éª¤ï¼š</p><ul><li>1ï¼‰ä¿®å¤å‰å°†mysqlæœåŠ¡åœæ­¢ã€‚</li><li>2ï¼‰æ‰“å¼€å‘½ä»¤è¡Œæ–¹å¼ï¼Œç„¶åè¿›å…¥åˆ°mysqlçš„/binç›®å½•ã€‚</li><li>3ï¼‰æ‰§è¡Œmyisamchk â€“recover æ•°æ®åº“æ‰€åœ¨è·¯å¾„/*.MYI</li></ul><p>ä½¿ç”¨repair table æˆ–è€… OPTIMIZE tableå‘½ä»¤æ¥ä¿®å¤ï¼ŒREPAIR TABLE table_name ä¿®å¤è¡¨ OPTIMIZE TABLE table_name ä¼˜åŒ–è¡¨ REPAIR TABLE ç”¨äºä¿®å¤è¢«ç ´åçš„è¡¨ã€‚ OPTIMIZE TABLE ç”¨äºå›æ”¶é—²ç½®çš„æ•°æ®åº“ç©ºé—´ï¼Œå½“è¡¨ä¸Šçš„æ•°æ®è¡Œè¢«åˆ é™¤æ—¶ï¼Œæ‰€å æ®çš„ç£ç›˜ç©ºé—´å¹¶æ²¡æœ‰ç«‹å³è¢«å›æ”¶ï¼Œä½¿ç”¨äº†OPTIMIZE TABLEå‘½ä»¤åè¿™äº›ç©ºé—´å°†è¢«å›æ”¶ï¼Œå¹¶ä¸”å¯¹ç£ç›˜ä¸Šçš„æ•°æ®è¡Œè¿›è¡Œé‡æ’ï¼ˆæ³¨æ„ï¼šæ˜¯ç£ç›˜ä¸Šï¼Œè€Œéæ•°æ®åº“ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerç®¡ç†å¸¸ç”¨å‘½ä»¤</title>
      <link href="/2017/09/08/docker/Docker%E7%AE%A1%E7%90%86%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2017/09/08/docker/Docker%E7%AE%A1%E7%90%86%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>Docker çš„å¸¸ç”¨å‘½ä»¤ä¸€èˆ¬åˆ†ä¸ºï¼šé•œåƒç®¡ç†ã€å®¹å™¨ç®¡ç†ã€‚</p><a id="more"></a><h2 id="é•œåƒç®¡ç†å‘½ä»¤"><a href="#é•œåƒç®¡ç†å‘½ä»¤" class="headerlink" title="é•œåƒç®¡ç†å‘½ä»¤"></a>é•œåƒç®¡ç†å‘½ä»¤</h2><p>ä¸‹é¢ä½¿ç”¨ busybox è½¯ä»¶ä½œä¸ºç¤ºä¾‹ï¼Œbusybox è½¯ä»¶æ˜¯ä¸€ä¸ªé›†æˆäº†éå¸¸å¤šæœ€å¸¸ç”¨çš„ Linux å‘½ä»¤å’Œå·¥å…·çš„è½¯ä»¶é›†åˆã€‚</p><h3 id="æŸ¥çœ‹æ‰€æœ‰é•œåƒ"><a href="#æŸ¥çœ‹æ‰€æœ‰é•œåƒ" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰é•œåƒ"></a>æŸ¥çœ‹æ‰€æœ‰é•œåƒ</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><ul><li>REPOSITORYï¼šé•œåƒæ¥è‡ªå“ªä¸ªä»“åº“</li><li>TAGï¼šé•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼Œç‰ˆæœ¬ä¹‹ç±»çš„ä¿¡æ¯</li><li>IMAGE IDï¼šé•œåƒåˆ›å»ºæ—¶çš„id</li><li>CREATEDï¼šé•œåƒåˆ›å»ºçš„æ—¶é—´</li><li>SIZEï¼šé•œåƒæ–‡ä»¶å¤§å°</li><li>ä¸‹è½½è½¯ä»¶é•œåƒ</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull busybox:latest</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šlatest è¡¨ç¤ºä½¿ç”¨ busybox è½¯ä»¶çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥è½¯ä»¶é»˜è®¤ä¸‹è½½éƒ½æ˜¯ latest ç‰ˆæœ¬ã€‚</p><h3 id="å¯¼å‡ºé•œåƒ"><a href="#å¯¼å‡ºé•œåƒ" class="headerlink" title="å¯¼å‡ºé•œåƒ"></a>å¯¼å‡ºé•œåƒ</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save busybox &gt; busybox.tar</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šæŠŠ busybox é•œåƒå¯¼å‡ºä¸º busybox.tar æ–‡ä»¶ï¼Œå¯ä»¥æŠŠ busybox.tar æ–‡ä»¶å¤åˆ¶åˆ°åˆ«çš„æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨ï¼Œå…é™¤ä¸‹è½½æ—¶ç½‘ç»œæ…¢çš„é—®é¢˜ã€‚</p><h3 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi busybox:latest</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šé•œåƒä¸€èˆ¬éƒ½ä¼šæ ¹æ®ç‰ˆæœ¬æ‰“åŒ…ï¼Œå¦‚æœæœ‰ä¸‹è½½ä¸€ä¸ªè½¯ä»¶çš„å¤šä¸ªç‰ˆæœ¬å°±éœ€è¦æŒ‡å®šå…·ä½“ç‰ˆæœ¬ä¿¡æ¯ã€‚å¦‚ busybox:1.26 å°±ä¼šåˆ é™¤ busybox è½¯ä»¶çš„ 1.26 ç‰ˆæœ¬çš„é•œåƒï¼Œä¸ä¼šåˆ é™¤latest ç‰ˆæœ¬çš„é•œåƒã€‚</p><h3 id="å¯¼å…¥é•œåƒ"><a href="#å¯¼å…¥é•œåƒ" class="headerlink" title="å¯¼å…¥é•œåƒ"></a>å¯¼å…¥é•œåƒ</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load &lt; busybox.tar</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šä½¿ç”¨å¯¼å‡ºå‘½ä»¤å¯¼å‡ºçš„é•œåƒï¼Œå¯ä»¥é€šè¿‡æ­¤å‘½ä»¤å¯¼å…¥åˆ°æ²¡æœ‰ä¸‹è½½æ­¤è½¯ä»¶çš„æ“ä½œç³»ç»Ÿï¼Œæ–¹ä¾¿ç½‘ç»œæ¡ä»¶å·®çš„æƒ…å†µä½¿ç”¨ã€‚</p><h3 id="æ›´æ”¹é•œåƒå"><a href="#æ›´æ”¹é•œåƒå" class="headerlink" title="æ›´æ”¹é•œåƒå"></a>æ›´æ”¹é•œåƒå</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag busybox:latest busybox:test</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šbusybox:lateståŸé•œåƒåï¼Œbusybox:testè¦æ”¹æˆçš„é•œåƒå</p><h2 id="å®¹å™¨ç®¡ç†å‘½ä»¤"><a href="#å®¹å™¨ç®¡ç†å‘½ä»¤" class="headerlink" title="å®¹å™¨ç®¡ç†å‘½ä»¤"></a>å®¹å™¨ç®¡ç†å‘½ä»¤</h2><h3 id="è¿è¡Œå®¹å™¨"><a href="#è¿è¡Œå®¹å™¨" class="headerlink" title="è¿è¡Œå®¹å™¨"></a>è¿è¡Œå®¹å™¨</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=busybox busybox:latest ping 114.114.114.114</span><br></pre></td></tr></table></figure><ul><li><code>run</code>ï¼šrunå‚æ•°ä»£è¡¨å¯åŠ¨å®¹å™¨</li><li><code>-d</code>ï¼šä»¥åå°daemonçš„æ–¹å¼è¿è¡Œ</li><li><code>--name</code>ï¼šæŒ‡å®šä¸€ä¸ªå®¹å™¨çš„åå­—ï¼Œæ­¤åæ“ä½œéƒ½éœ€è¦ä½¿ç”¨è¿™ä¸ªåå­—æ¥å®šä½å®¹å™¨ã€‚</li><li><code>busybox:latest</code>ï¼šå®¹å™¨æ‰€ä½¿ç”¨çš„é•œåƒåå­—</li><li><code>ping 114.114.114.114</code>ï¼šå¯åŠ¨å®¹å™¨æ‰§è¡Œçš„å‘½ä»¤</li><li>æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰å®¹å™¨"><a href="#æŸ¥çœ‹æ‰€æœ‰å®¹å™¨" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰å®¹å™¨"></a>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><ul><li><code>CONTAINER ID</code>ï¼šå®¹å™¨å¯åŠ¨çš„id</li><li><code>IMAGE</code>ï¼šä½¿ç”¨å“ªä¸ªé•œåƒå¯åŠ¨çš„å®¹å™¨</li><li><code>COMMAND</code>ï¼šå¯åŠ¨å®¹å™¨çš„å‘½ä»¤</li><li><code>CREATED</code>ï¼šåˆ›å»ºå®¹å™¨çš„æ—¶é—´</li><li><code>STATUS</code>ï¼šå®¹å™¨å¯åŠ¨æ—¶é—´</li><li><code>PORTS</code>ï¼šå®¹å™¨æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£</li><li><code>NAMES</code>ï¼šå®¹å™¨å¯åŠ¨çš„åå­—</li><li>å¯åŠ¨å®¹å™¨</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start busybox</span><br></pre></td></tr></table></figure><h3 id="ã€‚é‡æ–°å¯åŠ¨å®¹å™¨"><a href="#ã€‚é‡æ–°å¯åŠ¨å®¹å™¨" class="headerlink" title="ã€‚é‡æ–°å¯åŠ¨å®¹å™¨"></a>ã€‚é‡æ–°å¯åŠ¨å®¹å™¨</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart busybox</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢å®¹å™¨"><a href="#åœæ­¢å®¹å™¨" class="headerlink" title="åœæ­¢å®¹å™¨"></a>åœæ­¢å®¹å™¨</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop busybox</span><br></pre></td></tr></table></figure><h3 id="æ€æ­»å®¹å™¨"><a href="#æ€æ­»å®¹å™¨" class="headerlink" title="æ€æ­»å®¹å™¨"></a>æ€æ­»å®¹å™¨</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill busybox</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨"><a href="#åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨" class="headerlink" title="åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨"></a>åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f busybox</span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤"><a href="#æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤" class="headerlink" title="æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤"></a>æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it busybox ls</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼š-it äº¤äº’ç»ˆç«¯</p><h3 id="å¤åˆ¶å®¹å™¨å†…æ–‡ä»¶"><a href="#å¤åˆ¶å®¹å™¨å†…æ–‡ä»¶" class="headerlink" title="å¤åˆ¶å®¹å™¨å†…æ–‡ä»¶"></a>å¤åˆ¶å®¹å™¨å†…æ–‡ä»¶</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp busybox:/etc/hosts hosts</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å®¹å™¨æ—¥å¿—"><a href="#æŸ¥çœ‹å®¹å™¨æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹å®¹å™¨æ—¥å¿—"></a>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f busybox</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcodeåˆ†ç±»åˆ·é¢˜æŒ‡å—</title>
      <link href="/2017/09/04/%E5%88%B7%E9%A2%98/Leetcode%E5%88%86%E7%B1%BB%E5%88%B7%E9%A2%98%E6%8C%87%E5%8D%97/"/>
      <url>/2017/09/04/%E5%88%B7%E9%A2%98/Leetcode%E5%88%86%E7%B1%BB%E5%88%B7%E9%A2%98%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›å¸¸è§çš„é¢˜å‹ï¼Œåˆ·é¢˜äº‹åŠåŠŸå€ã€‚</p><a id="more"></a><h2 id="1-Pattern-Sliding-windowï¼Œæ»‘åŠ¨çª—å£ç±»å‹"><a href="#1-Pattern-Sliding-windowï¼Œæ»‘åŠ¨çª—å£ç±»å‹" class="headerlink" title="1. Pattern: Sliding windowï¼Œæ»‘åŠ¨çª—å£ç±»å‹"></a>1. Pattern: Sliding windowï¼Œæ»‘åŠ¨çª—å£ç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Maximum Sum Subarray of Size K (easy)</p><p>Smallest Subarray with a given sum (easy)</p><p>Longest Substring with K Distinct Characters (medium)</p><p>Fruits into Baskets (medium)</p><p>No-repeat Substring (hard)</p><p>Longest Substring with Same Letters after Replacement (hard)</p><p>Longest Subarray with Ones after Replacement (hard)</p><h2 id="2-Pattern-two-points-åŒæŒ‡é’ˆç±»å‹"><a href="#2-Pattern-two-points-åŒæŒ‡é’ˆç±»å‹" class="headerlink" title="2. Pattern: two points, åŒæŒ‡é’ˆç±»å‹"></a>2. Pattern: two points, åŒæŒ‡é’ˆç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Pair with Target Sum (easy)</p><p>Remove Duplicates (easy)</p><p>Squaring a Sorted Array (easy)</p><p>Triplet Sum to Zero (medium)</p><p>Triplet Sum Close to Target (medium)</p><p>Triplets with Smaller Sum (medium)</p><p>Subarrays with Product Less than a Target (medium)</p><p>Dutch National Flag Problem (medium)</p><h2 id="3-Pattern-Fast-amp-Slow-pointers-å¿«æ…¢æŒ‡é’ˆç±»å‹"><a href="#3-Pattern-Fast-amp-Slow-pointers-å¿«æ…¢æŒ‡é’ˆç±»å‹" class="headerlink" title="3. Pattern: Fast &amp; Slow pointers, å¿«æ…¢æŒ‡é’ˆç±»å‹"></a>3. Pattern: Fast &amp; Slow pointers, å¿«æ…¢æŒ‡é’ˆç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>LinkedList Cycle (easy)</p><p>Start of LinkedList Cycle (medium)</p><p>Happy Number (medium)</p><p>Middle of the LinkedList (easy)</p><h2 id="4-Pattern-Merge-Intervalsï¼ŒåŒºé—´åˆå¹¶ç±»å‹"><a href="#4-Pattern-Merge-Intervalsï¼ŒåŒºé—´åˆå¹¶ç±»å‹" class="headerlink" title="4. Pattern: Merge Intervalsï¼ŒåŒºé—´åˆå¹¶ç±»å‹"></a>4. Pattern: Merge Intervalsï¼ŒåŒºé—´åˆå¹¶ç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Merge Intervals (medium)</p><p>Insert Interval (medium)</p><p>Intervals Intersection (medium)</p><p>Conflicting Appointments (medium)</p><h2 id="5-Pattern-Cyclic-Sortï¼Œå¾ªç¯æ’åº"><a href="#5-Pattern-Cyclic-Sortï¼Œå¾ªç¯æ’åº" class="headerlink" title="5. Pattern: Cyclic Sortï¼Œå¾ªç¯æ’åº"></a>5. Pattern: Cyclic Sortï¼Œå¾ªç¯æ’åº</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Cyclic Sort (easy)</p><p>Find the Missing Number (easy)</p><p>Find all Missing Numbers (easy)</p><p>Find the Duplicate Number (easy)</p><p>Find all Duplicate Numbers (easy)</p><h2 id="6-Pattern-In-place-Reversal-of-a-LinkedListï¼Œé“¾è¡¨ç¿»è½¬"><a href="#6-Pattern-In-place-Reversal-of-a-LinkedListï¼Œé“¾è¡¨ç¿»è½¬" class="headerlink" title="6. Pattern: In-place Reversal of a LinkedListï¼Œé“¾è¡¨ç¿»è½¬"></a>6. Pattern: In-place Reversal of a LinkedListï¼Œé“¾è¡¨ç¿»è½¬</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Reverse a LinkedList (easy)</p><p>Reverse a Sub-list (medium)</p><p>Reverse every K-element Sub-list (medium)</p><h2 id="7-Pattern-Tree-Breadth-First-Searchï¼Œæ ‘ä¸Šçš„BFS"><a href="#7-Pattern-Tree-Breadth-First-Searchï¼Œæ ‘ä¸Šçš„BFS" class="headerlink" title="7. Pattern: Tree Breadth First Searchï¼Œæ ‘ä¸Šçš„BFS**"></a>7. Pattern: Tree Breadth First Searchï¼Œæ ‘ä¸Šçš„BFS**</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Binary Tree Level Order Traversal (easy)</p><p>Reverse Level Order Traversal (easy)</p><p>Zigzag Traversal (medium)</p><p>Level Averages in a Binary Tree (easy)</p><p>Minimum Depth of a Binary Tree (easy)</p><p>Level Order Successor (easy)</p><p>Connect Level Order Siblings (medium)</p><h2 id="8-Pattern-Tree-Depth-First-Searchï¼Œæ ‘ä¸Šçš„DFS"><a href="#8-Pattern-Tree-Depth-First-Searchï¼Œæ ‘ä¸Šçš„DFS" class="headerlink" title="8. Pattern: Tree Depth First Searchï¼Œæ ‘ä¸Šçš„DFS**"></a>8. Pattern: Tree Depth First Searchï¼Œæ ‘ä¸Šçš„DFS**</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Binary Tree Path Sum (easy)</p><p>All Paths for a Sum (medium)</p><p>Sum of Path Numbers (medium)</p><p>Path With Given Sequence (medium)</p><p>Count Paths for a Sum (medium)</p><h2 id="9-Pattern-Two-Heapsï¼ŒåŒå †ç±»å‹"><a href="#9-Pattern-Two-Heapsï¼ŒåŒå †ç±»å‹" class="headerlink" title="9. Pattern: Two Heapsï¼ŒåŒå †ç±»å‹"></a>9. Pattern: Two Heapsï¼ŒåŒå †ç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Find the Median of a Number Stream (medium)</p><p>Sliding Window Median (hard)</p><p>Maximize Capital (hard)</p><h2 id="10-Pattern-Subsetsï¼Œå­é›†ç±»å‹ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å¤šé‡DFS"><a href="#10-Pattern-Subsetsï¼Œå­é›†ç±»å‹ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å¤šé‡DFS" class="headerlink" title="10. Pattern: Subsetsï¼Œå­é›†ç±»å‹ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å¤šé‡DFS**"></a>10. Pattern: Subsetsï¼Œå­é›†ç±»å‹ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å¤šé‡DFS**</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Subsets (easy)</p><p>Subsets With Duplicates (easy)</p><p>Permutations (medium)</p><p>String Permutations by changing case (medium)</p><p>Balanced Parentheses (hard)</p><p>Unique Generalized Abbreviations (hard)</p><h2 id="11-Pattern-Modified-Binary-Searchï¼Œæ”¹é€ è¿‡çš„äºŒåˆ†"><a href="#11-Pattern-Modified-Binary-Searchï¼Œæ”¹é€ è¿‡çš„äºŒåˆ†" class="headerlink" title="11. Pattern: Modified Binary Searchï¼Œæ”¹é€ è¿‡çš„äºŒåˆ†"></a>11. Pattern: Modified Binary Searchï¼Œæ”¹é€ è¿‡çš„äºŒåˆ†</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Order-agnostic Binary Search (easy)</p><p>Ceiling of a Number (medium)</p><p>Next Letter (medium)</p><p>Number Range (medium)</p><p>Search in a Sorted Infinite Array (medium)</p><p>Minimum Difference Element (medium)</p><p>Bitonic Array Maximum (easy)</p><h2 id="12-Pattern-Top-â€˜Kâ€™-Elementsï¼Œå‰Kä¸ªç³»åˆ—"><a href="#12-Pattern-Top-â€˜Kâ€™-Elementsï¼Œå‰Kä¸ªç³»åˆ—" class="headerlink" title="12. Pattern: Top â€˜Kâ€™ Elementsï¼Œå‰Kä¸ªç³»åˆ—"></a>12. Pattern: Top â€˜Kâ€™ Elementsï¼Œå‰Kä¸ªç³»åˆ—</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Top â€˜Kâ€™ Numbers (easy)</p><p>Kth Smallest Number (easy)</p><p>â€˜Kâ€™ Closest Points to the Origin (easy)</p><p>Connect Ropes (easy)</p><p>Top â€˜Kâ€™ Frequent Numbers (medium)</p><p>Frequency Sort (medium)</p><p>Kth Largest Number in a Stream (medium)</p><p>â€˜Kâ€™ Closest Numbers (medium)</p><p>Maximum Distinct Elements (medium)</p><p>Sum of Elements (medium)</p><p>Rearrange String (hard)</p><h2 id="13-Pattern-K-way-mergeï¼Œå¤šè·¯å½’å¹¶"><a href="#13-Pattern-K-way-mergeï¼Œå¤šè·¯å½’å¹¶" class="headerlink" title="13. Pattern: K-way mergeï¼Œå¤šè·¯å½’å¹¶"></a>13. Pattern: K-way mergeï¼Œå¤šè·¯å½’å¹¶</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Merge K Sorted Lists (medium)</p><p>Kth Smallest Number in M Sorted Lists (Medium)</p><p>Kth Smallest Number in a Sorted Matrix (Hard)</p><p>Smallest Number Range (Hard)</p><h2 id="14-Pattern-0-1-Knapsack-Dynamic-Programming-ï¼Œ0-1èƒŒåŒ…ç±»å‹"><a href="#14-Pattern-0-1-Knapsack-Dynamic-Programming-ï¼Œ0-1èƒŒåŒ…ç±»å‹" class="headerlink" title="14. Pattern: 0/1 Knapsack (Dynamic Programming)ï¼Œ0/1èƒŒåŒ…ç±»å‹"></a>14. Pattern: 0/1 Knapsack (Dynamic Programming)ï¼Œ0/1èƒŒåŒ…ç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>0/1 Knapsack (medium)</p><p>Equal Subset Sum Partition (medium)</p><p>Subset Sum (medium)</p><p>Minimum Subset Sum Difference (hard)</p><h2 id="15-Pattern-Topological-Sort-Graph-ï¼Œæ‹“æ‰‘æ’åºç±»å‹"><a href="#15-Pattern-Topological-Sort-Graph-ï¼Œæ‹“æ‰‘æ’åºç±»å‹" class="headerlink" title="15. Pattern: Topological Sort (Graph)ï¼Œæ‹“æ‰‘æ’åºç±»å‹"></a>15. Pattern: Topological Sort (Graph)ï¼Œæ‹“æ‰‘æ’åºç±»å‹</h2><p>ç»å…¸é¢˜ç›®ï¼š</p><p>Topological Sort (medium)</p><p>Tasks Scheduling (medium)</p><p>Tasks Scheduling Order (medium)</p><p>All Tasks Scheduling Orders (hard)</p><p>Alien Dictionary (hard)</p><p>å¤§å®¶å¥½å¥½ç»ƒç»ƒè¿™äº›é¢˜ç›®ï¼Œé¢è¯•ä¸­é‡åˆ°çš„é¢˜ç›®ï¼Œåº”è¯¥å°±èƒ½å›ç­”å¾—ä¸é”™äº†ã€‚</p><p>ç¥é¢è¯•å¥½è¿ï¼</p>]]></content>
      
      
      <categories>
          
          <category> åˆ·é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¹‹è¿›ç¨‹è°ƒåº¦ç®¡ç†</title>
      <link href="/2017/09/01/Linux/Linux%E4%B9%8B%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E7%AE%A1%E7%90%86/"/>
      <url>/2017/09/01/Linux/Linux%E4%B9%8B%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>Linux å†…æ ¸å¯ä»¥çœ‹ä½œä¸€ä¸ªæœåŠ¡è¿›ç¨‹ (ç®¡ç†è½¯ç¡¬ä»¶èµ„æºï¼Œå“åº”ç”¨æˆ·è¿›ç¨‹çš„ç§ç§åˆç†ä»¥åŠä¸åˆç†çš„è¯·æ±‚)ã€‚</p><p>è¿™æ˜¯å› ä¸ºå†…æ ¸éœ€è¦å¹¶è¡Œå¤šä¸ªæ‰§è¡Œæµï¼Œéœ€è¦é˜²æ­¢é˜»å¡ã€‚å†…æ ¸çº¿ç¨‹å¯ä»¥ç†è§£ä¸ºå†…æ ¸çš„åˆ†èº«ï¼Œä¸€ä¸ªåˆ†èº«å¤„ç†ä¸€é¡¹ç‰¹å®šä»»åŠ¡ï¼Œå†…æ ¸çº¿ç¨‹è°ƒåº¦ç”±å†…æ ¸è´Ÿè´£ï¼Œä¸€ä¸ªå†…æ ¸çº¿ç¨‹é˜»å¡ä¸å½±å“å…¶ä»–å†…æ ¸çº¿ç¨‹ï¼Œ<strong>å†…æ ¸çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ã€‚</p><p>ä½œä¸ºå¯¹æ¯”ï¼Œç”¨æˆ·çº¿ç¨‹å¯ä»¥è¿è¡Œåœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œå†…æ ¸çº¿ç¨‹åªåœ¨å†…æ ¸æ€ã€‚</p><p>å®ƒåªæ˜¯ç”¨å¤§äºPAGE_OFFSETçš„åœ°å€ç©ºé—´ã€‚</p><a id="more"></a><h2 id="Linuxçš„è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#Linuxçš„è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="Linuxçš„è¿›ç¨‹å’Œçº¿ç¨‹"></a>Linuxçš„è¿›ç¨‹å’Œçº¿ç¨‹</h2><p>å¯¹äº Linux æ¥è®²ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å½“ä½œè¿›ç¨‹æ¥å®ç°ï¼Œå› ä¸ºæ²¡æœ‰å•ç‹¬ä¸ºçº¿ç¨‹å®šä¹‰ç‰¹å®šçš„è°ƒåº¦ç®—æ³•ï¼Œä¹Ÿæ²¡æœ‰å•ç‹¬ä¸ºçº¿ç¨‹å®šä¹‰ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼ˆæ‰€æœ‰çš„çº¿ç¨‹æˆ–è¿›ç¨‹çš„æ ¸å¿ƒæ•°æ®ç»“æ„éƒ½æ˜¯ <code>task_struct</code>ï¼‰ã€‚</p><blockquote><p>å¯¹äºä¸€ä¸ªè¿›ç¨‹ï¼Œç›¸å½“äºæ˜¯å®ƒå«æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å®ƒè‡ªèº«ã€‚å¯¹äºå¤šçº¿ç¨‹æ¥è¯´ï¼ŒåŸæœ¬çš„è¿›ç¨‹ç§°ä¸ºä¸»çº¿ç¨‹ï¼Œå®ƒä»¬åœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªçº¿ç¨‹ç»„ã€‚</p></blockquote><p>è¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ã€‚è€Œçº¿ç¨‹å´æ²¡æœ‰ï¼Œåªèƒ½å’Œå…¶å®ƒçº¿ç¨‹å…±äº«æŸä¸€ä¸ªåœ°å€ç©ºé—´å’ŒåŒä¸€ä»½é¡µè¡¨ã€‚è¿™ä¸ªåŒºåˆ«çš„ æ ¹æœ¬åŸå›  æ˜¯ï¼Œåœ¨è¿›ç¨‹/çº¿ç¨‹åˆ›å»ºæ—¶ï¼Œå› æ˜¯å¦æ‹·è´å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´è¿˜æ˜¯å…±äº«å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè€Œä½¿å¾—æŒ‡å®šçš„å‚æ•°ä¸åŒè€Œå¯¼è‡´çš„ã€‚</p><p>å…·ä½“åœ°è¯´ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ›å»ºéƒ½æ˜¯æ‰§è¡Œ <code>clone</code> ç³»ç»Ÿè°ƒç”¨è¿›è¡Œçš„ã€‚è€Œ clone ç³»ç»Ÿè°ƒç”¨ä¼šæ‰§è¡Œ <code>do_fork</code> å†…æ ¸å‡½æ•°ï¼Œè€Œå®ƒåˆ™åˆä¼šè°ƒç”¨ <code>copy_process</code> å†…æ ¸å‡½æ•°æ¥å®Œæˆã€‚ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹æ“ä½œï¼š</p><p>åœ¨è°ƒç”¨ <code>copy_process</code> çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ›å»ºå¹¶æ‹·è´å½“å‰è¿›ç¨‹çš„ <code>task_stuct</code>ï¼ŒåŒæ—¶è¿˜ä¼šåˆ›å»ºå±äºå­è¿›ç¨‹çš„ <code>thread_info</code> ç»“æ„ä»¥åŠå†…æ ¸æ ˆã€‚<br>æ­¤åï¼Œä¼šä¸ºåˆ›å»ºå¥½çš„ <code>task_stuct</code> æŒ‡å®šä¸€ä¸ªæ–°çš„ pidï¼ˆåœ¨ <code>task_struct</code> ç»“æ„ä½“ä¸­ï¼‰ã€‚<br>ç„¶åæ ¹æ®ä¼ é€’ç»™ clone çš„å‚æ•°æ ‡å¿—ï¼Œæ¥é€‰æ‹©æ‹·è´è¿˜æ˜¯å…±äº«æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹åœ°å€ç©ºé—´ç­‰ã€‚è¿™å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ä¸ä¸€æ ·åœ°æ–¹çš„æœ¬è´¨æ‰€åœ¨ã€‚</p><h2 id="task-struct"><a href="#task-struct" class="headerlink" title="task_struct"></a>task_struct</h2><p>æ¯ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹éƒ½æœ‰ä¸‰ä¸ªæ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æ˜¯ struct thread_info, struct task_struct å’Œ å†…æ ¸æ ˆã€‚</p><blockquote><p>æ³¨æ„ï¼Œè™½ç„¶çº¿ç¨‹ä¸ä¸»çº¿ç¨‹å…±äº«åœ°å€ç©ºé—´ï¼Œä½†æ˜¯çº¿ç¨‹ä¹Ÿæ˜¯æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…æ ¸æ ˆçš„ã€‚</p></blockquote><p><code>thread_info</code> å¯¹è±¡ä¸­å­˜æ”¾çš„è¿›ç¨‹/çº¿ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼Œå®ƒå’Œè¿™ä¸ªè¿›ç¨‹/çº¿ç¨‹çš„å†…æ ¸æ ˆå­˜æ”¾åœ¨å†…æ ¸ç©ºé—´é‡Œçš„ä¸€æ®µ 2 å€é¡µé•¿çš„ç©ºé—´ä¸­ã€‚å…¶ä¸­ thread_info ç»“æ„å­˜æ”¾åœ¨ä½åœ°å€æ®µçš„æœ«å°¾ï¼Œå…¶ä½™ç©ºé—´ç”¨ä½œå†…æ ¸æ ˆã€‚å†…æ ¸ä½¿ç”¨ ä¼™ä¼´ç³»ç»Ÿ ä¸ºæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹åˆ†é…è¿™å—ç©ºé—´ã€‚</p><p><code>thread_info</code> ç»“æ„ä½“ä¸­æœ‰ä¸€ä¸ª <code>struct task_struct *task</code>ï¼Œtask æŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹ç›¸å…³çš„ <code>task_struct</code> å¯¹è±¡ï¼ˆä¹Ÿåœ¨å†…æ ¸ç©ºé—´ä¸­ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å«åšè¿›ç¨‹æè¿°ç¬¦ï¼ˆå«åšä»»åŠ¡æè¿°ç¬¦æ›´ä¸ºè´´åˆ‡ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹ä¹Ÿéƒ½æœ‰è‡ªå·±çš„ <code>task_struct</code>ï¼‰ã€‚å†…æ ¸ä½¿ç”¨ slab åˆ†é…å™¨ä¸ºæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹åˆ†é…è¿™å—ç©ºé—´ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/01/LGpftydEQbgODMJ.png" alt="2018-01-10-1"></p><h2 id="å†…æ ¸çº¿ç¨‹"><a href="#å†…æ ¸çº¿ç¨‹" class="headerlink" title="å†…æ ¸çº¿ç¨‹"></a>å†…æ ¸çº¿ç¨‹</h2><p>å†…æ ¸çº¿ç¨‹æ˜¯ç›´æ¥ç”±å†…æ ¸æœ¬èº«å¯åŠ¨çš„è¿›ç¨‹ã€‚<strong>å†…æ ¸çº¿ç¨‹å®é™…ä¸Šæ˜¯å°†å†…æ ¸å‡½æ•°å§”æ‰˜ç»™ç‹¬ç«‹çš„è¿›ç¨‹</strong>ï¼Œå®ƒä¸å†…æ ¸ä¸­çš„å…¶ä»–è¿›ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚å†…æ ¸çº¿ç¨‹ç»å¸¸è¢«ç§°ä¹‹ä¸ºå†…æ ¸å®ˆæŠ¤è¿›ç¨‹ã€‚<strong>æ‰€æœ‰çš„å†…æ ¸çº¿ç¨‹å…±äº«å†…æ ¸åœ°å€ç©ºé—´</strong>ï¼ˆå¯¹äº 32 ä½ç³»ç»Ÿæ¥è¯´ï¼Œå°±æ˜¯ 3-4GB çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå…±äº«åŒä¸€ä»½å†…æ ¸é¡µè¡¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå«å†…æ ¸çº¿ç¨‹ï¼Œè€Œä¸å«å†…æ ¸è¿›ç¨‹çš„åŸå› ã€‚</p><p>å†…æ ¸çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡æœ‰ï¼š</p><ul><li>å‘¨æœŸæ€§åœ°å°†ä¿®æ”¹çš„å†…å­˜é¡µä¸é¡µæ¥æºå—è®¾å¤‡åŒæ­¥</li><li>å¦‚æœå†…å­˜é¡µå¾ˆå°‘ä½¿ç”¨ï¼Œåˆ™å†™å…¥äº¤æ¢åŒº</li><li>ç®¡ç†å»¶æ—¶åŠ¨ä½œ,ã€€å¦‚ï¼’å·è¿›ç¨‹æ¥æ‰‹å†…æ ¸è¿›ç¨‹çš„åˆ›å»º</li><li>å®ç°æ–‡ä»¶ç³»ç»Ÿçš„äº‹åŠ¡æ—¥å¿—</li></ul><p>å†…æ ¸çº¿ç¨‹ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼š</p><ol><li><p>çº¿ç¨‹å¯åŠ¨åä¸€ç›´ç­‰å¾…ï¼Œç›´è‡³å†…æ ¸è¯·æ±‚çº¿ç¨‹æ‰§è¡ŒæŸä¸€ç‰¹å®šæ“ä½œã€‚</p></li><li><p>çº¿ç¨‹å¯åŠ¨åæŒ‰å‘¨æœŸæ€§é—´éš”è¿è¡Œï¼Œæ£€æµ‹ç‰¹å®šèµ„æºçš„ä½¿ç”¨ï¼Œåœ¨ç”¨é‡è¶…å‡ºæˆ–ä½äºé¢„ç½®çš„é™åˆ¶æ—¶é‡‡å–è¡ŒåŠ¨ã€‚</p></li></ol><p>å†…æ ¸çº¿ç¨‹ç”±å†…æ ¸è‡ªèº«ç”Ÿæˆï¼Œå…¶ç‰¹ç‚¹åœ¨äº</p><ol><li>å®ƒä»¬åœ¨CPUçš„ç®¡æ€æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç”¨æˆ·æ€ã€‚</li><li>å®ƒä»¬åªå¯ä»¥è®¿é—®è™šæ‹Ÿåœ°å€ç©ºé—´çš„å†…æ ¸éƒ¨åˆ†ï¼ˆé«˜äºTASK_SIZEçš„æ‰€æœ‰åœ°å€ï¼‰ï¼Œä½†ä¸èƒ½è®¿é—®ç”¨æˆ·ç©ºé—´</li></ol><p>ç³»ç»Ÿåœ¨æ­£å¼å¯åŠ¨å†…æ ¸æ—¶ï¼Œä¼šæ‰§è¡Œ <code>start_kernel</code> å‡½æ•°ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œåä¸º <code>init_task</code>ã€‚å…¶ PID ä¸º 0ï¼Œè¿è¡Œåœ¨å†…æ ¸æ€ä¸­ã€‚ç„¶åå¼€å§‹æ‰§è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–ã€‚</p><h3 id="init-å†…æ ¸çº¿ç¨‹"><a href="#init-å†…æ ¸çº¿ç¨‹" class="headerlink" title="init å†…æ ¸çº¿ç¨‹"></a>init å†…æ ¸çº¿ç¨‹</h3><p><code>init_task</code> åœ¨æ‰§è¡Œ <code>rest_init</code> å‡½æ•°æ—¶ï¼Œä¼šæ‰§è¡Œ <code>kernel_thread</code> åˆ›å»º <code>init</code> å†…æ ¸çº¿ç¨‹ã€‚å®ƒçš„ PID ä¸º 1ï¼Œç”¨æ¥å®Œæˆå†…æ ¸ç©ºé—´åˆå§‹åŒ–ã€‚</p><p>åœ¨å†…æ ¸ç©ºé—´å®Œæˆåˆå§‹åŒ–åï¼Œä¼šè°ƒç”¨ <code>exceve</code> æ‰§è¡Œ init å¯æ‰§è¡Œç¨‹åº (/sbin/init)ã€‚ä¹‹åï¼Œinit å†…æ ¸çº¿ç¨‹å˜æˆäº†ä¸€ä¸ªæ™®é€šçš„è¿›ç¨‹ï¼Œè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ä¸­ã€‚</p><blockquote><p>init å†…æ ¸çº¿ç¨‹æ²¡æœ‰åœ°å€ç©ºé—´ï¼Œä¸”å®ƒçš„ task_struct å¯¹è±¡ä¸­çš„ mm ä¸º NULLã€‚å› æ­¤ï¼Œæ‰§è¡Œ exceve ä¼šä½¿è¿™ä¸ª mm æŒ‡å‘ä¸€ä¸ª mm_structï¼Œè€Œä¸ä¼šå½±å“åˆ° init_task è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚ ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œinit åœ¨è½¬å˜ä¸ºè¿›ç¨‹åï¼Œå…¶ PID æ²¡å˜ï¼Œä»ä¸º 1ã€‚</p></blockquote><p>åˆ›å»ºå®Œ init å†…æ ¸çº¿ç¨‹åï¼Œ<code>init_task</code> è¿›ç¨‹æ¼”å˜ä¸º idle è¿›ç¨‹ï¼ˆPID ä»ä¸º 0ï¼‰ã€‚</p><p>ä¹‹åï¼Œinit è¿›ç¨‹å†æ ¹æ®å†å¯åŠ¨å…¶å®ƒç³»ç»Ÿè¿›ç¨‹ (/etc/init.d ç›®å½•ä¸‹çš„å„ä¸ªå¯æ‰§è¡Œæ–‡ä»¶)ã€‚</p><h3 id="kthreadd-å†…æ ¸çº¿ç¨‹"><a href="#kthreadd-å†…æ ¸çº¿ç¨‹" class="headerlink" title="kthreadd å†…æ ¸çº¿ç¨‹"></a>kthreadd å†…æ ¸çº¿ç¨‹</h3><p><code>init_task</code> è¿›ç¨‹æ¼”å˜ä¸º idle è¿›ç¨‹åï¼Œidle è¿›ç¨‹ä¼šæ‰§è¡Œ <code>kernel_thread</code> æ¥åˆ›å»º <code>kthreadd</code> å†…æ ¸çº¿ç¨‹ï¼ˆä»ç„¶åœ¨ <code>rest_init</code> å‡½æ•°ä¸­ï¼‰ã€‚å®ƒçš„ PID ä¸º 2ï¼Œç”¨æ¥åˆ›å»ºå¹¶ç®¡ç†å…¶å®ƒå†…æ ¸çº¿ç¨‹ï¼ˆç”¨ <code>kthread_create</code>, <code>kthread_run</code>, <code>kthread_stop</code> ç­‰å†…æ ¸å‡½æ•°ï¼‰ã€‚</p><p>ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šå†…æ ¸å®ˆæŠ¤è¿›ç¨‹ (çº¿ç¨‹)ï¼Œå¯ä»¥é€šè¿‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -efj</span><br></pre></td></tr></table></figure><p>è¿›è¡ŒæŸ¥çœ‹ï¼Œå…¶ä¸­å¸¦æœ‰ [] å·çš„å°±å±äºå†…æ ¸å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒä»¬çš„ç¥–å…ˆéƒ½æ˜¯è¿™ä¸ª kthreadd å†…æ ¸çº¿ç¨‹ã€‚</p><h3 id="ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•"><a href="#ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•" class="headerlink" title="ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•"></a>ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•</h3><p>å†…æ ¸ç»´æŒç€ä¸€ç»„è‡ªå·±ä½¿ç”¨çš„é¡µè¡¨ï¼Œä¹Ÿå³ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•ã€‚å½“å†…æ ¸åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œå…¶å­˜æ”¾åœ¨ <code>swapper_pg_dir</code> ä¸­ï¼Œè€Œä¸”æ‰€æœ‰çš„æ™®é€šè¿›ç¨‹å’Œå†…æ ¸çº¿ç¨‹å°±ä¸å†ä½¿ç”¨å®ƒäº†ã€‚</p><h3 id="å†…æ ¸çº¿ç¨‹è®¿é—®é¡µè¡¨"><a href="#å†…æ ¸çº¿ç¨‹è®¿é—®é¡µè¡¨" class="headerlink" title="å†…æ ¸çº¿ç¨‹è®¿é—®é¡µè¡¨"></a>å†…æ ¸çº¿ç¨‹è®¿é—®é¡µè¡¨</h3><h4 id="active-mm"><a href="#active-mm" class="headerlink" title="active_mm"></a>active_mm</h4><p>å¯¹äºå†…æ ¸çº¿ç¨‹ï¼Œè™½ç„¶å®ƒçš„ <code>task_struct</code> ä¸­çš„ mm ä¸º NULLï¼Œä½†æ˜¯å®ƒä»ç„¶éœ€è¦è®¿é—®å†…æ ¸ç©ºé—´ï¼Œå› æ­¤éœ€è¦çŸ¥é“å…³äºå†…æ ¸ç©ºé—´æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„é¡µè¡¨ã€‚ç„¶è€Œä¸å†ä½¿ç”¨ <code>swapper_pg_dir</code>ï¼Œå› æ­¤åªèƒ½å¦å¤–æƒ³æ³•è§£å†³ã€‚</p><p>ç”±äºæ‰€æœ‰çš„æ™®é€šè¿›ç¨‹çš„é¡µå…¨å±€ç›®å½•ä¸­çš„åé¢éƒ¨åˆ†ä¸ºä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•ï¼Œå› æ­¤å†…æ ¸çº¿ç¨‹åªéœ€è¦ä½¿ç”¨æŸä¸ªæ™®é€šè¿›ç¨‹çš„é¡µå…¨å±€ç›®å½•å°±å¯ä»¥äº†ã€‚</p><p>åœ¨ Linux ä¸­ï¼Œ<code>task_struct</code> ä¸­è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å…ƒç´ ä¸º <code>active_mm</code>ï¼Œå®ƒä¸»è¦å°±æ˜¯ç”¨äºå†…æ ¸çº¿ç¨‹è®¿é—®ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•ã€‚</p><p>å¯¹äºæ™®é€šè¿›ç¨‹æ¥è¯´ï¼Œ<code>task_struct</code> ä¸­çš„ <code>mm</code> å’Œ <code>active_mm</code> æŒ‡å‘çš„æ˜¯åŒä¸€ç‰‡åŒºåŸŸï¼› ç„¶è€Œå¯¹å†…æ ¸çº¿ç¨‹æ¥è¯´ï¼Œ<code>task_struct</code> ä¸­çš„ mm ä¸º NULLï¼Œ<code>active_mm</code> æŒ‡å‘çš„æ˜¯å‰ä¸€ä¸ªæ™®é€šè¿›ç¨‹çš„ <code>mm_struct</code> å¯¹è±¡ã€‚</p><h4 id="mm-users-mm-count"><a href="#mm-users-mm-count" class="headerlink" title="mm_users/mm_count"></a>mm_users/mm_count</h4><p>ä½†æ˜¯è¿™æ ·è¿˜æ˜¯ä¸è¡Œï¼Œå› ä¸ºå¦‚æœå› ä¸ºå‰ä¸€ä¸ªæ™®é€šè¿›ç¨‹é€€å‡ºäº†è€Œå¯¼è‡´å®ƒçš„ <code>mm_struct</code> å¯¹è±¡ä¹Ÿè¢«é‡Šæ”¾äº†ï¼Œåˆ™å†…æ ¸çº¿ç¨‹å°±è®¿é—®ä¸åˆ°äº†ã€‚</p><p>ä¸ºæ­¤ï¼Œ<code>mm_struct</code> å¯¹è±¡ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ <code>mm_count</code>ï¼Œä¸“é—¨ç”¨æ¥å¯¹å¼•ç”¨è¿™ä¸ª <code>mm_struct</code> å¯¹è±¡çš„è‡ªèº«åŠå†…æ ¸çº¿ç¨‹è¿›è¡Œè®¡æ•°ã€‚åˆå§‹æ—¶ä¸º 1ï¼Œè¡¨ç¤ºæ™®é€šè¿›ç¨‹æœ¬èº«å¼•ç”¨äº†å®ƒè‡ªå·±çš„ <code>mm_struct</code> å¯¹è±¡ã€‚åªæœ‰å½“è¿™ä¸ªå¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œæ‰ä¼šçœŸæ­£é‡Šæ”¾è¿™ä¸ª <code>mm_struct</code> å¯¹è±¡ã€‚</p><p>å¦å¤–ï¼Œ<code>mm_struct</code> ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ª <code>mm_users</code> è®¡æ•°å™¨ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥å¯¹å…±äº«åœ°å€ç©ºé—´çš„çº¿ç¨‹è®¡æ•°ã€‚äº‹å®ä¸Šï¼Œå°±æ˜¯è¿™ä¸ªä¸»çº¿ç¨‹æ‰€åœ¨çº¿ç¨‹ç»„ä¸­çº¿ç¨‹çš„æ€»ä¸ªæ•°ã€‚åˆå§‹æ—¶ä¸º 1ã€‚</p><h2 id="å†…æ ¸çº¿ç¨‹çš„é€€å‡º"><a href="#å†…æ ¸çº¿ç¨‹çš„é€€å‡º" class="headerlink" title="å†…æ ¸çº¿ç¨‹çš„é€€å‡º"></a>å†…æ ¸çº¿ç¨‹çš„é€€å‡º</h2><p>çº¿ç¨‹ä¸€æ—¦å¯åŠ¨èµ·æ¥åï¼Œä¼šä¸€ç›´è¿è¡Œï¼Œé™¤éè¯¥çº¿ç¨‹ä¸»åŠ¨è°ƒç”¨<code>do_exit</code>å‡½æ•°ï¼Œæˆ–è€…å…¶ä»–çš„è¿›ç¨‹è°ƒç”¨<code>kthread_stop</code>å‡½æ•°ï¼Œç»“æŸçº¿ç¨‹çš„è¿è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kthread_stop</span><span class="params">(struct task_struct *thread)</span></span>;</span><br></pre></td></tr></table></figure><p><code>kthread_stop()</code> é€šè¿‡å‘é€ä¿¡å·ç»™çº¿ç¨‹ã€‚</p><p>å¦‚æœçº¿ç¨‹å‡½æ•°æ­£åœ¨å¤„ç†ä¸€ä¸ªéå¸¸é‡è¦çš„ä»»åŠ¡ï¼Œå®ƒä¸ä¼šè¢«ä¸­æ–­çš„ã€‚å½“ç„¶å¦‚æœçº¿ç¨‹å‡½æ•°æ°¸è¿œä¸è¿”å›å¹¶ä¸”ä¸æ£€æŸ¥ä¿¡å·ï¼Œå®ƒå°†æ°¸è¿œéƒ½ä¸ä¼šåœæ­¢ã€‚</p><p>åœ¨æ‰§è¡Œ<code>kthread_stop</code>çš„æ—¶å€™ï¼Œç›®æ ‡çº¿ç¨‹å¿…é¡»æ²¡æœ‰é€€å‡ºï¼Œå¦åˆ™ä¼šOopsã€‚åŸå› å¾ˆå®¹æ˜“ç†è§£ï¼Œå½“ç›®æ ‡çº¿ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå…¶å¯¹åº”çš„<code>task</code>ç»“æ„ä¹Ÿå˜å¾—æ— æ•ˆï¼Œ<code>kthread_stop</code>å¼•ç”¨è¯¥æ— æ•ˆtaskç»“æ„å°±ä¼šå‡ºé”™ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦ç¡®ä¿çº¿ç¨‹æ²¡æœ‰é€€å‡ºï¼Œå…¶æ–¹æ³•å¦‚ä»£ç ä¸­æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">thread_func()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// do your work here</span></span><br><span class="line">    <span class="comment">// wait to exit</span></span><br><span class="line">    <span class="keyword">while</span>(!thread_could_stop())</span><br><span class="line">    &#123;</span><br><span class="line">           wait();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exit_code()</span><br><span class="line">&#123;</span><br><span class="line">     kthread_stop(_task);   <span class="comment">//å‘ä¿¡å·ç»™taskï¼Œé€šçŸ¥å…¶å¯ä»¥é€€å‡ºäº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§é€€å‡ºæœºåˆ¶å¾ˆæ¸©å’Œï¼Œä¸€åˆ‡å°½åœ¨<code>thread_func()</code>çš„æŒæ§ä¹‹ä¸­ï¼Œçº¿ç¨‹åœ¨é€€å‡ºæ—¶å¯ä»¥ä»å®¹åœ°é‡Šæ”¾èµ„æºï¼Œè€Œä¸æ˜¯è«åå…¶å¦™åœ°è¢«äººâ€œæš—æ€â€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kå‡å€¼èšç±»ä¸pythonå®ç°</title>
      <link href="/2017/09/01/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8BK%E5%9D%87%E5%80%BC%E8%81%9A%E7%B1%BB/"/>
      <url>/2017/09/01/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8BK%E5%9D%87%E5%80%BC%E8%81%9A%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>K-meansç®—æ³•é‡‡ç”¨è·ç¦»ä½œä¸ºç›¸ä¼¼æ€§çš„è¯„ä»·æŒ‡æ ‡ï¼Œå³è®¤ä¸ºä¸¤ä¸ªå¯¹è±¡çš„è·ç¦»è¶Šè¿‘ï¼Œå…¶ç›¸ä¼¼åº¦å°±è¶Šå¤§ï¼Œæ˜¯å¾ˆå…¸å‹çš„åŸºäºè·ç¦»çš„èšç±»ç®—æ³•ã€‚è¯¥ç®—æ³•è®¤ä¸ºç°‡æ˜¯ç”±è·ç¦»é è¿‘çš„å¯¹è±¡ç»„æˆçš„ï¼Œå› æ­¤æŠŠå¾—åˆ°ç´§å‡‘ä¸”ç‹¬ç«‹çš„ç°‡ä½œä¸ºæœ€ç»ˆç›®æ ‡ã€‚</p><a id="more"></a><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p>ç®—æ³•æ­¥éª¤ï¼š</p><ul><li>åˆ›å»ºkä¸ªç‚¹ä½œä¸ºèµ·å§‹æ”¯ç‚¹(éšæœºé€‰æ‹©)</li><li>å½“ä»»æ„ä¸€ä¸ªç°‡çš„åˆ†é…ç»“æœå‘ç”Ÿæ”¹å˜çš„æ—¶å€™</li><li>å¯¹æ•°æ®é›†çš„æ¯ä¸ªæ•°æ®ç‚¹<ul><li>å¯¹æ¯ä¸ªè´¨å¿ƒ<ul><li>è®¡ç®—è´¨å¿ƒä¸æ•°æ®ç‚¹ä¹‹é—´çš„è·ç¦»</li></ul></li><li>å°†æ•°æ®åˆ†é…åˆ°è·ç¦»å…¶æœ€è¿‘çš„ç°‡</li></ul></li><li>å¯¹æ¯ä¸€ç°‡ï¼Œè®¡ç®—ç°‡ä¸­æ‰€æœ‰ç‚¹çš„å‡å€¼å¹¶å°†å…¶å‡å€¼ä½œä¸ºè´¨å¿ƒ</li></ul><p>kä¸ªåˆå§‹ç±»èšç±»ä¸­å¿ƒç‚¹çš„é€‰å–å¯¹èšç±»ç»“æœå…·æœ‰è¾ƒå¤§çš„å½±å“ï¼Œå› ä¸ºåœ¨è¯¥ç®—æ³•ç¬¬ä¸€æ­¥ä¸­æ˜¯éšæœºçš„é€‰å–ä»»æ„kä¸ªå¯¹è±¡ä½œä¸ºåˆå§‹èšç±»çš„ä¸­å¿ƒï¼Œåˆå§‹åœ°ä»£è¡¨ä¸€ä¸ªç°‡ã€‚è¯¥ç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­å¯¹æ•°æ®é›†ä¸­å‰©ä½™çš„æ¯ä¸ªå¯¹è±¡ï¼Œæ ¹æ®å…¶ä¸å„ä¸ªç°‡ä¸­å¿ƒçš„è·ç¦»å°†æ¯ä¸ªå¯¹è±¡é‡æ–°èµ‹ç»™æœ€è¿‘çš„ç°‡ã€‚å½“è€ƒå¯Ÿå®Œæ‰€æœ‰æ•°æ®å¯¹è±¡åï¼Œä¸€æ¬¡è¿­ä»£è¿ç®—å®Œæˆï¼Œæ–°çš„èšç±»ä¸­å¿ƒè¢«è®¡ç®—å‡ºæ¥ã€‚å¦‚æœåœ¨ä¸€æ¬¡è¿­ä»£å‰åï¼ŒJçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¯´æ˜ç®—æ³•å·²ç»æ”¶æ•›ã€‚</p><h2 id="æµ‹è¯•æ•°æ®é›†"><a href="#æµ‹è¯•æ•°æ®é›†" class="headerlink" title="æµ‹è¯•æ•°æ®é›†"></a>æµ‹è¯•æ•°æ®é›†</h2><p>é¦–å…ˆä» <code>sklearn</code> å¯¼å…¥æ•°æ®é›†ã€‚æˆ‘ä»¬ç”¨éå¸¸è‘—åçš„ <code>iris</code> æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">iris = datasets.load_iris()</span><br><span class="line">X, y = iris.data, iris.target</span><br><span class="line"></span><br><span class="line">data = X[:,[<span class="number">1</span>,<span class="number">3</span>]] <span class="comment"># ä¸ºäº†ä¾¿äºå¯è§†åŒ–ï¼Œåªå–ä¸¤ä¸ªç»´åº¦</span></span><br><span class="line">plt.scatter(data[:,<span class="number">0</span>],data[:,<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><h2 id="æ¬§å¼è·ç¦»"><a href="#æ¬§å¼è·ç¦»" class="headerlink" title="æ¬§å¼è·ç¦»"></a>æ¬§å¼è·ç¦»</h2><p>è®¡ç®—æ¬§å¼è·ç¦»ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªç‚¹æ‰¾åˆ°ç¦»å…¶æœ€è¿‘çš„è´¨å¿ƒï¼Œéœ€è¦ç”¨è¿™ä¸ªè¾…åŠ©å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">distance</span>(<span class="params">p1,p2</span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  Return Eclud distance between two points.</span></span><br><span class="line"><span class="string">  p1 = np.array([0,0]), p2 = np.array([1,1]) =&gt; 1.414</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  tmp = np.sum((p1-p2)**<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">return</span> np.sqrt(tmp)</span><br><span class="line"></span><br><span class="line">distance(np.array([<span class="number">0</span>,<span class="number">0</span>]),np.array([<span class="number">1</span>,<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.4142135623730951</span><br></pre></td></tr></table></figure><h2 id="éšæœºè´¨å¿ƒ"><a href="#éšæœºè´¨å¿ƒ" class="headerlink" title="éšæœºè´¨å¿ƒ"></a>éšæœºè´¨å¿ƒ</h2><p>åœ¨ç»™å®šæ•°æ®èŒƒå›´å†…éšæœºäº§ç”Ÿkä¸ªç°‡å¿ƒï¼Œä½œä¸ºåˆå§‹çš„ç°‡ã€‚éšæœºæ•°éƒ½åœ¨ç»™å®šæ•°æ®çš„èŒƒå›´ä¹‹å†… <code>dmin + (dmax - dmin) * np.random.rand(k)</code> å®ç°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rand_center</span>(<span class="params">data,k</span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;Generate k center within the range of data set.&quot;&quot;&quot;</span></span><br><span class="line">  n = data.shape[<span class="number">1</span>] <span class="comment"># features</span></span><br><span class="line">  centroids = np.zeros((k,n)) <span class="comment"># init with (0,0)....</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">    dmin, dmax = np.min(data[:,i]), np.max(data[:,i])</span><br><span class="line">    centroids[:,i] = dmin + (dmax - dmin) * np.random.rand(k)</span><br><span class="line">  <span class="keyword">return</span> centroids</span><br><span class="line"></span><br><span class="line">centroids = rand_center(data,<span class="number">2</span>)</span><br><span class="line">centroids</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array([[4.18354619, 2.3433686 ],[3.22403937, 0.17507507]])</span><br></pre></td></tr></table></figure><h2 id="kå‡å€¼èšç±»"><a href="#kå‡å€¼èšç±»" class="headerlink" title="kå‡å€¼èšç±»"></a>kå‡å€¼èšç±»</h2><p>è¿™ä¸ªåŸºæœ¬çš„ç®—æ³•åªéœ€è¦æ˜ç™½ä¸¤ç‚¹ã€‚</p><ul><li>ç»™å®šä¸€ç»„è´¨å¿ƒï¼Œåˆ™ç°‡æ›´æ–°ï¼Œæ‰€æœ‰çš„ç‚¹è¢«åˆ†é…åˆ°ç¦»å…¶æœ€è¿‘çš„è´¨å¿ƒä¸­ã€‚</li><li>ç»™å®škç°‡ï¼Œåˆ™è´¨å¿ƒæ›´æ–°ï¼Œæ‰€æœ‰çš„è´¨å¿ƒç”¨å…¶ç°‡çš„å‡å€¼æ›¿æ¢</li></ul><p>å½“ç°‡ä¸åœ¨æœ‰æ›´æ–°çš„æ—¶å€™ï¼Œè¿­ä»£åœæ­¢ã€‚å½“ç„¶kmeansæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯èƒ½é™·å…¥å±€éƒ¨æœ€å°å€¼ï¼Œæœ‰æ”¹è¿›çš„æ–¹æ³•ï¼Œæ¯”å¦‚äºŒåˆ†kå‡å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¤šè®¡ç®—å‡ æ¬¡ï¼Œå»æ•ˆæœå¥½çš„ç»“æœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kmeans</span>(<span class="params">data,k=<span class="number">2</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_distance</span>(<span class="params">p1,p2</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return Eclud distance between two points.</span></span><br><span class="line"><span class="string">    p1 = np.array([0,0]), p2 = np.array([1,1]) =&gt; 1.414</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    tmp = np.sum((p1-p2)**<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(tmp)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_rand_center</span>(<span class="params">data,k</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Generate k center within the range of data set.&quot;&quot;&quot;</span></span><br><span class="line">    n = data.shape[<span class="number">1</span>] <span class="comment"># features</span></span><br><span class="line">    centroids = np.zeros((k,n)) <span class="comment"># init with (0,0)....</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        dmin, dmax = np.min(data[:,i]), np.max(data[:,i])</span><br><span class="line">        centroids[:,i] = dmin + (dmax - dmin) * np.random.rand(k)</span><br><span class="line">    <span class="keyword">return</span> centroids</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_converged</span>(<span class="params">centroids1, centroids2</span>):</span></span><br><span class="line">    <span class="comment"># if centroids not changed, we say &#x27;converged&#x27;</span></span><br><span class="line">      set1 = set([tuple(c) <span class="keyword">for</span> c <span class="keyword">in</span> centroids1])</span><br><span class="line">      set2 = set([tuple(c) <span class="keyword">for</span> c <span class="keyword">in</span> centroids2])</span><br><span class="line">      <span class="keyword">return</span> (set1 == set2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  n = data.shape[<span class="number">0</span>] <span class="comment"># number of entries</span></span><br><span class="line">  centroids = _rand_center(data,k)</span><br><span class="line">  label = np.zeros(n,dtype=np.int) <span class="comment"># track the nearest centroid</span></span><br><span class="line">  assement = np.zeros(n) <span class="comment"># for the assement of our model</span></span><br><span class="line">  converged = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="keyword">not</span> converged:</span><br><span class="line">    old_centroids = np.copy(centroids)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">      <span class="comment"># determine the nearest centroid and track it with label</span></span><br><span class="line">      min_dist, min_index = np.inf, <span class="number">-1</span></span><br><span class="line">      <span class="keyword">for</span> j <span class="keyword">in</span> range(k):</span><br><span class="line">        dist = _distance(data[i],centroids[j])</span><br><span class="line">        <span class="keyword">if</span> dist &lt; min_dist:</span><br><span class="line">          min_dist, min_index = dist, j</span><br><span class="line">          label[i] = j</span><br><span class="line">      assement[i] = _distance(data[i],centroids[label[i]])**<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># update centroid</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> range(k):</span><br><span class="line">      centroids[m] = np.mean(data[label==m],axis=<span class="number">0</span>)</span><br><span class="line">    converged = _converged(old_centroids,centroids)</span><br><span class="line">  <span class="keyword">return</span> centroids, label, np.sum(assement)</span><br></pre></td></tr></table></figure><p>ç”±äºç®—æ³•å¯èƒ½å±€éƒ¨æ”¶æ•›çš„é—®é¢˜ï¼Œéšæœºå¤šè¿è¡Œå‡ æ¬¡ï¼Œå–æœ€ä¼˜å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">best_assement = np.inf</span><br><span class="line">best_centroids = <span class="literal">None</span></span><br><span class="line">best_label = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">  centroids, label, assement = kmeans(data,<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">if</span> assement &lt; best_assement:</span><br><span class="line">    best_assement = assement</span><br><span class="line">    best_centroids = centroids</span><br><span class="line">    best_label = label</span><br><span class="line"></span><br><span class="line">data0 = data[best_label==<span class="number">0</span>]</span><br><span class="line">data1 = data[best_label==<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æŠŠæ•°æ®åˆ†ä¸ºä¸¤ç°‡ï¼Œç»¿è‰²çš„ç‚¹æ˜¯æ¯ä¸ªç°‡çš„è´¨å¿ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fig, (ax1,ax2) = plt.subplots(<span class="number">1</span>,<span class="number">2</span>,figsize=(<span class="number">12</span>,<span class="number">5</span>))</span><br><span class="line">ax1.scatter(data[:,<span class="number">0</span>],data[:,<span class="number">1</span>],c=<span class="string">&#x27;c&#x27;</span>,s=<span class="number">30</span>,marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">ax2.scatter(data0[:,<span class="number">0</span>],data0[:,<span class="number">1</span>],c=<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">ax2.scatter(data1[:,<span class="number">0</span>],data1[:,<span class="number">1</span>],c=<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">ax2.scatter(centroids[:,<span class="number">0</span>],centroids[:,<span class="number">1</span>],c=<span class="string">&#x27;b&#x27;</span>,s=<span class="number">120</span>,marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><a href="http://mitscherlich.me/assets/k-means/output.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/k-means/output.png" alt="img"></a></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¸©å‘è®°ä¹‹zshä¸å…¼å®¹é€šé…ç¬¦æŸ¥æ‰¾</title>
      <link href="/2017/09/01/Linux/%E8%B8%A9%E5%9D%91%E8%AE%B0%E4%B9%8Bzsh%E4%B8%8D%E5%85%BC%E5%AE%B9%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E6%89%BE/"/>
      <url>/2017/09/01/Linux/%E8%B8%A9%E5%9D%91%E8%AE%B0%E4%B9%8Bzsh%E4%B8%8D%E5%85%BC%E5%AE%B9%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E6%89%BE/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ˜¯åœ¨è¿›è¡Œcertboté€šé…ç¬¦sslè¯ä¹¦ç”³è¯·æ—¶å€™å‘ç”Ÿçš„å‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly --nginx --preferred-challenges dns --manual  -d *.maywzh.com --server https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line">zsh: no matches found: *.maywzh.com</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åæ¥å‘ç°ï¼Œåœ¨ zsh ä¸‹ä½¿ç”¨ find å‘½ä»¤æŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰å¤´æ–‡ä»¶æ—¶ä¹Ÿå‡ºç°é—®é¢˜ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">find</span> . <span class="selector-tag">-name</span> *<span class="selector-class">.h</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">no</span> <span class="selector-tag">matches</span> <span class="selector-tag">found</span>: *<span class="selector-class">.h</span></span><br></pre></td></tr></table></figure><p>åæ¥æŸ¥çœ‹äº†ä¸€äº›èµ„æ–™æ‰çŸ¥é“ï¼Œè¿™æ˜¯ç”±äºzshå¯¼è‡´çš„ã€‚</p><a id="more"></a><p>å…·ä½“åŸå› ï¼š</p><p>å› ä¸ºzshç¼ºçœæƒ…å†µä¸‹å§‹ç»ˆè‡ªå·±è§£é‡Šè¿™ä¸ª *.hï¼Œè€Œä¸ä¼šä¼ é€’ç»™ find æ¥è§£é‡Šã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><p>åœ¨~/.zshrcä¸­åŠ å…¥:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setopt</span> no_nomatch</span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>ç„¶åæ¢å¤æ­£å¸¸</p>]]></content>
      
      
      <categories>
          
          <category> å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zsh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸»å®šç†è®¡ç®—æ—¶é—´å¤æ‚åº¦</title>
      <link href="/2017/08/31/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E4%B9%8B%E4%B8%BB%E5%AE%9A%E7%90%86%E8%AE%A1%E7%AE%97%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/"/>
      <url>/2017/08/31/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E4%B9%8B%E4%B8%BB%E5%AE%9A%E7%90%86%E8%AE%A1%E7%AE%97%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç®—æ³•å¯¼è®ºä¸­ï¼Œä¸»å®šç†å¯ä»¥ç”¨æ¥è®¡ç®—é€’å½’è°ƒç”¨çš„æ—¶é—´å¤æ‚åº¦ï¼Œåœ¨è¿™é‡Œç»™å‡ºä¸»å®šç†çš„è¯æ˜å’Œå‡ ä¸ªå®ä¾‹ã€‚</p><a id="more"></a><h2 id="ä¸»å®šç†"><a href="#ä¸»å®šç†" class="headerlink" title="ä¸»å®šç†"></a>ä¸»å®šç†</h2><h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>ä¸€ä¸ªè§„æ¨¡ä¸º$n$çš„é—®é¢˜é€šè¿‡åˆ†æ²»ï¼Œå¾—åˆ°$a$ä¸ªè§„æ¨¡ä¸º$n/b$çš„é—®é¢˜ï¼Œæ¯æ¬¡é€’å½’å¸¦æ¥çš„é¢å¤–è®¡ç®—ä¸º$c(n^d)$ï¼Œåˆ™$T(n)\leq aT(n/b)+c(n^d)$</p><p>é—®é¢˜çš„å¤æ‚åº¦ä¸º</p><script type="math/tex; mode=display">T(n)=\begin{equation}\left\{             \begin{array}{lr}              O(n^d log(n)) & a = b^d  \\             O(n^d ) & a < b^d\\             O(n^{log_b^a})) &  a > b^d             \end{array}\right.\end{equation}</script><h3 id="è¯æ˜"><a href="#è¯æ˜" class="headerlink" title="è¯æ˜"></a>è¯æ˜</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/08/31/ezxRJpByd1ZPHGC.png" alt="20140429185231062"></p><p>å¯è§ï¼Œæ¯æ¬¡é€’å½’æŠŠé—®é¢˜åˆ†ä¸ºaä¸ªè§„æ¨¡ä¸º$n/b$çš„å­é—®é¢˜ã€‚ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…±æœ‰$log_b^n+1$å±‚ï¼Œå¶å­èŠ‚ç‚¹æ•°ä¸º$a^{log_b^n}$ã€‚é‚£ä¹ˆï¼Œç¬¬jå±‚å…±æœ‰$a^j$ä¸ªå­é—®é¢˜ï¼Œæ¯ä¸ªé—®é¢˜è§„æ¨¡ä¸º$n/b^j$ï¼Œæ¯ä¸ªå­é—®é¢˜è¿ç®—é‡ä¸º$c\cdot(n/b^j)^d$éœ€è¦å®Œæˆçš„è®¡ç®—é‡ä¸è¶…è¿‡ï¼š</p><script type="math/tex; mode=display">a^j\cdot c\cdot (\frac{n}{b^j})^d = cn^d\cdot  (\frac{a}{b^d})^j</script><p>æ•´ä¸ªé—®é¢˜çš„è¿ç®—é‡</p><script type="math/tex; mode=display">Tot \leq cn^d\cdot \sum_{j=0}^{log_b^n}(\frac{a}{b^d})^j</script><h3 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h3><h3 id="äºŒåˆ†æœç´¢"><a href="#äºŒåˆ†æœç´¢" class="headerlink" title="äºŒåˆ†æœç´¢"></a>äºŒåˆ†æœç´¢</h3><p>æ¯æ¬¡è§„æ¨¡å‡åŠï¼Œå¹¶åªé€‰æ‹©ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ¥çš„é¢å¤–è®¡ç®—ä¸ºå¸¸æ•°çº§,åˆ™$a=1,b=2,d=0$</p><p>å¤æ‚åº¦ä¸º$O(n^0\cdot log(n))=O(log(n))$</p><h3 id="å¿«æ’"><a href="#å¿«æ’" class="headerlink" title="å¿«æ’"></a>å¿«æ’</h3><p>éšæœºé€‰æ‹©ä¸€ä¸ªé”šç‚¹ï¼Œåˆ’åˆ†æ˜¯å¦å¹³å‡å½±å“å¤æ‚åº¦</p><p>æ¯æ¬¡é—®é¢˜è§„æ¨¡å‡åŠï¼Œå¸¦æ¥é¢å¤–è®¡ç®—æ¬¡æ•°æ­£æ¯”äº$n$ï¼Œ$a=2,b=2,d=0$</p><p>å¤æ‚åº¦ä¸º$O(n^1\cdot log(n))=O(nlog(n))$</p><h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><p>æ•°æ®å‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ’åºï¼Œç„¶åä»¥$O(n)$çš„å¤æ‚åº¦å½’å¹¶ï¼Œç©ºé—´å¤æ‚åº¦ä¸º$O(n)$</p><p>æ¯æ¬¡é—®é¢˜è§„æ¨¡å‡åŠï¼Œå¸¦æ¥é¢å¤–è®¡ç®—æ¬¡æ•°æ­£æ¯”äº$n$ï¼Œ$a=2,b=2,d=0$</p><p>å¤æ‚åº¦ä¸º$O(n^1\cdot log(n))=O(nlog(n))$</p><h3 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h3><p>æœ€ä½ä½åˆ°æœ€é«˜ä½æŒ‰ä½æ’åº</p><p>æ¯æ¬¡é€’å½’é—®é¢˜è§„æ¨¡å˜ä¸ºåŸæ¥çš„1/10ï¼Œéœ€è¦æ±‚è§£10ä¸ªå­é—®é¢˜ï¼Œé¢å¤–è¿ç®—ä¸º$O(n)$ï¼Œ$a=10,b=10,d=1$</p><p>å¤æ‚åº¦$O(n^1\cdot log(n))=O(nlog(n))$</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> ç†è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹è¯¦è§£</title>
      <link href="/2017/08/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>/2017/08/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬çŸ¥é“ç½‘ç»œå±‚ï¼Œå¯ä»¥å®ç°ä¸¤ä¸ªä¸»æœºä¹‹é—´çš„é€šä¿¡ã€‚ä½†æ˜¯è¿™å¹¶ä¸å…·ä½“ï¼Œå› ä¸ºï¼ŒçœŸæ­£è¿›è¡Œé€šä¿¡çš„å®ä½“æ˜¯åœ¨ä¸»æœºä¸­çš„è¿›ç¨‹ï¼Œæ˜¯ä¸€ä¸ªä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹ä¸å¦å¤–ä¸€ä¸ªä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹åœ¨äº¤æ¢æ•°æ®ã€‚IPåè®®è™½ç„¶èƒ½æŠŠæ•°æ®æŠ¥æ–‡é€åˆ°ç›®çš„ä¸»æœºï¼Œä½†æ˜¯å¹¶æ²¡æœ‰äº¤ä»˜ç»™ä¸»æœºçš„å…·ä½“åº”ç”¨è¿›ç¨‹ã€‚è€Œç«¯åˆ°ç«¯çš„é€šä¿¡æ‰åº”è¯¥æ˜¯åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>UDPï¼Œåœ¨ä¼ é€æ•°æ®å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°çš„ä¸»æœºåœ¨æ”¶åˆ°UDPæŠ¥æ–‡åä¹Ÿä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚è™½ç„¶UDPä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†æ˜¯æ­£æ˜¯å› ä¸ºè¿™æ ·ï¼Œçœå»å’Œå¾ˆå¤šçš„å¼€é”€ï¼Œä½¿å¾—å®ƒçš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œæ¯”å¦‚ä¸€äº›å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„æœåŠ¡ï¼Œå°±å¸¸å¸¸ä½¿ç”¨çš„æ˜¯UDPã€‚å¯¹åº”çš„åº”ç”¨å±‚çš„åè®®ä¸»è¦æœ‰ DNS,TFTP,DHCP,SNMP,NFS ç­‰ã€‚</p><p>TCPï¼Œæä¾›é¢å‘è¿æ¥çš„æœåŠ¡ï¼Œåœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€å®Œæˆåè¦é‡Šæ”¾è¿æ¥ã€‚å› æ­¤TCPæ˜¯ä¸€ç§å¯é çš„çš„è¿è¾“æœåŠ¡ï¼Œä½†æ˜¯æ­£å› ä¸ºè¿™æ ·ï¼Œä¸å¯é¿å…çš„å¢åŠ äº†è®¸å¤šçš„å¼€é”€ï¼Œæ¯”å¦‚ç¡®è®¤ï¼Œæµé‡æ§åˆ¶ç­‰ã€‚å¯¹åº”çš„åº”ç”¨å±‚çš„åè®®ä¸»è¦æœ‰ SMTP,TELNET,HTTP,FTP ç­‰ã€‚</p><a id="more"></a><h2 id="å¸¸ç”¨çš„ç†ŸçŸ¥ç«¯å£å·"><a href="#å¸¸ç”¨çš„ç†ŸçŸ¥ç«¯å£å·" class="headerlink" title="å¸¸ç”¨çš„ç†ŸçŸ¥ç«¯å£å·"></a>å¸¸ç”¨çš„ç†ŸçŸ¥ç«¯å£å·</h2><div class="table-container"><table><thead><tr><th>åº”ç”¨ç¨‹åº</th><th>FTP</th><th>TFTP</th><th>TELNET</th><th>SMTP</th><th>DNS</th><th>HTTP</th><th>SSH</th><th>MYSQL</th></tr></thead><tbody><tr><td>ç†ŸçŸ¥ç«¯å£</td><td>21,20</td><td>69</td><td>23</td><td>25</td><td>53</td><td>80</td><td>22</td><td>3306</td></tr><tr><td>ä¼ è¾“å±‚åè®®</td><td>TCP</td><td>UDP</td><td>TCP</td><td>TCP</td><td>UDP</td><td>TCP</td><td>TCP</td><td>TCP</td></tr></tbody></table></div><h2 id="TCPçš„æ¦‚è¿°"><a href="#TCPçš„æ¦‚è¿°" class="headerlink" title="TCPçš„æ¦‚è¿°"></a>TCPçš„æ¦‚è¿°</h2><blockquote><p>TCPæŠŠè¿æ¥ä½œä¸ºæœ€åŸºæœ¬çš„å¯¹è±¡ï¼Œæ¯ä¸€æ¡TCPè¿æ¥éƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼Œè¿™ç§æ–­ç‚¹æˆ‘ä»¬å«ä½œå¥—æ¥å­—ï¼ˆsocketï¼‰ï¼Œå®ƒçš„å®šä¹‰ä¸ºç«¯å£å·æ‹¼æ¥åˆ°IPåœ°å€å³æ„æˆäº†å¥—æ¥å­—ï¼Œä¾‹å¦‚ï¼Œè‹¥IPåœ°å€ä¸º192.3.4.16 è€Œç«¯å£å·ä¸º80ï¼Œé‚£ä¹ˆå¾—åˆ°çš„å¥—æ¥å­—ä¸º192.3.4.16:80ã€‚</p></blockquote><h3 id="TCPæŠ¥æ–‡é¦–éƒ¨"><a href="#TCPæŠ¥æ–‡é¦–éƒ¨" class="headerlink" title="TCPæŠ¥æ–‡é¦–éƒ¨"></a>TCPæŠ¥æ–‡é¦–éƒ¨</h3><ol><li>æºç«¯å£å’Œç›®çš„ç«¯å£ï¼Œå„å 2ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«å†™å…¥æºç«¯å£å’Œç›®çš„ç«¯å£ï¼›</li><li>åºå·ï¼Œå 4ä¸ªå­—èŠ‚ï¼ŒTCPè¿æ¥ä¸­ä¼ é€çš„å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ã€‚ä¾‹å¦‚ï¼Œä¸€æ®µæŠ¥æ–‡çš„åºå·å­—æ®µå€¼æ˜¯ 301 ï¼Œè€Œæºå¸¦çš„æ•°æ®å…±æœ‰100å­—æ®µï¼Œæ˜¾ç„¶ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆå¦‚æœè¿˜æœ‰çš„è¯ï¼‰çš„æ•°æ®åºå·åº”è¯¥ä»401å¼€å§‹ï¼›</li><li>ç¡®è®¤å·ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œæ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·ã€‚ä¾‹å¦‚ï¼ŒBæ”¶åˆ°äº†Aå‘é€è¿‡æ¥çš„æŠ¥æ–‡ï¼Œå…¶åºåˆ—å·å­—æ®µæ˜¯501ï¼Œè€Œæ•°æ®é•¿åº¦æ˜¯200å­—èŠ‚ï¼Œè¿™è¡¨æ˜Bæ­£ç¡®çš„æ”¶åˆ°äº†Aå‘é€çš„åˆ°åºå·700ä¸ºæ­¢çš„æ•°æ®ã€‚å› æ­¤ï¼ŒBæœŸæœ›æ”¶åˆ°Açš„ä¸‹ä¸€ä¸ªæ•°æ®åºå·æ˜¯701ï¼Œäºæ˜¯Båœ¨å‘é€ç»™Açš„ç¡®è®¤æŠ¥æ–‡æ®µä¸­æŠŠç¡®è®¤å·ç½®ä¸º701ï¼›</li><li>æ•°æ®åç§»ï¼Œå 4ä½ï¼Œå®ƒæŒ‡å‡ºTCPæŠ¥æ–‡çš„æ•°æ®è·ç¦»TCPæŠ¥æ–‡æ®µçš„èµ·å§‹å¤„æœ‰å¤šè¿œï¼›</li><li>ä¿ç•™ï¼Œå 6ä½ï¼Œä¿ç•™ä»Šåä½¿ç”¨ï¼Œä½†ç›®å‰åº”éƒ½ä½0ï¼›</li><li>ç´§æ€¥URGï¼Œå½“URG=1ï¼Œè¡¨æ˜ç´§æ€¥æŒ‡é’ˆå­—æ®µæœ‰æ•ˆã€‚å‘Šè¯‰ç³»ç»Ÿæ­¤æŠ¥æ–‡æ®µä¸­æœ‰ç´§æ€¥æ•°æ®ï¼›</li><li>ç¡®è®¤ACKï¼Œä»…å½“ACK=1æ—¶ï¼Œç¡®è®¤å·å­—æ®µæ‰æœ‰æ•ˆã€‚TCPè§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰æŠ¥æ–‡çš„ä¼ è¾“éƒ½å¿…é¡»æŠŠACKç½®1ï¼›</li><li>æ¨é€PSHï¼Œå½“ä¸¤ä¸ªåº”ç”¨è¿›ç¨‹è¿›è¡Œäº¤äº’å¼é€šä¿¡æ—¶ï¼Œæœ‰æ—¶åœ¨ä¸€ç«¯çš„åº”ç”¨è¿›ç¨‹å¸Œæœ›åœ¨é”®å…¥ä¸€ä¸ªå‘½ä»¤åç«‹å³å°±èƒ½æ”¶åˆ°å¯¹æ–¹çš„å“åº”ï¼Œè¿™æ—¶å€™å°±å°†PSH=1ï¼›</li><li>å¤ä½RSTï¼Œå½“RST=1ï¼Œè¡¨æ˜TCPè¿æ¥ä¸­å‡ºç°ä¸¥é‡å·®é”™ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œç„¶åå†é‡æ–°å»ºç«‹è¿æ¥ï¼›</li><li>åŒæ­¥SYNï¼Œåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“SYN=1ï¼ŒACK=0ï¼Œè¡¨æ˜æ˜¯è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè‹¥åŒæ„è¿æ¥ï¼Œåˆ™å“åº”æŠ¥æ–‡ä¸­åº”è¯¥ä½¿SYN=1ï¼ŒACK=1ï¼›</li><li>ç»ˆæ­¢FINï¼Œç”¨æ¥é‡Šæ”¾è¿æ¥ã€‚å½“FIN=1ï¼Œè¡¨æ˜æ­¤æŠ¥æ–‡çš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶ä¸”è¦æ±‚é‡Šæ”¾ï¼›</li><li>çª—å£ï¼Œå 2å­—èŠ‚ï¼ŒæŒ‡çš„æ˜¯é€šçŸ¥æ¥æ”¶æ–¹ï¼Œå‘é€æœ¬æŠ¥æ–‡ä½ éœ€è¦æœ‰å¤šå¤§çš„ç©ºé—´æ¥æ¥å—ï¼›</li><li>æ£€éªŒå’Œï¼Œå 2å­—èŠ‚ï¼Œæ ¡éªŒé¦–éƒ¨å’Œæ•°æ®è¿™ä¸¤éƒ¨åˆ†ï¼›</li><li>ç´§æ€¥æŒ‡é’ˆï¼Œå 2å­—èŠ‚ï¼ŒæŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ï¼›</li><li>é€‰é¡¹ï¼Œé•¿åº¦å¯å˜ï¼Œå®šä¹‰ä¸€äº›å…¶ä»–çš„å¯é€‰çš„å‚æ•°ã€‚</li></ol><h3 id="TCPè¿æ¥çš„å»ºç«‹ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰"><a href="#TCPè¿æ¥çš„å»ºç«‹ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰" class="headerlink" title="TCPè¿æ¥çš„å»ºç«‹ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰"></a>TCPè¿æ¥çš„å»ºç«‹ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/CxKqBnRU8VfjmLv.gif" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>æœ€å¼€å§‹çš„æ—¶å€™å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ˜¯å¤„äºCLOSEDçŠ¶æ€ã€‚ä¸»åŠ¨æ‰“å¼€è¿æ¥çš„ä¸ºå®¢æˆ·ç«¯ï¼Œè¢«åŠ¨æ‰“å¼€è¿æ¥çš„æ˜¯æœåŠ¡å™¨ã€‚</p><ol><li>TCPæœåŠ¡å™¨è¿›ç¨‹å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œæ—¶åˆ»å‡†å¤‡æ¥å—å®¢æˆ·è¿›ç¨‹çš„è¿æ¥è¯·æ±‚ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±è¿›å…¥äº†LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼›</li><li>TCPå®¢æˆ·è¿›ç¨‹ä¹Ÿæ˜¯å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œç„¶åå‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ˜¯æŠ¥æ–‡é¦–éƒ¨ä¸­çš„åŒéƒ¨ä½SYN=1ï¼ŒåŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å· seq=x ï¼Œæ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚</li><li>TCPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™å‘å‡ºç¡®è®¤æŠ¥æ–‡ã€‚ç¡®è®¤æŠ¥æ–‡ä¸­åº”è¯¥ ACK=1ï¼ŒSYN=1ï¼Œç¡®è®¤å·æ˜¯ack=x+1ï¼ŒåŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· seq=yï¼Œæ­¤æ—¶ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†æ˜¯åŒæ ·è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</li><li>TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°ç¡®è®¤åï¼Œè¿˜è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼Œack=y+1ï¼Œè‡ªå·±çš„åºåˆ—å·seq=x+1ï¼Œæ­¤æ—¶ï¼ŒTCPè¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚</li><li>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤ååŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚<br><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/B9WVqO3DULcpQxJ.png" alt="ä¸‰æ¬¡æ¡æ‰‹"></li></ol><h3 id="TCPè¿æ¥çš„é‡Šæ”¾ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰"><a href="#TCPè¿æ¥çš„é‡Šæ”¾ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰" class="headerlink" title="TCPè¿æ¥çš„é‡Šæ”¾ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰"></a>TCPè¿æ¥çš„é‡Šæ”¾ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/MRzkwCVnKaGd94t.gif" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>æ•°æ®ä¼ è¾“å®Œæ¯•åï¼ŒåŒæ–¹éƒ½å¯é‡Šæ”¾è¿æ¥ã€‚æœ€å¼€å§‹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ˜¯å¤„äºESTABLISHEDçŠ¶æ€ï¼Œç„¶åå®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­ï¼ŒæœåŠ¡å™¨è¢«åŠ¨å…³é—­ã€‚</p><ol><li>å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚</li><li>æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—*âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚</li><li>æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚</li></ol><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/04/4jckDEF81C59HaX.png" alt="å››æ¬¡æŒ¥æ‰‹"></p><h2 id="ä¸€äº›å…¶ä»–é—®é¢˜"><a href="#ä¸€äº›å…¶ä»–é—®é¢˜" class="headerlink" title="ä¸€äº›å…¶ä»–é—®é¢˜"></a>ä¸€äº›å…¶ä»–é—®é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢ï¼Ÿ</h3><p>ä¸€å¥è¯ï¼Œä¸»è¦é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨ï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ã€‚</p><p>å¦‚æœä½¿ç”¨çš„æ˜¯ä¸¤æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œå®¢æˆ·ç«¯å‘é€äº†ç¬¬ä¸€ä¸ªè¯·æ±‚è¿æ¥å¹¶ä¸”æ²¡æœ‰ä¸¢å¤±ï¼Œåªæ˜¯å› ä¸ºåœ¨ç½‘ç»œç»“ç‚¹ä¸­æ»ç•™çš„æ—¶é—´å¤ªé•¿äº†ï¼Œç”±äºTCPçš„å®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ï¼Œä»¥ä¸ºæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ï¼Œæ­¤æ—¶é‡æ–°å‘æœåŠ¡å™¨å‘é€è¿™æ¡æŠ¥æ–‡ï¼Œæ­¤åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»è¿‡ä¸¤æ¬¡æ¡æ‰‹å®Œæˆè¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç„¶åå…³é—­è¿æ¥ã€‚æ­¤æ—¶æ­¤å‰æ»ç•™çš„é‚£ä¸€æ¬¡è¯·æ±‚è¿æ¥ï¼Œç½‘ç»œé€šç•…äº†åˆ°è¾¾äº†æœåŠ¡å™¨ï¼Œè¿™ä¸ªæŠ¥æ–‡æœ¬è¯¥æ˜¯å¤±æ•ˆçš„ï¼Œä½†æ˜¯ï¼Œä¸¤æ¬¡æ¡æ‰‹çš„æœºåˆ¶å°†ä¼šè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å†æ¬¡å»ºç«‹è¿æ¥ï¼Œè¿™å°†å¯¼è‡´ä¸å¿…è¦çš„é”™è¯¯å’Œèµ„æºçš„æµªè´¹ã€‚</p><p>å¦‚æœé‡‡ç”¨çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±ç®—æ˜¯é‚£ä¸€æ¬¡å¤±æ•ˆçš„æŠ¥æ–‡ä¼ é€è¿‡æ¥äº†ï¼ŒæœåŠ¡ç«¯æ¥å—åˆ°äº†é‚£æ¡å¤±æ•ˆæŠ¥æ–‡å¹¶ä¸”å›å¤äº†ç¡®è®¤æŠ¥æ–‡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¼šå†æ¬¡å‘å‡ºç¡®è®¤ã€‚ç”±äºæœåŠ¡å™¨æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¯·æ±‚è¿æ¥ã€‚</p><h3 id="ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾…2MSLï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾…2MSLï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾…2MSLï¼Ÿ"></a>ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾…2MSLï¼Ÿ</h3><p>MSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼ŒTCPå…è®¸ä¸åŒçš„å®ç°å¯ä»¥è®¾ç½®ä¸åŒçš„MSLå€¼ã€‚</p><p>ç¬¬ä¸€ï¼Œä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åä¸€ä¸ªACKæŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾æœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ªACKæŠ¥æ–‡å¯èƒ½ä¸¢å¤±ï¼Œç«™åœ¨æœåŠ¡å™¨çš„è§’åº¦çœ‹æ¥ï¼Œæˆ‘å·²ç»å‘é€äº†FIN+ACKæŠ¥æ–‡è¯·æ±‚æ–­å¼€äº†ï¼Œå®¢æˆ·ç«¯è¿˜æ²¡æœ‰ç»™æˆ‘å›åº”ï¼Œåº”è¯¥æ˜¯æˆ‘å‘é€çš„è¯·æ±‚æ–­å¼€æŠ¥æ–‡å®ƒæ²¡æœ‰æ”¶åˆ°ï¼Œäºæ˜¯æœåŠ¡å™¨åˆä¼šé‡æ–°å‘é€ä¸€æ¬¡ï¼Œè€Œå®¢æˆ·ç«¯å°±èƒ½åœ¨è¿™ä¸ª2MSLæ—¶é—´æ®µå†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„æŠ¥æ–‡ï¼Œæ¥ç€ç»™å‡ºå›åº”æŠ¥æ–‡ï¼Œå¹¶ä¸”ä¼šé‡å¯2MSLè®¡æ—¶å™¨ã€‚</p><p>ç¬¬äºŒï¼Œé˜²æ­¢ç±»ä¼¼ä¸â€œä¸‰æ¬¡æ¡æ‰‹â€ä¸­æåˆ°äº†çš„â€œå·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºç°åœ¨æœ¬è¿æ¥ä¸­ã€‚å®¢æˆ·ç«¯å‘é€å®Œæœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡åï¼Œåœ¨è¿™ä¸ª2MSLæ—¶é—´ä¸­ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·æ–°çš„è¿æ¥ä¸­ä¸ä¼šå‡ºç°æ—§è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</h3><p>å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚<br>è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚</p><h3 id="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ"><a href="#å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ"></a>å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ</h3><p>TCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’å‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP/IP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°JavaScriptä¸­çš„Promise</title>
      <link href="/2017/07/26/javascript/JavaScript%E4%B8%AD%E7%9A%84Promise/"/>
      <url>/2017/07/26/javascript/JavaScript%E4%B8%AD%E7%9A%84Promise/</url>
      
        <content type="html"><![CDATA[<p>Promiseç±»ä¼¼äºä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚Promise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><a id="more"></a><h2 id="â€œå›è°ƒåœ°ç‹±â€çš„è§£å†³æ–¹æ¡ˆ"><a href="#â€œå›è°ƒåœ°ç‹±â€çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="â€œå›è°ƒåœ°ç‹±â€çš„è§£å†³æ–¹æ¡ˆ"></a>â€œå›è°ƒåœ°ç‹±â€çš„è§£å†³æ–¹æ¡ˆ</h2><p>Promiseæ˜¯å¤„ç†å¼‚æ­¥ç¼–ç çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œåœ¨Promiseå‡ºç°ä»¥å‰ï¼Œå¼‚æ­¥ä»£ç çš„ç¼–å†™éƒ½æ˜¯é€šè¿‡å›è°ƒå‡½æ•°æ¥å¤„ç†çš„ï¼Œè™½ç„¶å•å±‚å›è°ƒä»£ç ç›¸å½“ç›´è§‚ï¼Œä½†å¤šæ¬¡å›è°ƒå°±æ˜¾å¾—æ¯”è¾ƒå¤æ‚ï¼Œè¢«ç§°ä¸º<strong>å›è°ƒåœ°ç‹±</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.readFile(<span class="string">&#x27;1.txt&#x27;</span>, <span class="function">(<span class="params">err,data</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(<span class="string">&#x27;2.txt&#x27;</span>, <span class="function">(<span class="params">err,data</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;3.txt&#x27;</span>, <span class="function">(<span class="params">err,data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//å¯èƒ½è¿˜æœ‰åç»­ä»£ç </span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç”±äºå›è°ƒä»£ç å¿…é¡»ä½œä¸ºå‚æ•°ä¼ é€’ç»™è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å‡ºç°è¿™ç§å›è°ƒç©¿æ’å›è°ƒçš„ä»£ç ï¼Œå¯è¯»æ€§ä¸é«˜ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†<code>Promise</code>å¯¹è±¡ï¼Œ<code>Promise</code>ä½œä¸ºä¸€ä¸ªå®¹å™¨ï¼Œæ¥å—ä¸€ä¸ªæœªæ¥ä¼šå‘ç”Ÿçš„äº‹ä»¶ã€‚å®ƒæœ‰ä¸‰ä¸ªçŠ¶æ€<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»<code>pending</code>å˜ä¸º<code>fulfilled</code>å’Œä»<code>pending</code>å˜ä¸º<code>rejected</code>ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹<code>Promise</code>å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</p><p><code>Promise</code>å¯¹è±¡æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ<code>resolve</code>å’Œ<code>reject</code>ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ç”±Promiseçš„å®ç°åº“æ¥æä¾›ã€‚<code>resolve</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» pending å˜ä¸º resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›<code>reject</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» pending å˜ä¸º rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å®ç°ä¸€ä¸ªPromise"><a href="#å®ç°ä¸€ä¸ªPromise" class="headerlink" title="å®ç°ä¸€ä¸ªPromise"></a>å®ç°ä¸€ä¸ªPromise</h2><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><p>ä¸ºäº†å®ç°Promiseï¼ŒPromiseå¯¹è±¡éœ€è¦ä¸€ä¸ªçŠ¶æ€æŒ‡ç¤ºå™¨<code>state</code>ï¼Œä¸€ä¸ª<code>value</code>ä»£è¡¨è¦ä¼ é€’çš„æ•°æ®ï¼Œä¸€ä¸ª<code>reason</code>ä»£è¡¨é”™è¯¯åŸå› ã€‚è¿˜æœ‰<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°ä½œä¸ºçŠ¶æ€è½¬æ¢å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.state = <span class="string">&#x27;pending&#x27;</span>; <span class="comment">//çŠ¶æ€</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span>; <span class="comment">//æˆåŠŸç»“æœ</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span>; <span class="comment">//å¤±è´¥åŸå› </span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">Promise</span>;</span><br></pre></td></tr></table></figure><h3 id="å®ç°æ‰§è¡Œå™¨å‡½æ•°executor"><a href="#å®ç°æ‰§è¡Œå™¨å‡½æ•°executor" class="headerlink" title="å®ç°æ‰§è¡Œå™¨å‡½æ•°executor"></a>å®ç°æ‰§è¡Œå™¨å‡½æ•°executor</h3><p>Promiseå¯¹è±¡å°±æ˜¯ä¸ºäº†ç«‹å³æ‰§è¡Œä¼ å…¥çš„executorï¼Œè¿™ä¸ªexecutorè¿”å›ä¸€ä¸ªå¼‚æ­¥ç»“æœã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;æ‰§è¡Œäº†&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ æ‰§è¡Œäº†</span></span><br></pre></td></tr></table></figure><p>å®ç°ç«‹å³æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.state = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    executor(resolve, reject); <span class="comment">//é©¬ä¸Šæ‰§è¡Œ</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°çŠ¶æ€æ›´æ–°å‡½æ•°resolveå’Œreject"><a href="#å®ç°çŠ¶æ€æ›´æ–°å‡½æ•°resolveå’Œreject" class="headerlink" title="å®ç°çŠ¶æ€æ›´æ–°å‡½æ•°resolveå’Œreject"></a>å®ç°çŠ¶æ€æ›´æ–°å‡½æ•°resolveå’Œreject</h3><p>åªæœ‰<code>pending</code>çŠ¶æ€æ‰å¯ä»¥æ›´æ–°ï¼Œ<code>resolve</code>å’Œ<code>reject</code>éœ€è¦å®ç°è¿™ä¸€ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//å½“çŠ¶æ€ä¸ºpendingæ—¶å†åšæ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (_this.state === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        _this.value = value;<span class="comment">//ä¿å­˜æˆåŠŸç»“æœ</span></span><br><span class="line">        _this.state = <span class="string">&#x27;resolved&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line"><span class="comment">//å½“çŠ¶æ€ä¸ºpendingæ—¶å†åšæ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (_this.state === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        _this.reason = reason;<span class="comment">//ä¿å­˜å¤±è´¥åŸå› </span></span><br><span class="line">        _this.state = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°thenæ–¹æ³•å’Œé“¾å¼è°ƒç”¨"><a href="#å®ç°thenæ–¹æ³•å’Œé“¾å¼è°ƒç”¨" class="headerlink" title="å®ç°thenæ–¹æ³•å’Œé“¾å¼è°ƒç”¨"></a>å®ç°thenæ–¹æ³•å’Œé“¾å¼è°ƒç”¨</h3><p><code>then</code>æ–¹æ³•ç”¨äºå¤„ç†å¼‚æ­¥è¿”å›ç»“æœï¼Œå®šä¹‰åœ¨<code>prototype</code>ä¸Šã€‚<code>then</code>éœ€è¦å®ç°çš„æ˜¯ï¼Œæ ¹æ®ä¸åŒçš„<code>Promise</code>çŠ¶æ€æ¥è¿›è¡Œä¸åŒçš„â€œå›è°ƒâ€æ“ä½œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;resolved&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å‚æ•°ç±»å‹ï¼Œæ˜¯å‡½æ•°æ‰§è¡Œä¹‹</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Promiseçš„é“¾å¼è°ƒç”¨çš„å…³é”®åœ¨äº<code>then</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥ç»§ç»­<code>then()</code>ï¼Œè§„èŒƒæœ‰</p><ol><li>æ¯ä¸ªthenæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼ˆ<strong>åŸç†çš„æ ¸å¿ƒ</strong>ï¼‰</li><li>å¦‚æœthenæ–¹æ³•ä¸­æ˜¾ç¤ºåœ°è¿”å›äº†ä¸€ä¸ªPromiseå¯¹è±¡å°±ä»¥æ­¤å¯¹è±¡ä¸ºå‡†ï¼Œè¿”å›å®ƒçš„ç»“æœ</li><li>å¦‚æœthenæ–¹æ³•ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªæ™®é€šå€¼ï¼ˆå¦‚Numberã€Stringç­‰ï¼‰å°±ä½¿ç”¨æ­¤å€¼åŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡è¿”å›ã€‚</li><li>å¦‚æœthenæ–¹æ³•ä¸­æ²¡æœ‰returnè¯­å¥ï¼Œå°±è§†ä¸ºè¿”å›ä¸€ä¸ªç”¨UndefinedåŒ…è£…çš„Promiseå¯¹è±¡</li><li>è‹¥thenæ–¹æ³•ä¸­å‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨å¤±è´¥æ€æ–¹æ³•ï¼ˆrejectï¼‰è·³è½¬åˆ°ä¸‹ä¸€ä¸ªthençš„onRejected</li><li>å¦‚æœthenæ–¹æ³•æ²¡æœ‰ä¼ å…¥ä»»ä½•å›è°ƒï¼Œåˆ™ç»§ç»­å‘ä¸‹ä¼ é€’ï¼ˆå€¼çš„ä¼ é€’ç‰¹æ€§ï¼‰ã€‚</li></ol><p>ç¬¬ä¸‰ç‚¹ï¼šå¦‚æœthenæ–¹æ³•ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªæ™®é€šå€¼ï¼ˆå¦‚Numberã€Stringç­‰ï¼‰å°±ä½¿ç”¨æ­¤å€¼åŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡è¿”å›ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p =<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>; <span class="comment">//è¿”å›ä¸€ä¸ªæ™®é€šå€¼</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">//è¾“å‡º2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç¬¬å››ç‚¹ï¼Œå¦‚æœthenæ–¹æ³•ä¸­æ²¡æœ‰returnè¯­å¥ï¼Œå°±è§†ä¸ºè¿”å›ä¸€ä¸ªç”¨UndefinedåŒ…è£…çš„Promiseå¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//æ²¡æœ‰returnè¯­å¥</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">//undefined</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç¬¬å…­ç‚¹ï¼Œå¦‚æœthenæ–¹æ³•æ²¡æœ‰ä¼ å…¥ä»»ä½•å›è°ƒï¼Œåˆ™ç»§ç»­å‘ä¸‹ä¼ é€’ï¼Œè¿™å°±æ˜¯Promiseä¸­å€¼çš„ç©¿é€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="number">2</span>)</span><br><span class="line">.then()</span><br><span class="line">.then()</span><br><span class="line">.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">//2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬ä¸€ä¸ªthenæ–¹æ³•ä¹‹åè¿ç»­è°ƒç”¨äº†ä¸¤ä¸ªç©ºçš„thenæ–¹æ³• ï¼Œæ²¡æœ‰ä¼ å…¥ä»»ä½•å›è°ƒå‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿”å›å€¼ï¼Œæ­¤æ—¶Promiseä¼šå°†å€¼ä¸€ç›´å‘ä¸‹ä¼ é€’ï¼Œç›´åˆ°æ¥æ”¶å¤„ç†å®ƒï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å€¼çš„ç©¿é€ã€‚</p><h3 id="å®ç°å¼‚æ­¥executoræ”¯æŒ"><a href="#å®ç°å¼‚æ­¥executoræ”¯æŒ" class="headerlink" title="å®ç°å¼‚æ­¥executoræ”¯æŒ"></a>å®ç°å¼‚æ­¥executoræ”¯æŒ</h3><p>è®¾æƒ³å¦‚æœ<code>executor</code>ä¸­åŒ…å«å¼‚æ­¥è¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="number">1</span>);</span><br><span class="line">    &#125;ï¼Œ<span class="number">500</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data)); <span class="comment">//æ— è¾“å‡º</span></span><br></pre></td></tr></table></figure><p>ä»£ç ä¸è¾“å‡ºä»»ä½•ç»“æœï¼ŒåŸå› æ˜¯<code>setTimeout</code>å‡½æ•°ä½¿å¾—<code>resolve</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæœ‰å»¶è¿Ÿï¼Œå½“è°ƒç”¨<code>then</code>æ–¹æ³•çš„æ—¶å€™ï¼Œæ­¤æ—¶æ­¤åˆ»çš„çŠ¶æ€è¿˜æ˜¯ç­‰å¾…æ€ï¼ˆpendingï¼‰ï¼Œå› æ­¤thenæ–¹æ³•å³æ²¡æœ‰è°ƒç”¨<code>onFulfilled</code>ä¹Ÿæ²¡æœ‰è°ƒç”¨<code>onRejected</code>ã€‚</p><p>éœ€è¦åšåˆ°çš„äº‹<code>then</code>æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå¦‚æœè¿˜åœ¨Promiseå¤„äºpendingçŠ¶æ€ï¼Œé‚£ä¹ˆæŠŠå›è°ƒå‡½æ•°pushåˆ°ä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ä¸­ï¼ŒçŠ¶æ€å‘ç”Ÿæ”¹å˜äº†å°±ä¾æ¬¡ä»è¯¥é˜Ÿåˆ—ä¸­å–å‡ºæ‰§è¡Œã€‚ç”¨Arrayæ¥å®ç°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.state = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFunc = [];<span class="comment">//æˆåŠŸå›è°ƒé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">this</span>.onRejectedFunc = [];<span class="comment">//å¤±è´¥å›è°ƒé˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">//å…¶å®ƒä»£ç ç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°<code>then</code>çš„å›è°ƒé˜Ÿåˆ—ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//ç­‰å¾…æ€ï¼Œæ­¤æ—¶å¼‚æ­¥ä»£ç è¿˜æ²¡æœ‰èµ°å®Œ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.onFulfilledFunc.push(onFulfilled);<span class="comment">//ä¿å­˜å›è°ƒ</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.onRejectedFunc.push(onRejected);<span class="comment">//ä¿å­˜å›è°ƒ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//çœç•¥...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯„å­˜å¥½äº†å›è°ƒï¼Œæ¥ä¸‹æ¥å°±æ˜¯å½“çŠ¶æ€æ”¹å˜æ—¶æ‰§è¡Œå°±å¥½äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_this.state === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        _this.value = value;</span><br><span class="line">        <span class="comment">//ä¾æ¬¡æ‰§è¡ŒæˆåŠŸå›è°ƒ</span></span><br><span class="line">        _this.onFulfilledFunc.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn(value));</span><br><span class="line">        _this.state = <span class="string">&#x27;resolved&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_this.state === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        _this.reason = reason;</span><br><span class="line">        <span class="comment">//ä¾æ¬¡æ‰§è¡Œå¤±è´¥å›è°ƒ</span></span><br><span class="line">        _this.onRejectedFunc.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn(reason));</span><br><span class="line">        _this.state = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒPromiseå·²ç»æ”¯æŒäº†å¼‚æ­¥æ“ä½œï¼ŒsetTimeoutå»¶è¿Ÿåä¹Ÿå¯æ­£ç¡®æ‰§è¡Œthenæ–¹æ³•è¿”å›ç»“æœã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>ææ¸…æ¥šäº†è¿™äº›ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ¨æ‰‹å®ç°thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨ï¼Œä¸€èµ·æ¥å®Œå–„å®ƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//ä»£ç ç•¥...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> promise2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œä¸è®ºä½•ç§æƒ…å†µthenéƒ½è¿”å›Promiseå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å®ä¾‹åŒ–ä¸€ä¸ªæ–°promise2å¹¶è¿”å›ã€‚</p><p>æ¥ä¸‹æ¥å°±å¤„ç†æ ¹æ®ä¸Šä¸€ä¸ªthenæ–¹æ³•çš„è¿”å›å€¼æ¥ç”Ÿæˆæ–°Promiseå¯¹è±¡ï¼Œç”±äºè¿™å—é€»è¾‘è¾ƒå¤æ‚ä¸”æœ‰å¾ˆå¤šå¤„è°ƒç”¨ï¼Œæˆ‘ä»¬æŠ½ç¦»å‡ºä¸€ä¸ªæ–¹æ³•æ¥æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯è§„èŒƒä¸­è¯´æ˜çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£æthenè¿”å›å€¼ä¸æ–°Promiseå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>promise2 æ–°çš„Promiseå¯¹è±¡ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>x ä¸Šä¸€ä¸ªthençš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>resolve promise2çš„resolve</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>reject promise2çš„reject</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>resolvePromise</code>æ–¹æ³•ç”¨æ¥å°è£…é“¾å¼è°ƒç”¨äº§ç”Ÿçš„ç»“æœï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä¸€ä¸ªä¸ªæƒ…å†µçš„å†™å‡ºå®ƒçš„é€»è¾‘ï¼Œé¦–å…ˆè§„èŒƒä¸­è¯´æ˜ï¼Œå¦‚æœ<code>promise2</code>å’Œ <code>x</code> æŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œå°±ä½¿ç”¨TypeErrorä½œä¸ºåŸå› è½¬ä¸ºå¤±è´¥ã€‚åŸæ–‡å¦‚ä¸‹ï¼š</p><blockquote><p>If promise and x refer to the same object, reject promise with a TypeError as the reason.</p></blockquote><p>è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå…¶å®å°±æ˜¯å¾ªç¯å¼•ç”¨ï¼Œå½“thençš„è¿”å›å€¼ä¸æ–°ç”Ÿæˆçš„Promiseå¯¹è±¡ä¸ºåŒä¸€ä¸ªï¼ˆå¼•ç”¨åœ°å€ç›¸åŒï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºTypeErroré”™è¯¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise2 = p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> promise2;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: Chaining cycle detected <span class="keyword">for</span> promise <span class="comment">#&lt;Promise&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœè¿”å›äº†è‡ªå·±çš„Promiseå¯¹è±¡ï¼ŒçŠ¶æ€æ°¸è¿œä¸ºç­‰å¾…æ€ï¼ˆpendingï¼‰ï¼Œå†ä¹Ÿæ— æ³•æˆä¸ºresolvedæˆ–æ˜¯rejectedï¼Œç¨‹åºä¼šæ­»æ‰ï¼Œå› æ­¤é¦–å…ˆè¦å¤„ç†å®ƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">        reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Promiseå‘ç”Ÿäº†å¾ªç¯å¼•ç”¨&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ†å„ç§æƒ…å†µå¤„ç†ã€‚å½“<code>x</code>å°±æ˜¯ä¸€ä¸ªPromiseï¼Œé‚£ä¹ˆå°±æ‰§è¡Œå®ƒï¼ŒæˆåŠŸå³æˆåŠŸï¼Œå¤±è´¥å³å¤±è´¥ã€‚è‹¥<code>x</code>æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ˜¯å‡½æ•°ï¼Œå†è¿›ä¸€æ­¥å¤„ç†å®ƒï¼Œå¦åˆ™å°±æ˜¯ä¸€ä¸ªæ™®é€šå€¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">        reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Promiseå‘ç”Ÿäº†å¾ªç¯å¼•ç”¨&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">//å¯èƒ½æ˜¯ä¸ªå¯¹è±¡æˆ–æ˜¯å‡½æ•°</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//å¦åˆ™æ˜¯ä¸ªæ™®é€šå€¼</span></span><br><span class="line">        resolve(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è§„èŒƒä¸­è¯´æ˜ï¼Œè‹¥æ˜¯ä¸ªå¯¹è±¡ï¼Œåˆ™å°è¯•å°†å¯¹è±¡ä¸Šçš„thenæ–¹æ³•å–å‡ºæ¥ï¼Œæ­¤æ—¶å¦‚æœæŠ¥é”™ï¼Œé‚£å°±å°†promise2è½¬ä¸ºå¤±è´¥æ€ã€‚åŸæ–‡ï¼š</p><blockquote><p>If retrieving the property x.then results in a thrown exception e, reject promise with e as the reason.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//ä»£ç ç•¥...</span></span><br><span class="line">    <span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">//å¯èƒ½æ˜¯ä¸ªå¯¹è±¡æˆ–æ˜¯å‡½æ•°</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> then = x.then;<span class="comment">//å–å‡ºthenæ–¹æ³•å¼•ç”¨</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//å¦åˆ™æ˜¯ä¸ªæ™®é€šå€¼</span></span><br><span class="line">        resolve(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šè¯´å‡ å¥ï¼Œä¸ºä»€ä¹ˆå–å¯¹è±¡ä¸Šçš„å±æ€§æœ‰æŠ¥é”™çš„å¯èƒ½ï¼ŸPromiseæœ‰å¾ˆå¤šå®ç°ï¼ˆbluebirdï¼ŒQç­‰ï¼‰ï¼ŒPromises/A+åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œå¤§å®¶éƒ½æŒ‰æ­¤è§„èŒƒæ¥å®ç°Promiseæ‰æœ‰å¯èƒ½é€šç”¨ï¼Œå› æ­¤æ‰€æœ‰å‡ºé”™çš„å¯èƒ½éƒ½è¦è€ƒè™‘åˆ°ï¼Œå‡è®¾å¦ä¸€ä¸ªäººå®ç°çš„Promiseå¯¹è±¡ä½¿ç”¨<code>Object.defineProperty()</code>æ¶æ„çš„åœ¨å–å€¼æ—¶æŠ›é”™ï¼Œæˆ‘ä»¬å¯ä»¥é˜²æ­¢ä»£ç å‡ºç°Bugã€‚</p><p>æ­¤æ—¶ï¼Œå¦‚æœå¯¹è±¡ä¸­æœ‰thenï¼Œä¸”thenæ˜¯å‡½æ•°ç±»å‹ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œä¹‹åï¼Œä½¿ç”¨<code>x</code>ä½œä¸ºthisæ¥è°ƒç”¨thenæ–¹æ³•ã€‚</p><blockquote><p>If then is a function, call it with x as this</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¶ä»–ä»£ç ç•¥...</span></span><br><span class="line"><span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//å¯èƒ½æ˜¯ä¸ªå¯¹è±¡æˆ–æ˜¯å‡½æ•°</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> then = x.then; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">//thenæ˜¯functionï¼Œé‚£ä¹ˆæ‰§è¡ŒPromise</span></span><br><span class="line">            then.call(x, <span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</span><br><span class="line">                resolve(y);</span><br><span class="line">            &#125;, <span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">                reject(r);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        reject(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//å¦åˆ™æ˜¯ä¸ªæ™®é€šå€¼</span></span><br><span class="line">    resolve(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·é“¾å¼å†™æ³•å°±åŸºæœ¬å®Œæˆäº†ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ç§æç«¯çš„æƒ…å†µï¼Œå¦‚æœPromiseå¯¹è±¡è½¬ä¸ºæˆåŠŸæ€æˆ–æ˜¯å¤±è´¥æ—¶ä¼ å…¥çš„è¿˜æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œæ­¤æ—¶åº”è¯¥ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°æœ€åçš„Promiseæ‰§è¡Œå®Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//resolveä¼ å…¥çš„è¿˜æ˜¯Promise</span></span><br><span class="line">        resolve(<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">            resolve(<span class="number">2</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å°±è¦ä½¿ç”¨é€’å½’æ“ä½œäº†ã€‚</p><p>è§„èŒƒä¸­åŸæ–‡å¦‚ä¸‹ï¼š</p><blockquote><p>If a promise is resolved with a thenable that participates in a circular thenable chain, such that the recursive nature of <a href="promise, thenable">[Resolve]</a> eventually causes <a href="promise, thenable">[Resolve]</a> to be called again, following the above algorithm will lead to infinite recursion. Implementations are encouraged, but not required, to detect such recursion and reject promise with an informative TypeError as the reason.</p></blockquote><p>å¾ˆç®€å•ï¼ŒæŠŠè°ƒç”¨resolveæ”¹å†™æˆé€’å½’æ‰§è¡ŒresolvePromiseæ–¹æ³•å³å¯ï¼Œè¿™æ ·ç›´åˆ°è§£æPromiseæˆä¸€ä¸ªæ™®é€šå€¼æ‰ä¼šç»ˆæ­¢ï¼Œå³å®Œæˆæ­¤è§„èŒƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¶ä»–ä»£ç ç•¥...</span></span><br><span class="line"><span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//å¯èƒ½æ˜¯ä¸ªå¯¹è±¡æˆ–æ˜¯å‡½æ•°</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> then = x.then; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> y = then.call(x, <span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">//é€’å½’è°ƒç”¨ï¼Œä¼ å…¥yè‹¥æ˜¯Promiseå¯¹è±¡ï¼Œç»§ç»­å¾ªç¯</span></span><br><span class="line">                resolvePromise(promise2, y, resolve, reject);</span><br><span class="line">            &#125;, <span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">                reject(r);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        reject(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//æ˜¯ä¸ªæ™®é€šå€¼ï¼Œæœ€ç»ˆç»“æŸé€’å½’</span></span><br><span class="line">    resolve(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œé“¾å¼è°ƒç”¨çš„ä»£ç å·²å…¨éƒ¨å®Œæ¯•ã€‚åœ¨ç›¸åº”çš„åœ°æ–¹è°ƒç”¨<code>resolvePromise</code>æ–¹æ³•å³å¯ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å…¶å®ï¼Œå†™åˆ°æ­¤å¤„Promiseçš„çœŸæ­£æºç å·²ç»å†™å®Œäº†ï¼Œä½†æ˜¯è·ç¦»100åˆ†è¿˜å·®ä¸€åˆ†ï¼Œæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è§„èŒƒä¸­è¯´æ˜ï¼ŒPromiseçš„thenæ–¹æ³•æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><blockquote><p>onFulfilled or onRejected must not be called until the execution context stack contains only platform code.</p></blockquote><p>ES6çš„åŸç”ŸPromiseå¯¹è±¡å·²ç»å®ç°äº†è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä»£ç æ˜¯åŒæ­¥æ‰§è¡Œï¼Œä¸ç›¸ä¿¡å¯ä»¥è¯•ä¸€ä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•å°†åŒæ­¥ä»£ç å˜æˆå¼‚æ­¥æ‰§è¡Œå‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨setTimeoutå‡½æ•°æ¥æ¨¡æ‹Ÿä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//æ­¤å¤„çš„ä»£ç ä¼šå¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">&#125;,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æ­¤æŠ€å·§ï¼Œå°†ä»£ç thenæ‰§è¡Œå¤„çš„æ‰€æœ‰åœ°æ–¹ä½¿ç”¨setTimeoutå˜ä¸ºå¼‚æ­¥å³å¯ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> x = onFulfilled(value);</span><br><span class="line">        resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        reject(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥åˆ©ç”¨promises-aplus-testsæ¥æµ‹è¯•ä»£ç </p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptçš„å˜é‡æå‡</title>
      <link href="/2017/07/20/javascript/JavaScript%E4%B9%8B%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87/"/>
      <url>/2017/07/20/javascript/JavaScript%E4%B9%8B%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87/</url>
      
        <content type="html"><![CDATA[<p>JavaScriptçš„è®¾è®¡ä¸åŒäºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå®ƒè‡ªæˆä¸€æ´¾ï¼Œæœ‰å¾ˆå¤šçš„å¥‡å¦™ç‰¹æ€§ã€‚</p><p>ä»Šå¤©å°±æ¥èŠèŠå˜é‡æå‡ã€‚</p><h2 id="å˜é‡æå‡æ˜¯ä»€ä¹ˆ"><a href="#å˜é‡æå‡æ˜¯ä»€ä¹ˆ" class="headerlink" title="å˜é‡æå‡æ˜¯ä»€ä¹ˆ"></a>å˜é‡æå‡æ˜¯ä»€ä¹ˆ</h2><p>ES5ä¹‹å‰ï¼ŒJavaScriptå®é™…ä¸Šå¹¶ä¸å­˜åœ¨å—çº§ä½œç”¨åŸŸã€‚JavaScriptå¼•æ“å¯¹JavaScriptä¸­<code>var</code>ç±»å‹å˜é‡çš„å£°æ˜çš„å¤„ç†æ–¹å¼æ˜¯ï¼š</p><ul><li>å¦‚æœå˜é‡åœ¨å‡½æ•°å¤–éƒ¨å£°æ˜ï¼Œé‚£ä¹ˆè¯¥å˜é‡ä¼šè¢«æåˆ°å…¨å±€ä½œç”¨åŸŸé¡¶ç«¯</li><li>å¦‚æœå˜é‡åœ¨å‡½æ•°å†…éƒ¨å£°æ˜ï¼Œé‚£ä¹ˆè¯¥å˜é‡ä¼šè¢«æåˆ°å‡½æ•°ä½œç”¨åŸŸé¡¶ç«¯<a id="more"></a></li></ul><h3 id="å‡½æ•°å¤–éƒ¨ä½œç”¨åŸŸ"><a href="#å‡½æ•°å¤–éƒ¨ä½œç”¨åŸŸ" class="headerlink" title="å‡½æ•°å¤–éƒ¨ä½œç”¨åŸŸ"></a>å‡½æ•°å¤–éƒ¨ä½œç”¨åŸŸ</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(shape); <span class="comment">// OUTPUT : undefined</span></span><br><span class="line"><span class="keyword">var</span> shape = <span class="string">&quot;square&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(shape); <span class="comment">// OUTPUT : square</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‰ç…§Cè¯­è¨€çš„é€»è¾‘ï¼Œç¬¬1è¡Œçš„<code>console.log</code>å¼•ç”¨äº†æœªå£°æ˜çš„å˜é‡ï¼Œåº”è¯¥å‘ç”Ÿé”™è¯¯ã€‚ä½†å®é™…ä¸Šå´è¾“å‡º<code>undefined</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å®é™…ä¸Šè¿™é‡Œ<code>shape</code>å·²ç»è¢«å£°æ˜äº†ï¼Œåªæ˜¯æ²¡æœ‰åˆå§‹åŒ–èµ‹å€¼è€Œå·²ã€‚</p><p>è¿™å°±æ˜¯å˜é‡æå‡ã€‚å®é™…ä¸Šä¸Šé¢çš„ä»£ç ä¼šè¢«JSå¼•æ“è¯†åˆ«ä¸ºè¿™æ ·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shape;</span><br><span class="line"><span class="built_in">console</span>.log(shape); <span class="comment">// OUTPUT : undefined</span></span><br><span class="line">shape = <span class="string">&quot;square&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(shape); <span class="comment">// OUTPUT : square</span></span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å†…éƒ¨ä½œç”¨åŸŸ"><a href="#å‡½æ•°å†…éƒ¨ä½œç”¨åŸŸ" class="headerlink" title="å‡½æ•°å†…éƒ¨ä½œç”¨åŸŸ"></a>å‡½æ•°å†…éƒ¨ä½œç”¨åŸŸ</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getShape</span>(<span class="params">condition</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(shape);    <span class="comment">// OUTPUT : undefined</span></span><br><span class="line">    <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">        <span class="keyword">var</span> shape = square;</span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼ŒJSæ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œæ‰€ä»¥ä¸Cè¯­è¨€ä¸åŒï¼Œåœ¨<code>if</code>è¯­å¥ä¸­å£°æ˜çš„<code>shape</code>å˜é‡ä¼šç”±äºå˜é‡æå‡ï¼Œè€Œè¢«æåˆ°<code>getShape</code>çš„é¡¶ç«¯ã€‚å˜æˆä¸‹é¢è¿™æ ·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getShape</span>(<span class="params">condition</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> shape;</span><br><span class="line">     <span class="built_in">console</span>.log(shape);    <span class="comment">// OUTPUT : undefined</span></span><br><span class="line">    <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">        shape = square;</span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ES6å—çº§ä½œç”¨åŸŸ"><a href="#ES6å—çº§ä½œç”¨åŸŸ" class="headerlink" title="ES6å—çº§ä½œç”¨åŸŸ"></a>ES6å—çº§ä½œç”¨åŸŸ</h2><p>ES6 å¼•å…¥äº†å—çº§ä½œç”¨åŸŸï¼Œè¿™è®©å¼€å‘è€…å¯¹å˜é‡æœ‰äº†æ›´å¤šçš„æ§åˆ¶ï¼Œä¸”è®©å˜é‡æœ‰çµæ´»çš„ç”Ÿå‘½å‘¨æœŸã€‚<br>å—çº§å£°æ˜åœ¨å—çº§/è¯æ³•ä½œç”¨åŸŸé‡Œé¢å£°æ˜ï¼Œä»–ä»¬åœ¨â€œ<code>&#123;&#125;</code>â€ä¸­è¢«åˆ›å»ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getShape</span>(<span class="params">condition</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// shape doesn&#x27;t exist here</span></span><br><span class="line">  <span class="comment">// console.log(shape); ReferenceError: shape is not defined</span></span><br><span class="line">  <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="keyword">let</span> shape = square;</span><br><span class="line">    <span class="comment">// some other code</span></span><br><span class="line">    <span class="keyword">return</span> shape;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// shape doesn&#x27;t exist here as well</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä¸ç”¨<code>var</code>è€Œç”¨<code>let</code>æ¥å£°æ˜æˆ‘ä»¬çš„å˜é‡ï¼Œ<code>let</code>å°±æ›´ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­çš„å˜é‡å£°æ˜ï¼Œå®ƒå…·æœ‰å—çº§ä½œç”¨åŸŸã€‚</p><blockquote><p>åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œå¦‚æœå·²ç»ä½¿ç”¨varæ ‡è¯†ç¬¦å£°æ˜äº†å˜é‡ï¼ŒåŒæ—¶åˆç”¨letæ ‡è¯†ç¬¦å£°æ˜åŒåå˜é‡æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨letå£°æ˜çš„å˜é‡ä½œç”¨åŸŸå¤–ï¼Œå£°æ˜åŒåå˜é‡æ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚ï¼ˆè¿™ç§æƒ…å†µä¹ŸåŒæ ·é€‚ç”¨äºæˆ‘ä»¬å³å°†è°ˆè®ºçš„constå£°æ˜ã€‚ï¼‰</p></blockquote><p>è¿™å…¶å®å¯ä»¥ç”¨å±€éƒ¨ä½œç”¨åŸŸæ¥ç†è§£ï¼Œ<code>let</code>åªåœ¨å®ƒå£°æ˜çš„é‚£ä¸ªå—çº§ä½œç”¨åŸŸæœ‰æ•ˆï¼Œè¿™ä¸C/C++è¿™ç±»ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­çš„å±€éƒ¨ä½œç”¨åŸŸçš„ç‰¹æ€§å¾ˆç±»ä¼¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shape = <span class="string">&quot;square&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> shape = <span class="string">&quot;rectangle&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shape = <span class="string">&quot;square&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  <span class="comment">// doesn&#x27;t throw an error</span></span><br><span class="line">  <span class="keyword">let</span> shape = <span class="string">&quot;rectangle&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// No error</span></span><br></pre></td></tr></table></figure><h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><p><code>const</code>å£°æ˜è¯­æ³•ä¸<code>let</code>å’Œ<code>var</code>ç›¸ä¼¼ï¼Œç”Ÿå‘½å‘¨æœŸä¸<code>let</code>ç›¸åŒï¼Œä½†ä½ è¿˜è¦æ³¨æ„ä¸€äº›è§„åˆ™ã€‚<br>ç”¨<code>const</code>å£°æ˜çš„å˜é‡å°†åƒ<strong>å¸¸é‡</strong>çœ‹å¾…ï¼Œå› æ­¤<strong>å®ƒä»¬çš„å€¼åœ¨å®šä¹‰åæ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„</strong>ã€‚ç”±äºè¿™æ ·ï¼Œæ¯ä¸ª<code>const</code>å˜é‡éƒ½<strong>å¿…é¡»åœ¨å£°æ˜çš„åŒæ—¶è¿›è¡Œåˆå§‹åŒ–</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape = <span class="string">&quot;triangle&quot;</span>;<span class="comment">// valid </span></span><br><span class="line"><span class="keyword">const</span> color; <span class="comment">// syntax error: missing initialization</span></span><br><span class="line">shape = <span class="string">&quot;square&quot;</span>; <span class="comment">// TypeError: Assignment to constant variable</span></span><br></pre></td></tr></table></figure><p>ä½†åœ¨å£°æ˜å¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„å±æ€§å¯ä»¥è¢«ä¿®æ”¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> shape = &#123;</span><br><span class="line">    name: <span class="string">&quot;triangle&quot;</span>,</span><br><span class="line">    sides: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">shape.name = <span class="string">&quot;square&quot;</span>; <span class="comment">// ok </span></span><br><span class="line">shape.sides = <span class="number">4</span>;</span><br><span class="line">shape = &#123;</span><br><span class="line">    name: hexagon,</span><br><span class="line">    sides: <span class="number">6</span></span><br><span class="line">&#125; <span class="comment">// SyntaxError: Invalid shorthand property initializer</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<code>const</code>å¯ä»¥é˜²æ­¢æ•´ä¸ªç»‘å®šçš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯ç»‘å®šçš„å€¼ã€‚</p><h2 id="æš‚æ—¶æ€§æ­»åŒº"><a href="#æš‚æ—¶æ€§æ­»åŒº" class="headerlink" title="æš‚æ—¶æ€§æ­»åŒº"></a>æš‚æ—¶æ€§æ­»åŒº</h2><p><strong>ä½¿ç”¨<code>let</code>æˆ–<code>const</code>å£°æ˜çš„æ—¶å€™ï¼Œå®ƒä»¬å¹¶ä¸ä¼šå˜é‡æå‡</strong>ï¼Œæ‰€ä»¥åœ¨å®ƒä»¬è¢«å£°æ˜ä¹‹å‰ï¼Œä½¿ç”¨å®ƒä»¬ä¼šæŠ›å‡º<code>ReferenceError</code>é”™è¯¯ã€‚</p><p>åœ¨è¿›å…¥ä½œç”¨åŸŸå’Œä¸èƒ½è®¿é—®çš„è¿™æ®µæ—¶é—´ï¼Œæˆ‘ä»¬ç§°ä¸ºæš‚æ—¶æ€§æ­»åŒºã€‚<br>æç¤ºï¼šâ€œæš‚æ—¶æ€§æ­»åŒºâ€ä¸æ˜¯ECMAScriptè§„èŒƒé‡Œçš„æ­£å¼å®šä¹‰ï¼Œå®ƒåªæ˜¯åœ¨ç¨‹åºå‘˜ä¸­å¹¿ä¸ºæµè¡Œè€Œå·²ã€‚</p><h2 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h2><p>å¦‚æœä½ å¯¹<code>var</code>çš„ç‰¹æ€§ååˆ†äº†è§£ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å®ƒï¼Œä½†ä¸æ¨èï¼Œå› ä¸ºä¸åˆ©äºç»´æŠ¤ã€‚</p><p><code>let</code>å’Œ<code>const</code>å·²ç»å®Œå…¨å¯ä»¥ä»£æ›¿<code>var</code>çš„ä½¿ç”¨ï¼Œè¿™æ˜¯æ›´åŠ ç¬¦åˆç¨‹åºå‘˜è®¤çŸ¥çš„ç”¨æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸­çš„async</title>
      <link href="/2017/07/17/javascript/Javascript%E4%B8%AD%E7%9A%84async/"/>
      <url>/2017/07/17/javascript/Javascript%E4%B8%AD%E7%9A%84async/</url>
      
        <content type="html"><![CDATA[<p>å¼‚æ­¥ç¼–ç¨‹ä¸€ç›´æ˜¯JavaScriptä¸­çš„éº»çƒ¦äº‹ï¼Œä½†åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå¯¹å¼‚æ­¥çš„æ”¯æŒæ˜¯å¿…é¡»çš„ã€‚JavaScriptä¸€ç›´éƒ½æœ‰å¼‚æ­¥çš„è§£å†³æ–¹æ¡ˆã€‚æœ€æ—©æ˜¯å›è°ƒå‡½æ•°ï¼Œä½†ç”±äºè¿ç¯å›è°ƒä¼šå¸¦æ¥ä¸¥é‡çš„åµŒå¥—é—®é¢˜ï¼Œæ‰€ä»¥åæ¥æ¢åšæ‰å¹³åŒ–çš„Promiseè§£å†³æ–¹æ¡ˆã€‚</p><a id="more"></a><h2 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h2><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>è°ƒç”¨ä¸€ä¸ªå‡½æ•°f -&gt; å‡½æ•°fæ‰§è¡Œå®Œæ¯• -&gt; fè°ƒç”¨å›è°ƒå‡½æ•°c </p><h3 id="ä½¿ç”¨åœºåˆ"><a href="#ä½¿ç”¨åœºåˆ" class="headerlink" title="ä½¿ç”¨åœºåˆ"></a>ä½¿ç”¨åœºåˆ</h3><ul><li>èµ„æºåŠ è½½ï¼šåŠ¨æ€åŠ è½½jsæ–‡ä»¶åæ‰§è¡Œå›è°ƒï¼ŒåŠ è½½iframeåæ‰§è¡Œå›è°ƒï¼Œajaxæ“ä½œå›è°ƒï¼Œå›¾ç‰‡åŠ è½½å®Œæˆæ‰§è¡Œå›è°ƒï¼ŒAJAXç­‰ç­‰ã€‚</li><li>DOMäº‹ä»¶åŠNode.jsäº‹ä»¶åŸºäºå›è°ƒæœºåˆ¶(Node.jså›è°ƒå¯èƒ½ä¼šå‡ºç°å¤šå±‚å›è°ƒåµŒå¥—çš„é—®é¢˜)ã€‚<br>setTimeoutçš„å»¶è¿Ÿæ—¶é—´ä¸º0ï¼Œè¿™ä¸ªhackç»å¸¸è¢«ç”¨åˆ°ï¼Œsettimeoutè°ƒç”¨çš„å‡½æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªcallbackçš„ä½“ç°</li><li>é“¾å¼è°ƒç”¨ï¼šé“¾å¼è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨èµ‹å€¼å™¨(setter)æ–¹æ³•ä¸­(æˆ–è€…æœ¬èº«æ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•ä¸­)å¾ˆå®¹æ˜“å®ç°é“¾å¼è°ƒç”¨ï¼Œè€Œå–å€¼å™¨(getter)ç›¸å¯¹æ¥è¯´ä¸å¥½å®ç°é“¾å¼è°ƒç”¨ï¼Œå› ä¸ºä½ éœ€è¦å–å€¼å™¨è¿”å›ä½ éœ€è¦çš„æ•°æ®è€Œä¸æ˜¯thisæŒ‡é’ˆï¼Œå¦‚æœè¦å®ç°é“¾å¼æ–¹æ³•ï¼Œå¯ä»¥ç”¨å›è°ƒå‡½æ•°æ¥å®ç°</li><li>setTimeoutã€setIntervalçš„å‡½æ•°è°ƒç”¨å¾—åˆ°å…¶è¿”å›å€¼ã€‚ç”±äºä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå³ï¼šä»–ä»¬çš„è°ƒç”¨æ—¶åºå’Œç¨‹åºçš„ä¸»æµç¨‹æ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åœ¨ä¸»ä½“é‡Œé¢ç­‰å¾…å®ƒä»¬çš„è¿”å›å€¼ï¼Œå®ƒä»¬è¢«æ‰“å¼€çš„æ—¶å€™ç¨‹åºä¹Ÿä¸ä¼šåœä¸‹æ¥ç­‰å¾…ï¼Œå¦åˆ™ä¹Ÿå°±å¤±å»äº†setTimeoutåŠsetIntervalçš„æ„ä¹‰äº†ï¼Œæ‰€ä»¥ç”¨returnå·²ç»æ²¡æœ‰æ„ä¹‰ï¼Œåªèƒ½ä½¿ç”¨callbackã€‚callbackçš„æ„ä¹‰åœ¨äºå°†timeræ‰§è¡Œçš„ç»“æœé€šçŸ¥ç»™ä»£ç†å‡½æ•°è¿›è¡ŒåŠæ—¶å¤„ç†ã€‚</li></ul><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>ä¼ ç»Ÿå‡½æ•°ä»¥å‚æ•°å½¢å¼è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”ä½¿ç”¨è¿”å›è¯­å¥è¿”å›å€¼ã€‚ç†è®ºä¸Šï¼Œåœ¨å‡½æ•°ç»“å°¾å¤„æœ‰ä¸€ä¸ªreturnè¿”å›è¯­å¥ï¼Œç»“æ„ä¸Šå°±æ˜¯ï¼šä¸€ä¸ªè¾“å…¥ç‚¹å’Œä¸€ä¸ªè¾“å‡ºç‚¹ã€‚è¿™æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå‡½æ•°æœ¬è´¨ä¸Šå°±æ˜¯è¾“å…¥å’Œè¾“å‡ºä¹‹é—´å®ç°è¿‡ç¨‹çš„æ˜ å°„ã€‚</p><p>ã€€ã€€ä½†æ˜¯ï¼Œå½“å‡½æ•°çš„å®ç°è¿‡ç¨‹éå¸¸æ¼«é•¿ï¼Œä½ æ˜¯é€‰æ‹©ç­‰å¾…å‡½æ•°å®Œæˆå¤„ç†ï¼Œè¿˜æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°è¿›è¡Œå¼‚æ­¥å¤„ç†å‘¢ï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨å›è°ƒå‡½æ•°å˜å¾—è‡³å…³é‡è¦ï¼Œä¾‹å¦‚ï¼šAJAXè¯·æ±‚ã€‚è‹¥æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä»£ç å°±å¯ä»¥ç»§ç»­è¿›è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œæ— éœ€ç©ºç­‰ã€‚å®é™…å¼€å‘ä¸­ï¼Œç»å¸¸åœ¨javascriptä¸­ä½¿ç”¨å¼‚æ­¥è°ƒç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">url, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> httpRequest;ã€€ã€€ã€€ã€€<span class="comment">//åˆ›å»ºXHR</span></span><br><span class="line">    httpRequest = <span class="built_in">window</span>.XMLHttpRequest ? <span class="keyword">new</span> XMLHttpRequest() :ã€€ã€€ã€€</span><br><span class="line">ã€€ã€€ã€€ã€€    <span class="built_in">window</span>.ActiveXObject ? <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>             ) : <span class="literal">undefined</span>;<span class="comment">//é’ˆå¯¹IEè¿›è¡ŒåŠŸèƒ½æ€§æ£€æµ‹</span></span><br><span class="line">    </span><br><span class="line">    httpRequest.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// æŠŠå›è°ƒå‡½æ•°æ³¨å†Œåˆ°æŸä¸ªäº‹ä»¶ä¸Š</span></span><br><span class="line">      <span class="keyword">if</span>(httpRequest.readystate === <span class="number">4</span> </span><br><span class="line">                &amp;&amp; httpRequest.status === <span class="number">200</span>)&#123;ã€€ã€€<span class="comment">//çŠ¶æ€åˆ¤æ–­</span></span><br><span class="line">          callback.call(httpRequest.responseXML);  </span><br><span class="line">       &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    httpRequest.open(<span class="string">&quot;GET&quot;</span>, url);</span><br><span class="line">    httpRequest.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn(<span class="string">&quot;text.xml&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ã€€ã€€ã€€ã€€<span class="comment">//è°ƒç”¨å‡½æ•°</span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="built_in">this</span>); ã€€ã€€<span class="comment">//æ­¤è¯­å¥åè¾“å‡º</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;this will run before the above callback.&quot;</span>);ã€€ã€€<span class="comment">//æ­¤è¯­å¥å…ˆè¾“å‡º</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptçš„åŸå‹ç»§æ‰¿</title>
      <link href="/2017/07/12/javascript/JavaScript%E4%B9%8B%E5%8E%9F%E5%9E%8B%E7%BB%A7%E6%89%BF/"/>
      <url>/2017/07/12/javascript/JavaScript%E4%B9%8B%E5%8E%9F%E5%9E%8B%E7%BB%A7%E6%89%BF/</url>
      
        <content type="html"><![CDATA[<h2 id="JavaScriptç»§æ‰¿"><a href="#JavaScriptç»§æ‰¿" class="headerlink" title="JavaScriptç»§æ‰¿"></a>JavaScriptç»§æ‰¿</h2><p>ä¸€èˆ¬çš„é¢å‘å¯¹è±¡çš„è¯­è¨€å¯¹ç»§æ‰¿çš„å¤„ç†æ–¹å¼éƒ½æ˜¯class-basedï¼Œå³åŸºäºç±»çš„ç»§æ‰¿ã€‚ä¸€èˆ¬æ˜¯è¯´å­ç±»ç»§æ‰¿äº†çˆ¶ç±»ï¼Œç»§æ‰¿çš„ä¸»ä½“æ˜¯ç±»ã€‚è€Œç±»çš„å¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿ä½“ç°äºç±»çš„ç»§æ‰¿ä¸­ã€‚</p><p>ä»¥Javaä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;&#125; <span class="comment">//çˆ¶ç±»A</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;&#125; <span class="comment">//å­ç±»Bç»§æ‰¿äº†çˆ¶ç±»A</span></span><br></pre></td></tr></table></figure><p>åœ¨JavaScriptçš„ä¸–ç•Œä¸­åˆ™å¹¶éå¦‚æ­¤ã€‚JSé€šè¿‡åŸå‹é“¾çš„æ–¹å¼æ¥å®ç°ç»§æ‰¿ï¼Œæ˜¯åŸºäºå¯¹è±¡çš„ç»§æ‰¿ã€‚ä¸‹ä¾‹ä¸­bå¯¹è±¡ç»§æ‰¿äº†aå¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">sex</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    <span class="built_in">this</span>.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.sex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> People(<span class="string">&quot;man&quot;</span>); <span class="comment">//å®ä¾‹åŒ–aå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Object</span>.create(a);  <span class="comment">//bå¯¹è±¡ç»§æ‰¿aå¯¹è±¡ï¼Œç»§æ‰¿äº†açš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="built_in">console</span>.log(b.sex); <span class="comment">//man</span></span><br><span class="line">b.say(); <span class="comment">//man</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œaå¯¹è±¡æ˜¯bå¯¹è±¡çš„åŸå‹ã€‚è¿™æ ·çš„ç»§æ‰¿æ–¹æ³•ä¸éœ€è¦ç±»ï¼Œç»§æ‰¿åœ¨å¯¹è±¡ä¹‹é—´å®Œæˆã€‚</p><h2 id="åŸå‹ç»§æ‰¿æœºåˆ¶"><a href="#åŸå‹ç»§æ‰¿æœºåˆ¶" class="headerlink" title="åŸå‹ç»§æ‰¿æœºåˆ¶"></a>åŸå‹ç»§æ‰¿æœºåˆ¶</h2><p>å¯¹è±¡è¿›è¡Œå±æ€§æŸ¥æ‰¾æ—¶ï¼Œä¼˜å…ˆæŸ¥æ‰¾è‡ªå·±çš„å±æ€§ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°å†å»æŸ¥æ‰¾å¯¹è±¡çš„åŸå‹ä¸Šçš„å±æ€§ã€‚å¦‚æœåŸå‹å¯¹è±¡ä¾æ—§æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆé€’å½’æŸ¥æ‰¾æŒ‡å¯¼åŸå‹æ ¹éƒ¨ï¼Œå¦‚æœä¾æ—§æ²¡æœ‰æ‰¾åˆ°é‚£ä¹ˆè¿”å›<code>undefined</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: å¯¹è±¡a</span><br><span class="line">op&#x3D;&gt;operation: æŸ¥æ‰¾å±æ€§p</span><br><span class="line">cond&#x3D;&gt;condition: æ˜¯å¦æœ‰å±æ€§p</span><br><span class="line">sub1&#x3D;&gt;subroutine: è½¬åˆ°å¯¹è±¡açš„ç»§æ‰¿çš„åŸå‹å¯¹è±¡</span><br><span class="line">io&#x3D;&gt;inputoutput: è¿”å›å±æ€§p</span><br><span class="line">e&#x3D;&gt;end: ç»“æŸ</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;io-&gt;e</span><br><span class="line">cond(no)-&gt;sub1(right)-&gt;op</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯åŸå‹é“¾çš„æ€æƒ³ï¼Œå±‚å±‚å¾€ä¸Šä¸€çº§é“¾æ¡ä¸ŠæŸ¥æ‰¾ã€‚</p><p>ES5ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>Object.getPrototypeOf(obj)</code> æ¥è·å–<code>obj</code>å¯¹è±¡çš„åŸå‹ï¼Œåœ¨Chromeæµè§ˆå™¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨éæ ‡å‡†çš„<code>obj.__proto__</code>ã€‚</p><p>JSä¸­å®šä¹‰ä¸€ä¸ªç±»çš„æ˜¯é€šè¿‡å£°æ˜ä¸€ä¸ªå‡½æ•°æ¥å®ç°ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿç§°ä¸ºæ„é€ å™¨ã€‚JS ä¸­çš„æ„é€ å™¨æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§(å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿæœ‰å±æ€§) â€”â€”â€”â€” <code>prototype</code>ã€‚æ­¤ <code>prototype</code> ç”¨æ¥å®šä¹‰é€šè¿‡æ„é€ å™¨æ„é€ å‡ºæ¥çš„å¯¹è±¡çš„åŸå‹ï¼Œæ„é€ å™¨å†…éƒ¨çš„ä»£ç ç”¨æ¥ç»™å¯¹è±¡åˆå§‹åŒ–ã€‚å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(People.prototype); </span><br><span class="line"><span class="comment">//&#123;constructor: People&#125; People.prototypeçš„æ„é€ å™¨ä¸ºPeople</span></span><br><span class="line">People.prototype.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line">People.prototype.sex = <span class="string">&quot;female&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> People(<span class="string">&quot;soda&quot;</span>);</span><br><span class="line">p1.constructor <span class="comment">//People</span></span><br><span class="line">p1.sex <span class="comment">//female</span></span><br><span class="line">p1.say(); <span class="comment">//soda</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡º<code>p1</code>å¯¹è±¡è·å¾—äº†<code>People.prototype</code>çš„å±æ€§å’Œæ–¹æ³•ã€‚å®é™…ä¸Šï¼Œé€šè¿‡<code>new People()</code>ï¼Œ<code>p1</code>ä»¥<code>People</code>çš„<code>prototype</code>ä¸ºåŸå‹æ¥åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶è·å¾—äº†è¯¥åŸå‹çš„å…¨éƒ¨å±æ€§å’Œæ–¹æ³•ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p1 = <span class="keyword">new</span> People() <span class="comment">// ç­‰ä»·äº</span></span><br><span class="line">p1 = <span class="built_in">Object</span>.create(People.prototype) <span class="comment">// ç”¨ People çš„ prototype ä½œä¸ºåŸå‹æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span></span><br><span class="line">People.apply(p1, <span class="string">&quot;soda&quot;</span>) <span class="comment">// æ‰§è¡Œæ„é€ å™¨ç”¨æ¥åˆå§‹åŒ–ï¼Œæ„é€ å™¨ä¸­çš„ this æŒ‡å‘ p1</span></span><br></pre></td></tr></table></figure><p><code>p1</code>çš„åŸå‹æ˜¯<code>People.prototype</code>ï¼Œ<code>p1</code>æ˜¯<code>People</code>æ„é€ (new)å‡ºæ¥çš„ã€‚</p><p>ä¸ºäº†è®©<code>p1.constructor</code>èƒ½æ„æ­£ç¡®æ‰§è¡Œ<code>p1</code>çš„æ„é€ å™¨ï¼Œä¸€ä¸ªæ„é€ å™¨é»˜è®¤çš„ <code>prototype</code> ä¸Šå·²ç»å­˜åœ¨ <code>constructor</code> å±æ€§ï¼Œå¹¶ä¸”æŒ‡å‘æ„é€ å™¨æœ¬èº«ã€‚</p><p>âš ï¸ <code>People.prototype</code>å¹¶é<code>People</code>çš„åŸå‹ï¼Œè€Œæ˜¯<code>People</code>æ„é€ çš„å¯¹è±¡çš„åŸå‹ï¼Œå³<code>p1</code>çš„åŸå‹ã€‚<code>People</code>æœ¬èº«æ˜¯ä¸€ä¸ª<code>Function</code>ç±»å‹ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ª<code>Function</code>æ„é€ å‡ºæ¥çš„å¯¹è±¡ï¼Œå®ƒçš„åŸå‹æ˜¯<code>Object.getPrototypeOf(People)</code>æˆ–<code>People.__proto__</code>ã€‚ å› ä¸º <code>People</code> æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œæ‰€æœ‰å‡½æ•°éƒ½æ„é€ è‡ª <code>Function</code>ï¼ŒåŸå‹æ˜¯ <code>Function.prototype</code>ã€‚<code>People.prototype</code> æ˜¯ <code>People</code> æ„é€ å‡ºæ¥çš„å®ä¾‹çš„åŸå‹ï¼Œä¸æ˜¯ <code>People</code> çš„åŸå‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">People.__proto__ === <span class="built_in">Function</span>.prototype</span><br><span class="line"><span class="comment">//true</span></span><br></pre></td></tr></table></figure><h2 id="æ¢ç©¶constructor"><a href="#æ¢ç©¶constructor" class="headerlink" title="æ¢ç©¶constructor"></a>æ¢ç©¶constructor</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line">foo.constructor === Foo.prototype.constructor <span class="comment">//true</span></span><br><span class="line">foo.constructor === Foo <span class="comment">// true</span></span><br><span class="line">Foo.constructor === <span class="built_in">Object</span>.constructor <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.constructor === <span class="built_in">Function</span>.constructor <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Function</span>.constructor === <span class="built_in">Function</span> <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ ·ä¾‹æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ä¸‰ä¸ªä¿¡æ¯ï¼Œ</p><ul><li><p><strong>å¯¹äº<code>foo</code>å¯¹è±¡è€Œè¨€ï¼Œ<code>Foo</code>å‡½æ•°æ˜¯å…¶æ„é€ å™¨ï¼Œ<code>foo</code>æ˜¯<code>Foo</code>å‡½æ•°æ„é€ çš„å¯¹è±¡ã€‚</strong></p></li><li><p><strong>å¯¹äºä¸€åˆ‡å‡½æ•°<code>fn</code>è€Œè¨€ï¼Œ<code>Function</code>æ˜¯å®ƒä»¬çš„æ„é€ å™¨ï¼Œ<code>fn</code>æ˜¯<code>Function</code>å‡½æ•°æ„é€ çš„å¯¹è±¡ï¼Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ã€‚</strong></p></li><li><p><strong><code>Function</code>çš„æ„é€ å™¨æ˜¯<code>Function</code>æœ¬èº«ã€‚<code>Function</code>æ—¢æ˜¯å¯¹è±¡ï¼Œåˆæ˜¯å‡½æ•°ã€‚</strong></p></li></ul><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºä»€ä¹ˆï¼Ÿ</p><p>å› ä¸ºæ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰åŒä¸€ä¸ªæ„é€ å™¨ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰åŒä¸€ä¸ªåŸå‹ï¼Œè¿™ä¸ªåŸå‹å°±æ˜¯<code>Function</code>ç±»çš„åŸå‹<code>Function.prototype</code></p><p>å³<code>Object.getPrototypeOf(fn) === Function.prototype</code>ï¼Œ<strong>æ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªç±»</strong>ã€‚</p><h2 id="Functionçš„åŒé‡æ€§"><a href="#Functionçš„åŒé‡æ€§" class="headerlink" title="Functionçš„åŒé‡æ€§"></a>Functionçš„åŒé‡æ€§</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.__proto__ === <span class="built_in">Function</span>.prototype <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="built_in">Function</span>) === <span class="built_in">Function</span>.prototype <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>ç­‰å¼çš„å·¦è¾¹çš„<code>Function</code>ä½œä¸ºå¯¹è±¡ï¼Œæ±‚<code>Function</code>å¯¹è±¡ç»§æ‰¿çš„åŸå‹</p><p>ç­‰å¼çš„å³è¾¹çš„<code>Funciton</code>ä½œä¸ºæ„é€ å™¨ï¼Œæ±‚<code>Function</code>ç±»çš„åŸå‹</p><p>è€Œå¯¹äºä¸€èˆ¬çš„å‡½æ•°æ¥è¯´åˆ™ä¸èƒ½è¿™ä¹ˆæ¯”è¾ƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Flower</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> flower = <span class="keyword">new</span> Flower()</span><br><span class="line">flower.__proto__ === Flower.prototype  <span class="comment">//true</span></span><br><span class="line">Flower.__proto__ === <span class="built_in">Function</span>.prototype <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<code>Function</code>æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ã€‚</p><ul><li>å®ƒçš„æ„é€ å™¨æ˜¯å®ƒçš„è‡ªèº«ã€‚</li><li>å®ƒä¸æ‰€æœ‰çš„å‡½æ•°ç»§æ‰¿åŒä¸€ä¸ªåŸå‹ã€‚</li><li>æ‰€æœ‰çš„å‡½æ•°éƒ½ç”±<code>Function</code>æ¥æ„é€ ã€‚</li></ul><h2 id="Object-ä¸-Function"><a href="#Object-ä¸-Function" class="headerlink" title="Object ä¸ Function"></a>Object ä¸ Function</h2><p>èŠå®Œ<code>Function</code>å†æ¥èŠèŠ<code>Object</code>ï¼ŒJavaScriptåŸç”Ÿæä¾›<code>Object</code>å¯¹è±¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">foo.__proto__.__proto__ === <span class="built_in">Object</span>.prototype <span class="comment">//true</span></span><br><span class="line">foo.__proto__.__proto__ === obj.__proto__ <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª<code>Object</code>å¯¹è±¡ã€‚</p><p><code>Object</code>æ˜¯æ‰€æœ‰<code>Object</code>å¯¹è±¡çš„æ„é€ å™¨ï¼Œè€Œæ ¹æ®<code>Function</code>çš„æœ‰è¶£æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸‹é¢çš„ç»“æœ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span> <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥š<code>instanceof</code>çš„åŸç†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">instance <span class="keyword">instanceof</span> People <span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instanceOf</span>(<span class="params">instance, prototype</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> proto = <span class="built_in">Object</span>.getPrototype(instance); <span class="comment">// å–å¯¹è±¡åŸå‹</span></span><br><span class="line">    <span class="keyword">if</span>( proto === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ç©º</span></span><br><span class="line">    <span class="keyword">if</span>( proto === prototype) <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// åŸå‹åŒ¹é…</span></span><br><span class="line">    <span class="keyword">return</span> instanceOf(proto, prototype); <span class="comment">// é€’å½’æ£€æŸ¥åŸå‹çš„åŸå‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">instance(instance, People.prototype);</span><br></pre></td></tr></table></figure><p>JavaScriptä¸­çš„ç»§æ‰¿æ¦‚å¿µå½’æ ¹åˆ°åº•æ˜¯åŸå‹çš„ç»§æ‰¿ï¼Œé‚£ä¹ˆ<code>instanceof</code>å®é™…ä¸Šå°±æ˜¯å°†<code>instance</code>çš„åŸå‹ä¸æ„é€ å™¨çš„<code>prototype</code>è¿›è¡Œé€’å½’æ£€æŸ¥ã€‚</p><p><code>Object</code>æ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼Œä¸€ä¸ªå‡½æ•°ï¼Œè€Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç”±<code>Function</code>è¿™ä¸ªæ„é€ å™¨æ„é€ ï¼Œæ‰€ä»¥</p><p><code>Object.__proto__ === Function.prototype</code> ä¸Šå¼æˆç«‹</p><p> <code>Function</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç»§æ‰¿äº<code>Object</code>å¯¹è±¡çš„åŸå‹ï¼Œ</p><p><code>Function.__proto__ === Object.prototype</code> ä¸‹å¼æˆç«‹</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>JavaScriptçš„ç»§æ‰¿æ˜¯é€šè¿‡åŸå‹é“¾ç»§æ‰¿æ¥å®ç°çš„</li><li>æ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯å¯¹è±¡ï¼Œå®ƒä»¬çš„æ„é€ å™¨æ˜¯<code>Function</code></li><li><code>Function</code>æ˜¯è‡ªèº«çš„æ„é€ å™¨</li><li>æ‰€æœ‰çš„å¯¹è±¡çš„æœ€ç»ˆåŸå‹æ˜¯<code>Object.prototype</code>ï¼Œå³æ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿äº<code>Object</code>å¯¹è±¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼é”:Redis vs. Zookeeper</title>
      <link href="/2017/06/08/Redis/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-Redis-vs-Zookeeper/"/>
      <url>/2017/06/08/Redis/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-Redis-vs-Zookeeper/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Javaä¸­synchronizedå…³é”®å­—å’ŒReentrantLockå¯é‡å…¥é”åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æ˜¯ç»å¸¸è§çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨å…¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ§åˆ¶å¯¹èµ„æºçš„å¹¶å‘è®¿é—®ï¼Œä½†æ˜¯éšç€åˆ†å¸ƒå¼çš„å¿«é€Ÿå‘å±•ï¼Œæœ¬åœ°çš„åŠ é”å¾€å¾€ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œåœ¨æˆ‘ä»¬çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ä¸Šé¢åŠ é”çš„æ–¹æ³•å°±ä¼šå¤±å»ä½œç”¨ã€‚åŸºäºæ­¤ï¼Œä¸šç•Œæå‡ºäº†åˆ†å¸ƒå¼é”çš„æ¦‚å¿µã€‚</p><a id="more"></a><h2 id="Why-åˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#Why-åˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="Why åˆ†å¸ƒå¼é”ï¼Ÿ"></a>Why åˆ†å¸ƒå¼é”ï¼Ÿ</h2><p>åœ¨è®¨è®ºè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼š</p><p>ç³»ç»ŸAæ˜¯ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œç›®å‰æ˜¯ä¸€å°æœºå™¨éƒ¨ç½²ï¼Œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·ä¸‹è®¢å•çš„æ¥å£ï¼Œä½†æ˜¯ç”¨æˆ·ä¸‹è®¢å•ä¹‹å‰ä¸€å®šè¦å»æ£€æŸ¥ä¸€ä¸‹åº“å­˜ï¼Œç¡®ä¿åº“å­˜è¶³å¤Ÿäº†æ‰ä¼šç»™ç”¨æˆ·ä¸‹å•ã€‚</p><p>ç”±äºç³»ç»Ÿæœ‰ä¸€å®šçš„å¹¶å‘ï¼Œæ‰€ä»¥ä¼šé¢„å…ˆå°†å•†å“çš„åº“å­˜ä¿å­˜åœ¨redisä¸­ï¼Œç”¨æˆ·ä¸‹å•çš„æ—¶å€™ä¼šæ›´æ–°redisçš„åº“å­˜ã€‚</p><p>æ­¤æ—¶ç³»ç»Ÿæ¶æ„å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/EPWQcd1ymU6eHAk.png" alt="img"></p><p>ä½†æ˜¯è¿™æ ·ä¸€æ¥ä¼š<strong>äº§ç”Ÿä¸€ä¸ªé—®é¢˜</strong>ï¼šå‡å¦‚æŸä¸ªæ—¶åˆ»ï¼Œredisé‡Œé¢çš„æŸä¸ªå•†å“åº“å­˜ä¸º1ï¼Œæ­¤æ—¶ä¸¤ä¸ªè¯·æ±‚åŒæ—¶åˆ°æ¥ï¼Œå…¶ä¸­ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œåˆ°ä¸Šå›¾çš„ç¬¬3æ­¥ï¼Œæ›´æ–°æ•°æ®åº“çš„åº“å­˜ä¸º0ï¼Œä½†æ˜¯ç¬¬4æ­¥è¿˜æ²¡æœ‰æ‰§è¡Œã€‚</p><p>è€Œå¦å¤–ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œåˆ°äº†ç¬¬2æ­¥ï¼Œå‘ç°åº“å­˜è¿˜æ˜¯1ï¼Œå°±ç»§ç»­æ‰§è¡Œç¬¬3æ­¥ã€‚</p><p>è¿™æ ·çš„ç»“æœï¼Œæ˜¯å¯¼è‡´å–å‡ºäº†2ä¸ªå•†å“ï¼Œç„¶è€Œå…¶å®åº“å­˜åªæœ‰1ä¸ªã€‚</p><p>å¾ˆæ˜æ˜¾ä¸å¯¹å•Šï¼è¿™å°±æ˜¯å…¸å‹çš„<strong>åº“å­˜è¶…å–é—®é¢˜</strong></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°è§£å†³æ–¹æ¡ˆï¼šç”¨é”æŠŠ2ã€3ã€4æ­¥é”ä½ï¼Œè®©ä»–ä»¬æ‰§è¡Œå®Œä¹‹åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è¿›æ¥æ‰§è¡Œç¬¬2æ­¥ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/LIgj5Ols4R9xKcw.png" alt="img"></p><p>æŒ‰ç…§ä¸Šé¢çš„å›¾ï¼Œåœ¨æ‰§è¡Œç¬¬2æ­¥æ—¶ï¼Œä½¿ç”¨Javaæä¾›çš„synchronizedæˆ–è€…ReentrantLockæ¥é”ä½ï¼Œç„¶ååœ¨ç¬¬4æ­¥æ‰§è¡Œå®Œä¹‹åæ‰é‡Šæ”¾é”ã€‚è¿™æ ·ä¸€æ¥ï¼Œ2ã€3ã€4 è¿™3ä¸ªæ­¥éª¤å°±è¢«â€œé”â€ä½äº†ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´åªèƒ½ä¸²è¡ŒåŒ–æ‰§è¡Œã€‚å…³æ³¨å…¬ä¼—å·äº’è”ç½‘æ¶æ„å¸ˆï¼Œå›å¤å…³é”®å­—2Tï¼Œè·å–æœ€æ–°æ¶æ„è§†é¢‘</p><p>ä½†æ˜¯å¥½æ™¯ä¸é•¿ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¹¶å‘é£™å‡ï¼Œä¸€å°æœºå™¨æ‰›ä¸ä½äº†ã€‚ç°åœ¨è¦å¢åŠ ä¸€å°æœºå™¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/8OICyhzeSFGkLBj.jpg" alt="img"></p><p>å¢åŠ æœºå™¨ä¹‹åï¼Œç³»ç»Ÿå˜æˆä¸Šå›¾æ‰€ç¤ºã€‚</p><p>å‡è®¾æ­¤æ—¶ä¸¤ä¸ªç”¨æˆ·çš„è¯·æ±‚åŒæ—¶åˆ°æ¥ï¼Œä½†æ˜¯è½åœ¨äº†ä¸åŒçš„æœºå™¨ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªè¯·æ±‚æ˜¯å¯ä»¥åŒæ—¶æ‰§è¡Œäº†ï¼Œè¿˜æ˜¯ä¼šå‡ºç°<strong>åº“å­˜è¶…å–</strong>çš„é—®é¢˜ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¸Šå›¾ä¸­çš„ä¸¤ä¸ªAç³»ç»Ÿï¼Œè¿è¡Œåœ¨ä¸¤ä¸ªä¸åŒçš„JVMé‡Œé¢ï¼Œä»–ä»¬åŠ çš„é”åªå¯¹å±äºè‡ªå·±JVMé‡Œé¢çš„çº¿ç¨‹æœ‰æ•ˆï¼Œå¯¹äºå…¶ä»–JVMçš„çº¿ç¨‹æ˜¯æ— æ•ˆçš„ã€‚</p><p>å› æ­¤ï¼Œè¿™é‡Œçš„é—®é¢˜æ˜¯ï¼šJavaæä¾›çš„åŸç”Ÿé”æœºåˆ¶åœ¨å¤šæœºéƒ¨ç½²åœºæ™¯ä¸‹å¤±æ•ˆäº†</p><p>è¿™æ˜¯å› ä¸ºä¸¤å°æœºå™¨åŠ çš„é”ä¸æ˜¯åŒä¸€ä¸ªé”(ä¸¤ä¸ªé”åœ¨ä¸åŒçš„JVMé‡Œé¢)ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬åªè¦ä¿è¯ä¸¤å°æœºå™¨åŠ çš„é”æ˜¯åŒä¸€ä¸ªé”ï¼Œé—®é¢˜ä¸å°±è§£å†³äº†å—ï¼Ÿ</p><p>æ­¤æ—¶ï¼Œå°±è¯¥<strong>åˆ†å¸ƒå¼é”</strong>éš†é‡ç™»åœºäº†ï¼Œåˆ†å¸ƒå¼é”çš„æ€è·¯æ˜¯ï¼š</p><p>åœ¨æ•´ä¸ªç³»ç»Ÿæä¾›ä¸€ä¸ª<strong>å…¨å±€ã€å”¯ä¸€</strong>çš„è·å–é”çš„â€œä¸œè¥¿â€ï¼Œç„¶åæ¯ä¸ªç³»ç»Ÿåœ¨éœ€è¦åŠ é”æ—¶ï¼Œéƒ½å»é—®è¿™ä¸ªâ€œä¸œè¥¿â€æ‹¿åˆ°ä¸€æŠŠé”ï¼Œè¿™æ ·ä¸åŒçš„ç³»ç»Ÿæ‹¿åˆ°çš„å°±å¯ä»¥è®¤ä¸ºæ˜¯åŒä¸€æŠŠé”ã€‚</p><p>è‡³äºè¿™ä¸ªâ€œä¸œè¥¿â€ï¼Œå¯ä»¥æ˜¯Redisã€Zookeeperï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°æ®åº“ã€‚</p><p>æ–‡å­—æè¿°ä¸å¤ªç›´è§‚ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å›¾ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/lnpQLjsiq3GvxTJ.png" alt="640 (1)"></p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“äº†åº“å­˜è¶…å–åœºæ™¯åœ¨åˆ†å¸ƒå¼éƒ¨ç½²ç³»ç»Ÿçš„æƒ…å†µä¸‹ä½¿ç”¨JavaåŸç”Ÿçš„é”æœºåˆ¶æ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•å®ç°åˆ†å¸ƒå¼é”å‘¢ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹ï¼</p><h2 id="åŸºäºRediså®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºRediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºRediså®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºRediså®ç°åˆ†å¸ƒå¼é”</h2><p>ä¸Šé¢åˆ†æä¸ºå•¥è¦ä½¿ç”¨åˆ†å¸ƒå¼é”äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹åˆ†å¸ƒå¼é”è½åœ°çš„æ—¶å€™åº”è¯¥æ€ä¹ˆæ ·å¤„ç†ã€‚æ‰©å±•ï¼š<a href="http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&amp;mid=2247493252&amp;idx=2&amp;sn=5530b330af0e0bcb56f9cc8bd7d0a25d&amp;chksm=ebd5d9a8dca250be07d54c37110fcc2549cb31968557910a77485747d9cb9ee842a2f05c25dc&amp;scene=21#wechat_redirect">Redissonæ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”çš„ï¼Ÿ</a></p><p>æœ€å¸¸è§çš„ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨Redisåšåˆ†å¸ƒå¼é”</p><p>ä½¿ç”¨Redisåšåˆ†å¸ƒå¼é”çš„æ€è·¯å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šåœ¨redisä¸­è®¾ç½®ä¸€ä¸ªå€¼è¡¨ç¤ºåŠ äº†é”ï¼Œç„¶åé‡Šæ”¾é”çš„æ—¶å€™å°±æŠŠè¿™ä¸ªkeyåˆ é™¤ã€‚</p><p>å…·ä½“ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é”</span></span><br><span class="line"><span class="comment">// NXæ˜¯æŒ‡å¦‚æœkeyä¸å­˜åœ¨å°±æˆåŠŸï¼Œkeyå­˜åœ¨è¿”å›falseï¼ŒPXå¯ä»¥æŒ‡å®šè¿‡æœŸæ—¶é—´</span></span><br><span class="line">SET anyLock unique_value NX PX <span class="number">30000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡Šæ”¾é”ï¼šé€šè¿‡æ‰§è¡Œä¸€æ®µluaè„šæœ¬</span></span><br><span class="line"><span class="comment">// é‡Šæ”¾é”æ¶‰åŠåˆ°ä¸¤æ¡æŒ‡ä»¤ï¼Œè¿™ä¸¤æ¡æŒ‡ä»¤ä¸æ˜¯åŸå­æ€§çš„</span></span><br><span class="line"><span class="comment">// éœ€è¦ç”¨åˆ°redisçš„luaè„šæœ¬æ”¯æŒç‰¹æ€§ï¼Œredisæ‰§è¡Œluaè„šæœ¬æ˜¯åŸå­æ€§çš„</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] then</span><br><span class="line"><span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æœ‰å‡ å¤§è¦ç‚¹ï¼š</p><ul><li><p><strong>ä¸€å®šè¦ç”¨SET key value NX PX milliseconds å‘½ä»¤</strong></p><p>å¦‚æœä¸ç”¨ï¼Œå…ˆè®¾ç½®äº†å€¼ï¼Œå†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œæœ‰å¯èƒ½åœ¨è®¾ç½®è¿‡æœŸæ—¶é—´ä¹‹å‰å®•æœºï¼Œä¼šé€ æˆæ­»é”(keyæ°¸ä¹…å­˜åœ¨)</p></li><li><p><strong>valueè¦å…·æœ‰å”¯ä¸€æ€§</strong></p><p>è¿™ä¸ªæ˜¯ä¸ºäº†åœ¨è§£é”çš„æ—¶å€™ï¼Œéœ€è¦éªŒè¯valueæ˜¯å’ŒåŠ é”çš„ä¸€è‡´æ‰åˆ é™¤keyã€‚</p><p>è¿™æ˜¯é¿å…äº†ä¸€ç§æƒ…å†µï¼šå‡è®¾Aè·å–äº†é”ï¼Œè¿‡æœŸæ—¶é—´30sï¼Œæ­¤æ—¶35sä¹‹åï¼Œé”å·²ç»è‡ªåŠ¨é‡Šæ”¾äº†ï¼ŒAå»é‡Šæ”¾é”ï¼Œä½†æ˜¯æ­¤æ—¶å¯èƒ½Bè·å–äº†é”ã€‚Aå®¢æˆ·ç«¯å°±ä¸èƒ½åˆ é™¤Bçš„é”äº†ã€‚</p></li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/izNaYrJTKcltBVI.png" alt="img"></p><p>é™¤äº†è¦è€ƒè™‘å®¢æˆ·ç«¯è¦æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ä¹‹å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘redisçš„éƒ¨ç½²é—®é¢˜ã€‚</p><p>redisæœ‰3ç§éƒ¨ç½²æ–¹å¼ï¼š</p><ul><li>å•æœºæ¨¡å¼</li><li>master-slave + sentinelé€‰ä¸¾æ¨¡å¼</li><li>redis clusteræ¨¡å¼</li></ul><p>ä½¿ç”¨redisåšåˆ†å¸ƒå¼é”çš„ç¼ºç‚¹åœ¨äºï¼šå¦‚æœé‡‡ç”¨å•æœºéƒ¨ç½²æ¨¡å¼ï¼Œä¼šå­˜åœ¨å•ç‚¹é—®é¢˜ï¼Œåªè¦redisæ•…éšœäº†ã€‚åŠ é”å°±ä¸è¡Œäº†ã€‚</p><p>é‡‡ç”¨master-slaveæ¨¡å¼ï¼ŒåŠ é”çš„æ—¶å€™åªå¯¹ä¸€ä¸ªèŠ‚ç‚¹åŠ é”ï¼Œå³ä¾¿é€šè¿‡sentinelåšäº†é«˜å¯ç”¨ï¼Œä½†æ˜¯å¦‚æœmasterèŠ‚ç‚¹æ•…éšœäº†ï¼Œå‘ç”Ÿä¸»ä»åˆ‡æ¢ï¼Œæ­¤æ—¶å°±ä¼šæœ‰å¯èƒ½å‡ºç°é”ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p>åŸºäºä»¥ä¸Šçš„è€ƒè™‘ï¼Œå…¶å®redisçš„ä½œè€…ä¹Ÿè€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä»–æå‡ºäº†ä¸€ä¸ªRedLockçš„ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„æ„æ€å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><p>å‡è®¾redisçš„éƒ¨ç½²æ¨¡å¼æ˜¯redis clusterï¼Œæ€»å…±æœ‰5ä¸ªmasterèŠ‚ç‚¹ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤è·å–ä¸€æŠŠé”ï¼š</p><ul><li>è·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’</li><li>è½®æµå°è¯•åœ¨æ¯ä¸ªmasterèŠ‚ç‚¹ä¸Šåˆ›å»ºé”ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®è¾ƒçŸ­ï¼Œä¸€èˆ¬å°±å‡ åæ¯«ç§’</li><li>å°è¯•åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šå»ºç«‹ä¸€ä¸ªé”ï¼Œæ¯”å¦‚5ä¸ªèŠ‚ç‚¹å°±è¦æ±‚æ˜¯3ä¸ªèŠ‚ç‚¹ï¼ˆn / 2 +1ï¼‰</li><li>å®¢æˆ·ç«¯è®¡ç®—å»ºç«‹å¥½é”çš„æ—¶é—´ï¼Œå¦‚æœå»ºç«‹é”çš„æ—¶é—´å°äºè¶…æ—¶æ—¶é—´ï¼Œå°±ç®—å»ºç«‹æˆåŠŸäº†</li><li>è¦æ˜¯é”å»ºç«‹å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¾æ¬¡åˆ é™¤è¿™ä¸ªé”</li><li>åªè¦åˆ«äººå»ºç«‹äº†ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œä½ å°±å¾—ä¸æ–­è½®è¯¢å»å°è¯•è·å–é”</li></ul><p>ä½†æ˜¯è¿™æ ·çš„è¿™ç§ç®—æ³•è¿˜æ˜¯é¢‡å…·äº‰è®®çš„ï¼Œå¯èƒ½è¿˜ä¼šå­˜åœ¨ä¸å°‘çš„é—®é¢˜ï¼Œæ— æ³•ä¿è¯åŠ é”çš„è¿‡ç¨‹ä¸€å®šæ­£ç¡®ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/ySZF51vKboscCnU.png" alt="img"></p><h3 id="å¦ä¸€ç§æ–¹å¼ï¼šRedisson"><a href="#å¦ä¸€ç§æ–¹å¼ï¼šRedisson" class="headerlink" title="å¦ä¸€ç§æ–¹å¼ï¼šRedisson"></a>å¦ä¸€ç§æ–¹å¼ï¼šRedisson</h3><p>æ­¤å¤–ï¼Œå®ç°Redisçš„åˆ†å¸ƒå¼é”ï¼Œé™¤äº†è‡ªå·±åŸºäºredis clientåŸç”Ÿapiæ¥å®ç°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¼€æºæ¡†æ¶ï¼šRedission</p><p>Redissonæ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„å¼€æºRedis Clientï¼Œä¹Ÿæä¾›äº†åˆ†å¸ƒå¼é”çš„æ”¯æŒã€‚æˆ‘ä¹Ÿéå¸¸æ¨èå¤§å®¶ä½¿ç”¨ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å›æƒ³ä¸€ä¸‹ä¸Šé¢è¯´çš„ï¼Œå¦‚æœè‡ªå·±å†™ä»£ç æ¥é€šè¿‡redisè®¾ç½®ä¸€ä¸ªå€¼ï¼Œæ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤è®¾ç½®çš„ã€‚</p><ul><li>SET anyLock unique_value NX PX 30000</li></ul><p>è¿™é‡Œè®¾ç½®çš„è¶…æ—¶æ—¶é—´æ˜¯30sï¼Œå‡å¦‚æˆ‘è¶…è¿‡30séƒ½è¿˜æ²¡æœ‰å®Œæˆä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œkeyä¼šè¿‡æœŸï¼Œå…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½ä¼šè·å–åˆ°é”ã€‚</p><p>è¿™æ ·ä¸€æ¥çš„è¯ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜æ²¡æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹è¿›æ¥äº†ä¹Ÿä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦é¢å¤–çš„å»ç»´æŠ¤è¿™ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå¤ªéº»çƒ¦äº†~</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹redissonæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿå…ˆæ„Ÿå—ä¸€ä¸‹ä½¿ç”¨redissionçš„çˆ½ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Config <span class="built_in">config</span> = <span class="keyword">new</span> Config();</span><br><span class="line"><span class="built_in">config</span>.useClusterServers()</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.101:7001&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.101:7002&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.101:7003&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.102:7001&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.102:7002&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.102:7003&quot;</span>);</span><br><span class="line"></span><br><span class="line">RedissonClient redisson = Redisson.create(<span class="built_in">config</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RLock lock = redisson.getLock(<span class="string">&quot;anyLock&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line">lock.unlock();</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å®ƒçš„apiä¸­çš„lockå’Œunlockå³å¯å®Œæˆåˆ†å¸ƒå¼é”ï¼Œä»–å¸®æˆ‘ä»¬è€ƒè™‘äº†å¾ˆå¤šç»†èŠ‚ï¼š</p><ul><li><p>redissonæ‰€æœ‰æŒ‡ä»¤éƒ½é€šè¿‡luaè„šæœ¬æ‰§è¡Œï¼Œredisæ”¯æŒluaè„šæœ¬åŸå­æ€§æ‰§è¡Œ</p></li><li><p>redissonè®¾ç½®ä¸€ä¸ªkeyçš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30s,å¦‚æœæŸä¸ªå®¢æˆ·ç«¯æŒæœ‰ä¸€ä¸ªé”è¶…è¿‡äº†30sæ€ä¹ˆåŠï¼Ÿ</p><p>redissonä¸­æœ‰ä¸€ä¸ª<code>watchdog</code>çš„æ¦‚å¿µï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯çœ‹é—¨ç‹—ï¼Œå®ƒä¼šåœ¨ä½ è·å–é”ä¹‹åï¼Œæ¯éš”10ç§’å¸®ä½ æŠŠkeyçš„è¶…æ—¶æ—¶é—´è®¾ä¸º30s</p><p>è¿™æ ·çš„è¯ï¼Œå°±ç®—ä¸€ç›´æŒæœ‰é”ä¹Ÿä¸ä¼šå‡ºç°keyè¿‡æœŸäº†ï¼Œå…¶ä»–çº¿ç¨‹è·å–åˆ°é”çš„é—®é¢˜äº†ã€‚</p></li><li><p>redissonçš„â€œçœ‹é—¨ç‹—â€é€»è¾‘ä¿è¯äº†æ²¡æœ‰æ­»é”å‘ç”Ÿã€‚</p><p>(å¦‚æœæœºå™¨å®•æœºäº†ï¼Œçœ‹é—¨ç‹—ä¹Ÿå°±æ²¡äº†ã€‚æ­¤æ—¶å°±ä¸ä¼šå»¶é•¿keyçš„è¿‡æœŸæ—¶é—´ï¼Œåˆ°äº†30sä¹‹åå°±ä¼šè‡ªåŠ¨è¿‡æœŸäº†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è·å–åˆ°é”)</p></li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/VrfIShyRXCWTiEY.png" alt="img"></p><p>è¿™é‡Œç¨å¾®è´´å‡ºæ¥å…¶å®ç°ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ é”é€»è¾‘</span></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">RFuture&lt;Long&gt; <span class="title">tryAcquireAsync</span><span class="params">(<span class="keyword">long</span> leaseTime, TimeUnit unit, <span class="keyword">final</span> <span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaseTime != <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> tryLockInnerAsync(leaseTime, unit, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ä¸€æ®µluaè„šæœ¬ï¼Œè®¾ç½®ä¸€äº›keyã€è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    RFuture&lt;Long&gt; ttlRemainingFuture = tryLockInnerAsync(commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(), TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    ttlRemainingFuture.addListener(<span class="keyword">new</span> FutureListener&lt;Long&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> operationComplete(Future&lt;Long&gt; <span class="built_in">future</span>) throws Exception &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">future</span>.isSuccess()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Long ttlRemaining = <span class="built_in">future</span>.getNow();</span><br><span class="line">            <span class="comment">// lock acquired</span></span><br><span class="line">            <span class="keyword">if</span> (ttlRemaining == null) &#123;</span><br><span class="line">                <span class="comment">// çœ‹é—¨ç‹—é€»è¾‘</span></span><br><span class="line">                scheduleExpirationRenewal(threadId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ttlRemainingFuture;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;T&gt; <span class="function">RFuture&lt;T&gt; <span class="title">tryLockInnerAsync</span><span class="params">(<span class="keyword">long</span> leaseTime, TimeUnit unit, <span class="keyword">long</span> threadId, RedisStrictCommand&lt;T&gt; command)</span> </span>&#123;</span><br><span class="line">    internalLockLeaseTime = unit.toMillis(leaseTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> commandExecutor.evalWriteAsync(getName(), LongCodec.INSTANCE, command,</span><br><span class="line">              <span class="string">&quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hset&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;</span>,</span><br><span class="line">                Collections.&lt;Object&gt;singletonList(getName()), internalLockLeaseTime, getLockName(threadId));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// çœ‹é—¨ç‹—æœ€ç»ˆä¼šè°ƒç”¨äº†è¿™é‡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleExpirationRenewal</span><span class="params">(<span class="keyword">final</span> <span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (expirationRenewalMap.containsKey(getEntryName())) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªä»»åŠ¡ä¼šå»¶è¿Ÿ10sæ‰§è¡Œ</span></span><br><span class="line">    Timeout task = commandExecutor.getConnectionManager().newTimeout(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>(Timeout timeout) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿™ä¸ªæ“ä½œä¼šå°†keyçš„è¿‡æœŸæ—¶é—´é‡æ–°è®¾ç½®ä¸º30s</span></span><br><span class="line">            RFuture&lt;Boolean&gt; <span class="built_in">future</span> = renewExpirationAsync(threadId);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">future</span>.addListener(<span class="keyword">new</span> FutureListener&lt;Boolean&gt;() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> operationComplete(Future&lt;Boolean&gt; <span class="built_in">future</span>) throws Exception &#123;</span><br><span class="line">                    expirationRenewalMap.<span class="built_in">remove</span>(getEntryName());</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="built_in">future</span>.isSuccess()) &#123;</span><br><span class="line">                        <span class="built_in">log</span>.error(<span class="string">&quot;Can&#x27;t update lock &quot;</span> + getName() + <span class="string">&quot; expiration&quot;</span>, <span class="built_in">future</span>.cause());</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">future</span>.getNow()) &#123;</span><br><span class="line">                        <span class="comment">// reschedule itself</span></span><br><span class="line">                        <span class="comment">// é€šè¿‡é€’å½’è°ƒç”¨æœ¬æ–¹æ³•ï¼Œæ— é™å¾ªç¯å»¶é•¿è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                        scheduleExpirationRenewal(threadId);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;, internalLockLeaseTime / <span class="number">3</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (expirationRenewalMap.putIfAbsent(getEntryName(), <span class="keyword">new</span> ExpirationEntry(threadId, task)) != null) &#123;</span><br><span class="line">        task.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œredissonè¿˜æä¾›äº†å¯¹redlockç®—æ³•çš„æ”¯æŒ,</p><p>å®ƒçš„ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RedissonClient redisson = Redisson.create(<span class="built_in">config</span>);</span><br><span class="line">RLock lock1 = redisson.getFairLock(<span class="string">&quot;lock1&quot;</span>);</span><br><span class="line">RLock lock2 = redisson.getFairLock(<span class="string">&quot;lock2&quot;</span>);</span><br><span class="line">RLock lock3 = redisson.getFairLock(<span class="string">&quot;lock3&quot;</span>);</span><br><span class="line">RedissonRedLock multiLock = <span class="keyword">new</span> RedissonRedLock(lock1, lock2, lock3);</span><br><span class="line">multiLock.lock();</span><br><span class="line">multiLock.unlock();</span><br></pre></td></tr></table></figure><p><strong>å°ç»“ï¼š</strong></p><p>æœ¬èŠ‚åˆ†æäº†ä½¿ç”¨redisä½œä¸ºåˆ†å¸ƒå¼é”çš„å…·ä½“è½åœ°æ–¹æ¡ˆ</p><p>ä»¥åŠå…¶ä¸€äº›å±€é™æ€§</p><p>ç„¶åä»‹ç»äº†ä¸€ä¸ªredisçš„å®¢æˆ·ç«¯æ¡†æ¶redissonï¼Œ</p><p>è¿™ä¹Ÿæ˜¯æˆ‘æ¨èå¤§å®¶ä½¿ç”¨çš„ï¼Œ</p><p>æ¯”è‡ªå·±å†™ä»£ç å®ç°ä¼šå°‘careå¾ˆå¤šç»†èŠ‚ã€‚</p><h2 id="åŸºäºzookeeperå®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºzookeeperå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºzookeeperå®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºzookeeperå®ç°åˆ†å¸ƒå¼é”</h2><p>å¸¸è§çš„åˆ†å¸ƒå¼é”å®ç°æ–¹æ¡ˆé‡Œé¢ï¼Œé™¤äº†ä½¿ç”¨redisæ¥å®ç°ä¹‹å¤–ï¼Œä½¿ç”¨zookeeperä¹Ÿå¯ä»¥å®ç°åˆ†å¸ƒå¼é”ã€‚</p><p>åœ¨ä»‹ç»zookeeper(ä¸‹æ–‡ç”¨zkä»£æ›¿)å®ç°åˆ†å¸ƒå¼é”çš„æœºåˆ¶ä¹‹å‰ï¼Œå…ˆç²—ç•¥ä»‹ç»ä¸€ä¸‹zkæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼š</p><p>Zookeeperæ˜¯ä¸€ç§æä¾›é…ç½®ç®¡ç†ã€åˆ†å¸ƒå¼ååŒä»¥åŠå‘½åçš„ä¸­å¿ƒåŒ–æœåŠ¡ã€‚</p><p>zkçš„æ¨¡å‹æ˜¯è¿™æ ·çš„ï¼šzkåŒ…å«ä¸€ç³»åˆ—çš„èŠ‚ç‚¹ï¼Œå«åšznodeï¼Œå°±å¥½åƒæ–‡ä»¶ç³»ç»Ÿä¸€æ ·æ¯ä¸ªznodeè¡¨ç¤ºä¸€ä¸ªç›®å½•ï¼Œç„¶åznodeæœ‰ä¸€äº›ç‰¹æ€§ï¼š</p><ul><li><p><strong>æœ‰åºèŠ‚ç‚¹</strong>ï¼šå‡å¦‚å½“å‰æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ä¸º<code>/lock</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªçˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºå­èŠ‚ç‚¹ï¼›</p><p>zookeeperæä¾›äº†ä¸€ä¸ªå¯é€‰çš„æœ‰åºç‰¹æ€§ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå­èŠ‚ç‚¹â€œ/lock/node-â€å¹¶ä¸”æŒ‡æ˜æœ‰åºï¼Œé‚£ä¹ˆzookeeperåœ¨ç”Ÿæˆå­èŠ‚ç‚¹æ—¶ä¼šæ ¹æ®å½“å‰çš„å­èŠ‚ç‚¹æ•°é‡è‡ªåŠ¨æ·»åŠ æ•´æ•°åºå·</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç”Ÿæˆçš„å­èŠ‚ç‚¹ä¸º<code>/lock/node-0000000000</code>ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ™ä¸º<code>/lock/node-0000000001</code>ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p></li></ul><ul><li><p><strong>ä¸´æ—¶èŠ‚ç‚¹</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥å»ºç«‹ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåœ¨ä¼šè¯ç»“æŸæˆ–è€…ä¼šè¯è¶…æ—¶åï¼Œzookeeperä¼šè‡ªåŠ¨åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p></li><li><p><strong>äº‹ä»¶ç›‘å¬</strong>ï¼šåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å¯¹èŠ‚ç‚¹è®¾ç½®äº‹ä»¶ç›‘å¬ï¼Œå½“èŠ‚ç‚¹æ•°æ®æˆ–ç»“æ„å˜åŒ–æ—¶ï¼Œzookeeperä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚å½“å‰zookeeperæœ‰å¦‚ä¸‹å››ç§äº‹ä»¶ï¼š</p></li><li><ul><li>èŠ‚ç‚¹åˆ›å»º</li><li>èŠ‚ç‚¹åˆ é™¤</li><li>èŠ‚ç‚¹æ•°æ®ä¿®æ”¹</li><li>å­èŠ‚ç‚¹å˜æ›´</li></ul></li></ul><p>åŸºäºä»¥ä¸Šçš„ä¸€äº›zkçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¾—å‡ºä½¿ç”¨zkå®ç°åˆ†å¸ƒå¼é”çš„è½åœ°æ–¹æ¡ˆï¼š</p><ol><li><p>ä½¿ç”¨zkçš„ä¸´æ—¶èŠ‚ç‚¹å’Œæœ‰åºèŠ‚ç‚¹ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”å°±æ˜¯åœ¨zkåˆ›å»ºä¸€ä¸ªä¸´æ—¶æœ‰åºçš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚åœ¨/lock/ç›®å½•ä¸‹ã€‚</p></li><li><p>åˆ›å»ºèŠ‚ç‚¹æˆåŠŸåï¼Œè·å–/lockç›®å½•ä¸‹çš„æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹ï¼Œå†åˆ¤æ–­å½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹çš„åºå·æœ€å°çš„èŠ‚ç‚¹</p></li><li><p>å¦‚æœå½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯æ‰€æœ‰èŠ‚ç‚¹åºå·æœ€å°çš„èŠ‚ç‚¹ï¼Œåˆ™è®¤ä¸ºè·å–é”æˆåŠŸã€‚</p></li><li><p>å¦‚æœå½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹åºå·æœ€å°çš„èŠ‚ç‚¹ï¼Œåˆ™å¯¹èŠ‚ç‚¹åºå·çš„å‰ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬ã€‚</p><p>æ¯”å¦‚å½“å‰çº¿ç¨‹è·å–åˆ°çš„èŠ‚ç‚¹åºå·ä¸º<code>/lock/003</code>,ç„¶åæ‰€æœ‰çš„èŠ‚ç‚¹åˆ—è¡¨ä¸º<code>[/lock/001,/lock/002,/lock/003]</code>,åˆ™å¯¹<code>/lock/002</code>è¿™ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚</p></li></ol><p>å¦‚æœé”é‡Šæ”¾äº†ï¼Œä¼šå”¤é†’ä¸‹ä¸€ä¸ªåºå·çš„èŠ‚ç‚¹ï¼Œç„¶åé‡æ–°æ‰§è¡Œç¬¬3æ­¥ï¼Œåˆ¤æ–­æ˜¯å¦è‡ªå·±çš„èŠ‚ç‚¹åºå·æ˜¯æœ€å°ã€‚</p><p>æ¯”å¦‚<code>/lock/001</code>é‡Šæ”¾äº†ï¼Œ<code>/lock/002</code>ç›‘å¬åˆ°æ—¶é—´ï¼Œæ­¤æ—¶èŠ‚ç‚¹é›†åˆä¸º<code>[/lock/002,/lock/003]</code>,åˆ™<code>/lock/002</code>ä¸ºæœ€å°åºå·èŠ‚ç‚¹ï¼Œè·å–åˆ°é”ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/prahvcI6zWuGoqN.png" alt="img"></p><p>å…·ä½“çš„å®ç°æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œè‡³äºä»£ç æ€ä¹ˆå†™ï¼Œè¿™é‡Œæ¯”è¾ƒå¤æ‚å°±ä¸è´´å‡ºæ¥äº†ã€‚</p><h3 id="Curatorä»‹ç»"><a href="#Curatorä»‹ç»" class="headerlink" title="Curatorä»‹ç»"></a>Curatorä»‹ç»</h3><p>Curatoræ˜¯ä¸€ä¸ªzookeeperçš„å¼€æºå®¢æˆ·ç«¯ï¼Œä¹Ÿæä¾›äº†åˆ†å¸ƒå¼é”çš„å®ç°ã€‚</p><p>ä»–çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InterProcessMutex interProcessMutex = <span class="keyword">new</span> InterProcessMutex(client,<span class="string">&quot;/anyLock&quot;</span>);</span><br><span class="line">interProcessMutex.acquire();</span><br><span class="line">interProcessMutex.<span class="built_in">release</span>();</span><br></pre></td></tr></table></figure><p>å…¶å®ç°åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæºç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">internalLockLoop</span><span class="params">(<span class="keyword">long</span> startMillis, Long millisToWait, <span class="keyword">String</span> ourPath)</span> throws Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span>  haveTheLock = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span>  doDelete = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( revocable.<span class="built_in">get</span>() != null ) &#123;</span><br><span class="line">            client.getData().usingWatcher(revocableWatcher).forPath(ourPath);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( (client.getState() == CuratorFrameworkState.STARTED) &amp;&amp; !haveTheLock ) &#123;</span><br><span class="line">            <span class="comment">// è·å–å½“å‰æ‰€æœ‰èŠ‚ç‚¹æ’åºåçš„é›†åˆ</span></span><br><span class="line">            List&lt;<span class="keyword">String</span>&gt;        children = getSortedChildren();</span><br><span class="line">            <span class="comment">// è·å–å½“å‰èŠ‚ç‚¹çš„åç§°</span></span><br><span class="line">            <span class="keyword">String</span>              sequenceNodeName = ourPath.substring(basePath.length() + <span class="number">1</span>); <span class="comment">// +1 to include the slash</span></span><br><span class="line">            <span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯æœ€å°çš„èŠ‚ç‚¹</span></span><br><span class="line">            PredicateResults    predicateResults = driver.getsTheLock(client, children, sequenceNodeName, maxLeases);</span><br><span class="line">            <span class="keyword">if</span> ( predicateResults.getsTheLock() ) &#123;</span><br><span class="line">                <span class="comment">// è·å–åˆ°é”</span></span><br><span class="line">                haveTheLock = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ²¡è·å–åˆ°é”ï¼Œå¯¹å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨</span></span><br><span class="line">                <span class="keyword">String</span>  previousSequencePath = basePath + <span class="string">&quot;/&quot;</span> + predicateResults.getPathToWatch();</span><br><span class="line">                synchronized(<span class="keyword">this</span>)&#123;</span><br><span class="line">                    Stat stat = client.checkExists().usingWatcher(watcher).forPath(previousSequencePath);</span><br><span class="line">                    <span class="keyword">if</span> ( stat != null )&#123;</span><br><span class="line">                        <span class="keyword">if</span> ( millisToWait != null )&#123;</span><br><span class="line">                            millisToWait -= (System.currentTimeMillis() - startMillis);</span><br><span class="line">                            startMillis = System.currentTimeMillis();</span><br><span class="line">                            <span class="keyword">if</span> ( millisToWait &lt;= <span class="number">0</span> )&#123;</span><br><span class="line">                                doDelete = <span class="literal">true</span>;    <span class="comment">// timed out - delete our node</span></span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            wait(millisToWait);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            wait();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// else it may have been deleted (i.e. lock released). Try to acquire again</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">        doDelete = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; finally&#123;</span><br><span class="line">        <span class="keyword">if</span> ( doDelete )&#123;</span><br><span class="line">            deleteOurPath(ourPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> haveTheLock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®curatorå®ç°åˆ†å¸ƒå¼é”çš„åº•å±‚åŸç†å’Œä¸Šé¢åˆ†æçš„æ˜¯å·®ä¸å¤šçš„ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨ä¸€å¼ å›¾è¯¦ç»†æè¿°å…¶åŸç†ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/08/fyikAEdrKow7acD.png" alt="img"></p><p>å°ç»“ï¼š</p><p>æœ¬èŠ‚ä»‹ç»äº†zookeeperrå®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆä»¥åŠzkçš„å¼€æºå®¢æˆ·ç«¯çš„åŸºæœ¬ä½¿ç”¨ï¼Œç®€è¦çš„ä»‹ç»äº†å…¶å®ç°åŸç†ã€‚</p><h2 id="ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ"><a href="#ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ" class="headerlink" title="ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ"></a>ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ</h2><p>å­¦å®Œäº†ä¸¤ç§åˆ†å¸ƒå¼é”çš„å®ç°æ–¹æ¡ˆä¹‹åï¼Œæœ¬èŠ‚éœ€è¦è®¨è®ºçš„æ˜¯rediså’Œzkçš„å®ç°æ–¹æ¡ˆä¸­å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚</p><p>å¯¹äºredisçš„åˆ†å¸ƒå¼é”è€Œè¨€ï¼Œå®ƒæœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>å®ƒè·å–é”çš„æ–¹å¼ç®€å•ç²—æš´ï¼Œè·å–ä¸åˆ°é”ç›´æ¥ä¸æ–­å°è¯•è·å–é”ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</li><li>å¦å¤–æ¥è¯´çš„è¯ï¼Œredisçš„è®¾è®¡å®šä½å†³å®šäº†å®ƒçš„æ•°æ®å¹¶ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œåœ¨æŸäº›æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚é”çš„æ¨¡å‹ä¸å¤Ÿå¥å£®</li><li>å³ä¾¿ä½¿ç”¨redlockç®—æ³•æ¥å®ç°ï¼Œåœ¨æŸäº›å¤æ‚åœºæ™¯ä¸‹ï¼Œä¹Ÿæ— æ³•ä¿è¯å…¶å®ç°100%æ²¡æœ‰é—®é¢˜ï¼Œå…³äºredlockçš„è®¨è®ºå¯ä»¥çœ‹How to do distributed locking</li><li>redisåˆ†å¸ƒå¼é”ï¼Œå…¶å®éœ€è¦è‡ªå·±ä¸æ–­å»å°è¯•è·å–é”ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</li></ul><p>ä½†æ˜¯å¦ä¸€æ–¹é¢ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”åœ¨å¾ˆå¤šä¼ä¸šä¸­éå¸¸å¸¸è§ï¼Œè€Œä¸”å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¸ä¼šé‡åˆ°æ‰€è°“çš„â€œæç«¯å¤æ‚åœºæ™¯â€</p><p>æ‰€ä»¥ä½¿ç”¨redisä½œä¸ºåˆ†å¸ƒå¼é”ä¹Ÿä¸å¤±ä¸ºä¸€ç§å¥½çš„æ–¹æ¡ˆï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯redisçš„æ€§èƒ½å¾ˆé«˜ï¼Œå¯ä»¥æ”¯æ’‘é«˜å¹¶å‘çš„è·å–ã€é‡Šæ”¾é”æ“ä½œã€‚</p><p>å¯¹äºzkåˆ†å¸ƒå¼é”è€Œè¨€:</p><ul><li>zookeeperå¤©ç”Ÿè®¾è®¡å®šä½å°±æ˜¯åˆ†å¸ƒå¼åè°ƒï¼Œå¼ºä¸€è‡´æ€§ã€‚é”çš„æ¨¡å‹å¥å£®ã€ç®€å•æ˜“ç”¨ã€é€‚åˆåšåˆ†å¸ƒå¼é”ã€‚</li><li>å¦‚æœè·å–ä¸åˆ°é”ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨å°±å¯ä»¥äº†ï¼Œä¸ç”¨ä¸€ç›´è½®è¯¢ï¼Œæ€§èƒ½æ¶ˆè€—è¾ƒå°ã€‚</li></ul><p>ä½†æ˜¯zkä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼šå¦‚æœæœ‰è¾ƒå¤šçš„å®¢æˆ·ç«¯é¢‘ç¹çš„ç”³è¯·åŠ é”ã€é‡Šæ”¾é”ï¼Œå¯¹äºzké›†ç¾¤çš„å‹åŠ›ä¼šæ¯”è¾ƒå¤§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç³»ç»Ÿè®¾è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> ZooKeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°å­—ç­¾åå’Œæ•°å­—è¯ä¹¦</title>
      <link href="/2017/06/03/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E8%AF%81%E4%B9%A6/"/>
      <url>/2017/06/03/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E8%AF%81%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œéå¯¹ç§°åŠ å¯†å¯ä»¥ä¿è¯é€šä¿¡å®‰å…¨ï¼Œä½†æ— æ³•ç¡®è®¤é€šä¿¡å¯¹è±¡çš„èº«ä»½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æ•°å­—ç­¾åå’Œæ•°å­—è¯ä¹¦æŠ€æœ¯äº†ã€‚</p><a id="more"></a><h2 id="èº«ä»½è®¤è¯é—®é¢˜"><a href="#èº«ä»½è®¤è¯é—®é¢˜" class="headerlink" title="èº«ä»½è®¤è¯é—®é¢˜"></a>èº«ä»½è®¤è¯é—®é¢˜</h2><p>éå¯¹ç§°åŠ å¯†ä¸­ï¼ŒåŒæ–¹éœ€è¦äº¤æ¢å¯†é’¥ï¼Œç„¶åå„è‡ªç”¨å¯¹æ–¹çš„å¯†é’¥åŠ å¯†å‘é€çš„ä¿¡æ¯ï¼Œå¯¹æ–¹åˆ™ç”¨è‡ªå·±çš„ç§é’¥å»è§£å¯†ä¿¡æ¯ï¼Œè¿™æ ·ä¿è¯äº†é€šä¿¡è¿‡ç¨‹çš„å®‰å…¨ï¼Œä½†æ²¡æ³•ç¡®ä¿é€šä¿¡å¯¹è±¡çš„èº«ä»½é—®é¢˜ï¼Œç¬¬ä¸‰æ–¹å¯ä»¥ä¼ªé€ èº«ä»½ï¼ŒæŠŠè‡ªå·±çš„å¯†é’¥ç»™ç›‘å¬å¯¹è±¡ã€‚</p><p>æ‰€ä»¥é—®é¢˜çš„æ ¸å¿ƒåœ¨äºèº«ä»½è®¤è¯ã€‚ç°å®ç”Ÿæ´»ä¸­æˆ‘ä»¬æ˜¯ç”¨èº«ä»½è¯ç­‰è¯ä»¶è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå®ƒçš„æœ‰æ•ˆæ€§ç”±æƒå¨æ€§å›½å®¶æœºæ„æ‹…ä¿ã€‚ç±»ä¼¼çš„ï¼Œåœ¨äº’è”ç½‘ä¸­ï¼Œä¹Ÿæœ‰æƒå¨æ€§æœºæ„ä½œä¸ºæ‹…ä¿ï¼Œå®ƒå°±æ˜¯CAï¼Œåˆç§°ä¸ºè¯ä¹¦æˆæƒï¼ˆCertificate Authorityï¼‰ä¸­å¿ƒã€‚å®ƒé€šè¿‡æ•°å­—è¯ä¹¦æ¥è®¤è¯äº’è”ç½‘ç”¨æˆ·èº«ä»½ã€‚å‡å¦‚æŠŠå…¬é’¥æ¯”ä½œäº’è”ç½‘ç”¨æˆ·çš„ç”µè¯å·ç çš„è¯ï¼Œé‚£ä¹ˆCAå°±æ˜¯ç”µè¯å±€ï¼Œé€šè¿‡è¯ä¹¦æ¥ç¡®è®¤ç”µè¯å·ç å¯¹åº”äº’è”ç½‘ç”¨æˆ·ã€‚</p><h2 id="æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆ"><a href="#æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆ"></a>æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆ</h2><p>ä¸€å¥è¯æ¦‚æ‹¬ï¼Œæ•°å­—ç­¾åå°±æ˜¯ç”¨æˆ·ä¿¡æ¯/å…¬é’¥çš„å¯†æ–‡ï¼Œæ•°å­—è¯ä¹¦å°±æ˜¯æ•°å­—ç­¾åæ–‡ä»¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒAæƒ³è¦è®¤è¯Açš„å…¬é’¥ï¼Œé‚£ä¹ˆAéœ€è¦å»CAï¼ˆCertificate Authorityï¼‰ç”³è¯·è¯ä¹¦ï¼ŒCAå°±ä¼šç”¨CAçš„æ€é’¥æ¥åŠ å¯†Açš„ä¸ªäººä¿¡æ¯å’ŒAçš„å…¬é’¥ä¿¡æ¯ä¸ºå¯†æ–‡ï¼Œè¿™ä¸ªå¯†æ–‡è¢«ç§°ä¸ºæ•°å­—ç­¾åï¼Œæ•°å­—ç­¾åè¢«ç­¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ•°å­—è¯ä¹¦ã€‚</p><p>Bæƒ³è¦ä¸Aé€šä¿¡ï¼Œè¦å…ˆè®¤è¯Açš„èº«ä»½ï¼Œé‚£ä¹ˆAéœ€è¦æŠŠè¯¥è¯ä¹¦ç»™Bï¼ŒBä¼šå»CAç”³è¯·CAçš„å…¬é’¥å»è§£å¯†è¯¥è¯ä¹¦ä¸Šçš„ç­¾åï¼ˆå¯†æ–‡ï¼‰ï¼Œå› ä¸ºåªæœ‰CAçš„å…¬é’¥æ‰èƒ½è§£å¯†CAçš„ç§é’¥åŠ å¯†çš„ç­¾åï¼Œæ‰€ä»¥è¿™ä¸ªç­¾åå¯ä»¥ç¡®ä¿æ¥è‡ªäºCAï¼Œç¡®ä¿å®‰å…¨ã€‚Bè§£å¯†ç­¾ååè·å¾—äº†Açš„å…¬é’¥å’ŒAçš„ä¿¡æ¯ï¼Œå°±å¯ä»¥ä¸Aå»ºç«‹é€šä¿¡äº†ã€‚</p><p>è¿™é‡ŒCAçš„å…¬é’¥æ˜¯å…³é”®ï¼Œæ‰€æœ‰äººéƒ½éœ€è¦CAçš„å…¬é’¥æ‰èƒ½å»éªŒè¯è¯ä¹¦ï¼ŒCAçš„å…¬é’¥ä¹Ÿè¢«ç§°ä¸ºæ ¹è¯ä¹¦ã€‚ä¸€èˆ¬æ ¹è¯ä¹¦éƒ½æ˜¯é¢„å…ˆå®‰è£…åœ¨ç”µè„‘æˆ–æµè§ˆå™¨ä¸Šçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èº«ä»½è®¤è¯ </tag>
            
            <tag> å¯†ç å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº†è§£tcpæ‹¥å¡æ§åˆ¶</title>
      <link href="/2017/05/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BTCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6/"/>
      <url>/2017/05/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BTCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯æ‹¥å¡"><a href="#ä»€ä¹ˆæ˜¯æ‹¥å¡" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‹¥å¡"></a>ä»€ä¹ˆæ˜¯æ‹¥å¡</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºç½‘ç»œä¸­çš„èµ„æºæ˜¯æœ‰é™çš„ã€‚æŸæ®µæ—¶é—´å†…ç½‘ç»œä¸­å¯¹èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†ç½‘ç»œä¸­çš„å¯ç”¨éƒ¨åˆ†ï¼Œè€Œå¯¼è‡´ç½‘ç»œæ€§èƒ½ä¸‹é™çš„æƒ…å†µå°±æ˜¯<strong>æ‹¥å¡</strong>ã€‚</p><p>é€šä¿—ç‚¹è¯´å°±æ˜¯å‘é€çš„æ•°æ®åŒ…å¤ªå¤šç½‘ç»œä¸­çš„è®¾å¤‡å¤„ç†ä¸è¿‡æ¥ï¼Œè€Œå¯¼è‡´ç½‘ç»œæ€§èƒ½ä¸‹é™çš„æƒ…å†µã€‚</p><h2 id="TCPä¸ºä»€ä¹ˆè¦è¿›è¡Œæ‹¥å¡æ§åˆ¶"><a href="#TCPä¸ºä»€ä¹ˆè¦è¿›è¡Œæ‹¥å¡æ§åˆ¶" class="headerlink" title="TCPä¸ºä»€ä¹ˆè¦è¿›è¡Œæ‹¥å¡æ§åˆ¶"></a>TCPä¸ºä»€ä¹ˆè¦è¿›è¡Œæ‹¥å¡æ§åˆ¶</h2><p>ç½‘ç»œä¸­çš„è·¯ç”±å™¨ä¼šæœ‰ä¸€ä¸ªæ•°æ®åŒ…å¤„ç†é˜Ÿåˆ—ï¼Œå½“è·¯ç”±å™¨æ¥æ”¶åˆ°çš„æ•°æ®åŒ…å¤ªå¤šè€Œä¸€ä¸‹å­å¤„ç†ä¸è¿‡æ¥æ—¶ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®åŒ…å¤„ç†é˜Ÿåˆ—è¿‡é•¿ã€‚æ­¤æ—¶ï¼Œè·¯ç”±å™¨å°±ä¼šæ— æ¡ä»¶çš„ä¸¢å¼ƒæ–°æ¥æ”¶åˆ°çš„æ•°æ®å°åŒ…ã€‚</p><p>è¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚çš„TCPåè®®ä»¥ä¸ºæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­ä¸¢å¤±ï¼Œè¿›è€Œé‡ä¼ è¿™äº›æ•°æ®åŒ…ï¼Œè€Œè·¯ç”±å™¨åˆä¼šä¸¢å¼ƒè¿™äº›é‡ä¼ çš„æ•°æ®åŒ…ï¼Œå¦‚æ­¤ä»¥å¾€ï¼Œå°±ä¼šå¯¼è‡´ç½‘ç»œæ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œå¼•èµ·ç½‘ç»œç˜«ç—ªã€‚</p><p>å› æ­¤ï¼ŒTCPéœ€è¦æ§åˆ¶æ•°æ®åŒ…å‘é€çš„æ•°é‡æ¥é¿å…ç½‘ç»œæ€§èƒ½çš„ä¸‹é™ã€‚</p><h2 id="æ‹¥å¡æ§åˆ¶ä¸æµé‡æ§åˆ¶çš„åŒºåˆ«"><a href="#æ‹¥å¡æ§åˆ¶ä¸æµé‡æ§åˆ¶çš„åŒºåˆ«" class="headerlink" title="æ‹¥å¡æ§åˆ¶ä¸æµé‡æ§åˆ¶çš„åŒºåˆ«"></a>æ‹¥å¡æ§åˆ¶ä¸æµé‡æ§åˆ¶çš„åŒºåˆ«</h2><p>å¼•ç”¨ä¹¦ä¸Šçš„ç­”æ¡ˆï¼š</p><blockquote><ul><li><strong>æ‹¥å¡æ§åˆ¶</strong>å°±æ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚æ‹¥å¡æ§åˆ¶æ‰€è¦åšçš„éƒ½æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºã€æ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚</li><li><strong>æµé‡æ§åˆ¶</strong>å¾€å¾€æŒ‡ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ã€‚æµé‡æ§åˆ¶æ‰€è¦åšçš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</li></ul></blockquote><h1 id="æ‹¥å¡æ§åˆ¶çš„æ–¹æ³•"><a href="#æ‹¥å¡æ§åˆ¶çš„æ–¹æ³•" class="headerlink" title="æ‹¥å¡æ§åˆ¶çš„æ–¹æ³•"></a>æ‹¥å¡æ§åˆ¶çš„æ–¹æ³•</h1><h2 id="æ…¢å¼€å§‹"><a href="#æ…¢å¼€å§‹" class="headerlink" title="æ…¢å¼€å§‹"></a>æ…¢å¼€å§‹</h2><h3 id="æ‹¥å¡çª—å£"><a href="#æ‹¥å¡çª—å£" class="headerlink" title="æ‹¥å¡çª—å£"></a>æ‹¥å¡çª—å£</h3><p>æ‹¥å¡çª—å£ï¼ˆcwndï¼‰æ˜¯æŒ‡å‘é€æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ ¹æ®ç½‘ç»œçŠ¶å†µåŠ¨æ€å˜åŒ–çš„çª—å£ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘é€æ–¹ä¼šè®©è‡ªå·±çš„å‘é€çª—å£ç­‰äºæ‹¥å¡çª—å£çš„å¤§å°ã€‚</p><blockquote><p>å¦‚æœè€ƒè™‘åˆ°æµé‡æ§åˆ¶çš„è¯ï¼Œå‘é€çª—å£ä¹Ÿæœ‰å¯èƒ½å°äºæ‹¥å¡çª—å£çš„å¤§å°ã€‚</p></blockquote><h3 id="ä¼ è¾“è½®æ¬¡"><a href="#ä¼ è¾“è½®æ¬¡" class="headerlink" title="ä¼ è¾“è½®æ¬¡"></a>ä¼ è¾“è½®æ¬¡</h3><p>ä¸€ä¸ªä¼ è¾“è½®æ¬¡æ˜¯æŒ‡å‘é€æ–¹æŠŠè‡ªå·±çš„å‘é€çª—å£å†…çš„æ•°æ®å…¨éƒ¨å‘é€å‡ºå»å¹¶æ”¶åˆ°å¯¹æœ€åä¸€ä¸ªå­—èŠ‚çš„ç¡®è®¤ã€‚</p><p>ä¾‹å¦‚ï¼ŒAå°†è‡ªå·±çš„å‘é€çª—å£å†…çš„æ•°æ®å…¨éƒ¨è¿ç»­å‘é€ç»™äº†Bï¼Œè€ŒBæ”¶åˆ°è¿™äº›æ•°æ®åå‘Aå‘é€äº†å¯¹è¿™äº›æ•°æ®çš„ç¡®è®¤ï¼ŒAæ”¶åˆ°è¿™ä¸ªç¡®è®¤åï¼Œä¸€ä¸ªä¼ è¾“è½®æ¬¡å°±ç®—æ˜¯å®Œæˆäº†ã€‚</p><h3 id="æ…¢å¼€å§‹ç®—æ³•"><a href="#æ…¢å¼€å§‹ç®—æ³•" class="headerlink" title="æ…¢å¼€å§‹ç®—æ³•"></a>æ…¢å¼€å§‹ç®—æ³•</h3><p>æ…¢å¼€å§‹ç®—æ³•ä¸­çš„ä¸»è¦æ–¹æ³•å°±æ˜¯æœ‰å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ã€‚</p><p>é‚£ä¹ˆï¼Œå…·ä½“æ˜¯æ€ä¹ˆå¢å¤§çš„å‘¢ï¼Ÿ</p><p>ç®€å•æ¥è¯´å°±æ˜¯æ¯ä¸ªä¼ è¾“è½®æ¬¡åå°†cwndå¤§å°åŠ å€ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>é¦–å…ˆï¼Œå‘é€æ–¹è®¾ç½®cwnd=1ï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œè¿™é‡Œç”¨æŠ¥æ–‡æ®µçš„ä¸ªæ•°ä½œä¸ºçª—å£å¤§å°çš„å•ä½ï¼‰ï¼Œåœ¨æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ç¡®è®¤åï¼ˆä¹Ÿå°±æ˜¯ä¸‹ä¸ªä¼ è¾“è½®æ¬¡ï¼‰ï¼Œè®¾ç½®cwnd=2ï¼Œç„¶åå°†å‘é€çª—å£çš„æ•°æ®å‘é€å‡ºå»ã€‚åœ¨ä¸€æ¬¡æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ç¡®è®¤åï¼Œå‘é€æ–¹è®¾ç½®cwnd=4ï¼Œå†è®²å‘é€çª—å£ä¸­çš„æ•°æ®å‘é€å‡ºå»ã€‚ç„¶åå†é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚</p><p>è¿™é‡Œå°±åº”è¯¥æ¸…æ¥šï¼Œ<strong>æ…¢å¼€å§‹</strong>ç®—æ³•ä¸­çš„<strong>æ…¢</strong>ä¸æ˜¯è¯´cwndå¢é•¿çš„<strong>æ…¢</strong>ï¼Œè€Œæ˜¯ç›¸å¯¹ä¸€ä¸‹å­å‘é€å¤§é‡æ•°æ®è€Œè¨€ï¼Œè¿™ç§ä¸€æ¬¡å…ˆå‘é€å°‘é‡çš„æ•°æ®åŒ…çš„æ–¹å¼è¦<strong>æ…¢</strong>è®¸å¤šã€‚</p><p>å½“ç„¶ï¼Œcwndçš„å¤§å°è‚¯å®šä¸å¯èƒ½ä¸€ç›´ä»¥è¿™ç§æŒ‡æ•°çš„æ–¹å¼å¢é•¿ä¸‹å»ï¼Œè¦ä¸ç„¶å¾ˆå¿«å°±ä¼šå¢é•¿åˆ°å¼•èµ·ç½‘ç»œç˜«ç—ªçš„ç¨‹åº¦äº†ã€‚</p><p>æ‰€ä»¥ï¼Œç»è¿‡ä¸€å®šæ—¶é—´æˆ–æ¡ä»¶ï¼Œæˆ‘ä»¬å°±è¦æ¢æˆ<strong>æ‹¥å¡é¿å…</strong>ç®—æ³•æ¥å‘é€æ•°æ®ã€‚</p><h2 id="æ‹¥å¡é¿å…"><a href="#æ‹¥å¡é¿å…" class="headerlink" title="æ‹¥å¡é¿å…"></a>æ‹¥å¡é¿å…</h2><h3 id="æ…¢å¼€å§‹é—¨é™-ssthresh"><a href="#æ…¢å¼€å§‹é—¨é™-ssthresh" class="headerlink" title="æ…¢å¼€å§‹é—¨é™ ssthresh"></a>æ…¢å¼€å§‹é—¨é™ ssthresh</h3><p>åƒä¸Šé¢æ‰€è¯´ï¼Œä¸èƒ½ä»»ç”±æ…¢å¼€å§‹ç®—æ³•ä¸­çš„cwndä»»æ„å¢é•¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥ä¸€ä¸ª<strong>æ…¢å¼€å§‹é—¨é™ï¼ˆssthreshï¼‰</strong>çš„é˜ˆå€¼æ¥æ§åˆ¶cwndçš„å¢é•¿ã€‚</p><p>å…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li>cwnd &lt; ssthresh ï¼Œä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•</li><li>cwnd = ssthresh , ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•æˆ–æ‹¥å¡é¿å…ç®—æ³•éƒ½å¯ä»¥</li><li>cwnd &gt; ssthresh , ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•å‘¢</li></ul><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¿™ä¸ªssthreshæ˜¯æ€ä¹ˆè®¾ç½®çš„å‘¢ï¼Ÿ</p><p>TCP/IPä¸­è§„å®šæ— è®ºæ˜¯åœ¨æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯åœ¨æ‹¥å¡é¿å…é˜¶æ®µï¼Œåªè¦å‘ç°ç½‘ç»œä¸­å‡ºç°æ‹¥å¡ï¼ˆæ²¡æœ‰æŒ‰æ—¶æ”¶åˆ°ç¡®è®¤ï¼‰ï¼Œå°±è¦æŠŠssthreshè®¾ç½®ä¸ºæ­¤æ—¶å‘é€çª—å£çš„ä¸€åŠå¤§å°ï¼ˆä¸èƒ½å°äº2ï¼‰ã€‚</p><h3 id="æ‹¥å¡é¿å…è¿‡ç¨‹"><a href="#æ‹¥å¡é¿å…è¿‡ç¨‹" class="headerlink" title="æ‹¥å¡é¿å…è¿‡ç¨‹"></a>æ‹¥å¡é¿å…è¿‡ç¨‹</h3><p><strong>æ‹¥å¡é¿å…</strong>ç®—æ³•ä¹Ÿæ˜¯é€æ¸çš„å¢å¤§cwndçš„å¤§å°ï¼Œåªæ˜¯é‡‡ç”¨çš„æ˜¯çº¿æ€§å¢é•¿è€Œä¸æ˜¯åƒ<strong>æ…¢å¼€å§‹</strong>ç®—æ³•é‚£æ ·çš„æŒ‡æ•°å¢é•¿ã€‚</p><p>å…·ä½“æ¥è¯´å°±æ˜¯æ¯ä¸ªä¼ è¾“è½®æ¬¡åå°†cwndçš„å¤§å°åŠ ä¸€ï¼ˆåŠ æ³•å¢å¤§ï¼‰ï¼Œå¦‚æœå‘ç°å‡ºç°ç½‘ç»œæ‹¥å¡çš„è¯å°±æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•é‡æ–°è®¾ç½®<strong>ssthresh</strong>çš„å¤§å°ï¼ˆä¹˜æ³•å‡å°ï¼‰å¹¶ä»cwnd=1å¼€å§‹é‡æ–°æ‰§è¡Œ<strong>æ…¢å¼€å§‹</strong>ç®—æ³•ã€‚</p><p>å¦‚ä¸‹é¢çš„å›¾ç‰‡æ‰€ç¤ºï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="http://static.zybuluo.com/lxyzk/zxxuqcjbsq9gzyotfbfjwjrn/%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3" alt="æ‹¥å¡é¿å…ç®—æ³•å›¾è§£"></p><p>ï¼ˆå›¾ç‰‡æ¥æºäºç½‘ç»œï¼‰</p><h2 id="å¿«é‡ä¼ "><a href="#å¿«é‡ä¼ " class="headerlink" title="å¿«é‡ä¼ "></a>å¿«é‡ä¼ </h2><p>å‰é¢å¤ä¹ åˆ°è¿‡ï¼ŒTCPçš„å¯é ä¼ è¾“çš„åŸç†å°±æ˜¯<strong>è¶…æ—¶é‡ä¼ </strong>æœºåˆ¶ã€‚é…åˆä¸Šé¢çš„<strong>æ…¢å¼€å§‹</strong>å’Œ<strong>æ‹¥å¡é¿å…</strong>ä½¿ç”¨å°±æ˜¯å‘é€å‘å‘é€å®Œæ•°æ®åè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœåœ¨å®šæ—¶å™¨æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å¯¹æ¥æ”¶æ–¹å‘æ¥çš„ç¡®è®¤çš„è¯å°±å»æ‰§è¡Œä¸Šè¿°çš„<strong>ä¹˜æ³•å‡å°</strong>è¿‡ç¨‹å¹¶é‡æ–°å¼€å§‹<strong>æ…¢å¼€å§‹</strong>ç®—æ³•ã€‚</p><p>è€Œ<strong>å¿«é‡ä¼ </strong>åˆ™æ˜¯å…è®¸å‘é€æ–¹å†è¿ç»­æ”¶åˆ°3ä¸ªé‡å¤çš„ç¡®è®¤åå°±å¯ä»¥å¼€å§‹æ‰§è¡Œ<strong>ä¹˜æ³•å‡å°</strong>è¿‡ç¨‹è€Œä¸å¿…å†ç­‰å¾…æ‰€è®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨åˆ°æ—¶ã€‚</p><p>è¿™å°±éœ€è¦æ¥æ”¶æ–¹æ²¡æ”¶åˆ°ä¸€ä¸ª<strong>å¤±åºçš„æŠ¥æ–‡æ®µ</strong>å°±ç«‹å³å‘å‡ºé‡å¤ç¡®è®¤ä»¥è®©å‘é€å‘åŠæ—©çŸ¥é“æœ‰æŠ¥æ–‡æ®µä¸¢å¤±ï¼Œè€Œä¸æ˜¯ç­‰å¾…è‡ªå·±å‘é€æ•°æ®çš„æ—¶å€™è¿›è¡Œæå¸¦ç¡®è®¤ã€‚</p><h2 id="å¿«æ¢å¤"><a href="#å¿«æ¢å¤" class="headerlink" title="å¿«æ¢å¤"></a>å¿«æ¢å¤</h2><p><strong>å¿«æ¢å¤ç®—æ³•</strong>æ˜¯ä¸<strong>å¿«é‡ä¼ ç®—æ³•</strong>é…åˆä½¿ç”¨çš„ä¸€ä¸ªç®—æ³•ã€‚</p><p>ä½¿ç”¨äº†<strong>å¿«æ¢å¤ç®—æ³•</strong>åä¸åŸæ¥ä¸åŒçš„ä¸€ç‚¹æ˜¯å½“å‘ç°ç½‘ç»œå‡ºç°æ‹¥å¡å¹¶æ‰§è¡Œäº†<strong>ä¹˜æ³•å‡å°</strong>è¿‡ç¨‹åï¼Œå¹¶ä¸æ˜¯è®¾ç½®cwnd=1å¹¶é‡æ–°å¼€å§‹æ‰§è¡Œ<strong>æ…¢å¼€å§‹</strong>ç®—æ³•ï¼Œè€Œæ˜¯è®©cwnd=<strong>ä¹˜æ³•å‡å°</strong>åçš„<strong>ssthresh</strong>å¹¶å¼€å§‹æ‰§è¡Œ<strong>æ‹¥å¡é¿å…</strong>ç®—æ³•ã€‚</p><p>å› ä¸ºæ­¤æ—¶å‘é€å‘èƒ½è¿ç»­æ¥æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ç¡®è®¤å°±å¯ä»¥è®¤ä¸ºæ­¤æ—¶ç½‘ç»œå¾ˆå¯èƒ½æ²¡æœ‰å‘ç”Ÿæ‹¥å¡ã€‚</p><p>ä½¿ç”¨äº†<strong>å¿«é‡ä¼ </strong>å’Œ<strong>å¿«æ¢å¤</strong>çš„æ‹¥å¡é¿å…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="http://static.zybuluo.com/lxyzk/i6zrad1hw97f0a4okjxke7c4/%E5%BF%AB%E9%87%8D%E4%BC%A0%E5%BF%AB%E6%81%A2%E5%A4%8D" alt="å¿«é‡ä¼ å¿«æ¢å¤"></p><p>ï¼ˆå›¾ç‰‡æ¥æºäºç½‘ç»œï¼‰</p><h2 id="TCPçš„å‘é€çª—å£åˆ°åº•æ˜¯å¤šå¤§"><a href="#TCPçš„å‘é€çª—å£åˆ°åº•æ˜¯å¤šå¤§" class="headerlink" title="TCPçš„å‘é€çª—å£åˆ°åº•æ˜¯å¤šå¤§"></a>TCPçš„å‘é€çª—å£åˆ°åº•æ˜¯å¤šå¤§</h2><p>å‘é€çª—å£çš„ä¸Šé™å€¼ = Min{rwnd, cwnd}</p><p>rwndï¼šæ¥æ”¶æ–¹æ¥æ”¶çª—å£<br>cwndï¼šå‘é€æ–¹æ‹¥å¡çª—å£</p><a id="more"></a><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP/IP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ¯”è¾ƒRedisä¸Memcached</title>
      <link href="/2017/05/04/Redis/Redis%E8%AF%A6%E8%A7%A3%E4%B9%8B%E2%80%94%E2%80%94%E4%B8%8EMemcached%E5%AF%B9%E6%AF%94/"/>
      <url>/2017/05/04/Redis/Redis%E8%AF%A6%E8%A7%A3%E4%B9%8B%E2%80%94%E2%80%94%E4%B8%8EMemcached%E5%AF%B9%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h2><p>Redisä¸Memcachedçš„æ¯”è¾ƒç›¸å½“å¤šï¼Œé¦–å…ˆæˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ä»–ä»¬çš„ä»‹ç»ã€‚</p><blockquote><p>Memcachedï¼šä¸€æ¬¾å®Œå…¨å¼€æºã€é«˜æ€§èƒ½çš„ã€åˆ†å¸ƒå¼çš„å†…å­˜ç³»ç»Ÿï¼›</p><p>Redisï¼šä¸€ä¸ªå¼€æºçš„ã€Key-Valueå‹ã€åŸºäºå†…å­˜è¿è¡Œå¹¶æ”¯æŒæŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ï¼›</p></blockquote><a id="more"></a><p>å¯ä»¥å‘ç°ï¼ŒMemcachedæ›´ä¾§é‡äºé«˜æ€§èƒ½å†…å­˜/ç¼“å­˜ç³»ç»Ÿï¼Œè€ŒRedisåˆ™æ”¯æŒæŒä¹…åŒ–ï¼Œä¸»æ‰“æ•°æ®åº“åŠŸèƒ½ï¼Œå…¼å¯ä½œç¼“å­˜ç³»ç»Ÿï¼ˆæ€§èƒ½ä¹Ÿå¾ˆé«˜ï¼‰ã€‚</p><p>ä¸‹é¢æœ‰ä¸€ä¸ªæ›´åŠ è¯¦ç»†çš„æ¯”è¾ƒè¡¨</p><div class="table-container"><table><thead><tr><th style="text-align:left">å¯¹æ¯”å‚æ•°</th><th style="text-align:left">Redis</th><th style="text-align:left">Memcached</th></tr></thead><tbody><tr><td style="text-align:left">ç±»å‹</td><td style="text-align:left">1. æ”¯æŒå†…å­˜ <br />2. éå…³ç³»å‹æ•°æ®åº“</td><td style="text-align:left">1. æ”¯æŒå†…å­˜ <br />2. key-valueå½¢å¼<br />3. ç¼“å­˜ç³»ç»Ÿ</td></tr><tr><td style="text-align:left">æ•°æ®å­˜å‚¨ç±»å‹</td><td style="text-align:left">Stringã€Listã€Setã€Hashã€Sort Set</td><td style="text-align:left">æ–‡æœ¬å‹ã€äºŒè¿›åˆ¶å‹</td></tr><tr><td style="text-align:left">æŸ¥è¯¢æ“ä½œ</td><td style="text-align:left">1. æ‰¹é‡æ“ä½œ<br />2. æ”¯æŒäº‹åŠ¡<br />3. æ¯ä¸ªç±»å‹CRUDä¸åŒ</td><td style="text-align:left">CRUDå’Œå°‘é‡å…¶ä»–å‘½ä»¤</td></tr><tr><td style="text-align:left">é™„åŠ åŠŸèƒ½</td><td style="text-align:left">1. å‘å¸ƒ/è®¢é˜…æ¨¡å¼<br />2. ä¸»ä»åˆ†åŒº<br />3. åºåˆ—åŒ–æ”¯æŒ<br />4. è„šæœ¬æ”¯æŒ</td><td style="text-align:left">å¤šçº¿ç¨‹æœåŠ¡æ”¯æŒ</td></tr><tr><td style="text-align:left">ç½‘ç»œæ¨¡å‹</td><td style="text-align:left">å•è¿›ç¨‹IOå¤ç”¨æ¨¡å‹</td><td style="text-align:left">å¤šè¿›ç¨‹éé˜»å¡IOæ¨¡å‹</td></tr><tr><td style="text-align:left">äº‹ä»¶åº“</td><td style="text-align:left">AeEvent</td><td style="text-align:left">LibEvent</td></tr><tr><td style="text-align:left">æŒä¹…åŒ–æ”¯æŒ</td><td style="text-align:left">RDBã€AOF</td><td style="text-align:left">ä¸æ”¯æŒ</td></tr></tbody></table></div><h2 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="headerlink" title="ç½‘ç»œæ¨¡å‹"></a>ç½‘ç»œæ¨¡å‹</h2><p><strong>Memcachedæ˜¯å¤šçº¿ç¨‹éé˜»å¡IOå¤ç”¨çš„ç½‘ç»œæ¨¡å‹</strong>ï¼Œå®ƒç”±è´Ÿè´£ç›‘å¬çš„ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹workerç»„æˆã€‚ä¸»çº¿ç¨‹ç›‘å¬ç½‘ç»œè¿æ¥ï¼Œæ¯å½“æ¥å—åˆ°ç½‘ç»œè¯·æ±‚ï¼Œå°†è¿æ¥æè¿°å­—ä¼ é€’ç»™workerçº¿ç¨‹è¿›è¡Œè¯»å†™IOæ“ä½œã€‚Memcachedçš„ç½‘ç»œå±‚ä½¿ç”¨libeventå°è£…çš„äº‹ä»¶åº“ã€‚ä½†å¤šçº¿ç¨‹ä¸å¯é¿å…åœ°ä¼šæœ‰ç¼“å­˜ä¸€è‡´æ€§å’Œé”ç­‰é—®é¢˜ï¼Œè¿™é‡Œé¢å¸¦æ¥äº†æ€§èƒ½æŸè€—ã€‚</p><p><strong>Redisæ˜¯å•çº¿ç¨‹IOå¤ç”¨æ¨¡å‹</strong>ï¼Œè‡ªå·±å°è£…äº†ä¸€ä¸ªç®€å•çš„AeEventäº‹ä»¶å¤„ç†æ¡†æ¶ï¼Œä¸»è¦å®ç°äº†epoll, kqueueå’Œselectï¼Œå¯¹äºå•çº¯åªæœ‰IOæ“ä½œçš„ä¸šåŠ¡åœºæ™¯æ¥è¯´ï¼Œå•çº¿ç¨‹å¯ä»¥å°†é€Ÿåº¦ä¼˜åŠ¿å‘æŒ¥åˆ°æœ€å¤§ï¼Œä½†å¯¹äºä¸€äº›æ¶ˆè€—CPUèµ„æºçš„è®¡ç®—æ€§çš„æ“ä½œä¾‹å¦‚redisæä¾›çš„æ’åºå’Œèšåˆç­‰ï¼Œå•çº¿ç¨‹æ¨¡å‹æ–½åŠ ä¼šä¸¥é‡å½±å“æ•´ä½“ååé‡ï¼ŒCPUè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªIOè°ƒåº¦éƒ½æ˜¯è¢«é˜»å¡çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç²—ç•¥å¾—å‡ºç»“è®ºï¼Œ<strong>åœ¨é«˜å¹¶å‘åœºæ™¯çš„å‹åŠ›ä¸‹ï¼Œå¤šçº¿ç¨‹éé˜»å¡å¼IOçš„Memcachedè¡¨ç°ä¼šæ›´åŠ ä¼˜å¼‚ã€‚</strong></p><h2 id="å†…å­˜ç®¡ç†æœºåˆ¶"><a href="#å†…å­˜ç®¡ç†æœºåˆ¶" class="headerlink" title="å†…å­˜ç®¡ç†æœºåˆ¶"></a>å†…å­˜ç®¡ç†æœºåˆ¶</h2><p>Memcachedå’ŒRediséƒ½æ˜¯ç”±Cè¯­è¨€å¼€å‘ï¼Œä»–ä»¬éƒ½æ˜¯è‡ªä¸»å®ç°å†…å­˜æ¨¡å‹ã€‚</p><p>Memcachedçš„å†…å­˜æ¨¡å¼æ˜¯Slab Allocationã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>Memcachedå­˜å‚¨æ•°æ®çš„æœ€å°å•ä½æ˜¯chunkï¼Œè¿™ç§è®¾è®¡æ˜¯ä¸ºäº†é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚chunkçš„å¤§å°å¯ä»¥é€šè¿‡Factoræ¥ç®¡ç†ã€‚</li><li><p>Slabå’ŒPageç”¨äºæ‰¿è£…ä¸åŒå°ºå¯¸çš„chunkã€‚</p></li><li><p>ä¸åŒå°ºå¯¸chunkæœ€ç»ˆè¿›å…¥ä¸€ä¸ªslab_classè¿›è¡Œç®¡ç†ï¼Œä¾¿äºè®¿é—®ã€‚</p></li></ol><p>æ•°æ®è®¿é—®æµç¨‹ï¼Œç”¨æˆ·åœ¨slab_classæ‰¾åˆ°åˆé€‚å°ºå¯¸çš„slabï¼Œå†é€šè¿‡æŸç§æ–¹å¼æ‰¾åˆ°chunkï¼Œä¿è¯æ•°æ®è¿›å…¥ä¸€ä¸ªåˆé€‚å¤§å°çš„chunkä¸­å­˜å‚¨ï¼Œé˜²æ­¢å†…å­˜æµªè´¹ã€‚</p><p>ç›¸å¯¹äºMemecachedï¼ŒRedisçš„å†…å­˜ç®¡ç†è¦ç›¸å¯¹ç®€å•ã€‚</p><p>Redisæ¯ä¸€ä¸ªæ•°æ®å—éƒ½æ˜¯æ ¹æ®æ•°æ®ç±»å‹å’Œå¤§å°æ¥åˆ†é…ï¼Œæ¯ä¸€å—æ•°æ®çš„å…ƒæ•°æ®å­˜å…¥å†…å­˜å—å¤´éƒ¨ã€‚åˆ†é…å†…å­˜æ—¶ï¼Œredisè°ƒç”¨mallocåè¿”å›é¦–åœ°å€æŒ‡é’ˆ<code>real_ptr</code>ã€‚rediså°†å†…å­˜å—çš„å¤§å°sizeå­˜å…¥å¤´éƒ¨ï¼Œsizeæœ¬èº«æ‰€å æ®çš„å†…å­˜å¤§å°æ˜¯å›ºå®šä¸ºsizeof(typeof(size))ã€‚æ ¹æ®è¿™ä¸ªå¯ä»¥æ¨ç®—å­˜å‚¨çš„æ•°æ®çš„å†…å­˜æŒ‡é’ˆ<code>ret_ptr</code>ã€‚é‡Šæ”¾å†…å­˜æ—¶ï¼Œé€šè¿‡<code>ret_ptr</code>æ¥æ¨ç®—<code>real_ptr</code>å†è°ƒç”¨freeå‡½æ•°é‡Šæ”¾å†…å­˜ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>Memcacehdé¢„åˆ†é…å†…å­˜æ± ï¼Œç”¨ä¸åŒå¤§å°çš„å†…å­˜å•å…ƒæ¥ç®¡ç†å†…å­˜ï¼Œæ•°æ®é€‰æ‹©åˆé€‚çš„å†…å­˜å•å…ƒæ¥å­˜å‚¨ã€‚è¿™æ ·èŠ‚çœäº†ç”³è¯·/é‡Šæ”¾å†…å­˜çš„å¼€é”€ï¼Œå‡å°‘äº†å†…å­˜ç¢ç‰‡äº§ç”Ÿï¼Œä½†ä¾ç„¶ä¼šå¸¦æ¥å†…å­˜ç©ºé—´æµªè´¹ã€‚Memcachedé€šè¿‡è¿™ç§æ–¹å¼æ¥æœ€å¤§åŒ–å†…å­˜ç®¡ç†æ€§èƒ½ï¼Œæ˜¯æ—¶é—´ä¼˜å…ˆç­–ç•¥ã€‚</p><p>RedisæŒ‰éœ€ç”³è¯·å†…å­˜ï¼ŒRedisä¼šæŠŠå¸¦è¿‡æœŸæ—¶é—´çš„æ•°æ®å•ç‹¬å­˜æ”¾åœ¨ä¸€èµ·ï¼Œè¿™äº›æ•°æ®æ˜¯ä¸´æ—¶æ•°æ®ï¼Œä¸´æ—¶æ•°æ®ä¼šæ ¹æ®ç¼“å­˜è¿‡æœŸç­–ç•¥æ¥è¿›è¡Œå‰”é™¤ã€‚éä¸´æ—¶æ•°æ®åˆ™æ°¸è¿œä¸ä¼šå‰”é™¤ã€‚Redisæ›´å¥½åœ°åˆ©ç”¨äº†å†…å­˜ç©ºé—´ï¼Œæ˜¯ç©ºé—´ä¼˜å…ˆç­–ç•¥ã€‚</p><h2 id="æ•°æ®ä¸€è‡´æ€§"><a href="#æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§"></a>æ•°æ®ä¸€è‡´æ€§</h2><p>Redisæä¾›äº†äº‹åŠ¡ï¼Œè¿™ç§äº‹åŠ¡å¹¶éçœŸæ­£çš„äº‹åŠ¡å®ç°ã€‚è€Œä¸”è¿™ç§äº‹åŠ¡æ€§æ“ä½œå®¹æ˜“é€ æˆçº¿ç¨‹é˜»å¡ã€‚Memcachedä¼šè¿”å›æ“ä½œçš„ç»“æœï¼Œä¸ä¼šå½±å“å…¶ä»–æ•°æ®ã€‚</p><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>Memcachedæœ¬èº«ä¸æ”¯æŒé›†ç¾¤ï¼Œä½†å®ƒå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯æ¥å®ç°é›†ç¾¤æ“ä½œã€‚å®ƒé€šè¿‡å®¢æˆ·ç«¯ä¸Šçš„ç¨‹åºåº“æ¥å°è£…äº†å¯¹é›†ç¾¤æœåŠ¡å™¨è®¿é—®çš„æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·çœ‹èµ·æ¥ä¼¼ä¹æ˜¯åœ¨æ“ä½œä¸€ä¸ªèŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯çš„ç¨‹åºé€šè¿‡hashç®—æ³•æ¥é€‰æ‹©memcachedèŠ‚ç‚¹ï¼Œç„¶åå»è®¿é—®å¯¹åº”çš„èŠ‚ç‚¹ã€‚</p><p>Redisæ”¯æŒé›†ç¾¤ã€‚å„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡äºŒè¿›åˆ¶åè®®è¿›è¡Œé€šä¿¡ï¼ŒèŠ‚ç‚¹ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡asciiåè®®è¿›è¡Œé€šä¿¡ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li><p>å¦‚æœä¸šåŠ¡æ›´åŠ ä¾§é‡æ€§èƒ½çš„é«˜æ•ˆæ€§ï¼Œå¯¹æŒä¹…åŒ–è¦æ±‚ä¸é«˜ï¼Œé‚£ä¹ˆåº”è¯¥ä¼˜å…ˆé€‰æ‹©Memcachedã€‚</p><p>å…·ä½“åˆ°ä¸šåŠ¡æœ‰æœåŠ¡å™¨çš„å®æ—¶é…ç½®ã€å­˜å‚¨jsonå­—ç¬¦ä¸²ç­‰ç­‰ã€‚</p></li><li><p>å¯¹æŒä¹…åŒ–æœ‰é«˜éœ€æ±‚ï¼Œè¿½æ±‚å¤šç±»å‹æ•°æ®æ”¯æŒï¼Œé€‰æ‹©Redisã€‚</p><p>å…·ä½“åˆ°ä¸šåŠ¡æœ‰æ’è¡Œæ¦œç±»åº”ç”¨ã€ç¤¾äº¤å…³ç³»å­˜å‚¨ã€æ•°æ®æ’é‡ç­‰ç­‰ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼“å­˜ </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–ç¨‹æ¨¡å‹ä¹‹äº‹ä»¶å¾ªç¯</title>
      <link href="/2017/04/19/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B9%8B%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
      <url>/2017/04/19/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B9%8B%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<p>UIç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é¼ æ ‡ç‚¹å‡»ï¼Œé”®ç›˜æŒ‰é”®ç­‰è¿›è¡Œå“åº”ã€‚è¿™äº›ç”¨æˆ·æ“ä½œåœ¨ç¨‹åºä¸­è¢«ç§°ä¸ºäº‹ä»¶(æ¶ˆæ¯)ã€‚æˆ‘ä»¬å¦‚ä½•è·å¾—äº‹ä»¶å‘¢ï¼Ÿ</p><h2 id="ç”¨ä¸€ä¸ªçº¿ç¨‹è½®è¯¢æ£€æµ‹"><a href="#ç”¨ä¸€ä¸ªçº¿ç¨‹è½®è¯¢æ£€æµ‹" class="headerlink" title="ç”¨ä¸€ä¸ªçº¿ç¨‹è½®è¯¢æ£€æµ‹"></a>ç”¨ä¸€ä¸ªçº¿ç¨‹è½®è¯¢æ£€æµ‹</h2><p>äº‹ä»¶ç›¸å¯¹äºæ•´ä¸ªè¿è¡Œé˜¶æ®µå…¶å®æ˜¯éå¸¸æ—¶é—´ç¨€ç–çš„ï¼Œä½†è¿™æ ·ä¸€ä¸ªçº¿ç¨‹ä¸€ç›´è½®è¯¢ç›¸å½“äºåœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´å¤§éƒ¨åˆ†æ˜¯åšæ— ç”¨åŠŸï¼Œé€ æˆå¤§é‡çš„CPUèµ„æºæµªè´¹ã€‚</p><p>ç†æƒ³çŠ¶å†µæ—¶ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½æœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æ“ä½œçš„å“åº”ã€‚ç”±äº‹ä»¶å»é€šçŸ¥ä¸»çº¿ç¨‹è°ƒç”¨å›è°ƒå‡½æ•°ã€‚æœ‰ç‚¹ç±»ä¼¼äºåç¨‹çš„åŸç†ã€‚æˆ‘ä»¬é€šè¿‡äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å®ç°ã€‚</p><a id="more"></a><h2 id="äº‹ä»¶é©±åŠ¨æ¨¡å‹"><a href="#äº‹ä»¶é©±åŠ¨æ¨¡å‹" class="headerlink" title="äº‹ä»¶é©±åŠ¨æ¨¡å‹"></a>äº‹ä»¶é©±åŠ¨æ¨¡å‹</h2><p>äº‹ä»¶é©±åŠ¨æ¨¡å‹æœ‰å‡ å¤§è¦ç´ ï¼š</p><ul><li>ä¸€ä¸ªäº‹ä»¶(æ¶ˆæ¯)é˜Ÿåˆ—</li><li>æ¯å½“æœ‰ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿï¼Œå°±å¾€é˜Ÿåˆ—ä¸­å¢åŠ ä¸€ä¸ªäº‹ä»¶(æ¶ˆæ¯)</li><li>ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå®ƒä¸æ–­ä»é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶ï¼Œæ ¹æ®äº‹ä»¶æ¥è°ƒç”¨ç›¸åº”å›è°ƒå‡½æ•°ã€‚ä¾‹å¦‚é¼ æ ‡ç‚¹å‡»å¯¹åº”çš„<code>onclick()</code>ï¼Œé”®ç›˜æ•²å‡»å¯¹åº”çš„<code>onKeyDown()</code>ç­‰ã€‚</li><li>æ¯ä¸ªäº‹ä»¶(æ¶ˆæ¯)éƒ½ä¿å­˜è‡ªå·±çš„å›è°ƒå‡½æ•°æŒ‡é’ˆ ï¼Œè¿™æ ·æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ç‹¬ç«‹çš„å¤„ç†å‡½æ•°ã€‚</li></ul><h3 id="å•çº¿ç¨‹ã€å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯"><a href="#å•çº¿ç¨‹ã€å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯" class="headerlink" title="å•çº¿ç¨‹ã€å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯"></a>å•çº¿ç¨‹ã€å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯</h3><p>æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œä¸åŒäºå•çº¿ç¨‹çš„å›ºå®šç¨‹åºæ‰§è¡Œæµå’Œå¤šçº¿ç¨‹çš„å¹¶è¡Œ/å¹¶å‘æ‰§è¡Œæµï¼Œ<strong>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹èŒƒå¼</strong>çš„ç¨‹åºæ‰§è¡Œæµå–å†³äºå¤–éƒ¨äº‹ä»¶ã€‚ç”±äº‹ä»¶å¾ªç¯æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚<strong>å®ƒæ˜¯å…¸å‹çš„å¼‚æ­¥ç¼–ç¨‹</strong>ã€‚</p><p>å•çº¿ç¨‹ç¨‹åºç¼–å†™æœ€ç®€å•ï¼Œä»»åŠ¡æŒ‰ç…§å›ºå®šçš„é¡ºåºæ‰§è¡Œï¼Œå½“æŸä¸ªä»»åŠ¡å‘ç”Ÿäº†é˜»å¡ï¼Œå…¶ä»–çš„ä»»åŠ¡ä¹Ÿå¿…é¡»ç­‰å¾…ã€‚ç›´åˆ°å®ƒå®Œæˆä¹‹åå®ƒä»¬æ‰èƒ½ä¾æ¬¡æ‰§è¡Œã€‚å³ä½¿å„ä¸ªä»»åŠ¡å¹¶æ²¡æœ‰ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚å¯ä»¥ç†è§£ä¸ºå‡ ä¸ªäººåœ¨åŒä¸€ä¸ªé“¶è¡Œçª—å£æ’é˜Ÿå–æ¬¾ï¼Œæ¯ä¸ªäººéƒ½å¿…é¡»ç­‰å¾…å‰é¢çš„äººå–å¥½æ¬¾æ‰èƒ½å¼€å§‹å–æ¬¾ã€‚</p><p>å¤šçº¿ç¨‹ç¨‹åºç¼–å†™æ¯”è¾ƒå¤æ‚ï¼Œä»»åŠ¡åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šè¿è¡Œï¼Œè¿™äº›çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œå¦‚æœCPUæ˜¯å•æ ¸ï¼Œé‚£ä¹ˆè¿™äº›çº¿ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œï¼Œå¦‚æœCPUæ˜¯å¤šæ ¸ï¼Œé‚£ä¹ˆè¿™äº›çº¿ç¨‹å¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚è¿™ç§æ–¹æ³•ç”±äºæŠŠå„ä¸ªçº¿ç¨‹çš„é˜»å¡æ—¶é—´æ®µé‡å äº†ï¼Œæå‡äº†ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚ä½†å¤šçº¿ç¨‹ç¨‹åºå¿…é¡»é¢ä¸´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¤šä¸ªçº¿ç¨‹éœ€è¦å¤„ç†å¥½å…±äº«èµ„æºçš„é—®é¢˜ã€‚å¯ä»¥ç†è§£ä¸ºå‡ ä¸ªäººåœ¨ä¸åŒçš„é“¶è¡Œçª—å£å–æ¬¾ï¼Œä»–ä»¬åŒæ­¥åŠç†å–æ¬¾ä¸šåŠ¡ï¼Œä½†é“¶è¡Œåªæœ‰ä¸€å°éªŒé’æœºï¼ˆå…±äº«èµ„æºï¼‰ï¼Œæ‰€ä»¥å„ä¸ªäººçš„å¤„ç†è¿›åº¦éƒ½ä¸éªŒé’æœºçš„åˆ†é…æœ‰å…³ã€‚</p><p>äº‹ä»¶é©±åŠ¨ç¨‹åºä¸­ï¼Œå¤šä¸ªä»»åŠ¡äº¤é”™åœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå½“ç­‰å¾…I/Oç­‰é˜»å¡æ“ä½œæ—¶ï¼Œå®ƒä»¬æ³¨å†Œä¸€ä¸ªå›è°ƒåˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç„¶åé˜»å¡æ“ä½œå®Œæˆåï¼Œç»§ç»­æ‰§è¡Œã€‚å›è°ƒæè¿°äº†å¦‚ä½•å¤„ç†æŸä¸ªäº‹ä»¶ã€‚äº‹ä»¶å¾ªç¯è½®è¯¢äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ï¼Œå¹¶è°ƒç”¨å›è°ƒå‡½æ•°ã€‚å®ƒæ¯”å¤šçº¿ç¨‹ç¨‹åºæ›´ç›´è§‚ï¼Œç¨‹åºå‘˜æ— éœ€å…³å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¯ä»¥ç†è§£ä¸ºå¯ä»¥ç†è§£ä¸ºå‡ ä¸ªäººåœ¨åŒä¸€ä¸ªé“¶è¡Œçª—å£æ’é˜Ÿå–æ¬¾ï¼Œå‰é¢æœ‰ä¸€ä¸ªäººéœ€è¦å»æ´—æ‰‹é—´ï¼Œé‚£ä¹ˆçª—å£å¼€å§‹å¤„ç†ä¸‹ä¸€ä¸ªäººçš„ä¸šåŠ¡ï¼Œç­‰é’±ä¸€ä¸ªäººå›æ¥ï¼Œå†ç»§ç»­å¤„ç†ä»–çš„ä¸šåŠ¡ã€‚</p><h3 id="ä½•æ—¶ä½¿ç”¨äº‹ä»¶å¾ªç¯"><a href="#ä½•æ—¶ä½¿ç”¨äº‹ä»¶å¾ªç¯" class="headerlink" title="ä½•æ—¶ä½¿ç”¨äº‹ä»¶å¾ªç¯"></a>ä½•æ—¶ä½¿ç”¨äº‹ä»¶å¾ªç¯</h3><ul><li>ç¨‹åºä¸­çš„å¤šä¸ªä»»åŠ¡é«˜åº¦ç‹¬ç«‹ï¼Œä¸äº’ç›¸é€šä¿¡æˆ–ä¾èµ–</li><li>ç­‰å¾…äº‹ä»¶åˆ°æ¥ä¹‹å‰ï¼Œä»»åŠ¡ä¼šé˜»å¡ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŠå…¶å®ç°</title>
      <link href="/2017/04/04/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B9%8B%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/"/>
      <url>/2017/04/04/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B9%8B%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>ä¸šåŠ¡ä¸­æœ‰Nå°redisç¼“å­˜æœåŠ¡å™¨ [0, N-1]ï¼Œé‚£ä¹ˆå¯¹äºä»»æ„ä¸€ä¸ªå…³é”®å­—keyçš„è¯·æ±‚ï¼Œæˆ‘ä»¬éƒ½æ˜¯åšä¸€ä¸ªå¯¹keyå“ˆå¸Œå€¼å–æ¨¡çš„è¯·æ±‚åˆ†å‘ã€‚å‰å°è¯·æ±‚è¢«åˆ†å‘åˆ°ç¼–å·(hash(key)%N)è¿™å°æœåŠ¡å™¨ä¸Šã€‚ç†æƒ³çŠ¶æ€ä¸‹ï¼Œè¿™æ ·çš„ç¼“å­˜å‘½ä¸­ç‡æ˜¯å¾ˆé«˜çš„ã€‚ä½†å½“å› ä¸ºä¸šåŠ¡éœ€æ±‚è€Œå¢åˆ æœåŠ¡èŠ‚ç‚¹æ•°ï¼Œä¾‹å¦‚æ·»åŠ ä¸€å°æœåŠ¡å™¨ã€‚é‚£ä¹ˆåŸæ¥è¢«åˆ†é…åˆ°kå·æœåŠ¡å™¨çš„ç°åœ¨ä¼šè¢«åˆ†åˆ°(k-1)å·æœåŠ¡å™¨ã€‚è¿™ä¸ªæ—¶å€™å‡ ä¹æ‰€æœ‰çš„ç¼“å­˜å…¨éƒ¨ä¼šè¢«missæ‰ï¼Œé€ æˆæå¤§çš„ä¸šåŠ¡å‹åŠ›ã€‚</p><p><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ç›®çš„å°±æ˜¯ï¼Œå½“åå°å¢åˆ èŠ‚ç‚¹æ—¶ï¼Œæ—§çš„æ•°æ®èƒ½å¤Ÿä¾æ—§è®¡ç®—åˆ°åŸæ¥çš„æœåŠ¡å™¨ï¼Œè€Œæ–°æ•°æ®èƒ½å¤ŸæŒ‰æ–°çš„å“ˆå¸Œç®—æ³•åˆ†é…åˆ°æ–°æœåŠ¡å™¨ã€‚</strong></p><a id="more"></a><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æŠŠNä¸ªæœåŠ¡èŠ‚ç‚¹æ˜ å°„åˆ°ä¸€ä¸ªç¯ä¸Šã€‚å¯¹æ¯ä¸ªæœåŠ¡èŠ‚ç‚¹çš„keyå€¼è¿›è¡Œhashè®¡ç®—ï¼Œè·å¾—ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•°ç»„ï¼Œå†æŠŠæ•°ç»„é¦–å°¾ç›¸è¿ï¼Œè·å¾—ä¸€ä¸ªç¯ã€‚æˆ‘ä»¬å¯¹æ‰€æœ‰çš„è¯·æ±‚èŠ‚ç‚¹keyä½œhashè®¡ç®—ï¼Œä¼šè½å…¥è¯¥ç¯çš„æŸä¸€ä¸ªå¼§æ®µï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šæ¯ä¸ªå¼§æ®µä¸Šçš„è¯·æ±‚èŠ‚ç‚¹éƒ½ä»¥é¡ºæ—¶é’ˆæœ€è¿‘çš„Nodeä½œä¸ºæœåŠ¡èŠ‚ç‚¹ã€‚è¿™æ ·å¢åŠ æˆ–å‡å°‘æœåŠ¡èŠ‚ç‚¹ï¼Œé‚£å½±å“çš„ä¹Ÿåªæ˜¯ä¸€ä¸ªå¼§æ®µä¸Šçš„è¯·æ±‚èŠ‚ç‚¹ï¼Œè€Œå…¶ä»–å¼§æ®µä¸Šçš„è¯·æ±‚èŠ‚ç‚¹åˆ™ä¸å—å½±å“ã€‚</p><p>è¿™å®é™…ä¸Šå°±æ˜¯æŠŠæ˜ å°„ç¯å¢å¤§äº†ã€‚å‡å°‘äº†æ•°æ®æ˜ å°„å…³ç³»çš„å˜åŠ¨ï¼Œä¸ä¼šåƒhash(i)%Né‚£æ ·å¸¦æ¥å…¨å±€çš„å˜åŠ¨ã€‚</p><p>å¦‚æœæŸä¸€ä¸ªå¼§æ®µä¸Šçš„èŠ‚ç‚¹å¯†åº¦å¾ˆå¤§ï¼Œå¯¼è‡´å•ä¸ªæœåŠ¡èŠ‚ç‚¹è¿‡è½½ï¼Œå³çƒ­ç‚¹æ•°æ®é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå¼§æ®µä¸Šå¢åŠ ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹å°±å¯ä»¥åˆ†æ‹…å‹åŠ›ã€‚</p><h2 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h2><h3 id="é›ªå´©æ•ˆåº”"><a href="#é›ªå´©æ•ˆåº”" class="headerlink" title="é›ªå´©æ•ˆåº”"></a>é›ªå´©æ•ˆåº”</h3><p>ä¸Šè¿°çš„ç®—æ³•æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯å¦‚æœæŸä¸ªæœåŠ¡èŠ‚ç‚¹å› ä¸ºè¿‡è½½è€Œdownæ‰ï¼Œé‚£ä¹ˆåŸæœ¬åˆ†é…åœ¨å®ƒä¸Šé¢çš„è´Ÿè½½éƒ½ä¼šè¢«åˆ†é…åˆ°é¡ºæ—¶é’ˆä¸‹ä¸€å°æœåŠ¡å™¨ä¸Šå»ï¼Œé‚£ä¹ˆä¸‹ä¸€å°æœåŠ¡å™¨ä¹Ÿä¼šdownæ‰ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæ‰€æœ‰çš„æœåŠ¡å™¨æœ€ç»ˆéƒ½ä¼šæŒ‚æ‰ã€‚è¿™å°±æ˜¯é›ªå´©æ•ˆåº”ã€‚</p><p>ä¸ºäº†è§£å†³é›ªå´©æ•ˆåº”ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ï¼Œå½“ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹æŒ‚æ‰çš„æ—¶å€™ï¼Œåˆ†é…åœ¨ä¸Šé¢çš„æµé‡è¢«å…¶ä»–çš„æœåŠ¡èŠ‚ç‚¹å…±åŒåˆ†æ‹…ã€‚è¿™æ ·æ‰èƒ½ä¿è¯æ•´ä¸ªé›†ç¾¤çš„å¯ç”¨æ€§ã€‚å› æ­¤ï¼Œå¯ä»¥é‡‡ç”¨<strong>è™šæ‹ŸèŠ‚ç‚¹</strong>çš„æ–¹å¼æ¥æ”¹è¿›ç®—æ³•ã€‚</p><h3 id="è™šæ‹ŸèŠ‚ç‚¹"><a href="#è™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="è™šæ‹ŸèŠ‚ç‚¹"></a>è™šæ‹ŸèŠ‚ç‚¹</h3><p>è¿™é‡ŒæŠŠæ¯ä¸ªæœåŠ¡å™¨åˆ†ä¸ºä¸¤ä¸ªå‰¯æœ¬èŠ‚ç‚¹ï¼Œæ¯ä¸ªå‰¯æœ¬èŠ‚ç‚¹è´Ÿè´£ä¸€ä¸ªæ›´ç²¾ç»†çš„ç¯ï¼Œå¦‚å›¾å¯ä»¥å¾—çŸ¥ï¼Œå¦‚æœAæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆåŸæœ¬åˆ†é…ç»™Açš„ä¸¤ä¸ªå°ç¯çš„æµé‡ä¼šè¢«Då’ŒCæ¥åˆ†æ‘Šã€‚å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ å‰¯æœ¬èŠ‚ç‚¹çš„æ•°é‡æ¥æé«˜ç®—æ³•çš„å‡è¡¡æ€§ã€‚</p><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashRing</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, nodes=None, replicas=<span class="number">3</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åˆ›å»ºä¸€ä¸ªhashç¯</span></span><br><span class="line"><span class="string">        :nodes </span></span><br><span class="line"><span class="string">            èŠ‚ç‚¹ </span></span><br><span class="line"><span class="string">        :replicas</span></span><br><span class="line"><span class="string">            æ¯ä¸ªæœåŠ¡èŠ‚ç‚¹çš„å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self.replicas = replicas</span><br><span class="line">        self.ring = &#123;&#125;</span><br><span class="line">        self._sorted_keys = []</span><br><span class="line">        <span class="keyword">if</span> nodes:</span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> nodes:</span><br><span class="line">                self.add_node(node)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_node</span>(<span class="params">self, node</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æŠŠä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹åŠ å…¥hashç¯</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, self.replicas):</span><br><span class="line">            key = self.gen_key(<span class="string">&quot;%s:%s&quot;</span> % (node, i))</span><br><span class="line">            self.ring[key] = node</span><br><span class="line">            self._sorted_keys.append(key)</span><br><span class="line"></span><br><span class="line">        self._sorted_keys.sort()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove_node</span>(<span class="params">self, node</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ä»hashç¯åˆ é™¤ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, self.replicas):</span><br><span class="line">            key = self.gen_key(<span class="string">&quot;%s:%s&quot;</span> % (node, i))</span><br><span class="line">            <span class="keyword">del</span> self.ring[key]</span><br><span class="line">            self._sorted_keys.remove(key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_node_keys</span>(<span class="params">self, node</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è·å–ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹çš„æ‰€æœ‰å‰¯æœ¬çš„è™šæ‹Ÿkey</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        keys = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, self.replicas):</span><br><span class="line">            key = self.gen_key(<span class="string">&quot;%s:%s&quot;</span> % (node, i))</span><br><span class="line">            keys.append(key)</span><br><span class="line">        <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_node</span>(<span class="params">self, string_key</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">å¯¹äºç»™å®šçš„key è·å–å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹ï¼Œè¿”å›èŠ‚ç‚¹</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.get_node_pos(string_key)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_node_pos</span>(<span class="params">self, string_key</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å¯¹äºç»™å®šçš„key è·å–å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹ï¼Œè¿”å›èŠ‚ç‚¹å’Œä½ç½®</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.ring:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        key = self.gen_key(string_key)</span><br><span class="line">        nodes = self._sorted_keys</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(nodes)):</span><br><span class="line">            node = nodes[i]</span><br><span class="line">            <span class="keyword">if</span> key &lt;= node:</span><br><span class="line">                <span class="keyword">return</span> self.ring[node], i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.ring[nodes[<span class="number">0</span>]], <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_nodes</span>(<span class="params">self, string_key</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å¯¹äºä¸€ä¸ªç»™å®šçš„key ï¼Œè¿”å›ä¸€ä¸ª</span></span><br><span class="line"><span class="string">        Given a string key it returns the nodes as a generator that can hold the key.</span></span><br><span class="line"><span class="string">        The generator is never ending and iterates through the ring starting at the correct position.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.ring:</span><br><span class="line">            <span class="keyword">yield</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        node, pos = self.get_node_pos(string_key)</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self._sorted_keys:</span><br><span class="line">            <span class="keyword">yield</span> self.ring[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_key</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä»¥md5ç®—æ³•æ¥è¿›è¡Œhash(key)è¿ç®—</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        m = md5.new()</span><br><span class="line">        m.update(key)</span><br><span class="line">        <span class="keyword">return</span> long(m.hexdigest(), <span class="number">16</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisé¢è¯•é¢˜è§£ç­”</title>
      <link href="/2017/04/03/Redis/Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E8%A7%A3%E7%AD%94/"/>
      <url>/2017/04/03/Redis/Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E8%A7%A3%E7%AD%94/</url>
      
        <content type="html"><![CDATA[<p>å¯¹å¸¸è§Redisé¢è¯•é¢˜åšä¸ªè®°å½•ã€‚</p><a id="more"></a><h2 id="æ¦‚å¿µé¢˜"><a href="#æ¦‚å¿µé¢˜" class="headerlink" title="æ¦‚å¿µé¢˜"></a>æ¦‚å¿µé¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯Redis"><a href="#ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="ä»€ä¹ˆæ˜¯Redis"></a>ä»€ä¹ˆæ˜¯Redis</h3><p>Redis(Remote Dictionary Server) æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€ç¼–å†™çš„ï¼Œå¼€æºçš„ï¼ˆBSDè®¸å¯ï¼‰é«˜æ€§èƒ½éå…³ç³»å‹ï¼ˆNoSQLï¼‰çš„é”®å€¼å¯¹æ•°æ®åº“ã€‚</p><p>Redis å¯ä»¥å­˜å‚¨é”®å’Œäº”ç§ä¸åŒç±»å‹çš„å€¼ä¹‹é—´çš„æ˜ å°„ã€‚é”®çš„ç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼æ”¯æŒäº”ç§æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆã€æ•£åˆ—è¡¨ã€æœ‰åºé›†åˆã€‚</p><p>ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚å¦å¤–ï¼ŒRedis ä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedis æ”¯æŒäº‹åŠ¡ ã€æŒä¹…åŒ–ã€LUAè„šæœ¬ã€LRUé©±åŠ¨äº‹ä»¶ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</p><h3 id="Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹"><a href="#Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹" class="headerlink" title="Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹"></a>Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹</p><ul><li>è¯»å†™æ€§èƒ½ä¼˜å¼‚ï¼Œ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œæ”¯æŒAOFå’ŒRDBä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚</li><li>æ”¯æŒäº‹åŠ¡ï¼ŒRedisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶Redisè¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œåˆå¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚</li><li>æ•°æ®ç»“æ„ä¸°å¯Œï¼Œé™¤äº†æ”¯æŒstringç±»å‹çš„valueå¤–è¿˜æ”¯æŒhashã€setã€zsetã€listç­‰æ•°æ®ç»“æ„ã€‚</li><li>æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</li><li>Redis ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚</li><li>ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li><li>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨-Redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-Redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜"></a>ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜</h3><p>ä¸»è¦ä»â€œé«˜æ€§èƒ½â€å’Œâ€œé«˜å¹¶å‘â€è¿™ä¸¤ç‚¹æ¥çœ‹å¾…è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>é«˜æ€§èƒ½ï¼š</strong></p><p>å‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ä¸­çš„æŸäº›æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ˜¯ä»ç¡¬ç›˜ä¸Šè¯»å–çš„ã€‚å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®å­˜åœ¨æ•°ç¼“å­˜ä¸­ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ã€‚æ“ä½œç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚å¦‚æœæ•°æ®åº“ä¸­çš„å¯¹åº”æ•°æ®æ”¹å˜çš„ä¹‹åï¼ŒåŒæ­¥æ”¹å˜ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å³å¯ï¼</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDUzNDg2OS02N2YxOGVmY2FmZTQ2NjlhLmpwZw?x-oss-process=image/format,png" alt="img"></p><p><strong>é«˜å¹¶å‘ï¼š</strong></p><p>ç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDUzNDg2OS0wOWIxZDI3OWEwNWVmNWJjLmpwZw?x-oss-process=image/format,png" alt="img"></p><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨-Redis-è€Œä¸ç”¨-map-guava-åšç¼“å­˜"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-Redis-è€Œä¸ç”¨-map-guava-åšç¼“å­˜" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ Redis è€Œä¸ç”¨ map/guava åšç¼“å­˜?"></a>ä¸ºä»€ä¹ˆè¦ç”¨ Redis è€Œä¸ç”¨ map/guava åšç¼“å­˜?</h3><p>ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚ä»¥ Java ä¸ºä¾‹ï¼Œä½¿ç”¨è‡ªå¸¦çš„ map æˆ–è€… guava å®ç°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯è½»é‡ä»¥åŠå¿«é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸéšç€ jvm çš„é”€æ¯è€Œç»“æŸï¼Œå¹¶ä¸”åœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ã€‚</p><p>ä½¿ç”¨ redis æˆ– memcached ä¹‹ç±»çš„ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå„å®ä¾‹å…±ç”¨ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å…·æœ‰ä¸€è‡´æ€§ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¿æŒ redis æˆ– memcachedæœåŠ¡çš„é«˜å¯ç”¨ï¼Œæ•´ä¸ªç¨‹åºæ¶æ„ä¸Šè¾ƒä¸ºå¤æ‚ã€‚</p><h3 id="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><a href="#Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="headerlink" title="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"></a>Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h3><p>1ã€å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMapï¼ŒHashMap çš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›</p><p>2ã€æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedis ä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼›</p><p>3ã€é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›</p><p>4ã€ä½¿ç”¨å¤šè·¯ I/O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ IOï¼›</p><p>5ã€ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedis ç›´æ¥è‡ªå·±æ„å»ºäº† VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ï¼›</p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="Redisæœ‰å“ªäº›æ•°æ®ç±»å‹"><a href="#Redisæœ‰å“ªäº›æ•°æ®ç±»å‹" class="headerlink" title="Redisæœ‰å“ªäº›æ•°æ®ç±»å‹"></a>Redisæœ‰å“ªäº›æ•°æ®ç±»å‹</h3><p>Redisä¸»è¦æœ‰5ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬Stringï¼ŒListï¼ŒSetï¼ŒZsetï¼ŒHashï¼Œæ»¡è¶³å¤§éƒ¨åˆ†çš„ä½¿ç”¨è¦æ±‚</p><div class="table-container"><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å¯ä»¥å­˜å‚¨çš„å€¼</th><th>æ“ä½œ</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>STRING</td><td>å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td><td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œ</td><td>åšç®€å•çš„é”®å€¼å¯¹ç¼“å­˜</td></tr><tr><td>LIST</td><td>åˆ—è¡¨</td><td>ä»ä¸¤ç«¯å‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´  å¯¹å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ è¿›è¡Œä¿®å‰ªï¼Œ åªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td><td>å­˜å‚¨ä¸€äº›åˆ—è¡¨å‹çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼ç²‰ä¸åˆ—è¡¨ã€æ–‡ç« çš„è¯„è®ºåˆ—è¡¨ä¹‹ç±»çš„æ•°æ®</td></tr><tr><td>SET</td><td>æ— åºé›†åˆ</td><td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´  æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›† ä»é›†åˆé‡Œé¢éšæœºè·å–å…ƒç´ </td><td>äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œï¼Œæ¯”å¦‚äº¤é›†ï¼Œå¯ä»¥æŠŠä¸¤ä¸ªäººçš„ç²‰ä¸åˆ—è¡¨æ•´ä¸€ä¸ªäº¤é›†</td></tr><tr><td>HASH</td><td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td><td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ è·å–æ‰€æœ‰é”®å€¼å¯¹ æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨</td><td>ç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡</td></tr><tr><td>ZSET</td><td>æœ‰åºé›†åˆ</td><td>æ·»åŠ ã€è·å–ã€åˆ é™¤å…ƒç´  æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´  è®¡ç®—ä¸€ä¸ªé”®çš„æ’å</td><td>å»é‡ä½†å¯ä»¥æ’åºï¼Œå¦‚è·å–æ’åå‰å‡ åçš„ç”¨æˆ·</td></tr></tbody></table></div><h3 id="Redisçš„åº”ç”¨åœºæ™¯"><a href="#Redisçš„åº”ç”¨åœºæ™¯" class="headerlink" title="Redisçš„åº”ç”¨åœºæ™¯"></a>Redisçš„åº”ç”¨åœºæ™¯</h3><p><strong>æ€»ç»“ä¸€</strong></p><p>è®¡æ•°å™¨</p><p>å¯ä»¥å¯¹ String è¿›è¡Œè‡ªå¢è‡ªå‡è¿ç®—ï¼Œä»è€Œå®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“çš„è¯»å†™æ€§èƒ½éå¸¸é«˜ï¼Œå¾ˆé€‚åˆå­˜å‚¨é¢‘ç¹è¯»å†™çš„è®¡æ•°é‡ã€‚</p><p>ç¼“å­˜</p><p>å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚</p><p>ä¼šè¯ç¼“å­˜</p><p>å¯ä»¥ä½¿ç”¨ Redis æ¥ç»Ÿä¸€å­˜å‚¨å¤šå°åº”ç”¨æœåŠ¡å™¨çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åº”ç”¨æœåŠ¡å™¨ä¸å†å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿå°±ä¸å†å…·æœ‰çŠ¶æ€ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»æ„ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œä»è€Œæ›´å®¹æ˜“å®ç°é«˜å¯ç”¨æ€§ä»¥åŠå¯ä¼¸ç¼©æ€§ã€‚</p><p>å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰</p><p>é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚</p><p>æŸ¥æ‰¾è¡¨</p><p>ä¾‹å¦‚ DNS è®°å½•å°±å¾ˆé€‚åˆä½¿ç”¨ Redis è¿›è¡Œå­˜å‚¨ã€‚æŸ¥æ‰¾è¡¨å’Œç¼“å­˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº† Redis å¿«é€Ÿçš„æŸ¥æ‰¾ç‰¹æ€§ã€‚ä½†æ˜¯æŸ¥æ‰¾è¡¨çš„å†…å®¹ä¸èƒ½å¤±æ•ˆï¼Œè€Œç¼“å­˜çš„å†…å®¹å¯ä»¥å¤±æ•ˆï¼Œå› ä¸ºç¼“å­˜ä¸ä½œä¸ºå¯é çš„æ•°æ®æ¥æºã€‚</p><p>æ¶ˆæ¯é˜Ÿåˆ—(å‘å¸ƒ/è®¢é˜…åŠŸèƒ½)</p><p>List æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ lpush å’Œ rpop å†™å…¥å’Œè¯»å–æ¶ˆæ¯ã€‚ä¸è¿‡æœ€å¥½ä½¿ç”¨ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><p>åˆ†å¸ƒå¼é”å®ç°</p><p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•æœºç¯å¢ƒä¸‹çš„é”æ¥å¯¹å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹è¿›è¡ŒåŒæ­¥ã€‚å¯ä»¥ä½¿ç”¨ Redis è‡ªå¸¦çš„ SETNX å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°ã€‚</p><p>å…¶å®ƒ</p><p>Set å¯ä»¥å®ç°äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œï¼Œä»è€Œå®ç°å…±åŒå¥½å‹ç­‰åŠŸèƒ½ã€‚ZSet å¯ä»¥å®ç°æœ‰åºæ€§æ“ä½œï¼Œä»è€Œå®ç°æ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚</p><p><strong>æ€»ç»“äºŒ</strong></p><p>Redisç›¸æ¯”å…¶ä»–ç¼“å­˜ï¼Œæœ‰ä¸€ä¸ªéå¸¸å¤§çš„ä¼˜åŠ¿ï¼Œå°±æ˜¯æ”¯æŒå¤šç§æ•°æ®ç±»å‹ã€‚</p><p>æ•°æ®ç±»å‹è¯´æ˜stringå­—ç¬¦ä¸²ï¼Œæœ€ç®€å•çš„k-vå­˜å‚¨hashhashæ ¼å¼ï¼Œvalueä¸ºfieldå’Œvalueï¼Œé€‚åˆID-Detailè¿™æ ·çš„åœºæ™¯ã€‚listç®€å•çš„listï¼Œé¡ºåºåˆ—è¡¨ï¼Œæ”¯æŒé¦–ä½æˆ–è€…æœ«å°¾æ’å…¥æ•°æ®setæ— åºlistï¼ŒæŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œé€‚åˆäº¤é›†ã€å¹¶é›†ã€å·®é›†å¤„ç†sorted setæœ‰åºçš„set</p><p>å…¶å®ï¼Œé€šè¿‡ä¸Šé¢çš„æ•°æ®ç±»å‹çš„ç‰¹æ€§ï¼ŒåŸºæœ¬å°±èƒ½æƒ³åˆ°åˆé€‚çš„åº”ç”¨åœºæ™¯äº†ã€‚</p><p>stringâ€”â€”é€‚åˆæœ€ç®€å•çš„k-vå­˜å‚¨ï¼Œç±»ä¼¼äºmemcachedçš„å­˜å‚¨ç»“æ„ï¼ŒçŸ­ä¿¡éªŒè¯ç ï¼Œé…ç½®ä¿¡æ¯ç­‰ï¼Œå°±ç”¨è¿™ç§ç±»å‹æ¥å­˜å‚¨ã€‚</p><p>hashâ€”â€”ä¸€èˆ¬keyä¸ºIDæˆ–è€…å”¯ä¸€æ ‡ç¤ºï¼Œvalueå¯¹åº”çš„å°±æ˜¯è¯¦æƒ…äº†ã€‚å¦‚å•†å“è¯¦æƒ…ï¼Œä¸ªäººä¿¡æ¯è¯¦æƒ…ï¼Œæ–°é—»è¯¦æƒ…ç­‰ã€‚</p><p>listâ€”â€”å› ä¸ºlistæ˜¯æœ‰åºçš„ï¼Œæ¯”è¾ƒé€‚åˆå­˜å‚¨ä¸€äº›æœ‰åºä¸”æ•°æ®ç›¸å¯¹å›ºå®šçš„æ•°æ®ã€‚å¦‚çœå¸‚åŒºè¡¨ã€å­—å…¸è¡¨ç­‰ã€‚å› ä¸ºlistæ˜¯æœ‰åºçš„ï¼Œé€‚åˆæ ¹æ®å†™å…¥çš„æ—¶é—´æ¥æ’åºï¼Œå¦‚ï¼šæœ€æ–°çš„<em>*</em>ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</p><p>setâ€”â€”å¯ä»¥ç®€å•çš„ç†è§£ä¸ºID-Listçš„æ¨¡å¼ï¼Œå¦‚å¾®åšä¸­ä¸€ä¸ªäººæœ‰å“ªäº›å¥½å‹ï¼Œsetæœ€ç‰›çš„åœ°æ–¹åœ¨äºï¼Œå¯ä»¥å¯¹ä¸¤ä¸ªsetæä¾›äº¤é›†ã€å¹¶é›†ã€å·®é›†æ“ä½œã€‚ä¾‹å¦‚ï¼šæŸ¥æ‰¾ä¸¤ä¸ªäººå…±åŒçš„å¥½å‹ç­‰ã€‚</p><p>Sorted Setâ€”â€”æ˜¯setçš„å¢å¼ºç‰ˆæœ¬ï¼Œå¢åŠ äº†ä¸€ä¸ªscoreå‚æ•°ï¼Œè‡ªåŠ¨ä¼šæ ¹æ®scoreçš„å€¼è¿›è¡Œæ’åºã€‚æ¯”è¾ƒé€‚åˆç±»ä¼¼äºtop 10ç­‰ä¸æ ¹æ®æ’å…¥çš„æ—¶é—´æ¥æ’åºçš„æ•°æ®ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œè™½ç„¶Redisä¸åƒå…³ç³»æ•°æ®åº“é‚£ä¹ˆå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯ï¼Œä¹Ÿèƒ½é€‚åˆå¾ˆå¤šåœºæ™¯ï¼Œæ¯”ä¸€èˆ¬çš„ç¼“å­˜æ•°æ®ç»“æ„è¦å¤šã€‚äº†è§£æ¯ç§æ•°æ®ç»“æ„é€‚åˆçš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸ä»…æœ‰åˆ©äºæå‡å¼€å‘æ•ˆç‡ï¼Œä¹Ÿèƒ½æœ‰æ•ˆåˆ©ç”¨Redisçš„æ€§èƒ½ã€‚</p><h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><h3 id="ä»€ä¹ˆæ˜¯RedisæŒä¹…åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯RedisæŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯RedisæŒä¹…åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯RedisæŒä¹…åŒ–ï¼Ÿ</h3><p>æŒä¹…åŒ–å°±æ˜¯æŠŠå†…å­˜çš„æ•°æ®å†™åˆ°ç£ç›˜ä¸­å»ï¼Œé˜²æ­¢æœåŠ¡å®•æœºäº†å†…å­˜æ•°æ®ä¸¢å¤±ã€‚</p><h3 id="Redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#Redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>Redis æä¾›ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ RDBï¼ˆé»˜è®¤ï¼‰ å’Œ AOF æœºåˆ¶:</p><p>RDBï¼šæ˜¯Redis DataBaseç¼©å†™å¿«ç…§</p><p>RDBæ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚æŒ‰ç…§ä¸€å®šçš„æ—¶é—´å°†å†…å­˜çš„æ•°æ®ä»¥å¿«ç…§çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œå¯¹åº”äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ä¸ºdump.rdbã€‚é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„saveå‚æ•°æ¥å®šä¹‰å¿«ç…§çš„å‘¨æœŸã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MDU1NjY2LWMwNzAyMjIzMTUxODUyMjkucG5n?x-oss-process=image/format,png" alt="img"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>1ã€åªæœ‰ä¸€ä¸ªæ–‡ä»¶ dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚</li><li>2ã€å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚</li><li>3ã€æ€§èƒ½æœ€å¤§åŒ–ï¼Œfork å­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯ IO æœ€å¤§åŒ–ã€‚ä½¿ç”¨å•ç‹¬å­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¿›è¡Œä»»ä½• IO æ“ä½œï¼Œä¿è¯äº† redis çš„é«˜æ€§èƒ½</li><li>4.ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„å¯åŠ¨æ•ˆç‡æ›´é«˜ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>1ã€æ•°æ®å®‰å…¨æ€§ä½ã€‚RDB æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹é—´ redis å‘ç”Ÿæ•…éšœï¼Œä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æ›´é€‚åˆæ•°æ®è¦æ±‚ä¸ä¸¥è°¨çš„æ—¶å€™)</li><li>2ã€AOFï¼ˆAppend-only file)æŒä¹…åŒ–æ–¹å¼ï¼š æ˜¯æŒ‡æ‰€æœ‰çš„å‘½ä»¤è¡Œè®°å½•ä»¥ redis å‘½ä»¤è¯· æ±‚åè®®çš„æ ¼å¼å®Œå…¨æŒä¹…åŒ–å­˜å‚¨)ä¿å­˜ä¸º aof æ–‡ä»¶ã€‚</li></ul><p>AOFï¼šæŒä¹…åŒ–</p><p>AOFæŒä¹…åŒ–(å³Append Only FileæŒä¹…åŒ–)ï¼Œåˆ™æ˜¯å°†Redisæ‰§è¡Œçš„æ¯æ¬¡å†™å‘½ä»¤è®°å½•åˆ°å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“é‡å¯Redisä¼šé‡æ–°å°†æŒä¹…åŒ–çš„æ—¥å¿—ä¸­æ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p><p>å½“ä¸¤ç§æ–¹å¼åŒæ—¶å¼€å¯æ—¶ï¼Œæ•°æ®æ¢å¤Redisä¼šä¼˜å…ˆé€‰æ‹©AOFæ¢å¤ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MDU1NjY2LWUxN2NlNTY0NGZjN2FjZjMucG5n?x-oss-process=image/format,png" alt="img"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>1ã€æ•°æ®å®‰å…¨ï¼Œaof æŒä¹…åŒ–å¯ä»¥é…ç½® appendfsync å±æ€§ï¼Œæœ‰ alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡ å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° aof æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚</li><li>2ã€é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li>3ã€AOF æœºåˆ¶çš„ rewrite æ¨¡å¼ã€‚AOF æ–‡ä»¶æ²¡è¢« rewrite ä¹‹å‰ï¼ˆæ–‡ä»¶è¿‡å¤§æ—¶ä¼šå¯¹å‘½ä»¤ è¿›è¡Œåˆå¹¶é‡å†™ï¼‰ï¼Œå¯ä»¥åˆ é™¤å…¶ä¸­çš„æŸäº›å‘½ä»¤ï¼ˆæ¯”å¦‚è¯¯æ“ä½œçš„ flushallï¼‰)</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>1ã€AOF æ–‡ä»¶æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚</li><li>2ã€æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯” rdb å¯åŠ¨æ•ˆç‡ä½ã€‚</li></ul><p>ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>AOFæ–‡ä»¶æ¯”RDBæ›´æ–°é¢‘ç‡é«˜ï¼Œä¼˜å…ˆä½¿ç”¨AOFè¿˜åŸæ•°æ®ã€‚</li><li>AOFæ¯”RDBæ›´å®‰å…¨ä¹Ÿæ›´å¤§</li><li>RDBæ€§èƒ½æ¯”AOFå¥½</li><li>å¦‚æœä¸¤ä¸ªéƒ½é…äº†ä¼˜å…ˆåŠ è½½AOF</li></ul><h3 id="å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼"><a href="#å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼" class="headerlink" title="å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼"></a>å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼</h3><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾PostgreSQLçš„æ•°æ®å®‰å…¨æ€§ï¼Œä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚</li><li>å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨RDBæŒä¹…åŒ–ã€‚</li><li>æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨AOFæŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºå®šæ—¶ç”ŸæˆRDBå¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯”AOFæ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨RDBè¿˜å¯ä»¥é¿å…AOFç¨‹åºçš„bugã€‚</li><li>å¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚</li></ul><h3 id="RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ"><a href="#RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ" class="headerlink" title="RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ"></a>RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ</h3><ul><li>å¦‚æœRedisè¢«å½“åšç¼“å­˜ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚</li><li>å¦‚æœRedisè¢«å½“åšä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„keys-to-nodesæ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³RedisèŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰Redisé›†ç¾¤å¯ä»¥åšåˆ°è¿™æ ·ã€‚</li></ul><h2 id="è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥"><a href="#è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥" class="headerlink" title="è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥"></a>è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥</h2><h3 id="Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥"><a href="#Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥" class="headerlink" title="Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥"></a>Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒRedisæ˜¯key-valueæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®Redisä¸­ç¼“å­˜çš„keyçš„è¿‡æœŸæ—¶é—´ã€‚Redisçš„è¿‡æœŸç­–ç•¥å°±æ˜¯æŒ‡å½“Redisä¸­ç¼“å­˜çš„keyè¿‡æœŸäº†ï¼ŒRediså¦‚ä½•å¤„ç†ã€‚</p><p>è¿‡æœŸç­–ç•¥é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>å®šæ—¶è¿‡æœŸï¼šæ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œåˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥ç«‹å³æ¸…é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå¯¹å†…å­˜å¾ˆå‹å¥½ï¼›ä½†æ˜¯ä¼šå ç”¨å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå½±å“ç¼“å­˜çš„å“åº”æ—¶é—´å’Œååé‡ã€‚</li><li>æƒ°æ€§è¿‡æœŸï¼šåªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥keyæ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æºï¼Œå´å¯¹å†…å­˜éå¸¸ä¸å‹å¥½ã€‚æç«¯æƒ…å†µå¯èƒ½å‡ºç°å¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰å†æ¬¡è¢«è®¿é—®ï¼Œä»è€Œä¸ä¼šè¢«æ¸…é™¤ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚</li><li>å®šæœŸè¿‡æœŸï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„æ•°æ®åº“çš„expireså­—å…¸ä¸­ä¸€å®šæ•°é‡çš„keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„keyã€‚è¯¥ç­–ç•¥æ˜¯å‰ä¸¤è€…çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆã€‚é€šè¿‡è°ƒæ•´å®šæ—¶æ‰«æçš„æ—¶é—´é—´éš”å’Œæ¯æ¬¡æ‰«æçš„é™å®šè€—æ—¶ï¼Œå¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹ä½¿å¾—CPUå’Œå†…å­˜èµ„æºè¾¾åˆ°æœ€ä¼˜çš„å¹³è¡¡æ•ˆæœã€‚<br>(expireså­—å…¸ä¼šä¿å­˜æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyçš„è¿‡æœŸæ—¶é—´æ•°æ®ï¼Œå…¶ä¸­ï¼Œkeyæ˜¯æŒ‡å‘é”®ç©ºé—´ä¸­çš„æŸä¸ªé”®çš„æŒ‡é’ˆï¼Œvalueæ˜¯è¯¥é”®çš„æ¯«ç§’ç²¾åº¦çš„UNIXæ—¶é—´æˆ³è¡¨ç¤ºçš„è¿‡æœŸæ—¶é—´ã€‚é”®ç©ºé—´æ˜¯æŒ‡è¯¥Redisé›†ç¾¤ä¸­ä¿å­˜çš„æ‰€æœ‰é”®ã€‚)</li></ul><p>Redisä¸­åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§è¿‡æœŸå’Œå®šæœŸè¿‡æœŸä¸¤ç§è¿‡æœŸç­–ç•¥ã€‚</p><h3 id="Redis-keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ"><a href="#Redis-keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ" class="headerlink" title="Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ"></a>Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ</h3><p>EXPIREå’ŒPERSISTå‘½ä»¤ã€‚</p><h3 id="æˆ‘ä»¬çŸ¥é“é€šè¿‡expireæ¥è®¾ç½®key-çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢"><a href="#æˆ‘ä»¬çŸ¥é“é€šè¿‡expireæ¥è®¾ç½®key-çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢" class="headerlink" title="æˆ‘ä»¬çŸ¥é“é€šè¿‡expireæ¥è®¾ç½®key çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢?"></a>æˆ‘ä»¬çŸ¥é“é€šè¿‡expireæ¥è®¾ç½®key çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢?</h3><p>é™¤äº†ç¼“å­˜æœåŠ¡å™¨è‡ªå¸¦çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¹‹å¤–ï¼ˆRedisé»˜è®¤çš„æœ‰6ä¸­ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰çš„ç¼“å­˜æ·˜æ±°ï¼Œå¸¸è§çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼š</p><ol><li>å®šæ—¶å»æ¸…ç†è¿‡æœŸçš„ç¼“å­˜ï¼›</li><li>å½“æœ‰ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå†åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ‰€ç”¨åˆ°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯å°±å»åº•å±‚ç³»ç»Ÿå¾—åˆ°æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚</li></ol><p>ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œç¬¬ä¸€ç§çš„ç¼ºç‚¹æ˜¯ç»´æŠ¤å¤§é‡ç¼“å­˜çš„keyæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œç¬¬äºŒç§çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¿‡æ¥éƒ½è¦åˆ¤æ–­ç¼“å­˜å¤±æ•ˆï¼Œé€»è¾‘ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼å…·ä½“ç”¨å“ªç§æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥æƒè¡¡ã€‚</p><h2 id="å†…å­˜ç›¸å…³"><a href="#å†…å­˜ç›¸å…³" class="headerlink" title="å†…å­˜ç›¸å…³"></a>å†…å­˜ç›¸å…³</h2><h3 id="MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®"><a href="#MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®" class="headerlink" title="MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®"></a>MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®</h3><p>rediså†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p><h3 id="Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"><a href="#Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›" class="headerlink" title="Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"></a>Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›</h3><p>Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨Redisçš„ç”¨äºç¼“å­˜çš„å†…å­˜ä¸è¶³æ—¶ï¼Œæ€ä¹ˆå¤„ç†éœ€è¦æ–°å†™å…¥ä¸”éœ€è¦ç”³è¯·é¢å¤–ç©ºé—´çš„æ•°æ®ã€‚</p><p><strong>å…¨å±€çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤</strong></p><ul><li>noevictionï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚</li><li>allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ï¼ˆè¿™ä¸ªæ˜¯<strong>æœ€å¸¸ç”¨</strong>çš„ï¼‰</li><li>allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚</li></ul><p><strong>è®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤</strong></p><ul><li>volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚</li><li>volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚</li><li>volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤ã€‚</li></ul><p><strong>æ€»ç»“</strong></p><p>Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥çš„é€‰å–å¹¶ä¸ä¼šå½±å“è¿‡æœŸçš„keyçš„å¤„ç†ã€‚å†…å­˜æ·˜æ±°ç­–ç•¥ç”¨äºå¤„ç†å†…å­˜ä¸è¶³æ—¶çš„éœ€è¦ç”³è¯·é¢å¤–ç©ºé—´çš„æ•°æ®ï¼›è¿‡æœŸç­–ç•¥ç”¨äºå¤„ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®ã€‚</p><h3 id="Redisä¸»è¦æ¶ˆè€—ä»€ä¹ˆç‰©ç†èµ„æºï¼Ÿ"><a href="#Redisä¸»è¦æ¶ˆè€—ä»€ä¹ˆç‰©ç†èµ„æºï¼Ÿ" class="headerlink" title="Redisä¸»è¦æ¶ˆè€—ä»€ä¹ˆç‰©ç†èµ„æºï¼Ÿ"></a>Redisä¸»è¦æ¶ˆè€—ä»€ä¹ˆç‰©ç†èµ„æºï¼Ÿ</h3><p>å†…å­˜ã€‚</p><h3 id="Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"><a href="#Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"></a>Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3><p>å¦‚æœè¾¾åˆ°è®¾ç½®çš„ä¸Šé™ï¼ŒRedisçš„å†™å‘½ä»¤ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆä½†æ˜¯è¯»å‘½ä»¤è¿˜å¯ä»¥æ­£å¸¸è¿”å›ã€‚ï¼‰æˆ–è€…ä½ å¯ä»¥é…ç½®å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œå½“Redisè¾¾åˆ°å†…å­˜ä¸Šé™æ—¶ä¼šå†²åˆ·æ‰æ—§çš„å†…å®¹ã€‚</p><h3 id="Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ"><a href="#Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ"></a>Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</h3><p>å¯ä»¥å¥½å¥½åˆ©ç”¨Hash,list,sorted set,setç­‰é›†åˆç±»å‹æ•°æ®ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹å¾ˆå¤šå°çš„Key-Valueå¯ä»¥ç”¨æ›´ç´§å‡‘çš„æ–¹å¼å­˜æ”¾åˆ°ä¸€èµ·ã€‚å°½å¯èƒ½ä½¿ç”¨æ•£åˆ—è¡¨ï¼ˆhashesï¼‰ï¼Œæ•£åˆ—è¡¨ï¼ˆæ˜¯è¯´æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨çš„æ•°å°‘ï¼‰ä½¿ç”¨çš„å†…å­˜éå¸¸å°ï¼Œæ‰€ä»¥ä½ åº”è¯¥å°½å¯èƒ½çš„å°†ä½ çš„æ•°æ®æ¨¡å‹æŠ½è±¡åˆ°ä¸€ä¸ªæ•£åˆ—è¡¨é‡Œé¢ã€‚æ¯”å¦‚ä½ çš„webç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œä¸è¦ä¸ºè¿™ä¸ªç”¨æˆ·çš„åç§°ï¼Œå§“æ°ï¼Œé‚®ç®±ï¼Œå¯†ç è®¾ç½®å•ç‹¬çš„keyï¼Œè€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸€å¼ æ•£åˆ—è¡¨é‡Œé¢</p><h2 id="çº¿ç¨‹æ¨¡å‹"><a href="#çº¿ç¨‹æ¨¡å‹" class="headerlink" title="çº¿ç¨‹æ¨¡å‹"></a>çº¿ç¨‹æ¨¡å‹</h2><h3 id="Redisçº¿ç¨‹æ¨¡å‹"><a href="#Redisçº¿ç¨‹æ¨¡å‹" class="headerlink" title="Redisçº¿ç¨‹æ¨¡å‹"></a>Redisçº¿ç¨‹æ¨¡å‹</h3><p>RedisåŸºäºReactoræ¨¡å¼å¼€å‘äº†ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚å®ƒçš„ç»„æˆç»“æ„ä¸º4éƒ¨åˆ†ï¼šå¤šä¸ªå¥—æ¥å­—ã€IOå¤šè·¯å¤ç”¨ç¨‹åºã€æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ã€äº‹ä»¶å¤„ç†å™¨ã€‚å› ä¸ºæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨é˜Ÿåˆ—çš„æ¶ˆè´¹æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥Redisæ‰å«å•çº¿ç¨‹æ¨¡å‹ã€‚</p><ul><li>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œ å¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚</li><li>å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œ ä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œ è¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</li></ul><p>è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œ ä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œ åˆå¯ä»¥å¾ˆå¥½åœ°ä¸ redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œ è¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/barrywxx/p/8570821.html">https://www.cnblogs.com/barrywxx/p/8570821.html</a></p><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h3><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚</p><h3 id="Redisäº‹åŠ¡çš„æ¦‚å¿µ"><a href="#Redisäº‹åŠ¡çš„æ¦‚å¿µ" class="headerlink" title="Redisäº‹åŠ¡çš„æ¦‚å¿µ"></a>Redisäº‹åŠ¡çš„æ¦‚å¿µ</h3><p>Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯é€šè¿‡MULTIã€EXECã€WATCHç­‰ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚</p><p>æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚</p><h3 id="Redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ"><a href="#Redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ" class="headerlink" title="Redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ"></a>Redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ</h3><ol><li>äº‹åŠ¡å¼€å§‹ MULTI</li><li>å‘½ä»¤å…¥é˜Ÿ</li><li>äº‹åŠ¡æ‰§è¡Œ EXEC</li></ol><p>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœåŠ¡ç«¯æ”¶åˆ°æœ‰EXECã€DISCARDã€WATCHã€MULTIä¹‹å¤–çš„è¯·æ±‚ï¼Œå°†ä¼šæŠŠè¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿ</p><h3 id="Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤"><a href="#Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤" class="headerlink" title="Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤"></a>Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤</h3><p>Redisäº‹åŠ¡åŠŸèƒ½æ˜¯é€šè¿‡MULTIã€EXECã€DISCARDå’ŒWATCH å››ä¸ªåŸè¯­å®ç°çš„</p><p>Redisä¼šå°†ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤åºåˆ—åŒ–ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œã€‚</p><ol><li><strong>redis ä¸æ”¯æŒå›æ»š</strong>ï¼Œâ€œRedis åœ¨äº‹åŠ¡å¤±è´¥æ—¶ä¸è¿›è¡Œå›æ»šï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œä½™ä¸‹çš„å‘½ä»¤â€ï¼Œ æ‰€ä»¥ Redis çš„å†…éƒ¨å¯ä»¥ä¿æŒç®€å•ä¸”å¿«é€Ÿã€‚</li><li><strong>å¦‚æœåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å‘½ä»¤å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œ</strong>ï¼›</li><li><strong>å¦‚æœåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å‡ºç°è¿è¡Œé”™è¯¯ï¼Œé‚£ä¹ˆæ­£ç¡®çš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œ</strong>ã€‚</li></ol><ul><li>WATCH å‘½ä»¤æ˜¯ä¸€ä¸ªä¹è§‚é”ï¼Œå¯ä»¥ä¸º Redis äº‹åŠ¡æä¾› check-and-set ï¼ˆCASï¼‰è¡Œä¸ºã€‚ å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œï¼Œç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ã€‚</li><li>MULTIå‘½ä»¤ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å›OKã€‚ MULTIæ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“EXECå‘½ä»¤è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚</li><li>EXECï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚è¿”å›äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚ å½“æ“ä½œè¢«æ‰“æ–­æ—¶ï¼Œè¿”å›ç©ºå€¼ nil ã€‚</li><li>é€šè¿‡è°ƒç”¨DISCARDï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ï¼Œ å¹¶ä¸”å®¢æˆ·ç«¯ä¼šä»äº‹åŠ¡çŠ¶æ€ä¸­é€€å‡ºã€‚</li><li>UNWATCHå‘½ä»¤å¯ä»¥å–æ¶ˆwatchå¯¹æ‰€æœ‰keyçš„ç›‘æ§ã€‚</li></ul><h3 id="äº‹åŠ¡ç®¡ç†ï¼ˆACIDï¼‰æ¦‚è¿°"><a href="#äº‹åŠ¡ç®¡ç†ï¼ˆACIDï¼‰æ¦‚è¿°" class="headerlink" title="äº‹åŠ¡ç®¡ç†ï¼ˆACIDï¼‰æ¦‚è¿°"></a>äº‹åŠ¡ç®¡ç†ï¼ˆACIDï¼‰æ¦‚è¿°</h3><p>åŸå­æ€§ï¼ˆAtomicityï¼‰<br>åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</p><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰<br>äº‹åŠ¡å‰åæ•°æ®çš„å®Œæ•´æ€§å¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰<br>å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œ</p><p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰<br>æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥å³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“</p><p><strong>Redisçš„äº‹åŠ¡æ€»æ˜¯å…·æœ‰ACIDä¸­çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§</strong>ï¼Œå…¶ä»–ç‰¹æ€§æ˜¯ä¸æ”¯æŒçš„ã€‚å½“æœåŠ¡å™¨è¿è¡Œåœ¨<em>AOF</em>æŒä¹…åŒ–æ¨¡å¼ä¸‹ï¼Œå¹¶ä¸”appendfsyncé€‰é¡¹çš„å€¼ä¸ºalwaysæ—¶ï¼Œäº‹åŠ¡ä¹Ÿå…·æœ‰è€ä¹…æ€§ã€‚</p><h3 id="Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—"><a href="#Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—" class="headerlink" title="Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—"></a>Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—</h3><p>Redis æ˜¯å•è¿›ç¨‹ç¨‹åºï¼Œå¹¶ä¸”å®ƒä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œäº‹åŠ¡å¯ä»¥è¿è¡Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚å› æ­¤ï¼Œ<strong>Redis çš„äº‹åŠ¡æ˜¯æ€»æ˜¯å¸¦æœ‰éš”ç¦»æ€§çš„</strong>ã€‚</p><h3 id="Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—"><a href="#Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—" class="headerlink" title="Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—"></a>Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—</h3><p>Redisä¸­ï¼Œå•æ¡å‘½ä»¤æ˜¯åŸå­æ€§æ‰§è¡Œçš„ï¼Œä½†<strong>äº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ï¼Œä¸”æ²¡æœ‰å›æ»š</strong>ã€‚äº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä»ä¼šè¢«æ‰§è¡Œã€‚</p><h3 id="Redisäº‹åŠ¡å…¶ä»–å®ç°"><a href="#Redisäº‹åŠ¡å…¶ä»–å®ç°" class="headerlink" title="Redisäº‹åŠ¡å…¶ä»–å®ç°"></a>Redisäº‹åŠ¡å…¶ä»–å®ç°</h3><ul><li>åŸºäºLuaè„šæœ¬ï¼ŒRediså¯ä»¥ä¿è¯è„šæœ¬å†…çš„å‘½ä»¤ä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œï¼Œ<br>å…¶åŒæ—¶ä¹Ÿä¸æä¾›äº‹åŠ¡è¿è¡Œé”™è¯¯çš„å›æ»šï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœéƒ¨åˆ†å‘½ä»¤è¿è¡Œé”™è¯¯ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œå®Œ</li><li>åŸºäºä¸­é—´æ ‡è®°å˜é‡ï¼Œé€šè¿‡å¦å¤–çš„æ ‡è®°å˜é‡æ¥æ ‡è¯†äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè¯»å–æ•°æ®æ—¶å…ˆè¯»å–è¯¥æ ‡è®°å˜é‡åˆ¤æ–­æ˜¯å¦äº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚ä½†è¿™æ ·ä¼šéœ€è¦é¢å¤–å†™ä»£ç å®ç°ï¼Œæ¯”è¾ƒç¹ç</li></ul><h2 id="é›†ç¾¤æ–¹æ¡ˆ"><a href="#é›†ç¾¤æ–¹æ¡ˆ" class="headerlink" title="é›†ç¾¤æ–¹æ¡ˆ"></a>é›†ç¾¤æ–¹æ¡ˆ</h2><h3 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200115174006561.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>å“¨å…µçš„ä»‹ç»</strong></p><p>sentinelï¼Œä¸­æ–‡åæ˜¯å“¨å…µã€‚å“¨å…µæ˜¯ redis é›†ç¾¤æœºæ„ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>é›†ç¾¤ç›‘æ§ï¼šè´Ÿè´£ç›‘æ§ redis master å’Œ slave è¿›ç¨‹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</li><li>æ¶ˆæ¯é€šçŸ¥ï¼šå¦‚æœæŸä¸ª redis å®ä¾‹æœ‰æ•…éšœï¼Œé‚£ä¹ˆå“¨å…µè´Ÿè´£å‘é€æ¶ˆæ¯ä½œä¸ºæŠ¥è­¦é€šçŸ¥ç»™ç®¡ç†å‘˜ã€‚</li><li>æ•…éšœè½¬ç§»ï¼šå¦‚æœ master node æŒ‚æ‰äº†ï¼Œä¼šè‡ªåŠ¨è½¬ç§»åˆ° slave node ä¸Šã€‚</li><li>é…ç½®ä¸­å¿ƒï¼šå¦‚æœæ•…éšœè½¬ç§»å‘ç”Ÿäº†ï¼Œé€šçŸ¥ client å®¢æˆ·ç«¯æ–°çš„ master åœ°å€ã€‚</li></ul><p><strong>å“¨å…µç”¨äºå®ç° redis é›†ç¾¤çš„é«˜å¯ç”¨</strong>ï¼Œæœ¬èº«ä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä½œä¸ºä¸€ä¸ªå“¨å…µé›†ç¾¤å»è¿è¡Œï¼Œäº’ç›¸ååŒå·¥ä½œã€‚</p><ul><li>æ•…éšœè½¬ç§»æ—¶ï¼Œåˆ¤æ–­ä¸€ä¸ª master node æ˜¯å¦å®•æœºäº†ï¼Œéœ€è¦å¤§éƒ¨åˆ†çš„å“¨å…µéƒ½åŒæ„æ‰è¡Œï¼Œæ¶‰åŠåˆ°äº†åˆ†å¸ƒå¼é€‰ä¸¾çš„é—®é¢˜ã€‚</li><li>å³ä½¿éƒ¨åˆ†å“¨å…µèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œå“¨å…µé›†ç¾¤è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªä½œä¸ºé«˜å¯ç”¨æœºåˆ¶é‡è¦ç»„æˆéƒ¨åˆ†çš„æ•…éšœè½¬ç§»ç³»ç»Ÿæœ¬èº«æ˜¯å•ç‚¹çš„ï¼Œé‚£å°±å¾ˆå‘çˆ¹äº†ã€‚</li></ul><p><strong>å“¨å…µçš„æ ¸å¿ƒçŸ¥è¯†</strong></p><ul><li>å“¨å…µè‡³å°‘éœ€è¦ 3 ä¸ªå®ä¾‹ï¼Œæ¥ä¿è¯è‡ªå·±çš„å¥å£®æ€§ã€‚</li><li>å“¨å…µ + redis ä¸»ä»çš„éƒ¨ç½²æ¶æ„ï¼Œæ˜¯<strong>ä¸ä¿è¯æ•°æ®é›¶ä¸¢å¤±</strong>çš„ï¼Œåªèƒ½ä¿è¯ redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</li><li>å¯¹äºå“¨å…µ + redis ä¸»ä»è¿™ç§å¤æ‚çš„éƒ¨ç½²æ¶æ„ï¼Œå°½é‡åœ¨æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œéƒ½è¿›è¡Œå……è¶³çš„æµ‹è¯•å’Œæ¼”ç»ƒã€‚</li></ul><h3 id="å®˜æ–¹Redis-Cluster-æ–¹æ¡ˆ-æœåŠ¡ç«¯è·¯ç”±æŸ¥è¯¢"><a href="#å®˜æ–¹Redis-Cluster-æ–¹æ¡ˆ-æœåŠ¡ç«¯è·¯ç”±æŸ¥è¯¢" class="headerlink" title="å®˜æ–¹Redis Cluster æ–¹æ¡ˆ(æœåŠ¡ç«¯è·¯ç”±æŸ¥è¯¢)"></a>å®˜æ–¹Redis Cluster æ–¹æ¡ˆ(æœåŠ¡ç«¯è·¯ç”±æŸ¥è¯¢)</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200115173621637.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="img"></p><p>redis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œredis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿåˆ†å¸ƒå¼å¯»å€éƒ½æœ‰å“ªäº›ç®—æ³•ï¼Ÿäº†è§£ä¸€è‡´æ€§ hash ç®—æ³•å—ï¼Ÿ</p><p><strong>ç®€ä»‹</strong></p><p>Redis Clusteræ˜¯ä¸€ç§æœåŠ¡ç«¯ShardingæŠ€æœ¯ï¼Œ3.0ç‰ˆæœ¬å¼€å§‹æ­£å¼æä¾›ã€‚Redis Clusterå¹¶æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯é‡‡ç”¨slot(æ§½)çš„æ¦‚å¿µï¼Œä¸€å…±åˆ†æˆ16384ä¸ªæ§½ã€‚å°†è¯·æ±‚å‘é€åˆ°ä»»æ„èŠ‚ç‚¹ï¼Œæ¥æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹ä¼šå°†æŸ¥è¯¢è¯·æ±‚å‘é€åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><p><strong>æ–¹æ¡ˆè¯´æ˜</strong></p><ol><li>é€šè¿‡å“ˆå¸Œçš„æ–¹å¼ï¼Œå°†æ•°æ®åˆ†ç‰‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‡åˆ†å­˜å‚¨ä¸€å®šå“ˆå¸Œæ§½(å“ˆå¸Œå€¼)åŒºé—´çš„æ•°æ®ï¼Œé»˜è®¤åˆ†é…äº†16384 ä¸ªæ§½ä½</li><li>æ¯ä»½æ•°æ®åˆ†ç‰‡ä¼šå­˜å‚¨åœ¨å¤šä¸ªäº’ä¸ºä¸»ä»çš„å¤šèŠ‚ç‚¹ä¸Š</li><li>æ•°æ®å†™å…¥å…ˆå†™ä¸»èŠ‚ç‚¹ï¼Œå†åŒæ­¥åˆ°ä»èŠ‚ç‚¹(æ”¯æŒé…ç½®ä¸ºé˜»å¡åŒæ­¥)</li><li>åŒä¸€åˆ†ç‰‡å¤šä¸ªèŠ‚ç‚¹é—´çš„æ•°æ®ä¸ä¿æŒä¸€è‡´æ€§</li><li>è¯»å–æ•°æ®æ—¶ï¼Œå½“å®¢æˆ·ç«¯æ“ä½œçš„keyæ²¡æœ‰åˆ†é…åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ—¶ï¼Œredisä¼šè¿”å›è½¬å‘æŒ‡ä»¤ï¼ŒæŒ‡å‘æ­£ç¡®çš„èŠ‚ç‚¹</li><li>æ‰©å®¹æ—¶æ—¶éœ€è¦éœ€è¦æŠŠæ—§èŠ‚ç‚¹çš„æ•°æ®è¿ç§»ä¸€éƒ¨åˆ†åˆ°æ–°èŠ‚ç‚¹</li></ol><p>åœ¨ redis cluster æ¶æ„ä¸‹ï¼Œæ¯ä¸ª redis è¦æ”¾å¼€ä¸¤ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ 6379ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ åŠ 1w çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 16379ã€‚</p><p>16379 ç«¯å£å·æ˜¯ç”¨æ¥è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯ cluster bus çš„ä¸œè¥¿ï¼Œcluster bus çš„é€šä¿¡ï¼Œç”¨æ¥è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒã€‚cluster bus ç”¨äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶çš„åè®®ï¼Œ<code>gossip</code> åè®®ï¼Œç”¨äºèŠ‚ç‚¹é—´è¿›è¡Œé«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼Œå ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½å’Œå¤„ç†æ—¶é—´ã€‚</p><p><strong>èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶</strong></p><p>åŸºæœ¬é€šä¿¡åŸç†</p><p>é›†ç¾¤å…ƒæ•°æ®çš„ç»´æŠ¤æœ‰ä¸¤ç§æ–¹å¼ï¼šé›†ä¸­å¼ã€Gossip åè®®ã€‚redis cluster èŠ‚ç‚¹é—´é‡‡ç”¨ gossip åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p><strong>åˆ†å¸ƒå¼å¯»å€ç®—æ³•</strong></p><ul><li>hash ç®—æ³•ï¼ˆå¤§é‡ç¼“å­˜é‡å»ºï¼‰</li><li>ä¸€è‡´æ€§ hash ç®—æ³•ï¼ˆè‡ªåŠ¨ç¼“å­˜è¿ç§»ï¼‰+ è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰</li><li>redis cluster çš„ hash slot ç®—æ³•</li></ul><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ— ä¸­å¿ƒæ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œå¯¹ä¸šåŠ¡é€æ˜</li><li>å…·å¤‡Sentinelçš„ç›‘æ§å’Œè‡ªåŠ¨Failover(æ•…éšœè½¬ç§»)èƒ½åŠ›</li><li>å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯</li><li>é«˜æ€§èƒ½ï¼Œå®¢æˆ·ç«¯ç›´è¿redisæœåŠ¡ï¼Œå…å»äº†proxyä»£ç†çš„æŸè€—</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>è¿ç»´ä¹Ÿå¾ˆå¤æ‚ï¼Œæ•°æ®è¿ç§»éœ€è¦äººå·¥å¹²é¢„</li><li>åªèƒ½ä½¿ç”¨0å·æ•°æ®åº“</li><li>ä¸æ”¯æŒæ‰¹é‡æ“ä½œ(pipelineç®¡é“æ“ä½œ)</li><li>åˆ†å¸ƒå¼é€»è¾‘å’Œå­˜å‚¨æ¨¡å—è€¦åˆç­‰</li></ul><h3 id="åŸºäºå®¢æˆ·ç«¯åˆ†é…"><a href="#åŸºäºå®¢æˆ·ç«¯åˆ†é…" class="headerlink" title="åŸºäºå®¢æˆ·ç«¯åˆ†é…"></a>åŸºäºå®¢æˆ·ç«¯åˆ†é…</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200115173640248.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>ç®€ä»‹</strong></p><p>Redis Shardingæ˜¯Redis Clusterå‡ºæ¥ä¹‹å‰ï¼Œä¸šç•Œæ™®éä½¿ç”¨çš„å¤šRediså®ä¾‹é›†ç¾¤æ–¹æ³•ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯é‡‡ç”¨å“ˆå¸Œç®—æ³•å°†Redisæ•°æ®çš„keyè¿›è¡Œæ•£åˆ—ï¼Œé€šè¿‡hashå‡½æ•°ï¼Œç‰¹å®šçš„keyä¼šæ˜ å°„åˆ°ç‰¹å®šçš„RedisèŠ‚ç‚¹ä¸Šã€‚Java rediså®¢æˆ·ç«¯é©±åŠ¨jedisï¼Œæ”¯æŒRedis ShardingåŠŸèƒ½ï¼Œå³ShardedJedisä»¥åŠç»“åˆç¼“å­˜æ± çš„ShardedJedisPool</p><p><strong>ä¼˜ç‚¹</strong></p><p>ä¼˜åŠ¿åœ¨äºéå¸¸ç®€å•ï¼ŒæœåŠ¡ç«¯çš„Rediså®ä¾‹å½¼æ­¤ç‹¬ç«‹ï¼Œç›¸äº’æ— å…³è”ï¼Œæ¯ä¸ªRediså®ä¾‹åƒå•æœåŠ¡å™¨ä¸€æ ·è¿è¡Œï¼Œéå¸¸å®¹æ˜“çº¿æ€§æ‰©å±•ï¼Œç³»ç»Ÿçš„çµæ´»æ€§å¾ˆå¼º</p><p><strong>ç¼ºç‚¹</strong></p><ul><li>ç”±äºshardingå¤„ç†æ”¾åˆ°å®¢æˆ·ç«¯ï¼Œè§„æ¨¡è¿›ä¸€æ­¥æ‰©å¤§æ—¶ç»™è¿ç»´å¸¦æ¥æŒ‘æˆ˜ã€‚</li><li>å®¢æˆ·ç«¯shardingä¸æ”¯æŒåŠ¨æ€å¢åˆ èŠ‚ç‚¹ã€‚æœåŠ¡ç«¯Rediså®ä¾‹ç¾¤æ‹“æ‰‘ç»“æ„æœ‰å˜åŒ–æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æ›´æ–°è°ƒæ•´ã€‚è¿æ¥ä¸èƒ½å…±äº«ï¼Œå½“åº”ç”¨è§„æ¨¡å¢å¤§æ—¶ï¼Œèµ„æºæµªè´¹åˆ¶çº¦ä¼˜åŒ–</li></ul><h3 id="åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡"><a href="#åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡" class="headerlink" title="åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡"></a>åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200115173630730.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>ç®€ä»‹</strong></p><p>å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ä¸€ä¸ªä»£ç†ç»„ä»¶ï¼Œä»£ç†è§£æå®¢æˆ·ç«¯çš„æ•°æ®ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘è‡³æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œæœ€åå°†ç»“æœå›å¤ç»™å®¢æˆ·ç«¯</p><p><strong>ç‰¹å¾</strong></p><ul><li>é€æ˜æ¥å…¥ï¼Œä¸šåŠ¡ç¨‹åºä¸ç”¨å…³å¿ƒåç«¯Rediså®ä¾‹ï¼Œåˆ‡æ¢æˆæœ¬ä½</li><li>Proxy çš„é€»è¾‘å’Œå­˜å‚¨çš„é€»è¾‘æ˜¯éš”ç¦»çš„</li><li>ä»£ç†å±‚å¤šäº†ä¸€æ¬¡è½¬å‘ï¼Œæ€§èƒ½æœ‰æ‰€æŸè€—</li></ul><p><strong>ä¸šç•Œå¼€æºæ–¹æ¡ˆ</strong></p><ul><li>Twtterå¼€æºçš„Twemproxy</li><li>è±Œè±†èšå¼€æºçš„Codis</li></ul><h3 id="Redis-ä¸»ä»æ¶æ„"><a href="#Redis-ä¸»ä»æ¶æ„" class="headerlink" title="Redis ä¸»ä»æ¶æ„"></a>Redis ä¸»ä»æ¶æ„</h3><p>å•æœºçš„ redisï¼Œèƒ½å¤Ÿæ‰¿è½½çš„ QPS å¤§æ¦‚å°±åœ¨ä¸Šä¸‡åˆ°å‡ ä¸‡ä¸ç­‰ã€‚å¯¹äºç¼“å­˜æ¥è¯´ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥æ”¯æ’‘<strong>è¯»é«˜å¹¶å‘</strong>çš„ã€‚å› æ­¤æ¶æ„åšæˆä¸»ä»(master-slave)æ¶æ„ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»è´Ÿè´£å†™ï¼Œå¹¶ä¸”å°†æ•°æ®å¤åˆ¶åˆ°å…¶å®ƒçš„ slave èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»ã€‚æ‰€æœ‰çš„<strong>è¯»è¯·æ±‚å…¨éƒ¨èµ°ä»èŠ‚ç‚¹</strong>ã€‚è¿™æ ·ä¹Ÿå¯ä»¥å¾ˆè½»æ¾å®ç°æ°´å¹³æ‰©å®¹ï¼Œ<strong>æ”¯æ’‘è¯»é«˜å¹¶å‘</strong>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200115180329317.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="redis-master-slave"></p><p>redis replication -&gt; ä¸»ä»æ¶æ„ -&gt; è¯»å†™åˆ†ç¦» -&gt; æ°´å¹³æ‰©å®¹æ”¯æ’‘è¯»é«˜å¹¶å‘</p><p><strong>redis replication çš„æ ¸å¿ƒæœºåˆ¶</strong></p><ul><li>redis é‡‡ç”¨<strong>å¼‚æ­¥æ–¹å¼</strong>å¤åˆ¶æ•°æ®åˆ° slave èŠ‚ç‚¹ï¼Œä¸è¿‡ redis2.8 å¼€å§‹ï¼Œslave node ä¼šå‘¨æœŸæ€§åœ°ç¡®è®¤è‡ªå·±æ¯æ¬¡å¤åˆ¶çš„æ•°æ®é‡ï¼›</li><li>ä¸€ä¸ª master node æ˜¯å¯ä»¥é…ç½®å¤šä¸ª slave node çš„ï¼›</li><li>slave node ä¹Ÿå¯ä»¥è¿æ¥å…¶ä»–çš„ slave nodeï¼›</li><li>slave node åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¸ä¼š block master node çš„æ­£å¸¸å·¥ä½œï¼›</li><li>slave node åœ¨åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼š block å¯¹è‡ªå·±çš„æŸ¥è¯¢æ“ä½œï¼Œå®ƒä¼šç”¨æ—§çš„æ•°æ®é›†æ¥æä¾›æœåŠ¡ï¼›ä½†æ˜¯å¤åˆ¶å®Œæˆçš„æ—¶å€™ï¼Œéœ€è¦åˆ é™¤æ—§æ•°æ®é›†ï¼ŒåŠ è½½æ–°æ•°æ®é›†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæš‚åœå¯¹å¤–æœåŠ¡äº†ï¼›</li><li>slave node ä¸»è¦ç”¨æ¥è¿›è¡Œæ¨ªå‘æ‰©å®¹ï¼Œåšè¯»å†™åˆ†ç¦»ï¼Œæ‰©å®¹çš„ slave node å¯ä»¥æé«˜è¯»çš„ååé‡ã€‚</li></ul><p>æ³¨æ„ï¼Œå¦‚æœé‡‡ç”¨äº†ä¸»ä»æ¶æ„ï¼Œé‚£ä¹ˆå»ºè®®å¿…é¡»<strong>å¼€å¯</strong> master node çš„æŒä¹…åŒ–ï¼Œä¸å»ºè®®ç”¨ slave node ä½œä¸º master node çš„æ•°æ®çƒ­å¤‡ï¼Œå› ä¸ºé‚£æ ·çš„è¯ï¼Œå¦‚æœä½ å…³æ‰ master çš„æŒä¹…åŒ–ï¼Œå¯èƒ½åœ¨ master å®•æœºé‡å¯çš„æ—¶å€™æ•°æ®æ˜¯ç©ºçš„ï¼Œç„¶åå¯èƒ½ä¸€ç»è¿‡å¤åˆ¶ï¼Œ slave node çš„æ•°æ®ä¹Ÿä¸¢äº†ã€‚</p><p>å¦å¤–ï¼Œmaster çš„å„ç§å¤‡ä»½æ–¹æ¡ˆï¼Œä¹Ÿéœ€è¦åšã€‚ä¸‡ä¸€æœ¬åœ°çš„æ‰€æœ‰æ–‡ä»¶ä¸¢å¤±äº†ï¼Œä»å¤‡ä»½ä¸­æŒ‘é€‰ä¸€ä»½ rdb å»æ¢å¤ masterï¼Œè¿™æ ·æ‰èƒ½<strong>ç¡®ä¿å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯æœ‰æ•°æ®çš„</strong>ï¼Œå³ä½¿é‡‡ç”¨äº†åç»­è®²è§£çš„é«˜å¯ç”¨æœºåˆ¶ï¼Œslave node å¯ä»¥è‡ªåŠ¨æ¥ç®¡ master nodeï¼Œä½†ä¹Ÿå¯èƒ½ sentinel è¿˜æ²¡æ£€æµ‹åˆ° master failureï¼Œmaster node å°±è‡ªåŠ¨é‡å¯äº†ï¼Œè¿˜æ˜¯å¯èƒ½å¯¼è‡´ä¸Šé¢æ‰€æœ‰çš„ slave node æ•°æ®è¢«æ¸…ç©ºã€‚</p><p><strong>redis ä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒåŸç†</strong></p><p>å½“å¯åŠ¨ä¸€ä¸ª slave node çš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª <code>PSYNC</code> å‘½ä»¤ç»™ master nodeã€‚</p><p>å¦‚æœè¿™æ˜¯ slave node åˆæ¬¡è¿æ¥åˆ° master nodeï¼Œé‚£ä¹ˆä¼šè§¦å‘ä¸€æ¬¡ <code>full resynchronization</code> å…¨é‡å¤åˆ¶ã€‚æ­¤æ—¶ master ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¼€å§‹ç”Ÿæˆä¸€ä»½ <code>RDB</code> å¿«ç…§æ–‡ä»¶ï¼Œ</p><p>åŒæ—¶è¿˜ä¼šå°†ä»å®¢æˆ·ç«¯ client æ–°æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚<code>RDB</code> æ–‡ä»¶ç”Ÿæˆå®Œæ¯•åï¼Œ master ä¼šå°†è¿™ä¸ª <code>RDB</code> å‘é€ç»™ slaveï¼Œslave ä¼šå…ˆ<strong>å†™å…¥æœ¬åœ°ç£ç›˜ï¼Œç„¶åå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜</strong>ä¸­ï¼Œ</p><p>æ¥ç€ master ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™å‘½ä»¤å‘é€åˆ° slaveï¼Œslave ä¹Ÿä¼šåŒæ­¥è¿™äº›æ•°æ®ã€‚</p><p>slave node å¦‚æœè·Ÿ master node æœ‰ç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†è¿æ¥ï¼Œä¼šè‡ªåŠ¨é‡è¿ï¼Œè¿æ¥ä¹‹å master node ä»…ä¼šå¤åˆ¶ç»™ slave éƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200115180337645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="redis-master-slave-replication"></p><p><strong>è¿‡ç¨‹åŸç†</strong></p><ol><li>å½“ä»åº“å’Œä¸»åº“å»ºç«‹MSå…³ç³»åï¼Œä¼šå‘ä¸»æ•°æ®åº“å‘é€SYNCå‘½ä»¤</li><li>ä¸»åº“æ¥æ”¶åˆ°SYNCå‘½ä»¤åä¼šå¼€å§‹åœ¨åå°ä¿å­˜å¿«ç…§(RDBæŒä¹…åŒ–è¿‡ç¨‹)ï¼Œå¹¶å°†æœŸé—´æ¥æ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥</li><li>å½“å¿«ç…§å®Œæˆåï¼Œä¸»Redisä¼šå°†å¿«ç…§æ–‡ä»¶å’Œæ‰€æœ‰ç¼“å­˜çš„å†™å‘½ä»¤å‘é€ç»™ä»Redis</li><li>ä»Redisæ¥æ”¶åˆ°åï¼Œä¼šè½½å…¥å¿«ç…§æ–‡ä»¶å¹¶ä¸”æ‰§è¡Œæ”¶åˆ°çš„ç¼“å­˜çš„å‘½ä»¤</li><li>ä¹‹åï¼Œä¸»Redisæ¯å½“æ¥æ”¶åˆ°å†™å‘½ä»¤æ—¶å°±ä¼šå°†å‘½ä»¤å‘é€ä»Redisï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´</li></ol><p><strong>ç¼ºç‚¹</strong></p><p>æ‰€æœ‰çš„slaveèŠ‚ç‚¹æ•°æ®çš„å¤åˆ¶å’ŒåŒæ­¥éƒ½ç”±masterèŠ‚ç‚¹æ¥å¤„ç†ï¼Œä¼šç…§æˆmasterèŠ‚ç‚¹å‹åŠ›å¤ªå¤§ï¼Œä½¿ç”¨ä¸»ä»ä»ç»“æ„æ¥è§£å†³</p><h3 id="Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ"></a>Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ</h3><p>ä¸ºäº†ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æˆ–è€…å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡çš„æƒ…å†µä¸‹é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨äº†ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰N-1ä¸ªå¤åˆ¶å“</p><h3 id="ç”Ÿäº§ç¯å¢ƒä¸­çš„-redis-æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ"><a href="#ç”Ÿäº§ç¯å¢ƒä¸­çš„-redis-æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ"></a>ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ</h3><p>redis clusterï¼Œ10 å°æœºå™¨ï¼Œ5 å°æœºå™¨éƒ¨ç½²äº† redis ä¸»å®ä¾‹ï¼Œå¦å¤– 5 å°æœºå™¨éƒ¨ç½²äº† redis çš„ä»å®ä¾‹ï¼Œæ¯ä¸ªä¸»å®ä¾‹æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³°qpså¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™è¯·æ±‚/sã€‚</p><p>æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®ï¼Ÿ32G å†…å­˜+ 8 æ ¸ CPU + 1T ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ redis è¿›ç¨‹çš„æ˜¯10gå†…å­˜ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œredis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚</p><p>5 å°æœºå™¨å¯¹å¤–æä¾›è¯»å†™ï¼Œä¸€å…±æœ‰ 50g å†…å­˜ã€‚</p><p>å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯é«˜å¯ç”¨çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œredis ä»å®ä¾‹ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚</p><p>ä½ å¾€å†…å­˜é‡Œå†™çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼Ÿæ¯æ¡æ•°æ®çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kbã€‚100 æ¡æ•°æ®æ˜¯ 1mbï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1gã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚</p><p>å…¶å®å¤§å‹çš„å…¬å¸ï¼Œä¼šæœ‰åŸºç¡€æ¶æ„çš„ team è´Ÿè´£ç¼“å­˜é›†ç¾¤çš„è¿ç»´ã€‚</p><h3 id="è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ"><a href="#è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ" class="headerlink" title="è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ"></a>è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ</h3><p>Redisé›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash,è€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼ŒRedisé›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚</p><h3 id="Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3><p>Rediså¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚</p><h3 id="Redisé›†ç¾¤ä¹‹é—´æ˜¯å¦‚ä½•å¤åˆ¶çš„ï¼Ÿ"><a href="#Redisé›†ç¾¤ä¹‹é—´æ˜¯å¦‚ä½•å¤åˆ¶çš„ï¼Ÿ" class="headerlink" title="Redisé›†ç¾¤ä¹‹é—´æ˜¯å¦‚ä½•å¤åˆ¶çš„ï¼Ÿ"></a>Redisé›†ç¾¤ä¹‹é—´æ˜¯å¦‚ä½•å¤åˆ¶çš„ï¼Ÿ</h3><p>å¼‚æ­¥å¤åˆ¶</p><h3 id="Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ"><a href="#Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ"></a>Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ</h3><p>16384ä¸ª</p><h3 id="Redisé›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ"><a href="#Redisé›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ" class="headerlink" title="Redisé›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ"></a>Redisé›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ</h3><p>Redisé›†ç¾¤ç›®å‰æ— æ³•åšæ•°æ®åº“é€‰æ‹©ï¼Œé»˜è®¤åœ¨0æ•°æ®åº“ã€‚</p><h2 id="åˆ†åŒº"><a href="#åˆ†åŒº" class="headerlink" title="åˆ†åŒº"></a>åˆ†åŒº</h2><h3 id="Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ"><a href="#Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ" class="headerlink" title="Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ"></a>Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ</h3><p>å¯ä»¥åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªRedisçš„å®ä¾‹ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸åŒçš„æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œ æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¤šä¸ªCPUï¼Œä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹åˆ†ç‰‡ï¼ˆshardï¼‰ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒºï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒºï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒºï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒºï¼Ÿ</h3><p>åˆ†åŒºå¯ä»¥è®©Redisç®¡ç†æ›´å¤§çš„å†…å­˜ï¼ŒRediså°†å¯ä»¥ä½¿ç”¨æ‰€æœ‰æœºå™¨çš„å†…å­˜ã€‚å¦‚æœæ²¡æœ‰åˆ†åŒºï¼Œä½ æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€å°æœºå™¨çš„å†…å­˜ã€‚åˆ†åŒºä½¿Redisçš„è®¡ç®—èƒ½åŠ›é€šè¿‡ç®€å•åœ°å¢åŠ è®¡ç®—æœºå¾—åˆ°æˆå€æå‡ï¼ŒRedisçš„ç½‘ç»œå¸¦å®½ä¹Ÿä¼šéšç€è®¡ç®—æœºå’Œç½‘å¡çš„å¢åŠ è€Œæˆå€å¢é•¿ã€‚</p><h3 id="ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆï¼Ÿ"><a href="#ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆï¼Ÿ"></a>ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆï¼Ÿ</h3><ul><li>å®¢æˆ·ç«¯åˆ†åŒºå°±æ˜¯åœ¨å®¢æˆ·ç«¯å°±å·²ç»å†³å®šæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°å“ªä¸ªredisèŠ‚ç‚¹æˆ–è€…ä»å“ªä¸ªredisèŠ‚ç‚¹è¯»å–ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯å·²ç»å®ç°äº†å®¢æˆ·ç«¯åˆ†åŒºã€‚</li><li>ä»£ç†åˆ†åŒº æ„å‘³ç€å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™ä»£ç†ï¼Œç„¶åä»£ç†å†³å®šå»å“ªä¸ªèŠ‚ç‚¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®ã€‚ä»£ç†æ ¹æ®åˆ†åŒºè§„åˆ™å†³å®šè¯·æ±‚å“ªäº›Rediså®ä¾‹ï¼Œç„¶åæ ¹æ®Redisçš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚rediså’Œmemcachedçš„ä¸€ç§ä»£ç†å®ç°å°±æ˜¯Twemproxy</li><li>æŸ¥è¯¢è·¯ç”±(Query routing) çš„æ„æ€æ˜¯å®¢æˆ·ç«¯éšæœºåœ°è¯·æ±‚ä»»æ„ä¸€ä¸ªrediså®ä¾‹ï¼Œç„¶åç”±Rediså°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„RedisèŠ‚ç‚¹ã€‚Redis Clusterå®ç°äº†ä¸€ç§æ··åˆå½¢å¼çš„æŸ¥è¯¢è·¯ç”±ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°†è¯·æ±‚ä»ä¸€ä¸ªredisèŠ‚ç‚¹è½¬å‘åˆ°å¦ä¸€ä¸ªredisèŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„å¸®åŠ©ä¸‹ç›´æ¥redirectedåˆ°æ­£ç¡®çš„redisèŠ‚ç‚¹ã€‚</li></ul><h3 id="Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"><a href="#Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ" class="headerlink" title="Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"></a>Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</h3><ul><li>æ¶‰åŠå¤šä¸ªkeyçš„æ“ä½œé€šå¸¸ä¸ä¼šè¢«æ”¯æŒã€‚ä¾‹å¦‚ä½ ä¸èƒ½å¯¹ä¸¤ä¸ªé›†åˆæ±‚äº¤é›†ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½è¢«å­˜å‚¨åˆ°ä¸åŒçš„Rediså®ä¾‹ï¼ˆå®é™…ä¸Šè¿™ç§æƒ…å†µä¹Ÿæœ‰åŠæ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨äº¤é›†æŒ‡ä»¤ï¼‰ã€‚</li><li>åŒæ—¶æ“ä½œå¤šä¸ªkey,åˆ™ä¸èƒ½ä½¿ç”¨Redisäº‹åŠ¡.</li><li>åˆ†åŒºä½¿ç”¨çš„ç²’åº¦æ˜¯keyï¼Œä¸èƒ½ä½¿ç”¨ä¸€ä¸ªéå¸¸é•¿çš„æ’åºkeyå­˜å‚¨ä¸€ä¸ªæ•°æ®é›†ï¼ˆThe partitioning granularity is the key, so it is not possible to shard a dataset with a single huge key like a very big sorted setï¼‰</li><li>å½“ä½¿ç”¨åˆ†åŒºçš„æ—¶å€™ï¼Œæ•°æ®å¤„ç†ä¼šéå¸¸å¤æ‚ï¼Œä¾‹å¦‚ä¸ºäº†å¤‡ä»½ä½ å¿…é¡»ä»ä¸åŒçš„Rediså®ä¾‹å’Œä¸»æœºåŒæ—¶æ”¶é›†RDB / AOFæ–‡ä»¶ã€‚</li><li>åˆ†åŒºæ—¶åŠ¨æ€æ‰©å®¹æˆ–ç¼©å®¹å¯èƒ½éå¸¸å¤æ‚ã€‚Redisé›†ç¾¤åœ¨è¿è¡Œæ—¶å¢åŠ æˆ–è€…åˆ é™¤RedisèŠ‚ç‚¹ï¼Œèƒ½åšåˆ°æœ€å¤§ç¨‹åº¦å¯¹ç”¨æˆ·é€æ˜åœ°æ•°æ®å†å¹³è¡¡ï¼Œä½†å…¶ä»–ä¸€äº›å®¢æˆ·ç«¯åˆ†åŒºæˆ–è€…ä»£ç†åˆ†åŒºæ–¹æ³•åˆ™ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§é¢„åˆ†ç‰‡çš„æŠ€æœ¯ä¹Ÿå¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ul><h2 id="åˆ†å¸ƒå¼é—®é¢˜"><a href="#åˆ†å¸ƒå¼é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼é—®é¢˜"></a>åˆ†å¸ƒå¼é—®é¢˜</h2><h3 id="Rediså®ç°åˆ†å¸ƒå¼é”"><a href="#Rediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Rediså®ç°åˆ†å¸ƒå¼é”"></a>Rediså®ç°åˆ†å¸ƒå¼é”</h3><p>Redisä¸ºå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼ï¼Œé‡‡ç”¨é˜Ÿåˆ—æ¨¡å¼å°†å¹¶å‘è®¿é—®å˜æˆä¸²è¡Œè®¿é—®ï¼Œä¸”å¤šå®¢æˆ·ç«¯å¯¹Redisçš„è¿æ¥å¹¶ä¸å­˜åœ¨ç«äº‰å…³ç³»Redisä¸­å¯ä»¥ä½¿ç”¨SETNXå‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ã€‚</p><p>å½“ä¸”ä»…å½“ key ä¸å­˜åœ¨ï¼Œå°† key çš„å€¼è®¾ä¸º valueã€‚ è‹¥ç»™å®šçš„ key å·²ç»å­˜åœ¨ï¼Œåˆ™ SETNX ä¸åšä»»ä½•åŠ¨ä½œ</p><p>SETNX æ˜¯ã€SET if Not eXistsã€(å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ SET)çš„ç®€å†™ã€‚</p><p>è¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ã€‚è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191213103148681.png" alt="img"></p><p>ä½¿ç”¨SETNXå®ŒæˆåŒæ­¥é”çš„æµç¨‹åŠäº‹é¡¹å¦‚ä¸‹ï¼š</p><p>ä½¿ç”¨SETNXå‘½ä»¤è·å–é”ï¼Œè‹¥è¿”å›0ï¼ˆkeyå·²å­˜åœ¨ï¼Œé”å·²å­˜åœ¨ï¼‰åˆ™è·å–å¤±è´¥ï¼Œåä¹‹è·å–æˆåŠŸ</p><p>ä¸ºäº†é˜²æ­¢è·å–é”åç¨‹åºå‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹/è¿›ç¨‹è°ƒç”¨SETNXå‘½ä»¤æ€»æ˜¯è¿”å›0è€Œè¿›å…¥æ­»é”çŠ¶æ€ï¼Œéœ€è¦ä¸ºè¯¥keyè®¾ç½®ä¸€ä¸ªâ€œåˆç†â€çš„è¿‡æœŸæ—¶é—´</p><p>é‡Šæ”¾é”ï¼Œä½¿ç”¨DELå‘½ä»¤å°†é”æ•°æ®åˆ é™¤</p><h3 id="å¦‚ä½•è§£å†³-Redis-çš„å¹¶å‘ç«äº‰-Key-é—®é¢˜"><a href="#å¦‚ä½•è§£å†³-Redis-çš„å¹¶å‘ç«äº‰-Key-é—®é¢˜" class="headerlink" title="å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜"></a>å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜</h3><p>æ‰€è°“ Redis çš„å¹¶å‘ç«äº‰ Key çš„é—®é¢˜ä¹Ÿå°±æ˜¯å¤šä¸ªç³»ç»ŸåŒæ—¶å¯¹ä¸€ä¸ª key è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯æœ€åæ‰§è¡Œçš„é¡ºåºå’Œæˆ‘ä»¬æœŸæœ›çš„é¡ºåºä¸åŒï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†ç»“æœçš„ä¸åŒï¼</p><p>æ¨èä¸€ç§æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”ï¼ˆzookeeper å’Œ redis éƒ½å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼‰ã€‚ï¼ˆå¦‚æœä¸å­˜åœ¨ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼Œä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œè¿™æ ·ä¼šå½±å“æ€§èƒ½ï¼‰</p><p>åŸºäºzookeeperä¸´æ—¶æœ‰åºèŠ‚ç‚¹å¯ä»¥å®ç°çš„åˆ†å¸ƒå¼é”ã€‚å¤§è‡´æ€æƒ³ä¸ºï¼šæ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ä¸è¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åˆ¤æ–­æ˜¯å¦è·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªã€‚ å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªç¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œå½“ç„¶æ˜¯ä»ä»¥å¯é æ€§ä¸ºä¸»ã€‚æ‰€ä»¥é¦–æ¨Zookeeperã€‚</p><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/8bddd381de06">https://www.jianshu.com/p/8bddd381de06</a></p><h3 id="åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3><p>æ—¢ç„¶Redisæ˜¯å¦‚æ­¤çš„è½»é‡ï¼ˆå•å®ä¾‹åªä½¿ç”¨1Må†…å­˜ï¼‰ï¼Œä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿ä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±è®©Redisä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨åˆ†åŒºï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚</p><p>ä¸€å¼€å§‹å°±å¤šè®¾ç½®å‡ ä¸ªRediså®ä¾‹ï¼Œä¾‹å¦‚32æˆ–è€…64ä¸ªå®ä¾‹ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ“ä½œèµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä»é•¿ä¹…æ¥çœ‹åšè¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå½“ä½ çš„æ•°æ®ä¸æ–­å¢é•¿ï¼Œéœ€è¦æ›´å¤šçš„RedisæœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°†Rediså®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼ˆè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ï¼‰ã€‚ä¸€æ—¦ä½ æ·»åŠ äº†å¦ä¸€å°æœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†ä½ ä¸€åŠçš„Rediså®ä¾‹ä»ç¬¬ä¸€å°æœºå™¨è¿ç§»åˆ°ç¬¬äºŒå°æœºå™¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-RedLock"><a href="#ä»€ä¹ˆæ˜¯-RedLock" class="headerlink" title="ä»€ä¹ˆæ˜¯ RedLock"></a>ä»€ä¹ˆæ˜¯ RedLock</h3><p>Redis å®˜æ–¹ç«™æå‡ºäº†ä¸€ç§æƒå¨çš„åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„æ–¹å¼åå« <em>Redlock</em>ï¼Œæ­¤ç§æ–¹å¼æ¯”åŸå…ˆçš„å•èŠ‚ç‚¹çš„æ–¹æ³•æ›´å®‰å…¨ã€‚å®ƒå¯ä»¥ä¿è¯ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li>å®‰å…¨ç‰¹æ€§ï¼šäº’æ–¥è®¿é—®ï¼Œå³æ°¸è¿œåªæœ‰ä¸€ä¸ª client èƒ½æ‹¿åˆ°é”</li><li>é¿å…æ­»é”ï¼šæœ€ç»ˆ client éƒ½å¯èƒ½æ‹¿åˆ°é”ï¼Œä¸ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œå³ä½¿åŸæœ¬é”ä½æŸèµ„æºçš„ client crash äº†æˆ–è€…å‡ºç°äº†ç½‘ç»œåˆ†åŒº</li><li>å®¹é”™æ€§ï¼šåªè¦å¤§éƒ¨åˆ† Redis èŠ‚ç‚¹å­˜æ´»å°±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡</li></ol><h2 id="ç¼“å­˜å¼‚å¸¸"><a href="#ç¼“å­˜å¼‚å¸¸" class="headerlink" title="ç¼“å­˜å¼‚å¸¸"></a>ç¼“å­˜å¼‚å¸¸</h2><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p><strong>ç¼“å­˜é›ªå´©</strong>æ˜¯æŒ‡ç¼“å­˜åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œæ‰€ä»¥ï¼Œåé¢çš„è¯·æ±‚éƒ½ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ol><li>ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®éšæœºï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡æ•°æ®è¿‡æœŸç°è±¡å‘ç”Ÿã€‚</li><li>ä¸€èˆ¬å¹¶å‘é‡ä¸æ˜¯ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œä½¿ç”¨æœ€å¤šçš„è§£å†³æ–¹æ¡ˆæ˜¯åŠ é”æ’é˜Ÿã€‚</li><li>ç»™æ¯ä¸€ä¸ªç¼“å­˜æ•°æ®å¢åŠ ç›¸åº”çš„ç¼“å­˜æ ‡è®°ï¼Œè®°å½•ç¼“å­˜çš„æ˜¯å¦å¤±æ•ˆï¼Œå¦‚æœç¼“å­˜æ ‡è®°å¤±æ•ˆï¼Œåˆ™æ›´æ–°æ•°æ®ç¼“å­˜ã€‚</li></ol><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p><strong>ç¼“å­˜ç©¿é€</strong>æ˜¯æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ol><li>æ¥å£å±‚å¢åŠ æ ¡éªŒï¼Œå¦‚ç”¨æˆ·é‰´æƒæ ¡éªŒï¼ŒidåšåŸºç¡€æ ¡éªŒï¼Œid&lt;=0çš„ç›´æ¥æ‹¦æˆªï¼›</li><li>ä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰å–åˆ°ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥å°†key-valueå¯¹å†™ä¸ºkey-nullï¼Œç¼“å­˜æœ‰æ•ˆæ—¶é—´å¯ä»¥è®¾ç½®çŸ­ç‚¹ï¼Œå¦‚30ç§’ï¼ˆè®¾ç½®å¤ªé•¿ä¼šå¯¼è‡´æ­£å¸¸æƒ…å†µä¹Ÿæ²¡æ³•ä½¿ç”¨ï¼‰ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»ç”¨æˆ·åå¤ç”¨åŒä¸€ä¸ªidæš´åŠ›æ”»å‡»</li><li>é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›</li></ol><p><strong>é™„åŠ </strong></p><p>å¯¹äºç©ºé—´çš„åˆ©ç”¨åˆ°è¾¾äº†ä¸€ç§æè‡´ï¼Œé‚£å°±æ˜¯Bitmapå’Œå¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)ã€‚<br>Bitmapï¼š å…¸å‹çš„å°±æ˜¯å“ˆå¸Œè¡¨<br>ç¼ºç‚¹æ˜¯ï¼ŒBitmapå¯¹äºæ¯ä¸ªå…ƒç´ åªèƒ½è®°å½•1bitä¿¡æ¯ï¼Œå¦‚æœè¿˜æƒ³å®Œæˆé¢å¤–çš„åŠŸèƒ½ï¼Œææ€•åªèƒ½é ç‰ºç‰²æ›´å¤šçš„ç©ºé—´ã€æ—¶é—´æ¥å®Œæˆäº†ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæ¨èï¼‰</p><p>å°±æ˜¯å¼•å…¥äº†k(k&gt;1)k(k&gt;1)ä¸ªç›¸äº’ç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ï¼Œä¿è¯åœ¨ç»™å®šçš„ç©ºé—´ã€è¯¯åˆ¤ç‡ä¸‹ï¼Œå®Œæˆå…ƒç´ åˆ¤é‡çš„è¿‡ç¨‹ã€‚<br>å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚<br>Bloom-Filterç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨å¤šä¸ªä¸åŒçš„Hashå‡½æ•°æ¥è§£å†³â€œå†²çªâ€ã€‚<br>Hashå­˜åœ¨ä¸€ä¸ªå†²çªï¼ˆç¢°æ’ï¼‰çš„é—®é¢˜ï¼Œç”¨åŒä¸€ä¸ªHashå¾—åˆ°çš„ä¸¤ä¸ªURLçš„å€¼æœ‰å¯èƒ½ç›¸åŒã€‚ä¸ºäº†å‡å°‘å†²çªï¼Œæˆ‘ä»¬å¯ä»¥å¤šå¼•å…¥å‡ ä¸ªHashï¼Œå¦‚æœé€šè¿‡å…¶ä¸­çš„ä¸€ä¸ªHashå€¼æˆ‘ä»¬å¾—å‡ºæŸå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚åªæœ‰åœ¨æ‰€æœ‰çš„Hashå‡½æ•°å‘Šè¯‰æˆ‘ä»¬è¯¥å…ƒç´ åœ¨é›†åˆä¸­æ—¶ï¼Œæ‰èƒ½ç¡®å®šè¯¥å…ƒç´ å­˜åœ¨äºé›†åˆä¸­ã€‚è¿™ä¾¿æ˜¯Bloom-Filterçš„åŸºæœ¬æ€æƒ³ã€‚<br>Bloom-Filterä¸€èˆ¬ç”¨äºåœ¨å¤§æ•°æ®é‡çš„é›†åˆä¸­åˆ¤å®šæŸå…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚</p><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰çš„æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼‰ï¼Œè¿™æ—¶ç”±äºå¹¶å‘ç”¨æˆ·ç‰¹åˆ«å¤šï¼ŒåŒæ—¶è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼ŒåˆåŒæ—¶å»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ï¼Œé€ æˆè¿‡å¤§å‹åŠ›ã€‚å’Œç¼“å­˜é›ªå´©ä¸åŒçš„æ˜¯ï¼Œç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ol><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚</li><li>åŠ äº’æ–¥é”ï¼Œäº’æ–¥é”</li></ol><h3 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h3><p><strong>ç¼“å­˜é¢„çƒ­</strong>å°±æ˜¯ç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ol><li>ç›´æ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸€ä¸‹ï¼›</li><li>æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ï¼›</li><li>å®šæ—¶åˆ·æ–°ç¼“å­˜ï¼›</li></ol><h3 id="ç¼“å­˜é™çº§"><a href="#ç¼“å­˜é™çº§" class="headerlink" title="ç¼“å­˜é™çº§"></a>ç¼“å­˜é™çº§</h3><p>å½“è®¿é—®é‡å‰§å¢ã€æœåŠ¡å‡ºç°é—®é¢˜ï¼ˆå¦‚å“åº”æ—¶é—´æ…¢æˆ–ä¸å“åº”ï¼‰æˆ–éæ ¸å¿ƒæœåŠ¡å½±å“åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½æ—¶ï¼Œä»ç„¶éœ€è¦ä¿è¯æœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ï¼Œå³ä½¿æ˜¯æœ‰æŸæœåŠ¡ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸€äº›å…³é”®æ•°æ®è¿›è¡Œè‡ªåŠ¨é™çº§ï¼Œä¹Ÿå¯ä»¥é…ç½®å¼€å…³å®ç°äººå·¥é™çº§ã€‚</p><p><strong>ç¼“å­˜é™çº§</strong>çš„æœ€ç»ˆç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚è€Œä¸”æœ‰äº›æœåŠ¡æ˜¯æ— æ³•é™çº§çš„ï¼ˆå¦‚åŠ å…¥è´­ç‰©è½¦ã€ç»“ç®—ï¼‰ã€‚</p><p>åœ¨è¿›è¡Œé™çº§ä¹‹å‰è¦å¯¹ç³»ç»Ÿè¿›è¡Œæ¢³ç†ï¼Œçœ‹çœ‹ç³»ç»Ÿæ˜¯ä¸æ˜¯å¯ä»¥ä¸¢å’ä¿å¸…ï¼›ä»è€Œæ¢³ç†å‡ºå“ªäº›å¿…é¡»èª“æ­»ä¿æŠ¤ï¼Œå“ªäº›å¯é™çº§ï¼›æ¯”å¦‚å¯ä»¥å‚è€ƒæ—¥å¿—çº§åˆ«è®¾ç½®é¢„æ¡ˆï¼š</p><ol><li>ä¸€èˆ¬ï¼šæ¯”å¦‚æœ‰äº›æœåŠ¡å¶å°”å› ä¸ºç½‘ç»œæŠ–åŠ¨æˆ–è€…æœåŠ¡æ­£åœ¨ä¸Šçº¿è€Œè¶…æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é™çº§ï¼›</li><li>è­¦å‘Šï¼šæœ‰äº›æœåŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…æˆåŠŸç‡æœ‰æ³¢åŠ¨ï¼ˆå¦‚åœ¨95~100%ä¹‹é—´ï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨é™çº§æˆ–äººå·¥é™çº§ï¼Œå¹¶å‘é€å‘Šè­¦ï¼›</li><li>é”™è¯¯ï¼šæ¯”å¦‚å¯ç”¨ç‡ä½äº90%ï¼Œæˆ–è€…æ•°æ®åº“è¿æ¥æ± è¢«æ‰“çˆ†äº†ï¼Œæˆ–è€…è®¿é—®é‡çªç„¶çŒ›å¢åˆ°ç³»ç»Ÿèƒ½æ‰¿å—çš„æœ€å¤§é˜€å€¼ï¼Œæ­¤æ—¶å¯ä»¥æ ¹æ®æƒ…å†µè‡ªåŠ¨é™çº§æˆ–è€…äººå·¥é™çº§ï¼›</li><li>ä¸¥é‡é”™è¯¯ï¼šæ¯”å¦‚å› ä¸ºç‰¹æ®ŠåŸå› æ•°æ®é”™è¯¯äº†ï¼Œæ­¤æ—¶éœ€è¦ç´§æ€¥äººå·¥é™çº§ã€‚</li></ol><p>æœåŠ¡é™çº§çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢RedisæœåŠ¡æ•…éšœï¼Œå¯¼è‡´æ•°æ®åº“è·Ÿç€ä¸€èµ·å‘ç”Ÿé›ªå´©é—®é¢˜ã€‚å› æ­¤ï¼Œå¯¹äºä¸é‡è¦çš„ç¼“å­˜æ•°æ®ï¼Œå¯ä»¥é‡‡å–æœåŠ¡é™çº§ç­–ç•¥ï¼Œä¾‹å¦‚ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åšæ³•å°±æ˜¯ï¼ŒRediså‡ºç°é—®é¢˜ï¼Œä¸å»æ•°æ®åº“æŸ¥è¯¢ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é»˜è®¤å€¼ç»™ç”¨æˆ·ã€‚</p><h3 id="çƒ­ç‚¹æ•°æ®å’Œå†·æ•°æ®"><a href="#çƒ­ç‚¹æ•°æ®å’Œå†·æ•°æ®" class="headerlink" title="çƒ­ç‚¹æ•°æ®å’Œå†·æ•°æ®"></a>çƒ­ç‚¹æ•°æ®å’Œå†·æ•°æ®</h3><p>çƒ­ç‚¹æ•°æ®ï¼Œç¼“å­˜æ‰æœ‰ä»·å€¼</p><p>å¯¹äºå†·æ•°æ®è€Œè¨€ï¼Œå¤§éƒ¨åˆ†æ•°æ®å¯èƒ½è¿˜æ²¡æœ‰å†æ¬¡è®¿é—®åˆ°å°±å·²ç»è¢«æŒ¤å‡ºå†…å­˜ï¼Œä¸ä»…å ç”¨å†…å­˜ï¼Œè€Œä¸”ä»·å€¼ä¸å¤§ã€‚é¢‘ç¹ä¿®æ”¹çš„æ•°æ®ï¼Œçœ‹æƒ…å†µè€ƒè™‘ä½¿ç”¨ç¼“å­˜</p><p>å¯¹äºçƒ­ç‚¹æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æŸIMäº§å“ï¼Œç”Ÿæ—¥ç¥ç¦æ¨¡å—ï¼Œå½“å¤©çš„å¯¿æ˜Ÿåˆ—è¡¨ï¼Œç¼“å­˜ä»¥åå¯èƒ½è¯»å–æ•°åä¸‡æ¬¡ã€‚å†ä¸¾ä¸ªä¾‹å­ï¼ŒæŸå¯¼èˆªäº§å“ï¼Œæˆ‘ä»¬å°†å¯¼èˆªä¿¡æ¯ï¼Œç¼“å­˜ä»¥åå¯èƒ½è¯»å–æ•°ç™¾ä¸‡æ¬¡ã€‚</p><p>æ•°æ®æ›´æ–°å‰è‡³å°‘è¯»å–ä¸¤æ¬¡ï¼Œç¼“å­˜æ‰æœ‰æ„ä¹‰ã€‚è¿™ä¸ªæ˜¯æœ€åŸºæœ¬çš„ç­–ç•¥ï¼Œå¦‚æœç¼“å­˜è¿˜æ²¡æœ‰èµ·ä½œç”¨å°±å¤±æ•ˆäº†ï¼Œé‚£å°±æ²¡æœ‰å¤ªå¤§ä»·å€¼äº†ã€‚</p><p>é‚£å­˜ä¸å­˜åœ¨ï¼Œä¿®æ”¹é¢‘ç‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆä¸å¾—ä¸è€ƒè™‘ç¼“å­˜çš„åœºæ™¯å‘¢ï¼Ÿæœ‰ï¼æ¯”å¦‚ï¼Œè¿™ä¸ªè¯»å–æ¥å£å¯¹æ•°æ®åº“çš„å‹åŠ›å¾ˆå¤§ï¼Œä½†æ˜¯åˆæ˜¯çƒ­ç‚¹æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è€ƒè™‘é€šè¿‡ç¼“å­˜æ‰‹æ®µï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æŸåŠ©æ‰‹äº§å“çš„ï¼Œç‚¹èµæ•°ï¼Œæ”¶è—æ•°ï¼Œåˆ†äº«æ•°ç­‰æ˜¯éå¸¸å…¸å‹çš„çƒ­ç‚¹æ•°æ®ï¼Œä½†æ˜¯åˆä¸æ–­å˜åŒ–ï¼Œæ­¤æ—¶å°±éœ€è¦å°†æ•°æ®åŒæ­¥ä¿å­˜åˆ°Redisç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ã€‚</p><h3 id="ç¼“å­˜çƒ­ç‚¹key"><a href="#ç¼“å­˜çƒ­ç‚¹key" class="headerlink" title="ç¼“å­˜çƒ­ç‚¹key"></a>ç¼“å­˜çƒ­ç‚¹key</h3><p>ç¼“å­˜ä¸­çš„ä¸€ä¸ªKey(æ¯”å¦‚ä¸€ä¸ªä¿ƒé”€å•†å“)ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>å¯¹ç¼“å­˜æŸ¥è¯¢åŠ é”ï¼Œå¦‚æœKEYä¸å­˜åœ¨ï¼Œå°±åŠ é”ï¼Œç„¶åæŸ¥DBå…¥ç¼“å­˜ï¼Œç„¶åè§£é”ï¼›å…¶ä»–è¿›ç¨‹å¦‚æœå‘ç°æœ‰é”å°±ç­‰å¾…ï¼Œç„¶åç­‰è§£é”åè¿”å›æ•°æ®æˆ–è€…è¿›å…¥DBæŸ¥è¯¢</p><h2 id="å¸¸ç”¨å·¥å…·"><a href="#å¸¸ç”¨å·¥å…·" class="headerlink" title="å¸¸ç”¨å·¥å…·"></a>å¸¸ç”¨å·¥å…·</h2><h3 id="Redisæ”¯æŒçš„Javaå®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿå®˜æ–¹æ¨èç”¨å“ªä¸ªï¼Ÿ"><a href="#Redisæ”¯æŒçš„Javaå®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿå®˜æ–¹æ¨èç”¨å“ªä¸ªï¼Ÿ" class="headerlink" title="Redisæ”¯æŒçš„Javaå®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿå®˜æ–¹æ¨èç”¨å“ªä¸ªï¼Ÿ"></a>Redisæ”¯æŒçš„Javaå®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿå®˜æ–¹æ¨èç”¨å“ªä¸ªï¼Ÿ</h3><p>Redissonã€Jedisã€lettuceç­‰ç­‰ï¼Œå®˜æ–¹æ¨èä½¿ç”¨Redissonã€‚</p><h3 id="Rediså’ŒRedissonæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#Rediså’ŒRedissonæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="Rediså’ŒRedissonæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>Rediså’ŒRedissonæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>Redissonæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒRediså®¢æœç«¯ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº›Javaçš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)ã€‚</p><h3 id="Jedisä¸Redissonå¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#Jedisä¸Redissonå¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="Jedisä¸Redissonå¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"></a>Jedisä¸Redissonå¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>Jedisæ˜¯Redisçš„Javaå®ç°çš„å®¢æˆ·ç«¯ï¼Œå…¶APIæä¾›äº†æ¯”è¾ƒå…¨é¢çš„Rediså‘½ä»¤çš„æ”¯æŒï¼›Redissonå®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„Javaæ•°æ®ç»“æ„ï¼Œå’ŒJedisç›¸æ¯”ï¼ŒåŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰Redisç‰¹æ€§ã€‚Redissonçš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹Redisçš„å…³æ³¨åˆ†ç¦»ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><h3 id="Redisä¸Memcachedçš„åŒºåˆ«"><a href="#Redisä¸Memcachedçš„åŒºåˆ«" class="headerlink" title="Redisä¸Memcachedçš„åŒºåˆ«"></a>Redisä¸Memcachedçš„åŒºåˆ«</h3><p>ä¸¤è€…éƒ½æ˜¯éå…³ç³»å‹å†…å­˜é”®å€¼æ•°æ®åº“ï¼Œç°åœ¨å…¬å¸ä¸€èˆ¬éƒ½æ˜¯ç”¨ Redis æ¥å®ç°ç¼“å­˜ï¼Œè€Œä¸” Redis è‡ªèº«ä¹Ÿè¶Šæ¥è¶Šå¼ºå¤§äº†ï¼Redis ä¸ Memcached ä¸»è¦æœ‰ä»¥ä¸‹ä¸åŒï¼š</p><div class="table-container"><table><thead><tr><th>å¯¹æ¯”å‚æ•°</th><th>Redis</th><th>Memcached</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>1. æ”¯æŒå†…å­˜ 2. éå…³ç³»å‹æ•°æ®åº“</td><td>1. æ”¯æŒå†…å­˜ 2. é”®å€¼å¯¹å½¢å¼ 3. ç¼“å­˜å½¢å¼</td></tr><tr><td><strong>æ•°æ®å­˜å‚¨ç±»å‹</strong></td><td>1. String 2. List 3. Set 4. Hash 5. Sort Set ã€ä¿—ç§°ZSetã€‘</td><td>1. æ–‡æœ¬å‹ 2. äºŒè¿›åˆ¶ç±»å‹</td></tr><tr><td>æŸ¥è¯¢ã€æ“ä½œã€‘ç±»å‹</td><td>1. æ‰¹é‡æ“ä½œ 2. äº‹åŠ¡æ”¯æŒ 3. æ¯ä¸ªç±»å‹ä¸åŒçš„CRUD</td><td>1.å¸¸ç”¨çš„CRUD 2. å°‘é‡çš„å…¶ä»–å‘½ä»¤</td></tr><tr><td>é™„åŠ åŠŸèƒ½</td><td>1. å‘å¸ƒ/è®¢é˜…æ¨¡å¼ 2. ä¸»ä»åˆ†åŒº 3. åºåˆ—åŒ–æ”¯æŒ 4. è„šæœ¬æ”¯æŒã€Luaè„šæœ¬ã€‘</td><td>1. å¤šçº¿ç¨‹æœåŠ¡æ”¯æŒ</td></tr><tr><td><strong>ç½‘ç»œIOæ¨¡å‹</strong></td><td>1. å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹</td><td>1. å¤šçº¿ç¨‹ï¼Œéé˜»å¡IOæ¨¡å¼</td></tr><tr><td>äº‹ä»¶åº“</td><td>è‡ªå°è½¬ç®€æ˜“äº‹ä»¶åº“AeEvent</td><td>è´µæ—è¡€ç»Ÿçš„LibEventäº‹ä»¶åº“</td></tr><tr><td><strong>æŒä¹…åŒ–æ”¯æŒ</strong></td><td>1. RDB 2. AOF</td><td>ä¸æ”¯æŒ</td></tr><tr><td><strong>é›†ç¾¤æ¨¡å¼</strong></td><td>åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼ï¼Œå¯ä»¥å®ç°ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»</td><td>æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®</td></tr><tr><td>å†…å­˜ç®¡ç†æœºåˆ¶</td><td>åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜</td><td>Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ï¼ŒMemcached å°†å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—æ¥å­˜å‚¨æ•°æ®ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä½¿å¾—å†…å­˜çš„åˆ©ç”¨ç‡ä¸é«˜ï¼Œä¾‹å¦‚å—çš„å¤§å°ä¸º 128 bytesï¼Œåªå­˜å‚¨ 100 bytes çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 28 bytes å°±æµªè´¹æ‰äº†ã€‚</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¤æ‚æ•°æ®ç»“æ„ï¼Œæœ‰æŒä¹…åŒ–ï¼Œé«˜å¯ç”¨éœ€æ±‚ï¼Œvalueå­˜å‚¨å†…å®¹è¾ƒå¤§</td><td>çº¯key-valueï¼Œæ•°æ®é‡éå¸¸å¤§ï¼Œå¹¶å‘é‡éå¸¸å¤§çš„ä¸šåŠ¡</td></tr></tbody></table></div><p>(1) memcachedæ‰€æœ‰çš„å€¼å‡æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œredisä½œä¸ºå…¶æ›¿ä»£è€…ï¼Œæ”¯æŒæ›´ä¸ºä¸°å¯Œçš„æ•°æ®ç±»å‹</p><p>(2) redisçš„é€Ÿåº¦æ¯”memcachedå¿«å¾ˆå¤š</p><p>(3) rediså¯ä»¥æŒä¹…åŒ–å…¶æ•°æ®</p><h3 id="å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"></a>å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</h3><p>ä½ åªè¦ç”¨ç¼“å­˜ï¼Œå°±å¯èƒ½ä¼šæ¶‰åŠåˆ°ç¼“å­˜ä¸æ•°æ®åº“åŒå­˜å‚¨åŒå†™ï¼Œä½ åªè¦æ˜¯åŒå†™ï¼Œå°±ä¸€å®šä¼šæœ‰æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œé‚£ä¹ˆä½ å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœä½ çš„ç³»ç»Ÿä¸æ˜¯ä¸¥æ ¼è¦æ±‚ç¼“å­˜+æ•°æ®åº“å¿…é¡»ä¸€è‡´æ€§çš„è¯ï¼Œç¼“å­˜å¯ä»¥ç¨å¾®çš„è·Ÿæ•°æ®åº“å¶å°”æœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæœ€å¥½ä¸è¦åšè¿™ä¸ªæ–¹æ¡ˆï¼Œè¯»è¯·æ±‚å’Œå†™è¯·æ±‚ä¸²è¡ŒåŒ–ï¼Œä¸²åˆ°ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡Œå»ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä¸€å®šä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µ</p><p>ä¸²è¡ŒåŒ–ä¹‹åï¼Œå°±ä¼šå¯¼è‡´ç³»ç»Ÿçš„ååé‡ä¼šå¤§å¹…åº¦çš„é™ä½ï¼Œç”¨æ¯”æ­£å¸¸æƒ…å†µä¸‹å¤šå‡ å€çš„æœºå™¨å»æ”¯æ’‘çº¿ä¸Šçš„ä¸€ä¸ªè¯·æ±‚ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯å¯èƒ½ä¼šæš‚æ—¶äº§ç”Ÿä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯å‘ç”Ÿçš„å‡ ç‡ç‰¹åˆ«å°ï¼Œå°±æ˜¯<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜ã€‚</strong></p><div class="table-container"><table><thead><tr><th>é—®é¢˜åœºæ™¯</th><th>æè¿°</th><th>è§£å†³</th></tr></thead><tbody><tr><td>å…ˆå†™ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“ï¼Œç¼“å­˜å†™æˆåŠŸï¼Œæ•°æ®åº“å†™å¤±è´¥</td><td>ç¼“å­˜å†™æˆåŠŸï¼Œä½†å†™æ•°æ®åº“å¤±è´¥æˆ–è€…å“åº”å»¶è¿Ÿï¼Œåˆ™ä¸‹æ¬¡è¯»å–ï¼ˆå¹¶å‘è¯»ï¼‰ç¼“å­˜æ—¶ï¼Œå°±å‡ºç°è„è¯»</td><td>è¿™ä¸ªå†™ç¼“å­˜çš„æ–¹å¼ï¼Œæœ¬èº«å°±æ˜¯é”™è¯¯çš„ï¼Œéœ€è¦æ”¹ä¸ºå…ˆå†™æ•°æ®åº“ï¼ŒæŠŠæ—§ç¼“å­˜ç½®ä¸ºå¤±æ•ˆï¼›è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™è¯»å–æ•°æ®åº“å†å†™ç¼“å­˜</td></tr><tr><td>å…ˆå†™æ•°æ®åº“ï¼Œå†å†™ç¼“å­˜ï¼Œæ•°æ®åº“å†™æˆåŠŸï¼Œç¼“å­˜å†™å¤±è´¥</td><td>å†™æ•°æ®åº“æˆåŠŸï¼Œä½†å†™ç¼“å­˜å¤±è´¥ï¼Œåˆ™ä¸‹æ¬¡è¯»å–ï¼ˆå¹¶å‘è¯»ï¼‰ç¼“å­˜æ—¶ï¼Œåˆ™è¯»ä¸åˆ°æ•°æ®</td><td>ç¼“å­˜ä½¿ç”¨æ—¶ï¼Œå‡å¦‚è¯»ç¼“å­˜å¤±è´¥ï¼Œå…ˆè¯»æ•°æ®åº“ï¼Œå†å›å†™ç¼“å­˜çš„æ–¹å¼å®ç°</td></tr><tr><td>éœ€è¦ç¼“å­˜å¼‚æ­¥åˆ·æ–°</td><td>æŒ‡æ•°æ®åº“æ“ä½œå’Œå†™ç¼“å­˜ä¸åœ¨ä¸€ä¸ªæ“ä½œæ­¥éª¤ä¸­ï¼Œæ¯”å¦‚åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•åšåˆ°åŒæ—¶å†™ç¼“å­˜æˆ–éœ€è¦å¼‚æ­¥åˆ·æ–°ï¼ˆè¡¥æ•‘æªæ–½ï¼‰æ—¶å€™</td><td>ç¡®å®šå“ªäº›æ•°æ®é€‚åˆæ­¤ç±»åœºæ™¯ï¼Œæ ¹æ®ç»éªŒå€¼ç¡®å®šåˆç†çš„æ•°æ®ä¸ä¸€è‡´æ—¶é—´ï¼Œç”¨æˆ·æ•°æ®åˆ·æ–°çš„æ—¶é—´é—´éš”</td></tr></tbody></table></div><h3 id="Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ"></a>Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ</h3><ol><li>Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–ã€‚</li><li>å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚</li><li>ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlaveå’ŒMasteræœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚</li><li>å°½é‡é¿å…åœ¨å‹åŠ›è¾ƒå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“</li><li>Masterè°ƒç”¨BGREWRITEAOFé‡å†™AOFæ–‡ä»¶ï¼ŒAOFåœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡loadè¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚</li><li>ä¸ºäº†Masterçš„ç¨³å®šæ€§ï¼Œä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ç¨³å®šï¼Œå³ä¸»ä»å…³ç³»ä¸ºï¼šMaster&lt;â€“Slave1&lt;â€“Slave2&lt;â€“Slave3â€¦ï¼Œè¿™æ ·çš„ç»“æ„ä¹Ÿæ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç°Slaveå¯¹Masterçš„æ›¿æ¢ï¼Œä¹Ÿå³ï¼Œå¦‚æœMasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹é©¬å¯ç”¨Slave1åšMasterï¼Œå…¶ä»–ä¸å˜ã€‚</li></ol><h3 id="Rediså®˜æ–¹ä¸ºä»€ä¹ˆä¸æä¾›Windowsç‰ˆæœ¬ï¼Ÿ"><a href="#Rediså®˜æ–¹ä¸ºä»€ä¹ˆä¸æä¾›Windowsç‰ˆæœ¬ï¼Ÿ" class="headerlink" title="Rediså®˜æ–¹ä¸ºä»€ä¹ˆä¸æä¾›Windowsç‰ˆæœ¬ï¼Ÿ"></a>Rediså®˜æ–¹ä¸ºä»€ä¹ˆä¸æä¾›Windowsç‰ˆæœ¬ï¼Ÿ</h3><p>å› ä¸ºç›®å‰Linuxç‰ˆæœ¬å·²ç»ç›¸å½“ç¨³å®šï¼Œè€Œä¸”ç”¨æˆ·é‡å¾ˆå¤§ï¼Œæ— éœ€å¼€å‘windowsç‰ˆæœ¬ï¼Œåè€Œä¼šå¸¦æ¥å…¼å®¹æ€§ç­‰é—®é¢˜ã€‚</p><h3 id="ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ"><a href="#ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ"></a>ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ</h3><p>512M</p><h3 id="Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ"><a href="#Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ" class="headerlink" title="Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ"></a>Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ</h3><p>Redis2.6å¼€å§‹redis-cliæ”¯æŒä¸€ç§æ–°çš„è¢«ç§°ä¹‹ä¸ºpipe modeçš„æ–°æ¨¡å¼ç”¨äºæ‰§è¡Œå¤§é‡æ•°æ®æ’å…¥å·¥ä½œã€‚</p><h3 id="å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ"><a href="#å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ" class="headerlink" title="å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ"></a>å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</h3><p>ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚<br>å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­”rediså…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šredisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚</p><h3 id="ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„"><a href="#ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„"></a>ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„</h3><p>ä½¿ç”¨listç±»å‹ä¿å­˜æ•°æ®ä¿¡æ¯ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“lpopæ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥sleepä¸€æ®µæ—¶é—´ï¼Œç„¶åå†æ£€æŸ¥æœ‰æ²¡æœ‰ä¿¡æ¯ï¼Œå¦‚æœä¸æƒ³sleepçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨blpop, åœ¨æ²¡æœ‰ä¿¡æ¯çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ä¿¡æ¯çš„åˆ°æ¥ã€‚rediså¯ä»¥é€šè¿‡pub/subä¸»é¢˜è®¢é˜…æ¨¡å¼å®ç°ä¸€ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œå½“ç„¶ä¹Ÿå­˜åœ¨ä¸€å®šçš„ç¼ºç‚¹ï¼Œå½“æ¶ˆè´¹è€…ä¸‹çº¿æ—¶ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚</p><h3 id="Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—"><a href="#Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—" class="headerlink" title="Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—"></a>Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—</h3><p>ä½¿ç”¨sortedsetï¼Œä½¿ç”¨æ—¶é—´æˆ³åšscore, æ¶ˆæ¯å†…å®¹ä½œä¸ºkey,è°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨zrangbyscoreè·å–nç§’ä¹‹å‰çš„æ•°æ®åšè½®è¯¢å¤„ç†ã€‚</p><h3 id="Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3><ol><li>ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ®ã€‚</li><li>Redisæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryçš„é™åˆ¶ï¼Œ åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚</li><li>ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«æ‰§è¡Œï¼Œç­‰ç­‰ã€‚</li><li>æ‰€ä»¥æˆ‘ä»¬ä¸æ–­åœ°ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œï¼Œé€šè¿‡ä¸æ–­è¾¾åˆ°è¾¹ç•Œç„¶åä¸æ–­åœ°å›æ”¶å›åˆ°è¾¹ç•Œä»¥ä¸‹ã€‚</li></ol><p>å¦‚æœä¸€ä¸ªå‘½ä»¤çš„ç»“æœå¯¼è‡´å¤§é‡å†…å­˜è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚å¾ˆå¤§çš„é›†åˆçš„äº¤é›†ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é”®ï¼‰ï¼Œä¸ç”¨å¤šä¹…å†…å­˜é™åˆ¶å°±ä¼šè¢«è¿™ä¸ªå†…å­˜ä½¿ç”¨é‡è¶…è¶Šã€‚</p><h3 id="Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ"><a href="#Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ" class="headerlink" title="Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ"></a>Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ</h3><p>LRUç®—æ³•</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡dockerå®¹å™¨æ–¹å¼æ­å»ºgitlabæœåŠ¡</title>
      <link href="/2017/02/17/Linux/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E4%B9%8B%E6%90%AD%E5%BB%BAgitlab%E6%9C%8D%E5%8A%A1/"/>
      <url>/2017/02/17/Linux/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E4%B9%8B%E6%90%AD%E5%BB%BAgitlab%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´ä½¿ç”¨gitæ¥åšé¡¹ç›®ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†æ¯æ¬¡æ–°å»ºé¡¹ç›®éƒ½è¦å»æœåŠ¡å™¨ä¸Šæ“ä½œï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥é€‰ç”¨å¼€æºçš„gitlabå°±ç›¸å½“åˆé€‚äº†ã€‚</p><p>gitlabçš„è‡ªå¸¦ç»„ä»¶æ¯”è¾ƒå¤šï¼Œä¾‹å¦‚redisã€postgresqlè¿˜æœ‰è‡ªå¸¦çš„nginxç­‰ç­‰ï¼Œä¸­é—´çš„å‘ä¹Ÿå¾ˆå¤šï¼Œç»¼åˆè€ƒé‡è¿˜æ˜¯é€‰ç”¨æ‡’æ–¹æ³•dockerå®¹å™¨æ¥å®‰è£…ã€‚å®‰å…¨ã€å¿«é€Ÿã€‚</p><p>éƒ¨ç½²ç¯å¢ƒä¸ºUbuntu 18.04 çš„å±€åŸŸç½‘æœºå™¨ï¼Œç”±äºæ˜¯Dockeræ–¹å¼éƒ¨ç½²ï¼Œç†è®ºä¸Šå„ä¸ªç¯å¢ƒçš„éƒ¨ç½²æ–¹å¼éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><a id="more"></a><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="æ€§èƒ½è¦æ±‚"><a href="#æ€§èƒ½è¦æ±‚" class="headerlink" title="æ€§èƒ½è¦æ±‚"></a>æ€§èƒ½è¦æ±‚</h3><p>æœ€å¥½æ˜¯4GBå†…å­˜ä»¥ä¸Šï¼Œè‡³å°‘è¦2GBå†…å­˜ï¼Œå¦åˆ™å¡çš„ä½ æ€€ç–‘äººç”Ÿã€‚</p><h3 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h3><p>æˆ‘ä»¬ä»é˜¿é‡Œæºå®‰è£…ã€‚</p><p>å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get update</span><br><span class="line">$ apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br></pre></td></tr></table></figure><p>å®‰è£…GPGè¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><p> å†™å…¥è½¯ä»¶æºä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ add-apt-repository <span class="string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br></pre></td></tr></table></figure><p>æ›´æ–°å¹¶å®‰è£… Docker-CE</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get -y update</span><br><span class="line">$ apt-get -y install docker-ce</span><br></pre></td></tr></table></figure><p>å®‰è£…å¥½ä¹‹åï¼Œæ¥çœ‹çœ‹Dockerçš„ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.1-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        e68fc7a</span><br><span class="line"> Built:             Tue Aug 21 17:24:51 2018</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.06.1-ce</span><br><span class="line">  API version:      1.38 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.3</span><br><span class="line">  Git commit:       e68fc7a</span><br><span class="line">  Built:            Tue Aug 21 17:23:15 2018</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…gitlab-ce"><a href="#å®‰è£…gitlab-ce" class="headerlink" title="å®‰è£…gitlab-ce"></a>å®‰è£…gitlab-ce</h2><h3 id="é•œåƒæ‹‰å–"><a href="#é•œåƒæ‹‰å–" class="headerlink" title="é•œåƒæ‹‰å–"></a>é•œåƒæ‹‰å–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull gitlab-ce <span class="comment">#å¤§çº¦1.5GB è€å¿ƒç­‰å¾…</span></span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨åˆ›å»º"><a href="#å®¹å™¨åˆ›å»º" class="headerlink" title="å®¹å™¨åˆ›å»º"></a>å®¹å™¨åˆ›å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">--hostname gitlab.maywzh.com \   <span class="comment"># æŒ‡å®šå®¹å™¨åŸŸå,æœªçŸ¥åŠŸèƒ½:åˆ›å»ºé•œåƒä»“åº“çš„æ—¶å€™ä½¿ç”¨åˆ°</span></span><br><span class="line">-p 8880:80 \                          <span class="comment"># å°†å®¹å™¨å†…80ç«¯å£æ˜ å°„åˆ°ä¸»æœº8880,æä¾›httpæœåŠ¡</span></span><br><span class="line">-p 8222:22 \                          <span class="comment"># å°†å®¹å™¨å†…22ç«¯å£æ˜ å°„åˆ°ä¸»æœº8222,æä¾›sshæœåŠ¡</span></span><br><span class="line">-p 9090:9090 \                            <span class="comment"># å°†å®¹å™¨å†…9090ç«¯å£æ˜ å°„åˆ°ä¸»æœº9090,æä¾›prometheusæœåŠ¡</span></span><br><span class="line">--name gitlab \                           <span class="comment"># æŒ‡å®šå®¹å™¨åç§°</span></span><br><span class="line">--restart always \                        <span class="comment"># å®¹å™¨é€€å‡ºæ—¶,è‡ªåŠ¨é‡å¯</span></span><br><span class="line">-v /srv/gitlab/config:/etc/gitlab \       <span class="comment"># å°†æœ¬åœ°/srv/gitlab/configæŒ‚è½½åˆ°å®¹å™¨å†…/etc/gitlab</span></span><br><span class="line">-v /srv/gitlab/logs:/var/<span class="built_in">log</span>/gitlab \     <span class="comment"># å°†æœ¬åœ°/srv/gitlab/logsæŒ‚è½½åˆ°å®¹å™¨å†…/var/log/gitlab</span></span><br><span class="line">-v /srv/gitlab/data:/var/opt/gitlab \     <span class="comment"># å°†æœ¬åœ°/srv/gitlab/dataæŒ‚è½½åˆ°å®¹å™¨å†…/var/opt/gitlab</span></span><br><span class="line">gitlab/gitlab-ce:latest                   <span class="comment"># é•œåƒåç§°:ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect gitlab --format <span class="string">&quot;&#123;&#123;.State.Status&#125;&#125;&quot;</span></span><br><span class="line">running <span class="comment">#è¡¨ç¤ºæ­£å¸¸</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æˆ‘ä»¬æŠŠdockerå®¹å™¨çš„gitlabé…ç½®ç›®å½•æŒ‚è½½åœ¨æœ¬åœ°çš„<code>/srv/gitlab/</code>ä¸­ã€‚æ‰€ä»¥ï¼Œéœ€è¦æ”¹åŠ¨è¿™é‡Œçš„é…ç½®æ–‡ä»¶ã€‚</p><p>å…ˆå¤‡ä»½<code>gitlab.rb</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /srv/gitlab/config      </span><br><span class="line">$ cp gitlab.rb gitlab.rb.default</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶ç¤ºä¾‹"><a href="#é…ç½®æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="é…ç½®æ–‡ä»¶ç¤ºä¾‹"></a>é…ç½®æ–‡ä»¶ç¤ºä¾‹</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### gitlab.rb æŠŠä»¥ä¸‹å†…å®¹åŠ åœ¨åŸgitlab.rbçš„æœ€ä¸‹é¢ æœ‰äº›é…ç½®é¡¹éœ€è¦è§†æƒ…å†µæ”¹åŠ¨</span></span><br><span class="line"><span class="comment">## åŸŸåè®¾ç½® è¿™ä¸ªå½±å“ git clone çš„åœ°å€</span></span><br><span class="line"><span class="attribute">external_url</span> http://github.maywzh.com</span><br><span class="line">## gitlabé•œåƒè‡ªå¸¦nginxé…ç½®</span><br><span class="line">nginx[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">nginx[<span class="string">&#x27;client_max_body_size&#x27;</span>] = <span class="string">&#x27;250m&#x27;</span></span><br><span class="line">nginx[<span class="string">&#x27;redirect_http_to_https&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">nginx[<span class="string">&#x27;listen_addresses&#x27;</span>] = [<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="string">&#x27;[::]&#x27;</span>]</span><br><span class="line">nginx[<span class="string">&#x27;listen_port&#x27;</span>] = <span class="number">80</span></span><br><span class="line">nginx[<span class="string">&#x27;listen_https&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">nginx[<span class="string">&#x27;custom_gitlab_server_config&#x27;</span>] = <span class="string">&quot;location ^~ /foo-namespace/bar-project/raw/ &#123;\n deny all;\n&#125;\n&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;custom_nginx_config&#x27;</span>] = <span class="string">&quot;include /etc/nginx/conf.d/*.conf;&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;proxy_read_timeout&#x27;</span>] = <span class="number">3600</span></span><br><span class="line">nginx[<span class="string">&#x27;proxy_connect_timeout&#x27;</span>] = <span class="number">300</span></span><br><span class="line">nginx[<span class="string">&#x27;proxy_set_headers&#x27;</span>] = &#123;</span><br><span class="line"> &quot;Host&quot; =&gt; &quot;$http_host_with_default&quot;,</span><br><span class="line"> &quot;X-Real-IP&quot; =&gt; &quot;$remote_addr&quot;,</span><br><span class="line"> &quot;X-Forwarded-For&quot; =&gt; &quot;$proxy_add_x_forwarded_for&quot;,</span><br><span class="line"> &quot;Upgrade&quot; =&gt; &quot;$http_upgrade&quot;,</span><br><span class="line"> &quot;Connection&quot; =&gt; &quot;$connection_upgrade&quot;</span><br><span class="line">&#125;</span><br><span class="line">nginx[&#x27;proxy_cache_path&#x27;] = &#x27;proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2&#x27;</span><br><span class="line">nginx[&#x27;proxy_cache&#x27;] = &#x27;gitlab&#x27;</span><br><span class="line">nginx[&#x27;http2_enabled&#x27;] = false</span><br><span class="line"><span class="comment"># nginx[&#x27;real_ip_trusted_addresses&#x27;] = [&#x27;172.16.0.0/16&#x27;] #éœ€è¦æ”¹åŠ¨</span></span><br><span class="line">nginx[&#x27;real_ip_header&#x27;] = &#x27;X-Real-IP&#x27;</span><br><span class="line">nginx[&#x27;real_ip_recursive&#x27;] = on</span><br><span class="line">nginx[&#x27;custom_error_pages&#x27;] = &#123;</span><br><span class="line">  &#x27;404&#x27; =&gt; &#123;</span><br><span class="line">    &#x27;title&#x27; =&gt; &#x27;Example title&#x27;,</span><br><span class="line">    &#x27;header&#x27; =&gt; &#x27;Example header&#x27;,</span><br><span class="line">    &#x27;message&#x27; =&gt; &#x27;Example message&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">nginx[&#x27;dir&#x27;] = &quot;/var/opt/gitlab/nginx&quot;</span><br><span class="line">nginx[&#x27;log_directory&#x27;] = &quot;/var/log/gitlab/nginx&quot;</span><br><span class="line">nginx[&#x27;worker_processes&#x27;] = 4</span><br><span class="line">nginx[&#x27;worker_connections&#x27;] = 10240</span><br><span class="line">nginx[&#x27;log_format&#x27;] = &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; $status $body_bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot;&#x27;</span><br><span class="line">nginx[&#x27;sendfile&#x27;] = &#x27;on&#x27;</span><br><span class="line">nginx[&#x27;tcp_nopush&#x27;] = &#x27;on&#x27;</span><br><span class="line">nginx[&#x27;tcp_nodelay&#x27;] = &#x27;on&#x27;</span><br><span class="line">nginx[&#x27;gzip&#x27;] = &quot;on&quot;</span><br><span class="line">nginx[&#x27;gzip_http_version&#x27;] = &quot;1.0&quot;</span><br><span class="line">nginx[&#x27;gzip_comp_level&#x27;] = &quot;2&quot;</span><br><span class="line">nginx[&#x27;gzip_proxied&#x27;] = &quot;any&quot;</span><br><span class="line">nginx[&#x27;gzip_types&#x27;] = [ &quot;text/plain&quot;, &quot;text/css&quot;, &quot;application/x-javascript&quot;, &quot;text/xml&quot;, &quot;application/xml&quot;, &quot;application/xml+rss&quot;, &quot;text/javascript&quot;, &quot;application/json&quot; ]</span><br><span class="line">nginx[&#x27;keepalive_timeout&#x27;] = 65</span><br><span class="line">nginx[&#x27;cache_max_size&#x27;] = &#x27;5000m&#x27;</span><br><span class="line">nginx[&#x27;server_names_hash_bucket_size&#x27;] = 64</span><br><span class="line">nginx[&#x27;status&#x27;] = &#123;</span><br><span class="line"> &quot;enable&quot; =&gt; false,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## é‚®ä»¶æœåŠ¡ ä»¥qqé‚®ç®±ä¸ºä¾‹ éœ€è¦æ”¹åŠ¨</span></span><br><span class="line">gitlab_rails[&#x27;time_zone&#x27;] = &#x27;Asia/Shanghai&#x27;</span><br><span class="line">gitlab_rails[&#x27;smtp_enable&#x27;] = true</span><br><span class="line">gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.qq.com&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_port&#x27;] = 465</span><br><span class="line">gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;xxxxxx@qq.com&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_password&#x27;] = &quot;xxxxxxx&quot; #qqé‚®ç®±çš„ç‹¬ç«‹å¯†ç </span><br><span class="line">gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;smtp.qq.com&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_authentication&#x27;] = :plain</span><br><span class="line">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true</span><br><span class="line">gitlab_rails[&#x27;gitlab_email_from&#x27;] = &quot;xxxxxx@qq.com&quot;</span><br><span class="line">user[&#x27;git_user_email&#x27;] = &quot;xxxxxx@qq.com&quot;</span><br><span class="line">user[&#x27;git_user_name&#x27;] = &quot;gitlab&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">## gitlabè‡ªå¸¦Postgresqlé…ç½®</span></span><br><span class="line">postgresql[&#x27;enable&#x27;] = true</span><br><span class="line">postgresql[&#x27;ssl&#x27;] = &#x27;off&#x27;</span><br><span class="line"></span><br><span class="line"><span class="comment">## gitlabè‡ªå¸¦Redisé…ç½®</span></span><br><span class="line">gitlab_rails[&#x27;redis_host&#x27;] = &quot;127.0.0.1&quot;</span><br><span class="line">gitlab_rails[&#x27;redis_port&#x27;] = 6379</span><br><span class="line">gitlab_rails[&#x27;redis_password&#x27;] = &#x27;0340fg2340jk342302342l&#x27; #éœ€è¦æ”¹åŠ¨</span><br><span class="line">gitlab_rails[&#x27;redis_database&#x27;] = 0</span><br><span class="line">redis[&#x27;enable&#x27;] = true</span><br><span class="line">redis[&#x27;username&#x27;] = &quot;gitlab-redis&quot;</span><br><span class="line">redis[&#x27;maxclients&#x27;] = &quot;10000&quot;</span><br><span class="line">redis[&#x27;maxmemory&#x27;] = &quot;1gb&quot;</span><br><span class="line">redis[&#x27;maxmemory_policy&#x27;] = &quot;allkeys-lru&quot;</span><br><span class="line">redis[&#x27;maxmemory_samples&#x27;] = &quot;5&quot;</span><br><span class="line">redis[&#x27;tcp_timeout&#x27;] = &quot;60&quot;</span><br><span class="line">redis[&#x27;tcp_keepalive&#x27;] = &quot;300&quot;</span><br><span class="line">redis[&#x27;port&#x27;] = 6379</span><br><span class="line">redis[&#x27;password&#x27;] = &#x27;0340fg2340jk342302342l&#x27; #éœ€è¦æ”¹åŠ¨</span><br><span class="line"></span><br><span class="line"><span class="comment">## gitlabå¤‡ä»½è·¯å¾„</span></span><br><span class="line">gitlab_rails[&#x27;manage_backup_path&#x27;] = true</span><br><span class="line">gitlab_rails[&#x27;backup_path&#x27;] = &quot;/var/opt/gitlab/backups&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç›‘æ§Prometheusé…ç½®</span></span><br><span class="line">prometheus[&#x27;enable&#x27;] = true</span><br><span class="line">prometheus[&#x27;monitor_kubernetes&#x27;] = false</span><br><span class="line">prometheus[&#x27;username&#x27;] = &#x27;gitlab-prometheus&#x27;</span><br><span class="line">prometheus[&#x27;uid&#x27;] = nil</span><br><span class="line">prometheus[&#x27;gid&#x27;] = nil</span><br><span class="line">prometheus[&#x27;shell&#x27;] = &#x27;/bin/sh&#x27;</span><br><span class="line">prometheus[&#x27;home&#x27;] = &#x27;/var/opt/gitlab/prometheus&#x27;</span><br><span class="line">prometheus[&#x27;log_directory&#x27;] = &#x27;/var/log/gitlab/prometheus&#x27;</span><br><span class="line">prometheus[&#x27;scrape_interval&#x27;] = 15</span><br><span class="line">prometheus[&#x27;scrape_timeout&#x27;] = 15</span><br><span class="line">prometheus[&#x27;chunk_encoding_version&#x27;] = 2</span><br><span class="line">prometheus[&#x27;listen_address&#x27;] = &#x27;0.0.0.0:9090&#x27;</span><br><span class="line">prometheus_monitoring[&#x27;enable&#x27;] = true</span><br><span class="line">node_exporter[&#x27;enable&#x27;] = true</span><br><span class="line">redis_exporter[&#x27;enable&#x27;] = true</span><br><span class="line">redis_exporter[&#x27;log_directory&#x27;] = &#x27;/var/log/gitlab/redis-exporter&#x27;</span><br><span class="line">redis_exporter[&#x27;flags&#x27;] = &#123;</span><br><span class="line">  &#x27;redis.addr&#x27; =&gt; &quot;127.0.0.1:6379&quot;,</span><br><span class="line">  &#x27;redis.password&#x27; =&gt; &#x27;0340fg2340jk342302342l&#x27; #éœ€è¦æ”¹åŠ¨</span><br><span class="line">&#125;</span><br><span class="line">postgres_exporter[&#x27;enable&#x27;] = true</span><br><span class="line">gitlab_monitor[&#x27;enable&#x27;] = true                                </span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¥½é…ç½®æ–‡ä»¶åï¼Œé‡è½½é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -t gitlab gitlab-ctl reconfigure</span><br><span class="line">$ docker <span class="built_in">exec</span> -t gitlab gitlab-ctl restart</span><br></pre></td></tr></table></figure><h3 id="nginxåå‘ä»£ç†"><a href="#nginxåå‘ä»£ç†" class="headerlink" title="nginxåå‘ä»£ç†"></a>nginxåå‘ä»£ç†</h3><p>ç”±äºå®¹å™¨å†…éƒ¨çš„httpæœåŠ¡ç«¯å£æ˜¯8880ï¼Œä¸ºäº†èƒ½å¤Ÿç›´æ¥è¾“å…¥åŸŸåæ¥è®¿é—®ï¼Œéœ€è¦è®¾ç½®nginxåå‘ä»£ç†ä»£ç†å®¹å™¨å†…éƒ¨çš„nginxæœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/nginx/conf.d/gitlab.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>/etc/nginx/conf.d/gitlab.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gitlab.maywzh.com;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8880;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>/etc/nginx/nginx.conf</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/conf.d/gitlab.conf;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é‡å¯nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart nginx.service</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±éƒ¨ç½²å®Œæˆäº†ï½</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå®è·µ - åŸç†å’Œåˆ›å»ºé•œåƒ</title>
      <link href="/2017/02/13/docker/docker%E5%AE%9E%E8%B7%B5%20-%20%E5%8E%9F%E7%90%86%E5%92%8C%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F/"/>
      <url>/2017/02/13/docker/docker%E5%AE%9E%E8%B7%B5%20-%20%E5%8E%9F%E7%90%86%E5%92%8C%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<p>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™ç§é—®é¢˜ï¼Œåœ¨ä¸€ä¸ªå¼€å‘ç¯å¢ƒä¸‹é¢è¿è¡Œå®Œå…¨æ­£å¸¸çš„ç¨‹åºï¼Œåˆ°äº†ç”Ÿäº§ç¯å¢ƒå°±ä¼šå‡ºç°ç§ç§é—®é¢˜ã€‚å› ä¸ºç”Ÿäº§ç¯å¢ƒçš„ç§ç§é…ç½®ã€åº“ä¸ç¯å¢ƒå˜é‡ç­‰ä¾èµ–é¡¹éƒ½ä¸å¼€å‘ç¯å¢ƒä¸å°½ç›¸åŒï¼Œæ‰€ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œå¿…é¡»æå‰å°†ç”Ÿäº§ç¯å¢ƒé…ç½®å¥½ï¼Œæ‰èƒ½ä¿è¯æœåŠ¡æ­£å¸¸è¿è¡Œã€‚</p><p>ä½†è¿™æ ·ååˆ†éº»çƒ¦ï¼Œå°¤å…¶æ˜¯è¦è¿ç§»æœåŠ¡å™¨çš„è¯ï¼Œç¯å¢ƒé…ç½®åˆè¦é‡æ–°æ¥ä¸€éã€‚æœ€ç†æƒ³çš„çŠ¶å†µæ˜¯ï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå¯ä»¥è‡ªå¸¦ç¯å¢ƒé…ç½®ï¼ŒæŠŠè¿è¡Œæ­£å¸¸çš„ç¯å¢ƒç›´æ¥å¤åˆ¶åˆ°ç”Ÿäº§æœºå™¨ä¸Šã€‚<a href="https://www.docker.com/">Docker</a>ä¸ºè¿™ç§éœ€æ±‚æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚</p><a id="more"></a><h2 id="Dockeræ˜¯ä»€ä¹ˆ"><a href="#Dockeræ˜¯ä»€ä¹ˆ" class="headerlink" title="Dockeræ˜¯ä»€ä¹ˆ"></a>Dockeræ˜¯ä»€ä¹ˆ</h2><p>Docker æ˜¯ä¸€ç§Linuxå®¹å™¨çš„å°è£…ï¼Œ ç”±<a href="https://www.docker.com/company">Docker Inc.</a>å¼€å‘ï¼Œå®ƒæŠŠåº”ç”¨ç¨‹åºå’Œä¾èµ–æ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼ŒdockeråŸºäºè¿™ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ï¼Œåº”ç”¨ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œé¢è¿è¡Œï¼Œä¸åœ¨çœŸå®ç‰©ç†æœºä¸Šè¿è¡Œæ— å¼‚ã€‚å®ƒè§£å†³äº†ç¯å¢ƒé…ç½®é—®é¢˜ã€‚</p><p>Dockerç›®å‰æä¾›äº†ä¼ä¸šç‰ˆ(Docker Enterprise Edition, Docker EE)å’Œç¤¾åŒºç‰ˆ(Docker Community Edition, Docker CE)ä¸¤ç§ç‰ˆæœ¬ã€‚</p><h2 id="Docker-å®‰è£…"><a href="#Docker-å®‰è£…" class="headerlink" title="Docker å®‰è£…"></a>Docker å®‰è£…</h2><p>Docker EEæ˜¯é¢å‘ä¼ä¸šçš„ï¼Œä¸€èˆ¬åªéœ€è¦ä½¿ç”¨Docker CEå³å¯ï¼Œæˆ‘ä»¬é€‰æ‹©å®‰è£…Docker CEç‰ˆæœ¬ã€‚åœ¨æ­¤ä»¥Ubuntu18.04ä¸ºä¾‹ï¼š</p><h3 id="å¸è½½è€ç‰ˆæœ¬çš„Docker"><a href="#å¸è½½è€ç‰ˆæœ¬çš„Docker" class="headerlink" title="å¸è½½è€ç‰ˆæœ¬çš„Docker"></a>å¸è½½è€ç‰ˆæœ¬çš„Docker</h3><p>å¦‚æœå®‰è£…è¿‡è€ç‰ˆæœ¬çš„docker(docker<code>or</code>docker-engine)ï¼Œè¦å…ˆå¸è½½æ‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get remove docker docker-engine docker.io</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h3><p>é‡‡ç”¨å®˜æ–¹æ¨èçš„é€šè¿‡Dockerâ€˜s repositoriesæ–¹å¼æ¥å®‰è£…ã€‚</p><h4 id="è®¾ç½®Dockerâ€™s-repository"><a href="#è®¾ç½®Dockerâ€™s-repository" class="headerlink" title="è®¾ç½®Dockerâ€™s repository"></a>è®¾ç½®Dockerâ€™s repository</h4><ol><li><p>å…ˆæ›´æ–°aptç´¢å¼•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…å¿…è¦çš„åŒ…ï¼Œè¿™æ˜¯ä¸ºäº†aptèƒ½å¤Ÿé€šè¿‡HTTPSçš„æ–¹å¼è®¿é—®Docker repositories</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install \</span><br><span class="line"> apt-transport-https \</span><br><span class="line"> ca-certificates \</span><br><span class="line"> curl \</span><br><span class="line"> software-properties-common</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ Dockerçš„å®˜æ–¹GPG key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><p>ç¡®è®¤æ˜¯å¦æœ‰å¸¦æœ‰<code>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</code>æŒ‡çº¹çš„keyã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class="line"></span><br><span class="line">pub   4096R/0EBFCD88 2017-02-22</span><br><span class="line">      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class="line">uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class="line">sub   4096R/F273FCD8 2017-02-22</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…<code>stable</code>ç‰ˆæœ¬çš„repositoryã€‚å¦‚æœæƒ³å®‰è£…<code>edge</code>æˆ–<code>test</code>ç‰ˆæœ¬ï¼Œåœ¨<code>stable</code>åé¢æ·»åŠ <code>edge</code>æˆ–<code>test</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="subst">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="å®‰è£…Docker-CE"><a href="#å®‰è£…Docker-CE" class="headerlink" title="å®‰è£…Docker CE"></a>å®‰è£…Docker CE</h4><ol><li><p>å…ˆæ›´æ–°aptç´¢å¼•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…æœ€æ–°ç‰ˆçš„Docker CE</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure></li><li><p>*å¦‚æœæƒ³å®‰è£…ç‰¹å®šç‰ˆæœ¬Docker CEï¼Œåˆ™å¯ä»¥åˆ—å‡ºrepoä¸­å¯ç”¨çš„ç‰ˆæœ¬ï¼Œé€‰æ‹©å®‰è£…</p><p>a. åˆ—å‡ºrepoä¸­å¯ç”¨ç‰ˆæœ¬<br>â€‹    <code>bashâ€‹    $ apt-cache madison docker-ceâ€‹    docker-ce | 18.03.0~ce-0~ubuntu | https://download.docker.com/linux/ubuntu xenial/stable amd64 Packagesâ€‹</code></p><p>b. å®‰è£…ç‰¹å®šç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce=&lt;VERSION&gt;</span><br></pre></td></tr></table></figure></li><li><p>ç¡®å®šæ˜¯å¦å®‰è£…æˆåŠŸï¼Œä¸‹è½½ä¸€ä¸ªæµ‹è¯•é•œåƒå¹¶åœ¨å®¹å™¨ä¸­è¿è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">&quot;hello-world&quot;</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°å¦‚ä¸Šä¿¡æ¯å°±å®‰è£…æˆåŠŸäº†ï¼Œå¦‚æœæ˜¯åœ¨linuxä¸‹å®‰è£…çš„è¿˜éœ€è¦è®¾ç½®ç”¨æˆ·æƒé™ã€‚</p></li></ol><h3 id="è®¾ç½®ç”¨æˆ·æƒé™ï¼ˆlinuxå®‰è£…ï¼‰"><a href="#è®¾ç½®ç”¨æˆ·æƒé™ï¼ˆlinuxå®‰è£…ï¼‰" class="headerlink" title="è®¾ç½®ç”¨æˆ·æƒé™ï¼ˆlinuxå®‰è£…ï¼‰"></a>è®¾ç½®ç”¨æˆ·æƒé™ï¼ˆlinuxå®‰è£…ï¼‰</h3><p>Docker daemonè¿›ç¨‹ä¸Unix socketç»‘å®šã€‚é»˜è®¤çŠ¶å†µä¸‹Unix socketæƒé™ç”±<code>root</code>ç”¨æˆ·æ‹¥æœ‰ï¼Œå…¶ä»–ç”¨æˆ·å¿…é¡»ç”¨<code>sudo</code>æ‰å¯ä»¥è®¿é—®ã€‚Docker daemonå¿…é¡»ä»¥<code>root</code>ç”¨æˆ·èº«ä»½è¿è¡Œã€‚æƒ³è¦çœæ‰è¾“å…¥<code>sudo</code>å°±å¿…é¡»è®¾ç½®å½“å‰ç”¨æˆ·æƒé™ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>docker</code>ç”¨æˆ·ç»„å¹¶æŠŠå½“å‰ç”¨æˆ·åŠ åˆ°è¿™ä¸ªç»„é‡Œé¢å»ï¼ŒDocker daemonå¯åŠ¨æ—¶å°±åˆ›å»ºä¸€ä¸ªå¯ä»¥è¢«<code>docker</code>ç”¨æˆ·ç»„è®¿é—®çš„Unix socketã€‚</p><ol><li><p>åˆ›å»º<code>docker</code>ç”¨æˆ·ç»„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo groupadd docker</span><br></pre></td></tr></table></figure></li><li><p>æŠŠå½“å‰ç”¨æˆ·åŠ å…¥<code>docker</code>ç”¨æˆ·ç»„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°ç™»é™†å½“å‰ç”¨æˆ·æ¥ä½¿ç”¨æˆ·ç»„ç”Ÿæ•ˆ</p></li><li><p>æ­¤æ—¶å°±å¯ä»¥ä¸åŠ <code>sudo</code>è¿è¡Œ<code>docker</code>äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world</span><br></pre></td></tr></table></figure></li></ol><h3 id="è®¾ç½®Dockerå¼€æœºå¯åŠ¨"><a href="#è®¾ç½®Dockerå¼€æœºå¯åŠ¨" class="headerlink" title="è®¾ç½®Dockerå¼€æœºå¯åŠ¨"></a>è®¾ç½®Dockerå¼€æœºå¯åŠ¨</h3><p>Ubuntu16.04å¼€å§‹éƒ½ç”¨<code>systemd</code>æ¥ç®¡ç†å¼€æœºå¯åŠ¨æœåŠ¡ã€‚å¦‚æœUbuntu14.10ä»¥ä¸‹åˆ™ä½¿ç”¨<code>upstart</code>ã€‚</p><h4 id="Ubuntu16-04åŠä»¥ä¸Š-systemd"><a href="#Ubuntu16-04åŠä»¥ä¸Š-systemd" class="headerlink" title="Ubuntu16.04åŠä»¥ä¸Š - systemd"></a>Ubuntu16.04åŠä»¥ä¸Š - systemd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker//è®¾ç½®dockerå¼€æœºå¯åŠ¨</span><br><span class="line">$ sudo systemctl <span class="built_in">disable</span> docker//å–æ¶ˆdockerå¼€æœºå¯åŠ¨</span><br></pre></td></tr></table></figure><h4 id="Ubuntu14-10åŠä»¥ä¸‹-upstart"><a href="#Ubuntu14-10åŠä»¥ä¸‹-upstart" class="headerlink" title="Ubuntu14.10åŠä»¥ä¸‹ - upstart"></a>Ubuntu14.10åŠä»¥ä¸‹ - upstart</h4><p>Dockerè¢«upstartè‡ªåŠ¨é…ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œå–æ¶ˆå¼€æœºå¯åŠ¨åˆ™ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> manual | sudo tee /etc/init/docker.override</span><br></pre></td></tr></table></figure><h2 id="Docker-image"><a href="#Docker-image" class="headerlink" title="Docker image"></a>Docker image</h2><p>Docker å®¹å™¨(container)æ˜¯é€šè¿‡è¿è¡Œé•œåƒ(image)æ–‡ä»¶æ¥ç”Ÿæˆçš„ã€‚imageæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„åŒ…ï¼Œå®ƒåŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰ä¸œè¥¿â€”è¿è¡Œæ—¶ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚ä¸€ä¸ªimageå¯ä»¥ç”Ÿæˆå¤šä¸ªåŒæ—¶è¿è¡Œçš„containerã€‚</p><h2 id="Docker-container"><a href="#Docker-container" class="headerlink" title="Docker container"></a>Docker container</h2><p>Docker å®¹å™¨æ˜¯imageçš„ä¸€ä¸ªè¿è¡Œæ—¶å®ä¾‹ã€‚imageè¢«æ‰§è¡Œå¹¶è¢«åŠ è½½åˆ°å†…å­˜å°±å˜æˆä¸€ä¸ªcontainerï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå…·æœ‰çŠ¶æ€çš„imageæˆ–ç”¨æˆ·è¿›ç¨‹ã€‚å¯ä»¥é€šè¿‡<code>docker ps</code>æ¥æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„containerçš„åˆ—è¡¨ã€‚</p><h2 id="å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«"><a href="#å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«" class="headerlink" title="å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«"></a>å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«</h2><p>ä¸€ä¸ªå®¹å™¨åœ¨Linuxä¸Š<strong>åŸç”Ÿ</strong>è¿è¡Œï¼Œå¹¶äºå…¶ä»–å®¹å™¨å…±äº«ä¸»æœºçš„å†…æ ¸ã€‚å®¹å™¨è¿è¡Œè½»é‡çº§çš„ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå æ®èµ„æºç›¸å½“å°‘ã€‚è€Œè™šæ‹Ÿæœºåˆ™è¿è¡Œåœ¨ä¸€ä¸ªå®¢æˆ·æ“ä½œç³»ç»Ÿ(Guest OS)ä¸Šï¼Œå®ƒé€šè¿‡è™šæ‹Ÿæœºæ§åˆ¶å™¨æŠ€æœ¯æ¥è™šæ‹Ÿè®¿é—®è®¿é—®ä¸»æœºçš„èµ„æºï¼Œç›¸å¯¹å…¶ä»–çš„è¿›ç¨‹ï¼Œè™šæ‹Ÿæœºè¦å æ®è¾ƒå¤šçš„æœºå™¨èµ„æºã€‚</p><h2 id="Dockerå¯åŠ¨æœåŠ¡"><a href="#Dockerå¯åŠ¨æœåŠ¡" class="headerlink" title="Dockerå¯åŠ¨æœåŠ¡"></a>Dockerå¯åŠ¨æœåŠ¡</h2><p>Dockeræ˜¯C/Sæ¶æ„ï¼Œè¿è¡Œdockerå‘½ä»¤æ—¶ï¼Œç›¸å½“äºæŠŠä¼ é€’æŒ‡ä»¤ç»™ç›‘å¬ç‰¹å®šUnix socketçš„DockeræœåŠ¡ï¼Œæ‰€ä»¥å¿…é¡»å¯åŠ¨DockeræœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service æ–¹å¼</span></span><br><span class="line">$ sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl æ–¹å¼</span></span><br><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="å®æˆ˜-æ„å»ºä¸€ä¸ªappå¹¶åˆ›å»ºdockeré•œåƒã€‚"><a href="#å®æˆ˜-æ„å»ºä¸€ä¸ªappå¹¶åˆ›å»ºdockeré•œåƒã€‚" class="headerlink" title="å®æˆ˜ - æ„å»ºä¸€ä¸ªappå¹¶åˆ›å»ºdockeré•œåƒã€‚"></a>å®æˆ˜ - æ„å»ºä¸€ä¸ªappå¹¶åˆ›å»ºdockeré•œåƒã€‚</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å¼€å‘ä¸€ä¸ªpython appï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å®‰è£…ä¸€ä¸ªpythonçš„runtimeåˆ°å¼€å‘æœºä¸Šï¼Œè€Œè¿™ä¸ªé…ç½®å¿…é¡»å®Œç¾å¥‘åˆappçš„é…ç½®è¦æ±‚ï¼Œç”Ÿäº§ç¯å¢ƒä¹Ÿå¿…é¡»è¿™æ ·ã€‚</p><p>ä½¿ç”¨Dockerï¼Œå°±å¯ä»¥æŠŠæ‰€éœ€Python runtimeæ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒ(image)ï¼Œæ— éœ€å®‰è£…ã€‚ç„¶ååœ¨appçš„ä»£ç åŒ…å«è¿™ä¸ªimageå³å¯ã€‚æˆ‘ä»¬å°±ç®—æŠŠappçš„ç¯å¢ƒæ‰“åŒ…å¥½äº†ã€‚</p><h3 id="æ­¥éª¤1-é€šè¿‡Dockerfileæ¥å®šä¹‰å®¹å™¨-container"><a href="#æ­¥éª¤1-é€šè¿‡Dockerfileæ¥å®šä¹‰å®¹å™¨-container" class="headerlink" title="æ­¥éª¤1: é€šè¿‡Dockerfileæ¥å®šä¹‰å®¹å™¨(container)"></a>æ­¥éª¤1: é€šè¿‡<code>Dockerfile</code>æ¥å®šä¹‰å®¹å™¨(<code>container</code>)</h3><p><code>Dockerfile</code>å®šä¹‰äº†<code>container</code>å†…çš„è¡Œä¸ºã€‚åœ¨<code>container</code>ç¯å¢ƒä¸­ï¼Œæ‰€æœ‰å¯¹ç¯å¢ƒèµ„æºçš„è®¿é—®ï¼Œä¾‹å¦‚ç½‘ç»œæ¥å£å’Œç£ç›˜é©±åŠ¨ï¼Œéƒ½è¢«è™šæ‹ŸåŒ–äº†ï¼Œå¹¶ä¸<code>container</code>å¤–çš„æ“ä½œç³»ç»Ÿéš”ç¦»ã€‚å› æ­¤éœ€è¦å®šä¹‰åˆ°å®¹å™¨å¤–çš„ç«¯å£ï¼Œå¹¶ç¡®å®šæƒ³è¦â€œæ‹·è´â€åˆ°è¿™ä¸ªç¯å¢ƒçš„æ–‡ä»¶ã€‚åšå®Œè¿™ä¸ªä»¥åï¼Œå°±å¯ä»¥ç¡®ä¿åœ¨<code>Dockerfile</code>ä¸­è¿è¡Œçš„appåœ¨ä»»ä½•å¤–éƒ¨ç¯å¢ƒéƒ½èƒ½å®Œå…¨ç›¸åŒåœ°è¿è¡Œã€‚</p><h4 id="åˆ›å»ºDockerfile"><a href="#åˆ›å»ºDockerfile" class="headerlink" title="åˆ›å»ºDockerfile"></a>åˆ›å»º<code>Dockerfile</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Workspace/dockerdemo</span><br><span class="line">touch Dockerfile</span><br><span class="line">vim Dockerfile</span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/Workspace/dockerdemo/Dockerfile</span></span><br><span class="line"><span class="comment"># ç”¨ä¸€ä¸ªå®˜æ–¹çš„Python runtimeä½œä¸ºçˆ¶image</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">2.7</span>-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•ä¸º /app</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠå½“å‰çš„ç›®å½•å†…å®¹æ‹·è´åˆ° /app ä¸­çš„å®¹å™¨</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… requirements.txt å®šä¹‰çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install --trusted-host pypi.python.org -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠ 80 ç«¯å£å¯¹å®¹å™¨å¤–å¼€æ”¾</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> NAME World</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œ app.py</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>å½“<code>Dockerfile</code>è¢«æ„å»ºä¸ºä¸ºä¸€ä¸ª<code>image</code>ï¼ŒCOPY<code>å‘½ä»¤æŠŠ</code>requirements.txt<code>å’Œ</code>app.py<code>æ‹·è´åˆ°å®¹å™¨å†…ï¼ŒEXPOSEå‘½ä»¤è®©</code>app.py`çš„è¾“å‡ºå¯ä»¥é€šè¿‡HTTPæ¥è®¿é—®ã€‚</p><h3 id="æ­¥éª¤2-æ„å»ºç¤ºä¾‹demo"><a href="#æ­¥éª¤2-æ„å»ºç¤ºä¾‹demo" class="headerlink" title="æ­¥éª¤2: æ„å»ºç¤ºä¾‹demo"></a>æ­¥éª¤2: æ„å»ºç¤ºä¾‹demo</h3><h4 id="ç¼–å†™-demo-appä»£ç "><a href="#ç¼–å†™-demo-appä»£ç " class="headerlink" title="ç¼–å†™ demo appä»£ç "></a>ç¼–å†™ demo appä»£ç </h4><p>ç¼–å†™<code>requirements.txt</code>å’Œ<code>app.py</code>ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨Dockerfileçš„åŒä¸€ç›®å½•ä¸‹ã€‚</p><p><code>requirements.txt</code></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Flask</span></span><br><span class="line"><span class="attribute">Redis</span></span><br></pre></td></tr></table></figure><p><code>app.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis, RedisError</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># Connect to Redis</span></span><br><span class="line">redis = Redis(host=<span class="string">&quot;redis&quot;</span>, db=<span class="number">0</span>, socket_connect_timeout=<span class="number">2</span>, socket_timeout=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        visits = redis.incr(<span class="string">&quot;counter&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> RedisError:</span><br><span class="line">        visits = <span class="string">&quot;&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">    html = <span class="string">&quot;&lt;h3&gt;Hello &#123;name&#125;!&lt;/h3&gt;&quot;</span> \</span><br><span class="line">           <span class="string">&quot;&lt;b&gt;Hostname:&lt;/b&gt; &#123;hostname&#125;&lt;br/&gt;&quot;</span> \</span><br><span class="line">           <span class="string">&quot;&lt;b&gt;Visits:&lt;/b&gt; &#123;visits&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> html.format(name=os.getenv(<span class="string">&quot;NAME&quot;</span>, <span class="string">&quot;world&quot;</span>), hostname=socket.gethostname(), visits=visits)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>è‡³æ­¤appå°±ç¼–å†™å®Œæ¯•äº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>pip install -r requirements.txt</code>è¿™ä¸ªå‘½ä»¤å®‰è£…äº†Flaskå’ŒRedisï¼Œè€Œappæ‰“å°äº†ç¯å¢ƒå˜é‡<code>NAME</code>å’Œ<code>socket.gethostname()</code>çš„è¾“å‡ºã€‚ç”±äºRediså®‰è£…ä¹‹åå¹¶æ²¡æœ‰è¿è¡Œï¼Œæ‰€ä»¥é¢„æœŸappä¼šè¿è¡Œå¤±è´¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p><h4 id="æ„å»ºapp"><a href="#æ„å»ºapp" class="headerlink" title="æ„å»ºapp"></a>æ„å»ºapp</h4><p>æŸ¥çœ‹å½“å‰ç›®å½•çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">Dockerfileapp.pyrequirements.txt</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>build</code>å‘½ä»¤ï¼Œå»ºç«‹Docker imageï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>-t</code>é€‰é¡¹æ¥ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t friendlyhello .</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æ³¨å†Œçš„image</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker image ls</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">friendlyhello       latest              cfb6345425ed        41 seconds ago      132MB</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œapp"><a href="#è¿è¡Œapp" class="headerlink" title="è¿è¡Œapp"></a>è¿è¡Œapp</h4><p><code>docker run</code> å‘½ä»¤è¿è¡Œappï¼Œ<code>-p</code>é€‰é¡¹æŠŠæœºå™¨ä¸Šçš„4000ç«¯å£ç»‘å®šåˆ°containerå‘å¸ƒçš„80ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 4000:80 friendlyhello</span><br><span class="line"> * Serving Flask app <span class="string">&quot;app&quot;</span> (lazy loading)</span><br><span class="line"> * Environment: production</span><br><span class="line">   WARNING: Do not use the development server <span class="keyword">in</span> a production environment.</span><br><span class="line">   Use a production WSGI server instead.</span><br><span class="line"> * Debug mode: off</span><br><span class="line"> * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºä¿¡æ¯è®¿é—®<code>http://0.0.0.0:80</code>ã€‚ä½†å®é™…ä¸Šï¼Œè¿™æ¡ä¿¡æ¯æ¥è‡ªäºå®¹å™¨å†…éƒ¨ï¼Œå®¹å™¨å†…éƒ¨çš„appå¹¶ä¸çŸ¥é“å®ƒæ­£è¿è¡Œäºå®¹å™¨å†…éƒ¨ï¼Œæ‰€ä»¥å®ƒåœ¨å®ä½“æœºä¸Šæ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒçš„åœ°å€<code>http://0.0.0.0:80</code>ï¼Œå®é™…ä¸Šæˆ‘ä»¬å·²ç»æŠŠå®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°äº†ç‰©ç†æœºçš„4000ç«¯å£ï¼Œæ‰€ä»¥çœŸå®åœ°å€æ˜¯<code>http://localhost:4000</code></p><p>ç‚¹å‡» <code>CTRL+C</code>é€€å‡ºè¿›ç¨‹ã€‚</p><p>ä¹Ÿå¯ä»¥æ·»åŠ <code>-d</code>é€‰é¡¹åœ¨åå°è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 4000:80 friendlyhello</span><br><span class="line">6b514ac64d134b52a35394c82839da468dcb94b56123109bd33113e5fdb36d7b </span><br></pre></td></tr></table></figure><p>è¾“å…¥è¯¥å‘½ä»¤åï¼Œå¾—åˆ°äº†ä¸€ä¸ªcontainer IDï¼Œä¾‹å¦‚ä¸Šé¢çš„<code>6b514ac64d134b52a35394c82839da468dcb94b56123109bd33113e5fdb36d7b</code>ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„containeråœ¨åå°è¿è¡Œã€‚ä¹Ÿå¯ä»¥é€šè¿‡<code>docker container ls</code>æ¥æŸ¥çœ‹container IDçš„ç¼©å†™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker container ls</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">6b514ac64d13        friendlyhello       <span class="string">&quot;python app.py&quot;</span>     3 minutes ago       Up 3 minutes        0.0.0.0:4000-&gt;80/tcp   compassionate_shannon</span><br></pre></td></tr></table></figure><p>è¿è¡Œdocker container stopå‘½ä»¤æ¥åœæ­¢containerè¿›ç¨‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop 6b514ac64d13</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤3-åˆ†äº«image"><a href="#æ­¥éª¤3-åˆ†äº«image" class="headerlink" title="æ­¥éª¤3: åˆ†äº«image"></a>æ­¥éª¤3: åˆ†äº«image</h3><p>æˆ‘ä»¬æƒ³è¦æˆ‘ä»¬çš„imageå¯ä»¥éšå¤„è¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥æŠŠè‡ªå·±çš„imageæ¨é€åˆ°Dockerä»“åº“(repository)ä¸­ã€‚Dockerä»“åº“ç±»ä¼¼äºGithubä»“åº“ï¼Œåªæ˜¯ä»£ç å·²ç»è¢«æ„å»ºå¥½äº†ã€‚å¯ä»¥æ³¨å†Œä¸€ä¸ªDocker IDæ¥åˆ›å»ºè‡ªå·±çš„repositoryã€‚Dockerå‘½ä»¤è¡Œé»˜è®¤ä½¿ç”¨å…¬æœ‰ä»“åº“ã€‚</p><h4 id="ç™»é™†Dockerå…¬æœ‰ä»“åº“"><a href="#ç™»é™†Dockerå…¬æœ‰ä»“åº“" class="headerlink" title="ç™»é™†Dockerå…¬æœ‰ä»“åº“"></a>ç™»é™†Dockerå…¬æœ‰ä»“åº“</h4><p>æˆ‘ä»¬éœ€è¦å»<a href="docker.com">Dockerå®˜ç½‘</a>æ³¨å†Œä¸€ä¸ªDocker IDï¼Œåœ¨æœ¬æœºè¾“å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker login</span><br></pre></td></tr></table></figure><p>æ¥ç€è¾“å…¥Docker IDå’Œå¯†ç å³å¯ç™»å½•ã€‚</p><h4 id="ä¸ºimageæ·»åŠ æ ‡ç­¾"><a href="#ä¸ºimageæ·»åŠ æ ‡ç­¾" class="headerlink" title="ä¸ºimageæ·»åŠ æ ‡ç­¾"></a>ä¸ºimageæ·»åŠ æ ‡ç­¾</h4><p>ä¸€ä¸ªä»“åº“ä¸­çš„imageçš„æ ¼å¼æ˜¯<code>username/repository:tag</code>ã€‚è¿™ä¸ªTagæ˜¯å¯é€‰çš„ï¼Œä½†ä¸€èˆ¬æ¨èæ·»åŠ ä¸Šï¼Œå› ä¸ºä»“åº“å¯ä»¥ç”¨tagæ¥è®¾å®šDocker imageç‰ˆæœ¬å·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag image user/repository:tag</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag helloworld maywzh/maywzhrepo:part2</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>docker image ls</code>æ¥æŸ¥çœ‹æ–°çš„æ·»åŠ äº†æ ‡ç­¾çš„image:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker image ls</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">friendlyhello       latest              cfb6345425ed        2 days ago          132MB</span><br><span class="line">koa-demo            0.0.1               628b71e7fc7d        2 weeks ago         675MB</span><br><span class="line">hello-world         latest              4ab4c602aa5e        3 weeks ago         1.84kB</span><br><span class="line">python              2.7-slim            c9cde4658340        4 weeks ago         120MB</span><br><span class="line">node                8.4                 386940f92d24        13 months ago       673MB</span><br></pre></td></tr></table></figure><h4 id="å‘å¸ƒimage"><a href="#å‘å¸ƒimage" class="headerlink" title="å‘å¸ƒimage"></a>å‘å¸ƒimage</h4><p>å¯ä»¥æŠŠæ ‡ç­¾è¿‡çš„imageå‘å¸ƒåˆ°ä»“åº“ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker push username/repository:tag</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦å®Œæˆï¼Œé‚£ä¹ˆä¸Šä¼ çš„ä¸œè¥¿å°±å¯ä»¥è¢«å¯ä»¥è¢«å…¬å¼€è®¿é—®äº†ï¼Œä¹Ÿå¯ä»¥ä¸Š<a href="https://hub.docker.com/">Docker Hub</a>æ¥æŸ¥çœ‹imageä¸Šä¼ çš„imageã€‚</p><h4 id="ä»è¿œç«¯ä»“åº“æ‹‰å–image"><a href="#ä»è¿œç«¯ä»“åº“æ‹‰å–image" class="headerlink" title="ä»è¿œç«¯ä»“åº“æ‹‰å–image"></a>ä»è¿œç«¯ä»“åº“æ‹‰å–image</h4><p>ç»è¿‡ä¹‹å‰çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>docker run</code> åœ¨ä»»ä½•æœºå™¨ä¸Šæ¥è¿è¡Œæˆ‘ä»¬çš„app</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 4000:80 username/repository:tag</span><br></pre></td></tr></table></figure><p>å¦‚æœimageåœ¨æœ¬æœºä¸å¯ç”¨ï¼Œå°±ä¼šæŠŠå®ƒæ‹‰å›åˆ°æœ¬åœ°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 4000:40 </span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Dockeræä¾›äº†ä¸€ç§è™šæ‹ŸåŒ–å®¹å™¨çš„æ–¹å¼æ¥æ‰“åŒ…appä»¥åŠå®ƒçš„è¿è¡Œç¯å¢ƒï¼Œè¯¥å®¹å™¨(container)é€šè¿‡é•œåƒ(image)åˆ›å»ºï¼Œè€Œé•œåƒé€šè¿‡ç¼–å†™<code>dockerfile</code>çš„æ–¹å¼æ¥å®šä¹‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠä¸ºdockeré•œåƒæ·»åŠ æ ‡ç­¾ï¼Œå¹¶æ¨é€åˆ°dockerè¿œç¨‹ä»“åº“ä¸­ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡è¿œç¨‹ä»“åº“ç›´æ¥è¿è¡Œé•œåƒã€‚</p><h2 id="é™„å½•-æ‰€ç”¨çš„æ‰€æœ‰å‘½ä»¤"><a href="#é™„å½•-æ‰€ç”¨çš„æ‰€æœ‰å‘½ä»¤" class="headerlink" title="é™„å½• æ‰€ç”¨çš„æ‰€æœ‰å‘½ä»¤"></a>é™„å½• æ‰€ç”¨çš„æ‰€æœ‰å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker build -t friendlyhello .  <span class="comment"># ç”¨dockerfileæ¥æ„å»ºé•œåƒ</span></span><br><span class="line">docker run -p 4000:80 friendlyhello  <span class="comment"># è¿è¡Œfriendlyhello æŠŠå®¹å™¨ç«¯å£80å¯¼èˆªåˆ°åˆ°è¿è¡Œæœºç«¯å£4000</span></span><br><span class="line">docker run -d -p 4000:80 friendlyhello         <span class="comment"># åå°è¿è¡Œæ¨¡å¼</span></span><br><span class="line">docker container ls                                <span class="comment"># åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨</span></span><br><span class="line">docker container ls -a             <span class="comment"># åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨åŒ…æ‹¬ä¸ºæœªè¿è¡Œçš„</span></span><br><span class="line">docker container stop &lt;<span class="built_in">hash</span>&gt;           <span class="comment"># ä¼˜é›…çš„æ–¹å¼å…³é—­å®¹å™¨</span></span><br><span class="line">docker container <span class="built_in">kill</span> &lt;<span class="built_in">hash</span>&gt;         <span class="comment"># å¼ºåˆ¶æ€æ‰å®¹å™¨è¿›ç¨‹</span></span><br><span class="line">docker container rm &lt;<span class="built_in">hash</span>&gt;        <span class="comment"># åˆ é™¤å®¹å™¨</span></span><br><span class="line">docker container rm $(docker container ls -a -q)         <span class="comment"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker image ls -a                             <span class="comment"># åˆ—å‡ºæ‰€æœ‰çš„é•œåƒ</span></span><br><span class="line">docker image rm &lt;image id&gt;            <span class="comment"># åˆ é™¤ç‰¹å®šé•œåƒ</span></span><br><span class="line">docker image rm $(docker image ls -a -q)   <span class="comment"># åˆ é™¤æ‰€æœ‰é•œåƒ</span></span><br><span class="line">docker login             <span class="comment"># ç™»é™†åˆ°docker CLI session</span></span><br><span class="line">docker tag &lt;image&gt; username/repository:tag  <span class="comment"># ä¸ºé•œåƒæ·»åŠ æ ‡ç­¾æ¥ä¸Šä¼ åˆ°å…¬æœ‰åº“</span></span><br><span class="line">docker push username/repository:tag            <span class="comment"># ä¸Šä¼ é•œåƒåˆ°å…¬æœ‰åº“</span></span><br><span class="line">docker run username/repository:tag                   <span class="comment"># ä»ä»“åº“è¿è¡Œé•œåƒ</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»JWTèŠèŠè®¤è¯</title>
      <link href="/2017/02/10/%E5%AF%86%E7%A0%81%E5%AD%A6/%E4%BB%8EJWT%E8%81%8A%E8%81%8A%E8%AE%A4%E8%AF%81/"/>
      <url>/2017/02/10/%E5%AF%86%E7%A0%81%E5%AD%A6/%E4%BB%8EJWT%E8%81%8A%E8%81%8A%E8%AE%A4%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p><strong>è·¨åŸŸè®¤è¯</strong>æ„æŒ‡æŠŠAæœåŠ¡çš„è®¤è¯çŠ¶æ€å¯åˆ†äº«ç»™BæœåŠ¡ï¼Œè¿™æ ·å•æœåŠ¡çš„Session+cookieçš„è§£å†³æ–¹æ¡ˆå°±ä¸åˆé€‚äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æœåŠ¡ç«¯æ­å»ºsessionæŒä¹…åŒ–å±‚æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯¥å±‚ç”±å¤šä¸ªæœåŠ¡å…±äº«ï¼Œè¿™ç§æ–¹å¼å¯¹æŒä¹…åŒ–å±‚çš„ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯æŠŠè®¤è¯æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯ã€‚å…¶ä¸­ä¸€ç§æ–¹å¼å°±æ˜¯<strong>Json Web Tokens</strong>(JWT)ã€‚</p><a id="more"></a><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>JWTæ˜¯åˆæ¬¡è®¤è¯æ—¶ï¼ŒæœåŠ¡å™¨æŠŠè®¤è¯ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªJsonæ–‡æœ¬ï¼Œå›é€ç»™ç”¨æˆ·ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;andy&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;authority&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;expire&quot;</span>: <span class="string">&quot;201807010000000&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾€åç”¨æˆ·ä¸æœåŠ¡ç«¯é€šä¿¡çš„æ—¶å€™ï¼Œéƒ½è¦å‘å›è¿™ä¸ª JSON å¯¹è±¡ã€‚æœåŠ¡å™¨æ ¹æ®è¯¥å¯¹è±¡æ¥è¿›è¡Œç”¨æˆ·èº«ä»½ç¡®è®¤ã€‚æœåŠ¡å™¨ä¼šåœ¨ç”Ÿæˆè¯¥å¯¹è±¡æ—¶åŠ ä¸Šç­¾åã€‚</p><h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h2><p>JWT ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.Signature</span><br><span class="line">å¤´éƒ¨.è´Ÿè½½.ç­¾å</span><br><span class="line">ä¾‹ï¼šeyJhbGciOijIfdkKjf3mJKL.ejkajEgjkdesdIlk8HJKH9jKyh9jkh9hgty8k.4342kldffjklauyx9jh</span><br></pre></td></tr></table></figure><p>å®ƒæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ç‚¹ï¼ˆ<code>.</code>ï¼‰åˆ†éš”æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚JWT å†…éƒ¨æ— æ¢è¡Œã€‚</p><h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>Header éƒ¨åˆ†æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œæè¿° JWT çš„å…ƒæ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>alg</code>å±æ€§è¡¨ç¤ºç­¾åçš„ç®—æ³•ï¼ˆalgorithmï¼‰ï¼Œé»˜è®¤æ˜¯ HMAC SHA256ï¼ˆå†™æˆ HS256ï¼‰ï¼›<code>typ</code>å±æ€§è¡¨ç¤ºè¿™ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰çš„ç±»å‹ï¼ˆtypeï¼‰ï¼ŒJWT ä»¤ç‰Œç»Ÿä¸€å†™ä¸º<code>JWT</code>ã€‚</p><p>æœ€åï¼Œå°†ä¸Šé¢çš„ JSON å¯¹è±¡ä½¿ç”¨ Base64URL ç®—æ³•ï¼ˆè¯¦è§åæ–‡ï¼‰è½¬æˆå­—ç¬¦ä¸²ã€‚</p><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>Payload éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚JWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œä¾›é€‰ç”¨ã€‚</p><ul><li>iss (issuer)ï¼šç­¾å‘äºº</li><li>exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´</li><li>sub (subject)ï¼šä¸»é¢˜</li><li>aud (audience)ï¼šå—ä¼—</li><li>nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´</li><li>iat (Issued At)ï¼šç­¾å‘æ—¶é—´</li><li>jti (JWT ID)ï¼šç¼–å·</li></ul><p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­—æ®µ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;sub&quot;</span>: <span class="string">&quot;1234567890&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;admin&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª JSON å¯¹è±¡ä¹Ÿè¦ä½¿ç”¨ Base64URL ç®—æ³•è½¬æˆå­—ç¬¦ä¸²ã€‚</p><h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><p>ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç¯¡æ”¹tokenï¼Œéœ€è¦ç­¾åå­—æ®µSignatureã€‚</p><p>æŠŠæœåŠ¡å™¨çš„å¯†é’¥secretä½œä¸ºå‚æ•°ä¼ é€’åˆ°ç­¾åç®—æ³•é‡Œé¢ï¼ŒæŒ‰ç…§å¦‚ä¸‹å…¬å¼è¿›è¡ŒåŠ å¯†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure><p>ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨â€ç‚¹â€ï¼ˆ<code>.</code>ï¼‰åˆ†éš”ï¼Œå°±å¯ä»¥è¿”å›ç»™ç”¨æˆ·ã€‚</p><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JWTï¼Œå¯ä»¥å­˜æ”¾åœ¨Cookieä¸­ï¼Œä¹Ÿå¯ä»¥å­˜æ”¾åœ¨httpè¯·æ±‚çš„Authorizationå¤´éƒ¨å­—æ®µä¸­ï¼Œè¿™æ ·å¯ä»¥è·¨åŸŸè®¤è¯ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.2</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer &lt;token&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ”¾åœ¨ POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œé¢ã€‚</p><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>ï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</p><p>ï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</p><p>ï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p><p>ï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</p><p>ï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</p><p>ï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èº«ä»½è®¤è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¼«è°ˆJavascriptæ¨¡å—åŒ–</title>
      <link href="/2017/01/27/javascript/Javascript%E4%B9%8B%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
      <url>/2017/01/27/javascript/Javascript%E4%B9%8B%E6%A8%A1%E5%9D%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>jsä»£ç 2009å¹´HTML5å…´èµ·åï¼Œå‰ç«¯ä»£ç çš„è¡Œæ•°å·²ç»å‘ˆç°äº•å–·å¼å‘å±•ï¼Œéšç€ä»£ç é‡çš„å¢åŠ ï¼Œæ¨¡å—çš„ç¼ºå¤±çš„ç¼ºç‚¹æ—¥ç›Šå‡¸æ˜¾ï¼ŒJavascriptç¤¾åŒºåšäº†å¾ˆå¤šæ¢ç´¢ã€‚å¦‚ä»ŠJavaScriptæ¨¡å—åŒ–ç¼–ç¨‹çš„æ¦‚å¿µå·²ç»æ™®åŠå¼€æ¥ï¼Œä¸€æèµ·æ¨¡å—åŒ–ï¼Œå¤§å®¶æƒ³åˆ°çš„å¯èƒ½æ˜¯AMDï¼ŒCMDï¼Œrequirejsæˆ–seajsã€‚å…¶å®è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ¦‚å¿µã€‚æœ¬æ–‡å°†ä¼šé™ˆè¿°ä¸‹JavaScriptæ¨¡å—çš„å‰ä¸–ä»Šç”Ÿã€‚</p><a id="more"></a><h2 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h2><blockquote><p>æ¨¡å—,åˆç§°æ„ä»¶,æ˜¯èƒ½å¤Ÿå•ç‹¬å‘½åå¹¶ç‹¬ç«‹åœ°å®Œæˆä¸€å®šåŠŸèƒ½çš„ç¨‹åºè¯­å¥çš„é›†åˆï¼ˆå³ç¨‹åºä»£ç å’Œæ•°æ®ç»“æ„çš„é›†åˆä½“ï¼‰</p></blockquote><p>ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—éœ€è¦èƒ½å¤Ÿç‹¬ç«‹å®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å¼•ç”¨ä¾èµ–å’Œè¢«ä¾èµ–ã€‚ä¾‹å¦‚Cè¯­è¨€ä¸­çš„åº“å’Œå¤´æ–‡ä»¶ï¼ŒJavaä¸­çš„åŒ…ï¼Œç­‰ç­‰ã€‚</p><h2 id="åŸå§‹å†™æ³•"><a href="#åŸå§‹å†™æ³•" class="headerlink" title="åŸå§‹å†™æ³•"></a>åŸå§‹å†™æ³•</h2><p>ä¸€ä¸ªå‡½æ•°å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ¨¡å—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ€ç®€å•çš„å‡½æ•°ï¼Œå¯ä»¥ç§°ä½œä¸€ä¸ªæ¨¡å—</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæ›´åˆç†çš„æ¨¡æ‹Ÿæ¨¡å—æ–¹å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">mod, $, _</span>) </span>&#123;</span><br><span class="line">mod.add = ***;</span><br><span class="line">mod.sub = ***;</span><br><span class="line">&#125;((<span class="built_in">window</span>.mod = <span class="built_in">window</span>.mod || &#123;&#125;), jQuery, Underscore));</span><br></pre></td></tr></table></figure><p>è¿™ä¾æ—§ä¸å®Œç¾ï¼Œå› ä¸ºè¿™ä¸ªæ¨¡å—å¿…é¡»è¦å…ˆä¾èµ–jQueryåº“ã€‚ç†æƒ³çš„æƒ…å†µæ˜¯ï¼Œæ¨¡å—çš„ä¾èµ–é¡ºåºæ˜¯éšæ„çš„ï¼Œæˆ‘ä»¬å¯ä»¥éšæœºé¡ºåºæŒ‡å®šä¾èµ–è€Œä¸ç”¨æ‹…å¿ƒå®šä¹‰å…ˆåçš„é—®é¢˜ã€‚</p><h2 id="CMD-Common-Module-Definition"><a href="#CMD-Common-Module-Definition" class="headerlink" title="CMD(Common Module Definition)"></a>CMD(Common Module Definition)</h2><p>è¯´é“<a href="https://github.com/cmdjs/specification">CMD</a>å°±ä¸èƒ½ä¸æ<a href="http://wiki.commonjs.org/wiki/CommonJS">commonjs</a>ï¼Œæåˆ°commonjså°±ä¸èƒ½ä¸æ<a href="http://nodejs.org/">node</a>ã€‚</p><p>CMDè§„èŒƒå‚ç…§commonjsä¸­çš„æ–¹å¼ï¼Œå®šä¹‰æ¨¡å—çš„æ–¹å¼å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// The module code goes here</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ–‡ä»¶åå°±æ˜¯æ¨¡å—çš„åå­—ï¼Œä½¿ç”¨æ¨¡å—çš„æ–¹æ³•ä¹Ÿå’Œcommonjsä¸­ä¸€è‡´ï¼Œåªéœ€requireå°±å¥½äº†ï¼Œæ¨¡å—åå­—å¯çœç•¥åç¼€ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨event.jsæ¨¡å—</span></span><br><span class="line"><span class="keyword">var</span> ec = <span class="built_in">require</span>(<span class="string">&#x27;event&#x27;</span>);</span><br></pre></td></tr></table></figure><p>CMDçš„å…¸å‹å®ç°å°±æ˜¯<a href="http://seajs.org/">seajs</a>ï¼Œåº”ç”¨çš„å¾ˆå¹¿æ³›ã€‚</p><h2 id="AMD-Asynchronous-Module-Definition"><a href="#AMD-Asynchronous-Module-Definition" class="headerlink" title="AMD(Asynchronous Module Definition)"></a>AMD(Asynchronous Module Definition)</h2><p><a href="https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88">AMD</a>)æ˜¯å¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œç‰¹åˆ«é€‚åˆåœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ï¼Œå…¶è§„èŒƒå’ŒCMDæ˜¯å¾ˆåƒçš„ï¼ŒAMDè§„èŒƒä¸­å®šä¹‰æ¨¡å—çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(id?, dependencies?, factory);</span><br></pre></td></tr></table></figure><p>åŒCMDä¸€æ ·ï¼Œä¸€ä¸ªæ–‡ä»¶å³ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">&quot;beta&quot;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">beta</span>) </span>&#123;</span><br><span class="line">bata.***<span class="comment">//è°ƒç”¨æ¨¡å—</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>AMDä¸»å¼ ä¾èµ–æ³¨å…¥ï¼Œè¿™ç‚¹å’ŒCMDä¸åŒï¼ˆä»¥æ¥æŸ¥æ‰¾ï¼‰ã€‚</p><p>AMDä¹Ÿæ”¯æŒå·²CMDçš„æ–¹å¼æ¥ä½¿ç”¨ä¾èµ–ã€‚</p><p>AMDçš„å…¸å‹å®ç°æœ‰<a href="http://requirejs.org/">requireJS</a>ï¼Œ<a href="https://github.com/fex-team/mod">modJS</a>å’Œ<a href="https://github.com/yanhaijing/lodjs">lodJS</a>ã€‚</p><h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><p><a href="http://yanhaijing.com/es5/">ES6</a>å¸¦æ¥äº†è¯­è¨€å±‚é¢çš„æ¨¡å—åŒ–æ”¯æŒï¼Œè§„èŒƒæ–¹é¢è§<a href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-module-namespace-exotic-objects">è¿™é‡Œ</a>ï¼Œæ–‡æ¡£æ–¹é¢è§<a href="http://es6.ruanyifeng.com/#docs/class">è¿™é‡Œ</a>ã€‚=</p><h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><p><a href="https://github.com/umdjs/umd">UMD</a>çš„å…¨ç§°æ˜¯Universal Module Definitionã€‚å’Œå®ƒåå­—çš„æ„æ€ä¸€æ ·ï¼Œè¿™ç§è§„èŒƒåŸºæœ¬ä¸Šå¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªæ¨¡å—ç¯å¢ƒä¸­å·¥ä½œã€‚</p><p>ä¸€æ®µå…¸å‹çš„UMDä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Data = factory(root);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">        <span class="comment">// AMD</span></span><br><span class="line">        define(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Data;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// Node.js</span></span><br><span class="line">        <span class="built_in">module</span>.exports = Data;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Browser globals</span></span><br><span class="line">        <span class="keyword">var</span> _Data = root.Data;</span><br><span class="line">        </span><br><span class="line">        Data.noConflict = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (root.Data === Data) &#123;</span><br><span class="line">                root.Data = _Data;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> Data;</span><br><span class="line">        &#125;;</span><br><span class="line">        root.Data = Data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="built_in">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> Data = ...</span><br><span class="line"><span class="comment">//è‡ªå·±çš„ä»£ç </span></span><br><span class="line"><span class="keyword">return</span> Data;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å‡ºè‡ª<a href="https://github.com/yanhaijing/data.js">data.js</a>ä¸­çš„ä¸€éƒ¨åˆ†ä»£ç ï¼Œå…¶åŸç†å°±æ˜¯åšä¸ªåˆ¤æ–­ï¼Œä¸åŒçš„ç¯å¢ƒè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¨¡å—åŒ–çš„æ¢ç´¢ï¼Œä½¿å‰ç«¯å·¥ç¨‹åŒ–æˆä¸ºäº†å¯èƒ½ï¼Œå¯ä»¥è¯´æ²¡æœ‰æ¨¡å—ï¼Œå·¥ç¨‹åŒ–æ›´æ— ä»å¼¹èµ·ï¼Œ</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</title>
      <link href="/2017/01/27/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%92%8C%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"/>
      <url>/2017/01/27/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%92%8C%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œæ˜¯åŠ å¯†é€šä¿¡ä¸­å¸¸è§çš„ä¸¤ä¸ªæ¦‚å¿µã€‚wikiçš„å®šä¹‰æ˜¯ï¼š</p><blockquote><p><strong>å¯¹ç§°å¯†é’¥åŠ å¯†</strong>æ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A2%BC%E5%AD%B8">å¯†ç å­¦</a>ä¸­çš„ä¸€ç±»åŠ å¯†ç®—æ³•ã€‚è¿™ç±»ç®—æ³•åœ¨åŠ å¯†å’Œè§£å¯†æ—¶ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œæˆ–æ˜¯ä½¿ç”¨ä¸¤ä¸ªå¯ä»¥ç®€å•åœ°ç›¸äº’æ¨ç®—çš„å¯†é’¥ã€‚</p><p><strong>éå¯¹ç§°åŠ å¯†</strong>ä¹Ÿç§°<strong>éå¯¹ç§°åŠ å¯†</strong>ï¼Œæ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A2%BC%E5%AD%B8">å¯†ç å­¦</a>çš„ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E6%BC%94%E7%AE%97%E6%B3%95">ç®—æ³•</a>ï¼Œå®ƒéœ€è¦ä¸¤ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E9%92%A5">å¯†é’¥</a>ï¼Œä¸€ä¸ªæ˜¯å…¬å¼€å¯†é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§æœ‰å¯†é’¥ï¼›ä¸€ä¸ªç”¨ä½œåŠ å¯†çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªåˆ™ç”¨ä½œè§£å¯†ã€‚ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå¯†é’¥æŠŠ<a href="https://zh.wikipedia.org/wiki/%E6%98%8E%E6%96%87">æ˜æ–‡</a>åŠ å¯†åæ‰€å¾—çš„<a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E6%96%87">å¯†æ–‡</a>ï¼Œåªèƒ½ç”¨ç›¸å¯¹åº”çš„å¦ä¸€ä¸ªå¯†é’¥æ‰èƒ½è§£å¯†å¾—åˆ°åŸæœ¬çš„æ˜æ–‡ï¼›ç”šè‡³è¿æœ€åˆç”¨æ¥åŠ å¯†çš„å¯†é’¥ä¹Ÿä¸èƒ½ç”¨ä½œè§£å¯†ã€‚</p></blockquote><p>ä¸ºäº†ä¾¿äºç†è§£ã€‚æˆ‘ä»¬æ¥ä¸¾ä¾‹è¯´æ˜ã€‚</p><a id="more"></a><h2 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h2><p>å›æƒ³èµ·åˆä¸­æ—¶ä»£çš„å°çº¸æ¡äº†æ²¡ï¼Œå‡è®¾åŒå­¦Aæƒ³ç»™åŒå­¦Bä¼ ä¸€ä¸ªå°çº¸æ¡ï¼Œä½†æ˜¯Aç¦»Béš”ç€å‡ ä¸ªåº§ä½ï¼Œéœ€è¦ç”±ä¸­é—´çš„Cæ¥å¸®å¿™ä¼ çº¸æ¡ï¼Œå› ä¸ºCæ˜¯ä¸ªçˆ±æ‰“å°æŠ¥å‘Šçš„å®¶ä¼™ï¼Œæ‰€ä»¥Aå’ŒBéƒ½ä¸æƒ³è®©CçŸ¥é“çº¸æ¡ä¸­çš„å…·ä½“å†…å®¹æ˜¯ä»€ä¹ˆã€‚äºæ˜¯Aå’ŒBç§ä¸‹çº¦å®šï¼Œçº¸æ¡ä¸­çš„å†…å®¹ä»¥æ‘©å°”æ–¯ç¼–ç æ¥ä»£æ›¿ï¼Œä¾‹å¦‚è¦å‘é€â€œhelloâ€ï¼Œé‚£ä¹ˆçº¸æ¡ä¸­å°±å†™â€œhelloâ€çš„æ‘©å°”æ–¯ç¼–ç â€œâ€¦. . .-.. .-.. â€”- â€ï¼Œç”±äºCä¸çŸ¥é“Aä¸Bçš„çº¦å®šè½¬æ¢è§„åˆ™ï¼Œæ‰€ä»¥ä»–å³ä½¿çœ‹åˆ°äº†çº¸æ¡çš„å†…å®¹ï¼Œä¹Ÿä¸çŸ¥é“Aä¸Bçš„äº¤è°ˆå†…å®¹ã€‚ä½†Bå¾—åˆ°äº†è¿™ä¸ªå¯†æ–‡ï¼Œé€šè¿‡å¯¹ç…§æ‘©å°”æ–¯ç¼–ç è½¬æ¢è¡¨ï¼Œå°±å¯ä»¥å¾—åˆ°åŸå§‹ä¿¡æ¯â€œhelloâ€ã€‚</p><p>æ­¤æ—¶ï¼ŒAä¸Bå°±æ˜¯é€šä¿¡çš„åŒæ–¹ï¼Œæ‘©å°”æ–¯ç¼–ç å°±æ˜¯å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯æ˜æ–‡â€œhelloâ€â€”â€”&gt;å¯†æ–‡â€â€¦. . .-.. .-.. â€”â€œçš„æ˜ å°„å…³ç³»ã€‚</p><p>Aä¸Bç”¨çš„æ˜¯åŒä¸€ä¸ªå¯†é’¥æ¥åŠ å¯†è§£å¯†ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ‘©å°”æ–¯ç¼–ç ã€‚æ‰€ä»¥ç§°ä¸ºå¯¹ç§°åŠ å¯†ã€‚</p><p>æŠ½è±¡ä¸€ç‚¹æ¥è¯´ï¼Œå®é™…ä¸Šå¯†é’¥å°±æ˜¯ä¸€ç§å‡½æ•°/æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬ä»¥encry()æ¥è¡¨ç¤ºã€‚æ•´ä¸ªä¼ é€’è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">Aæ˜æ–‡</span>--<span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">encry</span>--<span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">Aå¯†æ–‡</span>--<span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">Cä¿¡é“</span>--<span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">Bå¯†æ–‡</span>--<span class="literal">-</span><span class="literal">-</span><span class="comment">encry</span>--<span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">Bæ˜æ–‡</span></span><br></pre></td></tr></table></figure><p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œå¯¹ç§°åŠ å¯†å°±æ˜¯é€šä¿¡åŒæ–¹ç”¨çš„æ˜¯ç›¸åŒå¯†é’¥æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</p><p>å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰</p><blockquote><p>DESã€3DESã€AESã€Blowfishã€IDEAã€RC5ã€RC6ã€‚</p></blockquote><h3 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h3><p>å¯¹ç§°åŠ å¯†ç›¸å½“ç®€å•ï¼Œä½†æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·å°±æ˜¯ï¼Œä¸€æ—¦å¯†é’¥è¢«ç¬¬ä¸‰æ–¹è·å–ï¼Œé‚£ä¹ˆåŠ å¯†çš„ä¿¡æ¯å°±å…¨éƒ¨æ³„æ¼äº†ã€‚ä¾æ—§ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºä¾‹ï¼ŒCçŸ¥é“äº†Aä¸Bæ˜¯ç”¨æ‘©å°”æ–¯ç¼–ç æ¥é€šä¿¡ï¼Œé‚£ä¹ˆä»–è·å–äº†æ‘©å°”æ–¯ç¼–ç è¡¨ï¼Œå°±ç›¸å½“äºå®Œå…¨æŒæ¡äº†Aä¸Bçš„é€šä¿¡å†…å®¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬åˆå¼•å…¥äº†éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚</p><h2 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h2><p>å¯¹ç§°åŠ å¯†ç®—æ³•åœ¨äºå…±åŒçš„å¯†é’¥ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•çš„åšæ³•æ˜¯ï¼Œæ¯ä¸ªäººç”Ÿæˆä¸€ä¸ªç§é’¥-å…¬é’¥å¯¹ï¼Œç§é’¥ç”±ä¸ªäººä¿æŠ¤ä¸å…¬å¼€ï¼Œè€Œå…¬é’¥å¯ä»¥éšä¾¿åˆ†äº«ï¼Œæœ€å…³é”®çš„æ˜¯ï¼Œ<strong>ä½¿ç”¨å…¬é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†ï¼Œä½¿ç”¨ç§é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰å¯¹åº”çš„å…¬é’¥èƒ½è§£å¯†</strong>ã€‚</p><p>å‡è®¾ï¼ŒAç”Ÿæˆäº†è‡ªå·±çš„ä¸€ä¸ªç§é’¥-å…¬é’¥å¯¹â€œAç§é’¥-Aå…¬é’¥â€ï¼ŒBä¹Ÿç”Ÿæˆäº†è‡ªå·±çš„ç§é’¥-å…¬é’¥å¯¹â€œBç§é’¥-Bå…¬é’¥â€ï¼Œä¾ç…§éå¯¹ç§°åŠ å¯†çš„åŸåˆ™ï¼ŒAçš„ç§é’¥ç”±Aä¿å­˜åªæœ‰AçŸ¥é“ï¼ŒBåŒç†ã€‚</p><p>æ­¤åˆ»ï¼ŒAæƒ³ç»™Bå‘é€å¯†æ–‡ã€‚</p><p>é€šä¿¡è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">A</span>: â€œhiï¼Œè€å“¥ï¼Œæˆ‘æƒ³ç»™ä½ å‘ä¸ªå¯†æ–‡ï¼ŒæŠŠä½ çš„å…¬é’¥å‘ç»™æˆ‘ä¸€ä¸‹â€</span><br><span class="line"><span class="attribute">B</span>: â€œå¥½å•Šå¥½å•Šï¼Œè¿™æ˜¯æˆ‘çš„å…¬é’¥â€˜HE8eU#hb*!â€™ï¼Œè¯·æŸ¥æ”¶â€</span><br><span class="line"><span class="attribute">A</span>: â€è¿™æ˜¯å¯†æ–‡<span class="string">&#x27;jk2$$#4dfjkl``$@#cds&#x27;</span>â€œ</span><br></pre></td></tr></table></figure><p>è¿™æ—¶Cå¬åˆ°äº†Aå’ŒBçš„é€šè¯ï¼Œè€Œä¸”çŸ¥é“äº†Bçš„å…¬é’¥â€˜HE8eU#hb<em>!â€™å’Œå¯†æ–‡â€™jk2$$#4dfjkl``$@#cdsâ€™ã€‚ä»–å…´å¥‹åœ°å›å»ï¼Œæƒ³è¦è§£å¯†å¯†æ–‡ï¼Œå¬å¬Aå’ŒBåˆ°åº•åœ¨è¯´ä»€ä¹ˆã€‚ä½†æ˜¯ä»–å‘ç°æ²¡æœ‰åŠæ³•è§£å¯†è¿™ä¸ªå¯†æ–‡ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º<strong>å¯†æ–‡æ˜¯ç”¨Bçš„å…¬é’¥æ¥åŠ å¯†çš„</strong>ï¼Œ<em>*åªæœ‰Bçš„ç§é’¥æ‰èƒ½è§£å¯†</em></em>ï¼æ‰€ä»¥Cé™¤äº†Bçš„å…¬é’¥å’Œå¯†æ–‡ä¹‹å¤–ä»€ä¹ˆä¹Ÿå¾—ä¸åˆ°ã€‚è¿™å°±æ˜¯éå¯¹ç§°åŠ å¯†çš„å¼ºå¤§ä¹‹å¤„ã€‚ </p><p>æ€»ç»“ä¸€ä¸‹é€šä¿¡è¿‡ç¨‹ï¼Œå‡è®¾æŸäººå‘é€ä¿¡æ¯ï¼Œé‚£ä¹ˆä»–å…ˆè¦è·å–å¯¹æ–¹çš„å…¬é’¥ï¼Œå†ç”¨è¿™ä¸ªå…¬é’¥æ¥åŠ å¯†æ˜æ–‡ä¸ºå¯†æ–‡å‘é€ç»™å¯¹æ–¹ï¼Œå¯¹æ–¹å†ç”¨è‡ªå·±ç§é’¥æ¥è§£å¯†ä¿¡æ¯ã€‚è€Œç¬¬ä¸‰æ–¹æ²¡æœ‰ç§é’¥ï¼Œæ‰€ä»¥æ²¡æ³•è§£å¯†ã€‚</p><p>ä¸€å¥è¯æ€»ç»“ï¼Œéå¯¹ç§°åŠ å¯†çš„éå¯¹ç§°è¡¨ç°åœ¨ï¼Œ<strong>åŠ å¯†çš„å¯†é’¥å…¬å¼€ï¼Œè€Œè§£å¯†çš„å¯†é’¥ä¸å…¬å¼€</strong>ã€‚</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>æˆ‘ä»¬å¸¸ç”¨çš„å¯†é’¥æ–¹å¼sshç™»é™†æœåŠ¡å™¨çš„æµç¨‹å°±æ˜¯ä»¥éå¯¹ç§°åŠ å¯†æ–¹å¼å®ç°çš„ï¼š</p><ol><li>è¿œç¨‹æœåŠ¡å™¨æŒæœ‰ç”¨æˆ·å…¬é’¥ï¼Œå½“æœ‰ç”¨æˆ·è¿›è¡Œç™»å½•ï¼ŒæœåŠ¡å™¨å°±ä¼šéšæœºç”Ÿæˆä¸€ä¸²å­—ç¬¦ä¸²ï¼Œç„¶åå‘é€ç»™æ­£åœ¨è¿›è¡Œç™»å½•çš„ç”¨æˆ·ã€‚</li><li>ç”¨æˆ·æ”¶åˆ°è¿œç¨‹æœåŠ¡å™¨å‘æ¥çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸<strong>è¿œç¨‹æœåŠ¡å™¨å…¬é’¥é…å¯¹çš„ç§é’¥</strong>å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†ï¼Œå†å‘é€ç»™è¿œç¨‹æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨ä½¿ç”¨å…¬é’¥å¯¹ç”¨æˆ·å‘æ¥çš„åŠ å¯†å­—ç¬¦ä¸²è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°çš„è§£å¯†å­—ç¬¦ä¸²å¦‚æœä¸ç¬¬ä¸€æ­¥ä¸­å‘é€ç»™å®¢æˆ·ç«¯çš„éšæœºå­—ç¬¦ä¸²ä¸€æ ·ï¼Œé‚£ä¹ˆåˆ¤æ–­ä¸ºç™»å½•æˆåŠŸã€‚</li></ol><h3 id="ç¼ºé™·-1"><a href="#ç¼ºé™·-1" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h3><p>éå¯¹ç§°åŠ å¯†å¯ä»¥ç¡®ä¿ï¼Œå‘é€æ–¹çŸ¥é“æ¥æ”¶æ–¹çš„å…¬é’¥çš„å‰æä¸‹ï¼Œè¯¥å¯†æ–‡åœ¨æœ‰æ•ˆæ—¶é—´å†…æ— æ³•è¢«ç ´è§£ã€‚ä½†è¯·æ³¨æ„è¿™ä¸ªå‰æï¼Œå‘é€æ–¹çŸ¥é“æ¥æ”¶æ–¹å…¬é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸‰æ–¹å¯ä»¥ä¼ªé€ è‡ªå·±çš„å…¬é’¥ä¸ºæ¥æ”¶æ–¹å…¬é’¥ï¼Œåœ¨ç¬¬ä¸€æ¬¡é€šä¿¡å»ºç«‹çš„æ—¶å€™ï¼Œå‘é€æ–¹æ— æ³•åˆ†è¾¨ä»–å¾—åˆ°çš„å…¬é’¥æ˜¯ä¸æ˜¯æ¥æ”¶æ–¹å…¬é’¥ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯æ•°å­—ç­¾åå’Œæ•°å­—è¯ä¹¦ã€‚è¯¦æƒ…è¯·è§</p><hr>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¯†ç å­¦ </tag>
            
            <tag> åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptè¯æ³•åˆ†æ</title>
      <link href="/2017/01/23/javascript/JavaScript%E4%B9%8B%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/"/>
      <url>/2017/01/23/javascript/JavaScript%E4%B9%8B%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>JavaScriptå¼•æ“åœ¨ä»£ç æ‰§è¡Œå‰ä¼šè¿›è¡Œè¯æ³•åˆ†æï¼Œè¯æ³•åˆ†æä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><p>åˆ†æå‚æ•° -&gt; åˆ†æå˜é‡çš„å£°æ˜ -&gt; åˆ†æå‡½æ•°å£°æ˜</p><h2 id="è¯æ³•åˆ†æè¿‡ç¨‹"><a href="#è¯æ³•åˆ†æè¿‡ç¨‹" class="headerlink" title="è¯æ³•åˆ†æè¿‡ç¨‹"></a>è¯æ³•åˆ†æè¿‡ç¨‹</h2><p>JavaScriptå‡½æ•°åœ¨è¿è¡Œçš„ç¬é—´ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ´»åŠ¨å¯¹è±¡AOï¼ˆActive Objectï¼‰ï¼Œä¸¾ä¸ªä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;mary&#x27;</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;</span><br><span class="line">f1(<span class="string">&quot;abc&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ†æå‚æ•°ï¼š</strong></p><ol><li>å‡½æ•°æ¥æ”¶å½¢å¼å‚æ•°ï¼Œæ·»åŠ åˆ°AOçš„å±æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶å€™å€¼ä¸º<code>undefined</code>,å³<code>AO.name=undefined</code></li><li>æ¥æ”¶å®å‚<code>&quot;abc&quot;</code>ï¼Œæ·»åŠ åˆ°AOçš„å±æ€§ï¼Œè¦†ç›–ä¹‹å‰çš„<code>undefined</code>ï¼Œå³<code>AO.name=&#39;abc&#39;</code></li></ol><p><strong>ç¬¬äºŒæ­¥ï¼šåˆ†æå˜é‡å£°æ˜ï¼š</strong>å¦‚<code>var name;</code>æˆ–<code>var name=&#39;mary&#39;</code>;</p><ol><li>å¦‚æœä¸Šä¸€æ­¥åˆ†æå‚æ•°ä¸­AOè¿˜æ²¡æœ‰nameå±æ€§ï¼Œåˆ™æ·»åŠ AOå±æ€§ä¸º<code>undefined</code>ï¼Œå³<code>AO.name=undefined</code></li><li>å¦‚æœAOä¸Šé¢å·²ç»æœ‰nameå±æ€§äº†ï¼Œåˆ™ä¸ä½œä»»ä½•ä¿®æ”¹ï¼Œæ­¤æ—¶<code>AO.name===&#39;mary&#39;</code></li></ol><p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ†æå‡½æ•°çš„å£°æ˜ï¼š</strong></p><p>å¦‚æœæœ‰<code>function name()&#123;&#125;</code>æŠŠå‡½æ•°èµ‹ç»™<code>AO.name</code> ,è¦†ç›–ä¸Šä¸€æ­¥åˆ†æçš„å€¼</p><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><p>åˆ†æä¸‹é¢è¿™ä¸ªæ —å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a);           <span class="comment">//function a ()&#123;&#125;</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a);            <span class="comment">//20</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    <span class="built_in">console</span>.log(a);            <span class="comment">//20</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥ï¼Œåˆ†æå‡½æ•°å‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AO.a &#x3D; undefined &#x2F;&#x2F; å½¢å¼å‚æ•°</span><br><span class="line">AO.a &#x3D; 100 &#x2F;&#x2F;æ¥æ”¶å®å‚</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œåˆ†æå±€éƒ¨å˜é‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬4è¡Œä»£ç æœ‰var a,ä½†æ˜¯æ­¤æ—¶å·²æœ‰AO.a &#x3D; 100,æ‰€ä»¥ä¸åšä»»ä½•ä¿®æ”¹ï¼Œå³AO.a &#x3D; 100</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œåˆ†æå‡½æ•°å£°æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬6è¡Œä»£ç æœ‰å‡½æ•°a,åˆ™å°†function a()&#123;&#125;èµ‹ç»™AO.a,å³AO.a &#x3D; function a()&#123;&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»£ç æ—¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬3è¡Œä»£ç è¿è¡Œæ—¶æ‹¿åˆ°çš„aæ—¶è¯æ³•åˆ†æåçš„AO.aï¼Œå³AO.a &#x3D; function a()&#123;&#125;ï¼›</span><br><span class="line">ç¬¬4è¡Œä»£ç ï¼šå°†20èµ‹å€¼ç»™a,æ­¤æ—¶a&#x3D;20;</span><br><span class="line">ç¬¬5è¡Œä»£ç è¿è¡Œæ—¶aå·²ç»è¢«èµ‹å€¼ä¸º20,ç»“æœ20ï¼›</span><br><span class="line">ç¬¬6è¡Œä»£ç æ˜¯ä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ä¸åšä»»ä½•æ“ä½œï¼›</span><br><span class="line">ç¬¬7è¡Œä»£ç è¿è¡Œæ—¶ä»æ˜¯20ï¼›</span><br></pre></td></tr></table></figure><p>ps:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="number">2.</span><span class="keyword">function</span> test(a)&#123;</span><br><span class="line"><span class="number">3.</span>    <span class="keyword">var</span> a;               <span class="comment">//è¯æ˜è¯æ³•åˆ†æç¬¬äºŒæ­¥ã€‚</span></span><br><span class="line"><span class="number">4.</span>    alert(a);           <span class="comment">//100</span></span><br><span class="line"><span class="number">5.</span>    a = <span class="number">20</span>;</span><br><span class="line"><span class="number">6.</span>    alert(a);           <span class="comment">//20</span></span><br><span class="line"><span class="number">7.</span>&#125;</span><br><span class="line"><span class="number">7.</span>test(<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>ps:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">    alert(a);         <span class="comment">//100</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">20</span>;</span><br><span class="line">    alert(a);         <span class="comment">//20</span></span><br><span class="line">    a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;        <span class="comment">//æ˜¯èµ‹å€¼ï¼Œåªæœ‰åœ¨æ‰§è¡Œæ—¶æ‰æœ‰æ•ˆ</span></span><br><span class="line">    alert(a);         <span class="comment">//function()&#123;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>ps:(æ‰§è¡Œç»“æœåŒä¸Š)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">    alert(a);                <span class="comment">//100</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">20</span>;</span><br><span class="line">    alert(a);                <span class="comment">//20</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;        <span class="comment">//æ˜¯èµ‹å€¼ï¼Œåªæœ‰åœ¨æ‰§è¡Œæ—¶æ‰æœ‰æ•ˆ</span></span><br><span class="line">    alert(a);                <span class="comment">//function()&#123;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p><strong>è¡¥å……è¯´æ˜ï¼šå‡½æ•°å£°æ˜ä¸å‡½æ•°è¡¨è¾¾å¼</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡½æ•°å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‡½æ•°è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aå’Œbåœ¨è¯æ³•åˆ†ææ—¶ï¼ŒåŒºåˆ«ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aåœ¨è¯æ³•åˆ†ææ—¶ï¼Œå°±å‘æŒ¥ä½œç”¨ï¼›</span><br><span class="line">båªæœ‰åœ¨æ‰§è¡Œé˜¶æ®µï¼Œæ‰å‘æŒ¥ä½œç”¨ã€‚</span><br></pre></td></tr></table></figure><h2 id="è¯æ³•ä½œç”¨åŸŸ"><a href="#è¯æ³•ä½œç”¨åŸŸ" class="headerlink" title="è¯æ³•ä½œç”¨åŸŸ"></a>è¯æ³•ä½œç”¨åŸŸ</h2><p>è¯æ³•ä½œç”¨åŸŸçš„æ„æ€æ˜¯ï¼Œä½œç”¨åŸŸä¸ºåœ¨å®šä¹‰æ—¶(è¯æ³•åˆ†ææ—¶)å°±ç¡®å®šä¸‹æ¥çš„ï¼Œè€Œå¹¶éåœ¨æ‰§è¡Œæ—¶ç¡®å®šã€‚å³åœ¨å‡½æ•°æœªæ‰§è¡Œå‰ï¼Œå‡½æ•°æ‰§è¡Œçš„é¡ºåºå·²ç»è¢«ç¡®å®šï¼Œè€Œä¸æ˜¯ç±»ä¼¼JAVAä¸€æ ·ï¼Œæ˜¯åœ¨æ‰§è¡Œå‰æ ¹æœ¬ä¸çŸ¥é“æ‰§è¡Œé¡ºåºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æ˜tmuxç©æ³•æ•™ç¨‹</title>
      <link href="/2017/01/09/Linux/%E5%B7%A5%E5%85%B7%E4%B9%8B%E7%AE%80%E6%98%8Etmux%E7%8E%A9%E6%B3%95%E6%95%99%E7%A8%8B/"/>
      <url>/2017/01/09/Linux/%E5%B7%A5%E5%85%B7%E4%B9%8B%E7%AE%80%E6%98%8Etmux%E7%8E%A9%E6%B3%95%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="çŒ«å“¥-kaiye-ç¼–ç¨‹ç¬”è®°"><a href="#çŒ«å“¥-kaiye-ç¼–ç¨‹ç¬”è®°" class="headerlink" title="çŒ«å“¥_kaiye | ç¼–ç¨‹ç¬”è®°"></a><a href="https://www.cnblogs.com/kaiye/">çŒ«å“¥_kaiye | ç¼–ç¨‹ç¬”è®°</a></h1><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h1 id="ååˆ†é’Ÿå­¦ä¼š-tmux"><a href="#ååˆ†é’Ÿå­¦ä¼š-tmux" class="headerlink" title="ååˆ†é’Ÿå­¦ä¼š tmux"></a><a href="https://www.cnblogs.com/kaiye/p/6275207.html">ååˆ†é’Ÿå­¦ä¼š tmux</a></h1><p>tmux æ˜¯ä¸€æ¬¾ç»ˆç«¯å¤ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸€èˆ¬ç”¨äº Terminal çš„çª—å£ç®¡ç†ã€‚åœ¨ macOS ä¸‹ï¼Œä½¿ç”¨ iTerm2 èƒ½åº”ä»˜ç»å¤§å¤šæ•°çª—å£ç®¡ç†çš„éœ€æ±‚ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://images2015.cnblogs.com/blog/520689/201701/520689-20170111205923853-1701606139.png" alt="img"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒiTerm2 èƒ½æ–°å»ºå¤šä¸ªæ ‡ç­¾é¡µï¼ˆå¿«æ·é”® âŒ˜Tï¼‰ï¼Œä¹Ÿèƒ½åœ¨åŒä¸€ä¸ªçª—å£ä¸­åˆ†å‰²å‡ºå¤šä¸ªçª—æ ¼ï¼ˆå¿«æ·é”® âŒ˜D æˆ– âŒ˜â‡§Dï¼‰ã€‚</p><p>tmux ç›¸æ¯” iTerm2 çš„ä¼˜åŠ¿åœ¨äºï¼š</p><ul><li>iTerm2 çš„çª—æ ¼åˆ‡æ¢å¿«æ·é”®ï¼ˆâŒ˜âŒ¥â†’ï¼‰å®¹æ˜“ä¸å…¶ä»–è½¯ä»¶å…¨å±€å¿«æ·é”®å†²çªï¼ˆä¾‹å¦‚ Spectacle çš„çª—å£åˆ†å‰²å¿«æ·é”®ï¼‰ï¼Œtmux ç”±äºå­˜åœ¨å‰ç¼€å¿«æ·é”®ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¿«æ·é”®å†²çªé—®é¢˜ï¼›</li><li>tmux å¯ä»¥åœ¨ç»ˆç«¯è½¯ä»¶é‡å¯åé€šè¿‡å‘½ä»¤è¡Œæ¢å¤ä¸Šæ¬¡çš„ session ï¼Œè€Œç»ˆç«¯è½¯ä»¶åˆ™ä¸è¡Œï¼›</li><li>tmux ç®€æ´ä¼˜é›…ã€è®¢åˆ¶æ€§å¼ºï¼Œå­¦ä¼šä¹‹åä¹Ÿèƒ½åœ¨ Linux ä¸Šä½¿ç”¨ï¼Œæœ‰åŠ©äºé€¼æ ¼æå‡ã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬èŠ±ååˆ†é’Ÿæ¥æŒæ¡ä¸‹ tmux çš„åŸºç¡€ç”¨æ³•ï¼š</p><h2 id="å®‰è£…è¿è¡Œ"><a href="#å®‰è£…è¿è¡Œ" class="headerlink" title="å®‰è£…è¿è¡Œ"></a>å®‰è£…è¿è¡Œ</h2><p>macOS ä¸Šä½¿ç”¨ Homebrew å®‰è£…å³å¯ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>tmux</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œè¿è¡Œ <code>tmux</code> æ–°å»ºä¸€ä¸ª tmux çš„ä¼šè¯ï¼ˆsessionï¼‰ï¼Œæ­¤æ—¶çª—å£å”¯ä¸€çš„å˜åŒ–æ˜¯åœ¨åº•éƒ¨ä¼šå‡ºç°ä¸€ä¸ª tmux çš„çŠ¶æ€æ ã€‚æˆ‘ä»¬å…ˆæŒ‰ä¸‹ tmux é»˜è®¤çš„å‰ç¼€å¿«æ·é”® <code>âŒƒb</code> å°†å…¶æ¿€æ´»ä¸ºå¿«æ·é”®æ¥æ”¶æ¨¡å¼ï¼Œå†æŒ‰ä¸‹ <code>%</code> ï¼Œå³å¯å°†å½“å‰çª—å£åˆ‡åˆ†ä¸ºå·¦å³ä¸¤ä¸ªçª—æ ¼ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://images2015.cnblogs.com/blog/520689/201701/520689-20170111205933322-578444111.png" alt="img"></p><h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ tmux ä¸­æ‰€æœ‰çš„å¿«æ·é”®éƒ½éœ€è¦å’Œå‰ç¼€å¿«æ·é”® <code>âŒƒb</code> æ¥ç»„åˆä½¿ç”¨ï¼ˆæ³¨ï¼šâŒƒ ä¸º Mac çš„ control é”®ï¼‰ï¼Œä»¥ä¸‹æ˜¯å¸¸ç”¨çš„çª—æ ¼ï¼ˆpaneï¼‰å¿«æ·é”®åˆ—è¡¨ï¼Œå¤§å®¶å¯ä»¥ä¾æ¬¡å°è¯•ä¸‹ï¼š</p><h3 id="çª—æ ¼æ“ä½œ"><a href="#çª—æ ¼æ“ä½œ" class="headerlink" title="çª—æ ¼æ“ä½œ"></a>çª—æ ¼æ“ä½œ</h3><ul><li><code>%</code> å·¦å³å¹³åˆ†å‡ºä¸¤ä¸ªçª—æ ¼</li><li><code>&quot;</code> ä¸Šä¸‹å¹³åˆ†å‡ºä¸¤ä¸ªçª—æ ¼</li><li><code>x</code> å…³é—­å½“å‰çª—æ ¼</li><li><code>&#123;</code> å½“å‰çª—æ ¼å‰ç§»</li><li><code>&#125;</code> å½“å‰çª—æ ¼åç§»</li><li><code>;</code> é€‰æ‹©ä¸Šæ¬¡ä½¿ç”¨çš„çª—æ ¼</li><li><code>o</code> é€‰æ‹©ä¸‹ä¸€ä¸ªçª—æ ¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šä¸‹å·¦å³æ–¹å‘é”®æ¥é€‰æ‹©</li><li><code>space</code> åˆ‡æ¢çª—æ ¼å¸ƒå±€ï¼Œtmux å†…ç½®äº†äº”ç§çª—æ ¼å¸ƒå±€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>âŒ¥1</code> è‡³ <code>âŒ¥5</code>æ¥åˆ‡æ¢</li><li><code>z</code> æœ€å¤§åŒ–å½“å‰çª—æ ¼ï¼Œå†æ¬¡æ‰§è¡Œå¯æ¢å¤åŸæ¥å¤§å°</li><li><code>q</code> æ˜¾ç¤ºæ‰€æœ‰çª—æ ¼çš„åºå·ï¼Œåœ¨åºå·å‡ºç°æœŸé—´æŒ‰ä¸‹å¯¹åº”çš„æ•°å­—ï¼Œå³å¯è·³è½¬è‡³å¯¹åº”çš„çª—æ ¼</li></ul><h3 id="çª—å£æ“ä½œ"><a href="#çª—å£æ“ä½œ" class="headerlink" title="çª—å£æ“ä½œ"></a>çª—å£æ“ä½œ</h3><p>tmux é™¤äº†çª—æ ¼ä»¥å¤–ï¼Œè¿˜æœ‰çª—å£ï¼ˆwindowï¼‰ çš„æ¦‚å¿µã€‚ä¾æ¬¡ä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®æ¥ç†Ÿæ‚‰ tmux çš„çª—å£æ“ä½œï¼š</p><ul><li><code>c</code> æ–°å»ºçª—å£ï¼Œæ­¤æ—¶å½“å‰çª—å£ä¼šåˆ‡æ¢è‡³æ–°çª—å£ï¼Œä¸å½±å“åŸæœ‰çª—å£çš„çŠ¶æ€</li><li><code>p</code> åˆ‡æ¢è‡³ä¸Šä¸€çª—å£</li><li><code>n</code> åˆ‡æ¢è‡³ä¸‹ä¸€çª—å£</li><li><code>w</code> çª—å£åˆ—è¡¨é€‰æ‹©ï¼Œæ³¨æ„ macOS ä¸‹ä½¿ç”¨ <code>âŒƒp</code> å’Œ <code>âŒƒn</code> è¿›è¡Œä¸Šä¸‹é€‰æ‹©</li><li><code>&amp;</code> å…³é—­å½“å‰çª—å£</li><li><code>,</code> é‡å‘½åçª—å£ï¼Œå¯ä»¥ä½¿ç”¨ä¸­æ–‡ï¼Œé‡å‘½ååèƒ½åœ¨ tmux çŠ¶æ€æ æ›´å¿«é€Ÿçš„è¯†åˆ«çª—å£ id</li><li><code>0</code> åˆ‡æ¢è‡³ 0 å·çª—å£ï¼Œä½¿ç”¨å…¶ä»–æ•°å­— id åˆ‡æ¢è‡³å¯¹åº”çª—å£</li><li><code>f</code> æ ¹æ®çª—å£åæœç´¢é€‰æ‹©çª—å£ï¼Œå¯æ¨¡ç³ŠåŒ¹é…</li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://images2015.cnblogs.com/blog/520689/201701/520689-20170111205944010-1132178011.png" alt="img"></p><h3 id="ä¼šè¯æ“ä½œ"><a href="#ä¼šè¯æ“ä½œ" class="headerlink" title="ä¼šè¯æ“ä½œ"></a>ä¼šè¯æ“ä½œ</h3><p>å¦‚æœè¿è¡Œäº†å¤šæ¬¡ <code>tmux</code> å‘½ä»¤åˆ™ä¼šå¼€å¯å¤šä¸ª tmux ä¼šè¯ï¼ˆsessionï¼‰ã€‚åœ¨ tmux ä¼šè¯ä¸­ï¼Œä½¿ç”¨å‰ç¼€å¿«æ·é”® <code>âŒƒb</code> é…åˆä»¥ä¸‹å¿«æ·é”®å¯æ“ä½œä¼šè¯ï¼š</p><ul><li><code>$</code> é‡å‘½åå½“å‰ä¼šè¯</li><li><code>s</code> é€‰æ‹©ä¼šè¯åˆ—è¡¨</li><li><code>d</code> detach å½“å‰ä¼šè¯ï¼Œè¿è¡Œåå°†ä¼šé€€å‡º tmux è¿›ç¨‹ï¼Œè¿”å›è‡³ shell ä¸»è¿›ç¨‹</li></ul><p>åœ¨ shell ä¸»è¿›ç¨‹ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æ“ä½œ tmux ä¼šè¯ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tmux <span class="built_in">new</span> -s foo <span class="comment"># æ–°å»ºåç§°ä¸º foo çš„ä¼šè¯</span></span><br><span class="line">tmux ls <span class="comment"># åˆ—å‡ºæ‰€æœ‰ tmux ä¼šè¯</span></span><br><span class="line">tmux <span class="keyword">a</span> <span class="comment"># æ¢å¤è‡³ä¸Šä¸€æ¬¡çš„ä¼šè¯</span></span><br><span class="line">tmux <span class="keyword">a</span> -t foo <span class="comment"># æ¢å¤åç§°ä¸º foo çš„ä¼šè¯ï¼Œä¼šè¯é»˜è®¤åç§°ä¸ºæ•°å­—</span></span><br><span class="line">tmux <span class="built_in">kill</span>-session -t foo <span class="comment"># åˆ é™¤åç§°ä¸º foo çš„ä¼šè¯</span></span><br><span class="line">tmux <span class="built_in">kill</span>-server <span class="comment"># åˆ é™¤æ‰€æœ‰çš„ä¼šè¯</span></span><br></pre></td></tr></table></figure><p>é™¤ä»¥ä¸Šæåˆ°çš„å¿«æ·é”®ä»¥å¤–ï¼Œtmux è¿˜æœ‰è®¸å¤šå…¶ä»–çš„å¿«æ·é”®å’Œå‘½ä»¤ï¼Œä½¿ç”¨å‰ç¼€å¿«æ·é”® <code>âŒƒb</code> åŠ  <code>?</code> å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„å¿«æ·é”®åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨è§†å›¾ä¸º <strong>tmux copy æ¨¡å¼</strong>ï¼Œè¯¥æ¨¡å¼ä¸‹å¯ä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®ï¼ˆæ— éœ€åŠ  <code>âŒƒb</code> å‰ç¼€ï¼‰ï¼š</p><ul><li><code>âŒƒv</code> ä¸‹ä¸€é¡µ</li><li><code>Meta v</code> ä¸Šä¸€é¡µ ï¼ˆtmux å¿«æ·é”®ä¸º Emacs é£æ ¼ï¼Œè¿™é‡Œçš„ Meta é”®å¯ç”¨ Esc æ¨¡æ‹Ÿï¼‰</li><li><code>âŒƒs</code> å‘å‰æœç´¢</li><li><code>q</code> é€€å‡º copy æ¨¡å¼</li></ul><h2 id="å¸¸è§é…ç½®ä¸é—®é¢˜"><a href="#å¸¸è§é…ç½®ä¸é—®é¢˜" class="headerlink" title="å¸¸è§é…ç½®ä¸é—®é¢˜"></a>å¸¸è§é…ç½®ä¸é—®é¢˜</h2><h3 id="1ã€é¼ æ ‡æ»šå±"><a href="#1ã€é¼ æ ‡æ»šå±" class="headerlink" title="1ã€é¼ æ ‡æ»šå±"></a>1ã€é¼ æ ‡æ»šå±</h3><p>tmux é»˜è®¤é…ç½®ä¸­æœ€ç³Ÿç³•çš„ä½“éªŒå°±æ˜¯æ»šå±æŸ¥çœ‹å’Œæ–‡æœ¬å¤åˆ¶ï¼ˆå¤§å®¶å¯ä»¥å…ˆè¯•è¯•çœ‹ï¼‰ã€‚ä½ éœ€è¦å…ˆä½¿ç”¨ <code>âŒƒb</code> <code>[</code> å¿«æ·é”®è¿›å…¥ copy æ¨¡å¼ï¼Œç„¶åä½¿ç”¨ç¿»é¡µã€å­—ç¬¦å®šä½æ¥é€‰æ‹©éœ€è¦çš„å­—ç¬¦ï¼Œæ•ˆç‡è¿œæ²¡æœ‰é¼ æ ‡é€‰æ‹©æ¥çš„å¿«ã€‚</p><p>å› æ­¤ tmux æä¾›äº†ä¸€äº›ä¸ªæ€§åŒ–é…ç½®é¡¹æ¥ä¼˜åŒ–è¿™äº›é…ç½®ï¼Œé¦–å…ˆåœ¨ shell ä¸­è¿è¡Œ <code>touch ~/.tmux.conf</code> æ–°å»ºç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯é¼ æ ‡æ¨¡å¼</span></span><br><span class="line"><span class="string">set </span>-g <span class="string">mode-mouse </span><span class="string">on</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span> å…è®¸é¼ æ ‡é€‰æ‹©çª—æ ¼</span><br><span class="line"><span class="string">set </span>-g <span class="string">mouse-select-</span><span class="string">pane </span><span class="string">on</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span> å¦‚æœå–œæ¬¢ç»™çª—å£è‡ªå®šä¹‰å‘½åï¼Œé‚£ä¹ˆéœ€è¦å…³é—­çª—å£çš„è‡ªåŠ¨å‘½å</span><br><span class="line"><span class="built_in">set-option</span> -g <span class="string">allow-rename </span><span class="string">off</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span> å¦‚æœå¯¹ <span class="string">vim </span>æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¯ä»¥å°† <span class="string">copy </span><span class="string">mode </span>çš„å¿«æ·é”®æ¢æˆ <span class="string">vi </span>æ¨¡å¼</span><br><span class="line"><span class="built_in">set-window-option</span> -g <span class="string">mode-keys </span><span class="string">vi</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¿®æ”¹å®Œæˆåï¼Œå¯ä»¥ <code>tmux kill-server</code> é‡å¯æ‰€æœ‰ tmux è¿›ç¨‹ï¼Œæˆ–è€…åœ¨ tmux ä¼šè¯ä¸­ä½¿ç”¨ <code>âŒƒb</code> <code>:</code> è¿›å…¥æ§åˆ¶å°æ¨¡å¼ï¼Œè¾“å…¥ <code>source-file ~/.tmux.conf</code> å‘½ä»¤é‡æ–°åŠ è½½é…ç½®ã€‚</p><h3 id="2ã€é¼ æ ‡å¤åˆ¶"><a href="#2ã€é¼ æ ‡å¤åˆ¶" class="headerlink" title="2ã€é¼ æ ‡å¤åˆ¶"></a>2ã€é¼ æ ‡å¤åˆ¶</h3><p>tmux ä¸‹å¼€å¯é¼ æ ‡æ»šå±åï¼Œå¤åˆ¶æ–‡æœ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ–¹æ³• 1ï¼šä½¿ç”¨ <code>âŒƒb</code> <code>z</code> è¿›å…¥çª—æ ¼å…¨å±æ¨¡å¼ï¼Œé¼ æ ‡é€‰æ‹©æ–‡æœ¬çš„åŒæ—¶æŒ‰ä½ option é”® <code>âŒ¥</code>ï¼Œç„¶åä½¿ç”¨ <code>âŒ˜c</code> è¿›è¡Œå¤åˆ¶ï¼›</li><li>æ–¹æ³• 2ï¼šå¼€å¯ iTerm2 ã€Œåœ¨é€‰æ‹©æ—¶å¤åˆ¶ã€é€‰é¡¹ï¼Œå³å¯å®ç°è‡ªåŠ¨é€‰æ‹©å¤åˆ¶ã€‚å¦‚ä¸‹å›¾ï¼š</li></ul><p><img src= "/img/loading2.gif" data-lazy-src="https://images2015.cnblogs.com/blog/520689/201701/520689-20170111210013541-836018258.png" alt="img"></p><h3 id="3ã€tips"><a href="#3ã€tips" class="headerlink" title="3ã€tips"></a>3ã€tips</h3><ul><li><a href="http://hyperpolyglot.org/multiplexers">screen</a> æ˜¯å¦å¤–ä¸€æ¬¾ç»ˆç«¯å¤ç”¨å‘½ä»¤è¡Œï¼Œä½†ä»–æ²¡æœ‰ tmux å¥½çœ‹å¥½ç”¨ï¼›</li><li><a href="https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard#mac-os-x-pasteboard-access-under-tmux-and-screen">tmux æœ‰ä¸ª bug</a> ï¼Œå¯¼è‡´ä»å®ƒå¯åŠ¨çš„ vscode çš„å¤åˆ¶ç²˜è´´å¿«æ·é”®ä¼šå¤±æ•ˆï¼›</li><li>iTerm2 å¯ä»¥é€šè¿‡ ã€ŒPreferences -&gt; Profiles -&gt; Keyboard Behavior -&gt; Left option key acts as +Escã€å°†é”®ç›˜çš„å·¦ä¾§ option é”®æ˜ å°„ä¸º Meta é”®</li></ul><p>å¦å¤–ï¼Œæœ€è¿‘çœ‹åˆ°ä¸¤ç¯‡ä¸é”™çš„ <a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9AAWK.md">awk</a>ã€<a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ASED.md">sed</a> å‘½ä»¤å…¥é—¨ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±çœ‹ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(è½¬è½½)é˜¿é‡ŒRediså¼€å‘è§„èŒƒç¬”è®°</title>
      <link href="/2017/01/08/Redis/%E9%98%BF%E9%87%8CRedis%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83%E7%AC%94%E8%AE%B0/"/>
      <url>/2017/01/08/Redis/%E9%98%BF%E9%87%8CRedis%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨ä½¿ç”¨é˜¿é‡Œäº‘Redisçš„å¼€å‘è§„èŒƒï¼Œä»ä¸‹é¢å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯´æ˜ã€‚</p><ul><li>é”®å€¼è®¾è®¡</li><li>å‘½ä»¤ä½¿ç”¨</li><li>å®¢æˆ·ç«¯ä½¿ç”¨</li><li>ç›¸å…³å·¥å…·</li></ul><p>é€šè¿‡æœ¬æ–‡çš„ä»‹ç»å¯ä»¥å‡å°‘ä½¿ç”¨Redisè¿‡ç¨‹å¸¦æ¥çš„é—®é¢˜ã€‚</p><a id="more"></a><h2 id="é”®å€¼è®¾è®¡"><a href="#é”®å€¼è®¾è®¡" class="headerlink" title="é”®å€¼è®¾è®¡"></a>é”®å€¼è®¾è®¡</h2><h3 id="keyåè®¾è®¡"><a href="#keyåè®¾è®¡" class="headerlink" title="keyåè®¾è®¡"></a>keyåè®¾è®¡</h3><h4 id="å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§"><a href="#å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§" class="headerlink" title="å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§"></a>å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§</h4><p>ä»¥ä¸šåŠ¡å(æˆ–æ•°æ®åº“å)ä¸ºå‰ç¼€(é˜²æ­¢keyå†²çª)ï¼Œç”¨å†’å·åˆ†éš”ï¼Œæ¯”å¦‚ä¸šåŠ¡å:è¡¨å:id</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ugc:video:<span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="ç®€æ´æ€§"><a href="#ç®€æ´æ€§" class="headerlink" title="ç®€æ´æ€§"></a>ç®€æ´æ€§</h4><p>ä¿è¯è¯­ä¹‰çš„å‰æä¸‹ï¼Œæ§åˆ¶keyçš„é•¿åº¦ï¼Œå½“keyè¾ƒå¤šæ—¶ï¼Œå†…å­˜å ç”¨ä¹Ÿä¸å®¹å¿½è§†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user:&#123;uid&#125;:friends:messages:&#123;mid&#125;ç®€åŒ–ä¸ºu:&#123;uid&#125;:fr:m:&#123;mid&#125;ã€‚</span><br></pre></td></tr></table></figure><h4 id="ä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦"><a href="#ä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦"></a>ä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦</h4><p>åä¾‹ï¼šåŒ…å«ç©ºæ ¼ã€æ¢è¡Œã€å•åŒå¼•å·ä»¥åŠå…¶ä»–è½¬ä¹‰å­—ç¬¦</p><h3 id="valueè®¾è®¡"><a href="#valueè®¾è®¡" class="headerlink" title="valueè®¾è®¡"></a>valueè®¾è®¡</h3><h4 id="æ‹’ç»bigkey"><a href="#æ‹’ç»bigkey" class="headerlink" title="æ‹’ç»bigkey"></a>æ‹’ç»bigkey</h4><p>é˜²æ­¢ç½‘å¡æµé‡ã€æ…¢æŸ¥è¯¢ï¼Œstringç±»å‹æ§åˆ¶åœ¨10KBä»¥å†…ï¼Œhashã€listã€setã€zsetå…ƒç´ ä¸ªæ•°ä¸è¦è¶…è¿‡5000ã€‚åä¾‹ï¼šä¸€ä¸ªåŒ…å«200ä¸‡ä¸ªå…ƒç´ çš„listã€‚éå­—ç¬¦ä¸²çš„bigkeyï¼Œä¸è¦ä½¿ç”¨delåˆ é™¤ï¼Œä½¿ç”¨hscanã€sscanã€zscanæ–¹å¼æ¸è¿›å¼åˆ é™¤ï¼ŒåŒæ—¶è¦æ³¨æ„é˜²æ­¢bigkeyè¿‡æœŸæ—¶é—´è‡ªåŠ¨åˆ é™¤é—®é¢˜(ä¾‹å¦‚ä¸€ä¸ª200ä¸‡çš„zsetè®¾ç½®1å°æ—¶è¿‡æœŸï¼Œä¼šè§¦å‘delæ“ä½œï¼Œé€ æˆé˜»å¡ï¼Œè€Œä¸”è¯¥æ“ä½œä¸ä¼šä¸å‡ºç°åœ¨æ…¢æŸ¥è¯¢ä¸­(latencyå¯æŸ¥))ï¼ŒæŸ¥æ‰¾æ–¹æ³•å’Œåˆ é™¤æ–¹æ³•</p><h4 id="é€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹"><a href="#é€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹" class="headerlink" title="é€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹"></a>é€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹</h4><p>ä¾‹å¦‚ï¼šå®ä½“ç±»å‹(è¦åˆç†æ§åˆ¶å’Œä½¿ç”¨æ•°æ®ç»“æ„å†…å­˜ç¼–ç ä¼˜åŒ–é…ç½®,ä¾‹å¦‚ziplistï¼Œä½†ä¹Ÿè¦æ³¨æ„èŠ‚çœå†…å­˜å’Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡)</p><p>åä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set user:<span class="number">1</span>:name tom</span><br><span class="line">set user:<span class="number">1</span>:age <span class="number">19</span></span><br><span class="line">set user:<span class="number">1</span>:favor football</span><br></pre></td></tr></table></figure><p>æ­£ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hmset user:<span class="number">1</span> name tom age <span class="number">19</span> favor football</span><br></pre></td></tr></table></figure><h4 id="æ§åˆ¶keyçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æ§åˆ¶keyçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ§åˆ¶keyçš„ç”Ÿå‘½å‘¨æœŸ"></a>æ§åˆ¶keyçš„ç”Ÿå‘½å‘¨æœŸ</h4><p>redisä¸æ˜¯åƒåœ¾æ¡¶ï¼Œå»ºè®®ä½¿ç”¨expireè®¾ç½®è¿‡æœŸæ—¶é—´(æ¡ä»¶å…è®¸å¯ä»¥æ‰“æ•£è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é›†ä¸­è¿‡æœŸ)ï¼Œä¸è¿‡æœŸçš„æ•°æ®é‡ç‚¹å…³æ³¨idletimeã€‚</p><h2 id="å‘½ä»¤ä½¿ç”¨"><a href="#å‘½ä»¤ä½¿ç”¨" class="headerlink" title="å‘½ä»¤ä½¿ç”¨"></a>å‘½ä»¤ä½¿ç”¨</h2><h3 id="O-N-å‘½ä»¤å…³æ³¨Nçš„æ•°é‡"><a href="#O-N-å‘½ä»¤å…³æ³¨Nçš„æ•°é‡" class="headerlink" title="O(N)å‘½ä»¤å…³æ³¨Nçš„æ•°é‡"></a>O(N)å‘½ä»¤å…³æ³¨Nçš„æ•°é‡</h3><p>ä¾‹å¦‚hgetallã€lrangeã€smembersã€zrangeã€sinterç­‰å¹¶éä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦æ˜ç¡®Nçš„å€¼ã€‚æœ‰éå†çš„éœ€æ±‚å¯ä»¥ä½¿ç”¨hscanã€sscanã€zscanä»£æ›¿ã€‚</p><h3 id="ç¦ç”¨å‘½ä»¤"><a href="#ç¦ç”¨å‘½ä»¤" class="headerlink" title="ç¦ç”¨å‘½ä»¤"></a>ç¦ç”¨å‘½ä»¤</h3><p>ç¦æ­¢çº¿ä¸Šä½¿ç”¨keysã€flushallã€flushdbç­‰ï¼Œé€šè¿‡redisçš„renameæœºåˆ¶ç¦æ‰å‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨scançš„æ–¹å¼æ¸è¿›å¼å¤„ç†ã€‚</p><h3 id="åˆç†ä½¿ç”¨select"><a href="#åˆç†ä½¿ç”¨select" class="headerlink" title="åˆç†ä½¿ç”¨select*"></a>åˆç†ä½¿ç”¨select*</h3><p>redisçš„å¤šæ•°æ®åº“è¾ƒå¼±ï¼Œä½¿ç”¨æ•°å­—è¿›è¡ŒåŒºåˆ†ï¼Œå¾ˆå¤šå®¢æˆ·ç«¯æ”¯æŒè¾ƒå·®ï¼ŒåŒæ—¶å¤šä¸šåŠ¡ç”¨å¤šæ•°æ®åº“å®é™…è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œä¼šæœ‰å¹²æ‰°ã€‚</p><h3 id="ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡"><a href="#ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡" class="headerlink" title="ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡"></a>ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡</h3><ul><li>åŸç”Ÿå‘½ä»¤ï¼šä¾‹å¦‚mgetã€msetã€‚</li><li>éåŸç”Ÿå‘½ä»¤ï¼šå¯ä»¥ä½¿ç”¨pipelineæé«˜æ•ˆç‡ã€‚</li></ul><p>ä½†è¦æ³¨æ„æ§åˆ¶ä¸€æ¬¡æ‰¹é‡æ“ä½œçš„å…ƒç´ ä¸ªæ•°(ä¾‹å¦‚500ä»¥å†…ï¼Œå®é™…ä¹Ÿå’Œå…ƒç´ å­—èŠ‚æ•°æœ‰å…³)ã€‚</p><p>æ³¨æ„ä¸¤è€…ä¸åŒï¼š</p><ul><li>åŸç”Ÿæ˜¯åŸå­æ“ä½œï¼Œpipelineæ˜¯éåŸå­æ“ä½œã€‚</li><li>pipelineå¯ä»¥æ‰“åŒ…ä¸åŒçš„å‘½ä»¤ï¼ŒåŸç”Ÿåšä¸åˆ°</li><li>pipelineéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒã€‚</li></ul><h3 id="ä¸å»ºè®®è¿‡å¤šä½¿ç”¨Redisäº‹åŠ¡åŠŸèƒ½"><a href="#ä¸å»ºè®®è¿‡å¤šä½¿ç”¨Redisäº‹åŠ¡åŠŸèƒ½" class="headerlink" title="ä¸å»ºè®®è¿‡å¤šä½¿ç”¨Redisäº‹åŠ¡åŠŸèƒ½"></a>ä¸å»ºè®®è¿‡å¤šä½¿ç”¨Redisäº‹åŠ¡åŠŸèƒ½</h3><p>Redisçš„äº‹åŠ¡åŠŸèƒ½è¾ƒå¼±(ä¸æ”¯æŒå›æ»š)ï¼Œè€Œä¸”é›†ç¾¤ç‰ˆæœ¬(è‡ªç ”å’Œå®˜æ–¹)è¦æ±‚ä¸€æ¬¡äº‹åŠ¡æ“ä½œçš„keyå¿…é¡»åœ¨ä¸€ä¸ªslotä¸Š(å¯ä»¥ä½¿ç”¨hashtagåŠŸèƒ½è§£å†³)</p><h3 id="Redisé›†ç¾¤ç‰ˆæœ¬åœ¨ä½¿ç”¨Luaä¸Šæœ‰ç‰¹æ®Šè¦æ±‚"><a href="#Redisé›†ç¾¤ç‰ˆæœ¬åœ¨ä½¿ç”¨Luaä¸Šæœ‰ç‰¹æ®Šè¦æ±‚" class="headerlink" title="Redisé›†ç¾¤ç‰ˆæœ¬åœ¨ä½¿ç”¨Luaä¸Šæœ‰ç‰¹æ®Šè¦æ±‚"></a>Redisé›†ç¾¤ç‰ˆæœ¬åœ¨ä½¿ç”¨Luaä¸Šæœ‰ç‰¹æ®Šè¦æ±‚</h3><p>1ã€æ‰€æœ‰keyéƒ½åº”è¯¥ç”± KEYS æ•°ç»„æ¥ä¼ é€’ï¼Œredis.call/pcall é‡Œé¢è°ƒç”¨çš„rediså‘½ä»¤ï¼Œkeyçš„ä½ç½®ï¼Œå¿…é¡»æ˜¯KEYS array, å¦åˆ™ç›´æ¥è¿”å›errorï¼Œâ€-ERR bad lua script for redis cluster, all the keys that the script uses should be passed using the KEYS arrayrnâ€2ã€æ‰€æœ‰keyï¼Œå¿…é¡»åœ¨1ä¸ªslotä¸Šï¼Œå¦åˆ™ç›´æ¥è¿”å›error, â€œ-ERR eval/evalsha command keys must in same slotrnâ€</p><h3 id="monitorå‘½ä»¤"><a href="#monitorå‘½ä»¤" class="headerlink" title="monitorå‘½ä»¤"></a>monitorå‘½ä»¤</h3><p>å¿…è¦æƒ…å†µä¸‹ä½¿ç”¨monitorå‘½ä»¤æ—¶ï¼Œè¦æ³¨æ„ä¸è¦é•¿æ—¶é—´ä½¿ç”¨ã€‚</p><h2 id="å®¢æˆ·ç«¯ä½¿ç”¨"><a href="#å®¢æˆ·ç«¯ä½¿ç”¨" class="headerlink" title="å®¢æˆ·ç«¯ä½¿ç”¨"></a>å®¢æˆ·ç«¯ä½¿ç”¨</h2><h3 id="é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ªRediså®ä¾‹"><a href="#é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ªRediså®ä¾‹" class="headerlink" title="é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ªRediså®ä¾‹"></a>é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ªRediså®ä¾‹</h3><p>ä¸ç›¸å¹²çš„ä¸šåŠ¡æ‹†åˆ†ï¼Œå…¬å…±æ•°æ®åšæœåŠ¡åŒ–ã€‚</p><h3 id="ä½¿ç”¨è¿æ¥æ± "><a href="#ä½¿ç”¨è¿æ¥æ± " class="headerlink" title="ä½¿ç”¨è¿æ¥æ± "></a>ä½¿ç”¨è¿æ¥æ± </h3><p>å¯ä»¥æœ‰æ•ˆæ§åˆ¶è¿æ¥ï¼ŒåŒæ—¶æé«˜æ•ˆç‡ï¼Œæ ‡å‡†ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</span><br><span class="line">Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    jedis = jedisPool.getResource();</span><br><span class="line"> <span class="comment">//å…·ä½“çš„å‘½ä»¤</span></span><br><span class="line">    jedis.executeCommand()</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    logger.error(<span class="string">&quot;op key &#123;&#125; error: &quot;</span> + e.getMessage(), key, e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"> <span class="comment">//æ³¨æ„è¿™é‡Œä¸æ˜¯å…³é—­è¿æ¥ï¼Œåœ¨JedisPoolæ¨¡å¼ä¸‹ï¼ŒJedisä¼šè¢«å½’è¿˜ç»™èµ„æºæ± ã€‚</span></span><br><span class="line"> <span class="keyword">if</span> (jedis != <span class="keyword">null</span>)</span><br><span class="line">        jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç†”æ–­åŠŸèƒ½"><a href="#ç†”æ–­åŠŸèƒ½" class="headerlink" title="ç†”æ–­åŠŸèƒ½"></a>ç†”æ–­åŠŸèƒ½</h3><p>é«˜å¹¶å‘ä¸‹å»ºè®®å®¢æˆ·ç«¯æ·»åŠ ç†”æ–­åŠŸèƒ½(ä¾‹å¦‚netflix hystrix)</p><h3 id="åˆç†çš„åŠ å¯†"><a href="#åˆç†çš„åŠ å¯†" class="headerlink" title="åˆç†çš„åŠ å¯†"></a>åˆç†çš„åŠ å¯†</h3><p>è®¾ç½®åˆç†çš„å¯†ç ï¼Œå¦‚æœ‰å¿…è¦å¯ä»¥ä½¿ç”¨SSLåŠ å¯†è®¿é—®ï¼ˆé˜¿é‡Œäº‘Redisæ”¯æŒï¼‰</p><h3 id="æ·˜æ±°ç­–ç•¥"><a href="#æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ·˜æ±°ç­–ç•¥"></a>æ·˜æ±°ç­–ç•¥</h3><p>æ ¹æ®è‡ªèº«ä¸šåŠ¡ç±»å‹ï¼Œé€‰å¥½maxmemory-policy(æœ€å¤§å†…å­˜æ·˜æ±°ç­–ç•¥)ï¼Œè®¾ç½®å¥½è¿‡æœŸæ—¶é—´ã€‚é»˜è®¤ç­–ç•¥æ˜¯volatile-lruï¼Œå³è¶…è¿‡æœ€å¤§å†…å­˜åï¼Œåœ¨è¿‡æœŸé”®ä¸­ä½¿ç”¨lruç®—æ³•è¿›è¡Œkeyçš„å‰”é™¤ï¼Œä¿è¯ä¸è¿‡æœŸæ•°æ®ä¸è¢«åˆ é™¤ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°OOMé—®é¢˜ã€‚</p><p>å…¶ä»–ç­–ç•¥å¦‚ä¸‹ï¼š</p><ul><li>allkeys-lruï¼šæ ¹æ®LRUç®—æ³•åˆ é™¤é”®ï¼Œä¸ç®¡æ•°æ®æœ‰æ²¡æœ‰è®¾ç½®è¶…æ—¶å±æ€§ï¼Œç›´åˆ°è…¾å‡ºè¶³å¤Ÿç©ºé—´ä¸ºæ­¢ã€‚</li><li>allkeys-randomï¼šéšæœºåˆ é™¤æ‰€æœ‰é”®ï¼Œç›´åˆ°è…¾å‡ºè¶³å¤Ÿç©ºé—´ä¸ºæ­¢ã€‚</li><li>volatile-random:éšæœºåˆ é™¤è¿‡æœŸé”®ï¼Œç›´åˆ°è…¾å‡ºè¶³å¤Ÿç©ºé—´ä¸ºæ­¢ã€‚</li><li>volatile-ttlï¼šæ ¹æ®é”®å€¼å¯¹è±¡çš„ttlå±æ€§ï¼Œåˆ é™¤æœ€è¿‘å°†è¦è¿‡æœŸæ•°æ®ã€‚å¦‚æœæ²¡æœ‰ï¼Œå›é€€åˆ°noevictionç­–ç•¥ã€‚</li><li>noevictionï¼šä¸ä¼šå‰”é™¤ä»»ä½•æ•°æ®ï¼Œæ‹’ç»æ‰€æœ‰å†™å…¥æ“ä½œå¹¶è¿”å›å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯â€(error) OOM command not allowed when used memoryâ€ï¼Œæ­¤æ—¶Redisåªå“åº”è¯»æ“ä½œã€‚</li></ul><h2 id="ç›¸å…³å·¥å…·"><a href="#ç›¸å…³å·¥å…·" class="headerlink" title="ç›¸å…³å·¥å…·"></a>ç›¸å…³å·¥å…·</h2><h3 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h3><p>redisé—´æ•°æ®åŒæ­¥å¯ä»¥ä½¿ç”¨ï¼šredis-port</p><h3 id="big-keyæœç´¢"><a href="#big-keyæœç´¢" class="headerlink" title="big keyæœç´¢"></a>big keyæœç´¢</h3><p>rediså¤§keyæœç´¢å·¥å…·</p><h3 id="çƒ­ç‚¹keyå¯»æ‰¾"><a href="#çƒ­ç‚¹keyå¯»æ‰¾" class="headerlink" title="çƒ­ç‚¹keyå¯»æ‰¾"></a>çƒ­ç‚¹keyå¯»æ‰¾</h3><p>å†…éƒ¨å®ç°ä½¿ç”¨monitorï¼Œæ‰€ä»¥å»ºè®®çŸ­æ—¶é—´ä½¿ç”¨facebookçš„redis-faina é˜¿é‡Œäº‘Rediså·²ç»åœ¨å†…æ ¸å±‚é¢è§£å†³çƒ­ç‚¹keyé—®é¢˜</p><h2 id="åˆ é™¤bigkey"><a href="#åˆ é™¤bigkey" class="headerlink" title="åˆ é™¤bigkey"></a>åˆ é™¤bigkey</h2><ul><li>ä¸‹é¢æ“ä½œå¯ä»¥ä½¿ç”¨pipelineåŠ é€Ÿã€‚</li><li>redis 4.0å·²ç»æ”¯æŒkeyçš„å¼‚æ­¥åˆ é™¤ï¼Œæ¬¢è¿ä½¿ç”¨ã€‚</li></ul><h3 id="Hashåˆ é™¤-hscan-hdel"><a href="#Hashåˆ é™¤-hscan-hdel" class="headerlink" title="Hashåˆ é™¤: hscan + hdel"></a>Hashåˆ é™¤: hscan + hdel</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delBigHash</span><span class="params">(String host, <span class="keyword">int</span> port, String password, String bigHashKey)</span> </span>&#123;</span><br><span class="line"> Jedis jedis = <span class="keyword">new</span> Jedis(host, port);</span><br><span class="line"> <span class="keyword">if</span> (password != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(password)) &#123;</span><br><span class="line">        jedis.auth(password);</span><br><span class="line">    &#125;</span><br><span class="line"> ScanParams scanParams = <span class="keyword">new</span> ScanParams().count(<span class="number">100</span>);</span><br><span class="line"> String cursor = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"> <span class="keyword">do</span> &#123;</span><br><span class="line"> ScanResult&lt;Entry&lt;String, String&gt;&gt; scanResult = jedis.hscan(bigHashKey, cursor, scanParams);</span><br><span class="line"> List&lt;Entry&lt;String, String&gt;&gt; entryList = scanResult.getResult();</span><br><span class="line"> <span class="keyword">if</span> (entryList != <span class="keyword">null</span> &amp;&amp; !entryList.isEmpty()) &#123;</span><br><span class="line"> <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : entryList) &#123;</span><br><span class="line">                jedis.hdel(bigHashKey, entry.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cursor = scanResult.getStringCursor();</span><br><span class="line">    &#125; <span class="keyword">while</span> (!<span class="string">&quot;0&quot;</span>.equals(cursor));</span><br><span class="line"></span><br><span class="line"> <span class="comment">//åˆ é™¤bigkey</span></span><br><span class="line">    jedis.del(bigHashKey);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="Liståˆ é™¤-ltrim"><a href="#Liståˆ é™¤-ltrim" class="headerlink" title="Liståˆ é™¤: ltrim"></a>Liståˆ é™¤: ltrim</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delBigList</span><span class="params">(String host, <span class="keyword">int</span> port, String password, String bigListKey)</span> </span>&#123;</span><br><span class="line"> Jedis jedis = <span class="keyword">new</span> Jedis(host, port);</span><br><span class="line"> <span class="keyword">if</span> (password != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(password)) &#123;</span><br><span class="line">        jedis.auth(password);</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="keyword">long</span> llen = jedis.llen(bigListKey);</span><br><span class="line"> <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">int</span> left = <span class="number">100</span>;</span><br><span class="line"> <span class="keyword">while</span> (counter &lt; llen) &#123;</span><br><span class="line"> <span class="comment">//æ¯æ¬¡ä»å·¦ä¾§æˆªæ‰100ä¸ª</span></span><br><span class="line">        jedis.ltrim(bigListKey, left, llen);</span><br><span class="line">        counter += left;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//æœ€ç»ˆåˆ é™¤key</span></span><br><span class="line">    jedis.del(bigListKey);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="Setåˆ é™¤-sscan-srem"><a href="#Setåˆ é™¤-sscan-srem" class="headerlink" title="Setåˆ é™¤: sscan + srem"></a>Setåˆ é™¤: sscan + srem</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delBigSet</span><span class="params">(String host, <span class="keyword">int</span> port, String password, String bigSetKey)</span> </span>&#123;</span><br><span class="line"> Jedis jedis = <span class="keyword">new</span> Jedis(host, port);</span><br><span class="line"> <span class="keyword">if</span> (password != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(password)) &#123;</span><br><span class="line">        jedis.auth(password);</span><br><span class="line">    &#125;</span><br><span class="line"> ScanParams scanParams = <span class="keyword">new</span> ScanParams().count(<span class="number">100</span>);</span><br><span class="line"> String cursor = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"> <span class="keyword">do</span> &#123;</span><br><span class="line"> ScanResult&lt;String&gt; scanResult = jedis.sscan(bigSetKey, cursor, scanParams);</span><br><span class="line"> List&lt;String&gt; memberList = scanResult.getResult();</span><br><span class="line"> <span class="keyword">if</span> (memberList != <span class="keyword">null</span> &amp;&amp; !memberList.isEmpty()) &#123;</span><br><span class="line"> <span class="keyword">for</span> (String member : memberList) &#123;</span><br><span class="line">                jedis.srem(bigSetKey, member);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cursor = scanResult.getStringCursor();</span><br><span class="line">    &#125; <span class="keyword">while</span> (!<span class="string">&quot;0&quot;</span>.equals(cursor));</span><br><span class="line"></span><br><span class="line"> <span class="comment">//åˆ é™¤bigkey</span></span><br><span class="line">    jedis.del(bigSetKey);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="SortedSetåˆ é™¤-zscan-zrem"><a href="#SortedSetåˆ é™¤-zscan-zrem" class="headerlink" title="SortedSetåˆ é™¤: zscan + zrem"></a>SortedSetåˆ é™¤: zscan + zrem</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delBigZset</span><span class="params">(String host, <span class="keyword">int</span> port, String password, String bigZsetKey)</span> </span>&#123;</span><br><span class="line"> Jedis jedis = <span class="keyword">new</span> Jedis(host, port);</span><br><span class="line"> <span class="keyword">if</span> (password != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(password)) &#123;</span><br><span class="line">        jedis.auth(password);</span><br><span class="line">    &#125;</span><br><span class="line"> ScanParams scanParams = <span class="keyword">new</span> ScanParams().count(<span class="number">100</span>);</span><br><span class="line"> String cursor = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"> <span class="keyword">do</span> &#123;</span><br><span class="line"> ScanResult&lt;Tuple&gt; scanResult = jedis.zscan(bigZsetKey, cursor, scanParams);</span><br><span class="line"> List&lt;Tuple&gt; tupleList = scanResult.getResult();</span><br><span class="line"> <span class="keyword">if</span> (tupleList != <span class="keyword">null</span> &amp;&amp; !tupleList.isEmpty()) &#123;</span><br><span class="line"> <span class="keyword">for</span> (Tuple tuple : tupleList) &#123;</span><br><span class="line">                jedis.zrem(bigZsetKey, tuple.getElement());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cursor = scanResult.getStringCursor();</span><br><span class="line">    &#125; <span class="keyword">while</span> (!<span class="string">&quot;0&quot;</span>.equals(cursor));</span><br><span class="line"></span><br><span class="line"> <span class="comment">//åˆ é™¤bigkey</span></span><br><span class="line">    jedis.del(bigZsetKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŸä½œè€…ï¼šä»˜ç£Š-èµ·æ‰¬<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://link.zhihu.com/?target=https%3A//yq.aliyun.com/articles/531067">é˜¿é‡Œäº‘Rediså¼€å‘è§„èŒƒ-äº‘æ –ç¤¾åŒº-é˜¿é‡Œäº‘</a><br>åŸå‡ºå¤„ï¼šé˜¿é‡Œäº‘</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡</title>
      <link href="/2017/01/05/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
      <url>/2017/01/05/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="å¾®æœåŠ¡-microservice"><a href="#å¾®æœåŠ¡-microservice" class="headerlink" title="å¾®æœåŠ¡ - microservice"></a>å¾®æœåŠ¡ - microservice</h2><p>ã€€ã€€<strong>å¾®æœåŠ¡æ˜¯æŒ‡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡</strong>ã€‚æ— ç‹¬ç«‹è¿›ç¨‹ï¼Œé‡‡ç”¨è½»é‡çº§çš„é€šä¿¡åè®®ï¼Œç‹¬ç«‹éƒ¨ç½²ä¸”æ— é›†ä¸­å¼ç®¡ç†ã€‚</p><p>â€‹    æŠ€æœ¯è§’åº¦ä¸Šçœ‹ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªä¼ ç»Ÿçš„å¤æ‚è½¯ä»¶æ¶æ„æ‹†åˆ†ä¸ºè‹¥å¹²å°è€Œç‹¬ç«‹è¿è¡Œï¼ˆæœ‰è‡ªå·±çš„ç«¯å£ï¼‰å¾®æœåŠ¡ç»„æˆï¼Œè¿™äº›ç‹¬ç«‹å¤„ç†ç»„ä»¶ä¹‹é—´é€šè®¯æ˜¯é€šè¿‡ä¸è¯­è¨€æ— å…³çš„APIè¿›è¡Œã€‚è¿™ç§åšæ³•å¯ä»¥å°†å…·ä½“ä¸šåŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œæä¾›å……åˆ†çš„çµæ´»æ€§ï¼Œå¤§å¤§æé«˜äº†é¡¹ç›®ç”Ÿå‘½å‘¨æœŸå’Œå¼€å‘æ•ˆç‡ã€‚<br><a id="more"></a></p><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><p>ã€€ã€€æ¯ä¸ªå¾®æœåŠ¡ç»„ä»¶éƒ½æœ‰è‡ªå·±åˆ†é…çš„å­˜å‚¨ å†…å­˜å’ŒCPUèµ„æºï¼Œè¿™å°±ä½¿å¾—ç¡¬ä»¶åˆ©ç”¨æ›´åŠ æ˜“äºä¼˜åŒ–å’Œè·Ÿè¸ªå¼€ï¼Œåªè¦éµå¾ªå¾®æœåŠ¡ä¹‹é—´çš„APIè§„èŒƒï¼Œå¾®æœåŠ¡ç»„ä»¶å°±å¯ä»¥ç»„æˆä¸€ä¸ªå®Œæ•´çš„æœåŠ¡ã€‚è¿™ä¸ªæœåŠ¡çš„å¤æ‚æ€§å’Œæ‰©å±•æ€§æ˜¯è‰¯å¥½çš„ï¼Œæ›´æ–°å…¶ä¸­ä¸€ä¸ªå¾®æœåŠ¡ç»„ä»¶ä¸ä¼šå¼•èµ·è¿é”ååº”ï¼Œå› ä¸ºå¾®æœåŠ¡ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ã€‚ </p><p>ã€€ã€€</p><h2 id="å®¹å™¨æŠ€æœ¯ä¸å¾®æœåŠ¡"><a href="#å®¹å™¨æŠ€æœ¯ä¸å¾®æœåŠ¡" class="headerlink" title="å®¹å™¨æŠ€æœ¯ä¸å¾®æœåŠ¡"></a>å®¹å™¨æŠ€æœ¯ä¸å¾®æœåŠ¡</h2><p>â€‹    å› ä¸ºæœ‰å¾ˆå¤šåº”ç”¨å’ŒæœåŠ¡éƒ¨ç½²åœ¨åŸºäºäº‘ä¸»æœºçš„ç¯å¢ƒä¸­ï¼Œå¾®æœåŠ¡æ¶æ„å°†ä¼šä¸¥é‡ä¾èµ–å®¹å™¨æŠ€æœ¯ï¼Œå®¹å™¨éš”ç¦»äº†å¾®æœåŠ¡å¤„ç†è¿‡ç¨‹ï¼Œå°†ä¸€ä¸ªåº”ç”¨åˆ‡åˆ†ä¸ºä¸€ä¸ªä¸ªå°çš„å®ä¾‹ï¼Œè¿™äº›å®¹å™¨ä¸­çš„å°å®ä¾‹æœ‰è‡ªå·±çš„ç«¯å£å’Œè™šæ‹ŸåŒ–ç¯å¢ƒã€‚å¹¿æ³›ä½¿ç”¨çš„å®¹å™¨æŠ€æœ¯æ˜¯Dockerã€‚</p><p>ã€€ã€€å¾®æœåŠ¡æ¶æ„ä¸åªæ˜¯ä¼ ç»ŸæœåŠ¡å˜å¾®å˜å°ã€‚å¾®æœåŠ¡ä¸¤ä¸ªæ˜¾è‘—ç‰¹ç‚¹æ˜¯ï¼šå¾®æœåŠ¡æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼›å¾®æœåŠ¡ä¹‹é—´å¾ˆå°‘å¯å˜å…±äº«ã€‚å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå¾®æœåŠ¡ä¹‹é—´å¯ä»¥å…±äº«ï¼Œé‚£ä¹ˆå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼šå¾®æœåŠ¡å›¢é˜Ÿä¹‹é—´éœ€è¦åˆä½œï¼Œå› ä¸ºå…±äº«çš„æ˜¯ä¸€ä¸ªç»Ÿä¸€æ•°æ®åº“ï¼Œå¦‚æœè¿™ç§å…±äº«æ²¡æœ‰å¸¦æ¥æ²Ÿé€šæˆæœ¬ï¼Œæ²¡æœ‰ç ´åä¸€ä¸ªå›¢é˜Ÿå°±èƒ½æå®šçš„å®—æ—¨ï¼Œé‚£ä¹ˆè¿™ç§å…±äº«æ•°æ®åº“ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†å›¢é˜Ÿå› ä¸ºå…±äº«é—®é¢˜ç ´åäº†ç‹¬ç«‹æ€§ï¼›å†è€…ï¼Œå¾®æœåŠ¡å¦‚æœä½¿ç”¨Dockeråˆ†åˆ«æ‰“åŒ…åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œè¿™äº›å®¹å™¨å¯èƒ½æ˜¯è·¨ä¸åŒåŸºç¡€è®¾æ–½éƒ¨ç½²ï¼Œéƒ¨ç½²æ–¹å¼å¾ˆçµæ´»ï¼Œæ˜¯ä¸€ç§cloud nativeåº”ç”¨ï¼Œè€Œå…±äº«æ•°æ®åº“å±äºåº•å±‚åŸºç¡€è®¾æ–½ï¼Œæ˜¾ç„¶æé«˜äº†éƒ¨ç½²éš¾ç‚¹ã€‚</p><p>ã€€ã€€å¦å¤–ï¼Œä¼ ç»ŸæœåŠ¡ä¹‹é—´é€šè®¯æ— è®ºæ˜¯RPC/RMIæˆ–æ˜¯Http/RESTfuléƒ½æ˜¯åŒæ­¥çš„ï¼Œè€Œå¾®æœåŠ¡ä¹‹é—´é€šä¿¡æœ€å¥½æ˜¯å¼‚æ­¥çš„æˆ–reactiveçš„ï¼Œä¹Ÿå°±æ˜¯éåŒæ­¥çš„ã€‚æ ¹æ®<a href="http://www.jdon.com/47927">FLPä¸å¯èƒ½åŸç†</a>ç½‘ç»œé»˜è®¤æ˜¯ä¸å¯é çš„ï¼ŒRPCåœ¨ä¸€æ—¦å‘ç”Ÿç½‘ç»œå µå¡ä¼šè¿ç¯çˆ†ç‚¸ï¼Œäº‹åç›‘æ§å¹¶ä¸èƒ½æ ¹æœ¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å‚è€ƒ<a href="http://www.jdon.com/37625">CAPå®šç†</a>è¿›è¡Œå¹³è¡¡è®¾è®¡ï¼Œå¼•å…¥äº‹ä»¶é©±åŠ¨æˆ–Pub/Subæ¶ˆæ¯æ–¹å¼èƒ½åœ¨æé«˜ç½‘ç»œå®¹é”™æ€§çš„åŒæ—¶ï¼Œä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ï¼ŒæŸ”æ€§äº‹åŠ¡æ˜¯å¾®æœåŠ¡ç¯å¢ƒçš„ä¸»è¦é€‰æ‹©ã€‚</p><p>ã€€ã€€ä¼ ç»ŸæœåŠ¡å˜æˆé“æ¿ä¸€å—ç»å¸¸æ˜¯å› ä¸ºäº‹åŠ¡å¤„ç†è¦æ±‚ï¼ŒæŸä¸ªæœåŠ¡æ–¹æ³•çš„ä»£ç å¾ˆå¤šï¼Œéœ€è¦å¡åœ¨åŒä¸€ä¸ªäº‹åŠ¡è¾¹ç•Œå†…ï¼Œè™½ç„¶è¿™å¸¦æ¥äº†é«˜ä¸€è‡´æ€§çš„ï¼Œä½†æ˜¯æ‰©å±•æ€§æ¯”è¾ƒå·®ï¼Œå› ä¸ºåŒä¸€ä¸ªäº‹åŠ¡è¾¹ç•Œå†…çš„åŠ¨ä½œæ— æ³•åˆ†ç¦»åˆ°å‡ ä¸ªå¾®æœåŠ¡ä¸­ï¼Œå› æ­¤ï¼Œä½¿ç”¨å¾®æœåŠ¡å¿…é¡»ç§¯ææ‹¥æŠ±æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿä»¥åŠCAPå®šç†æœ‰ä¸€å®šç†è§£ã€‚å½“ç„¶ï¼Œè¿™äº›éƒ½æ˜¯å¿…é¡»æœ‰å¤šä¸ªå¾®æœåŠ¡è°ƒç”¨çš„æƒ…å†µä¸‹æ‰éœ€è¦è€ƒè™‘ï¼Œç”±äºå¾®æœåŠ¡ç²’åº¦å°ä¸”ä¸“ä¸€ï¼Œå¯ä»¥é€šè¿‡ç»„åˆæ›¿ä»£å…±äº«ç»§æ‰¿çš„æ€è·¯ï¼Œå®¹å¿ä»£ç æœ‰ä¸€å®šçš„é‡å¤æ€§ã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç³»ç»Ÿè®¾è®¡ </tag>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£JavaScriptå¼‚æ­¥ç¼–ç¨‹</title>
      <link href="/2017/01/04/javascript/JavaScript%E4%B9%8B%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
      <url>/2017/01/04/javascript/JavaScript%E4%B9%8B%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-å•çº¿ç¨‹"><a href="#ä¸€-å•çº¿ç¨‹" class="headerlink" title="ä¸€. å•çº¿ç¨‹"></a>ä¸€. å•çº¿ç¨‹</h2><p>æˆ‘ä»¬å¸¸è¯´â€œJavaScriptæ˜¯å•çº¿ç¨‹çš„â€ã€‚</p><p>æ‰€è°“å•çº¿ç¨‹ï¼Œæ˜¯æŒ‡åœ¨JSå¼•æ“ä¸­è´Ÿè´£è§£é‡Šå’Œæ‰§è¡ŒJavaScriptä»£ç çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªã€‚ä¸å¦¨å«å®ƒ<strong>ä¸»çº¿ç¨‹</strong>ã€‚</p><p>ä½†æ˜¯å®é™…ä¸Šè¿˜å­˜åœ¨å…¶ä»–çš„çº¿ç¨‹ã€‚ä¾‹å¦‚ï¼šå¤„ç†AJAXè¯·æ±‚çš„çº¿ç¨‹ã€å¤„ç†DOMäº‹ä»¶çš„çº¿ç¨‹ã€å®šæ—¶å™¨çº¿ç¨‹ã€è¯»å†™æ–‡ä»¶çš„çº¿ç¨‹(ä¾‹å¦‚åœ¨Node.jsä¸­)ç­‰ç­‰ã€‚è¿™äº›çº¿ç¨‹å¯èƒ½å­˜åœ¨äºJSå¼•æ“ä¹‹å†…ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨äºJSå¼•æ“ä¹‹å¤–ï¼Œåœ¨æ­¤æˆ‘ä»¬ä¸åšåŒºåˆ†ã€‚ä¸å¦¨å«å®ƒä»¬<strong>å·¥ä½œçº¿ç¨‹</strong>ã€‚</p><a id="more"></a><h2 id="äºŒ-åŒæ­¥å’Œå¼‚æ­¥"><a href="#äºŒ-åŒæ­¥å’Œå¼‚æ­¥" class="headerlink" title="äºŒ. åŒæ­¥å’Œå¼‚æ­¥"></a>äºŒ. åŒæ­¥å’Œå¼‚æ­¥</h2><p>å‡è®¾å­˜åœ¨ä¸€ä¸ªå‡½æ•°Aï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">A</span>(<span class="params">args...</span>)</span>;</span><br></pre></td></tr></table></figure><p><strong>åŒæ­¥</strong>ï¼šå¦‚æœåœ¨å‡½æ•°Aè¿”å›çš„æ—¶å€™ï¼Œè°ƒç”¨è€…å°±èƒ½å¤Ÿå¾—åˆ°é¢„æœŸç»“æœ(å³æ‹¿åˆ°äº†é¢„æœŸçš„è¿”å›å€¼æˆ–è€…çœ‹åˆ°äº†é¢„æœŸçš„æ•ˆæœ)ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯åŒæ­¥çš„ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Math.<span class="built_in">sqrt</span>(<span class="number">2</span>);</span><br><span class="line">console.<span class="built_in">log</span>(&#x27;Hi&#x27;);</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‡½æ•°è¿”å›æ—¶ï¼Œå°±æ‹¿åˆ°äº†é¢„æœŸçš„è¿”å›å€¼ï¼š2çš„å¹³æ–¹æ ¹ã€‚</li><li>ç¬¬äºŒä¸ªå‡½æ•°è¿”å›æ—¶ï¼Œå°±çœ‹åˆ°äº†é¢„æœŸçš„æ•ˆæœï¼šåœ¨æ§åˆ¶å°æ‰“å°äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li></ul><p>æ‰€ä»¥è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯åŒæ­¥çš„ã€‚</p><p><strong>å¼‚æ­¥</strong>ï¼šå¦‚æœåœ¨å‡½æ•°Aè¿”å›çš„æ—¶å€™ï¼Œè°ƒç”¨è€…è¿˜ä¸èƒ½å¤Ÿå¾—åˆ°é¢„æœŸç»“æœï¼Œè€Œæ˜¯éœ€è¦åœ¨å°†æ¥é€šè¿‡ä¸€å®šçš„æ‰‹æ®µå¾—åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯å¼‚æ­¥çš„ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.read<span class="constructor">File(&#x27;<span class="params">foo</span>.<span class="params">txt</span>&#x27;, &#x27;<span class="params">utf8</span>&#x27;, <span class="params">function</span>(<span class="params">err</span>, <span class="params">data</span>)</span> &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡<code>fs.readFile</code>å‡½æ•°è¯»å–æ–‡ä»¶foo.txtä¸­çš„å†…å®¹ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚<br>ä½†æ˜¯åœ¨<code>fs.readFile</code>å‡½æ•°è¿”å›æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœå¹¶ä¸ä¼šå‘ç”Ÿï¼Œè€Œæ˜¯è¦ç­‰åˆ°æ–‡ä»¶å…¨éƒ¨è¯»å–å®Œæˆä¹‹åã€‚å¦‚æœæ–‡ä»¶å¾ˆå¤§çš„è¯å¯èƒ½è¦å¾ˆé•¿æ—¶é—´ã€‚</p><p>ä¸‹é¢ä»¥AJAXè¯·æ±‚ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸€ä¸‹åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«ï¼š</p><ul><li>å¼‚æ­¥AJAXï¼š</li></ul><blockquote><ul><li><strong>ä¸»çº¿ç¨‹ï¼š</strong>â€œä½ å¥½ï¼ŒAJAXçº¿ç¨‹ã€‚è¯·ä½ å¸®æˆ‘å‘ä¸ªHTTPè¯·æ±‚å§ï¼Œæˆ‘æŠŠè¯·æ±‚åœ°å€å’Œå‚æ•°éƒ½ç»™ä½ äº†ã€‚â€</li><li><strong>AJAXçº¿ç¨‹ï¼š</strong>â€œå¥½çš„ï¼Œä¸»çº¿ç¨‹ã€‚æˆ‘é©¬ä¸Šå»å‘ï¼Œä½†å¯èƒ½è¦èŠ±ç‚¹å„¿æ—¶é—´å‘¢ï¼Œä½ å¯ä»¥å…ˆå»å¿™åˆ«çš„ã€‚â€</li><li><strong>ä¸»çº¿ç¨‹ï¼š</strong>ï¼šâ€œè°¢è°¢ï¼Œä½ æ‹¿åˆ°å“åº”åå‘Šè¯‰æˆ‘ä¸€å£°å•Šã€‚â€</li><li>(æ¥ç€ï¼Œä¸»çº¿ç¨‹åšå…¶ä»–äº‹æƒ…å»äº†ã€‚ä¸€é¡¿é¥­çš„æ—¶é—´åï¼Œå®ƒæ”¶åˆ°äº†å“åº”åˆ°è¾¾çš„é€šçŸ¥ã€‚)</li></ul></blockquote><ul><li>åŒæ­¥AJAXï¼š</li></ul><blockquote><ul><li><strong>ä¸»çº¿ç¨‹ï¼š</strong>â€œä½ å¥½ï¼ŒAJAXçº¿ç¨‹ã€‚è¯·ä½ å¸®æˆ‘å‘ä¸ªHTTPè¯·æ±‚å§ï¼Œæˆ‘æŠŠè¯·æ±‚åœ°å€å’Œå‚æ•°éƒ½ç»™ä½ äº†ã€‚â€</li><li><strong>AJAXçº¿ç¨‹ï¼š</strong>â€œâ€¦â€¦â€</li><li><strong>ä¸»çº¿ç¨‹ï¼š</strong>ï¼šâ€œå–‚ï¼ŒAJAXçº¿ç¨‹ï¼Œä½ æ€ä¹ˆä¸è¯´è¯ï¼Ÿâ€</li><li><strong>AJAXçº¿ç¨‹ï¼š</strong>â€œâ€¦â€¦â€</li><li><strong>ä¸»çº¿ç¨‹ï¼š</strong>ï¼šâ€œå–‚ï¼å–‚å–‚å–‚ï¼â€</li><li><strong>AJAXçº¿ç¨‹ï¼š</strong>â€œâ€¦â€¦â€</li><li>(ä¸€ç‚·é¦™çš„æ—¶é—´å)</li><li><strong>ä¸»çº¿ç¨‹ï¼š</strong>ï¼šâ€œå–‚ï¼æ±‚ä½ è¯´å¥è¯å§ï¼â€</li><li><strong>AJAXçº¿ç¨‹ï¼š</strong>â€œä¸»çº¿ç¨‹ï¼Œä¸å¥½æ„æ€ï¼Œæˆ‘åœ¨å·¥ä½œçš„æ—¶å€™ä¸èƒ½è¯´è¯ã€‚ä½ çš„è¯·æ±‚å·²ç»å‘å®Œäº†ï¼Œæ‹¿åˆ°å“åº”æ•°æ®äº†ï¼Œç»™ä½ ã€‚â€</li></ul></blockquote><p>æ­£æ˜¯ç”±äºJavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œè€Œå¼‚æ­¥å®¹æ˜“å®ç°éé˜»å¡ï¼Œæ‰€ä»¥åœ¨JavaScriptä¸­å¯¹äºè€—æ—¶çš„æ“ä½œæˆ–è€…æ—¶é—´ä¸ç¡®å®šçš„æ“ä½œï¼Œä½¿ç”¨å¼‚æ­¥å°±æˆäº†å¿…ç„¶çš„é€‰æ‹©ã€‚å¼‚æ­¥æ˜¯è¿™ç¯‡æ–‡ç« å…³æ³¨çš„é‡ç‚¹ã€‚</p><h2 id="ä¸‰-å¼‚æ­¥è¿‡ç¨‹çš„æ„æˆè¦ç´ "><a href="#ä¸‰-å¼‚æ­¥è¿‡ç¨‹çš„æ„æˆè¦ç´ " class="headerlink" title="ä¸‰. å¼‚æ­¥è¿‡ç¨‹çš„æ„æˆè¦ç´ "></a>ä¸‰. å¼‚æ­¥è¿‡ç¨‹çš„æ„æˆè¦ç´ </h2><p>ä»ä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼Œ<code>å¼‚æ­¥å‡½æ•°</code>å®é™…ä¸Šå¾ˆå¿«å°±è°ƒç”¨å®Œæˆäº†ã€‚ä½†æ˜¯åé¢è¿˜æœ‰å·¥ä½œçº¿ç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€é€šçŸ¥ä¸»çº¿ç¨‹ã€ä¸»çº¿ç¨‹è°ƒç”¨å›è°ƒå‡½æ•°ç­‰å¾ˆå¤šæ­¥éª¤ã€‚æˆ‘ä»¬æŠŠæ•´ä¸ªè¿‡ç¨‹å«åš<code>å¼‚æ­¥è¿‡ç¨‹</code>ã€‚å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨åœ¨æ•´ä¸ªå¼‚æ­¥è¿‡ç¨‹ä¸­ï¼Œåªæ˜¯ä¸€å°éƒ¨åˆ†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>ä¸»çº¿ç¨‹å‘èµ·ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œç›¸åº”çš„å·¥ä½œçº¿ç¨‹æ¥æ”¶è¯·æ±‚å¹¶å‘ŠçŸ¥ä¸»çº¿ç¨‹å·²æ”¶åˆ°(å¼‚æ­¥å‡½æ•°è¿”å›)ï¼›ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼ŒåŒæ—¶å·¥ä½œçº¿ç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼›å·¥ä½œçº¿ç¨‹å®Œæˆå·¥ä½œåï¼Œé€šçŸ¥ä¸»çº¿ç¨‹ï¼›ä¸»çº¿ç¨‹æ”¶åˆ°é€šçŸ¥åï¼Œæ‰§è¡Œä¸€å®šçš„åŠ¨ä½œ(è°ƒç”¨å›è°ƒå‡½æ•°)ã€‚</p></blockquote><p>å¼‚æ­¥å‡½æ•°é€šå¸¸å…·æœ‰ä»¥ä¸‹çš„å½¢å¼ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">A</span>(<span class="params">args..., callbackFn</span>)</span></span><br></pre></td></tr></table></figure><p>å®ƒå¯ä»¥å«åšå¼‚æ­¥è¿‡ç¨‹çš„å‘èµ·å‡½æ•°ï¼Œæˆ–è€…å«åšå¼‚æ­¥ä»»åŠ¡æ³¨å†Œå‡½æ•°ã€‚<code>args</code>æ˜¯è¿™ä¸ªå‡½æ•°éœ€è¦çš„å‚æ•°ã€‚<code>callbackFn</code>ä¹Ÿæ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä½†æ˜¯å®ƒæ¯”è¾ƒç‰¹æ®Šæ‰€ä»¥å•ç‹¬åˆ—å‡ºæ¥ã€‚</p><p>æ‰€ä»¥ï¼Œä»ä¸»çº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹åŒ…æ‹¬ä¸‹é¢ä¸¤ä¸ªè¦ç´ ï¼š</p><ul><li>å‘èµ·å‡½æ•°(æˆ–å«æ³¨å†Œå‡½æ•°)<code>A</code></li><li>å›è°ƒå‡½æ•°<code>callbackFn</code></li></ul><p>å®ƒä»¬éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨çš„ï¼Œå…¶ä¸­æ³¨å†Œå‡½æ•°ç”¨æ¥å‘èµ·å¼‚æ­¥è¿‡ç¨‹ï¼Œå›è°ƒå‡½æ•°ç”¨æ¥å¤„ç†ç»“æœã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="name">fn</span>, <span class="number">1000</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>setTimeout</code>å°±æ˜¯å¼‚æ­¥è¿‡ç¨‹çš„å‘èµ·å‡½æ•°ï¼Œ<code>fn</code>æ˜¯å›è°ƒå‡½æ•°ã€‚</p><p>æ³¨æ„ï¼šå‰é¢è¯´çš„å½¢å¼<code>A(args..., callbackFn)</code>åªæ˜¯ä¸€ç§æŠ½è±¡çš„è¡¨ç¤ºï¼Œå¹¶ä¸ä»£è¡¨å›è°ƒå‡½æ•°ä¸€å®šè¦ä½œä¸ºå‘èµ·å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="type">XMLHttpRequest</span>();</span><br><span class="line">xhr.onreadystatechange = xxx; <span class="comment">// æ·»åŠ å›è°ƒå‡½æ•°</span></span><br><span class="line">xhr.open(<span class="string">&#x27;GET&#x27;</span>, url);</span><br><span class="line">xhr.send(); <span class="comment">// å‘èµ·å‡½æ•°</span></span><br></pre></td></tr></table></figure><p>å‘èµ·å‡½æ•°å’Œå›è°ƒå‡½æ•°å°±æ˜¯åˆ†ç¦»çš„ã€‚</p><h2 id="å››-æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯"><a href="#å››-æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯" class="headerlink" title="å››. æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯"></a>å››. æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯</h2><p>ä¸Šæ–‡è®²åˆ°ï¼Œå¼‚æ­¥è¿‡ç¨‹ä¸­ï¼Œå·¥ä½œçº¿ç¨‹åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåéœ€è¦é€šçŸ¥ä¸»çº¿ç¨‹ã€‚é‚£ä¹ˆè¿™ä¸ª<strong>é€šçŸ¥æœºåˆ¶</strong>æ˜¯æ€æ ·å®ç°çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯ã€‚</p><p>ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼š</p><blockquote><p>å·¥ä½œçº¿ç¨‹å°†æ¶ˆæ¯æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸»çº¿ç¨‹é€šè¿‡äº‹ä»¶å¾ªç¯è¿‡ç¨‹å»å–æ¶ˆæ¯ã€‚</p></blockquote><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå®ƒé‡Œé¢å­˜æ”¾ç€å„ç§æ¶ˆæ¯ã€‚</li><li><strong>äº‹ä»¶å¾ªç¯</strong>ï¼šäº‹ä»¶å¾ªç¯æ˜¯æŒ‡ä¸»çº¿ç¨‹é‡å¤ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ã€æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</li></ul><p>å®é™…ä¸Šï¼Œä¸»çº¿ç¨‹åªä¼šåšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢å–æ¶ˆæ¯ã€æ‰§è¡Œæ¶ˆæ¯ï¼Œå†å–æ¶ˆæ¯ã€å†æ‰§è¡Œã€‚å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå°±ä¼šç­‰å¾…ç›´åˆ°æ¶ˆæ¯é˜Ÿåˆ—å˜æˆéç©ºã€‚è€Œä¸”ä¸»çº¿ç¨‹åªæœ‰åœ¨å°†å½“å‰çš„æ¶ˆæ¯æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šå»å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯ã€‚è¿™ç§æœºåˆ¶å°±å«åšäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œå–ä¸€ä¸ªæ¶ˆæ¯å¹¶æ‰§è¡Œçš„è¿‡ç¨‹å«åšä¸€æ¬¡å¾ªç¯ã€‚</p><p>äº‹ä»¶å¾ªç¯ç”¨ä»£ç è¡¨ç¤ºå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    var message = <span class="built_in">queue</span>.<span class="built_in">get</span>();</span><br><span class="line">    execute(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ”¾çš„<strong>æ¶ˆæ¯</strong>å…·ä½“æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿæ¶ˆæ¯çš„å…·ä½“ç»“æ„å½“ç„¶è·Ÿå…·ä½“çš„å®ç°æœ‰å…³ï¼Œä½†æ˜¯ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼š</p><blockquote><p>æ¶ˆæ¯å°±æ˜¯æ³¨å†Œå¼‚æ­¥ä»»åŠ¡æ—¶æ·»åŠ çš„å›è°ƒå‡½æ•°ã€‚</p></blockquote><p>å†æ¬¡ä»¥å¼‚æ­¥AJAXä¸ºä¾‹ï¼Œå‡è®¾å­˜åœ¨å¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(<span class="string">&#x27;http://segmentfault.com&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;æˆ‘æ˜¯å“åº”ï¼š&#x27;</span>, resp);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–ä»£ç </span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸»çº¿ç¨‹åœ¨å‘èµ·AJAXè¯·æ±‚åï¼Œä¼šç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ã€‚AJAXçº¿ç¨‹è´Ÿè´£è¯·æ±‚segmentfault.comï¼Œæ‹¿åˆ°å“åº”åï¼Œå®ƒä¼šæŠŠå“åº”å°è£…æˆä¸€ä¸ªJavaScriptå¯¹è±¡ï¼Œç„¶åæ„é€ ä¸€æ¡æ¶ˆæ¯ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±é•¿è¿™ä¸ªæ ·å­</span></span><br><span class="line"><span class="keyword">var</span> message = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    callbackFn(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>callbackFn</code>å°±æ˜¯å‰é¢ä»£ç ä¸­å¾—åˆ°æˆåŠŸå“åº”æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p><p>ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œå®Œå½“å‰å¾ªç¯ä¸­çš„æ‰€æœ‰ä»£ç åï¼Œå°±ä¼šåˆ°æ¶ˆæ¯é˜Ÿåˆ—å–å‡ºè¿™æ¡æ¶ˆæ¯(ä¹Ÿå°±æ˜¯<code>message</code>å‡½æ•°)ï¼Œå¹¶æ‰§è¡Œå®ƒã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œå°±å®Œæˆäº†å·¥ä½œçº¿ç¨‹å¯¹ä¸»çº¿ç¨‹çš„<code>é€šçŸ¥</code>ï¼Œå›è°ƒå‡½æ•°ä¹Ÿå°±å¾—åˆ°äº†æ‰§è¡Œã€‚å¦‚æœä¸€å¼€å§‹ä¸»çº¿ç¨‹å°±æ²¡æœ‰æä¾›å›è°ƒå‡½æ•°ï¼ŒAJAXçº¿ç¨‹åœ¨æ”¶åˆ°HTTPå“åº”åï¼Œä¹Ÿå°±æ²¡å¿…è¦é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œä»è€Œä¹Ÿæ²¡å¿…è¦å¾€æ¶ˆæ¯é˜Ÿåˆ—æ”¾æ¶ˆæ¯ã€‚</p><p>ç”¨å›¾è¡¨ç¤ºè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼š</p><p><img src= "/img/loading2.gif" data-lazy-src="https://segmentfault.com/img/bVxLvF" alt="å›¾ç‰‡æè¿°"></p><p>ä»ä¸Šæ–‡ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°è¿™æ ·ä¸€ä¸ªæ˜æ˜¾çš„ç»“è®ºï¼Œå°±æ˜¯ï¼š</p><blockquote><p>å¼‚æ­¥è¿‡ç¨‹çš„å›è°ƒå‡½æ•°ï¼Œä¸€å®šä¸åœ¨å½“å‰è¿™ä¸€è½®äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œã€‚</p></blockquote><h2 id="äº”-å¼‚æ­¥ä¸äº‹ä»¶"><a href="#äº”-å¼‚æ­¥ä¸äº‹ä»¶" class="headerlink" title="äº”. å¼‚æ­¥ä¸äº‹ä»¶"></a>äº”. å¼‚æ­¥ä¸äº‹ä»¶</h2><p>ä¸Šæ–‡ä¸­è¯´çš„â€œäº‹ä»¶å¾ªç¯â€ï¼Œä¸ºä»€ä¹ˆé‡Œé¢æœ‰ä¸ª<code>äº‹ä»¶</code>å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºï¼š</p><blockquote><p>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¯æ¡æ¶ˆæ¯å®é™…ä¸Šéƒ½å¯¹åº”ç€ä¸€ä¸ªäº‹ä»¶ã€‚</p></blockquote><p>ä¸Šæ–‡ä¸­ä¸€ç›´æ²¡æœ‰æåˆ°ä¸€ç±»å¾ˆé‡è¦çš„å¼‚æ­¥è¿‡ç¨‹ï¼š<strong>DOMäº‹ä»¶</strong>ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> button = <span class="built_in">document</span>.getElement(<span class="string">&#x27;#btn&#x27;</span>);</span><br><span class="line">button.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä»äº‹ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œä¸Šè¿°ä»£ç è¡¨ç¤ºï¼šåœ¨æŒ‰é’®ä¸Šæ·»åŠ äº†ä¸€ä¸ªé¼ æ ‡å•å‡»äº‹ä»¶çš„äº‹ä»¶ç›‘å¬å™¨ï¼›å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œé¼ æ ‡å•å‡»äº‹ä»¶è§¦å‘ï¼Œäº‹ä»¶ç›‘å¬å™¨å‡½æ•°è¢«è°ƒç”¨ã€‚</p><p>ä»å¼‚æ­¥è¿‡ç¨‹çš„è§’åº¦çœ‹ï¼Œ<code>addEventListener</code>å‡½æ•°å°±æ˜¯å¼‚æ­¥è¿‡ç¨‹çš„å‘èµ·å‡½æ•°ï¼Œäº‹ä»¶ç›‘å¬å™¨å‡½æ•°å°±æ˜¯å¼‚æ­¥è¿‡ç¨‹çš„å›è°ƒå‡½æ•°ã€‚äº‹ä»¶è§¦å‘æ—¶ï¼Œè¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œä¼šå°†äº‹ä»¶ç›‘å¬å™¨å‡½æ•°å°è£…æˆä¸€æ¡æ¶ˆæ¯æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</p><p><strong>äº‹ä»¶</strong>çš„æ¦‚å¿µå®é™…ä¸Šå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œäº‹ä»¶æœºåˆ¶å®é™…ä¸Šå°±æ˜¯å¼‚æ­¥è¿‡ç¨‹çš„é€šçŸ¥æœºåˆ¶ã€‚æˆ‘è§‰å¾—å®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†ç¼–ç¨‹æ¥å£å¯¹å¼€å‘è€…æ›´å‹å¥½ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæ‰€æœ‰çš„å¼‚æ­¥è¿‡ç¨‹ä¹Ÿéƒ½å¯ä»¥ç”¨äº‹ä»¶æ¥æè¿°ã€‚ä¾‹å¦‚ï¼š<code>setTimeout</code>å¯ä»¥çœ‹æˆå¯¹åº”ä¸€ä¸ª<code>æ—¶é—´åˆ°äº†ï¼</code>çš„äº‹ä»¶ã€‚å‰æ–‡çš„<code>setTimeout(fn, 1000);</code>å¯ä»¥çœ‹æˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timer.addEventListener(<span class="string">&#x27;timeout&#x27;</span>, <span class="number">1000</span>, <span class="function"><span class="keyword">fn</span>)</span>;</span><br></pre></td></tr></table></figure><h2 id="å…­-ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…"><a href="#å…­-ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…" class="headerlink" title="å…­. ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…"></a>å…­. ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…</h2><p>ä»ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…çš„è§’åº¦çœ‹ï¼Œå¼‚æ­¥è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>å·¥ä½œçº¿ç¨‹æ˜¯ç”Ÿäº§è€…ï¼Œä¸»çº¿ç¨‹æ˜¯æ¶ˆè´¹è€…(åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…)ã€‚å·¥ä½œçº¿ç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œæ‰§è¡Œå®ŒæˆåæŠŠå¯¹åº”çš„å›è°ƒå‡½æ•°å°è£…æˆä¸€æ¡æ¶ˆæ¯æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼›ä¸»çº¿ç¨‹ä¸æ–­åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯å¹¶æ‰§è¡Œï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—ç©ºæ—¶ä¸»çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°æ¶ˆæ¯é˜Ÿåˆ—å†æ¬¡éç©ºã€‚</p></blockquote><h2 id="ä¸ƒ-æ€»ç»“ä¸€ä¸‹"><a href="#ä¸ƒ-æ€»ç»“ä¸€ä¸‹" class="headerlink" title="ä¸ƒ. æ€»ç»“ä¸€ä¸‹"></a>ä¸ƒ. æ€»ç»“ä¸€ä¸‹</h2><p>æœ€åå†ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­æ€»ç»“ä¸€ä¸‹åŒæ­¥å’Œå¼‚æ­¥ï¼šåœ¨å…¬è·¯ä¸Šï¼Œæ±½è½¦ä¸€è¾†æ¥ä¸€è¾†ï¼Œæœ‰æ¡ä¸ç´Šçš„è¿è¡Œã€‚è¿™æ—¶ï¼Œæœ‰ä¸€è¾†è½¦åæ‰äº†ã€‚å‡å¦‚å®ƒåœåœ¨åŸåœ°è¿›è¡Œä¿®ç†ï¼Œé‚£ä¹ˆåé¢çš„è½¦å°±ä¼šè¢«å µä½æ²¡æ³•è¡Œé©¶ï¼Œäº¤é€šå°±ä¹±å¥—äº†ã€‚å¹¸å¥½æ—è¾¹æœ‰åº”æ€¥è½¦é“ï¼Œå¯ä»¥æŠŠæ•…éšœè½¦è¾†æ¨åˆ°åº”æ€¥è½¦é“ä¿®ç†ï¼Œè€Œæ­£å¸¸çš„è½¦æµä¸ä¼šå—åˆ°ä»»ä½•å½±å“ã€‚ç­‰è½¦ä¿®å¥½äº†ï¼Œå†ä»åº”æ€¥è½¦é“å›åˆ°æ­£å¸¸è½¦é“å³å¯ã€‚å”¯ä¸€çš„å½±å“å°±æ˜¯ï¼Œåº”æ€¥è½¦é“ç”¨å¤šäº†ï¼ŒåŸæ¥çš„è½¦è¾†ä¹‹é—´çš„é¡ºåºä¼šæœ‰ç‚¹ä¹±ã€‚</p><p>è¿™å°±æ˜¯åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«ã€‚åŒæ­¥å¯ä»¥ä¿è¯é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®¹æ˜“å¯¼è‡´é˜»å¡ï¼›å¼‚æ­¥å¯ä»¥è§£å†³é˜»å¡é—®é¢˜ï¼Œä½†æ˜¯ä¼šæ”¹å˜é¡ºåºæ€§ã€‚æ”¹å˜é¡ºåºæ€§å…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œåªä¸è¿‡è®©ç¨‹åºå˜å¾—ç¨å¾®éš¾ç†è§£äº†ä¸€äº› :)</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web - ä»urlåˆ°é¡µé¢å‘ç”Ÿäº†ä»€ä¹ˆ</title>
      <link href="/2016/12/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8B%E4%BB%8Eurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/"/>
      <url>/2016/12/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8B%E4%BB%8Eurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<h2 id="è®¿é—®è¿‡ç¨‹"><a href="#è®¿é—®è¿‡ç¨‹" class="headerlink" title="è®¿é—®è¿‡ç¨‹"></a>è®¿é—®è¿‡ç¨‹</h2><p>æˆ‘ä»¬åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥google.comè¿™ä¸ªåœ°å€ï¼Œç„¶åæµè§ˆå™¨ç»è¿‡çŸ­æš‚åŠ è½½åç»™æˆ‘ä»¬å‘ˆç°äº†Googleçš„æœç´¢é¡µé¢ã€‚</p><p>è¿™ä¸­é—´çš„æ­¥éª¤æœ‰å“ªäº›å‘¢ï¼Ÿ</p><a id="more"></a><ol><li><p>é¦–å…ˆæ˜¯åŸŸåè§£æ google.com è½¬æ¢ä¸ºè¿™ä¸ªç½‘ç«™æœåŠ¡å™¨çš„IPï¼Œè¿™å…¶ä¸­æˆ–è®¸è¿˜åŒ…å«æœ‰CDNåŠ é€Ÿã€è´Ÿè½½å‡è¡¡ï¼Œåˆ†å¸ƒå¼æœåŠ¡ç­‰æŠ€æœ¯ã€‚</p></li><li><p>è·å–åˆ°æœåŠ¡å™¨IPä¹‹åï¼Œæˆ‘ä»¬çš„æµè§ˆå™¨ä¼šé€šè¿‡TCPä¸‰æ¬¡æ¡æ‰‹ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ã€‚</p><ul><li>å¦‚æœç½‘ç«™æ˜¯HTTPSï¼Œè¿˜ä¼šç»è¿‡TLS/SSLçš„æ¡æ‰‹æ­¥éª¤ä¸æœåŠ¡å™¨å»ºç«‹TLS/SSLè¿æ¥ã€‚</li></ul></li><li><p>å»ºç«‹TCPè¿æ¥ä¹‹åï¼Œæµè§ˆå™¨ä½œä¸ºå®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚(request)æŠ¥æ–‡åˆ°ç›®çš„IPåœ°å€å³WebæœåŠ¡å™¨IPã€‚</p></li><li><p>æœ‰çš„æ—¶å€™è·å–çš„IPæ˜¯åå‘ä»£ç†çš„æœåŠ¡å™¨IPï¼Œè¿™äº›æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚è½¬å‘ç»™çœŸå®æœåŠ¡å™¨IPã€‚</p></li><li><p>æ¥ä¸‹æ¥æ˜¯æœåŠ¡å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼š</p><ul><li>æœåŠ¡å™¨ä¸ŠGoogle.comæœåŠ¡è¿›ç¨‹ç›‘å¬æœåŠ¡ç«¯å£ï¼Œæ”¶åˆ°å®¢æˆ·ç«¯çš„HTTPè¯·æ±‚æŠ¥æ–‡ï¼Œè¿™ä¸ªæŠ¥æ–‡è¢«æœåŠ¡å™¨ä¸Šå®‰è£…çš„WebæœåŠ¡å™¨(Web Server)å¦‚apacheã€nginxã€LigHTTPdã€IISæ‰€ç›‘å¬åˆ°ã€‚</li><li>Web Serverè§£æHTTPè¯·æ±‚æŠ¥æ–‡ï¼Œæ ¹æ®è·¯ç”±é…ç½®å»è®¿é—®ç‰¹å®šä½ç½®çš„èµ„æºæˆ–å§”æ‰˜ç»™æœåŠ¡å™¨ä¸Šçš„å¤„ç†è¯·æ±‚çš„ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œå¦‚CGIè„šæœ¬ã€JSPã€ASPã€servletsã€node.jsç­‰ã€‚</li><li>Web AppæŠŠå“åº”æ•°æ®äº¤ç»™Web Serverï¼ŒWeb ServeræŒ‰ç…§HTTPå“åº”æŠ¥æ–‡æ ¼å¼å°è£…æ•°æ®ä¸ºHTTPå“åº”(response)æŠ¥æ–‡ï¼Œå¹¶æŠŠæŠ¥æ–‡é€šè¿‡TCPè¿æ¥é“¾è·¯å›é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul></li><li><p>å®¢æˆ·ç«¯æµè§ˆå™¨æ¥å—åˆ°HTTPå“åº”æŠ¥æ–‡ï¼Œä»æ•°æ®éƒ¨åˆ†æå–å‡ºhtmlä»£ç ï¼Œé€šè¿‡åŠ è½½ã€è§£æã€æ¸²æŸ“çš„è¿‡ç¨‹ï¼Œæ¥åœ¨å±å¹•ä¸Šç»˜åˆ¶å‡ºé¡µé¢ã€‚</p></li></ol><h2 id="URL-æ ¼å¼æ¢ç§˜"><a href="#URL-æ ¼å¼æ¢ç§˜" class="headerlink" title="URL æ ¼å¼æ¢ç§˜"></a>URL æ ¼å¼æ¢ç§˜</h2><p>URL(Uniform Resource Locator, ç»Ÿä¸€èµ„æºå®šä½ç¬¦)ï¼Œäº’è”ç½‘è®¾è®¡ä¸ºä¸€ä¸ªå¤§çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°±åƒæ˜¯æˆ‘ä»¬ç”µè„‘ä¸­æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„æ–‡ä»¶åœ°å€ï¼Œäº’è”ç½‘ä¸Šçš„èµ„æºåœ°å€å°±æ˜¯URLã€‚å…¶æ ¼å¼ä¸º</p><blockquote><p>protocol://<hostname>:<port>/<route>/<filename></p></blockquote><ul><li><p>åè®®(protocol)å¸¸è§çš„æœ‰HTTPï¼ŒHTTPSï¼Œftpï¼Œtelnetï¼Œfileç­‰å‡ ç§ã€‚è¿™äº›åè®®éƒ½å±äºåº”ç”¨åè®®ï¼Œä½äºåè®®å±‚çš„åº”ç”¨å±‚ï¼Œå®ƒä»¬åŸºäºä¼ è¾“å±‚çš„åè®®è€Œå·¥ä½œï¼Œä¾‹å¦‚HTTPåŸºäºTCPï¼ŒHTTPSåŸºäºTLS/SSLï¼ŒTLS/SSLä¹Ÿæ˜¯åŸºäºTCPä¼ è¾“åè®®ã€‚</p></li><li><p>ä¸»æœºå(hostname)ä»£è¡¨ä¸€ä¸ªæä¾›æœåŠ¡çš„æœåŠ¡å™¨IPï¼Œå®ƒå¯ä»¥æ˜¯IPæˆ–è€…å¯ä»¥è§£æä¸ºIPçš„ç½‘å€ã€‚</p></li><li><p>ç«¯å£å·(port)ä»£è¡¨æœåŠ¡å™¨çš„ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ç›‘å¬è¿™ä¸ªç«¯å£ä¸Šçš„TCPæˆ–UDPæ•°æ®æŠ¥ã€‚ä¸€å°ä¸»æœºå¾€å¾€æä¾›å¤šä¸ªæœåŠ¡ï¼Œä¾‹å¦‚æ—¢æä¾›WebæœåŠ¡ä¹Ÿæä¾›FTPæœåŠ¡ï¼Œé‚£ä¹ˆç«¯å£å°±å¯ä»¥å‘Šè¯‰webæœåŠ¡å™¨æ‰€åœ¨ä¸»æœºæŠŠè¯·æ±‚äº¤ç»™å“ªä¸€ä¸ªæœåŠ¡ã€‚å„ä¸ªåè®®éƒ½æœ‰é»˜è®¤ï¼ˆç¼ºçœï¼‰çš„ç«¯å£ã€‚</p></li><li><p>è·¯å¾„(route)ä»£è¡¨ä¸€ä¸ªæœåŠ¡ä¸‹çš„èµ„æºçš„è·¯å¾„ï¼Œä¾‹å¦‚<code>https://myblog.com/blog/2017/index.html</code>ä¸­çš„/<code>blog/2017</code>ä»£è¡¨2017å¹´çš„æ‰€æœ‰åšå®¢ï¼Œè¿”å›çš„èµ„æºå–å†³äºåç«¯æœåŠ¡å™¨çš„å®ç°ã€‚</p></li><li><p>æ–‡ä»¶å(filename)ä»£è¡¨æŸä¸ªç‰¹å®šçš„èµ„æºï¼Œä¾‹å¦‚<code>https://myblog.com/blog/2017/index.html</code>çš„<code>index.html</code>ä»£è¡¨è¿™ä¸ªç‰¹å®šçš„é¡µé¢ã€‚</p></li></ul><h2 id="IPåœ°å€"><a href="#IPåœ°å€" class="headerlink" title="IPåœ°å€"></a>IPåœ°å€</h2><p>å°±åƒæ¯æ ‹æˆ¿å­éƒ½æœ‰åœ°å€ï¼ŒIPä»£è¡¨ä¸€ä¸ªè®¡ç®—æœºæˆ–è€…å±€åŸŸç½‘åœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ã€‚IPåè®®å¦‚ä»Šå·²æœ‰IPv4å’ŒIPv6ï¼Œç›®å‰ä¾æ—§æ˜¯IPv4å æ®ä¸»æµï¼Œä½†IPv6æ˜¯æœªæ¥çš„è¶‹åŠ¿ã€‚IPv4åè®®ä¸­ï¼Œå­˜åœ¨å…¬ç½‘åœ°å€ä¸è¶³çš„é—®é¢˜ï¼Œæ‰€ä»¥äººä»¬å‘æ˜äº†NATæŠ€æœ¯æŠŠä¸€ä¸ªå±€åŸŸç½‘åœ°å€æ˜ å°„ä¸ºä¸€ä¸ªå…¬ç½‘åœ°å€(å±€åŸŸç½‘ç½‘å…³åœ°å€)ã€‚å±€åŸŸç½‘å†…çš„ä¸»æœºè¦æä¾›äº’è”ç½‘æœåŠ¡å¿…é¡»åˆ©ç”¨ç«¯å£æ˜ å°„æŠŠè¯¥ä¸»æœºä¸Šçš„æœåŠ¡ç«¯å£æ˜ å°„åˆ°å±€åŸŸç½‘ç½‘å…³çš„ç«¯å£ã€‚</p><p>ä½†IPåœ°å€ä¸æ˜“è¾¨è¯†ï¼Œæ‰€ä»¥äººä»¬ç”¨ç½‘ç«™åŸŸåæ¥ä½œä¸ºIPåœ°å€çš„åˆ«åï¼Œä»IPåœ°å€åˆ°åŸŸåæˆ–ä»åŸŸååˆ°IPåœ°å€çš„æ˜ å°„è¿‡ç¨‹ç§°ä¸ºDNSè§£æã€‚</p><h2 id="DNSè§£æ"><a href="#DNSè§£æ" class="headerlink" title="DNSè§£æ"></a>DNSè§£æ</h2><h3 id="DNSè§£æè¿‡ç¨‹"><a href="#DNSè§£æè¿‡ç¨‹" class="headerlink" title="DNSè§£æè¿‡ç¨‹"></a>DNSè§£æè¿‡ç¨‹</h3><p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥urlä¹‹åï¼Œç”µè„‘ä¼šå‘å‡ºä¸€ä¸ªDNSè§£æè¯·æ±‚åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ã€‚ç„¶åæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¾æ¬¡æŸ¥æ‰¾ï¼š</p><ol><li><p>æŸ¥æ‰¾æµè§ˆå™¨ç¼“å­˜</p><p>æµè§ˆå™¨æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æœªè¿‡æœŸçš„è¯¥åŸŸåè§£æè¿‡çš„IPåœ°å€ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆè§£æè¿‡ç¨‹æˆåŠŸç»“æŸã€‚</p></li></ol><center>â–² chromeçš„æµè§ˆå™¨ç¼“å­˜ç¤ºä¾‹</center><ol><li><p>æŸ¥æ‰¾æ“ä½œç³»ç»Ÿç¼“å­˜</p><p>å¦‚æœæµè§ˆå™¨dnsç¼“å­˜ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šä»hostsæ–‡ä»¶ä¸­æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„åŸŸådnsé…ç½®é¡¹ã€‚</p></li><li><p>æŸ¥æ‰¾è·¯ç”±å™¨ç¼“å­˜</p><p>å¦‚æœç³»ç»Ÿç¼“å­˜ä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆå»è·¯ç”±å™¨çš„dnsç¼“å­˜ä¸­æŸ¥æ‰¾ã€‚</p></li><li><p>ç½‘ç»œæ¥å…¥æœåŠ¡å•†(ISP)DNSç¼“å­˜</p><p>ISPéƒ½ä¼šæä¾›DNSç¼“å­˜æœåŠ¡å™¨ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç½‘ç»œé…ç½®ä¸­é…ç½®ç‰¹å®šçš„DNSæœåŠ¡å™¨ã€‚</p></li></ol><p>   å¦‚æœæ˜¯å±€åŸŸç½‘å†…çš„ä¸»æœºï¼Œè¿™ä¸ªæœ¬åœ°DNSæœåŠ¡å™¨ä¸€èˆ¬æ˜¯å±€åŸŸç½‘çš„ç½‘å…³ã€‚ç½‘å…³ä¼šæŠŠDNSè§£æè¯·æ±‚è½¬å‘ç»™ISP DNSæœåŠ¡å™¨ã€‚</p><ol><li><p>é€’å½’æŸ¥è¯¢</p><p>ç»å†äº†å¦‚ä¸Šæ­¥éª¤éƒ½æ‰¾ä¸åˆ°DNSæœåŠ¡å™¨çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è®¿é—®äº’è”ç½‘çš„DNSæœåŠ¡å™¨è¿›è¡Œé€’å½’æŸ¥è¯¢ã€‚</p></li></ol><p>   å‡è®¾è§£æ<code>www.google.com</code>è¿™ä¸ªåŸŸåï¼Œæœ¬åœ°dnsæœåŠ¡å™¨æŠŠdnsè§£æè¯·æ±‚è½¬å‘ç»™äº’è”ç½‘çš„æ ¹åŸŸåæœåŠ¡å™¨ï¼Œå¦‚æœæ ¹åŸŸåæœåŠ¡å™¨ä¸å­˜åœ¨è¯¥åŸŸåè®°å½•ï¼Œåˆ™æ ¹æ®é¡¶çº§åŸŸcomå‘comé¡¶çº§åŸŸdnsæœåŠ¡å™¨å‘é€dnsè¯·æ±‚ï¼Œå¦‚æœè¿˜æ²¡æœ‰åˆ™æ ¹æ®äºŒçº§åŸŸgoogle.comæœåŠ¡å™¨æŸ¥è¯¢ï¼ŒçŸ¥é“æœ€ç»ˆå¾—åˆ°è¯¥åŸŸåçš„IPåœ°å€ï¼Œå¹¶æŠŠå®ƒç¼“å­˜åˆ°æœ¬åœ°ã€‚</p><p>   æ‰€ä»¥ç½‘å€çš„dnsè§£æè¿‡ç¨‹æ˜¯ä¸€ä¸ªç”±å³å‘å·¦çš„è§£æè¿‡ç¨‹ï¼š</p><p>   <code>. --&gt; .com --&gt; google.com --&gt; www.google.com</code></p><h3 id="DNSè´Ÿè½½å‡è¡¡"><a href="#DNSè´Ÿè½½å‡è¡¡" class="headerlink" title="DNSè´Ÿè½½å‡è¡¡"></a>DNSè´Ÿè½½å‡è¡¡</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œé€šè¿‡nslookupå‘½ä»¤æ¥å¯¹æŸä¸ªåŸŸåè¿›è¡Œdnsè§£æè·å¾—å®ƒçš„IPåœ°å€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ nslookup google.com</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:baidu.com</span><br><span class="line">Address: 220.181.57.216</span><br><span class="line">Name:baidu.com</span><br><span class="line">Address: 123.125.115.110</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°baidu.comè¿™ä¸ªåŸŸåæœ‰ä¸¤ä¸ªIPåœ°å€ã€‚è¿™æ˜¯é‡‡ç”¨äº†DNSè´Ÿè½½å‡è¡¡æŠ€æœ¯ã€‚</p><p>ç”±äºå•å°æœåŠ¡å™¨çš„æ€§èƒ½æœ‰é™ï¼Œç°ä»£çš„å¤§å‹ç½‘ç»œæœåŠ¡å¾€å¾€éƒ½æ˜¯é›†ç¾¤æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œè€Œè¿™äº›æœåŠ¡å™¨é›†ç¾¤å¾€å¾€æœ‰å¤šä¸ªIPåœ°å€ï¼Œè€ŒDNSå¯ä»¥æ ¹æ®æ ¹æ®æ¯å°æœåŠ¡å™¨çš„è´Ÿè½½é‡ï¼Œè¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰æ¥è¿”å›ä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨çš„IPç»™ç”¨æˆ·ï¼Œè¿™å°±æ˜¯DNSçš„è´Ÿè½½å‡è¡¡ä¹Ÿç§°ä¸ºDNSé‡å®šå‘ã€‚CDNæ­£æ˜¯é‡‡ç”¨äº†è¿™ç§æŠ€æœ¯ã€‚</p><h2 id="TCPè¿æ¥"><a href="#TCPè¿æ¥" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h2><p>WebæœåŠ¡éƒ½æ˜¯åŸºäºHTTP/HTTPSåè®®æä¾›çš„ï¼Œè€ŒHTTP/HTTPSåè®®åˆæ˜¯åŸºäºä¼ è¾“å±‚çš„TCPåè®®çš„ã€‚æ‰€ä»¥è¿›è¡ŒHTTPé€šä¿¡å‰ï¼Œå¿…é¡»å…ˆå»ºç«‹TCPè¿æ¥ï¼ŒTCPè¿æ¥æ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹çš„ï¼Œé€šè¿‡å››æ¬¡æŒ¥æ‰‹æ¥æ–­å¼€ã€‚è¿™é‡Œä¸è¯¦ç»†èµ˜è¿°ã€‚</p><h3 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a>HTTPåè®®</h3><h4 id="HTTPçš„æ— è¿æ¥"><a href="#HTTPçš„æ— è¿æ¥" class="headerlink" title="HTTPçš„æ— è¿æ¥"></a>HTTPçš„æ— è¿æ¥</h4><p><strong>HTTPåè®®æ˜¯æ— è¿æ¥çš„åè®®</strong>ï¼Œæ— è¿æ¥çš„æ„æ€å°±æ˜¯æŒ‡æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·è¯·æ±‚ï¼Œæ”¶åˆ°åº”ç­”ä¹‹åï¼Œå³æ–­å¼€TCPè¿æ¥ã€‚è¿™ç§è®¾è®¡æ˜¯å› ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„äº¤æ¢æ•°æ®æ—¶é—´é—´éš”è¾ƒå¤§ï¼Œè€Œä¸”ä¸¤æ¬¡ä¼ é€çš„æ•°æ®å…³è”æ€§è¾ƒä½ï¼Œä¸ºäº†èŠ‚çœTCPè¿æ¥ä¿¡é“æ‰€å æ®çš„èµ„æºï¼ŒHTTPåè®®è¢«è®¾è®¡ä¸º<strong>è¯·æ±‚æ—¶å»ºè¿æ¥ã€è¯·æ±‚å®Œé‡Šæ”¾è¿æ¥ï¼Œä»¥å°½å¿«å°†èµ„æºé‡Šæ”¾å‡ºæ¥æœåŠ¡å…¶ä»–å®¢æˆ·ç«¯</strong>ã€‚ä½†æ˜¯å¯¹äºæŸäº›æƒ…æ™¯ï¼Œä¾‹å¦‚ç½‘é¡µä¸­å«æœ‰å¤§é‡å¼•ç”¨èµ„æºï¼Œæ¯æ¬¡è®¿é—®å¼•ç”¨èµ„æºéƒ½éœ€è¦å»ºç«‹ä¸€æ¬¡TCPè¿æ¥å°±æ˜¾å¾—ååˆ†ä½æ•ˆï¼ˆTCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹æ€§èƒ½æ¶ˆè€—ååˆ†ä¸¥é‡ï¼‰ã€‚</p><p>ä¸ºäº†å®ç°æŒç»­TCPè¿æ¥ï¼ŒHTTPåè®®å¼•å…¥äº†Keep-Aliveå­—æ®µã€‚<strong>Keep-Alive åŠŸèƒ½ä½¿å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆï¼Œå½“å‡ºç°å¯¹æœåŠ¡å™¨çš„åç»§è¯·æ±‚æ—¶ï¼ŒKeep-Alive å¯ä»¥ä¿æŒå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„æŒç»­TCPè¿æ¥</strong>ã€‚å¯¹äºé™æ€ç½‘ç«™ï¼Œè¿™ä¸ªåŠŸèƒ½ååˆ†æœ‰ç”¨ï¼Œä½†å¯¹äºåŠ¨æ€ç½‘ç«™æ¥è¯´ï¼Œè¿‡å¤šçš„è¿æ¥ä¼šè€—å°½æœåŠ¡å™¨çš„è¿æ¥æ± ï¼ŒæŒç»­å ç”¨èµ„æºå½±å“æ€§èƒ½ã€‚æ‰€ä»¥è¦è°¨æ…ä½¿ç”¨Keep-AliveåŠŸèƒ½ã€‚</p><h4 id="HTTPçš„æ— çŠ¶æ€"><a href="#HTTPçš„æ— çŠ¶æ€" class="headerlink" title="HTTPçš„æ— çŠ¶æ€"></a>HTTPçš„æ— çŠ¶æ€</h4><p><strong>HTTPåè®®æ˜¯æ— çŠ¶æ€çš„åè®®</strong>ï¼Œè¿™æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯ä¸­çš„çŠ¶æ€ï¼Œå³æˆ‘ä»¬ä¸æœåŠ¡å™¨çš„æ¯ä¸€æ¬¡è¯·æ±‚å“åº”è¿‡ç¨‹ï¼ŒæœåŠ¡å™¨éƒ½ä¸ä¼šè®°å½•ä»»ä½•ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</p><p>ä¾‹å¦‚ï¼šç”µå•†ç½‘ç«™ä¸­ï¼Œæˆ‘ä»¬å‘è´­ç‰©è½¦æ”¾ä¸€ä¸ªå•†å“ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç™»é™†ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ— æ³•è®°å½•è´­ç‰©è½¦é‡Œçš„å•†å“æ¸…å•ï¼Œå› ä¸ºå®ƒæ— æ³•åˆ†è¾¨ç©¶ç«Ÿæ˜¯å“ªä¸ªç”¨æˆ·çš„è´­ç‰©è½¦ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHTTPä½¿ç”¨äº†Cookieå’ŒSessionä¸¤ç§ä¿æŒHTTPè¿æ¥çŠ¶æ€çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬å¸¸è§çš„ç™»é™†æ“ä½œå¸¸è§çš„åšæ³•å°±æ˜¯åœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ªçŠ¶æ€cookieï¼Œç„¶åcookieä¸­ä¿å­˜sessionidï¼Œæˆ‘ä»¬æ¯æ¬¡å‘é€httpè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨è¯»å–cookieä¸­çš„sessionidï¼Œåœ¨æœåŠ¡ç«¯æŸ¥æ‰¾æŒä¹…åŒ–çš„sessionä¿¡æ¯ï¼Œåˆ¤æ–­ç”¨æˆ·çš„ç™»é™†çŠ¶æ€ï¼Œå¹¶è¯»å–å¯¹åº”çš„ä¸šåŠ¡ä¿¡æ¯ã€‚</p><h3 id="HTTPSåè®®"><a href="#HTTPSåè®®" class="headerlink" title="HTTPSåè®®"></a>HTTPSåè®®</h3><p>HTTPåè®®å®Œå…¨æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œç›´æ¥æŠŠæ˜æ–‡çš„HTTPæŠ¥æ–‡é€šè¿‡TCPè¿æ¥ä¼ é€åˆ°å¯¹æ–¹ï¼Œè¿™å…¶ä¸­æœ‰ç›¸å½“çš„ä¿¡æ¯æ³„æ¼çš„é£é™©ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç½‘æ™¯å…¬å¸æå‡ºäº†ä¸€ç§æ–°åè®®HTTPSï¼Œå³åŸºäºSSLåè®®çš„HTTPï¼Œè¿™æ˜¯æŠŠHTTPæŠ¥æ–‡æ”¾åœ¨åŠ å¯†çš„SSLä¿¡é“ä¸­è¿›è¡Œé€šä¿¡ã€‚SSLåæ¥è¢«æ ‡å‡†åŒ–ä¸ºTLSåè®®ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºTLS/SSLã€‚</p><p>HTTPSä¸HTTPåè®®ä¸åŒä¹‹å¤„åœ¨äºï¼Œå»ºç«‹TCPè¿æ¥ä¹‹åï¼ŒHTTPSåè®®è¿˜éœ€è¦å†ç»è¿‡<a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html">TLS/SSLæ¡æ‰‹è¿‡ç¨‹</a>ï¼Œæ¥å»ºç«‹TLS/SSLé€šé“ï¼Œç„¶åæ‰è¿›è¡ŒHTTPé€šä¿¡ã€‚è¿™ä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚</p><h2 id="å®¢æˆ·ç«¯æ„é€ HTTPè¯·æ±‚æŠ¥æ–‡"><a href="#å®¢æˆ·ç«¯æ„é€ HTTPè¯·æ±‚æŠ¥æ–‡" class="headerlink" title="å®¢æˆ·ç«¯æ„é€ HTTPè¯·æ±‚æŠ¥æ–‡"></a>å®¢æˆ·ç«¯æ„é€ HTTPè¯·æ±‚æŠ¥æ–‡</h2><p>è·å–äº†ç›®çš„IPï¼Œå»ºç«‹äº†TCPè¿æ¥ä¹‹åï¼Œå®¢æˆ·ç«¯æ„å»ºHTTPè¯·æ±‚æŠ¥æ–‡ï¼Œé€šè¿‡TCPåè®®å‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£(HTTPåè®®é»˜è®¤ç«¯å£80/8080, HTTPSåè®®é»˜è®¤ç«¯å£443)ã€‚</p><h2 id="æœåŠ¡ç«¯æ¥å—HTTPè¯·æ±‚"><a href="#æœåŠ¡ç«¯æ¥å—HTTPè¯·æ±‚" class="headerlink" title="æœåŠ¡ç«¯æ¥å—HTTPè¯·æ±‚"></a>æœåŠ¡ç«¯æ¥å—HTTPè¯·æ±‚</h2><p>ä»è¿™é‡Œå¼€å§‹å°±æ˜¯æœåŠ¡ç«¯çš„å·¥ä½œäº†ã€‚Web Serverç›‘å¬TCPç«¯å£ï¼Œå½“ç«¯å£æ¥æ”¶åˆ°<code>HTTPRequest</code>æŠ¥æ–‡ï¼Œå°±å¯¹æŠ¥æ–‡è¿›è¡Œè§£æï¼Œå¹¶å°è£…ç§°ä¸º<code>HTTPRequest</code>å¯¹è±¡ï¼Œä¾›ä¸Šå±‚ä½¿ç”¨ã€‚</p><p>æ ¹æ®è®¿é—®çš„èµ„æºï¼Œå¤§è‡´å¯åˆ†ä¸ºé™æ€èµ„æºå’ŒåŠ¨æ€èµ„æºï¼Œé™æ€èµ„æºå°±æ˜¯æŒ‡ç›®å½•ä¸­æŸä¸ªä½ç½®ä¸­é¢„å…ˆç”Ÿæˆå¥½çš„æ–‡ä»¶ï¼Œä¾‹å¦‚myblog/index.htmlï¼ŒåŠ¨æ€èµ„æºåˆ™æ˜¯æŒ‡ä¼šæ ¹æ®è¯·æ±‚æ•°æ®åŠ¨æ€ç”Ÿæˆçš„é¡µé¢ï¼Œä¾‹å¦‚æ ¹æ®ç”¨æˆ·æƒé™ä¸åŒå±•ç¤ºçš„æ•°æ®ç»Ÿè®¡è¡¨ã€‚</p><p>Web Serverä»HTTPè¯·æ±‚ä¸­è·å–å‚æ•°åï¼Œå¦‚æœæ˜¯é™æ€èµ„æºï¼Œåˆ™è¯»å–è¯¥èµ„æºæ–‡ä»¶ï¼Œæ ¹æ®HTTPå“åº”æŠ¥æ–‡æ ¼å¼äº§ç”ŸHTTPå“åº”ï¼Œå›é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœæ˜¯åŠ¨æ€èµ„æºï¼Œåˆ™è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†ï¼Œäº§ç”ŸHTTPå“åº”æŠ¥æ–‡ã€‚</p><p>ä¾‹å¦‚ç›®å‰ä¸»æµçš„åç«¯Webæ¡†æ¶æ˜¯MVCæ¨¡å¼ã€‚</p><p>MVCæ¡†æ¶é¦–å…ˆæ ¹æ®<code>HTTPRequest</code>å¯¹è±¡çš„å‚æ•°ã€å†…å®¹ï¼Œå…ˆæ ¹æ®è·¯ç”±é…ç½®å»é€‰æ‹©å¯¹åº”çš„Controllerï¼ŒControlleræ ¹æ®å‚æ•°è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œä¸­é—´å¯èƒ½ä¼šè¿›è¡Œè¯»å†™æ•°æ®åº“ç­‰æ“ä½œï¼Œç„¶åæ¸²æŸ“ä¸€ä¸ªæ•°æ®æ¨¡å‹Modelï¼Œæ•°æ®æ¨¡å‹ç”¨æ¥æ¸²æŸ“æ¨¡ç‰ˆé¡µï¼Œè¿™é‡Œçš„å·¥ä½œç”±æ¨¡ç‰ˆå¼•æ“æ¥å®Œæˆï¼Œæœ€ç»ˆç”ŸæˆHTTPå“åº”ã€‚</p><p>å‡è®¾<code>myblog.com/blogs/1/edit</code>æ˜¯ä¿®æ”¹<code>myblog.com</code>çš„ç¬¬ä¸€ç¯‡åšå®¢çš„æ¥å£ï¼Œé‚£ä¹ˆRouteré¦–å…ˆå¯¹<code>blogs/1/edit</code>è¿›è¡Œè·¯ç”±åŒ¹é…ï¼ŒåŒ¹é…åˆ°çš„<code>controller</code>æ˜¯<code>edit</code>ï¼Œé‚£ä¹ˆè°ƒç”¨<code>edit</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»<code>HTTP Request</code>å¯¹è±¡çš„æ­£æ–‡è·å¾—äº†ä¿®æ”¹åçš„åšæ–‡ï¼Œäºæ˜¯è°ƒç”¨æ•°æ®åº“å¼•æ“ï¼Œå¯¹æ•°æ®åº“å†…çš„å¯¹åº”åšæ–‡è¿›è¡Œä¿®æ”¹ã€‚ç„¶åè¿”å›ä¸€ä¸ªæ–°çš„åšæ–‡çš„jsonæ•°æ®ï¼Œè¯¥æ•°æ®å³æ˜¯æ•°æ®æ¨¡å‹<code>Model</code>ï¼Œç„¶åè°ƒç”¨æ¨¡ç‰ˆå¼•æ“ï¼ŒæŠŠ<code>Model</code>æ¸²æŸ“åˆ°æ¨¡ç‰ˆé¡µï¼Œç”Ÿæˆhtmlé¡µé¢ï¼Œç„¶åæ ¹æ®htmlé¡µé¢äº§ç”Ÿ<code>HTTPResponse</code>å¯¹è±¡ã€‚</p><h2 id="æœåŠ¡ç«¯å‘å‡ºHTTPå“åº”"><a href="#æœåŠ¡ç«¯å‘å‡ºHTTPå“åº”" class="headerlink" title="æœåŠ¡ç«¯å‘å‡ºHTTPå“åº”"></a>æœåŠ¡ç«¯å‘å‡ºHTTPå“åº”</h2><p>WebæœåŠ¡å™¨æ ¹æ®<code>HTTPResponse</code>å¯¹è±¡æ¥äº§ç”ŸHTTPå“åº”æŠ¥æ–‡ï¼Œé€šè¿‡TCPè¿æ¥å›é€è¯¥æŠ¥æ–‡ã€‚ç„¶åæ ¹æ®HTTPä¸­çš„Keep-Aliveå­—æ®µçš„å€¼ç¡®å®šæ˜¯å¦è¦åœ¨å“åº”å‘é€å®Œæˆåå…³é—­TCPè¿æ¥ã€‚</p><h2 id="å®¢æˆ·ç«¯æ¥å—HTTPå“åº”æŠ¥æ–‡"><a href="#å®¢æˆ·ç«¯æ¥å—HTTPå“åº”æŠ¥æ–‡" class="headerlink" title="å®¢æˆ·ç«¯æ¥å—HTTPå“åº”æŠ¥æ–‡"></a>å®¢æˆ·ç«¯æ¥å—HTTPå“åº”æŠ¥æ–‡</h2><p>æµè§ˆå™¨ä»HTTPå“åº”æŠ¥æ–‡ä¸­çš„æ•°æ®æ®µæå–å‡ºhtmlã€cssã€jsæ–‡ä»¶ï¼Œç„¶åæµè§ˆå™¨å¯¹è¿™äº›èµ„æºè¿›è¡Œæ¸²æŸ“ï¼ŒæŠŠæ¸²æŸ“å‡ºæ¥çš„ç½‘é¡µç»˜åˆ¶åœ¨å±å¹•ä¸Šã€‚</p><p>æµè§ˆå™¨ä»ä¸Šè€Œä¸‹è§£æHTMLæ–‡ä»¶ï¼Œå¦‚æœè§£æè¿‡ç¨‹ä¸­é‡åˆ°å¤–éƒ¨èµ„æºï¼Œå¦‚å›¾åƒã€JSã€CSSæ–‡ä»¶ç­‰ï¼Œåˆ™ä¼šé‡å¤ä»¥ä¸ŠHTTPé€šä¿¡è¿‡ç¨‹ã€‚è¿™ä¸ªå¯¹å¤–éƒ¨èµ„æºçš„è¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“èµ„æºè§£æã€‚å½“è§£æåˆ°JSæ–‡ä»¶æ—¶ï¼ŒHTMLæ–‡æ¡£åˆ™ä¼šæŒ‚èµ·æ¸²æŸ“è¿‡ç¨‹ï¼Œç­‰å¾…JSæ–‡ä»¶åŠ è½½å®Œæ¯•å’Œæ‰§è¡Œå®Œæ¯•ã€‚å› æ­¤JSä¼šé˜»å¡åç»­èµ„æºçš„ä¸‹è½½ã€‚JSä»£ç æ‰§è¡Œå‰å¿…é¡»ä¿è¯æ‰€æœ‰çš„CSSæ–‡ä»¶åŠ è½½å®Œæ¯•ã€‚</p><p>æµè§ˆå™¨è§£æHTMLæ–‡ä»¶æ„é€ DOMæ ‘ï¼Œè§£æCSSæ–‡ä»¶æ„é€ æ¸²æŸ“æ ‘ï¼Œæ¸²æŸ“æ ‘æ„å»ºå®Œæˆåï¼Œåˆ™å¼€å§‹æ ¹æ®æ¸²æŸ“æ ‘ç»˜åˆ¶é¡µé¢åˆ°å±å¹•ä¸Šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLå‘½ä»¤ä¹‹Explainç¬”è®°</title>
      <link href="/2016/12/09/MySQL/MySQL%E5%91%BD%E4%BB%A4%E4%B9%8BExplain%E7%AC%94%E8%AE%B0/"/>
      <url>/2016/12/09/MySQL/MySQL%E5%91%BD%E4%BB%A4%E4%B9%8BExplain%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>MySQL æä¾›äº†ä¸€ä¸ª EXPLAIN å‘½ä»¤ï¼Œ å®ƒå¯ä»¥å¯¹ <code>SELECT</code> è¯­å¥è¿›è¡Œåˆ†æï¼Œ å¹¶è¾“å‡º <code>SELECT</code> æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯ï¼Œ ä»¥ä¾›å¼€å‘äººå‘˜é’ˆå¯¹æ€§ä¼˜åŒ–ã€‚å€ŸåŠ©ä¸€ä¸ªå®ä¾‹æ“ä½œï¼Œæ¥å¯¹Explainç”¨æ³•åšä¸€äº›æ€»ç»“ã€‚</p><a id="more"></a><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>EXPLAIN å‘½ä»¤ç”¨æ³•ååˆ†ç®€å•ï¼Œ åœ¨ SELECT è¯­å¥å‰åŠ ä¸Š Explain å°±å¯ä»¥äº†ï¼Œ ä¾‹å¦‚:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">from</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> &lt; <span class="number">300</span>;</span><br></pre></td></tr></table></figure><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>ä¸ºäº†æ¥ä¸‹æ¥æ–¹ä¾¿æ¼”ç¤º EXPLAIN çš„ä½¿ç”¨ï¼Œ é¦–å…ˆæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸¤ä¸ªæµ‹è¯•ç”¨çš„è¡¨ï¼Œ å¹¶æ·»åŠ ç›¸åº”çš„æ•°æ®:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_info`</span> (</span><br><span class="line">  <span class="string">`id`</span>   <span class="built_in">BIGINT</span>(<span class="number">20</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>ï¼Œ</span><br><span class="line">  <span class="string">`age`</span>  <span class="built_in">INT</span>(<span class="number">11</span>)              <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)ï¼Œ</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`name_index`</span> (<span class="string">`name`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;xys&#x27;</span>ï¼Œ <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;a&#x27;</span>ï¼Œ <span class="number">21</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;b&#x27;</span>ï¼Œ <span class="number">23</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;c&#x27;</span>ï¼Œ <span class="number">50</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;d&#x27;</span>ï¼Œ <span class="number">15</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;e&#x27;</span>ï¼Œ <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;f&#x27;</span>ï¼Œ <span class="number">21</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;g&#x27;</span>ï¼Œ <span class="number">23</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;h&#x27;</span>ï¼Œ <span class="number">50</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (<span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;i&#x27;</span>ï¼Œ <span class="number">15</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`order_info`</span> (</span><br><span class="line">  <span class="string">`id`</span>           <span class="built_in">BIGINT</span>(<span class="number">20</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`user_id`</span>      <span class="built_in">BIGINT</span>(<span class="number">20</span>)           <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_name`</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>ï¼Œ</span><br><span class="line">  <span class="string">`productor`</span>    <span class="built_in">VARCHAR</span>(<span class="number">30</span>)          <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)ï¼Œ</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`user_product_detail_index`</span> (<span class="string">`user_id`</span>ï¼Œ <span class="string">`product_name`</span>ï¼Œ <span class="string">`productor`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;p1&#x27;</span>ï¼Œ <span class="string">&#x27;WHH&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;p2&#x27;</span>ï¼Œ <span class="string">&#x27;WL&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;p1&#x27;</span>ï¼Œ <span class="string">&#x27;DX&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;p1&#x27;</span>ï¼Œ <span class="string">&#x27;WHH&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;p5&#x27;</span>ï¼Œ <span class="string">&#x27;WL&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;p3&#x27;</span>ï¼Œ <span class="string">&#x27;MA&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;p1&#x27;</span>ï¼Œ <span class="string">&#x27;WHH&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">&#x27;p1&#x27;</span>ï¼Œ <span class="string">&#x27;WHH&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_info (user_id, product_name, productor) <span class="keyword">VALUES</span> (<span class="number">9</span>, <span class="string">&#x27;p8&#x27;</span>ï¼Œ <span class="string">&#x27;TE&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="EXPLAIN-è¾“å‡ºæ ¼å¼"><a href="#EXPLAIN-è¾“å‡ºæ ¼å¼" class="headerlink" title="EXPLAIN è¾“å‡ºæ ¼å¼"></a>EXPLAIN è¾“å‡ºæ ¼å¼</h2><p>EXPLAIN å‘½ä»¤çš„è¾“å‡ºå†…å®¹å¤§è‡´å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mysql&gt;</span> <span class="string">explain</span> <span class="string">select</span> <span class="string">*</span> <span class="string">from</span> <span class="string">user_info</span> <span class="string">where</span> <span class="string">id</span> <span class="string">=</span> <span class="number">2</span><span class="string">\G</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">           <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">select_type:</span> <span class="string">SIMPLE</span></span><br><span class="line">        <span class="attr">table:</span> <span class="string">user_info</span></span><br><span class="line">   <span class="attr">partitions:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">const</span></span><br><span class="line"><span class="attr">possible_keys:</span> <span class="string">PRIMARY</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">PRIMARY</span></span><br><span class="line">      <span class="attr">key_len:</span> <span class="number">8</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">const</span></span><br><span class="line">         <span class="attr">rows:</span> <span class="number">1</span></span><br><span class="line">     <span class="attr">filtered:</span> <span class="number">100.00</span></span><br><span class="line">        <span class="attr">Extra:</span> <span class="literal">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set,</span> <span class="number">1</span> <span class="string">warning</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure><p>å„åˆ—çš„å«ä¹‰å¦‚ä¸‹:</p><ul><li>id: SELECT æŸ¥è¯¢çš„æ ‡è¯†ç¬¦. æ¯ä¸ª SELECT éƒ½ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦.</li><li>select_type: SELECT æŸ¥è¯¢çš„ç±»å‹.</li><li>table: æŸ¥è¯¢çš„æ˜¯å“ªä¸ªè¡¨</li><li>partitions: åŒ¹é…çš„åˆ†åŒº</li><li>type: join ç±»å‹</li><li>possible_keys: æ­¤æ¬¡æŸ¥è¯¢ä¸­å¯èƒ½é€‰ç”¨çš„ç´¢å¼•</li><li>key: æ­¤æ¬¡æŸ¥è¯¢ä¸­ç¡®åˆ‡ä½¿ç”¨åˆ°çš„ç´¢å¼•.</li><li>ref: å“ªä¸ªå­—æ®µæˆ–å¸¸æ•°ä¸ key ä¸€èµ·è¢«ä½¿ç”¨</li><li>rows: æ˜¾ç¤ºæ­¤æŸ¥è¯¢ä¸€å…±æ‰«æäº†å¤šå°‘è¡Œ. è¿™ä¸ªæ˜¯ä¸€ä¸ªä¼°è®¡å€¼.</li><li>filtered: è¡¨ç¤ºæ­¤æŸ¥è¯¢æ¡ä»¶æ‰€è¿‡æ»¤çš„æ•°æ®çš„ç™¾åˆ†æ¯”</li><li>extra: é¢å¤–çš„ä¿¡æ¯</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥é‡ç‚¹çœ‹ä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå­—æ®µ.</p><h3 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h3><p><code>select_type</code> è¡¨ç¤ºäº†æŸ¥è¯¢çš„ç±»å‹ï¼Œ å®ƒçš„å¸¸ç”¨å–å€¼æœ‰:</p><ul><li>SIMPLE, è¡¨ç¤ºæ­¤æŸ¥è¯¢ä¸åŒ…å« UNION æŸ¥è¯¢æˆ–å­æŸ¥è¯¢</li><li>PRIMARY, è¡¨ç¤ºæ­¤æŸ¥è¯¢æ˜¯æœ€å¤–å±‚çš„æŸ¥è¯¢</li><li>UNION, è¡¨ç¤ºæ­¤æŸ¥è¯¢æ˜¯ UNION çš„ç¬¬äºŒæˆ–éšåçš„æŸ¥è¯¢</li><li>DEPENDENT UNION, UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œ å–å†³äºå¤–é¢çš„æŸ¥è¯¢</li><li>UNION RESULT, UNION çš„ç»“æœ</li><li>SUBQUERY, å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT</li><li>DEPENDENT SUBQUERY: å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT, å–å†³äºå¤–é¢çš„æŸ¥è¯¢. å³å­æŸ¥è¯¢ä¾èµ–äºå¤–å±‚æŸ¥è¯¢çš„ç»“æœ.</li></ul><p>æœ€å¸¸è§çš„æŸ¥è¯¢ç±»åˆ«åº”è¯¥æ˜¯ <code>SIMPLE</code> äº†ï¼Œ æ¯”å¦‚å½“æˆ‘ä»¬çš„æŸ¥è¯¢æ²¡æœ‰å­æŸ¥è¯¢ï¼Œ ä¹Ÿæ²¡æœ‰ UNION æŸ¥è¯¢æ—¶ï¼Œ é‚£ä¹ˆé€šå¸¸å°±æ˜¯ <code>SIMPLE</code> ç±»å‹ï¼Œ ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from user_info where id &#x3D; 2;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/eKc6yprMZFaVnHL.png" alt="Screen Shot 2020-09-09 at 9.00.09 AM"></p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† UNION æŸ¥è¯¢ï¼Œ é‚£ä¹ˆ EXPLAIN è¾“å‡º çš„ç»“æœç±»ä¼¼å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN (SELECT * FROM user_info  WHERE id IN (1, 2, 3))</span><br><span class="line">UNION</span><br><span class="line">(SELECT * FROM user_info WHERE id IN (3, 4, 5));</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/J4oXgiRtnESN1Hv.png" alt="Screen Shot 2020-09-09 at 8.59.34 AM"></p><h3 id="table"><a href="#table" class="headerlink" title="table"></a>table</h3><p>è¡¨ç¤ºæŸ¥è¯¢æ¶‰åŠçš„è¡¨æˆ–è¡ç”Ÿè¡¨</p><h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p><code>type</code> å­—æ®µæ¯”è¾ƒé‡è¦ï¼Œ å®ƒæä¾›äº†åˆ¤æ–­æŸ¥è¯¢æ˜¯å¦é«˜æ•ˆçš„é‡è¦ä¾æ®ä¾æ®. é€šè¿‡ <code>type</code> å­—æ®µï¼Œ æˆ‘ä»¬åˆ¤æ–­æ­¤æ¬¡æŸ¥è¯¢æ˜¯ <code>å…¨è¡¨æ‰«æ</code> è¿˜æ˜¯ <code>ç´¢å¼•æ‰«æ</code> ç­‰.</p><h4 id="type-å¸¸ç”¨ç±»å‹"><a href="#type-å¸¸ç”¨ç±»å‹" class="headerlink" title="type å¸¸ç”¨ç±»å‹"></a>type å¸¸ç”¨ç±»å‹</h4><p>type å¸¸ç”¨çš„å–å€¼æœ‰:</p><ul><li><code>system</code>: è¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®. è¿™ä¸ªç±»å‹æ˜¯ç‰¹æ®Šçš„ <code>const</code> ç±»å‹.</li><li><code>const</code>: é’ˆå¯¹ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢æ‰«æï¼Œ æœ€å¤šåªè¿”å›ä¸€è¡Œæ•°æ®. const æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼Œ å› ä¸ºå®ƒä»…ä»…è¯»å–ä¸€æ¬¡å³å¯.<br>ä¾‹å¦‚ä¸‹é¢çš„è¿™ä¸ªæŸ¥è¯¢ï¼Œ å®ƒä½¿ç”¨äº†ä¸»é”®ç´¢å¼•ï¼Œ å› æ­¤ <code>type</code> å°±æ˜¯ <code>const</code> ç±»å‹çš„.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from user_info where id &#x3D; 2;</span><br></pre></td></tr></table></figure><ul><li><code>eq_ref</code>: æ­¤ç±»å‹é€šå¸¸å‡ºç°åœ¨å¤šè¡¨çš„ join æŸ¥è¯¢ï¼Œ è¡¨ç¤ºå¯¹äºå‰è¡¨çš„æ¯ä¸€ä¸ªç»“æœï¼Œ éƒ½åªèƒ½åŒ¹é…åˆ°åè¡¨çš„ä¸€è¡Œç»“æœ. å¹¶ä¸”æŸ¥è¯¢çš„æ¯”è¾ƒæ“ä½œé€šå¸¸æ˜¯ <code>=</code>ï¼Œ æŸ¥è¯¢æ•ˆç‡è¾ƒé«˜. ä¾‹å¦‚:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM user_info, order_info WHERE user_info.id &#x3D; order_info.user_id;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/hwiS67cE4lopqPL.png" alt="Screen Shot 2020-09-09 at 9.01.59 AM"></p><ul><li><code>ref</code>: æ­¤ç±»å‹é€šå¸¸å‡ºç°åœ¨å¤šè¡¨çš„ join æŸ¥è¯¢ï¼Œ é’ˆå¯¹äºéå”¯ä¸€æˆ–éä¸»é”®ç´¢å¼•ï¼Œ æˆ–è€…æ˜¯ä½¿ç”¨äº† <code>æœ€å·¦å‰ç¼€</code> è§„åˆ™ç´¢å¼•çš„æŸ¥è¯¢.<br>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ å°±ä½¿ç”¨åˆ°äº† <code>ref</code> ç±»å‹çš„æŸ¥è¯¢:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM user_info, order_info WHERE user_info.id &#x3D; order_info.user_id AND order_info.user_id &#x3D; 5;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/UsCitmex8qGyzpa.png" alt="Screen Shot 2020-09-09 at 9.03.29 AM"></p><ul><li><code>range</code>: è¡¨ç¤ºä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼Œ é€šè¿‡ç´¢å¼•å­—æ®µèŒƒå›´è·å–è¡¨ä¸­éƒ¨åˆ†æ•°æ®è®°å½•. è¿™ä¸ªç±»å‹é€šå¸¸å‡ºç°åœ¨ =, &lt;&gt;, &gt;, &gt;=, &lt;, &lt;=, IS NULL, &lt;=&gt;, BETWEEN, IN() æ“ä½œä¸­.<br>å½“ <code>type</code> æ˜¯ <code>range</code> æ—¶ï¼Œ é‚£ä¹ˆ EXPLAIN è¾“å‡ºçš„ <code>ref</code> å­—æ®µä¸º NULL, å¹¶ä¸” <code>key_len</code> å­—æ®µæ˜¯æ­¤æ¬¡æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°çš„ç´¢å¼•çš„æœ€é•¿çš„é‚£ä¸ª.</li></ul><p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT *</span><br><span class="line">FROM user_info</span><br><span class="line">WHERE id BETWEEN 2 AND 8;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/XKjzHrAqM5Ny4oc.png" alt="Screen Shot 2020-09-09 at 9.06.10 AM"></p><ul><li><p><code>index</code>: è¡¨ç¤ºå…¨ç´¢å¼•æ‰«æ(full index scan)ï¼Œ å’Œ ALL ç±»å‹ç±»ä¼¼ï¼Œ åªä¸è¿‡ ALL ç±»å‹æ˜¯å…¨è¡¨æ‰«æï¼Œ è€Œ index ç±»å‹åˆ™ä»…ä»…æ‰«ææ‰€æœ‰çš„ç´¢å¼•ï¼Œ è€Œä¸æ‰«ææ•°æ®</p><p><code>index</code> ç±»å‹é€šå¸¸å‡ºç°åœ¨: æ‰€è¦æŸ¥è¯¢çš„æ•°æ®ç›´æ¥åœ¨ç´¢å¼•æ ‘ä¸­å°±å¯ä»¥è·å–åˆ°ï¼Œ è€Œä¸éœ€è¦æ‰«ææ•°æ®. å½“æ˜¯è¿™ç§æƒ…å†µæ—¶ï¼Œ Extra å­—æ®µ ä¼šæ˜¾ç¤º <code>Using index</code>.</p></li></ul><p>ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT name FROM  user_info;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/UADRNmrVLo7OMju.png" alt="Screen Shot 2020-09-09 at 9.08.30 AM"></p><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ æˆ‘ä»¬æŸ¥è¯¢çš„ name å­—æ®µæ°å¥½æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œ å› æ­¤æˆ‘ä»¬ç›´æ¥ä»ç´¢å¼•ä¸­è·å–æ•°æ®å°±å¯ä»¥æ»¡è¶³æŸ¥è¯¢çš„éœ€æ±‚äº†ï¼Œ è€Œä¸éœ€è¦æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®. å› æ­¤è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œ type çš„å€¼æ˜¯ <code>index</code>ï¼Œ å¹¶ä¸” Extra çš„å€¼æ˜¯ <code>Using index</code>.</p><ul><li>ALL: è¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œ è¿™ä¸ªç±»å‹çš„æŸ¥è¯¢æ˜¯æ€§èƒ½æœ€å·®çš„æŸ¥è¯¢ä¹‹ä¸€. é€šå¸¸æ¥è¯´ï¼Œ æˆ‘ä»¬çš„æŸ¥è¯¢ä¸åº”è¯¥å‡ºç° ALL ç±»å‹çš„æŸ¥è¯¢ï¼Œ å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œ å¯¹æ•°æ®åº“çš„æ€§èƒ½æ˜¯å·¨å¤§çš„ç¾éš¾. å¦‚ä¸€ä¸ªæŸ¥è¯¢æ˜¯ ALL ç±»å‹æŸ¥è¯¢ï¼Œ é‚£ä¹ˆä¸€èˆ¬æ¥è¯´å¯ä»¥å¯¹ç›¸åº”çš„å­—æ®µæ·»åŠ ç´¢å¼•æ¥é¿å….<br>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¨è¡¨æ‰«æçš„ä¾‹å­ï¼Œ å¯ä»¥çœ‹åˆ°ï¼Œ åœ¨å…¨è¡¨æ‰«ææ—¶ï¼Œ possible_keys å’Œ key å­—æ®µéƒ½æ˜¯ NULL, è¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œ å¹¶ä¸” rows ååˆ†å·¨å¤§ï¼Œ å› æ­¤æ•´ä¸ªæŸ¥è¯¢æ•ˆç‡æ˜¯ååˆ†ä½ä¸‹çš„.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT age FROM  user_info WHERE age &#x3D; 20;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/iEmjy4GMAHsJz5w.png" alt="Screen Shot 2020-09-09 at 9.08.56 AM"></p><h4 id="type-ç±»å‹çš„æ€§èƒ½æ¯”è¾ƒ"><a href="#type-ç±»å‹çš„æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="type ç±»å‹çš„æ€§èƒ½æ¯”è¾ƒ"></a>type ç±»å‹çš„æ€§èƒ½æ¯”è¾ƒ</h4><p>é€šå¸¸æ¥è¯´ï¼Œ ä¸åŒçš„ type ç±»å‹çš„æ€§èƒ½å…³ç³»å¦‚ä¸‹:<br><code>ALL &lt; index &lt; range ~ index_merge &lt; ref &lt; eq_ref &lt; const &lt; system</code><br><code>ALL</code> ç±»å‹å› ä¸ºæ˜¯å…¨è¡¨æ‰«æï¼Œ å› æ­¤åœ¨ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶ä¸‹ï¼Œ å®ƒæ˜¯é€Ÿåº¦æœ€æ…¢çš„.<br>è€Œ <code>index</code> ç±»å‹çš„æŸ¥è¯¢è™½ç„¶ä¸æ˜¯å…¨è¡¨æ‰«æï¼Œ ä½†æ˜¯å®ƒæ‰«æäº†æ‰€æœ‰çš„ç´¢å¼•ï¼Œ å› æ­¤æ¯” ALL ç±»å‹çš„ç¨å¿«.<br>åé¢çš„å‡ ç§ç±»å‹éƒ½æ˜¯åˆ©ç”¨äº†ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®ï¼Œ å› æ­¤å¯ä»¥è¿‡æ»¤éƒ¨åˆ†æˆ–å¤§éƒ¨åˆ†æ•°æ®ï¼Œ å› æ­¤æŸ¥è¯¢æ•ˆç‡å°±æ¯”è¾ƒé«˜äº†.</p><h3 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h3><p><code>possible_keys</code> è¡¨ç¤º MySQL åœ¨æŸ¥è¯¢æ—¶ï¼Œ èƒ½å¤Ÿä½¿ç”¨åˆ°çš„ç´¢å¼•. æ³¨æ„ï¼Œ å³ä½¿æœ‰äº›ç´¢å¼•åœ¨ <code>possible_keys</code> ä¸­å‡ºç°ï¼Œ ä½†æ˜¯å¹¶ä¸è¡¨ç¤ºæ­¤ç´¢å¼•ä¼šçœŸæ­£åœ°è¢« MySQL ä½¿ç”¨åˆ°. MySQL åœ¨æŸ¥è¯¢æ—¶å…·ä½“ä½¿ç”¨äº†å“ªäº›ç´¢å¼•ï¼Œ ç”± <code>key</code> å­—æ®µå†³å®š.</p><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>æ­¤å­—æ®µæ˜¯ MySQL åœ¨å½“å‰æŸ¥è¯¢æ—¶æ‰€çœŸæ­£ä½¿ç”¨åˆ°çš„ç´¢å¼•.</p><h3 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h3><p>è¡¨ç¤ºæŸ¥è¯¢ä¼˜åŒ–å™¨ä½¿ç”¨äº†ç´¢å¼•çš„å­—èŠ‚æ•°. è¿™ä¸ªå­—æ®µå¯ä»¥è¯„ä¼°ç»„åˆç´¢å¼•æ˜¯å¦å®Œå…¨è¢«ä½¿ç”¨ï¼Œ æˆ–åªæœ‰æœ€å·¦éƒ¨åˆ†å­—æ®µè¢«ä½¿ç”¨åˆ°.<br>key_len çš„è®¡ç®—è§„åˆ™å¦‚ä¸‹:</p><ul><li>å­—ç¬¦ä¸²<ul><li>char(n): n å­—èŠ‚é•¿åº¦</li><li>varchar(n): å¦‚æœæ˜¯ utf8 ç¼–ç ï¼Œ åˆ™æ˜¯ 3 <em>n + 2å­—èŠ‚; å¦‚æœæ˜¯ utf8mb4 ç¼–ç ï¼Œ åˆ™æ˜¯ 4</em> n + 2 å­—èŠ‚.</li></ul></li><li>æ•°å€¼ç±»å‹:<ul><li>TINYINT: 1å­—èŠ‚</li><li>SMALLINT: 2å­—èŠ‚</li><li>MEDIUMINT: 3å­—èŠ‚</li><li>INT: 4å­—èŠ‚</li><li>BIGINT: 8å­—èŠ‚</li></ul></li><li>æ—¶é—´ç±»å‹<ul><li>DATE: 3å­—èŠ‚</li><li>TIMESTAMP: 4å­—èŠ‚</li><li>DATETIME: 8å­—èŠ‚</li></ul></li><li>å­—æ®µå±æ€§: NULL å±æ€§ å ç”¨ä¸€ä¸ªå­—èŠ‚. å¦‚æœä¸€ä¸ªå­—æ®µæ˜¯ NOT NULL çš„ï¼Œ åˆ™æ²¡æœ‰æ­¤å±æ€§.</li></ul><p>æˆ‘ä»¬æ¥ä¸¾ä¸¤ä¸ªç®€å•çš„æ —å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM order_info WHERE user_id &lt; 3 AND product_name &#x3D; &#39;p1&#39; AND productor &#x3D; &#39;WHH&#39;;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­æ˜¯ä»è¡¨ order_info ä¸­æŸ¥è¯¢æŒ‡å®šçš„å†…å®¹ï¼Œ è€Œæˆ‘ä»¬ä»æ­¤è¡¨çš„å»ºè¡¨è¯­å¥ä¸­å¯ä»¥çŸ¥é“ï¼Œ è¡¨ <code>order_info</code> æœ‰ä¸€ä¸ªè”åˆç´¢å¼•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEY &#96;user_product_detail_index&#96; (&#96;user_id&#96;ï¼Œ &#96;product_name&#96;ï¼Œ &#96;productor&#96;)</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æ­¤æŸ¥è¯¢è¯­å¥ <code>WHERE user_id &lt; 3 AND product_name = &#39;p1&#39; AND productor = &#39;WHH&#39;</code> ä¸­ï¼Œ å› ä¸ºå…ˆè¿›è¡Œ user_id çš„èŒƒå›´æŸ¥è¯¢ï¼Œ è€Œæ ¹æ® <code>æœ€å·¦å‰ç¼€åŒ¹é…</code> åŸåˆ™ï¼Œ å½“é‡åˆ°èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œ å°±åœæ­¢ç´¢å¼•çš„åŒ¹é…ï¼Œ å› æ­¤å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨åˆ°çš„ç´¢å¼•çš„å­—æ®µåªæœ‰ <code>user_id</code>ï¼Œ å› æ­¤åœ¨ <code>EXPLAIN</code> ä¸­ï¼Œ æ˜¾ç¤ºçš„ key_len ä¸º 9. å› ä¸º user_id å­—æ®µæ˜¯ BIGINT, å ç”¨ 8 å­—èŠ‚ï¼Œ è€Œ NULL å±æ€§å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œ å› æ­¤æ€»å…±æ˜¯ 9 ä¸ªå­—èŠ‚. è‹¥æˆ‘ä»¬å°†user_id å­—æ®µæ”¹ä¸º <code>BIGINT(20) NOT NULL DEFAULT &#39;0&#39;</code>ï¼Œ åˆ™ key_length åº”è¯¥æ˜¯8.</p><p>ä¸Šé¢å› ä¸º <code>æœ€å·¦å‰ç¼€åŒ¹é…</code> åŸåˆ™ï¼Œ æˆ‘ä»¬çš„æŸ¥è¯¢ä»…ä»…ä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•çš„ <code>user_id</code> å­—æ®µï¼Œ å› æ­¤æ•ˆç‡ä¸ç®—é«˜.</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹ä¸€ä¸ªä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM order_info WHERE user_id &#x3D; 1 AND product_name &#x3D; &#39;p1&#39;;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡çš„æŸ¥è¯¢ä¸­ï¼Œ æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ°èŒƒå›´æŸ¥è¯¢ï¼Œ key_len çš„å€¼ä¸º 161. ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢æ¡ä»¶ <code>WHERE user_id = 1 AND product_name = &#39;p1&#39;</code> ä¸­ï¼Œ ä»…ä»…ä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ä¸­çš„å‰ä¸¤ä¸ªå­—æ®µï¼Œ å› æ­¤ <code>keyLen(user_id) + keyLen(product_name) = 9 + 50 * 3 + 2 = 161</code></p><h3 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h3><p>rows ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„å­—æ®µ. MySQL æŸ¥è¯¢ä¼˜åŒ–å™¨æ ¹æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œ ä¼°ç®— SQL è¦æŸ¥æ‰¾åˆ°ç»“æœé›†éœ€è¦æ‰«æè¯»å–çš„æ•°æ®è¡Œæ•°.<br>è¿™ä¸ªå€¼éå¸¸ç›´è§‚æ˜¾ç¤º SQL çš„æ•ˆç‡å¥½åï¼Œ åŸåˆ™ä¸Š rows è¶Šå°‘è¶Šå¥½.</p><h3 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h3><p>Explain ä¸­çš„å¾ˆå¤šé¢å¤–çš„ä¿¡æ¯ä¼šåœ¨ Extra å­—æ®µæ˜¾ç¤ºï¼Œ å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§å†…å®¹:</p><ul><li>Using filesort<br>å½“ Extra ä¸­æœ‰ <code>Using filesort</code> æ—¶ï¼Œ è¡¨ç¤º MySQL éœ€é¢å¤–çš„æ’åºæ“ä½œï¼Œ ä¸èƒ½é€šè¿‡ç´¢å¼•é¡ºåºè¾¾åˆ°æ’åºæ•ˆæœ. ä¸€èˆ¬æœ‰ <code>Using filesort</code>ï¼Œ éƒ½å»ºè®®ä¼˜åŒ–å»æ‰ï¼Œ å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢ CPU èµ„æºæ¶ˆè€—å¤§.</li></ul><p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM order_info ORDER BY product_name;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/09/BxhONjolU8nLe1t.png" alt="Screen Shot 2020-09-09 at 9.11.24 AM"></p><p>æˆ‘ä»¬çš„ç´¢å¼•æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEY &#96;user_product_detail_index&#96; (&#96;user_id&#96;ï¼Œ &#96;product_name&#96;ï¼Œ &#96;productor&#96;)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸Šé¢çš„æŸ¥è¯¢ä¸­æ ¹æ® <code>product_name</code> æ¥æ’åºï¼Œ å› æ­¤ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼Œ è¿›è€Œä¼šäº§ç”Ÿ <code>Using filesort</code>.<br>å¦‚æœæˆ‘ä»¬å°†æ’åºä¾æ®æ”¹ä¸º <code>ORDER BY user_id, product_name</code>ï¼Œ é‚£ä¹ˆå°±ä¸ä¼šå‡ºç° <code>Using filesort</code> äº†. ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM order_info ORDER BY user_id, product_name;</span><br></pre></td></tr></table></figure><ul><li>Using index<br>â€œè¦†ç›–ç´¢å¼•æ‰«æâ€ï¼Œ è¡¨ç¤ºæŸ¥è¯¢åœ¨ç´¢å¼•æ ‘ä¸­å°±å¯æŸ¥æ‰¾æ‰€éœ€æ•°æ®ï¼Œ ä¸ç”¨æ‰«æè¡¨æ•°æ®æ–‡ä»¶ï¼Œ å¾€å¾€è¯´æ˜æ€§èƒ½ä¸é”™</li><li>Using temporary<br>æŸ¥è¯¢æœ‰ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œ ä¸€èˆ¬å‡ºç°äºæ’åºï¼Œ åˆ†ç»„å’Œå¤šè¡¨ join çš„æƒ…å†µï¼Œ æŸ¥è¯¢æ•ˆç‡ä¸é«˜ï¼Œ å»ºè®®ä¼˜åŒ–.</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptçš„äº‹ä»¶æ¨¡å‹</title>
      <link href="/2016/12/03/javascript/JavaScript%E4%B9%8B%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B/"/>
      <url>/2016/12/03/javascript/JavaScript%E4%B9%8B%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›‘å¬å‡½æ•°"><a href="#ç›‘å¬å‡½æ•°" class="headerlink" title="ç›‘å¬å‡½æ•°"></a>ç›‘å¬å‡½æ•°</h2><p>æµè§ˆå™¨çš„äº‹ä»¶æ¨¡å‹ï¼Œå°±æ˜¯é€šè¿‡ç›‘å¬å‡½æ•°ï¼ˆlistenerï¼‰å¯¹äº‹ä»¶åšå‡ºååº”ã€‚äº‹ä»¶å‘ç”Ÿåï¼Œæµè§ˆå™¨ç›‘å¬åˆ°äº†è¿™ä¸ªäº‹ä»¶ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„ç›‘å¬å‡½æ•°ã€‚è¿™æ˜¯äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å¼ï¼ˆevent-drivenï¼‰çš„ä¸»è¦ç¼–ç¨‹æ–¹å¼ã€‚</p><p>JavaScriptæœ‰ä¸‰ç§æ–¹æ³•ï¼Œå¯ä»¥ä¸ºäº‹ä»¶ç»‘å®šç›‘å¬å‡½æ•°ã€‚</p><h3 id="HTML-çš„-on-å±æ€§"><a href="#HTML-çš„-on-å±æ€§" class="headerlink" title="HTML çš„ on- å±æ€§"></a>HTML çš„ on- å±æ€§</h3><p>HTML è¯­è¨€å…è®¸åœ¨å…ƒç´ çš„å±æ€§ä¸­ï¼Œç›´æ¥å®šä¹‰æŸäº›äº‹ä»¶çš„ç›‘å¬ä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;doSomething()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">&quot;console.log(&#x27;è§¦å‘äº‹ä»¶&#x27;)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸º<code>body</code>èŠ‚ç‚¹çš„<code>load</code>äº‹ä»¶ã€<code>div</code>èŠ‚ç‚¹çš„<code>click</code>äº‹ä»¶ï¼ŒæŒ‡å®šäº†ç›‘å¬ä»£ç ã€‚ä¸€æ—¦äº‹ä»¶å‘ç”Ÿï¼Œå°±ä¼šæ‰§è¡Œè¿™æ®µä»£ç ã€‚</p><p>å…ƒç´ çš„äº‹ä»¶ç›‘å¬å±æ€§ï¼Œéƒ½æ˜¯<code>on</code>åŠ ä¸Šäº‹ä»¶åï¼Œæ¯”å¦‚<code>onload</code>å°±æ˜¯<code>on + load</code>ï¼Œè¡¨ç¤º<code>load</code>äº‹ä»¶çš„ç›‘å¬ä»£ç ã€‚</p><p>æ³¨æ„ï¼Œè¿™äº›å±æ€§çš„å€¼æ˜¯å°†ä¼šæ‰§è¡Œçš„ä»£ç ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ­£ç¡® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;doSomething()&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é”™è¯¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æŒ‡å®šçš„äº‹ä»¶å‘ç”Ÿï¼Œ<code>on-</code>å±æ€§çš„å€¼æ˜¯åŸæ ·ä¼ å…¥ JavaScriptå¼•æ“æ‰§è¡Œã€‚å› æ­¤å¦‚æœè¦æ‰§è¡Œå‡½æ•°ï¼Œä¸è¦å¿˜è®°åŠ ä¸Šä¸€å¯¹åœ†æ‹¬å·ã€‚</p><p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æŒ‡å®šçš„ç›‘å¬ä»£ç ï¼Œåªä¼šåœ¨å†’æ³¡é˜¶æ®µè§¦å‘ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&quot;console.log(2)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&quot;console.log(1)&quot;</span>&gt;</span>ç‚¹å‡»<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>&lt;button&gt;</code>æ˜¯<code>&lt;div&gt;</code>çš„å­å…ƒç´ ã€‚<code>&lt;button&gt;</code>çš„<code>click</code>äº‹ä»¶ï¼Œä¹Ÿä¼šè§¦å‘<code>&lt;div&gt;</code>çš„<code>click</code>äº‹ä»¶ã€‚ç”±äº<code>on-</code>å±æ€§çš„ç›‘å¬ä»£ç ï¼Œåªåœ¨å†’æ³¡é˜¶æ®µè§¦å‘ï¼Œæ‰€ä»¥ç‚¹å‡»ç»“æœæ˜¯å…ˆè¾“å‡º<code>1</code>ï¼Œå†è¾“å‡º<code>2</code>ï¼Œå³äº‹ä»¶ä»å­å…ƒç´ å¼€å§‹å†’æ³¡åˆ°çˆ¶å…ƒç´ ã€‚</p><p>ç›´æ¥è®¾ç½®<code>on-</code>å±æ€§ï¼Œä¸é€šè¿‡å…ƒç´ èŠ‚ç‚¹çš„<code>setAttribute</code>æ–¹æ³•è®¾ç½®<code>on-</code>å±æ€§ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">el.setAttribute(<span class="string">&#x27;onclick&#x27;</span>, <span class="string">&#x27;doSomething()&#x27;</span>);</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="comment">// &lt;Element onclick=&quot;doSomething()&quot;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å…ƒç´ èŠ‚ç‚¹çš„äº‹ä»¶å±æ€§"><a href="#å…ƒç´ èŠ‚ç‚¹çš„äº‹ä»¶å±æ€§" class="headerlink" title="å…ƒç´ èŠ‚ç‚¹çš„äº‹ä»¶å±æ€§"></a>å…ƒç´ èŠ‚ç‚¹çš„äº‹ä»¶å±æ€§</h3><p>å…ƒç´ èŠ‚ç‚¹å¯¹è±¡çš„äº‹ä»¶å±æ€§ï¼ŒåŒæ ·å¯ä»¥æŒ‡å®šç›‘å¬å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = doSomething;</span><br><span class="line"></span><br><span class="line">div.onclick = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;è§¦å‘äº‹ä»¶&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æŒ‡å®šçš„ç›‘å¬å‡½æ•°ï¼Œä¹Ÿæ˜¯åªä¼šåœ¨å†’æ³¡é˜¶æ®µè§¦å‘ã€‚</p><p>æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•ä¸ HTML çš„<code>on-</code>å±æ€§çš„å·®å¼‚æ˜¯ï¼Œå®ƒçš„å€¼æ˜¯å‡½æ•°åï¼ˆ<code>doSomething</code>ï¼‰ï¼Œè€Œä¸åƒåè€…ï¼Œå¿…é¡»ç»™å‡ºå®Œæ•´çš„ç›‘å¬ä»£ç ï¼ˆ<code>doSomething()</code>ï¼‰ã€‚</p><h3 id="EventTarget-addEventListener"><a href="#EventTarget-addEventListener" class="headerlink" title="EventTarget.addEventListener()"></a>EventTarget.addEventListener()</h3><p>æ‰€æœ‰ DOM èŠ‚ç‚¹å®ä¾‹éƒ½æœ‰<code>addEventListener</code>æ–¹æ³•ï¼Œç”¨æ¥ä¸ºè¯¥èŠ‚ç‚¹å®šä¹‰äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, doSomething, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p><code>addEventListener</code>æ–¹æ³•çš„è¯¦ç»†ä»‹ç»ï¼Œå‚è§<code>EventTarget</code>ç« èŠ‚ã€‚</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä¸Šé¢ä¸‰ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§â€œHTML çš„ on- å±æ€§â€ï¼Œè¿åäº† HTML ä¸ JavaScriptä»£ç ç›¸åˆ†ç¦»çš„åŸåˆ™ï¼Œå°†ä¸¤è€…å†™åœ¨ä¸€èµ·ï¼Œä¸åˆ©äºä»£ç åˆ†å·¥ï¼Œå› æ­¤ä¸æ¨èä½¿ç”¨ã€‚</p><p>ç¬¬äºŒç§â€œå…ƒç´ èŠ‚ç‚¹çš„äº‹ä»¶å±æ€§â€çš„ç¼ºç‚¹åœ¨äºï¼ŒåŒä¸€ä¸ªäº‹ä»¶åªèƒ½å®šä¹‰ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå®šä¹‰ä¸¤æ¬¡<code>onclick</code>å±æ€§ï¼Œåä¸€æ¬¡å®šä¹‰ä¼šè¦†ç›–å‰ä¸€æ¬¡ã€‚å› æ­¤ï¼Œä¹Ÿä¸æ¨èä½¿ç”¨ã€‚</p><p>ç¬¬ä¸‰ç§<code>EventTarget.addEventListener</code>æ˜¯æ¨èçš„æŒ‡å®šç›‘å¬å‡½æ•°çš„æ–¹æ³•ã€‚å®ƒæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>åŒä¸€ä¸ªäº‹ä»¶å¯ä»¥æ·»åŠ å¤šä¸ªç›‘å¬å‡½æ•°ã€‚</li><li>èƒ½å¤ŸæŒ‡å®šåœ¨å“ªä¸ªé˜¶æ®µï¼ˆæ•è·é˜¶æ®µè¿˜æ˜¯å†’æ³¡é˜¶æ®µï¼‰è§¦å‘ç›‘å¬å‡½æ•°ã€‚</li><li>é™¤äº† DOM èŠ‚ç‚¹ï¼Œå…¶ä»–å¯¹è±¡ï¼ˆæ¯”å¦‚<code>window</code>ã€<code>XMLHttpRequest</code>ç­‰ï¼‰ä¹Ÿæœ‰è¿™ä¸ªæ¥å£ï¼Œå®ƒç­‰äºæ˜¯æ•´ä¸ª JavaScriptç»Ÿä¸€çš„ç›‘å¬å‡½æ•°æ¥å£ã€‚</li></ul><h2 id="this-çš„æŒ‡å‘"><a href="#this-çš„æŒ‡å‘" class="headerlink" title="this çš„æŒ‡å‘"></a>this çš„æŒ‡å‘</h2><p>ç›‘å¬å‡½æ•°å†…éƒ¨çš„<code>this</code>æŒ‡å‘è§¦å‘äº‹ä»¶çš„é‚£ä¸ªå…ƒç´ èŠ‚ç‚¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=<span class="string">&quot;btn&quot;</span> onclick=<span class="string">&quot;console.log(this.id)&quot;</span>&gt;ç‚¹å‡»&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢ä»£ç ï¼Œç‚¹å‡»åä¼šè¾“å‡º<code>btn</code>ã€‚</p><p>å…¶ä»–ä¸¤ç§ç›‘å¬å‡½æ•°çš„å†™æ³•ï¼Œ<code>this</code>çš„æŒ‡å‘ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTML ä»£ç å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">// &lt;button id=&quot;btn&quot;&gt;ç‚¹å‡»&lt;/button&gt;</span></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•ä¸€</span></span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•äºŒ</span></span><br><span class="line">btn.addEventListener(</span><br><span class="line">  <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.id);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ç§å†™æ³•ï¼Œç‚¹å‡»æŒ‰é’®ä»¥åä¹Ÿæ˜¯è¾“å‡º<code>btn</code>ã€‚</p><h2 id="äº‹ä»¶çš„ä¼ æ’­"><a href="#äº‹ä»¶çš„ä¼ æ’­" class="headerlink" title="äº‹ä»¶çš„ä¼ æ’­"></a>äº‹ä»¶çš„ä¼ æ’­</h2><p>ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåï¼Œä¼šåœ¨å­å…ƒç´ å’Œçˆ¶å…ƒç´ ä¹‹é—´ä¼ æ’­ï¼ˆpropagationï¼‰ã€‚è¿™ç§ä¼ æ’­åˆ†æˆä¸‰ä¸ªé˜¶æ®µã€‚</p><ul><li><strong>ç¬¬ä¸€é˜¶æ®µ</strong>ï¼šä»<code>window</code>å¯¹è±¡ä¼ å¯¼åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼ˆä¸Šå±‚ä¼ åˆ°åº•å±‚ï¼‰ï¼Œç§°ä¸ºâ€œæ•è·é˜¶æ®µâ€ï¼ˆcapture phaseï¼‰ã€‚</li><li><strong>ç¬¬äºŒé˜¶æ®µ</strong>ï¼šåœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šè§¦å‘ï¼Œç§°ä¸ºâ€œç›®æ ‡é˜¶æ®µâ€ï¼ˆtarget phaseï¼‰ã€‚</li><li><strong>ç¬¬ä¸‰é˜¶æ®µ</strong>ï¼šä»ç›®æ ‡èŠ‚ç‚¹ä¼ å¯¼å›<code>window</code>å¯¹è±¡ï¼ˆä»åº•å±‚ä¼ å›ä¸Šå±‚ï¼‰ï¼Œç§°ä¸ºâ€œå†’æ³¡é˜¶æ®µâ€ï¼ˆbubbling phaseï¼‰ã€‚</li></ul><p>è¿™ç§ä¸‰é˜¶æ®µçš„ä¼ æ’­æ¨¡å‹ï¼Œä½¿å¾—åŒä¸€ä¸ªäº‹ä»¶ä¼šåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè§¦å‘ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>ç‚¹å‡»<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>&lt;div&gt;</code>èŠ‚ç‚¹ä¹‹ä¸­æœ‰ä¸€ä¸ª<code>&lt;p&gt;</code>èŠ‚ç‚¹ã€‚</p><p>å¦‚æœå¯¹è¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œéƒ½è®¾ç½®<code>click</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹çš„æ•è·é˜¶æ®µå’Œç›‘å¬é˜¶æ®µï¼Œå„è®¾ç½®ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼‰ï¼Œå…±è®¡è®¾ç½®å››ä¸ªç›‘å¬å‡½æ•°ã€‚ç„¶åï¼Œå¯¹<code>&lt;p&gt;</code>ç‚¹å‡»ï¼Œ<code>click</code>äº‹ä»¶ä¼šè§¦å‘å››æ¬¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> phases = &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="string">&#x27;capture&#x27;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&#x27;target&#x27;</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">&#x27;bubble&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> p = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line"></span><br><span class="line">div.addEventListener(<span class="string">&#x27;click&#x27;</span>, callback, <span class="literal">true</span>);</span><br><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, callback, <span class="literal">true</span>);</span><br><span class="line">div.addEventListener(<span class="string">&#x27;click&#x27;</span>, callback, <span class="literal">false</span>);</span><br><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, callback, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tag = event.currentTarget.tagName;</span><br><span class="line">  <span class="keyword">var</span> phase = phases[event.eventPhase];</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Tag: &#x27;&quot;</span> + tag + <span class="string">&quot;&#x27;. EventPhase: &#x27;&quot;</span> + phase + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‚¹å‡»ä»¥åçš„ç»“æœ</span></span><br><span class="line"><span class="comment">// Tag: &#x27;DIV&#x27;. EventPhase: &#x27;capture&#x27;</span></span><br><span class="line"><span class="comment">// Tag: &#x27;P&#x27;. EventPhase: &#x27;target&#x27;</span></span><br><span class="line"><span class="comment">// Tag: &#x27;P&#x27;. EventPhase: &#x27;target&#x27;</span></span><br><span class="line"><span class="comment">// Tag: &#x27;DIV&#x27;. EventPhase: &#x27;bubble&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œ<code>click</code>äº‹ä»¶è¢«è§¦å‘äº†å››æ¬¡ï¼š<code>&lt;div&gt;</code>èŠ‚ç‚¹çš„æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µå„1æ¬¡ï¼Œ<code>&lt;p&gt;</code>èŠ‚ç‚¹çš„ç›®æ ‡é˜¶æ®µè§¦å‘äº†2æ¬¡ã€‚</p><ol><li>æ•è·é˜¶æ®µï¼šäº‹ä»¶ä»<code>&lt;div&gt;</code>å‘<code>&lt;p&gt;</code>ä¼ æ’­æ—¶ï¼Œè§¦å‘<code>&lt;div&gt;</code>çš„<code>click</code>äº‹ä»¶ï¼›</li><li>ç›®æ ‡é˜¶æ®µï¼šäº‹ä»¶ä»<code>&lt;div&gt;</code>åˆ°è¾¾<code>&lt;p&gt;</code>æ—¶ï¼Œè§¦å‘<code>&lt;p&gt;</code>çš„<code>click</code>äº‹ä»¶ï¼›</li><li>å†’æ³¡é˜¶æ®µï¼šäº‹ä»¶ä»<code>&lt;p&gt;</code>ä¼ å›<code>&lt;div&gt;</code>æ—¶ï¼Œå†æ¬¡è§¦å‘<code>&lt;div&gt;</code>çš„<code>click</code>äº‹ä»¶ã€‚</li></ol><p>å…¶ä¸­ï¼Œ<code>&lt;p&gt;</code>èŠ‚ç‚¹æœ‰ä¸¤ä¸ªç›‘å¬å‡½æ•°ï¼ˆ<code>addEventListener</code>æ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°çš„ä¸åŒï¼Œä¼šå¯¼è‡´ç»‘å®šä¸¤ä¸ªç›‘å¬å‡½æ•°ï¼‰ï¼Œå› æ­¤å®ƒä»¬éƒ½ä¼šå› ä¸º<code>click</code>äº‹ä»¶è§¦å‘ä¸€æ¬¡ã€‚æ‰€ä»¥ï¼Œ<code>&lt;p&gt;</code>ä¼šåœ¨<code>target</code>é˜¶æ®µæœ‰ä¸¤æ¬¡è¾“å‡ºã€‚</p><p>æ³¨æ„ï¼Œæµè§ˆå™¨æ€»æ˜¯å‡å®š<code>click</code>äº‹ä»¶çš„ç›®æ ‡èŠ‚ç‚¹ï¼Œå°±æ˜¯ç‚¹å‡»ä½ç½®åµŒå¥—æœ€æ·±çš„é‚£ä¸ªèŠ‚ç‚¹ï¼ˆæœ¬ä¾‹æ˜¯<code>&lt;div&gt;</code>èŠ‚ç‚¹é‡Œé¢çš„<code>&lt;p&gt;</code>èŠ‚ç‚¹ï¼‰ã€‚æ‰€ä»¥ï¼Œ<code>&lt;p&gt;</code>èŠ‚ç‚¹çš„æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µï¼Œéƒ½ä¼šæ˜¾ç¤ºä¸º<code>target</code>é˜¶æ®µã€‚</p><p>äº‹ä»¶ä¼ æ’­çš„æœ€ä¸Šå±‚å¯¹è±¡æ˜¯<code>window</code>ï¼Œæ¥ç€ä¾æ¬¡æ˜¯<code>document</code>ï¼Œ<code>html</code>ï¼ˆ<code>document.documentElement</code>ï¼‰å’Œ<code>body</code>ï¼ˆ<code>document.body</code>ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šä¾‹çš„äº‹ä»¶ä¼ æ’­é¡ºåºï¼Œåœ¨æ•è·é˜¶æ®µä¾æ¬¡ä¸º<code>window</code>ã€<code>document</code>ã€<code>html</code>ã€<code>body</code>ã€<code>div</code>ã€<code>p</code>ï¼Œåœ¨å†’æ³¡é˜¶æ®µä¾æ¬¡ä¸º<code>p</code>ã€<code>div</code>ã€<code>body</code>ã€<code>html</code>ã€<code>document</code>ã€<code>window</code>ã€‚</p><h2 id="äº‹ä»¶çš„ä»£ç†"><a href="#äº‹ä»¶çš„ä»£ç†" class="headerlink" title="äº‹ä»¶çš„ä»£ç†"></a>äº‹ä»¶çš„ä»£ç†</h2><p>ç”±äºäº‹ä»¶ä¼šåœ¨å†’æ³¡é˜¶æ®µå‘ä¸Šä¼ æ’­åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå› æ­¤å¯ä»¥æŠŠå­èŠ‚ç‚¹çš„ç›‘å¬å‡½æ•°å®šä¹‰åœ¨çˆ¶èŠ‚ç‚¹ä¸Šï¼Œç”±çˆ¶èŠ‚ç‚¹çš„ç›‘å¬å‡½æ•°ç»Ÿä¸€å¤„ç†å¤šä¸ªå­å…ƒç´ çš„äº‹ä»¶ã€‚è¿™ç§æ–¹æ³•å«åšäº‹ä»¶çš„ä»£ç†ï¼ˆdelegationï¼‰ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ul.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event.target.tagName.toLowerCase() === <span class="string">&#x27;li&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>click</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°å®šä¹‰åœ¨<code>&lt;ul&gt;</code>èŠ‚ç‚¹ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå®ƒå¤„ç†çš„æ˜¯å­èŠ‚ç‚¹<code>&lt;li&gt;</code>çš„<code>click</code>äº‹ä»¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåªè¦å®šä¹‰ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œå°±èƒ½å¤„ç†å¤šä¸ªå­èŠ‚ç‚¹çš„äº‹ä»¶ï¼Œè€Œä¸ç”¨åœ¨æ¯ä¸ª<code>&lt;li&gt;</code>èŠ‚ç‚¹ä¸Šå®šä¹‰ç›‘å¬å‡½æ•°ã€‚è€Œä¸”ä»¥åå†æ·»åŠ å­èŠ‚ç‚¹ï¼Œç›‘å¬å‡½æ•°ä¾ç„¶æœ‰æ•ˆã€‚</p><p>å¦‚æœå¸Œæœ›äº‹ä»¶åˆ°æŸä¸ªèŠ‚ç‚¹ä¸ºæ­¢ï¼Œä¸å†ä¼ æ’­ï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶å¯¹è±¡çš„<code>stopPropagation</code>æ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äº‹ä»¶ä¼ æ’­åˆ° p å…ƒç´ åï¼Œå°±ä¸å†å‘ä¸‹ä¼ æ’­äº†</span></span><br><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.stopPropagation();</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹ä»¶å†’æ³¡åˆ° p å…ƒç´ åï¼Œå°±ä¸å†å‘ä¸Šå†’æ³¡äº†</span></span><br><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.stopPropagation();</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>stopPropagation</code>æ–¹æ³•åˆ†åˆ«åœ¨æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µï¼Œé˜»æ­¢äº†äº‹ä»¶çš„ä¼ æ’­ã€‚</p><p>ä½†æ˜¯ï¼Œ<code>stopPropagation</code>æ–¹æ³•åªä¼šé˜»æ­¢äº‹ä»¶çš„ä¼ æ’­ï¼Œä¸ä¼šé˜»æ­¢è¯¥äº‹ä»¶è§¦å‘<code>&lt;p&gt;</code>èŠ‚ç‚¹çš„å…¶ä»–<code>click</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯å½»åº•å–æ¶ˆ<code>click</code>äº‹ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.stopPropagation();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¼šè§¦å‘</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>p</code>å…ƒç´ ç»‘å®šäº†ä¸¤ä¸ª<code>click</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚<code>stopPropagation</code>æ–¹æ³•åªèƒ½é˜»æ­¢è¿™ä¸ªäº‹ä»¶çš„ä¼ æ’­ï¼Œä¸èƒ½å–æ¶ˆè¿™ä¸ªäº‹ä»¶ï¼Œå› æ­¤ï¼Œç¬¬äºŒä¸ªç›‘å¬å‡½æ•°ä¼šè§¦å‘ã€‚è¾“å‡ºç»“æœä¼šå…ˆæ˜¯1ï¼Œç„¶åæ˜¯2ã€‚</p><p>å¦‚æœæƒ³è¦å½»åº•å–æ¶ˆè¯¥äº‹ä»¶ï¼Œä¸å†è§¦å‘åé¢æ‰€æœ‰<code>click</code>çš„ç›‘å¬å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>stopImmediatePropagation</code>æ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.stopImmediatePropagation();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸ä¼šè¢«è§¦å‘</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>stopImmediatePropagation</code>æ–¹æ³•å¯ä»¥å½»åº•å–æ¶ˆè¿™ä¸ªäº‹ä»¶ï¼Œä½¿å¾—åé¢ç»‘å®šçš„æ‰€æœ‰<code>click</code>ç›‘å¬å‡½æ•°éƒ½ä¸å†è§¦å‘ã€‚æ‰€ä»¥ï¼Œåªä¼šè¾“å‡º1ï¼Œä¸ä¼šè¾“å‡º2ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaçº¿ä¸ŠCPUã€ç£ç›˜ã€å†…å­˜ã€ç½‘ç»œæ’éšœæŒ‡å—</title>
      <link href="/2016/11/15/java/Java%E7%BA%BF%E4%B8%8ACPU%E3%80%81%E7%A3%81%E7%9B%98%E3%80%81%E5%86%85%E5%AD%98%E3%80%81%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"/>
      <url>/2016/11/15/java/Java%E7%BA%BF%E4%B8%8ACPU%E3%80%81%E7%A3%81%E7%9B%98%E3%80%81%E5%86%85%E5%AD%98%E3%80%81%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>çº¿ä¸Šæ•…éšœä¸»è¦ä¼šåŒ…æ‹¬cpuã€ç£ç›˜ã€å†…å­˜ä»¥åŠç½‘ç»œé—®é¢˜ï¼Œè€Œå¤§å¤šæ•°æ•…éšœå¯èƒ½ä¼šåŒ…å«ä¸æ­¢ä¸€ä¸ªå±‚é¢çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿›è¡Œæ’æŸ¥æ—¶å€™å°½é‡å››ä¸ªæ–¹é¢ä¾æ¬¡æ’æŸ¥ä¸€éã€‚åŒæ—¶ä¾‹å¦‚jstackã€jmapç­‰å·¥å…·ä¹Ÿæ˜¯ä¸å›¿äºä¸€ä¸ªæ–¹é¢çš„é—®é¢˜çš„ï¼ŒåŸºæœ¬ä¸Šå‡ºé—®é¢˜å°±æ˜¯dfã€freeã€top ä¸‰è¿ï¼Œç„¶åä¾æ¬¡jstackã€jmapä¼ºå€™ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æå³å¯ã€‚</p><a id="more"></a><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>ä¸€èˆ¬æ¥è®²æˆ‘ä»¬é¦–å…ˆä¼šæ’æŸ¥cpuæ–¹é¢çš„é—®é¢˜ã€‚cpuå¼‚å¸¸å¾€å¾€è¿˜æ˜¯æ¯”è¾ƒå¥½å®šä½çš„ã€‚åŸå› åŒ…æ‹¬ä¸šåŠ¡é€»è¾‘é—®é¢˜(æ­»å¾ªç¯)ã€é¢‘ç¹gcä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡å¤šã€‚è€Œæœ€å¸¸è§çš„å¾€å¾€æ˜¯ä¸šåŠ¡é€»è¾‘(æˆ–è€…æ¡†æ¶é€»è¾‘)å¯¼è‡´çš„ï¼Œå¯ä»¥ä½¿ç”¨jstackæ¥åˆ†æå¯¹åº”çš„å †æ ˆæƒ…å†µã€‚</p><h3 id="ä½¿ç”¨jstackåˆ†æcpué—®é¢˜"><a href="#ä½¿ç”¨jstackåˆ†æcpué—®é¢˜" class="headerlink" title="ä½¿ç”¨jstackåˆ†æcpué—®é¢˜"></a>ä½¿ç”¨jstackåˆ†æcpué—®é¢˜</h3><p>æˆ‘ä»¬å…ˆç”¨pså‘½ä»¤æ‰¾åˆ°å¯¹åº”è¿›ç¨‹çš„pid(å¦‚æœä½ æœ‰å¥½å‡ ä¸ªç›®æ ‡è¿›ç¨‹ï¼Œå¯ä»¥å…ˆç”¨topçœ‹ä¸€ä¸‹å“ªä¸ªå ç”¨æ¯”è¾ƒé«˜)ã€‚</p><p>æ¥ç€ç”¨<code>top -H -p pid</code>æ¥æ‰¾åˆ°cpuä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„ä¸€äº›çº¿ç¨‹</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/Psh2MYojnEFqHat.jpg" alt="img"></p><p>ç„¶åå°†å ç”¨æœ€é«˜çš„pidè½¬æ¢ä¸º16è¿›åˆ¶<code>printf &#39;%x\n&#39; pid</code>å¾—åˆ°nid</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/vYIU4RZnSDibXTE.png" alt="img"></p><p>æ¥ç€ç›´æ¥åœ¨jstackä¸­æ‰¾åˆ°ç›¸åº”çš„å †æ ˆä¿¡æ¯<code>jstack pid |grep &#39;nid&#39; -C5 â€“color</code></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/TdrKy4JzmGS38vQ.jpg" alt="img"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†nidä¸º0x42çš„å †æ ˆä¿¡æ¯ï¼Œæ¥ç€åªè¦ä»”ç»†åˆ†æä¸€ç•ªå³å¯ã€‚</p><p>å½“ç„¶æ›´å¸¸è§çš„æ˜¯æˆ‘ä»¬å¯¹æ•´ä¸ªjstackæ–‡ä»¶è¿›è¡Œåˆ†æï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæ¯”è¾ƒå…³æ³¨WAITINGå’ŒTIMED_WAITINGçš„éƒ¨åˆ†ï¼ŒBLOCKEDå°±ä¸ç”¨è¯´äº†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>cat jstack.log | grep &quot;java.lang.Thread.State&quot; | sort -nr | uniq -c</code>æ¥å¯¹jstackçš„çŠ¶æ€æœ‰ä¸€ä¸ªæ•´ä½“çš„æŠŠæ¡ï¼Œå¦‚æœWAITINGä¹‹ç±»çš„ç‰¹åˆ«å¤šï¼Œé‚£ä¹ˆå¤šåŠæ˜¯æœ‰é—®é¢˜å•¦ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/qvukawlV4ASCLYr.jpg" alt="img"></p><h3 id="é¢‘ç¹gc"><a href="#é¢‘ç¹gc" class="headerlink" title="é¢‘ç¹gc"></a>é¢‘ç¹gc</h3><p>å½“ç„¶æˆ‘ä»¬è¿˜æ˜¯ä¼šä½¿ç”¨jstackæ¥åˆ†æé—®é¢˜ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬å¯ä»¥å…ˆç¡®å®šä¸‹gcæ˜¯ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œä½¿ç”¨jstat -gc pid 1000å‘½ä»¤æ¥å¯¹gcåˆ†ä»£å˜åŒ–æƒ…å†µè¿›è¡Œè§‚å¯Ÿï¼Œ1000è¡¨ç¤ºé‡‡æ ·é—´éš”(ms)ï¼ŒS0C/S1Cã€S0U/S1Uã€EC/EUã€OC/OUã€MC/MUåˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªSurvivoråŒºã€EdenåŒºã€è€å¹´ä»£ã€å…ƒæ•°æ®åŒºçš„å®¹é‡å’Œä½¿ç”¨é‡ã€‚YGC/YGTã€FGC/FGCTã€GCTåˆ™ä»£è¡¨YoungGcã€FullGcçš„è€—æ—¶å’Œæ¬¡æ•°ä»¥åŠæ€»è€—æ—¶ã€‚å¦‚æœçœ‹åˆ°gcæ¯”è¾ƒé¢‘ç¹ï¼Œå†é’ˆå¯¹gcæ–¹é¢åšè¿›ä¸€æ­¥åˆ†æã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/qvukawlV4ASCLYr.jpg" alt="img"></p><h3 id="ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>é’ˆå¯¹é¢‘ç¹ä¸Šä¸‹æ–‡é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>vmstat</code>å‘½ä»¤æ¥è¿›è¡ŒæŸ¥çœ‹</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/21fEDaHF7IczjPT.jpg" alt="img"></p><p>cs(context switch)ä¸€åˆ—åˆ™ä»£è¡¨äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹ç‰¹å®šçš„pidè¿›è¡Œç›‘æ§é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>pidstat -w pid</code>å‘½ä»¤ï¼Œcswchå’Œnvcswchè¡¨ç¤ºè‡ªæ„¿åŠéè‡ªæ„¿åˆ‡æ¢ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/wcovumKWTCUD6aB.jpg" alt="img"></p><h2 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h2><p>ç£ç›˜é—®é¢˜å’Œcpuä¸€æ ·æ˜¯å±äºæ¯”è¾ƒåŸºç¡€çš„ã€‚é¦–å…ˆæ˜¯ç£ç›˜ç©ºé—´æ–¹é¢ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨df -hlæ¥æŸ¥çœ‹æ–‡ä»¶ç³»ç»ŸçŠ¶æ€</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/uiHITf3o8ZXPsSV.jpg" alt="img"></p><p>æ›´å¤šæ—¶å€™ï¼Œç£ç›˜é—®é¢˜è¿˜æ˜¯æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡iostatiostat -d -k -xæ¥è¿›è¡Œåˆ†æ</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/gnYA7u5U2QZlecH.png" alt="img"></p><p>æœ€åä¸€åˆ—%utilå¯ä»¥çœ‹åˆ°æ¯å—ç£ç›˜å†™å…¥çš„ç¨‹åº¦ï¼Œè€Œ<code>rrqpm/s</code>ä»¥åŠ<code>wrqm/s</code>åˆ†åˆ«è¡¨ç¤ºè¯»å†™é€Ÿåº¦ï¼Œä¸€èˆ¬å°±èƒ½å¸®åŠ©å®šä½åˆ°å…·ä½“å“ªå—ç£ç›˜å‡ºç°é—®é¢˜äº†ã€‚</p><p>å¦å¤–æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨è¿›è¡Œè¯»å†™ï¼Œä¸€èˆ¬æ¥è¯´å¼€å‘è‡ªå·±å¿ƒé‡Œæœ‰æ•°ï¼Œæˆ–è€…ç”¨iotopå‘½ä»¤æ¥è¿›è¡Œå®šä½æ–‡ä»¶è¯»å†™çš„æ¥æºã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/NniI3GxHWQht8lT.jpg" alt="img"></p><p>ä¸è¿‡è¿™è¾¹æ‹¿åˆ°çš„æ˜¯tidï¼Œæˆ‘ä»¬è¦è½¬æ¢æˆpidï¼Œå¯ä»¥é€šè¿‡readlinkæ¥æ‰¾åˆ°pidreadlink -f /proc/*/task/tid/../..ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/glP9n6ZNzTwLbei.png" alt="img"></p><p>æ‰¾åˆ°pidä¹‹åå°±å¯ä»¥çœ‹è¿™ä¸ªè¿›ç¨‹å…·ä½“çš„è¯»å†™æƒ…å†µcat /proc/pid/io</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/rl5kqySPGWUcQDZ.jpg" alt="img"></p><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡lsofå‘½ä»¤æ¥ç¡®å®šå…·ä½“çš„æ–‡ä»¶è¯»å†™æƒ…å†µlsof -p pid</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/UWp75fjZdX8OiVo.jpg" alt="img"></p><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><p>å†…å­˜é—®é¢˜æ’æŸ¥èµ·æ¥ç›¸å¯¹æ¯”CPUéº»çƒ¦ä¸€äº›ï¼Œåœºæ™¯ä¹Ÿæ¯”è¾ƒå¤šã€‚ä¸»è¦åŒ…æ‹¬OOMã€GCé—®é¢˜å’Œå †å¤–å†…å­˜ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬ä¼šå…ˆç”¨freeå‘½ä»¤å…ˆæ¥æ£€æŸ¥ä¸€å‘å†…å­˜çš„å„ç§æƒ…å†µã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/HntqNjKrP74eFaJ.png" alt="img"></p><h3 id="å †å†…å†…å­˜"><a href="#å †å†…å†…å­˜" class="headerlink" title="å †å†…å†…å­˜"></a>å †å†…å†…å­˜</h3><p>å†…å­˜é—®é¢˜å¤§å¤šè¿˜éƒ½æ˜¯å †å†…å†…å­˜é—®é¢˜ã€‚è¡¨è±¡ä¸Šä¸»è¦åˆ†ä¸ºOOMå’ŒStackOverflowã€‚</p><h3 id="OOM"><a href="#OOM" class="headerlink" title="OOM"></a>OOM</h3><p>JMVä¸­çš„å†…å­˜ä¸è¶³ï¼ŒOOMå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: unable to create new native thread</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ„æ€æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ç»™çº¿ç¨‹åˆ†é…javaæ ˆï¼ŒåŸºæœ¬ä¸Šè¿˜æ˜¯çº¿ç¨‹æ± ä»£ç å†™çš„æœ‰é—®é¢˜ï¼Œæ¯”å¦‚è¯´å¿˜è®°shutdownï¼Œæ‰€ä»¥è¯´åº”è¯¥é¦–å…ˆä»ä»£ç å±‚é¢æ¥å¯»æ‰¾é—®é¢˜ï¼Œä½¿ç”¨jstackæˆ–è€…jmapã€‚å¦‚æœä¸€åˆ‡éƒ½æ­£å¸¸ï¼ŒJVMæ–¹é¢å¯ä»¥é€šè¿‡æŒ‡å®šXssæ¥å‡å°‘å•ä¸ªthread stackçš„å¤§å°ã€‚</p><p>å¦å¤–ä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿå±‚é¢ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹/<code>etc/security/limits.confnofile</code>å’Œ<code>nproc</code>æ¥å¢å¤§oså¯¹çº¿ç¨‹çš„é™åˆ¶</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/x8SMawkbylmL5pX.png" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ„æ€æ˜¯å †çš„å†…å­˜å ç”¨å·²ç»è¾¾åˆ°<code>-Xmx</code>è®¾ç½®çš„æœ€å¤§å€¼ï¼Œåº”è¯¥æ˜¯æœ€å¸¸è§çš„OOMé”™è¯¯äº†ã€‚è§£å†³æ€è·¯ä»ç„¶æ˜¯å…ˆåº”è¯¥åœ¨ä»£ç ä¸­æ‰¾ï¼Œæ€€ç–‘å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œé€šè¿‡jstackå’Œjmapå»å®šä½é—®é¢˜ã€‚å¦‚æœè¯´ä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œæ‰éœ€è¦é€šè¿‡è°ƒæ•´Xmxçš„å€¼æ¥æ‰©å¤§å†…å­˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.OutOfMemoryError: Meta space</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ„æ€æ˜¯å…ƒæ•°æ®åŒºçš„å†…å­˜å ç”¨å·²ç»è¾¾åˆ°<code>XX:MaxMetaspaceSize</code>è®¾ç½®çš„æœ€å¤§å€¼ï¼Œæ’æŸ¥æ€è·¯å’Œä¸Šé¢çš„ä¸€è‡´ï¼Œå‚æ•°æ–¹é¢å¯ä»¥é€šè¿‡<code>XX:MaxPermSize</code>æ¥è¿›è¡Œè°ƒæ•´(è¿™é‡Œå°±ä¸è¯´1.8ä»¥å‰çš„æ°¸ä¹…ä»£äº†)ã€‚</p><h3 id="Stack-Overflow"><a href="#Stack-Overflow" class="headerlink" title="Stack Overflow"></a>Stack Overflow</h3><p>æ ˆå†…å­˜æº¢å‡ºï¼Œè¿™ä¸ªå¤§å®¶è§åˆ°ä¹Ÿæ¯”è¾ƒå¤šã€‚</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Exception</span> <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> java.lang.<span class="built_in">StackOverflowError</span></span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºçº¿ç¨‹æ ˆéœ€è¦çš„å†…å­˜å¤§äºXsså€¼ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…ˆè¿›è¡Œæ’æŸ¥ï¼Œå‚æ•°æ–¹é¢é€šè¿‡Xssæ¥è°ƒæ•´ï¼Œä½†è°ƒæ•´çš„å¤ªå¤§å¯èƒ½åˆä¼šå¼•èµ·OOMã€‚</p><h3 id="ä½¿ç”¨JMAPå®šä½ä»£ç å†…å­˜æ³„æ¼"><a href="#ä½¿ç”¨JMAPå®šä½ä»£ç å†…å­˜æ³„æ¼" class="headerlink" title="ä½¿ç”¨JMAPå®šä½ä»£ç å†…å­˜æ³„æ¼"></a>ä½¿ç”¨JMAPå®šä½ä»£ç å†…å­˜æ³„æ¼</h3><p>ä¸Šè¿°å…³äºOOMå’ŒStackOverflowçš„ä»£ç æ’æŸ¥æ–¹é¢ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<code>jmap -dump:format=b,file=filename pid</code>æ¥å¯¼å‡ºdumpæ–‡ä»¶</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/kv2SEUOha1IzVdp.jpg" alt="img"></p><p>é€šè¿‡mat(Eclipse Memory Analysis Tools)å¯¼å…¥dumpæ–‡ä»¶è¿›è¡Œåˆ†æï¼Œå†…å­˜æ³„æ¼é—®é¢˜ä¸€èˆ¬æˆ‘ä»¬ç›´æ¥é€‰Leak Suspectså³å¯ï¼Œmatç»™å‡ºäº†å†…å­˜æ³„æ¼çš„å»ºè®®ã€‚å¦å¤–ä¹Ÿå¯ä»¥é€‰æ‹©Top Consumersæ¥æŸ¥çœ‹æœ€å¤§å¯¹è±¡æŠ¥å‘Šã€‚å’Œçº¿ç¨‹ç›¸å…³çš„é—®é¢˜å¯ä»¥é€‰æ‹©thread overviewè¿›è¡Œåˆ†æã€‚é™¤æ­¤ä¹‹å¤–å°±æ˜¯é€‰æ‹©Histogramç±»æ¦‚è§ˆæ¥è‡ªå·±æ…¢æ…¢åˆ†æï¼Œå¤§å®¶å¯ä»¥æœæœmatçš„ç›¸å…³æ•™ç¨‹ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/rxLs2k8YTbnw3QW.jpg" alt="img"></p><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œä»£ç äº§ç”Ÿå†…å­˜æ³„æ¼æ˜¯æ¯”è¾ƒå¸¸è§çš„äº‹ï¼Œå¹¶ä¸”æ¯”è¾ƒéšè”½ï¼Œéœ€è¦å¼€å‘è€…æ›´åŠ å…³æ³¨ç»†èŠ‚ã€‚æ¯”å¦‚è¯´æ¯æ¬¡è¯·æ±‚éƒ½newå¯¹è±¡ï¼Œå¯¼è‡´å¤§é‡é‡å¤åˆ›å»ºå¯¹è±¡ï¼›è¿›è¡Œæ–‡ä»¶æµæ“ä½œä½†æœªæ­£ç¡®å…³é—­ï¼›æ‰‹åŠ¨ä¸å½“è§¦å‘gcï¼›ByteBufferç¼“å­˜åˆ†é…ä¸åˆç†ç­‰éƒ½ä¼šé€ æˆä»£ç OOMã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨å‚æ•°ä¸­æŒ‡å®š<code>-XX:+HeapDumpOnOutOfMemoryError</code>æ¥ä¿å­˜OOMæ—¶çš„dumpæ–‡ä»¶ã€‚</p><p>æœç´¢JavaçŸ¥éŸ³ï¼Œå›å¤â€œåç«¯é¢è¯•â€ï¼Œé€ä½ ä¸€ä»½é¢è¯•å®å…¸.pdf</p><h3 id="gcé—®é¢˜å’Œçº¿ç¨‹"><a href="#gcé—®é¢˜å’Œçº¿ç¨‹" class="headerlink" title="gcé—®é¢˜å’Œçº¿ç¨‹"></a>gcé—®é¢˜å’Œçº¿ç¨‹</h3><p>gcé—®é¢˜é™¤äº†å½±å“cpuä¹Ÿä¼šå½±å“å†…å­˜ï¼Œæ’æŸ¥æ€è·¯ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚ä¸€èˆ¬å…ˆä½¿ç”¨jstatæ¥æŸ¥çœ‹åˆ†ä»£å˜åŒ–æƒ…å†µï¼Œæ¯”å¦‚youngGCæˆ–è€…fullGCæ¬¡æ•°æ˜¯ä¸æ˜¯å¤ªå¤šå‘€ï¼›EUã€OUç­‰æŒ‡æ ‡å¢é•¿æ˜¯ä¸æ˜¯å¼‚å¸¸å‘€ç­‰ã€‚</p><p>çº¿ç¨‹çš„è¯å¤ªå¤šè€Œä¸”ä¸è¢«åŠæ—¶gcä¹Ÿä¼šå¼•å‘oomï¼Œå¤§éƒ¨åˆ†å°±æ˜¯ä¹‹å‰è¯´çš„unable to create new native threadã€‚é™¤äº†jstackç»†ç»†åˆ†ædumpæ–‡ä»¶å¤–ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆä¼šçœ‹ä¸‹æ€»ä½“çº¿ç¨‹ï¼Œé€šè¿‡<code>pstreee -p pid |wc -l</code>ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/Ldomz6FipC3g9sx.jpg" alt="img"></p><p>æˆ–è€…ç›´æ¥é€šè¿‡æŸ¥çœ‹<code>/proc/pid/task</code>çš„æ•°é‡å³ä¸ºçº¿ç¨‹æ•°é‡ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/KXl9q3PeC4uZhVW.png" alt="img"></p><h3 id="å †å¤–å†…å­˜"><a href="#å †å¤–å†…å­˜" class="headerlink" title="å †å¤–å†…å­˜"></a>å †å¤–å†…å­˜</h3><p>å¦‚æœç¢°åˆ°å †å¤–å†…å­˜æº¢å‡ºï¼Œé‚£å¯çœŸæ˜¯å¤ªä¸å¹¸äº†ã€‚é¦–å…ˆå †å¤–å†…å­˜æº¢å‡ºè¡¨ç°å°±æ˜¯ç‰©ç†å¸¸é©»å†…å­˜å¢é•¿å¿«ï¼ŒæŠ¥é”™çš„è¯è§†ä½¿ç”¨æ–¹å¼éƒ½ä¸ç¡®å®šï¼Œå¦‚æœç”±äºä½¿ç”¨Nettyå¯¼è‡´çš„ï¼Œé‚£é”™è¯¯æ—¥å¿—é‡Œå¯èƒ½ä¼šå‡ºç°OutOfDirectMemoryErroré”™è¯¯ï¼Œå¦‚æœç›´æ¥æ˜¯DirectByteBufferï¼Œé‚£ä¼šæŠ¥<code>OutOfMemoryError: Direct buffer memory</code>ã€‚</p><p>å †å¤–å†…å­˜æº¢å‡ºå¾€å¾€æ˜¯å’ŒNIOçš„ä½¿ç”¨ç›¸å…³ï¼Œä¸€èˆ¬æˆ‘ä»¬å…ˆé€šè¿‡pmapæ¥æŸ¥çœ‹ä¸‹è¿›ç¨‹å ç”¨çš„å†…å­˜æƒ…å†µ<code>pmap -x pid | sort -rn -k3 | head -30</code>ï¼Œè¿™æ®µæ„æ€æ˜¯æŸ¥çœ‹å¯¹åº”pidå€’åºå‰30å¤§çš„å†…å­˜æ®µã€‚è¿™è¾¹å¯ä»¥å†ä¸€æ®µæ—¶é—´åå†è·‘ä¸€æ¬¡å‘½ä»¤çœ‹çœ‹å†…å­˜å¢é•¿æƒ…å†µï¼Œæˆ–è€…å’Œæ­£å¸¸æœºå™¨æ¯”è¾ƒå¯ç–‘çš„å†…å­˜æ®µåœ¨å“ªé‡Œã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/yAe86jb9Th5RGFZ.jpg" alt="img"></p><p>æˆ‘ä»¬å¦‚æœç¡®å®šæœ‰å¯ç–‘çš„å†…å­˜ç«¯ï¼Œéœ€è¦é€šè¿‡gdbæ¥åˆ†æ<code>gdb --batch --pid &#123;pid&#125; -ex &quot;dump memory filename.dump</code> {å†…å­˜èµ·å§‹åœ°å€} {å†…å­˜èµ·å§‹åœ°å€+å†…å­˜å—å¤§å°}â€</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/DOCuaFyY6IkJhG1.png" alt="img"></p><p>è·å–dumpæ–‡ä»¶åå¯ç”¨heaxdumpè¿›è¡ŒæŸ¥çœ‹<code>hexdump -C filename | less</code>ï¼Œä¸è¿‡å¤§å¤šæ•°çœ‹åˆ°çš„éƒ½æ˜¯äºŒè¿›åˆ¶ä¹±ç ã€‚</p><p>NMTæ˜¯Java7U40å¼•å…¥çš„HotSpotæ–°ç‰¹æ€§ï¼Œé…åˆjcmdå‘½ä»¤æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å…·ä½“å†…å­˜ç»„æˆäº†ã€‚éœ€è¦åœ¨å¯åŠ¨å‚æ•°ä¸­åŠ å…¥ <code>-XX:NativeMemoryTracking=summary</code> æˆ–è€… <code>-XX:NativeMemoryTracking=detail</code>ï¼Œä¼šæœ‰ç•¥å¾®æ€§èƒ½æŸè€—ã€‚</p><p>ä¸€èˆ¬å¯¹äºå †å¤–å†…å­˜ç¼“æ…¢å¢é•¿ç›´åˆ°çˆ†ç‚¸çš„æƒ…å†µæ¥è¯´ï¼Œå¯ä»¥å…ˆè®¾ä¸€ä¸ªåŸºçº¿jcmd pid VM.native_memory baselineã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/sl7HWJdLcqpmi4E.png" alt="img"></p><p>ç„¶åç­‰æ”¾ä¸€æ®µæ—¶é—´åå†å»çœ‹çœ‹å†…å­˜å¢é•¿çš„æƒ…å†µï¼Œé€šè¿‡jcmd pid VM.native_memory detail.diff(summary.diff)åšä¸€ä¸‹summaryæˆ–è€…detailçº§åˆ«çš„diffã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/8wQJxAlatNRFTPi.png" alt="img"></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/7FLWf9OAj8d6sNK.jpg" alt="img"></p><p>å¯ä»¥çœ‹åˆ°jcmdåˆ†æå‡ºæ¥çš„å†…å­˜ååˆ†è¯¦ç»†ï¼ŒåŒ…æ‹¬å †å†…ã€çº¿ç¨‹ä»¥åŠgc(æ‰€ä»¥ä¸Šè¿°å…¶ä»–å†…å­˜å¼‚å¸¸å…¶å®éƒ½å¯ä»¥ç”¨nmtæ¥åˆ†æ)ï¼Œè¿™è¾¹å †å¤–å†…å­˜æˆ‘ä»¬é‡ç‚¹å…³æ³¨Internalçš„å†…å­˜å¢é•¿ï¼Œå¦‚æœå¢é•¿ååˆ†æ˜æ˜¾çš„è¯é‚£å°±æ˜¯æœ‰é—®é¢˜äº†ã€‚</p><p>detailçº§åˆ«çš„è¯è¿˜ä¼šæœ‰å…·ä½“å†…å­˜æ®µçš„å¢é•¿æƒ…å†µï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/fkhKF9vrTgqaz3X.png" alt="img"></p><p>æ­¤å¤–åœ¨ç³»ç»Ÿå±‚é¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨straceå‘½ä»¤æ¥ç›‘æ§å†…å­˜åˆ†é… strace -f -e â€œbrk,mmap,munmapâ€ -p pid</p><p>è¿™è¾¹å†…å­˜åˆ†é…ä¿¡æ¯ä¸»è¦åŒ…æ‹¬äº†pidå’Œå†…å­˜åœ°å€ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/3rHv69CoIy4MUn5.jpg" alt="img"></p><p>ä¸è¿‡å…¶å®ä¸Šé¢é‚£äº›æ“ä½œä¹Ÿå¾ˆéš¾å®šä½åˆ°å…·ä½“çš„é—®é¢˜ç‚¹ï¼Œå…³é”®è¿˜æ˜¯è¦çœ‹é”™è¯¯æ—¥å¿—æ ˆï¼Œæ‰¾åˆ°å¯ç–‘çš„å¯¹è±¡ï¼Œææ¸…æ¥šå®ƒçš„å›æ”¶æœºåˆ¶ï¼Œç„¶åå»åˆ†æå¯¹åº”çš„å¯¹è±¡ã€‚æ¯”å¦‚DirectByteBufferåˆ†é…å†…å­˜çš„è¯ï¼Œæ˜¯éœ€è¦full GCæˆ–è€…æ‰‹åŠ¨system.gcæ¥è¿›è¡Œå›æ”¶çš„(æ‰€ä»¥æœ€å¥½ä¸è¦ä½¿ç”¨-XX:+DisableExplicitGC)ã€‚</p><p>é‚£ä¹ˆå…¶å®æˆ‘ä»¬å¯ä»¥è·Ÿè¸ªä¸€ä¸‹DirectByteBufferå¯¹è±¡çš„å†…å­˜æƒ…å†µï¼Œé€šè¿‡jmap -histo:live pidæ‰‹åŠ¨è§¦å‘fullGCæ¥çœ‹çœ‹å †å¤–å†…å­˜æœ‰æ²¡æœ‰è¢«å›æ”¶ã€‚å¦‚æœè¢«å›æ”¶äº†ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯å †å¤–å†…å­˜æœ¬èº«åˆ†é…çš„å¤ªå°äº†ï¼Œé€šè¿‡-XX:MaxDirectMemorySizeè¿›è¡Œè°ƒæ•´ã€‚å¦‚æœæ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œé‚£å°±è¦ä½¿ç”¨jmapå»åˆ†æé‚£äº›ä¸èƒ½è¢«gcçš„å¯¹è±¡ï¼Œä»¥åŠå’ŒDirectByteBufferä¹‹é—´çš„å¼•ç”¨å…³ç³»äº†ã€‚</p><p>æœç´¢JavaçŸ¥éŸ³ï¼Œå›å¤â€œåç«¯é¢è¯•â€ï¼Œé€ä½ ä¸€ä»½é¢è¯•å®å…¸.pdf</p><h3 id="GCé—®é¢˜"><a href="#GCé—®é¢˜" class="headerlink" title="GCé—®é¢˜"></a>GCé—®é¢˜</h3><p>å †å†…å†…å­˜æ³„æ¼æ€»æ˜¯å’ŒGCå¼‚å¸¸ç›¸ä¼´ã€‚ä¸è¿‡GCé—®é¢˜ä¸åªæ˜¯å’Œå†…å­˜é—®é¢˜ç›¸å…³ï¼Œè¿˜æœ‰å¯èƒ½å¼•èµ·CPUè´Ÿè½½ã€ç½‘ç»œé—®é¢˜ç­‰ç³»åˆ—å¹¶å‘ç—‡ï¼Œåªæ˜¯ç›¸å¯¹æ¥è¯´å’Œå†…å­˜è”ç³»ç´§å¯†äº›ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ­¤å•ç‹¬æ€»ç»“ä¸€ä¸‹GCç›¸å…³é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åœ¨cpuç« ä»‹ç»äº†ä½¿ç”¨jstatæ¥è·å–å½“å‰GCåˆ†ä»£å˜åŒ–ä¿¡æ¯ã€‚è€Œæ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡GCæ—¥å¿—æ¥æ’æŸ¥é—®é¢˜çš„ï¼Œåœ¨å¯åŠ¨å‚æ•°ä¸­åŠ ä¸Š<code>-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps</code>æ¥å¼€å¯GCæ—¥å¿—ã€‚</p><p>å¸¸è§çš„Young GCã€Full GCæ—¥å¿—å«ä¹‰åœ¨æ­¤å°±ä¸åšèµ˜è¿°äº†ã€‚</p><p>é’ˆå¯¹gcæ—¥å¿—ï¼Œæˆ‘ä»¬å°±èƒ½å¤§è‡´æ¨æ–­å‡ºyoungGCä¸fullGCæ˜¯å¦è¿‡äºé¢‘ç¹æˆ–è€…è€—æ—¶è¿‡é•¿ï¼Œä»è€Œå¯¹ç—‡ä¸‹è¯ã€‚æˆ‘ä»¬ä¸‹é¢å°†å¯¹G1åƒåœ¾æ”¶é›†å™¨æ¥åšåˆ†æï¼Œè¿™è¾¹ä¹Ÿå»ºè®®å¤§å®¶ä½¿ç”¨G1-XX:+UseG1GCã€‚</p><h4 id="youngGCè¿‡é¢‘ç¹"><a href="#youngGCè¿‡é¢‘ç¹" class="headerlink" title="youngGCè¿‡é¢‘ç¹"></a>youngGCè¿‡é¢‘ç¹</h4><p>youngGCé¢‘ç¹ä¸€èˆ¬æ˜¯çŸ­å‘¨æœŸå°å¯¹è±¡è¾ƒå¤šï¼Œå…ˆè€ƒè™‘æ˜¯ä¸æ˜¯EdenåŒº/æ–°ç”Ÿä»£è®¾ç½®çš„å¤ªå°äº†ï¼Œçœ‹èƒ½å¦é€šè¿‡è°ƒæ•´-Xmnã€-XX:SurvivorRatioç­‰å‚æ•°è®¾ç½®æ¥è§£å†³é—®é¢˜ã€‚å¦‚æœå‚æ•°æ­£å¸¸ï¼Œä½†æ˜¯young gcé¢‘ç‡è¿˜æ˜¯å¤ªé«˜ï¼Œå°±éœ€è¦ä½¿ç”¨Jmapå’ŒMATå¯¹dumpæ–‡ä»¶è¿›è¡Œè¿›ä¸€æ­¥æ’æŸ¥äº†ã€‚</p><h4 id="youngGCè€—æ—¶è¿‡é•¿"><a href="#youngGCè€—æ—¶è¿‡é•¿" class="headerlink" title="youngGCè€—æ—¶è¿‡é•¿"></a>youngGCè€—æ—¶è¿‡é•¿</h4><p>è€—æ—¶è¿‡é•¿é—®é¢˜å°±è¦çœ‹GCæ—¥å¿—é‡Œè€—æ—¶è€—åœ¨å“ªä¸€å—äº†ã€‚ä»¥G1æ—¥å¿—ä¸ºä¾‹ï¼Œå¯ä»¥å…³æ³¨Root Scanningã€Object Copyã€Ref Procç­‰é˜¶æ®µã€‚Ref Procè€—æ—¶é•¿ï¼Œå°±è¦æ³¨æ„å¼•ç”¨ç›¸å…³çš„å¯¹è±¡ã€‚</p><p>Root Scanningè€—æ—¶é•¿ï¼Œå°±è¦æ³¨æ„çº¿ç¨‹æ•°ã€è·¨ä»£å¼•ç”¨ã€‚Object Copyåˆ™éœ€è¦å…³æ³¨å¯¹è±¡ç”Ÿå­˜å‘¨æœŸã€‚è€Œä¸”è€—æ—¶åˆ†æå®ƒéœ€è¦æ¨ªå‘æ¯”è¾ƒï¼Œå°±æ˜¯å’Œå…¶ä»–é¡¹ç›®æˆ–è€…æ­£å¸¸æ—¶é—´æ®µçš„è€—æ—¶æ¯”è¾ƒã€‚æ¯”å¦‚è¯´å›¾ä¸­çš„Root Scanningå’Œæ­£å¸¸æ—¶é—´æ®µæ¯”å¢é•¿è¾ƒå¤šï¼Œé‚£å°±æ˜¯èµ·çš„çº¿ç¨‹å¤ªå¤šäº†ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/cvMh2IJLtuXUi6r.jpg" alt="img"></p><h4 id="è§¦å‘fullGC"><a href="#è§¦å‘fullGC" class="headerlink" title="è§¦å‘fullGC"></a>è§¦å‘fullGC</h4><p>G1ä¸­æ›´å¤šçš„è¿˜æ˜¯mixedGCï¼Œä½†mixedGCå¯ä»¥å’ŒyoungGCæ€è·¯ä¸€æ ·å»æ’æŸ¥ã€‚è§¦å‘fullGCäº†ä¸€èˆ¬éƒ½ä¼šæœ‰é—®é¢˜ï¼ŒG1ä¼šé€€åŒ–ä½¿ç”¨Serialæ”¶é›†å™¨æ¥å®Œæˆåƒåœ¾çš„æ¸…ç†å·¥ä½œï¼Œæš‚åœæ—¶é•¿è¾¾åˆ°ç§’çº§åˆ«ï¼Œå¯ä»¥è¯´æ˜¯åŠè·ªäº†ã€‚</p><p>fullGCçš„åŸå› å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹è¿™äº›ï¼Œä»¥åŠå‚æ•°è°ƒæ•´æ–¹é¢çš„ä¸€äº›æ€è·¯ï¼š</p><ul><li>å¹¶å‘é˜¶æ®µå¤±è´¥ï¼šåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼ŒMixGCä¹‹å‰è€å¹´ä»£å°±è¢«å¡«æ»¡äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å€™G1å°±ä¼šæ”¾å¼ƒæ ‡è®°å‘¨æœŸã€‚è¿™ç§æƒ…å†µï¼Œå¯èƒ½å°±éœ€è¦å¢åŠ å †å¤§å°ï¼Œæˆ–è€…è°ƒæ•´å¹¶å‘æ ‡è®°çº¿ç¨‹æ•°-XX:ConcGCThreadsã€‚</li><li>æ™‹å‡å¤±è´¥ï¼šåœ¨GCçš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¾›å­˜æ´»/æ™‹å‡å¯¹è±¡ä½¿ç”¨ï¼Œæ‰€ä»¥è§¦å‘äº†Full GCã€‚è¿™æ—¶å€™å¯ä»¥é€šè¿‡-XX:G1ReservePercentæ¥å¢åŠ é¢„ç•™å†…å­˜ç™¾åˆ†æ¯”ï¼Œå‡å°‘-XX:InitiatingHeapOccupancyPercentæ¥æå‰å¯åŠ¨æ ‡è®°ï¼Œ-XX:ConcGCThreadsæ¥å¢åŠ æ ‡è®°çº¿ç¨‹æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</li><li>å¤§å¯¹è±¡åˆ†é…å¤±è´¥ï¼šå¤§å¯¹è±¡æ‰¾ä¸åˆ°åˆé€‚çš„regionç©ºé—´è¿›è¡Œåˆ†é…ï¼Œå°±ä¼šè¿›è¡ŒfullGCï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥å¢å¤§å†…å­˜æˆ–è€…å¢å¤§-XX:G1HeapRegionSizeã€‚</li><li>ç¨‹åºä¸»åŠ¨æ‰§è¡ŒSystem.gc()ï¼šä¸è¦éšä¾¿å†™å°±å¯¹äº†ã€‚</li></ul><p>å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨å‚æ•°ä¸­é…ç½®<code>-XX:HeapDumpPath=/xxx/dump.hprof</code>æ¥dump fullGCç›¸å…³çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡<code>jinfo</code>æ¥è¿›è¡Œgcå‰åçš„dump</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jinfo -flag +HeapDumpBeforeFullGC pid </span><br><span class="line">jinfo -flag +HeapDumpAfterFullGC pid</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¾—åˆ°2ä»½dumpæ–‡ä»¶ï¼Œå¯¹æ¯”åä¸»è¦å…³æ³¨è¢«gcæ‰çš„é—®é¢˜å¯¹è±¡æ¥å®šä½é—®é¢˜ã€‚</p><p>æœç´¢JavaçŸ¥éŸ³ï¼Œå›å¤â€œåç«¯é¢è¯•â€ï¼Œé€ä½ ä¸€ä»½é¢è¯•å®å…¸.pdf</p><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><p>æ¶‰åŠåˆ°ç½‘ç»œå±‚é¢çš„é—®é¢˜ä¸€èˆ¬éƒ½æ¯”è¾ƒå¤æ‚ï¼Œåœºæ™¯å¤šï¼Œå®šä½éš¾ï¼Œæˆä¸ºäº†å¤§å¤šæ•°å¼€å‘çš„å™©æ¢¦ï¼Œåº”è¯¥æ˜¯æœ€å¤æ‚çš„äº†ã€‚è¿™é‡Œä¼šä¸¾ä¸€äº›ä¾‹å­ï¼Œå¹¶ä»tcpå±‚ã€åº”ç”¨å±‚ä»¥åŠå·¥å…·çš„ä½¿ç”¨ç­‰æ–¹é¢è¿›è¡Œé˜è¿°ã€‚</p><h3 id="è¶…æ—¶"><a href="#è¶…æ—¶" class="headerlink" title="è¶…æ—¶"></a>è¶…æ—¶</h3><p>è¶…æ—¶é”™è¯¯å¤§éƒ¨åˆ†å¤„åœ¨åº”ç”¨å±‚é¢ï¼Œæ‰€ä»¥è¿™å—ç€é‡ç†è§£æ¦‚å¿µã€‚è¶…æ—¶å¤§ä½“å¯ä»¥åˆ†ä¸ºè¿æ¥è¶…æ—¶å’Œè¯»å†™è¶…æ—¶ï¼ŒæŸäº›ä½¿ç”¨è¿æ¥æ± çš„å®¢æˆ·ç«¯æ¡†æ¶è¿˜ä¼šå­˜åœ¨è·å–è¿æ¥è¶…æ—¶å’Œç©ºé—²è¿æ¥æ¸…ç†è¶…æ—¶ã€‚</p><ul><li>è¯»å†™è¶…æ—¶ã€‚readTimeout/writeTimeoutï¼Œæœ‰äº›æ¡†æ¶å«åšso_timeoutæˆ–è€…socketTimeoutï¼Œå‡æŒ‡çš„æ˜¯æ•°æ®è¯»å†™è¶…æ—¶ã€‚æ³¨æ„è¿™è¾¹çš„è¶…æ—¶å¤§éƒ¨åˆ†æ˜¯æŒ‡é€»è¾‘ä¸Šçš„è¶…æ—¶ã€‚soaçš„è¶…æ—¶æŒ‡çš„ä¹Ÿæ˜¯è¯»è¶…æ—¶ã€‚è¯»å†™è¶…æ—¶ä¸€èˆ¬éƒ½åªé’ˆå¯¹å®¢æˆ·ç«¯è®¾ç½®ã€‚</li><li>è¿æ¥è¶…æ—¶ã€‚connectionTimeoutï¼Œå®¢æˆ·ç«¯é€šå¸¸æŒ‡ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„æœ€å¤§æ—¶é—´ã€‚æœåŠ¡ç«¯è¿™è¾¹connectionTimeoutå°±æœ‰äº›äº”èŠ±å…«é—¨äº†ï¼Œjettyä¸­è¡¨ç¤ºç©ºé—²è¿æ¥æ¸…ç†æ—¶é—´ï¼Œtomcatåˆ™è¡¨ç¤ºè¿æ¥ç»´æŒçš„æœ€å¤§æ—¶é—´ã€‚</li><li>å…¶ä»–ã€‚åŒ…æ‹¬è¿æ¥è·å–è¶…æ—¶connectionAcquireTimeoutå’Œç©ºé—²è¿æ¥æ¸…ç†è¶…æ—¶idleConnectionTimeoutã€‚å¤šç”¨äºä½¿ç”¨è¿æ¥æ± æˆ–é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æ¡†æ¶ã€‚</li></ul><p>æˆ‘ä»¬åœ¨è®¾ç½®å„ç§è¶…æ—¶æ—¶é—´ä¸­ï¼Œéœ€è¦ç¡®è®¤çš„æ˜¯å°½é‡ä¿æŒå®¢æˆ·ç«¯çš„è¶…æ—¶å°äºæœåŠ¡ç«¯çš„è¶…æ—¶ï¼Œä»¥ä¿è¯è¿æ¥æ­£å¸¸ç»“æŸã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å…³å¿ƒæœ€å¤šçš„åº”è¯¥æ˜¯æ¥å£çš„è¯»å†™è¶…æ—¶äº†ã€‚</p><p>å¦‚ä½•è®¾ç½®åˆç†çš„æ¥å£è¶…æ—¶æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœæ¥å£è¶…æ—¶è®¾ç½®çš„è¿‡é•¿ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šè¿‡å¤šåœ°å ç”¨æœåŠ¡ç«¯çš„tcpè¿æ¥ã€‚è€Œå¦‚æœæ¥å£è®¾ç½®çš„è¿‡çŸ­ï¼Œé‚£ä¹ˆæ¥å£è¶…æ—¶å°±ä¼šéå¸¸é¢‘ç¹ã€‚</p><p>æœåŠ¡ç«¯æ¥å£æ˜æ˜rté™ä½ï¼Œä½†å®¢æˆ·ç«¯ä»ç„¶ä¸€ç›´è¶…æ—¶åˆæ˜¯å¦ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„é“¾è·¯åŒ…æ‹¬ç½‘ç»œä¼ è¾“ã€æ’é˜Ÿä»¥åŠæœåŠ¡å¤„ç†ç­‰ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½æ˜¯è€—æ—¶çš„åŸå› ã€‚</p><h3 id="TCPé˜Ÿåˆ—æº¢å‡º"><a href="#TCPé˜Ÿåˆ—æº¢å‡º" class="headerlink" title="TCPé˜Ÿåˆ—æº¢å‡º"></a>TCPé˜Ÿåˆ—æº¢å‡º</h3><p>tcpé˜Ÿåˆ—æº¢å‡ºæ˜¯ä¸ªç›¸å¯¹åº•å±‚çš„é”™è¯¯ï¼Œå®ƒå¯èƒ½ä¼šé€ æˆè¶…æ—¶ã€rstç­‰æ›´è¡¨å±‚çš„é”™è¯¯ã€‚å› æ­¤é”™è¯¯ä¹Ÿæ›´éšè”½ï¼Œæ‰€ä»¥æˆ‘ä»¬å•ç‹¬è¯´ä¸€è¯´ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/BIG7MdLE6zwhDF2.jpg" alt="img"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼šsyns queue(åŠè¿æ¥é˜Ÿåˆ—ï¼‰ã€accept queueï¼ˆå…¨è¿æ¥é˜Ÿåˆ—ï¼‰ã€‚ä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨serveræ”¶åˆ°clientçš„synåï¼ŒæŠŠæ¶ˆæ¯æ”¾åˆ°syns queueï¼Œå›å¤syn+ackç»™clientï¼Œserveræ”¶åˆ°clientçš„ackï¼Œå¦‚æœè¿™æ—¶accept queueæ²¡æ»¡ï¼Œé‚£å°±ä»syns queueæ‹¿å‡ºæš‚å­˜çš„ä¿¡æ¯æ”¾å…¥accept queueä¸­ï¼Œå¦åˆ™æŒ‰tcp_abort_on_overflowæŒ‡ç¤ºçš„æ‰§è¡Œã€‚</p><p>tcp_abort_on_overflow 0è¡¨ç¤ºå¦‚æœä¸‰æ¬¡æ¡æ‰‹ç¬¬ä¸‰æ­¥çš„æ—¶å€™accept queueæ»¡äº†é‚£ä¹ˆserveræ‰”æ‰clientå‘è¿‡æ¥çš„ackã€‚tcp_abort_on_overflow 1åˆ™è¡¨ç¤ºç¬¬ä¸‰æ­¥çš„æ—¶å€™å¦‚æœå…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œserverå‘é€ä¸€ä¸ªrståŒ…ç»™clientï¼Œè¡¨ç¤ºåºŸæ‰è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹å’Œè¿™ä¸ªè¿æ¥ï¼Œæ„å‘³ç€æ—¥å¿—é‡Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šconnection reset / connection reset by peerã€‚</p><p>é‚£ä¹ˆåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆèƒ½å¿«é€Ÿå®šä½åˆ°tcpé˜Ÿåˆ—æº¢å‡ºå‘¢ï¼Ÿ</p><p>netstatå‘½ä»¤ï¼Œæ‰§è¡Œ<code>netstat -s | egrep &quot;listen|LISTEN&quot;</code></p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/MzG4jAKBJCl8PbT.jpg" alt="img"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œoverflowedè¡¨ç¤ºå…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æ¬¡æ•°ï¼Œsockets droppedè¡¨ç¤ºåŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æ¬¡æ•°ã€‚</p><h3 id="sså‘½ä»¤ï¼Œæ‰§è¡Œss-lnt"><a href="#sså‘½ä»¤ï¼Œæ‰§è¡Œss-lnt" class="headerlink" title="sså‘½ä»¤ï¼Œæ‰§è¡Œss -lnt"></a>sså‘½ä»¤ï¼Œæ‰§è¡Œss -lnt</h3><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/i4ITEDY6M9hZmtz.png" alt="img"></p><p>ä¸Šé¢çœ‹åˆ°Send-Q è¡¨ç¤ºç¬¬ä¸‰åˆ—çš„listenç«¯å£ä¸Šçš„å…¨è¿æ¥é˜Ÿåˆ—æœ€å¤§ä¸º5ï¼Œç¬¬ä¸€åˆ—Recv-Qä¸ºå…¨è¿æ¥é˜Ÿåˆ—å½“å‰ä½¿ç”¨äº†å¤šå°‘ã€‚</p><p>æ¥ç€æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆè®¾ç½®å…¨è¿æ¥ã€åŠè¿æ¥é˜Ÿåˆ—å¤§å°å§ï¼š</p><p>å…¨è¿æ¥é˜Ÿåˆ—çš„å¤§å°å–å†³äºmin(backlog, somaxconn)ã€‚backlogæ˜¯åœ¨socketåˆ›å»ºçš„æ—¶å€™ä¼ å…¥çš„ï¼Œsomaxconnæ˜¯ä¸€ä¸ªosçº§åˆ«çš„ç³»ç»Ÿå‚æ•°ã€‚è€ŒåŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°å–å†³äºmax(64, /proc/sys/net/ipv4/tcp_max_syn_backlog)ã€‚</p><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä½¿ç”¨servletå®¹å™¨ä½œä¸ºæœåŠ¡ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿéœ€è¦å…³æ³¨å®¹å™¨çš„è¿æ¥é˜Ÿåˆ—å¤§å°ã€‚åœ¨tomcatä¸­backlogå«åšacceptCountï¼Œåœ¨jettyé‡Œé¢åˆ™æ˜¯acceptQueueSizeã€‚</p><h3 id="RSTå¼‚å¸¸"><a href="#RSTå¼‚å¸¸" class="headerlink" title="RSTå¼‚å¸¸"></a>RSTå¼‚å¸¸</h3><p>RSTåŒ…è¡¨ç¤ºè¿æ¥é‡ç½®ï¼Œç”¨äºå…³é—­ä¸€äº›æ— ç”¨çš„è¿æ¥ï¼Œé€šå¸¸è¡¨ç¤ºå¼‚å¸¸å…³é—­ï¼ŒåŒºåˆ«äºå››æ¬¡æŒ¥æ‰‹ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šçœ‹åˆ°connection reset / connection reset by peeré”™è¯¯ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯RSTåŒ…å¯¼è‡´çš„ã€‚</p><h3 id="ç«¯å£ä¸å­˜åœ¨"><a href="#ç«¯å£ä¸å­˜åœ¨" class="headerlink" title="ç«¯å£ä¸å­˜åœ¨"></a>ç«¯å£ä¸å­˜åœ¨</h3><p>å¦‚æœåƒä¸å­˜åœ¨çš„ç«¯å£å‘å‡ºå»ºç«‹è¿æ¥SYNè¯·æ±‚ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å‘ç°è‡ªå·±å¹¶æ²¡æœ‰è¿™ä¸ªç«¯å£åˆ™ä¼šç›´æ¥è¿”å›ä¸€ä¸ªRSTæŠ¥æ–‡ï¼Œç”¨äºä¸­æ–­è¿æ¥ã€‚</p><h3 id="ä¸»åŠ¨ä»£æ›¿FINç»ˆæ­¢è¿æ¥"><a href="#ä¸»åŠ¨ä»£æ›¿FINç»ˆæ­¢è¿æ¥" class="headerlink" title="ä¸»åŠ¨ä»£æ›¿FINç»ˆæ­¢è¿æ¥"></a>ä¸»åŠ¨ä»£æ›¿FINç»ˆæ­¢è¿æ¥</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ­£å¸¸çš„è¿æ¥å…³é—­éƒ½æ˜¯éœ€è¦é€šè¿‡FINæŠ¥æ–‡å®ç°ï¼Œç„¶è€Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨RSTæŠ¥æ–‡æ¥ä»£æ›¿FINï¼Œè¡¨ç¤ºç›´æ¥ç»ˆæ­¢è¿æ¥ã€‚å®é™…å¼€å‘ä¸­ï¼Œå¯è®¾ç½®SO_LINGERæ•°å€¼æ¥æ§åˆ¶ï¼Œè¿™ç§å¾€å¾€æ˜¯æ•…æ„çš„ï¼Œæ¥è·³è¿‡TIMED_WAITï¼Œæä¾›äº¤äº’æ•ˆç‡ï¼Œä¸é—²å°±æ…ç”¨ã€‚</p><p>å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æœ‰ä¸€è¾¹å‘ç”Ÿäº†å¼‚å¸¸ï¼Œè¯¥æ–¹å‘å¯¹ç«¯å‘é€RSTä»¥å‘ŠçŸ¥å…³é—­è¿æ¥</p><p>æˆ‘ä»¬ä¸Šé¢è®²çš„tcpé˜Ÿåˆ—æº¢å‡ºå‘é€RSTåŒ…å…¶å®ä¹Ÿæ˜¯å±äºè¿™ä¸€ç§ã€‚è¿™ç§å¾€å¾€æ˜¯ç”±äºæŸäº›åŸå› ï¼Œä¸€æ–¹æ— æ³•å†èƒ½æ­£å¸¸å¤„ç†è¯·æ±‚è¿æ¥äº†(æ¯”å¦‚ç¨‹åºå´©äº†ï¼Œé˜Ÿåˆ—æ»¡äº†)ï¼Œä»è€Œå‘ŠçŸ¥å¦ä¸€æ–¹å…³é—­è¿æ¥ã€‚</p><p>æ¥æ”¶åˆ°çš„TCPæŠ¥æ–‡ä¸åœ¨å·²çŸ¥çš„TCPè¿æ¥å†…</p><p>æ¯”å¦‚ï¼Œä¸€æ–¹æœºå™¨ç”±äºç½‘ç»œå®åœ¨å¤ªå·®TCPæŠ¥æ–‡å¤±è¸ªäº†ï¼Œå¦ä¸€æ–¹å…³é—­äº†è¯¥è¿æ¥ï¼Œç„¶åè¿‡äº†è®¸ä¹…æ”¶åˆ°äº†ä¹‹å‰å¤±è¸ªçš„TCPæŠ¥æ–‡ï¼Œä½†ç”±äºå¯¹åº”çš„TCPè¿æ¥å·²ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šç›´æ¥å‘ä¸€ä¸ªRSTåŒ…ä»¥ä¾¿å¼€å¯æ–°çš„è¿æ¥ã€‚</p><p>ä¸€æ–¹é•¿æœŸæœªæ”¶åˆ°å¦ä¸€æ–¹çš„ç¡®è®¤æŠ¥æ–‡ï¼Œåœ¨ä¸€å®šæ—¶é—´æˆ–é‡ä¼ æ¬¡æ•°åå‘å‡ºRSTæŠ¥æ–‡</p><p>è¿™ç§å¤§å¤šä¹Ÿå’Œç½‘ç»œç¯å¢ƒç›¸å…³äº†ï¼Œç½‘ç»œç¯å¢ƒå·®å¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„RSTæŠ¥æ–‡ã€‚</p><p>ä¹‹å‰è¯´è¿‡RSTæŠ¥æ–‡å¤šä¼šå¯¼è‡´ç¨‹åºæŠ¥é”™ï¼Œåœ¨ä¸€ä¸ªå·²å…³é—­çš„è¿æ¥ä¸Šè¯»æ“ä½œä¼šæŠ¥connection resetï¼Œè€Œåœ¨ä¸€ä¸ªå·²å…³é—­çš„è¿æ¥ä¸Šå†™æ“ä½œåˆ™ä¼šæŠ¥connection reset by peerã€‚é€šå¸¸æˆ‘ä»¬å¯èƒ½è¿˜ä¼šçœ‹åˆ°broken pipeé”™è¯¯ï¼Œè¿™æ˜¯ç®¡é“å±‚é¢çš„é”™è¯¯ï¼Œè¡¨ç¤ºå¯¹å·²å…³é—­çš„ç®¡é“è¿›è¡Œè¯»å†™ï¼Œå¾€å¾€æ˜¯åœ¨æ”¶åˆ°RSTï¼ŒæŠ¥å‡ºconnection reseté”™åç»§ç»­è¯»å†™æ•°æ®æŠ¥çš„é”™ï¼Œè¿™ä¸ªåœ¨glibcæºç æ³¨é‡Šä¸­ä¹Ÿæœ‰ä»‹ç»ã€‚</p><p>æˆ‘ä»¬åœ¨æ’æŸ¥æ•…éšœæ—¶å€™æ€ä¹ˆç¡®å®šæœ‰RSTåŒ…çš„å­˜åœ¨å‘¢ï¼Ÿå½“ç„¶æ˜¯ä½¿ç”¨tcpdumpå‘½ä»¤è¿›è¡ŒæŠ“åŒ…ï¼Œå¹¶ä½¿ç”¨wiresharkè¿›è¡Œç®€å•åˆ†æäº†ã€‚<code>tcpdump -i en0 tcp -w xxx.cap</code>ï¼Œen0è¡¨ç¤ºç›‘å¬çš„ç½‘å¡ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/kNByEcrUovZAXDK.png" alt="img"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡wiresharkæ‰“å¼€æŠ“åˆ°çš„åŒ…ï¼Œå¯èƒ½å°±èƒ½çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²çš„å°±è¡¨ç¤ºRSTåŒ…äº†ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="https://i.loli.net/2020/09/10/J8tYfoUl9pSF4A6.jpg" alt="img"></p><h3 id="TIME-WAITå’ŒCLOSE-WAIT"><a href="#TIME-WAITå’ŒCLOSE-WAIT" class="headerlink" title="TIME_WAITå’ŒCLOSE_WAIT"></a>TIME_WAITå’ŒCLOSE_WAIT</h3><p>TIME_WAITå’ŒCLOSE_WAITæ˜¯å•¥æ„æ€ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ã€‚</p><p>åœ¨çº¿ä¸Šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å‘½ä»¤<code>netstat -n | awk &#39;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#39;</code>æ¥æŸ¥çœ‹time-waitå’Œclose_waitçš„æ•°é‡</p><p>ç”¨sså‘½ä»¤ä¼šæ›´å¿«<code>ss -ant | awk &#39;&#123;++S[$1]&#125; END &#123;for(a in S) print a, S[a]&#125;&#39;</code></p><p><img src= "/img/loading2.gif" data-lazy-src="https://pic3.zhimg.com/80/v2-7634ccbe9502c93040e7e00c75754aad_720w.jpg" alt="img"></p><h3 id="TIME-WAIT"><a href="#TIME-WAIT" class="headerlink" title="TIME_WAIT"></a>TIME_WAIT</h3><p>time_waitçš„å­˜åœ¨ä¸€æ˜¯ä¸ºäº†ä¸¢å¤±çš„æ•°æ®åŒ…è¢«åé¢è¿æ¥å¤ç”¨ï¼ŒäºŒæ˜¯ä¸ºäº†åœ¨2MSLçš„æ—¶é—´èŒƒå›´å†…æ­£å¸¸å…³é—­è¿æ¥ã€‚å®ƒçš„å­˜åœ¨å…¶å®ä¼šå¤§å¤§å‡å°‘RSTåŒ…çš„å‡ºç°ã€‚</p><p>è¿‡å¤šçš„time_waitåœ¨çŸ­è¿æ¥é¢‘ç¹çš„åœºæ™¯æ¯”è¾ƒå®¹æ˜“å‡ºç°ã€‚è¿™ç§æƒ…å†µå¯ä»¥åœ¨æœåŠ¡ç«¯åšä¸€äº›å†…æ ¸å‚æ•°è°ƒä¼˜:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¡¨ç¤ºå¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"><span class="comment">#è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬ä¸è¦å¿˜è®°åœ¨NATç¯å¢ƒä¸‹å› ä¸ºæ—¶é—´æˆ³é”™ä¹±å¯¼è‡´æ•°æ®åŒ…è¢«æ‹’ç»çš„å‘äº†ï¼Œå¦å¤–çš„åŠæ³•å°±æ˜¯æ”¹å°tcp_max_tw_bucketsï¼Œè¶…è¿‡è¿™ä¸ªæ•°çš„time_waitéƒ½ä¼šè¢«å¹²æ‰ï¼Œä¸è¿‡è¿™ä¹Ÿä¼šå¯¼è‡´æŠ¥time wait bucket table overflowçš„é”™ã€‚</p><h3 id="CLOSE-WAIT"><a href="#CLOSE-WAIT" class="headerlink" title="CLOSE_WAIT"></a>CLOSE_WAIT</h3><p>close_waitå¾€å¾€éƒ½æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºå†™çš„æœ‰é—®é¢˜ï¼Œæ²¡æœ‰åœ¨ACKåå†æ¬¡å‘èµ·FINæŠ¥æ–‡ã€‚close_waitå‡ºç°çš„æ¦‚ç‡ç”šè‡³æ¯”time_waitè¦æ›´é«˜ï¼Œåæœä¹Ÿæ›´ä¸¥é‡ã€‚å¾€å¾€æ˜¯ç”±äºæŸä¸ªåœ°æ–¹é˜»å¡ä½äº†ï¼Œæ²¡æœ‰æ­£å¸¸å…³é—­è¿æ¥ï¼Œä»è€Œæ¸æ¸åœ°æ¶ˆè€—å®Œæ‰€æœ‰çš„çº¿ç¨‹ã€‚</p><p>æƒ³è¦å®šä½è¿™ç±»é—®é¢˜ï¼Œæœ€å¥½æ˜¯é€šè¿‡jstackæ¥åˆ†æçº¿ç¨‹å †æ ˆæ¥æ’æŸ¥é—®é¢˜ï¼Œå…·ä½“å¯å‚è€ƒä¸Šè¿°ç« èŠ‚ã€‚è¿™é‡Œä»…ä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p><p>å¼€å‘åŒå­¦è¯´åº”ç”¨ä¸Šçº¿åCLOSE_WAITå°±ä¸€ç›´å¢å¤šï¼Œç›´åˆ°æŒ‚æ‰ä¸ºæ­¢ï¼Œjstackåæ‰¾åˆ°æ¯”è¾ƒå¯ç–‘çš„å †æ ˆæ˜¯å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½å¡åœ¨äº†countdownlatch.awaitæ–¹æ³•ï¼Œæ‰¾å¼€å‘åŒå­¦äº†è§£åå¾—çŸ¥ä½¿ç”¨äº†å¤šçº¿ç¨‹ä½†æ˜¯ç¡®æ²¡æœ‰catchå¼‚å¸¸ï¼Œä¿®æ”¹åå‘ç°å¼‚å¸¸ä»…ä»…æ˜¯æœ€ç®€å•çš„å‡çº§sdkåå¸¸å‡ºç°çš„class not foundã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPSåŸç†è§£æ</title>
      <link href="/2016/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BHTTPS%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"/>
      <url>/2016/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BHTTPS%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>HTTPåè®®æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå®ƒç®€å•æ˜“äºç†è§£ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†å®‰å…¨æ€§é—®é¢˜ï¼Œåœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼ŒHTTPæµé‡å‡ ä¹æ˜¯åœ¨è£¸å¥”ï¼Œå¯ä»¥è½»æ˜“è¢«ç›‘å¬ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬æå‡ºäº†HTTP over SSLå³HTTPSï¼Œå³é€šè¿‡ssléš§é“æ¥ä¼ è¾“HTTPæµé‡ï¼Œè¿™æ ·åŠ å¯†äº†HTTPæ•°æ®åŒ…ï¼Œå®ç°äº†ä¼ è¾“é“¾è·¯ä¸Šçš„å®‰å…¨æ€§ã€‚ç›¸æ¯”äºHTTPï¼ŒHTTPSåœ¨TCPå±‚ä¸Šå¤šäº†ä¸€ä¸ªSSL/TLSå±‚ã€‚</p><p><img src= "/img/loading2.gif" data-lazy-src="http://blog.upyun.com/wp-content/uploads/2017/03/httpvshttps.png" alt="img"></p><h2 id="HTTPSçš„é€šä¿¡è¿‡ç¨‹"><a href="#HTTPSçš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="HTTPSçš„é€šä¿¡è¿‡ç¨‹"></a>HTTPSçš„é€šä¿¡è¿‡ç¨‹</h2><h3 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h3><blockquote><p>SSLï¼ˆSecure Socket Layerï¼Œå®‰å…¨å¥—æ¥å­—å±‚ï¼‰ï¼š1994å¹´ä¸º Netscape æ‰€ç ”å‘ï¼ŒSSL åè®®ä½äº TCP/IP åè®®ä¸å„ç§åº”ç”¨å±‚åè®®ä¹‹é—´ï¼Œä¸ºæ•°æ®é€šè®¯æä¾›å®‰å…¨æ”¯æŒã€‚</p><p>TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰ï¼šå…¶å‰èº«æ˜¯ SSLï¼Œå®ƒæœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬ï¼ˆSSL 1.0ã€SSL 2.0ã€SSL 3.0ï¼‰ç”±ç½‘æ™¯å…¬å¸å¼€å‘ï¼Œ1999 å¹´ä» 3.1 å¼€å§‹è¢« IETF æ ‡å‡†åŒ–å¹¶æ”¹åï¼Œå‘å±•è‡³ä»Šå·²ç»æœ‰ TLS 1.0ã€TLS 1.1ã€TLS 1.2 ä¸‰ä¸ªç‰ˆæœ¬ã€‚SSL3.0 å’Œ TLS1.0 ç”±äºå­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå·²ç»å¾ˆå°‘è¢«ä½¿ç”¨åˆ°ã€‚TLS 1.3 æ”¹åŠ¨ä¼šæ¯”è¾ƒå¤§ï¼Œç›®å‰è¿˜åœ¨è‰æ¡ˆé˜¶æ®µï¼Œç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯ TLS 1.1ã€TLS 1.2ã€‚</p></blockquote><p>å¯ä»¥ç®€å•è®¤ä¸ºSSLä¸TLSæ˜¯æè¿°çš„åŒä¸€ç§åè®®ï¼Œæœ¬æ–‡ä¸­ä¸åšåŒºåˆ†ï¼ŒSSL/TLSæ˜¯ä¸ºäº†åœ¨TCPè¿æ¥ä¸Šæ·»åŠ ä¸€ä¸ªåŠ å¯†éš§é“æ¥åŠ å¯†é€šä¿¡æµé‡ï¼Œå¯ä»¥ç¡®ä¿é€šä¿¡æµé‡å®‰å…¨æ— æ³•è§£å¯†ã€‚</p><h3 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h3><p>ç”±äºHTTPSçš„TLSå±‚æ˜¯åœ¨TCPä¸Šçš„ï¼Œæ‰€ä»¥ä¸HTTPä¸€æ ·ï¼Œåœ¨å»ºç«‹TLSè¿æ¥ä¹‹å‰å¿…é¡»å…ˆTCPä¸‰æ¬¡æ¡æ‰‹</p><p>HTTPSçš„é€šä¿¡è¿‡ç¨‹å¯ä»¥ç”±ä¸‹å›¾ç®€å•è¡¨ç¤ºã€‚</p><h3 id="æ­¥éª¤è¯¦è§£"><a href="#æ­¥éª¤è¯¦è§£" class="headerlink" title="æ­¥éª¤è¯¦è§£"></a>æ­¥éª¤è¯¦è§£</h3><h4 id="0x01-ClientHello"><a href="#0x01-ClientHello" class="headerlink" title="0x01 ClientHello"></a>0x01 ClientHello</h4><ol><li>ClientHelloã€‚ é¦–å…ˆhttpsè¯·æ±‚æ˜¯åŸºäºhttpçš„ï¼Œä¹Ÿå°±æ˜¯åŸºäºtcpçš„ï¼Œæ‰€ä»¥å…ˆå¾—å»ºç«‹tcpä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿™ä¸ªå°±ä¸è¯´äº†ï¼Œç„¶åtcpæ¡æ‰‹åæ˜¯SSLå±‚çš„æ¡æ‰‹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ClientHelloæ¶ˆæ¯ï¼Œclientå‘é€æœ¬åœ°æœ€æ–°çš„TLSç‰ˆæœ¬ã€ç®—æ³•ç»„åˆçš„ä¸€ä¸ªé›†åˆå’Œå…¶ä»–å¾ˆå¤šè¾…åŠ©çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªéšæœºæ•°Aã€‚</li></ol><p>   <img src= "/img/loading2.gif" data-lazy-src="https:////upload-images.jianshu.io/upload_images/2000804-900ab967d4c437d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="img"></p><p>   ClientHello.png</p><p>   å¯ä»¥çœ‹åˆ°éšæœºæ•°ï¼ˆ</p>   <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Random</span></span><br></pre></td></tr></table></figure><p>   ï¼‰æ˜¯ä¸€ä¸ªGMT UNIXæ—¶é—´åŠ ä¸Šä¸€ä¸²éšæœºå­—èŠ‚ï¼Œç®—æ³•ç»„åˆï¼ˆ</p>   <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cipher Suite</span></span><br></pre></td></tr></table></figure><p>   ï¼‰æœ‰26ç§ã€‚è¿˜æœ‰ClientHelloå¹¶ä¸æ˜¯æˆ‘éšä¾¿å«å«çš„ï¼ŒçœŸçš„å«ClientHelloğŸ˜¢â€¦â€¦</p><ol><li>ServerHelloã€‚Serveræ”¶åˆ°è¿™äº›ä¿¡æ¯åæ¯”å¯¹è‡ªå·±çš„TLSç‰ˆæœ¬ï¼Œé€‰æ‹©å…¶ä¸­ä½çš„ä¸€ä¸ªä½œä¸ºè¿”å›ï¼Œå¹¶ä¸”ä»ç®—æ³•ç»„åˆçš„é›†åˆä¸­é€‰å‡ºä¸€ç§åˆé€‚çš„ç»„åˆï¼Œç„¶ååŒæ ·ä¹Ÿç”Ÿæˆä¸€ä¸ªéšæœºæ•°Bï¼Œä¸€èµ·æ‰“åŒ…åˆ°ServerHelloä¸­ä¼ å›ç»™Clientã€‚å†…å®¹å¦‚å›¾ï¼ˆ<code>ServerHello.png</code>ï¼‰ï¼š</li></ol><p>   <img src= "/img/loading2.gif" data-lazy-src="https:////upload-images.jianshu.io/upload_images/2000804-84e576eff565ee07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="img"></p><p>   ServerHello.png</p><p>   åŒæ ·ServerHelloä¹Ÿä¸æ˜¯éšä¾¿å«çš„ï¼Œå¯ä»¥çœ‹åˆ°éšæœºæ•°æ ¼å¼å’ŒClientHelloä¸€æ ·ï¼Œå¹¶ä¸”è¿™é‡Œé€‰å‡ºäº†ä¸€ç§CipherSuiteç®—æ³•ç»„åˆã€‚</p><ol><li>Certificatie,ServerHelloDoneã€‚æœåŠ¡ç«¯åœ¨é€‰å‡ºæ²Ÿé€šç­–ç•¥ä¹‹åå°†è‡ªå·±çš„è¯ä¹¦ä¿¡æ¯å‘Šè¯‰Clientç«¯ï¼ˆ<code>Certificate</code>ï¼‰ï¼Œé€šçŸ¥Clientå…³äºç§˜é’¥æ›´æ–°çš„ä¿¡æ¯ï¼ˆ<code>ServerkeyExchange</code>ï¼‰ï¼Œæ¥ä¸‹å»å°±çœ‹ä½ çš„äº†ï¼Œå¹¶ä¸”è¡¨ç¤ºè¯¥å‘çš„éƒ½å‘ç»™ä½ äº†ï¼Œæˆ‘çš„Helloç»“æŸäº†ï¼ˆ<code>ServerHelloDone</code>ï¼‰ã€‚</li></ol><p>   <img src= "/img/loading2.gif" data-lazy-src="https:////upload-images.jianshu.io/upload_images/2000804-d472cf46f4216b0b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="img"></p><p>   Certificate-ServerHelloDone.png</p><ol><li><p>Clientæ”¶åˆ°2ï¼Œ3æ­¥çš„ä¿¡æ¯åå…ˆéªŒè¯è¯ä¹¦æ˜¯ä¸æ˜¯åˆæ³•çš„ï¼ŒåŒ…æ‹¬å®ƒçš„é¢å‘æœºæ„ï¼ŒåŸŸååŒ¹é…ï¼Œæœ‰é™æœŸé™ç­‰ï¼Œè¿™ä¸ªå…·ä½“çš„è¿‡ç¨‹å°±ä¸æ¢ç©¶äº†ï¼Œåªè¦çŸ¥é“è¿™äº›æ­¥éª¤å°±è¡Œäº†ã€‚</p></li><li><p>è¯ä¹¦éªŒè¯é€šè¿‡ä¹‹åï¼Œç”Ÿæˆéšæœºæ•°C1,ç„¶åç”¨è¯ä¹¦å†…å®¹ä¸­çš„å…¬é’¥é€šè¿‡æœåŠ¡å™¨é€‰æ‹©çš„éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ï¼Œå¾—å‡ºä¸ºC2ã€‚</p></li><li><p>ç”±ä¹‹å‰çš„ä¸‰ä¸ªéšæœºæ•°Aã€Bã€C1é€šè¿‡ä¸€ä¸ªä¼ªéšæœºå‡½æ•°å†ç”Ÿæˆä¸€ä¸ªDï¼Œ<strong>æ³¨æ„ï¼è¿™ä¸ªæ˜¯æœ€ç»ˆhttpçœŸæ­£ä½¿ç”¨çš„åŠ å¯†ç§˜é’¥ï¼ï¼ï¼</strong>ã€‚</p></li><li><p>ç”±Då†æ¬¡é€šè¿‡ä¼ªéšæœºå‡½æ•°ç”Ÿæˆä¸€ä¸ªç§˜é’¥ç»„ï¼ŒåŒ…å«6ä¸ªç§˜é’¥ï¼Œå‡è®¾ä¸ºP1,P2,P3,P4,P5,P6ã€‚</p></li><li><p>ClientKeyExchangeã€‚é€šçŸ¥Serverç§˜é’¥ç›¸å…³çš„ä¿¡æ¯ï¼Œå‘é€ç¬¬5æ­¥ä¸­ç®—å‡ºçš„C2ç»™Serverç«¯ã€‚</p></li><li><p>Clientç«¯å‘é€ClientKeyExchangeä¹‹åï¼Œè®¡ç®—ä¹‹å‰æ‰€æœ‰ä¸Serverç«¯äº¤äº’æ¶ˆæ¯çš„hashå€¼ï¼Œå‡è®¾ä¸ºclient_hash1ï¼Œç”¨æ­¥éª¤7ä¸­å¾—åˆ°çš„å…¶ä¸­ä¸€ä¸ªP1è¿›è¡ŒåŠ å¯†ï¼Œç»“æœä¸ºEã€‚</p></li><li><p>Serverç«¯æ”¶åˆ°C2åç”¨ç§é’¥ç»“åˆéå¯¹ç§°ç®—æ³•è§£å¯†C2ï¼Œå¾—åˆ°C1ã€‚</p></li><li><p>åŒæ ·çš„Serverç«¯ä¹Ÿæ ¹æ®Aã€Bã€C1ç”±ä¼ªéšæœºå‡½æ•°ç”ŸæˆD(<strong>æœ€ç»ˆçš„åŠ å¯†ç§˜é’¥ï¼ï¼ï¼</strong>),å†ç”±Då¾—å‡ºç§˜ç»„é’¥ï¼ˆP1-P6ï¼‰ï¼Œå› ä¸ºè¿™é‡Œæ¶‰åŠåˆ°çš„ç®—æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¾—å‡ºçš„ç§˜é’¥ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p></li><li><p>Serverç«¯è®¡ç®—ä¹‹å‰æ‰€æœ‰å’ŒClientç«¯äº¤äº’æ¶ˆæ¯çš„hashå€¼ï¼Œå‡è®¾ä¸ºserver_hash2ï¼Œå¤§å®¶å¯èƒ½å‘ç°äº†ï¼Œ11ã€12è·ŸClientç«¯çš„6ã€7ã€9è¿‡ç¨‹ä¸€è‡´ï¼Œåªæ˜¯å°‘äº†9ä¸­çš„P1åŠ å¯†è¿‡ç¨‹ã€‚</p></li><li><p>è¿™ä¸ªæ—¶å€™Clientç«¯ä¼šå‘é€ChangeCipherSpecæ¶ˆæ¯å’ŒEncryptedHandshakeMessageæ¶ˆæ¯ï¼Œé€šçŸ¥Serverç«¯æ¥ä¸‹å»ä½¿ç”¨é€‰å®šçš„åŠ å¯†ç­–ç•¥æ¥é€šä¿¡äº†ï¼Œå¹¶ä¸”å°†ç¬¬9æ­¥ä¸­çš„Eä¼ ç»™äº†Serverã€‚ï¼ˆè¿™é‡Œå‡ ä¸ªæ­¥éª¤çš„é¡ºåºåªæ˜¯ä¸ºäº†å¥½ç†è§£ä¸€ç‚¹è€Œè¿™æ ·æ’åˆ—ï¼Œå®é™…ä¸¤æ¡çº¿æ˜¯ç‹¬ç«‹åœ¨å¤„ç†ä¿¡æ¯çš„ï¼Œæ‰€ä»¥å…ˆåé¡ºåºä¸èƒ½ä¿è¯ï¼‰</p></li><li><p>è¿™ä¸ªæ—¶å€™Clientä¼šå†æ¬¡è®¡ç®—ä¹‹å‰æ¡æ‰‹æ¶ˆæ¯çš„hashå€¼ï¼Œå¾—å‡ºç»“æœclient_hash2ã€‚</p></li><li><p>Serveråœ¨æ”¶åˆ°EncryptedHandshakeMessageæ¶ˆæ¯å¸¦è¿‡æ¥çš„Eä¹‹åï¼Œåˆ©ç”¨æ­¥éª¤11ä¸­çš„P1è§£å¯†Eï¼Œç”±äºåŠ å¯†ç®—æ³•å’ŒP1éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜åŸå‡ºäº†client_hash1ï¼Œç„¶åä¸æ­¥éª¤12ä¸­çš„server_hash2æ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·è¯´æ˜ä¹‹å‰çš„å‡ æ¡åå•†ç§˜é’¥çš„æ¶ˆæ¯éƒ½è¢«å¯¹æ–¹æ­£ç¡®æ— è¯¯çš„ç†è§£äº†ã€‚</p></li><li><p>Serverç«¯å†æ¬¡å¯¹ä¹‹å‰çš„æ¶ˆæ¯åšhashå€¼ï¼Œå¾—å‡ºserver_hash2ï¼Œç”¨P2è¿›è¡ŒåŠ å¯†ç»“æœä¸ºFï¼Œç„¶åé€šè¿‡ChangeCipherSpec-EncryptedHandshakeMessageæ¶ˆæ¯ä¼ ç»™Clientç«¯ã€‚</p></li><li><p>Clientæ”¶åˆ°Serverçš„æ¶ˆæ¯åæ ¹æ®P2è§£å¯†Fè¿˜åŸå¾—å‡ºserver_hash2ï¼Œä¸client_hash2æ¯”å¯¹å¦‚æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºä¹‹å‰çš„äº¤äº’è¿‡ç¨‹éƒ½æ˜¯æ­£ç¡®æ— è¯¯ä¸”è¢«å¯¹æ–¹ç†è§£çš„ã€‚è‡³æ­¤ï¼Œæ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œä¹‹åçš„httpæ•°æ®æŠ¥å°±ä¼šè¢«ä¹‹å‰ç¡®å®šçš„åŠ å¯†ç­–ç•¥å’ŒåŠ å¯†ç§˜é’¥Dè¿›è¡ŒåŠ å¯†ä¼ è¾“äº†ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP/HTTPS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸­çš„this</title>
      <link href="/2016/10/30/javascript/JavaScript%E4%B8%AD%E7%9A%84this/"/>
      <url>/2016/10/30/javascript/JavaScript%E4%B8%AD%E7%9A%84this/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬ç”±ä¸€æ®µä»£ç å¼€å§‹æœ¬æ–‡çš„ä¸»é¢˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  foo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.bar) </span><br><span class="line">  &#125;,</span><br><span class="line">  bar: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = obj.foo;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="number">2</span>;</span><br><span class="line">foo === obj.foo <span class="comment">//true</span></span><br><span class="line">obj.foo() <span class="comment">// 1</span></span><br><span class="line">foo() <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>foo</code>å’Œ<code>obj.foo</code>å®é™…ä¸Šæ˜¯ä¸¥æ ¼ç›¸ç­‰çš„ï¼Œå®ƒä»¬æ˜¯æŒ‡å‘åŒä¸€ä¸ªä»£ç æ®µã€‚ç”±äº<strong>ä¸Šä¸‹æ–‡ç¯å¢ƒ</strong>ä¸åŒï¼Œæ‰€ä»¥ä»–ä»¬è¿è¡Œçš„ç»“æœä¹Ÿä¸ä¸€æ ·ã€‚<code>obj.foo</code>çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå°±æ˜¯<code>this</code>æŒ‡å‘çš„<code>obj</code>ï¼Œè€Œ<code>foo</code>çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯å…¨å±€ç¯å¢ƒã€‚</p><a id="more"></a><h2 id="JavaScriptçš„å†…å­˜æ•°æ®ç»“æ„"><a href="#JavaScriptçš„å†…å­˜æ•°æ®ç»“æ„" class="headerlink" title="JavaScriptçš„å†…å­˜æ•°æ®ç»“æ„"></a>JavaScriptçš„å†…å­˜æ•°æ®ç»“æ„</h2><p>æˆ‘ä»¬éœ€è¦æ·±å…¥åˆ°JavaScriptçš„å†…å­˜æ•°æ®ç»“æ„å»å¯»æ‰¾ç­”æ¡ˆã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">foo</span>:<span class="number">1</span> &#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠä¸€ä¸ªå¯¹è±¡<code>&#123; foo:1 &#125;</code>èµ‹å€¼ç»™å¯¹è±¡<code>obj</code>ã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šæ˜¯JavaScriptå¼•æ“åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª<code>&#123; foo:1 &#125;</code>ç„¶åå†æŠŠè¿™ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€èµ‹å€¼ç»™<code>obj</code>ã€‚</p><p>è¿™å…¶å®å°±è·ŸCè¯­è¨€ä¸­çš„æŒ‡é’ˆæ¦‚å¿µç›¸ä¼¼ï¼Œå…ˆåˆ†é…ä¸€å—å†…å­˜ï¼Œåˆå§‹åŒ–åï¼ŒæŠŠå†…å­˜çš„åœ°å€èµ‹ç»™ä¸€ä¸ªæŒ‡é’ˆã€‚<code>obj</code>èµ·çš„å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„ä½œç”¨ï¼Œå®ƒä¿å­˜ä¸€ä¸ªåœ°å€ï¼ŒJavaScriptå¼•æ“è¯»å–å®ƒæ—¶æ˜¯ç›´æ¥ä»<code>obj</code>ä¸­å–å†…å­˜åœ°å€ï¼Œç„¶åå†å»æ”¹åœ°å€å–åŸå§‹å¯¹è±¡ã€‚</p><p>åŸå§‹å¯¹è±¡ä»¥å­—å…¸ç»“æ„å­˜å‚¨ã€‚å¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§ä¹Ÿéƒ½å¯¹åº”ä¸€ä¸ªå±æ€§æè¿°å¯¹è±¡ã€‚<code>value</code>ä¿å­˜çš„æ˜¯å±æ€§çš„å€¼ã€‚</p><h2 id="å‡½æ•°çš„å†…å­˜ç»“æ„"><a href="#å‡½æ•°çš„å†…å­˜ç»“æ„" class="headerlink" title="å‡½æ•°çš„å†…å­˜ç»“æ„"></a>å‡½æ•°çš„å†…å­˜ç»“æ„</h2><p>å¦‚æœå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">bar</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; &#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å‡½æ•°å…¶å®å°±æ˜¯å±æ€§çš„å€¼ï¼Œå‡½æ•°åœ¨è®¡ç®—æœºä¸­å®é™…ä¸Šå°±æ˜¯ä¸€æ®µä»£ç æ®µï¼Œå®ƒå æ®ç€ä¸€æ®µå†…å­˜ã€‚æ­¤æ—¶å±æ€§çš„å€¼å¹¶ä¸æ˜¯ç›´æ¥ä¿å­˜è¿™æ®µä»£ç æ®µï¼Œè€Œæ˜¯ä¿å­˜å®ƒå¯¹åº”çš„å†…å­˜åœ°å€ï¼Œå±æ€§æ˜¯æŒ‡å‘è¿™ä¸ªå‡½æ•°çš„æŒ‡é’ˆã€‚</p><p>é‚£ä¹ˆè¿è¡Œ<code>bar=obj.bar</code>ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿåªæ˜¯æŠŠ<code>bar</code>è¿™ä¸ªå˜é‡ä¹ŸæŒ‡å‘äº†<code>obj.bar</code>æŒ‡å‘çš„å‡½æ•°æ‰€å æ®çš„å†…å­˜çš„åœ°å€ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº†ï¼Œå‡½æ•°åªæ˜¯ä¸€ä¸ªå†…å­˜ä¸­å­˜å‚¨çš„ä»£ç æ®µï¼ˆæ‰§è¡Œé€»è¾‘ï¼‰ï¼Œå®ƒå¯ä»¥åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡(è¿è¡Œç¯å¢ƒ)ä¸­æ‰§è¡Œã€‚</p><h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>å‡½æ•°å¦‚ä½•è·å¾—ä¸Šä¸‹æ–‡(context)å‘¢ï¼Ÿ<code>this</code>æ­£æ˜¯èµ·è¿™ä¸ªä½œç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.x);</span><br><span class="line">&#125; <span class="comment">//è¯¥ä»£ç æ®µè¢«ä¿å­˜äºä¸€ä¸ªå†…å­˜åŒºåŸŸA</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  f: f, <span class="comment">//æŒ‡å‘A</span></span><br><span class="line">  x: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// thisæŒ‡ä»£å½“å‰ä¸Šä¸‹æ–‡ å³å…¨å±€ç¯å¢ƒ</span></span><br><span class="line">f() <span class="comment">// this.x==(global).x==1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// thisæŒ‡ä»£obj</span></span><br><span class="line">obj.f() <span class="comment">// this.x==obj.x==2</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‡½æ•°çš„æ—¶å€™ä¼šæ£€æŸ¥è°ƒç”¨å‡½æ•°çš„æŒ‡é’ˆçš„ä¸Šä¸‹æ–‡ï¼Œè€Œå‡½æ•°ä¸­çš„<code>this</code>æŒ‡ä»£çš„æ­£æ˜¯è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæ‰€åœ¨çš„ä¸Šä¸‹æ–‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸­çš„callã€applyå’Œbind</title>
      <link href="/2016/10/17/javascript/Javascript%E4%B8%AD%E7%9A%84call%E3%80%81apply%E5%92%8Cbind/"/>
      <url>/2016/10/17/javascript/Javascript%E4%B8%AD%E7%9A%84call%E3%80%81apply%E5%92%8Cbind/</url>
      
        <content type="html"><![CDATA[<h2 id="apply-amp-call"><a href="#apply-amp-call" class="headerlink" title="apply &amp; call"></a>apply &amp; call</h2><blockquote><p>åœ¨ JavaScriptä¸­ï¼Œcall å’Œ apply éƒ½æ˜¯ä¸ºäº†æ”¹å˜æŸä¸ªå‡½æ•°è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰è€Œå­˜åœ¨çš„ </p></blockquote><p><strong>åœ¨JavaScriptä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡</strong>ï¼ŒåŒ…æ‹¬å‡½æ•°ã€‚å‡½æ•°å­˜åœ¨ã€Œå®šä¹‰æ—¶ä¸Šä¸‹æ–‡ã€å’Œã€Œè¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€ä»¥åŠã€Œä¸Šä¸‹æ–‡æ˜¯å¯ä»¥æ”¹å˜çš„ã€è¿™æ ·çš„æ¦‚å¿µã€‚</p><a id="more"></a><p>ä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">people</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line">people.prototype = &#123;</span><br><span class="line">    name: <span class="string">&quot;ming&quot;</span>,</span><br><span class="line">    say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;My name is &quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> people;</span><br><span class="line">a.say();    <span class="comment">//My name is ming</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯¹è±¡<code>b=&#123;name:&quot;su&quot;&#125;</code>ï¼Œä¸æƒ³é‡æ–°å®šä¹‰<code>say</code>æ–¹æ³•ï¼Œ é‚£ä¹ˆå¯ä»¥é€šè¿‡<code>call</code>æˆ–è€…<code>apply</code>æ–¹æ³•ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b=&#123;</span><br><span class="line">name:<span class="string">&quot;su&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">a.say.call(b); <span class="comment">//My name is su</span></span><br><span class="line">a.say.apply(b); <span class="comment">//My name is su</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º<code>call</code>å’Œ<code>apply</code>éƒ½æ˜¯ä¸ºäº†åŠ¨æ€æ”¹å˜<code>this</code>è€Œå‡ºç°çš„ã€‚å½“ä¸€ä¸ª<code>object</code>æ²¡æœ‰æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥å€ŸåŠ©callæˆ–applyç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•æ¥æ“ä½œã€‚</p><h3 id="applyå’Œcallçš„åŒºåˆ«"><a href="#applyå’Œcallçš„åŒºåˆ«" class="headerlink" title="applyå’Œcallçš„åŒºåˆ«"></a>applyå’Œcallçš„åŒºåˆ«</h3><p>å¯¹äº <code>apply</code>ã€<code>call</code> äºŒè€…è€Œè¨€ï¼Œä½œç”¨å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯æ¥å—å‚æ•°çš„æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123;</span><br><span class="line">     </span><br><span class="line">&#125;;</span><br><span class="line">func.call(<span class="built_in">this</span>, arg1, arg2);</span><br><span class="line">func.apply(<span class="built_in">this</span>, [arg1, arg2])</span><br></pre></td></tr></table></figure><p><code>call</code> éœ€è¦æŠŠå‚æ•°æŒ‰é¡ºåºä¼ é€’è¿›å»ï¼Œè€Œ <code>apply</code> åˆ™æ˜¯æŠŠå‚æ•°æ”¾åœ¨æ•°ç»„é‡Œã€‚ã€€</p><p>æ˜ç¡®çŸ¥é“å‚æ•°æ•°é‡æ—¶ç”¨ <code>call</code> ã€‚è€Œä¸ç¡®å®šçš„æ—¶å€™ç”¨ <code>apply</code>ï¼Œç„¶åæŠŠå‚æ•° <code>push</code> è¿›æ•°ç»„ä¼ é€’è¿›å»ã€‚å½“å‚æ•°æ•°é‡ä¸ç¡®å®šæ—¶ï¼Œå‡½æ•°å†…éƒ¨ä¹Ÿå¯ä»¥é€šè¿‡ <code>arguments</code> è¿™ä¸ªä¼ªæ•°ç»„æ¥éå†æ‰€æœ‰çš„å‚æ•°ã€‚</p><ul><li><p><strong>æ•°ç»„è¿½åŠ </strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array1 = [<span class="number">12</span> , <span class="string">&quot;foo&quot;</span> , &#123;name <span class="string">&quot;Joe&quot;</span>&#125; , <span class="number">-2458</span>]; </span><br><span class="line"><span class="keyword">var</span> array2 = [<span class="string">&quot;Doe&quot;</span> , <span class="number">555</span> , <span class="number">100</span>]; </span><br><span class="line"><span class="built_in">Array</span>.prototype.push.apply(array1, array2); </span><br><span class="line"><span class="comment">/* array1 å€¼ä¸º  [12 , &quot;foo&quot; , &#123;name &quot;Joe&quot;&#125; , -2458 , &quot;Doe&quot; , 555 , 100] */</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>è·å–æ•°ç»„æœ€å¤§æœ€å°å€¼</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  numbers = [<span class="number">5</span>, <span class="number">458</span> , <span class="number">120</span> , <span class="number">-215</span> ]; </span><br><span class="line"><span class="keyword">var</span> maxInNumbers = <span class="built_in">Math</span>.max.apply(<span class="built_in">Math</span>, numbers),   <span class="comment">//458</span></span><br><span class="line">    maxInNumbers = <span class="built_in">Math</span>.max.call(<span class="built_in">Math</span>,<span class="number">5</span>, <span class="number">458</span> , <span class="number">120</span> , <span class="number">-215</span>); <span class="comment">//458</span></span><br></pre></td></tr></table></figure><p><code>number</code> æœ¬èº«æ²¡æœ‰ <code>max</code> æ–¹æ³•ï¼Œä½†æ˜¯ <code>Math</code> æœ‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ© <code>call</code> æˆ–è€… <code>apply</code> ä½¿ç”¨å…¶æ–¹æ³•ã€‚</p></li><li><p><strong>éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">functionisArray(obj)&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">&#x27;[object Array]&#x27;</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>ç±»ï¼ˆä¼ªï¼‰æ•°ç»„ä½¿ç”¨æ•°ç»„æ–¹æ³•</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> domNodes = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;*&quot;</span>));</span><br></pre></td></tr></table></figure><p>JavaScriptä¸­å­˜åœ¨ä¸€ç§åä¸ºä¼ªæ•°ç»„çš„å¯¹è±¡ç»“æ„ã€‚æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ <code>arguments</code> å¯¹è±¡ï¼Œè¿˜æœ‰åƒè°ƒç”¨ <code>getElementsByTagName</code> , <code>document.childNodes</code> ä¹‹ç±»çš„ï¼Œå®ƒä»¬è¿”å›NodeListå¯¹è±¡éƒ½å±äºä¼ªæ•°ç»„ã€‚ä¸èƒ½åº”ç”¨ <code>Array</code>ä¸‹çš„ <code>push</code> , <code>pop</code> ç­‰æ–¹æ³•ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬èƒ½é€šè¿‡ <code>Array.prototype.slice.call</code>è½¬æ¢ä¸ºçœŸæ­£çš„æ•°ç»„çš„å¸¦æœ‰ <code>length</code> å±æ€§çš„å¯¹è±¡ï¼Œè¿™æ · domNodes å°±å¯ä»¥åº”ç”¨ <code>Array</code> ä¸‹çš„æ‰€æœ‰æ–¹æ³•äº†ã€‚</p></li></ul><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><ul><li><p>ç”¨<code>log</code>æ¥ä»£ç†<code>console.log</code></p><p>ç”±äºä¼ å…¥å‚æ•°ä¸ç¡®å®šï¼Œæ‰€ä»¥æ™®é€šçš„æ–¹æ³•å¯¹äºå¤šä¸ªå‚æ•°æ˜¯å¤±æ•ˆçš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">msg</span>)ã€€</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;</span><br><span class="line">log(<span class="number">1</span>);    <span class="comment">//1</span></span><br><span class="line">log(<span class="number">1</span>,<span class="number">2</span>);    <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>arguments</code>å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå¯ä»¥æŠŠ<code>arguments</code>ä¼ å…¥<code>apply</code>æ–¹æ³•ä¸­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log.apply(<span class="built_in">console</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br><span class="line">log(<span class="number">1</span>);    <span class="comment">//1</span></span><br><span class="line">log(<span class="number">1</span>,<span class="number">2</span>);    <span class="comment">//1 2</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>ä¸<code>call</code>ã€<code>apply</code>ä¸€æ ·ï¼Œ<code>bind</code> ä¹Ÿå¯ä»¥æ”¹å˜å‡½æ•°ä½“å†…<code>this</code>çš„æŒ‡å‘ã€‚</p><blockquote><p>bind()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œç§°ä¸ºç»‘å®šå‡½æ•°ï¼Œå½“è°ƒç”¨è¿™ä¸ªç»‘å®šå‡½æ•°æ—¶ï¼Œç»‘å®šå‡½æ•°ä¼šä»¥åˆ›å»ºå®ƒæ—¶ä¼ å…¥ bind()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸º thisï¼Œä¼ å…¥ bind() æ–¹æ³•çš„ç¬¬äºŒä¸ªä»¥åŠä»¥åçš„å‚æ•°åŠ ä¸Šç»‘å®šå‡½æ•°è¿è¡Œæ—¶æœ¬èº«çš„å‚æ•°æŒ‰ç…§é¡ºåºä½œä¸ºåŸå‡½æ•°çš„å‚æ•°æ¥è°ƒç”¨åŸå‡½æ•°ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    bar : <span class="number">1</span>,</span><br><span class="line">    eventBind: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">        $(<span class="string">&#x27;.someClass&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="comment">/* Act on the event */</span></span><br><span class="line">            <span class="built_in">console</span>.log(_this.bar);     <span class="comment">//1</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº JavaScriptç‰¹æœ‰çš„æœºåˆ¶ï¼Œä¸Šä¸‹æ–‡ç¯å¢ƒåœ¨ <code>eventBind:function()&#123; &#125;</code> è¿‡æ¸¡åˆ° <code>$(&#39;.someClass&#39;).on(&#39;click&#39;,function(event) &#123; &#125;)</code> å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸Šè¿°ä½¿ç”¨å˜é‡ä¿å­˜ <code>this</code> è¿™äº›æ–¹å¼éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å½“ç„¶ä½¿ç”¨ <code>bind()</code> å¯ä»¥æ›´åŠ ä¼˜é›…çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    bar : <span class="number">1</span>,</span><br><span class="line">    eventBind: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&#x27;.someClass&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="comment">/* Act on the event */</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.bar);      <span class="comment">//1</span></span><br><span class="line">        &#125;.bind(<span class="built_in">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç é‡Œï¼Œ<code>bind()</code> åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œå½“è¿™ä¸ª<code>click</code>äº‹ä»¶ç»‘å®šåœ¨è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„ <code>this</code> å…³é”®è¯ä¼šè¢«è®¾ç½®æˆè¢«ä¼ å…¥çš„å€¼ï¼ˆè¿™é‡ŒæŒ‡è°ƒç”¨<code>bind()</code>æ—¶ä¼ å…¥çš„å‚æ•°ï¼‰ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼ å…¥æƒ³è¦çš„ä¸Šä¸‹æ–‡ <code>this</code>(å…¶å®å°±æ˜¯ foo )ï¼Œåˆ° <code>bind()</code> å‡½æ•°ä¸­ã€‚ç„¶åï¼Œå½“å›è°ƒå‡½æ•°è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œ <code>this</code> ä¾¿æŒ‡å‘ <code>foo</code> å¯¹è±¡ã€‚å†æ¥ä¸€ä¸ªç®€å•çš„æ —å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">x:<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">bar(); <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> func = bar.bind(foo);</span><br><span class="line">func(); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‡½æ•° <code>func</code>ï¼Œå½“ä½¿ç”¨ <code>bind()</code> åˆ›å»ºä¸€ä¸ªç»‘å®šå‡½æ•°ä¹‹åï¼Œå®ƒè¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒçš„ <code>this</code> ä¼šè¢«è®¾ç½®æˆ <code>foo</code> ï¼Œ è€Œä¸æ˜¯åƒæˆ‘ä»¬è°ƒç”¨ <code>bar()</code> æ—¶çš„å…¨å±€ä½œç”¨åŸŸã€‚</p><p>å¦‚æœ<code>bind</code>å¤šæ¬¡ä¼šå¦‚ä½•ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    x:<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sed = &#123;</span><br><span class="line">    x:<span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> func = bar.bind(foo).bind(sed);</span><br><span class="line">func(); <span class="comment">//3</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> fiv = &#123;</span><br><span class="line">    x:<span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> func = bar.bind(foo).bind(sed).bind(fiv);</span><br><span class="line">func(); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>ä»æ—§è¾“å‡º3ã€‚åŸå› åœ¨äºbind()ç›¸å½“ä½¿ç”¨å‡½æ•°åœ¨å†…éƒ¨åŒ…äº†ä¸€ä¸ª<code>call/apply</code>ï¼Œå¾€å <code>bind()</code> ç›¸å½“äºå†åŒ…ä½ç¬¬ä¸€æ¬¡ <code>bind()</code> ,æ•…ç¬¬äºŒæ¬¡ä»¥åçš„ <code>bind</code> æ˜¯æ— æ³•ç”Ÿæ•ˆçš„ã€‚</p><h2 id="applyã€callã€bindæ¯”è¾ƒ"><a href="#applyã€callã€bindæ¯”è¾ƒ" class="headerlink" title="applyã€callã€bindæ¯”è¾ƒ"></a>applyã€callã€bindæ¯”è¾ƒ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    x: <span class="number">81</span>,</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    getX: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(foo.getX.bind(obj)());  <span class="comment">//81</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.getX.call(obj));    <span class="comment">//81</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.getX.apply(obj));   <span class="comment">//81</span></span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªéƒ½å¯ä»¥æ”¹å˜ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä½†<code>bind</code>å¹¶éç«‹åˆ»æ‰§è¡Œ(éœ€è¦è°ƒç”¨)ï¼Œè€Œ<code>call</code>å’Œ<code>apply</code>éƒ½æ˜¯ç«‹å³æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxé…ç½®åˆæ­¥</title>
      <link href="/2016/10/10/Nginx/Nginx%E9%85%8D%E7%BD%AE%E5%88%9D%E6%AD%A5/"/>
      <url>/2016/10/10/Nginx/Nginx%E9%85%8D%E7%BD%AE%E5%88%9D%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„WebæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±äºå®ƒçš„å†…å­˜å ç”¨å°‘ï¼Œå¯åŠ¨æå¿«ï¼Œé«˜å¹¶å‘èƒ½åŠ›å¼ºï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚è¿™é‡Œå®è·µä¸€ä¸‹nginxçš„é…ç½®</p><a id="more"></a><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä¸‹è½½å¿…è¦ç»„ä»¶</p><ul><li><p>nginxä¸‹è½½åœ°å€</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>nginx.org<span class="regexp">/en/</span>download.html</span><br></pre></td></tr></table></figure></li><li><p>pcreåº“ä¸‹è½½åœ°å€ï¼Œnginxéœ€è¦</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>sourceforge.net<span class="regexp">/projects/</span>pcre<span class="regexp">/files/</span>pcre/</span><br></pre></td></tr></table></figure></li><li><p>zlibä¸‹è½½åœ°å€ï¼Œnginxéœ€è¦</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>www.zlib.net/</span><br></pre></td></tr></table></figure></li><li><p>opensslä¸‹è½½åœ°å€ï¼Œnginxéœ€è¦</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/openssl/</span>openssl</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨åŒçº§ç›®å½•ä¸‹,è§£å‹å®‰è£…zlibã€opensslã€pcre</p><p>è¿›å…¥nginxç›®å½•ï¼Œè¿›è¡Œé…ç½®å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./configure \</span><br><span class="line"> --prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line"> --with-http_ssl_module \</span><br><span class="line"> --with-http_flv_module \</span><br><span class="line"> --with-http_stub_status_module \</span><br><span class="line"> --with-http_gzip_static_module \</span><br><span class="line"> --with-pcre=../pcre-8.39 \</span><br><span class="line"> --with-zlib=../zlib-1.2.8 \ </span><br><span class="line"> --with-openssl=../openssl-master</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¯ç›´æ¥å¤åˆ¶ç²˜è´´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx --with-http_ssl_module --with-http_flv_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre=../pcre-8.39 --with-zlib=../zlib-1.2.8 --with-openssl=../openssl-master</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><p>Nginxä¼šè¢«å®‰è£…åœ¨/usr/local/nginxç›®å½•ä¸‹ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•°â€”prefix=æŒ‡å®šè‡ªå·±éœ€è¦çš„ä½ç½®ï¼‰ï¼Œ å®‰è£…æˆåŠŸå /usr/local/nginx ç›®å½•ä¸‹æœ‰å››ä¸ªå­ç›®å½•åˆ†åˆ«æ˜¯ï¼šconfã€htmlã€logsã€sbin ã€‚ å…¶ä¸­ Nginx çš„é…ç½®æ–‡ä»¶å­˜æ”¾äº conf/nginx.confï¼Œ binæ–‡ä»¶æ˜¯ä½äº sbin ç›®å½•ä¸‹çš„ nginx æ–‡ä»¶ã€‚ ç¡®ä¿ç³»ç»Ÿçš„ 80 ç«¯å£æ²¡è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼Œè¿è¡Œ sbin/nginx å‘½ä»¤æ¥å¯åŠ¨ Nginxï¼Œ</p><p>å¯åŠ¨nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br><span class="line">    <span class="comment">#netstat -ano|grep 80</span></span><br><span class="line">        tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      å…³é—­ (0.00/0/0)</span><br><span class="line">        unix  17     [ ]         æ•°æ®æŠ¥                10801    /dev/<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®æ­¤æœºå™¨çš„ IPï¼Œå¦‚æœæµè§ˆå™¨å‡ºç° Welcome to nginx! åˆ™è¡¨ç¤º Nginx å·²ç»å®‰è£…å¹¶è¿è¡ŒæˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin/nginx -t </span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°ç¼–è¯‘é€‰é¡¹</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin/nginx -V</span><br><span class="line"><span class="comment">#é‡å¯Nginx</span></span><br><span class="line">sudo /usr/<span class="built_in">local</span>/sbin/nginx -s reload</span><br><span class="line"><span class="comment">#å…³é—­Nginx</span></span><br><span class="line">sudo /usr/<span class="built_in">local</span>/sbin/nginx -s stop</span><br><span class="line"><span class="comment">#ä¼˜é›…åœæ­¢æœåŠ¡</span></span><br><span class="line">sudo /usr/<span class="built_in">local</span>/sbin/nginx -s quit</span><br><span class="line"><span class="built_in">kill</span> -s SIGQUIT pid_master</span><br><span class="line"><span class="built_in">kill</span> -s SIGWINCH pid_master</span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>nginx.confé…ç½®æ–‡ä»¶,åŸºæœ¬å°±åˆ†ä¸ºä»¥ä¸‹å‡ å—ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">main</span><br><span class="line"><span class="section">events</span>   &#123;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span>        &#123;</span><br><span class="line">  ....</span><br><span class="line">  <span class="attribute">upstream</span> myproject &#123;</span><br><span class="line">    .....</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">server</span>  &#123;</span><br><span class="line">    ....</span><br><span class="line">    <span class="section">location</span> &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">server</span>  &#123;</span><br><span class="line">    ....</span><br><span class="line">    <span class="section">location</span> &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†ä¸ºå…­ä¸ªåŒºåŸŸï¼š</p><ul><li>main(å…¨å±€è®¾ç½®)</li><li>events(nginxå·¥ä½œæ¨¡å¼)</li><li>http(httpè®¾ç½®)</li><li>sever(ä¸»æœºè®¾ç½®)</li><li>location(URLåŒ¹é…)</li><li>upstream(è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®)</li></ul><p>ä¸‹é¢ä¾æ¬¡æ¥çœ‹ä¸‹å…·ä½“å†…å®¹</p><ul><li>mainæ¨¡å—</li></ul><p>ä¸‹é¢æ—¶ä¸€ä¸ªmainåŒºåŸŸï¼Œä»–æ˜¯ä¸€ä¸ªå…¨å±€çš„è®¾ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> nobody nobody;</span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">2</span>;</span><br><span class="line"><span class="attribute">error_log</span>  /usr/local/var/log/nginx/error.log  <span class="literal">notice</span>;</span><br><span class="line"><span class="attribute">pid</span>        /usr/local/var/run/nginx/nginx.pid;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">1024</span>;</span><br></pre></td></tr></table></figure><p>user æ¥æŒ‡å®šNginx Workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„ï¼Œé»˜è®¤ç”±nobodyè´¦å·è¿è¡Œã€‚</p><p>worker_processesæ¥æŒ‡å®šäº†Nginxè¦å¼€å¯çš„å­è¿›ç¨‹æ•°ã€‚æ¯ä¸ªNginxè¿›ç¨‹å¹³å‡è€—è´¹10M~12Må†…å­˜ã€‚æ ¹æ®ç»éªŒï¼Œä¸€èˆ¬æŒ‡å®š1ä¸ªè¿›ç¨‹å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœæ˜¯å¤šæ ¸CPUï¼Œå»ºè®®æŒ‡å®šå’ŒCPUçš„æ•°é‡ä¸€æ ·çš„è¿›ç¨‹æ•°å³å¯ã€‚æˆ‘è¿™é‡Œå†™2ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å¯2ä¸ªå­è¿›ç¨‹ï¼Œæ€»å…±3ä¸ªè¿›ç¨‹ã€‚</p><p>error_logç”¨æ¥å®šä¹‰å…¨å±€é”™è¯¯æ—¥å¿—æ–‡ä»¶ã€‚æ—¥å¿—è¾“å‡ºçº§åˆ«æœ‰debugã€infoã€noticeã€warnã€errorã€critå¯ä¾›é€‰æ‹©ï¼Œå…¶ä¸­ï¼Œdebugè¾“å‡ºæ—¥å¿—æœ€ä¸ºæœ€è¯¦ç»†ï¼Œè€Œcritè¾“å‡ºæ—¥å¿—æœ€å°‘ã€‚</p><p>pidç”¨æ¥æŒ‡å®šè¿›ç¨‹idçš„å­˜å‚¨æ–‡ä»¶ä½ç½®ã€‚</p><p>worker_rlimit_nofileç”¨äºæŒ‡å®šä¸€ä¸ªnginxè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œè¿™é‡Œæ˜¯65535ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤â€œulimit -n 65535â€æ¥è®¾ç½®ã€‚</p><ul><li>events æ¨¡å—</li></ul><p>eventsæ¨¡å—æ¥ç”¨æŒ‡å®šnginxçš„å·¥ä½œæ¨¡å¼å’Œå·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™ï¼Œä¸€èˆ¬æ˜¯è¿™æ ·ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>; <span class="comment">#Linuxå¹³å°</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>useç”¨æ¥æŒ‡å®šNginxçš„å·¥ä½œæ¨¡å¼ã€‚Nginxæ”¯æŒçš„å·¥ä½œæ¨¡å¼æœ‰selectã€pollã€kqueueã€epollã€rtsigå’Œ/dev/pollã€‚å…¶ä¸­selectå’Œpolléƒ½æ˜¯æ ‡å‡†çš„å·¥ä½œæ¨¡å¼ï¼Œkqueueå’Œepollæ˜¯é«˜æ•ˆçš„å·¥ä½œæ¨¡å¼ï¼Œä¸åŒçš„æ˜¯epollç”¨åœ¨Linuxå¹³å°ä¸Šï¼Œè€Œkqueueç”¨åœ¨BSDç³»ç»Ÿä¸­,å¯¹äºLinuxç³»ç»Ÿï¼Œepollå·¥ä½œæ¨¡å¼æ˜¯é¦–é€‰ã€‚</p><p>worker_connectionsç”¨äºå®šä¹‰Nginxæ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œå³æ¥æ”¶å‰ç«¯çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤æ˜¯1024ã€‚æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ç”±worker_processeså’Œworker_connectionså†³å®šï¼Œå³Max_clients=worker_processes<em>worker_connectionsï¼Œåœ¨ä½œä¸ºåå‘ä»£ç†æ—¶ï¼ŒMax_clientså˜ä¸ºï¼šMax_clients = worker_processes </em> worker_connections/4ã€‚ è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°å—Linuxç³»ç»Ÿè¿›ç¨‹çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ï¼Œåœ¨æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤â€œulimit -n 65536â€åworker_connectionsçš„è®¾ç½®æ‰èƒ½ç”Ÿæ•ˆã€‚</p><ul><li>http æ¨¡å—</li></ul><p>httpæ¨¡å—å¯ä»¥è¯´æ˜¯æœ€æ ¸å¿ƒçš„æ¨¡å—äº†ï¼Œå®ƒè´Ÿè´£HTTPæœåŠ¡å™¨ç›¸å…³å±æ€§çš„é…ç½®ï¼Œå®ƒé‡Œé¢çš„serverå’Œupstreamå­æ¨¡å—ï¼Œè‡³å…³é‡è¦ï¼Œç­‰åˆ°åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ä»¥åŠè™šæ‹Ÿç›®å½•ç­‰ä¼šä»”ç»†è¯´ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line">    <span class="attribute">access_log</span>  /usr/local/var/log/nginx/access.log  main;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span>      <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nodelay</span>     <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">10</span>;</span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    <span class="attribute">upstream</span> myproject &#123;</span><br><span class="line">        .....</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™æ®µä»£ç ä¸­æ¯ä¸ªé…ç½®é€‰é¡¹çš„å«ä¹‰ã€‚</p><p>include æ¥ç”¨è®¾å®šæ–‡ä»¶çš„mimeç±»å‹,ç±»å‹åœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸‹çš„mime.typeæ–‡ä»¶å®šä¹‰ï¼Œæ¥å‘Šè¯‰nginxæ¥è¯†åˆ«æ–‡ä»¶ç±»å‹ã€‚</p><p>default_typeè®¾å®šäº†é»˜è®¤çš„ç±»å‹ä¸ºäºŒè¿›åˆ¶æµï¼Œä¹Ÿå°±æ˜¯å½“æ–‡ä»¶ç±»å‹æœªå®šä¹‰æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä¾‹å¦‚åœ¨æ²¡æœ‰é…ç½®asp çš„locate ç¯å¢ƒæ—¶ï¼ŒNginxæ˜¯ä¸äºˆè§£æçš„ï¼Œæ­¤æ—¶ï¼Œç”¨æµè§ˆå™¨è®¿é—®aspæ–‡ä»¶å°±ä¼šå‡ºç°ä¸‹è½½äº†ã€‚</p><p>log_formatç”¨äºè®¾ç½®æ—¥å¿—çš„æ ¼å¼ï¼Œå’Œè®°å½•å“ªäº›å‚æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸ºmainï¼Œåˆšå¥½ç”¨äºaccess_logæ¥çºªå½•è¿™ç§ç±»å‹ã€‚</p><p>mainçš„ç±»å‹æ—¥å¿—å¦‚ä¸‹ï¼šä¹Ÿå¯ä»¥å¢åˆ éƒ¨åˆ†å‚æ•°ã€‚</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span> - - <span class="string">[21/Apr/2015:18:09:54 +0800]</span> <span class="string">&quot;<span class="keyword">GET</span> /index.php HTTP/1.1&quot;</span> <span class="number">200</span> <span class="number">87151</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.76 Safari/537.36&quot;</span></span><br></pre></td></tr></table></figure><p>access_log</p><p>ç”¨æ¥çºªå½•æ¯æ¬¡çš„è®¿é—®æ—¥å¿—çš„æ–‡ä»¶åœ°å€ï¼Œåé¢çš„mainæ˜¯æ—¥å¿—çš„æ ¼å¼æ ·å¼ï¼Œå¯¹åº”äºlog_formatçš„mainã€‚</p><p>sendfileå‚æ•°ç”¨äºå¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ã€‚å°†tcp_nopushå’Œtcp_nodelayä¸¤ä¸ªæŒ‡ä»¤è®¾ç½®ä¸ºonç”¨äºé˜²æ­¢ç½‘ç»œé˜»å¡ã€‚</p><p>keepalive_timeoutè®¾ç½®å®¢æˆ·ç«¯è¿æ¥ä¿æŒæ´»åŠ¨çš„è¶…æ—¶æ—¶é—´ã€‚åœ¨è¶…è¿‡è¿™ä¸ªæ—¶é—´ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå…³é—­è¯¥è¿æ¥ã€‚</p><ul><li>server æ¨¡å—</li></ul><p>sever æ¨¡å—æ˜¯httpçš„å­æ¨¡å—ï¼Œå®ƒç”¨æ¥å®šä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæˆ‘ä»¬å…ˆè®²æœ€åŸºæœ¬çš„é…ç½®ï¼Œè¿™äº›åœ¨åé¢å†è®²ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„server æ˜¯å¦‚ä½•åšçš„ï¼Ÿ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8080</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost <span class="number">192.168.12.10</span> www.yangyi.com;</span><br><span class="line">        <span class="comment"># å…¨å±€å®šä¹‰ï¼Œå¦‚æœéƒ½æ˜¯è¿™ä¸€ä¸ªç›®å½•ï¼Œè¿™æ ·å®šä¹‰æœ€ç®€å•ã€‚</span></span><br><span class="line">        <span class="attribute">root</span>   /Users/yangyi/www;</span><br><span class="line">        <span class="attribute">index</span>  index.php index.html index.htm; </span><br><span class="line">        <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">        <span class="attribute">access_log</span>  usr/local/var/log/host.access.log  main;</span><br><span class="line">        <span class="attribute">aerror_log</span>  usr/local/var/log/host.<span class="literal">error</span>.log  <span class="literal">error</span>;</span><br><span class="line">        ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>serveræ ‡å¿—å®šä¹‰è™šæ‹Ÿä¸»æœºå¼€å§‹ã€‚</p><p>listenç”¨äºæŒ‡å®šè™šæ‹Ÿä¸»æœºçš„æœåŠ¡ç«¯å£ã€‚</p><p>server_nameç”¨æ¥æŒ‡å®šIPåœ°å€æˆ–è€…åŸŸåï¼Œå¤šä¸ªåŸŸåä¹‹é—´ç”¨ç©ºæ ¼åˆ†å¼€ã€‚</p><p>root è¡¨ç¤ºåœ¨è¿™æ•´ä¸ªserverè™šæ‹Ÿä¸»æœºå†…ï¼Œå…¨éƒ¨çš„root webæ ¹ç›®å½•ã€‚æ³¨æ„è¦å’Œlocate {}ä¸‹é¢å®šä¹‰çš„åŒºåˆ†å¼€æ¥ã€‚</p><p>index å…¨å±€å®šä¹‰è®¿é—®çš„é»˜è®¤é¦–é¡µåœ°å€ã€‚æ³¨æ„è¦å’Œlocate {}ä¸‹é¢å®šä¹‰çš„åŒºåˆ†å¼€æ¥ã€‚</p><p>charsetç”¨äºè®¾ç½®ç½‘é¡µçš„é»˜è®¤ç¼–ç æ ¼å¼ã€‚</p><p>access_logç”¨æ¥æŒ‡å®šæ­¤è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œæœ€åçš„mainç”¨äºæŒ‡å®šè®¿é—®æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ã€‚</p><ul><li>location æ¨¡å—</li></ul><p>locationæ¨¡å—æ˜¯nginxä¸­ç”¨çš„æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„æ¨¡å—äº†ï¼Œä»€ä¹ˆè´Ÿè½½å‡è¡¡å•Šã€åå‘ä»£ç†å•Šã€è™šæ‹ŸåŸŸåå•Šéƒ½ä¸å®ƒç›¸å…³ã€‚æ…¢æ…¢æ¥è®²ï¼š</p><p>location æ ¹æ®å®ƒå­—é¢æ„æ€å°±çŸ¥é“æ˜¯æ¥å®šä½çš„ï¼Œå®šä½URLï¼Œè§£æURLï¼Œæ‰€ä»¥ï¼Œå®ƒä¹Ÿæä¾›äº†å¼ºå¤§çš„æ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¹Ÿæ”¯æŒæ¡ä»¶åˆ¤æ–­åŒ¹é…ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡locationæŒ‡ä»¤å®ç°Nginxå¯¹åŠ¨ã€é™æ€ç½‘é¡µè¿›è¡Œè¿‡æ»¤å¤„ç†ã€‚åƒæˆ‘ä»¬çš„phpç¯å¢ƒæ­å»ºå°±æ˜¯ç”¨åˆ°äº†å®ƒã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªï¼Œè®¾å®šé»˜è®¤é¦–é¡µå’Œè™šæ‹Ÿæœºç›®å½•ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   /Users/yangyi/www;</span><br><span class="line">            <span class="attribute">index</span>  index.php index.html index.htm;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>location /è¡¨ç¤ºåŒ¹é…è®¿é—®æ ¹ç›®å½•ã€‚</p><p>rootæŒ‡ä»¤ç”¨äºæŒ‡å®šè®¿é—®æ ¹ç›®å½•æ—¶ï¼Œè™šæ‹Ÿä¸»æœºçš„webç›®å½•ï¼Œè¿™ä¸ªç›®å½•å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äºnginxçš„å®‰è£…ç›®å½•ï¼‰ã€‚ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åå‘ä»£ç†é…ç½®</span></span><br><span class="line"><span class="attribute">location</span> /itcast/ &#123;</span><br><span class="line">           <span class="attribute">proxy_pass</span> http://127.0.0.1:12345;</span><br><span class="line">           <span class="attribute">proxy_set_header</span> X-real-ip <span class="variable">$remote_addr</span>;</span><br><span class="line">           <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡‡ç”¨uwsgiæ–¹å¼</span></span><br><span class="line"><span class="attribute">location</span> /python/ &#123;</span><br><span class="line">           <span class="attribute">include</span> uwsgi_params;</span><br><span class="line">           <span class="attribute">uwsgi_pass</span> <span class="number">127.0.0.1:33333</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">#è®¿é—®nginxæœ¬æœºç›®å½•çš„æ–‡ä»¶</span></span><br><span class="line">  <span class="attribute">location</span> / &#123;</span><br><span class="line">          <span class="attribute">root</span>   /home/itcast/xwp/itcast/;</span><br><span class="line">          <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span>  /static/ &#123;</span><br><span class="line">           <span class="attribute">alias</span> /var/static/;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><ul><li>upstram æ¨¡å—</li></ul><p>upstream æ¨¡å—è´Ÿå€ºè´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„è°ƒåº¦ç®—æ³•æ¥å®ç°å®¢æˆ·ç«¯IPåˆ°åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ã€‚æˆ‘å…ˆå­¦ä¹ æ€ä¹ˆç”¨ï¼Œå…·ä½“çš„ä½¿ç”¨å®ä¾‹ä»¥åå†è¯´ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> test.com&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.123.1:80</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.123.2:80</span> down;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.123.3:8080</span>  max_fails=<span class="number">3</span>  fail_timeout=<span class="number">20s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.123.4:8080</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡upstreamæŒ‡ä»¤æŒ‡å®šäº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨çš„åç§°test.comã€‚è¿™ä¸ªåç§°å¯ä»¥ä»»æ„æŒ‡å®šï¼Œåœ¨åé¢éœ€è¦çš„åœ°æ–¹ç›´æ¥è°ƒç”¨å³å¯ã€‚</p><p>é‡Œé¢æ˜¯ip_hashè¿™æ˜¯å…¶ä¸­çš„ä¸€ç§è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•ã€‚</p><p>Nginxçš„è´Ÿè½½å‡è¡¡æ¨¡å—ç›®å‰æ”¯æŒ4ç§è°ƒåº¦ç®—æ³•:</p><ul><li>weight è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ã€‚æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æŸå°æœåŠ¡å™¨å®•æœºï¼Œæ•…éšœç³»ç»Ÿè¢«è‡ªåŠ¨å‰”é™¤ï¼Œä½¿ç”¨æˆ·è®¿é—®ä¸å—å½±å“ã€‚weightã€‚æŒ‡å®šè½®è¯¢æƒå€¼ï¼Œweightå€¼è¶Šå¤§ï¼Œåˆ†é…åˆ°çš„è®¿é—®æœºç‡è¶Šé«˜ï¼Œä¸»è¦ç”¨äºåç«¯æ¯ä¸ªæœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µä¸‹ã€‚</li><li>ip_hashã€‚æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¥è‡ªåŒä¸€ä¸ªIPçš„è®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„sessionå…±äº«é—®é¢˜ã€‚</li><li>fairã€‚æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´åŠ æ™ºèƒ½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚æ­¤ç§ç®—æ³•å¯ä»¥ä¾æ®é¡µé¢å¤§å°å’ŒåŠ è½½æ—¶é—´é•¿çŸ­æ™ºèƒ½åœ°è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒfairçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»ä¸‹è½½Nginxçš„upstream_fairæ¨¡å—ã€‚</li><li>url_hashã€‚æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜åç«¯ç¼“å­˜æœåŠ¡å™¨çš„æ•ˆç‡ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒurl_hashçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»å®‰è£…Nginx çš„hashè½¯ä»¶åŒ…ã€‚</li></ul><p>åœ¨HTTP Upstreamæ¨¡å—ä¸­ï¼Œå¯ä»¥é€šè¿‡serveræŒ‡ä»¤æŒ‡å®šåç«¯æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£ï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¾å®šæ¯ä¸ªåç«¯æœåŠ¡å™¨åœ¨è´Ÿè½½å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€ã€‚å¸¸ç”¨çš„çŠ¶æ€æœ‰ï¼š</p><p>downï¼Œè¡¨ç¤ºå½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡ã€‚</p><p>backupï¼Œé¢„ç•™çš„å¤‡ä»½æœºå™¨ã€‚å½“å…¶ä»–æ‰€æœ‰çš„ébackupæœºå™¨å‡ºç°æ•…éšœæˆ–è€…å¿™çš„æ—¶å€™ï¼Œæ‰ä¼šè¯·æ±‚backupæœºå™¨ï¼Œå› æ­¤è¿™å°æœºå™¨çš„å‹åŠ›æœ€è½»ã€‚</p><p>max_failsï¼Œå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstream æ¨¡å—å®šä¹‰çš„é”™è¯¯ã€‚</p><p>fail_timeoutï¼Œåœ¨ç»å†äº†max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœæœåŠ¡çš„æ—¶é—´ã€‚max_failså¯ä»¥å’Œfail_timeoutä¸€èµ·ä½¿ç”¨ã€‚</p><p>æ³¨æ„ å½“è´Ÿè½½è°ƒåº¦ç®—æ³•ä¸ºip_hashæ—¶ï¼Œåç«¯æœåŠ¡å™¨åœ¨è´Ÿè½½å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€ä¸èƒ½æ˜¯weightå’Œbackupã€‚</p><p>å¤‡æ³¨ï¼š nginxçš„worker_rlimit_nofileè¾¾åˆ°ä¸Šé™æ—¶ï¼Œå†æœ‰å®¢æˆ·ç«¯é“¾æ¥æŠ¥502é”™è¯¯. ç”¨äº†log_formatæŒ‡ä»¤è®¾ç½®äº†æ—¥å¿—æ ¼å¼ä¹‹åï¼Œéœ€è¦ç”¨access_logæŒ‡ä»¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„.</p><h2 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h2><p>æ­£å‘ä»£ç†ï¼Œä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„ä»£ç†,ä»–çš„å·¥ä½œåŸç†å°±åƒä¸€ä¸ªè·³æ¿ï¼Œç®€å•çš„è¯´ï¼Œæˆ‘æ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘è®¿é—®ä¸äº†æŸç½‘ç«™ï¼Œä½†æ˜¯æˆ‘èƒ½è®¿é—®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨å‘¢ï¼Œä»–èƒ½è®¿é—®é‚£ä¸ªæˆ‘ä¸èƒ½è®¿é—®çš„ç½‘ç«™ï¼Œäºæ˜¯æˆ‘å…ˆè¿ä¸Šä»£ç†æœåŠ¡å™¨ï¼Œå‘Šè¯‰ä»–æˆ‘éœ€è¦é‚£ä¸ªæ— æ³•è®¿é—®ç½‘ç«™çš„å†…å®¹ï¼Œä»£ç†æœåŠ¡å™¨å»å–å›æ¥ï¼Œç„¶åè¿”å›ç»™æˆ‘ã€‚ ä»ç½‘ç«™çš„è§’åº¦ï¼Œåªåœ¨ä»£ç†æœåŠ¡å™¨æ¥å–å†…å®¹çš„æ—¶å€™æœ‰ä¸€æ¬¡è®°å½•ï¼Œæœ‰æ—¶å€™å¹¶ä¸çŸ¥é“æ˜¯ç”¨æˆ·çš„è¯·æ±‚ï¼Œä¹Ÿéšè—äº†ç”¨æˆ·çš„èµ„æ–™ï¼Œè¿™å–å†³äºä»£ç†å‘Šä¸å‘Šè¯‰ç½‘ç«™ã€‚ç»“è®ºå°±æ˜¯ï¼Œæ­£å‘ä»£ç† æ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒåŸå§‹æœåŠ¡å™¨(origin server)ä¹‹é—´çš„æœåŠ¡å™¨ï¼Œä¸ºäº†ä»åŸå§‹æœåŠ¡å™¨å–å¾—å†…å®¹ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶æŒ‡å®šç›®æ ‡(åŸå§‹æœåŠ¡å™¨)ï¼Œç„¶åä»£ç†å‘åŸå§‹æœåŠ¡å™¨è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å¿…é¡»è¦è¿›è¡Œä¸€äº›ç‰¹åˆ«çš„è®¾ç½®æ‰èƒ½ä½¿ç”¨æ­£å‘ä»£ç†ã€‚</p><p>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><p>ä»ç”¨é€”ä¸Šæ¥è®²ï¼š</p><ul><li>æ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚</li><li>æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨ç‡ã€‚åå‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯å°†é˜²ç«å¢™åé¢çš„æœåŠ¡å™¨æä¾›ç»™Internetç”¨æˆ·è®¿é—®ã€‚</li><li>åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚</li><li>åå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚</li></ul><h3 id="åå‘ä»£ç†æœåŠ¡å™¨çš„åŸºæœ¬é…ç½®"><a href="#åå‘ä»£ç†æœåŠ¡å™¨çš„åŸºæœ¬é…ç½®" class="headerlink" title="åå‘ä»£ç†æœåŠ¡å™¨çš„åŸºæœ¬é…ç½®"></a>åå‘ä»£ç†æœåŠ¡å™¨çš„åŸºæœ¬é…ç½®</h3><ol><li><p>proxy_pass</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span> URL;</span><br><span class="line">é…ç½®å— location if</span><br><span class="line">æ­¤é…ç½®å°†å½“å‰è¯·æ±‚ä»£ç†åˆ°URLå‚æ•°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Š,URLå¯ä»¥æ˜¯ä¸»æœºåæˆ–è€…IPåœ°å€åŠ PORTçš„å½¢å¼</span><br><span class="line"><span class="attribute">proxy_pass</span> http://localhost:8000;</span><br><span class="line">ä¹Ÿå¯ä»¥ç»“åˆè´Ÿè½½å‡è¡¡å®ç”¨&lt;è´Ÿè½½å‡è¡¡ä¼šè¯´æ˜è¿™ç§æƒ…å†µ&gt;</span><br><span class="line">ä¹Ÿå¯ä»¥å§HTTPè½¬æ¢æˆHTTPS</span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.0.1;</span><br><span class="line">é»˜è®¤æƒ…å†µåå‘ä»£ç†ä¸è½¬å‘è¯·æ±‚ä¸­çš„Hostå¤´éƒ¨,å¦‚æœéœ€å‘€è®¾ç½®æŠ“å‘å¤´éƒ¨</span><br><span class="line">    åˆ™ proxy_set_header Host $host;</span><br></pre></td></tr></table></figure></li><li><p>proxy_method</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_method</span> method_name;</span><br><span class="line">é…ç½®å— http server location</span><br><span class="line">æ­¤é…ç½®é¡¹è¡¨ç¤ºè½¬å‘æ—¶çš„åè®®æ–¹æ³•å:</span><br><span class="line">    <span class="attribute">proxy_method</span> POST;</span><br><span class="line">é‚£ä¹ˆå®¢æˆ·ç«¯å‘æ¥çš„GETè¯·æ±‚åœ¨è½¬å‘æ—¶æ–¹æ³•æ”¹ä¸ºPOST;</span><br></pre></td></tr></table></figure></li><li><p>proxy_hide_header</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_hide_header</span> header1;</span><br><span class="line">é…ç½®å— http server location;</span><br><span class="line">Nginxä¼šå°†ä¸Šæ¸¸æœåŠ¡å™¨çš„å“åº”è½¬å‘ç»™å®¢æˆ·ç«¯,ä½†é»˜è®¤ä¸è½¬å‘HTTPå¤´éƒ¨å­—æ®µ(Date Server X-Pad X-Accel-* )</span><br><span class="line">ä½¿ç”¨proxy_hide_headerå¯ä»¥æŒ‡å®šä»»æ„å¤´éƒ¨ä¸èƒ½è¢«è½¬å‘</span><br><span class="line"><span class="attribute">proxy_hide_header</span> Cache-Control;</span><br><span class="line"><span class="attribute">proxy_hide_header</span> MicrosoftOfficeWebServer;</span><br></pre></td></tr></table></figure></li><li><p>proxy_pass_header</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass_header</span> header1;</span><br><span class="line">é…ç½®å— http server location</span><br><span class="line">åŠŸèƒ½ä¸ proxy_hide_headerç›¸å,æ˜¯è®¾ç½®å“ªäº›å¤´éƒ¨å…è®¸è½¬å‘.</span><br><span class="line"><span class="attribute">proxy_pass_header</span> X-Accel-Redirect;</span><br></pre></td></tr></table></figure></li><li><p>proxy_pass_request_body</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass_request_body</span> <span class="literal">off</span>|<span class="literal">on</span>;</span><br><span class="line">é»˜è®¤ on</span><br><span class="line">é…ç½®å— http server location;</span><br><span class="line">ç¡®å®šä¸Šæ¸¸æœåŠ¡å™¨æ˜¯å¦å‘ä¸Šæ¸¸æœåŠ¡å™¨è½¬å‘HTTPåŒ…ä½“</span><br></pre></td></tr></table></figure></li><li><p>proxy_pass_request_header</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass_request_header</span> <span class="literal">on</span> | <span class="literal">off</span>;</span><br><span class="line">é»˜è®¤on</span><br><span class="line">é…ç½®å— http server location</span><br><span class="line">ç¡®å®šæ˜¯å¦è½¬å‘HTTPå¤´éƒ¨</span><br></pre></td></tr></table></figure></li><li><p>proxy_redirect</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_redirect</span> [default | <span class="literal">off</span> |<span class="literal">redirect</span> |replacement]</span><br><span class="line">é»˜è®¤default</span><br><span class="line">é…ç½®å— http server location</span><br><span class="line">å½“ä¸Šæ¸¸æœåŠ¡å“åº”æ—¶é‡å®šå‘æˆ–åˆ·æ–°(HTTP <span class="number">301</span> <span class="number">302</span>),proxy_redirectå¯ä»¥é‡è®¾HTTPå¤´éƒ¨çš„locationæˆ–refreshå­—æ®µ</span><br><span class="line">   </span><br><span class="line">proxy_redirect http://locahost:8000/two/ http://frontend/one/;</span><br><span class="line">ä¸Šæ¸¸å“åº”302,locationæ˜¯URIæ˜¯http://locahost:8000/two/some/uri/</span><br><span class="line">é‚£æ˜¯å®é™…è½¬å‘ç»™å®¢æˆ·ç«¯çš„æ˜¯ http://frontend/one/some/uri/;</span><br><span class="line">å¯ä»¥ä½¿ç”¨å‰é¢æåˆ°çš„ngx_http_core_moduleæ¨¡å—æä¾›çš„å˜é‡ </span><br><span class="line"><span class="attribute">proxy_redirect</span> http://locahost:8000/two/ http://<span class="variable">$host</span>:server_port/;</span><br><span class="line">å¯ä»¥çœç•¥replacementå‚æ•°çš„ä¸»æœºåéƒ¨åˆ†,è¿™æ—¶å€™ç”¨è™šæ‹Ÿä¸»æœºåå¡«å……</span><br><span class="line"><span class="attribute">proxy_redirect</span> http://locahost:8000/two/ /one/;</span><br><span class="line">   </span><br><span class="line">ä½¿ç”¨offå‚æ•°çš„æ—¶å€™,å°†ä½¿locationå’Œrefreshçš„å­—æ®µç»´æŒä¸å˜</span><br><span class="line"><span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">   </span><br><span class="line">å¦‚æœä½¿ç”¨çš„ proxy_redirect default;</span><br><span class="line">ä¸‹é¢ä¸¤ç§é…ç½®æ˜¯ç­‰æ•ˆçš„</span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://upstream:port/two/;</span><br><span class="line">        <span class="attribute">proxy_redirect</span> default;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://upstream:port/two/;</span><br><span class="line">        <span class="attribute">proxy_redirect</span> http://upstream:port/two/ /one/;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>proxy_next_upstream</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_next_upstream</span> [<span class="literal">error</span> |timeout |invalid_header |http_500 |http_502~<span class="number">504</span> |http_404 | <span class="literal">off</span>]</span><br><span class="line">    é»˜è®¤ proxy_next_upstream <span class="literal">error</span> timeout;</span><br><span class="line">    é…ç½®å— http server location</span><br><span class="line"></span><br><span class="line">    æ­¤é…ç½®è¡¨ç¤ºä¸Šæ¸¸ä¸€å°æœåŠ¡å™¨è½¬å‘è¯·æ±‚å‡ºç°é”™è¯¯æ—¶,ç»§ç»­æ¢ä¸€å¥—æœåŠ¡å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚</span><br><span class="line">    å…¶å‚æ•°ç”¨æ¥è¯´æ˜åœ¨é‚£äº›æƒ…å†µä¸‹ç»§ç»­é€‰æ‹©ä¸‹ä¸€å°ä¸Šæ¸¸æœåŠ¡å™¨è½¬å‘è¯·æ±‚.</span><br><span class="line">    <span class="attribute">error</span> å‘ä¸Šæ¸¸å‘èµ·è¿æ¥ å‘é€è¯·æ±‚ è¯»å–å“åº”æ—¶å‡ºé”™</span><br><span class="line">    timeout å‘é€è¯·æ±‚æˆ–è¯»å–å“åº”æ—¶å‡ºé”™</span><br><span class="line">    invalid_header ä¸Šæ¸¸æœåŠ¡å™¨å‘é€çš„å“åº”æ—¶ä¸åˆæ³•</span><br><span class="line">    http_500 ä¸Šæ¸¸å“åº”<span class="number">500</span></span><br><span class="line">    http_502 ä¸Šæ¸¸å“åº”<span class="number">502</span></span><br><span class="line">    http_503 ä¸Šæ¸¸å“åº”<span class="number">503</span></span><br><span class="line">    http_504 ä¸Šæ¸¸å“åº”<span class="number">504</span></span><br><span class="line">    http_404 ä¸Šæ¸¸å“åº”<span class="number">404</span></span><br><span class="line">    <span class="literal">off</span>      å…³é—­proxy_next_upstreamåŠŸèƒ½ åªè¦ä¸€å‡ºé”™å°±é€‰æ‹©å¦å¤–ä¸€å°ä¸Šæ¸¸å†æ¬¡å‡ºå‘</span><br><span class="line">Nginxåå‘ä»£ç†æ¨¡å—ä¸­è¿˜æä¾›å¾ˆå¤šé…ç½®,å¦‚è®¾ç½®è¿æ¥çš„è¶…æ—¶æ—¶é—´,ä¸´æ—¶æ–‡ä»¶å¦‚ä½•å­˜å‚¨,å¦‚ä½•ç¼“å­˜ä¸Šæ¸¸æœåŠ¡å™¨å“åº”ç­‰åŠŸèƒ½.</span><br></pre></td></tr></table></figure></li></ol><p>å¯ä»¥é€šè¿‡é˜…è¯» ngx_http_proxy_moduleäº†è§£æ›´å¤šè¯¦ç»†æƒ…å†µ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sudo vim /usr/local/nginx/conf/nginx.conf </span></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="comment">#ä¿è¯ä»£ç†æœºå™¨èƒ½è®¿é—®åˆ° ä¸‹é¢çš„æœºå™¨å¹¶è£…æœ‰nginx  åœ¨ä¸»æœºå·ä¸º100çš„æœºå™¨ä¸Šæœ‰å“åº”ç½‘é¡µ</span></span><br><span class="line">    <span class="attribute">proxy_pass</span> http://192.168.1.100;</span><br><span class="line">    <span class="attribute">root</span>   html;</span><br><span class="line">    <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">sudo</span> /usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><p>åŠ ä¸€äº›åˆ¤æ–­æ¡ä»¶ è·å–åˆ° å¯¹æ–¹è¯·æ±‚çš„ä¸»æœº é˜²æ­¢åˆ«äººä»£ç†åˆ°è‡ªå·±çš„ä¸»æœºä¸Š</p><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>è´Ÿè½½å‡è¡¡æ˜¯ç”±å¤šå°æœåŠ¡å™¨ä»¥å¯¹ç§°çš„æ–¹å¼ç»„æˆä¸€ä¸ªæœåŠ¡å™¨é›†åˆï¼Œæ¯å°æœåŠ¡å™¨éƒ½å…·æœ‰ç­‰ä»·çš„åœ°ä½ï¼Œéƒ½å¯ä»¥å•ç‹¬å¯¹å¤–æä¾›æœåŠ¡è€Œæ— é¡»å…¶ä»–æœåŠ¡å™¨çš„è¾…åŠ©ã€‚é€šè¿‡æŸç§è´Ÿè½½åˆ†æ‹…æŠ€æœ¯ï¼Œå°†å¤–éƒ¨å‘é€æ¥çš„è¯·æ±‚æŒ‰ç…§äº‹å…ˆè®¾å®šåˆ†é…ç®—æ³•åˆ†é…åˆ°å¯¹ç§°ç»“æ„ä¸­çš„æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè€Œæ¥æ”¶åˆ°è¯·æ±‚çš„æœåŠ¡å™¨ç‹¬ç«‹åœ°å›åº”å®¢æˆ·çš„è¯·æ±‚ã€‚</p><p>å‡è¡¡è´Ÿè½½èƒ½å¤Ÿå¹³å‡åˆ†é…å®¢æˆ·è¯·æ±‚åˆ°æœåŠ¡å™¨åˆ—é˜µï¼Œç±æ­¤æä¾›å¿«é€Ÿè·å–é‡è¦æ•°æ®ï¼Œè§£å†³å¤§é‡å¹¶å‘è®¿é—®æœåŠ¡é—®é¢˜ã€‚</p><ol><li><p>upstreamå—</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">upstream name &#123;...&#125;</span><br><span class="line">é…ç½®å— http</span><br><span class="line">upstreamå—å®šä¹‰ä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨çš„é›†ç¾¤,ä¾¿äºåå‘ä»£ç†ä¸­çš„proxy_passä½¿ç”¨</span><br><span class="line"></span><br><span class="line"><span class="attribute">upstream</span> mynet&#123;</span><br><span class="line">    <span class="attribute">server</span> www.wopai1.com;</span><br><span class="line">    <span class="attribute">server</span> www.wopai2.com;</span><br><span class="line">    <span class="attribute">server</span> www.wopai3.com;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://mynet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>server</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server</span> name [paramenters]</span><br><span class="line">é…ç½®å—upstream</span><br><span class="line">serveré…ç½®é¡¹æŒ‡å®šäº†ä¸€å°ä¸Šæ¸¸æœåŠ¡å™¨çš„åå­—,å¯ä»¥æ˜¯åŸŸå IPåœ°å€ç«¯å£ UNIXå¥æŸ„</span><br><span class="line">weight= number;è®¾ç½®å‘è¿™å°æœåŠ¡å™¨è½¬å‘çš„æƒé‡,é»˜è®¤ä¸º1</span><br><span class="line">max_fails=number;è¯¥é€‰é¡¹åŸŸfail_timeouté…åˆä½¿ç”¨</span><br><span class="line">        æŒ‡åœ¨fail_timeoutæ—¶é—´æ®µå†…å¦‚æœè½¬å‘ä¸Šæ¸¸å¤±è´¥è¶…è¿‡numberæ¬¡å°±è®¤ä¸ºå½“å‰çš„fail_timeoutæ—¶é—´å†…</span><br><span class="line">        è¿™å°æœåŠ¡å™¨ä¸å¯ç”¨,max_failsé»˜è®¤ä¸º1 å¦‚æœè®¾ç½®ä¸º0 è¡¨ç¤ºä¸æ£€æŸ¥å¤±è´¥æ¬¡æ•°</span><br><span class="line">fail_timeout=time; fail_timeoutè¡¨ç¤ºè¯¥æ—¶é—´å†…è½¬å‘å¤šå°‘æ¬¡å¤±è´¥åå°±è®¤ä¸ºä¸Šæ¸¸ä¸å¯ç”¨.é»˜è®¤10s</span><br><span class="line"><span class="attribute">down</span>    è¡¨ç¤ºä¸Šæ¸¸æœåŠ¡å™¨æ°¸ä¹…ä¸‹çº¿,åªèƒ½åœ¨ip_hashé…ç½®æ—¶æ‰æœ‰æ•ˆ</span><br><span class="line">backup  åœ¨ip_hashé…ç½®æ—¶æ— æ•ˆ.åªæœ‰æ‰€æœ‰éå¤‡ä»½æœºéƒ½å¤±è´¥,æ‰å‘ä¸Šæ¸¸å¤‡ä»½æœåŠ¡å™¨è½¬å‘è¯·æ±‚.</span><br><span class="line">upstream mynet&#123;</span><br><span class="line">    <span class="attribute">server</span> www.wopai1.com weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> www.wopai2.com:<span class="number">8081</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">300s</span>;</span><br><span class="line">    <span class="attribute">server</span> www.wopai2.com down;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ip_hash</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®å— upstream</span><br><span class="line">å¸Œæœ›æ¥è‡ªæŸä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚å§‹ç»ˆè½åœ¨å›ºå®šçš„ä¸€å°æœåŠ¡å™¨ä¸Šè¿›è¡Œå¤„ç†.</span><br><span class="line">æ ¹æ®å®¢æˆ·ç«¯çš„IPæ•£åˆ—è®¡ç®—å‡ºä¸€ä¸ªkey,å°†keyæŒ‰ç…§upstreamé›†ç¾¤ä¸­çš„ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡Œå–æ¨¡,æ±‚å¾—çš„å€¼å¯¹åº”çš„ä¸»æœºæ¥æ”¶è½¬å‘è¯·æ±‚.</span><br><span class="line">ip_hashä¸å¯ä»¥ä¸weightåŒæ—¶ä½¿ç”¨</span><br><span class="line">å¦‚æœupstreamé…ç½®ä¸­æœ‰ä¸€å°æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨,ä¸èƒ½ç›´æ¥åˆ é™¤è¯¥é…ç½®,è€Œåº”è¯¥ä½¿ç”¨downæ ‡è¯†.</span><br><span class="line"><span class="attribute">upstream</span> mynet&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    <span class="attribute">server</span> www.wowpai1.top;</span><br><span class="line">    <span class="attribute">server</span> www.wowpai2.top;  </span><br><span class="line">    <span class="attribute">server</span> www.wowpai3.top down;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>ä¾‹å­,æœåŠ¡å™¨è´Ÿè½½å‡è¡¡åŸºæœ¬é…ç½®,nginxä¸­å¯ä»¥è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ç›¸å…³è®¾ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> my.net&#123;    <span class="comment">#my.netæ˜¯è‡ªå®šä¹‰çš„å‘½å åœ¨serverç»“æ„ä¸­å¼•ç”¨å³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»£ç†æœåŠ¡å™¨ä¸º ä¸¤å°æœºå™¨192.168.22.136 192.168.22.147åšè´Ÿè½½å‡è¡¡æ“ä½œ </span></span><br><span class="line"><span class="comment">#ä¸¤å°æœºå™¨ä¸Š å¯ä»¥è·‘apacheè´Ÿè½½åŠŸèƒ½æ›´ä¸ºå¼ºå¤§çš„ç½‘é¡µç›¸å…³ä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#max_fails è¡¨ç¤ºå°è¯•å‡ºé”™æœ€å¤§æ¬¡æ•° å³å¯è®¤ä¸ºè¯¥æœåŠ¡å™¨ åœ¨fail_timeoutæ—¶é—´å†…ä¸å¯ç”¨</span></span><br><span class="line"><span class="comment"># server servername:port   servernameå¯ä»¥å†™ä¸»æœºå æˆ–è€…ç‚¹åˆ†å¼IP</span></span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.22.136:80</span> max_fails=<span class="number">1</span> fail_timeout=<span class="number">300s</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.22.147:80</span> max_fails=<span class="number">1</span> fail_timeout=<span class="number">300s</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span>  localhost; </span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="comment">#upstream å—å</span></span><br><span class="line">    <span class="attribute">proxy_pass</span> http://my.net;</span><br><span class="line">    <span class="attribute">root</span>   html;</span><br><span class="line">    <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨æ‰‹å¼€å§‹é…ç½®æ‰èƒ½æ…¢æ…¢ä¸Šæ‰‹nginxé…ç½®å’Œä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç†è§£ç‰ˆæœ¬å·</title>
      <link href="/2016/07/18/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%89%88%E6%9C%AC%E5%8F%B7/"/>
      <url>/2016/07/18/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%89%88%E6%9C%AC%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€å¥è¯æ¦‚æ‹¬"><a href="#ä¸€å¥è¯æ¦‚æ‹¬" class="headerlink" title="ä¸€å¥è¯æ¦‚æ‹¬"></a>ä¸€å¥è¯æ¦‚æ‹¬</h2><p>è¯­ä¹‰åŒ–ç‰ˆæœ¬å·çš„æ ¼å¼ä¸ºä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·(x.y.z)ï¼Œé€’å¢è§„åˆ™å¦‚ä¸‹</p><p>x: ä¸»ç‰ˆæœ¬å·ï¼Œåšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹</p><p>y: æ¬¡ç‰ˆæœ¬å·ï¼Œåšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ›´æ–°</p><p>z: ä¿®è®¢å·ï¼Œä¸€èˆ¬æ˜¯å‘ä¸‹å…¼å®¹çš„ bugfix å’Œä¼˜åŒ–</p><p>ï¼ˆä»¥ä¸‹ï¼Œçš†ä»¥ x ä»£è¡¨ä¸»ç‰ˆæœ¬å·ï¼Œy ä»£è¡¨æ¬¡ç‰ˆæœ¬å·ï¼Œz ä»£è¡¨ä¿®è®¢å·ï¼‰<br><img src= "/img/loading2.gif" data-lazy-src="https://raw.githubusercontent.com/maywzh/imagebed/master/img/1_7h56wnp4mqlOqRm4aF9cTQ.png" alt="img"></p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬å·"><a href="#ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬å·" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬å·"></a>ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬å·</h2><h3 id="â€œä¾èµ–åœ°ç‹±â€é—®é¢˜"><a href="#â€œä¾èµ–åœ°ç‹±â€é—®é¢˜" class="headerlink" title="â€œä¾èµ–åœ°ç‹±â€é—®é¢˜"></a>â€œä¾èµ–åœ°ç‹±â€é—®é¢˜</h3><p>å¤§å‹è½¯ä»¶ç³»ç»Ÿå¾€å¾€ä¾èµ–äºä¼—å¤šå¥—ä»¶ã€åº“ï¼Œè¿™äº›ä¾èµ–å…³ç³»ç›¸å½“å¤æ‚ï¼Œä¾èµ–å…³ç³»è¿‡é«˜ä¼šå¯¼è‡´ç‰ˆæœ¬æ§åˆ¶è¢«é”æ­»çš„é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒæŸä¸€ä¸ªåº“ä¾èµ–äºå…¶ä»–åº“ï¼Œè¿™äº›åº“åˆä¾èµ–äºå¦ä¸€äº›åº“ï¼Œé‚£ä¹ˆå…¶ä¸­æŸä¸ªåº“çš„å‡çº§å¯¼è‡´çš„ä¸å…¼å®¹é—®é¢˜ï¼Œåˆ™ä¼šå› å½±å“æ•´ä¸ªç³»ç»Ÿã€‚ä¾èµ–å…³ç³»å¤ªæ¾æ•£ï¼Œåˆ™ä¼šå¯¼è‡´ç‰ˆæœ¬çš„æ··ä¹±ã€‚è¿™å°±è¢«ç§°ä¹‹ä¸ºä¾èµ–åœ°ç‹±ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä¸€ä¸ªåˆç†çš„è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬å·çº¦æŸè§„åˆ™ï¼Œå¯ä»¥æ˜ç¡®ç‰ˆæœ¬ä¸­çš„ä¾èµ–é—®é¢˜ã€‚ä¾‹å¦‚ x1.y1.z1 è½¯ä»¶ä¾èµ–äº x11.y11.z11 è¿™ä¸ªç‰¹å®šç‰ˆæœ¬çš„åº“ï¼Œåœ¨åº“çš„æ•´ä¸ª x11 çš„ä¸»ç‰ˆæœ¬ï¼Œx1 ç‰ˆæœ¬çš„è½¯ä»¶å¯ä»¥ç¡®ä¿ä½¿ç”¨æ­£å¸¸ã€‚è¿™å¥—è§„åˆ™é’ˆå¯¹äºå®šä¹‰çš„å…¬å…± API è€Œåˆ¶å®šï¼š</p><ul><li>é‡å¤§ç‰ˆæœ¬æ›´æ–°ï¼š x é€’å¢ï¼Œå¤§é‡æ–°åŠŸèƒ½çš„æ›´æ–°ï¼Œå¯èƒ½ä¸å‘ä¸‹å…¼å®¹</li><li>ç‰ˆæœ¬åŠŸèƒ½æ›´æ–°ï¼šy é€’å¢ï¼ŒAPI ä¿æŒå‘ä¸‹å…¼å®¹çš„æ–°å¢åŠä¿®æ”¹</li><li>ç‰ˆæœ¬ä¿®è®¢ï¼Œz é€’å¢ï¼Œä¿®å¤é—®é¢˜ä½†ä¸å½±å“ API ï¼Œå‘ä¸‹å…¼å®¹</li></ul><p>åœ¨è¿™å¥—è§„åˆ™çº¦æŸä¸‹ï¼Œç‰ˆæœ¬å·åŠå…¶æ›´æ–°æ–¹å¼åŒ…å«äº†ç›¸é‚»ç‰ˆæœ¬é—´çš„åº•å±‚ä»£ç å’Œä¿®æ”¹å†…å®¹çš„ä¿¡æ¯ã€‚</p><h2 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h2><h3 id="é‡è¦ç¨‹åº¦"><a href="#é‡è¦ç¨‹åº¦" class="headerlink" title="é‡è¦ç¨‹åº¦"></a>é‡è¦ç¨‹åº¦</h3><ul><li><strong>å¿…è¦çº§: MUST, MUST NOT</strong><ul><li>ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è½¯ä»¶å¿…é¡»å®šä¹‰å…¬å…± API</li><li>æ ‡å‡†ç‰ˆæœ¬å·å¿…é¡»é‡‡ç”¨ X.Y.Z æ ¼å¼ï¼Œæ•°å€¼é€’å¢<ul><li>1.8.1 -&gt; 1.9.0 -&gt; 1.10.0</li></ul></li><li>æŸç‰ˆæœ¬å‘è¡Œåç¦æ­¢ä¿®æ”¹ï¼Œå¹‚ç­‰æ€§åœ°ï¼Œä¿®æ”¹åå¿…é¡»æŒ‰æ–°ç‰ˆæœ¬å‘è¡Œ</li><li>ä¿®è®¢å· Zï¼ˆx.y.Z | x &gt; 0ï¼‰åœ¨<strong>åªåšäº†å‘ä¸‹å…¼å®¹çš„ä¿®æ­£æ—¶</strong>æ‰é€’å¢ã€‚è¿™é‡Œçš„ä¿®æ­£æŒ‡çš„æ˜¯é’ˆå¯¹ä¸æ­£ç¡®ç»“æœè€Œè¿›è¡Œçš„å†…éƒ¨ä¿®æ”¹</li><li>æ¬¡ç‰ˆæœ¬å· Yï¼ˆx.Y.z | x &gt; 0ï¼‰åœ¨<strong>æœ‰å‘ä¸‹å…¼å®¹çš„æ–°åŠŸèƒ½å‡ºç°æ—¶</strong>é€’å¢ï¼Œä»»ä½•å…¬å…± API çš„åŠŸèƒ½è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ä¹Ÿå¿…é¡»é€’å¢ã€‚æ¯å½“æ¬¡ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œä¿®è®¢å·å¿…é¡»å½’é›¶</li><li>ä¸»ç‰ˆæœ¬å· Xï¼ˆX.y.z | X &gt; 0ï¼‰å¿…é¡»<strong>åœ¨æœ‰ä»»ä½•ä¸å…¼å®¹çš„ä¿®æ”¹è¢«åŠ å…¥å…¬å…± API æ—¶</strong>é€’å¢ã€‚æ¯å½“ä¸»ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œæ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·å¿…é¡»å½’é›¶ã€‚</li><li>åˆ¤æ–­ç‰ˆæœ¬ä¼˜å…ˆå±‚çº§æ—¶ï¼Œå¿…é¡»æŠŠç‰ˆæœ¬ä¾åºæ‹†åˆ†ä¸ºä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·ã€ä¿®è®¢å·åŠå…ˆè¡Œç‰ˆæœ¬å·åè¿›è¡Œæ¯”è¾ƒï¼ˆç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ä¸åœ¨è¿™ä»½æ¯”è¾ƒçš„åˆ—è¡¨ä¸­ï¼‰ã€‚ç”±å·¦åˆ°å³ä¾åºæ¯”è¾ƒæ¯ä¸ªæ ‡è¯†ç¬¦å·ï¼Œç¬¬ä¸€ä¸ªå·®å¼‚å€¼ç”¨æ¥å†³å®šä¼˜å…ˆå±‚çº§ï¼šä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·ä»¥æ•°å€¼æ¯”è¾ƒï¼Œä¾‹å¦‚ï¼š1.0.0 &lt; 2.0.0 &lt; 2.1.0 &lt; 2.1.1ã€‚å½“ä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·éƒ½ç›¸åŒæ—¶ï¼Œæ”¹ä»¥ä¼˜å…ˆå±‚çº§æ¯”è¾ƒä½çš„å…ˆè¡Œç‰ˆæœ¬å·å†³å®šã€‚ä¾‹å¦‚ï¼š1.0.0-alpha &lt; 1.0.0ã€‚æœ‰ç›¸åŒä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·çš„ä¸¤ä¸ªå…ˆè¡Œç‰ˆæœ¬å·ï¼Œå…¶ä¼˜å…ˆå±‚çº§â€œå¿…é¡» MUST â€é€è¿‡ç”±å·¦åˆ°å³çš„æ¯ä¸ªè¢«å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦å·æ¥æ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå·®å¼‚å€¼åå†³å®šï¼šåªæœ‰æ•°å­—çš„æ ‡è¯†ç¬¦å·ä»¥æ•°å€¼é«˜ä½æ¯”è¾ƒï¼Œæœ‰å­—æ¯æˆ–è¿æ¥å·æ—¶åˆ™é€å­—ä»¥ ASCII çš„æ’åºæ¥æ¯”è¾ƒã€‚æ•°å­—çš„æ ‡è¯†ç¬¦å·æ¯”éæ•°å­—çš„æ ‡è¯†ç¬¦å·ä¼˜å…ˆå±‚çº§ä½ã€‚è‹¥å¼€å¤´çš„æ ‡è¯†ç¬¦å·éƒ½ç›¸åŒæ—¶ï¼Œæ ä½æ¯”è¾ƒå¤šçš„å…ˆè¡Œç‰ˆæœ¬å·ä¼˜å…ˆå±‚çº§æ¯”è¾ƒé«˜ã€‚<ul><li>èŒƒä¾‹ï¼š1.0.0-alpha &lt; 1.0.0-alpha.1 &lt; 1.0.0-alpha.beta &lt; 1.0.0-beta &lt; 1.0.0-beta.2 &lt; 1.0.0-beta.11 &lt; 1.0.0- rc.1 &lt; 1.0.0ã€‚</li></ul></li></ul></li><li><p><strong>åº”è¯¥çº§ï¼šREQUIRED, SHALL, SHALL NOT</strong></p><ul><li>ä¸»ç‰ˆæœ¬å·ä¸ºé›¶ï¼ˆ0.y.zï¼‰çš„è½¯ä»¶å¤„äºå¼€å‘åˆå§‹é˜¶æ®µï¼Œä¸€åˆ‡éƒ½å¯èƒ½éšæ—¶è¢«æ”¹å˜ã€‚è¿™æ ·çš„å…¬å…± API ä¸åº”è¯¥è¢«è§†ä¸ºç¨³å®šç‰ˆ</li><li>1.0.0 çš„ç‰ˆæœ¬å·ç”¨äºç•Œå®šå…¬å…± API çš„å½¢æˆã€‚è¿™ä¸€ç‰ˆæœ¬ä¹‹åæ‰€æœ‰çš„ç‰ˆæœ¬å·æ›´æ–°éƒ½åŸºäºå…¬å…± API åŠå…¶ä¿®æ”¹å†…å®¹ã€‚</li><li>å½“åˆ¤æ–­ç‰ˆæœ¬çš„ä¼˜å…ˆå±‚çº§æ—¶ï¼Œç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯åº”è¯¥è¢«å¿½ç•¥ã€‚å› æ­¤å½“ä¸¤ä¸ªç‰ˆæœ¬åªæœ‰åœ¨ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯æœ‰å·®åˆ«æ—¶ï¼Œå±äºç›¸åŒçš„ä¼˜å…ˆå±‚çº§ã€‚</li></ul></li><li><p><strong>é€‰é¡¹çº§ï¼šMAYã€OPTIONAL</strong></p><ul><li>æ¬¡ç‰ˆæœ¬å· Yï¼ˆx.Y.z | x &gt; 0ï¼‰åœ¨å†…éƒ¨ç¨‹åºæœ‰å¤§é‡æ–°åŠŸèƒ½æˆ–æ”¹è¿›è¢«åŠ å…¥æ—¶é€’å¢ï¼Œä¹Ÿå¯ä»¥åŒ…æ‹¬ä¿®è®¢çº§åˆ«çš„æ”¹å˜</li><li>ä¸»ç‰ˆæœ¬å·å¯ä»¥åŒ…æ‹¬æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢çº§åˆ«çš„æ”¹å˜ã€‚</li><li>å…ˆè¡Œç‰ˆæœ¬å·è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆä¹‹åï¼Œå…ˆåŠ ä¸Šä¸€ä¸ªè¿æ¥å·å†åŠ ä¸Šä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦å·æ¥ä¿®é¥°ã€‚æ ‡è¯†ç¬¦å·å¿…é¡»ç”± ASCII ç çš„è‹±æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œä¸”ç¦æ­¢ç•™ç™½ã€‚æ•°å­—å‹çš„æ ‡è¯†ç¬¦å·ç¦æ­¢åœ¨å‰æ–¹è¡¥é›¶ã€‚å…ˆè¡Œç‰ˆçš„ä¼˜å…ˆçº§ä½äºç›¸å…³è”çš„æ ‡å‡†ç‰ˆæœ¬ã€‚è¢«æ ‡ä¸Šå…ˆè¡Œç‰ˆæœ¬å·åˆ™è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬å¹¶éç¨³å®šè€Œä¸”å¯èƒ½æ— æ³•è¾¾åˆ°å…¼å®¹çš„éœ€æ±‚ã€‚<ul><li>èŒƒä¾‹ï¼š1.0.0-alphaã€1.0.0-alpha.1ã€1.0.0-0.3.7ã€1.0.0-x.7.z.92ã€‚</li></ul></li><li>ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ä»¥è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆæˆ–å…ˆè¡Œç‰ˆæœ¬å·ä¹‹åï¼Œå…ˆåŠ ä¸Šä¸€ä¸ªåŠ å·å†åŠ ä¸Šä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦å·æ¥ä¿®é¥°ã€‚æ ‡è¯†ç¬¦å·å¿…é¡»ç”± ASCII çš„è‹±æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œä¸”ç¦æ­¢ç•™ç™½ã€‚<ul><li>èŒƒä¾‹ï¼š1.0.0-alpha+001ã€1.0.0+20130313144700ã€1.0.0-beta+exp.sha.5114f85ã€‚</li></ul></li></ul></li></ul><h2 id="ä¸€äº›å»ºè®®"><a href="#ä¸€äº›å»ºè®®" class="headerlink" title="ä¸€äº›å»ºè®®"></a>ä¸€äº›å»ºè®®</h2><ul><li>0.y.z åˆå§‹å¼€å‘é˜¶æ®µï¼Œæœ€å¥½ä»¥ 0.1.0 ä½œä¸ºåŸå§‹å¼€å‘ç‰ˆæœ¬</li><li>å¿«é€Ÿå¼€å‘å’Œè¿­ä»£æ—¶æœŸï¼Œæ­¤æ—¶ä¸»ç‰ˆæœ¬å·åº”è¯¥ä¸º 0</li><li>è½¯ä»¶è¢«ç”¨äºæ­£å¼ç¯å¢ƒå³æ˜¯ 1.0.0 ç‰ˆæœ¬çš„æœ€ä½³æ—¶æœº</li><li>ä¸è¦ä¸ºäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬å·è€Œè¯­ä¹‰åŒ–ï¼Œå®ƒæ˜¯ä¸ºäº†å¼€å‘è¿­ä»£æœåŠ¡çš„</li><li>è°¨æ…å¯¹å¾…ä¸å…¼å®¹çš„å¤§ç‰ˆæœ¬ï¼ˆå³ä¸»ç‰ˆæœ¬å·çº§åˆ«ï¼‰å‡çº§</li><li>å¤„ç†å¯ç”¨çš„æ›´æ–°ä¹‹å‰ï¼Œä¿ç•™ä¸€ä¸ªæ¬¡ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬åº”å…·æœ‰å¼ƒç”¨ä¿¡æ¯</li></ul>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¯ä»¶å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»åŒæ­¥ç¼–ç¨‹åˆ°å¼‚æ­¥ç¼–ç¨‹</title>
      <link href="/2016/04/16/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B9%8B%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%88%B0%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
      <url>/2016/04/16/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B9%8B%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%88%B0%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>è™½ç„¶æˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸€ä¸ªå¼‚æ­¥çš„ä¸–ç•Œé‡Œï¼Œä½†å¯¹äºå¤šæ•°ç¼–ç¨‹åˆå­¦è€…æ¥è¯´ï¼Œå¼‚æ­¥è¿˜æ˜¯å¾ˆé™Œç”Ÿã€‚å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œé€šå¸¸éƒ½æ˜¯ä»åŒæ­¥æµç¨‹å¼€å§‹çš„ï¼Œå³é¡ºåºã€åˆ†æ”¯å’Œå¾ªç¯ã€‚è€Œå¼‚æ­¥æµç¨‹æ˜¯ä»€ä¹ˆå‘¢â€”â€”å¼€å§‹ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Œç„¶åâ€¦â€¦å°±æ²¡æœ‰ç„¶åäº†ã€‚å¼‚æ­¥ç¨‹åºè·‘å“ªå»äº†ï¼Ÿ</p><p>å¼‚æ­¥ç¨‹åºä¼šä»¥æŸç§å¼‚æ­¥çš„å½¢å¼åœ¨è¿è¡Œç€ï¼Œæ¯”å¦‚å¤šçº¿ç¨‹ã€å¼‚æ­¥IOç­‰ï¼Œç›´åˆ°å¤„ç†å®Œæˆã€‚é‚£å¦‚æœéœ€è¦å¤„ç†ç»“æœæ€ä¹ˆåŠï¼Ÿç»™ä¸€ä¸ªç¨‹åºå…¥å£ï¼Œè®©å®ƒå¤„ç†å®Œå½“å‰è¿‡ç¨‹ä¹‹åï¼ŒæŠŠå¤„ç†ç»“æœé€åˆ°è¿™ä¸ªå…¥å£ï¼Œç„¶åæ‰§è¡Œå¦ä¸€æ®µç¨‹åºâ€”â€”ä¿—ç§°å›è°ƒã€‚å›è°ƒä¸€èˆ¬ä½¿ç”¨ <code>callback</code> è¿™ä¸ªåç§°ï¼Œä¸è¿‡æœ‰æ—¶å€™æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ <code>next</code>ï¼Œå› ä¸ºå®ƒä»£è¡¨ç€ä¸‹ä¸€ä¸ªå¤„ç†æ­¥éª¤ã€‚</p><a id="more"></a><h2 id="åŒæ­¥å’Œå¼‚æ­¥çš„æ¦‚å¿µ"><a href="#åŒæ­¥å’Œå¼‚æ­¥çš„æ¦‚å¿µ" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥çš„æ¦‚å¿µ"></a>åŒæ­¥å’Œå¼‚æ­¥çš„æ¦‚å¿µ</h2><p>ç°åœ¨æˆ‘ä»¬æ¥è§¦åˆ°äº†ä¸€äº›æ¦‚å¿µï¼Œæ¯”å¦‚åŒæ­¥å’Œå¼‚æ­¥ï¼Œå®ƒä»¬æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™ä¸¤ä¸ªæ¦‚å¿µå¹¶ä¸æ¥æºäºç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯æ¥æºäºä½å±‚æŒ‡ä»¤ï¼Œç”šè‡³æ›´ä½å±‚çš„â€”â€”ç”µè·¯ã€‚å®ƒä»¬æ˜¯åŸºäºæ—¶åºçš„ä¸¤ä¸ªæ¦‚å¿µï¼Œå…¶ä¸­ï¼Œâ€œæ­¥â€æ˜¯æŒ‡æ­¥è°ƒï¼Œæ‰€ä»¥åŒæ­¥è¡¨ç¤ºç›¸åŒçš„æ­¥è°ƒï¼Œè€Œå¼‚æ­¥è¡¨ç¤ºä¸åŒçš„æ­¥è°ƒã€‚å½“ç„¶è¿™ä¸¤ä¸ªæ¦‚å¿µæå‡åˆ°ç¨‹åºè¿™ä¸ªçº§åˆ«çš„æ—¶å€™ï¼Œç²¾ç¡®çš„æ„æ€ä¸æ—¶é’Ÿæ— å…³ï¼Œä½†æ‰€è¡¨ç¤ºçš„æ„ä¹‰ä»ç„¶æœªå˜ã€‚</p><h3 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h3><p>ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜â€”â€”æ’é™¤ä¹°ç¥¨ã€‚å”®ç¥¨å…å¼€äº†ä¸€ä¸ªçª—å£ï¼Œæœ‰ä¸€é˜Ÿäººåœ¨æ’é˜Ÿä¾æ¬¡ä¹°ç¥¨ã€‚è¿™ä¸ªé˜Ÿä¼ä¸­ï¼Œå‰é¢ä¸€ä¸ªäººå¾€å‰èµ°äº†ä¸€æ­¥ï¼Œåé¢çš„äººæ‰èƒ½å¾€å‰èµ°ä¸€æ­¥ï¼›å‰é¢çš„äººåœ¨ç­‰å¾…ï¼Œåé¢çš„äººå°±ä¸€å®šåœ¨ç­‰å¾…ã€‚é‚£ä¹ˆåœ¨ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰äººå¯ä»¥åŒæ—¶å‘å‰è¿ˆæ­¥ã€‚OKï¼Œå¤§å®¶æ­¥ä¼ä¸€è‡´ï¼Œç§°ä¸ºåŒæ­¥ã€‚</p><p>è¿™é‡ŒæŠŠå”®ç¥¨çª—å£çœ‹ä½œæ˜¯å¤„ç†å™¨ï¼Œæ¯ä¸ªäººçœ‹ä½œæ˜¯ç­‰å¾…æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¹°ç¥¨è¿™ä¸ªåŠ¨ä½œå°±æ˜¯åœ¨æ‰§è¡ŒæŒ‡ä»¤ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯æŒ‰æ­¥å°±ç­ï¼Œå¦‚æœä¸€ä¸ªäººä¹°ç¥¨æ—¶é—´è¿‡é•¿ï¼ˆæŒ‡ä»¤æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼‰ï¼Œå°±ä¼šé€ æˆé˜»å¡ã€‚</p><h3 id="å¼‚æ­¥ï¼ˆå¤šçº¿ç¨‹ï¼‰"><a href="#å¼‚æ­¥ï¼ˆå¤šçº¿ç¨‹ï¼‰" class="headerlink" title="å¼‚æ­¥ï¼ˆå¤šçº¿ç¨‹ï¼‰"></a>å¼‚æ­¥ï¼ˆå¤šçº¿ç¨‹ï¼‰</h3><p>ç°åœ¨ä¹°ç¥¨çš„äººæ¸æ¸å¤šèµ·æ¥ï¼Œæ‰€ä»¥å”®ç¥¨å…å¤šå¼€äº†å‡ ä¸ªçª—å£åŒæ—¶å”®ç¥¨ã€‚æ¯ä¸ªå•ç‹¬çš„é˜Ÿä¼ä»ç„¶ä¿æŒç€åŒæ­¥ï¼Œä½†ä¸åŒçš„é˜Ÿä¼ä¹‹é—´ï¼Œæ­¥ä¼ä¸å†ä¸€è‡´ï¼Œç§°ä¸ºå¼‚æ­¥ã€‚A é˜Ÿåˆ—å”®ç¥¨å¾ˆé¡ºåˆ©ï¼Œé˜Ÿä¼åœ¨æœ‰åºå¿«é€Ÿçš„å‰è¿›ï¼Œä½† B é˜Ÿåˆ—çš„æŸä¸ªé¡¾å®¢ä¼¼ä¹åœ¨ä»˜è´¹æ—¶é‡åˆ°ç‚¹éº»çƒ¦ï¼ŒèŠ±äº†å¾ˆé•¿çš„æ—¶å€™ï¼Œé€ æˆé˜»å¡ï¼Œä½†è¿™å¯¹ A é˜Ÿåˆ—å¹¶ä¸äº§ç”Ÿå½±å“ã€‚</p><p>è¿™æ—¶å€™çš„å”®ç¥¨å…å¯ä»¥çœ‹ä½œæ˜¯åœ¨ä»¥å¤šçº¿ç¨‹çš„æ–¹å¼è¿è¡Œç€å¼‚æ­¥ç¨‹åºã€‚ä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹åˆ°å¼‚æ­¥çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼šå…¶ä¸€ï¼Œä¸¤ä¸ªå¼‚æ­¥æµç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå®ƒä»¬ç›¸äº’ä¸ä¼šé˜»å¡ï¼ˆæœ‰ä¸ªå‰æï¼Œä¸éœ€è¦ç­‰å¾…å…±äº«èµ„æºçš„æƒ…å†µä¸‹ï¼‰ï¼›å…¶äºŒï¼Œ<strong>å¼‚æ­¥ç¨‹åºå†…éƒ¨ä»ç„¶æ˜¯åŒæ­¥çš„</strong>ã€‚</p><h3 id="å¼‚æ­¥ï¼ˆIOï¼‰"><a href="#å¼‚æ­¥ï¼ˆIOï¼‰" class="headerlink" title="å¼‚æ­¥ï¼ˆIOï¼‰"></a>å¼‚æ­¥ï¼ˆIOï¼‰</h3><p>ä¸Šé¢çš„ä¾‹å­æ¯”è¾ƒç¬¦åˆå¤šçº¿ç¨‹å¼‚æ­¥çš„æƒ…å†µã€‚é‚£ IO å¼‚æ­¥åˆæ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>å¹´åº•äº†ï¼ŒM åœ¨å‡†å¤‡å¹´ç»ˆæ±‡æŠ¥çš„èµ„æ–™ï¼Œè¿™å¯æ˜¯ä¸ªç´§å¼ çš„å·¥ä½œï¼ˆCPUï¼‰ï¼Œè¦æ”¶é›†ä¸å°‘æ•°æ®æ¥å†™å¥½äº›æ–‡æ¡ˆã€‚ä¸ºäº†å…¶ä¸­ä¸€ä»½æ–‡æ¡ˆï¼ŒM éœ€è¦è½¦é—´çš„ç”Ÿäº§æ•°æ®ï¼Œä½†è·‘ä¸€è¶Ÿè½¦é—´ï¼ˆIOï¼‰å¯éœ€è¦èŠ±ä¸å°‘æ—¶é—´ï¼Œæ‰€ä»¥ä»–è®© N å»è½¦é—´æ”¶é›†æ•°æ®ï¼Œè‡ªå·±åˆ™ç»§ç»­å†™å…¶å®ƒæ–¹æ¡ˆï¼ŒåŒæ—¶ç­‰ N æŠŠæ•°æ®æ”¶é›†å›æ¥ï¼ˆå¯åŠ¨å¼‚æ­¥ç¨‹åºï¼‰ã€‚åŠå¤©ä»¥åï¼ŒN å¸¦å›äº†æ•°æ®ï¼ˆæ’å…¥äº‹ä»¶æ¶ˆæ¯ï¼‰ï¼ŒM ç»§ç»­å®Œæˆæ‰‹ä¸Šçš„æ–‡æ¡ˆï¼ˆå®Œæˆå½“å‰äº‹ä»¶å¾ªç¯ï¼‰ï¼Œä¹‹åä½¿ç”¨ N å¸¦å›æ¥çš„æ•°æ®å¼€å§‹æ’°å†™å…³äºè½¦é—´çš„æŠ¥å‘Šï¼ˆæ–°çš„äº‹ä»¶å¾ªç¯ï¼‰â€¦â€¦</p><p>IO çš„å¤„ç†é€Ÿåº¦æ¯” CPU æ…¢å¾—å¤šï¼Œæ‰€ä»¥ IO å¼‚æ­¥è®© CPU ä¸å¿…é—²ç½®ç€ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å½“ IO æ“ä½œå®Œæˆä¹‹åï¼ŒCPU ä¼šé€‚åœ°ä½¿ç”¨ IO æ“ä½œç»“æœç»§ç»­å·¥ä½œã€‚</p><h2 id="åŒæ­¥é€»è¾‘å’Œå¼‚æ­¥é€»è¾‘"><a href="#åŒæ­¥é€»è¾‘å’Œå¼‚æ­¥é€»è¾‘" class="headerlink" title="åŒæ­¥é€»è¾‘å’Œå¼‚æ­¥é€»è¾‘"></a>åŒæ­¥é€»è¾‘å’Œå¼‚æ­¥é€»è¾‘</h2><p>å›åˆ°ç¨‹åºä¸Šæ¥ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªå‡½æ•°çš„å¤„ç†è¿‡ç¨‹æ¥æè¿°åŒæ­¥å’Œå¼‚æ­¥çš„å¤„ç†æ–¹å¼ã€‚</p><h3 id="åŒæ­¥é€»è¾‘"><a href="#åŒæ­¥é€»è¾‘" class="headerlink" title="åŒæ­¥é€»è¾‘"></a>åŒæ­¥é€»è¾‘</h3><p>é‚£ä¹ˆï¼ŒåŒæ­¥å¤„ç†è¿‡ç¨‹æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¥å—è¾“å…¥ â‡’ å¤„ç† â‡’ äº§ç”Ÿè¾“å‡º</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç”¨ä¸€æ®µä¼ªä»£ç æ¥æè¿°å°±æ˜¯</p><blockquote><p>æ³¨ï¼šæœ¬æ–‡ä¸­çš„ä¼ªä»£ç æ¯”è¾ƒæ¥è¿‘ JavaScriptè¯­æ³•ï¼Œè€Œæœ‰æ—¶å€™ä¸ºäº†è¯´æ˜ç±»å‹ï¼Œé‡‡ç”¨äº† TypeScript çš„ç±»å‹ç”³æ˜è¯­æ³•ã€‚</p></blockquote><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">(input)</span></span> &#123;</span><br><span class="line">    <span class="keyword">do</span> something with <span class="built_in">input</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">output</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ ‡å‡†çš„ IPO(Input-Process-Output) å¤„ç†ã€‚</p><h3 id="å¼‚æ­¥é€»è¾‘"><a href="#å¼‚æ­¥é€»è¾‘" class="headerlink" title="å¼‚æ­¥é€»è¾‘"></a>å¼‚æ­¥é€»è¾‘</h3><p>è€Œå¼‚æ­¥å‘¢ï¼Œæ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¥å—è¾“å…¥ â‡’ å¤„ç† â‡’ å¯åŠ¨ä¸‹ä¸€æ­¥ï¼ˆå¦‚æœæœ‰ï¼‰</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç”¨ä¼ªä»£ç æ¥æè¿°å°±æ˜¯ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span><span class="params">(input, next)</span></span> &#123;</span><br><span class="line">    <span class="keyword">do</span> something with <span class="built_in">input</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">next</span> is a entry) &#123;</span><br><span class="line">        <span class="built_in">next</span>(<span class="built_in">output</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º IPN(Input-Process-Next)ã€‚</p><p>æ³¨æ„åˆ°è¿™é‡Œçš„ Nextï¼Œä¸‹ä¸€æ­¥ï¼Œåªæœ‰ä¸€æ­¥ã€‚è¿™ä¸€æ­¥ï¼Œå›Šæ‹¬äº†åç»­çš„è‹¥å¹²æ­¥éª¤ã€‚æ‰€ä»¥è¿™ä¸€æ­¥ï¼Œåªèƒ½æ˜¯åç»­è‹¥å¹²æ­¥éª¤å°è£…å‡ºæ¥ä¸€ä¸ªæ¨¡å—å…¥å£ï¼Œæˆ–è€…è¯´å‡½æ•°ã€‚</p><p>å› æ­¤ï¼Œ<strong>æ¨¡å—åŒ–æ€æƒ³åœ¨å¼‚æ­¥æ€ç»´ä¸­æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„æ€æƒ³</strong>ã€‚å¾ˆå¤šåˆå­¦è€…å†™ä»£ç å–œæ¬¢åƒè®°æµæ°´è´¦ä¸€æ ·ä¸€å¥å¥å¾€ä¸‹å†™ï¼ŒåŠ¨ä¸åŠ¨å°±æ˜¯æˆç™¾ä¸Šåƒè¡Œçš„å‡½æ•°ï¼Œè¿™å°±æ˜¯ä¸€ç§ç¼ºä¹æ¨¡å—åŒ–æ€æƒ³çš„è¡¨ç°ã€‚æ¨¡å—åŒ–æ€æƒ³éœ€è¦è®­ç»ƒï¼Œåˆ†æä»£ç çš„ç›¸å…³æ€§ï¼Œæç‚¼å‡½æ•°ï¼Œæå–å¯¹è±¡ï¼Œåœ¨å…·æœ‰ä¸€å®šç»éªŒä¹‹åè¿˜éœ€è¦æŒæ¡æ¨¡å—ç»†åŒ–çš„ç²’åº¦å¹³è¡¡ã€‚è¿™ä¸æ˜¯ä¸€æœä¸€å¤•ä¹‹åŠŸï¼Œä¸è¿‡æˆ‘æ¨èçœ‹çœ‹â€œè®¾è®¡æ¨¡å¼â€å’Œâ€œé‡æ„â€ç›¸å…³çš„ä¹¦ç±ã€‚</p><h2 id="å¼‚æ­¥å¼€å‘å·¥å…·ï¼ˆSDKå’Œè¯­æ³•å±‚é¢çš„ï¼‰"><a href="#å¼‚æ­¥å¼€å‘å·¥å…·ï¼ˆSDKå’Œè¯­æ³•å±‚é¢çš„ï¼‰" class="headerlink" title="å¼‚æ­¥å¼€å‘å·¥å…·ï¼ˆSDKå’Œè¯­æ³•å±‚é¢çš„ï¼‰"></a>å¼‚æ­¥å¼€å‘å·¥å…·ï¼ˆSDKå’Œè¯­æ³•å±‚é¢çš„ï¼‰</h2><h3 id="æ‰¿è¯ºï¼ˆPromiseï¼‰"><a href="#æ‰¿è¯ºï¼ˆPromiseï¼‰" class="headerlink" title="æ‰¿è¯ºï¼ˆPromiseï¼‰"></a>æ‰¿è¯ºï¼ˆPromiseï¼‰</h3><p>å†æƒ³æƒ³ä¸Šé¢å…³äºå¹´ç»ˆæ±‡æŠ¥çš„ä¾‹å­ï¼ŒM è¯· N å»è½¦é—´æ”¶é›†æ•°æ®çš„æ—¶å€™ï¼ŒN ä¼šè¯´ï¼šâ€œå¥½çš„ï¼Œæˆ‘å¾ˆå¿«å°±æŠŠæ•°æ®å¸¦å›æ¥â€ï¼Œè¿™æ˜¯ä¸€ç§æ‰¿è¯ºã€‚åŸºäºè¿™ä¸ªæ‰¿è¯ºï¼ŒM æ‰èƒ½å®‰æ’åé¢æ’°å†™å…³äºè½¦é—´çš„æ±‡æŠ¥ææ–™ã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨ä¼ªä»£ç æ¥æè¿°å°±æ˜¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collectData</span>(<span class="params"></span>): <span class="title">Promise</span> </span>&#123;</span><br><span class="line">    <span class="comment">// N å»æ”¶é›†æ•°æ®ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ‰¿è¯º</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        collect data <span class="keyword">from</span> workshop</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ‰¿è¯ºæœ€ç»ˆä¼šå¸¦æ¥æ•°æ®</span></span><br><span class="line">        resolve(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeWorkshopReport</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    write report <span class="keyword">with</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶é›†æ•°æ®çš„æ‰¿è¯ºå…‘ç°ä¹‹åï¼Œå¯å°†è¿™ä¸ªæ•°æ®ç”¨äºå†™æŠ¥å‘Š</span></span><br><span class="line">collectData()</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> writeWorkshopReport(data))</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä»¥ JavaScriptä¸ºä»£è¡¨çš„ä¸€äº›è¯­è¨€ SDK ä¸­ä½¿ç”¨äº† <code>Promise</code>ã€‚ä¸è¿‡ C# ä¸­æ˜¯é‡‡ç”¨çš„ <code>Task</code> å’Œ <code>Task&lt;T&gt;</code>ï¼Œç›¸åº”çš„ï¼Œä½¿ç”¨äº† <code>Task.ContinueWith</code> å’Œ <code>Task&lt;T&gt;.ContinueWith</code> æ¥ä»£æ›¿ <code>Promise.then</code>ã€‚</p><h3 id="å¼‚æ­¥é€»è¾‘åŒæ­¥åŒ–"><a href="#å¼‚æ­¥é€»è¾‘åŒæ­¥åŒ–" class="headerlink" title="å¼‚æ­¥é€»è¾‘åŒæ­¥åŒ–"></a>å¼‚æ­¥é€»è¾‘åŒæ­¥åŒ–</h3><p>ä¸Šé¢æåˆ°äº†åŒæ­¥æ€ç»´å’Œå¼‚æ­¥æ€ç»´åœ¨ä¸€ä¸ªå¤„ç†æ­¥éª¤ä¸­çš„åŒºåˆ«ã€‚å¦‚æœè·³å‡ºä¸€ä¸ªå¤„ç†æ­¥éª¤ï¼Œä»æ›´å¤§èŒƒå›´çš„å¤„ç†æµç¨‹æ¥çœ‹ï¼Œå¼‚æ­¥ä¸åŒæ­¥å…¶å®ä¹Ÿæ²¡å¤šå¤§åŒºåˆ«ï¼Œéƒ½æ˜¯ <code>è¾“å…¥--&gt;å¤„ç†--&gt;äº§ç”Ÿè¾“å‡º--&gt;å°†è¾“å‡ºç”¨äºä¸‹ä¸€æ­¥éª¤</code>ï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯éœ€è¦ç­‰å¾…å¼‚æ­¥å¤„ç†äº§ç”Ÿçš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º<strong>å¼‚æ­¥ç­‰å¾…</strong>ã€‚ç”±äºæˆ‘ä»¬å¯ä»¥ä¸€è¾¹è¿›è¡Œå¼‚æ­¥ç­‰å¾…ï¼ˆasync waitï¼Œç®€å†™ awaitï¼‰ï¼Œä¸€è¾¹åšåˆ«çš„äº‹æƒ…ï¼Œæ‰€ä»¥è¿™ä¸ªç­‰å¾…å¹¶ä¸äº§ç”Ÿé˜»å¡ã€‚ä½†æ˜¯ï¼Œç”±äºå£°æ˜äº†è¿™ä¸ªç­‰å¾…ï¼Œç¼–è¯‘å™¨/è§£é‡Šå™¨ä¼šå°†åé¢çš„ä»£ç è‡ªåŠ¨æ”¾åœ¨ç­‰å¾…å®Œæˆä¹‹åè°ƒç”¨ï¼Œè¿™è®©å¼‚æ­¥ä»£ç å†™èµ·æ¥å°±åƒå†™åŒæ­¥ä»£ç ä¸€æ ·ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å¼‚æ­¥ç­‰å¾…çš„ä¼ªä»£ç ä¼šåƒè¿™æ ·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">collectData</span>(<span class="params"></span>): <span class="title">Promise</span> </span>&#123;</span><br><span class="line">    collect data <span class="keyword">from</span> workshop</span><br><span class="line">    <span class="comment">// å¤šæ•°è¯­è¨€ä¼šæŠŠ async å‡½æ•°çš„è¿”å›å€¼å°è£…æˆ Promise</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeWorkshopReport</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    write report <span class="keyword">with</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// await åªèƒ½ç”¨äºå£°æ˜ä¸º async çš„å‡½æ•°ä¸­</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    data = <span class="keyword">await</span> collectData()</span><br><span class="line">    writeWorkshopReport(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº†å¼‚æ­¥ main å‡½æ•°ï¼Œä¸€å®šè¦è®°å¾—è°ƒç”¨ï¼Œä¸ç„¶å®ƒæ˜¯ä¸ä¼šæ‰§è¡Œçš„</span></span><br><span class="line">main()</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>åƒ C# å’Œ JavaScriptç­‰è¯­è¨€éƒ½ä»è¯­æ³•å±‚é¢è§„å®šäº† <code>await</code> å¿…é¡»ç”¨åœ¨å£°æ˜ä¸º <code>async</code> çš„å‡½æ•°ä¸­ï¼Œè¿™å°±ä»ç¼–è¯‘/è§£é‡Šçš„å±‚é¢é™å®šäº† <code>await</code> çš„ç”¨é€”ï¼Œåªè¦ä½¿ç”¨äº† <code>await</code>ï¼Œé‚£å®ƒæ‰€å¤„çš„å°±ä¸€å®šæ˜¯ä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ã€‚è€Œ <code>async</code> ä¹Ÿè¦æ±‚ç¼–è¯‘å™¨/è§£é‡Šå™¨å¯¹å…¶è¿”å›å€¼è¿›è¡Œä¸€äº›è‡ªåŠ¨å¤„ç†ï¼Œæ¯”å¦‚åœ¨ JavaScriptä¸­ï¼Œå…¶è¿”å›å€¼å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå®ƒä¼šè‡ªåŠ¨å°è£…æˆä¸€ä¸ª Promise å¯¹è±¡ï¼›è€Œåœ¨ C# ä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨å°è£…æˆ <code>Task</code> æˆ– <code>Task&lt;T&gt;</code>ï¼ˆæ‰€ä»¥ <code>async</code> æ–¹æ³•çš„ç±»å‹éœ€è¦å£°æ˜ä¸º <code>Task</code> æˆ– <code>Task&lt;T&gt;</code>ï¼‰ã€‚</p><h3 id="æ³¨æ„ï¼Œæ³¨æ„ï¼Œæ³¨æ„"><a href="#æ³¨æ„ï¼Œæ³¨æ„ï¼Œæ³¨æ„" class="headerlink" title="æ³¨æ„ï¼Œæ³¨æ„ï¼Œæ³¨æ„"></a>æ³¨æ„ï¼Œæ³¨æ„ï¼Œæ³¨æ„</h3><p>å°½ç®¡è¯­è¨€æœåŠ¡åœ¨å¼‚æ­¥ç¨‹åºåŒæ­¥åŒ–æ–¹é¢å·²ç»åšäº†å¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯ä»ç„¶é¿å…ä¸äº†ä¸€äº›äººä¸ºé”™è¯¯ï¼Œæ¯”å¦‚å¿˜è®°å†™ <code>await</code> å…³é”®å­—ã€‚åœ¨å¼ºç±»å‹è¯­è¨€ä¸­ç¼–è¯‘å™¨ä¼šæ£€æŸ¥å¾—ä¸¥æ ¼ä¸€äº›ï¼Œä½†å¦‚æœæ˜¯åœ¨ JavaScriptä¸­ï¼Œå¿˜è®°å†™ <code>await</code> æ„å‘³ç€åŸæœ¬åº”è¯¥å–å¾—ä¸€ä¸ªå€¼çš„è¯­å¥ï¼Œä¼šå–åˆ°ä¸€ä¸ª Promiseã€‚è§£é‡Šå™¨ä¸ä¼šå¯¹æ­¤è´¨ç–‘ï¼Œä½†ç¨‹åºè¿è¡Œçš„ç»“æœä¼šä¸æ­£ç¡®ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ€»çš„æ¥è¯´ï¼Œå¼‚æ­¥ç¼–ç¨‹å¹¶ä¸æ˜¯ç‰¹åˆ«å›°éš¾çš„äº‹æƒ…ã€‚ä½¿ç”¨ async/await è¯­è¨€ç‰¹æ€§ç”šè‡³å¯ä»¥ç”¨ç±»ä¼¼ç¼–å†™åŒæ­¥ä»£ç çš„æ–¹æ³•æ¥ç¼–å†™å¼‚æ­¥ä»£ç ã€‚ä½†è¯­æ³•ç³–ç»ˆç©¶æ˜¯ç³–ï¼Œè¦æƒ³æŠŠå¼‚æ­¥ç¼–ç¨‹æŒæ¡å¾—æ›´å¥½ï¼Œè¿˜æ˜¯éœ€è¦å»äº†è§£å’Œç†Ÿæ‚‰å¼‚æ­¥ã€å›è°ƒã€Promiseã€æ¨¡å—åŒ–ã€è®¾è®¡æ¨¡å¼ã€é‡æ„ç­‰æ¦‚å¿µã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’åºä¹‹å †æ’åºä¸JavaScriptå®ç°</title>
      <link href="/2016/04/01/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E4%B9%8B%E5%A0%86%E6%8E%92%E5%BA%8F/"/>
      <url>/2016/04/01/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E4%B9%8B%E5%A0%86%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="æˆå †-Heapify"><a href="#æˆå †-Heapify" class="headerlink" title="æˆå † Heapify"></a>æˆå † <code>Heapify</code></h3><p>å¯¹äºä¸€ä¸ªç»™å®šçš„æ•°ç»„ï¼Œæˆ‘ä»¬ä¸ä¸€å®šå®ç°å †è¿™ä¸ªç±»ï¼Œè€Œæ˜¯é€šè¿‡<strong>æˆå † (Heapify)</strong> è¿™æ ·çš„æ“ä½œæ¥ä½¿å¾—æ•°ç»„å…·æœ‰å †çš„æ€§è´¨ã€‚</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/Heapify.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/Heapify.png" alt="img"></a></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¦ä½¿å¾—è¿™ä¸ªæ•°ç»„æ‰€å¯¹åº”çš„å®Œå…¨äºŒå‰æ ‘å½¢æˆä¸€ä¸ªæœ€å¤§å †ï¼Œåªéœ€è¦ä½¿å¾—æ¯ä¸€æ£µå­æ ‘éƒ½å½¢æˆæœ€å¤§å †å³å¯ã€‚é‚£ä¹ˆä¸éš¾çœ‹å‡ºï¼Œæ‰€æœ‰çš„å¶å­ç»“ç‚¹éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä»…æœ‰ä¸€ä¸ªå…ƒç´ çš„æœ€å¤§å †ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä»æœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹å¼€å§‹ï¼Œé€šè¿‡å‰ä¸€èŠ‚çš„ <code>shiftDown</code> æ“ä½œï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„æ„å»ºå‡ºæœ€å¤§å †æ¥ã€‚</p><blockquote><p>ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„æ•°å­¦å…³ç³»æ˜¯: å®Œå…¨äºŒå‰æ ‘æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„ç´¢å¼•æ˜¯ $n\div{2}$ï¼Œä¾‹å¦‚è¿™é‡Œæœ‰ <code>10</code> ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹çš„ç´¢å¼•å°±æ˜¯ <code>5</code>ï¼›ç±»ä¼¼çš„ï¼Œå¦‚æœæœ‰ <code>11</code> ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆåŒæ · <code>5</code>æ˜¯æœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹çš„ç´¢å¼•ï¼›ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ç´¢å¼•æ˜¯ä» <code>1</code> å¼€å§‹çš„ï¼Œå¦‚æœæ˜¯ä» <code>0</code> å¼€å§‹çš„ç´¢å¼•åªéœ€ä½¿ <code>i-1</code> ($n\div{2}-1$) å³å¯ã€‚è¿™å¾ˆå®¹æ˜“å°±èƒ½ç”¨æ•°å­¦å½’çº³æ³•è¯æ˜ã€‚</p></blockquote><p>ç®€å•æ¥è¯´ï¼Œ<code>Heapify</code> çš„ç®—æ³•è¿‡ç¨‹å¯ä»¥ç®€è¿°ä¸º:</p><ol><li>ä»æœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹å¼€å§‹å‘å‰éå†æ•°ç»„ï¼›</li><li>æ¯é‡åˆ°ä¸€ä¸ªéå¶å­ç»“ç‚¹ï¼Œå°±é€šè¿‡ <code>shiftDown</code> ä½¿ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘æˆæœ€å¤§å †ï¼›</li><li>é‡å¤ç›´åˆ°æ ¹èŠ‚ç‚¹å®Œæˆ <code>shiftDown</code>ã€‚</li></ol><p>åŠ¨ç”»æ¼”ç¤º:</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/Heapify.gif"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/Heapify.gif" alt="img"></a></p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; PrintableMaxHeap &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./02-Max-Heap-Class-Basic&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// heapSort1, å°†æ‰€æœ‰çš„å…ƒç´ ä¾æ¬¡æ·»åŠ åˆ°å †ä¸­, åœ¨å°†æ‰€æœ‰å…ƒç´ ä»å †ä¸­ä¾æ¬¡å–å‡ºæ¥, å³å®Œæˆäº†æ’åº</span></span><br><span class="line"><span class="comment">// æ— è®ºæ˜¯åˆ›å»ºå †çš„è¿‡ç¨‹, è¿˜æ˜¯ä»å †ä¸­ä¾æ¬¡å–å‡ºå…ƒç´ çš„è¿‡ç¨‹, æ—¶é—´å¤æ‚åº¦å‡ä¸º O(nlogn)</span></span><br><span class="line"><span class="comment">// æ•´ä¸ªå †æ’åºçš„æ•´ä½“æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)</span></span><br><span class="line"><span class="built_in">exports</span>.heapSort1 = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> n = array.length</span><br><span class="line">  <span class="keyword">const</span> maxHeap = <span class="keyword">new</span> PrintableMaxHeap(n)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> array) &#123;</span><br><span class="line">    maxHeap.insert(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    array[i] = maxHeap.extractMax()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// heapSort2, å€ŸåŠ©æˆ‘ä»¬çš„ heapify è¿‡ç¨‹åˆ›å»ºå †</span></span><br><span class="line"><span class="comment">// æ­¤æ—¶, åˆ›å»ºå †çš„è¿‡ç¨‹æ—¶é—´å¤æ‚åº¦ä¸º O(n), å°†æ‰€æœ‰å…ƒç´ ä¾æ¬¡ä»å †ä¸­å–å‡ºæ¥, æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)</span></span><br><span class="line"><span class="comment">// å †æ’åºçš„æ€»ä½“æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯ O(nlogn), ä½†æ˜¯æ¯”ä¸Šè¿° heapSort1 æ€§èƒ½æ›´ä¼˜, å› ä¸ºåˆ›å»ºå †çš„æ€§èƒ½æ›´ä¼˜</span></span><br><span class="line"><span class="built_in">exports</span>.heapSort2 = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> n = array.length</span><br><span class="line">  <span class="keyword">const</span> maxHeap = <span class="keyword">new</span> PrintableMaxHeap(array, n)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    array[i] = maxHeap.extractMax()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxHeap</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ–°çš„æ„é€ å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªæ•°ç»„ä½¿å…¶æˆæœ€å¤§å †</span></span><br><span class="line">  <span class="keyword">constructor</span> (array) &#123;</span><br><span class="line">    <span class="keyword">const</span> n = array.length</span><br><span class="line">    this.#data = new Array(n + 1)</span><br><span class="line">    this.#capacity = n</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      this.#data[i + 1] = array[i]</span><br><span class="line">    &#125;</span><br><span class="line">    this.#count = n</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="built_in">Math</span>.floor(n / <span class="number">2</span>); i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">      shiftDownEnhance(this.#data, i, n)  // è§ã€æ…•è¯¾ã€‘é‡å­¦ç®—æ³• - part.3 å †æ’åº (1)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡å †è¿›è¡Œæ’åº"><a href="#é€šè¿‡å †è¿›è¡Œæ’åº" class="headerlink" title="é€šè¿‡å †è¿›è¡Œæ’åº"></a>é€šè¿‡å †è¿›è¡Œæ’åº</h4><p>é€šè¿‡æ–°çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„å°†ä¸€ä¸ªæ•°ç»„æ„é€ ä¸ºæœ€å¤§å †ï¼Œæ˜¾è€Œæ˜“è§çš„ï¼Œæˆ‘ä»¬å°†æ•°ç»„æ”¾å…¥å†å–å‡ºæœ€å¤§å †çš„è¿‡ç¨‹ï¼Œå…¶å®å°±å®Œæˆäº†ä¸€æ¬¡æ’åºã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * generateRandomArray <span class="doctag">@see </span>https://github.com/Mitscherlich/Play-with-Algorithms-JS/blob/master/test/utils/index.js#L8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> sorted = []</span><br><span class="line"><span class="keyword">const</span> array = generateRandomArray(<span class="number">50</span>, <span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">const</span> maxHeap = <span class="keyword">new</span> MaxHeap(array.slice())</span><br><span class="line"><span class="keyword">while</span> (!maxHeap.isEmpty()) &#123;</span><br><span class="line">  sorted.unshift(maxHeap.extractMax())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(sorted))</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šè¿‡ <code>Heapify</code> æ¥æˆå †çš„æ“ä½œå¹¶è¿›è¡Œå †æ’åºé€Ÿåº¦ç”±äºä¸Šä¸€èŠ‚æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå°†å…ƒç´ æ’å…¥è¿›å †çš„æ“ä½œï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸¤ç§æ“ä½œçš„ç®—æ³•å¤æ‚åº¦çš„ç¡®æœ‰æ‰€ä¸åŒçš„ï¼š</p><ul><li>å°† <code>n</code> ä¸ªå…ƒç´ æ³¨æ„æ’å…¥ç©ºå †ä¸­ï¼š$O(nlog{n})$</li><li><code>Heapfiy</code>ï¼š$O(n)$</li></ul><p>ç”±äºå †ç®—æ³•å¤æ‚åº¦çš„è¯æ˜ä¸æ˜¯æœ¬ç³»åˆ—çš„é‡ç‚¹å¹¶ä¸”æœ‰ç‚¹éš¾ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±æ¥è¿›è¡Œè¯¦ç»†åœ°æ¨å¯¼è¯æ˜ï¼Œè¿™é‡Œå¹¶ä¸å±•å¼€ã€‚</p><h3 id="æ•°ç»„çš„åŸåœ°å †æ’åº"><a href="#æ•°ç»„çš„åŸåœ°å †æ’åº" class="headerlink" title="æ•°ç»„çš„åŸåœ°å †æ’åº"></a>æ•°ç»„çš„åŸåœ°å †æ’åº</h3><p>æ— è®ºæ˜¯å°†å…ƒç´ é€ä¸€æ’å…¥ç©ºå †è¿˜æ˜¯é€šè¿‡ <code>Heapify</code> æ¥ä½¿æ•°ç»„æˆå †ï¼Œæˆ‘ä»¬å®é™…ä¸Šéƒ½å¼€è¾Ÿäº†ä¸€ä¸ªå †çš„ç©ºé—´ (ä¹Ÿå°±æ˜¯ä½¿ç”¨äº†é¢å¤–çš„ $O(n)$ çš„ç©ºé—´å¤æ‚åº¦)ã€‚ä½†ç»“åˆä¸Šé¢ <code>Heapify</code> çš„æ€æƒ³ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„æ”¹é€ å †æ’åºçš„è¿‡ç¨‹ï¼Œä½¿æ•°ç»„åŸåœ°å®Œæˆå †æ’åºçš„æ“ä½œã€‚</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/HeapSort0.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/HeapSort0.png" alt="img"></a></p><blockquote><p>ä¸€ä¸ªå·²ç»å½¢æˆæœ€å¤§å †çš„æ•°ç»„</p></blockquote><p>æˆ‘ä»¬å‡å®šé€šè¿‡ <code>Heapify</code> å·²ç»ä½¿ä¸€ä¸ªæ•°ç»„å½¢æˆæœ€å¤§å †ï¼Œè¿™æ—¶æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¹Ÿå°±æ˜¯æœ€å¤§çš„å…ƒç´ ï¼Œè¦æ˜¯æ•°ç»„ä»å°åˆ°å¤§æ’åºï¼Œåªéœ€ä½¿ç°åœ¨æ•°ç»„ç¬¬ä¸€ä¸ªä½ç½®çš„å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®ï¼š</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/HeapSort1.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/HeapSort1.png" alt="img"></a></p><p>è€Œæ­¤æ—¶ç”±äº <code>w</code> å¹¶ä¸ä¸€å®šæ˜¯æœ€å¤§å…ƒç´ ï¼Œä¹Ÿå°±ä½¿å¾—åŸæœ‰æœ€å¤§å †çš„æ€§è´¨é­åˆ°äº†ç ´åã€‚è¿™æ—¶åªéœ€é€šè¿‡å¯¹ <code>w</code> å…ƒç´ è¿›è¡Œä¸€æ¬¡ <code>shiftDown</code> æ“ä½œï¼Œå°±èƒ½ä½¿æ•°ç»„çš„å‰éƒ¨é‡æ–°å½¢æˆæœ€å¤§å †ï¼š</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/HeapSort2.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/HeapSort2.png" alt="img"></a></p><p>é‚£ä¹ˆé‡å¤ä¸Šè¿°æ“ä½œå°±å¯ä»¥ä½¿æ•´ä¸ªæ•°ç»„å®Œæˆæ’åºã€‚</p><p>ç¤ºä¾‹ä»£ç  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shiftDown = <span class="function">(<span class="params">array, n, k</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">2</span> * k + <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">    <span class="keyword">let</span> j = <span class="number">2</span> * k + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (j + <span class="number">1</span> &lt; n &amp;&amp; array[j + <span class="number">1</span>] &gt; array[j]) &#123;</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (array[k] &gt;= array[j]) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// swap(arr[k] , arr[j])</span></span><br><span class="line">    [array[k], array[j]] = [array[j], array[k]]</span><br><span class="line">    k = j</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æœ€å¤§å †, ç›´æ¥åœ¨åŸæ•°ç»„ä¸Šè¿›è¡ŒåŸåœ°çš„å †æ’åº</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.heapSort = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> array = <span class="built_in">this</span>.slice()</span><br><span class="line">  <span class="keyword">const</span> n = array.length</span><br><span class="line">  <span class="comment">// heapify</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„å †æ˜¯ä» 0 å¼€å§‹ç´¢å¼•çš„</span></span><br><span class="line">  <span class="comment">// ä»(æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•-1)/2 å¼€å§‹</span></span><br><span class="line">  <span class="comment">// æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼• = n-1</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="built_in">Math</span>.floor((n - <span class="number">1</span>) / <span class="number">2</span>); i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    shiftDown(array, n, i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="comment">// swap(arr[0], arr[i])</span></span><br><span class="line">    [array[<span class="number">0</span>], array[i]] = [array[i], array[<span class="number">0</span>]]</span><br><span class="line">    shiftDown(array, i, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œæœ€åä½¿ç”¨ä¸€æ­¥äº¤æ¢è¿›è¡Œä¼˜åŒ–:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜åŒ–çš„ shiftDown è¿‡ç¨‹, ä½¿ç”¨èµ‹å€¼çš„æ–¹å¼å–ä»£ä¸æ–­çš„ swap,</span></span><br><span class="line"><span class="comment">// è¯¥ä¼˜åŒ–æ€æƒ³å’Œæˆ‘ä»¬ä¹‹å‰å¯¹æ’å…¥æ’åºè¿›è¡Œä¼˜åŒ–çš„æ€è·¯æ˜¯ä¸€è‡´çš„</span></span><br><span class="line"><span class="keyword">const</span> shiftDownEnhance = <span class="function">(<span class="params">array, n, k</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> e = array[k]</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">2</span> * k + <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">    <span class="keyword">let</span> j = <span class="number">2</span> * k + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (j + <span class="number">1</span> &lt; n &amp;&amp; array[j + <span class="number">1</span>] &gt; array[j]) &#123;</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e &gt;= array[j]) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    array[k] = array[j]</span><br><span class="line">    k = j</span><br><span class="line">  &#125;</span><br><span class="line">  array[k] = e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–çš„å †æ’åº</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.heapSortEnhance = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> array = <span class="built_in">this</span>.slice()</span><br><span class="line">  <span class="keyword">const</span> n = array.length</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="built_in">Math</span>.floor((n - <span class="number">1</span>) / <span class="number">2</span>); i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    shiftDownEnhance(array, n, i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="comment">// swap(arr[0], arr[i])</span></span><br><span class="line">    [array[<span class="number">0</span>], array[i]] = [array[i], array[<span class="number">0</span>]]</span><br><span class="line">    shiftDownEnhance(array, i, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç´¢å¼•å †"><a href="#ç´¢å¼•å †" class="headerlink" title="ç´¢å¼•å †"></a>ç´¢å¼•å †</h3><p>åœ¨ä¸Šé¢çš„å®ç°çš„å †ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯ç›´æ¥æ“ä½œåŸå³æ•°ç»„å…ƒç´ ã€‚è¿™åœ¨å¤„ç†åŸºæœ¬æ•°æ®æˆ–è€…ç®€å•ç±»å‹æ—¶æ²¡æœ‰é—®é¢˜ï¼Œä½†å¾€å¾€æˆ‘ä»¬é¢å¯¹çš„æ•°æ®ç±»å‹å¹¶éå¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨å¤„ç† <code>CMS</code> å†…å®¹æ—¶å¦‚æœä½¿ç”¨å¯¹è¿™ç§ç»“æ„ï¼Œä¸€æ—¦è¦äº¤æ¢çš„æ•°æ®é‡éå¸¸å¤§ï¼Œäº¤æ¢æ“ä½œæœ¬èº«å˜å¾—éå¸¸æ…¢ï¼›è€Œè¿™ç§é—®é¢˜è¿˜å¯ä»¥é€šè¿‡æŠ€æœ¯æ‰‹æ®µè§£å†³ï¼›åˆä¾‹å¦‚åœ¨æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è°ƒåº¦æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½æ ¹æ®è¿›ç¨‹çš„ <code>pid</code> æ•°ç»„æ„å»ºäº†æœ€å¤§å †æ¥è¡¨ç¤ºè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¸€æ—¦æˆ‘ä»¬ç›´æ¥äº¤æ¢äº†å †ä¸­å…ƒç´ çš„ä½ç½®ï¼Œæˆ‘ä»¬å°±æ— æ³•æ ¹æ®æ–°çš„ç´¢å¼•æ‰¾åˆ°åŸæ¥çš„è¿›ç¨‹ï¼Œä¹Ÿå°±ä½¿å¾— <code>pid</code> å’Œè¿›ç¨‹è„±ç¦»äº†å…³ç³»ï¼›åƒè¿™ç§æƒ…å†µä½¿ç”¨<strong>ç´¢å¼•å †</strong>å°±æ›´ä¸ºæ–¹ä¾¿ã€‚</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/IndexMaxHeap.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/IndexMaxHeap.png" alt="img"></a></p><blockquote><p>ç´¢å¼•æœ€å¤§å †ç¤ºæ„å›¾</p></blockquote><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shiftUp</span> (<span class="params">data, indexes, k</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = indexes[k]</span><br><span class="line">  <span class="keyword">while</span> (k &gt; <span class="number">1</span> &amp;&amp; data[indexes[<span class="built_in">Math</span>.floor(k / <span class="number">2</span>)]] &lt; data[e]) &#123;</span><br><span class="line">    <span class="comment">// swap(indexes[k/2], indexes[k])</span></span><br><span class="line">    indexes[k] = indexes[<span class="built_in">Math</span>.floor(k / <span class="number">2</span>)]</span><br><span class="line">    k = <span class="built_in">Math</span>.floor(k /= <span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  indexes[k] = e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shiftDown</span> (<span class="params">data, indexes, k, count </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = indexes[k]</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= count) &#123;</span><br><span class="line">    <span class="keyword">let</span> j = <span class="number">2</span> * k <span class="comment">// æ­¤è½®å¾ªç¯ä¸­, swap(indexes[k], indexes[j])</span></span><br><span class="line">    <span class="keyword">if</span> (j + <span class="number">1</span> &lt;= count &amp;&amp; data[indexes[j + <span class="number">1</span>]] &gt; data[indexes[j]]) &#123;</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data[e] &gt;= data[indexes[j]]) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// swap(indexes[k], indexes[j])</span></span><br><span class="line">    indexes[k] = indexes[j]</span><br><span class="line">    k = j</span><br><span class="line">  &#125;</span><br><span class="line">  indexes[k] = e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexMaxHeap</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ„é€ å‡½æ•°, æ„é€ ä¸€ä¸ªç©ºå †, å¯å®¹çº³ capacity ä¸ªå…ƒç´ </span></span><br><span class="line">  <span class="keyword">constructor</span> (capacity) &#123;</span><br><span class="line">    this.#data = new Array(capacity + 1)</span><br><span class="line">    this.#indexes = new Array(capacity + 1)</span><br><span class="line">    this.#count = 0</span><br><span class="line">    this.#capacity = capacity</span><br><span class="line">  &#125;</span><br><span class="line">  size () &#123; return this.#count &#125;</span><br><span class="line">  isEmpty () &#123; return this.#count === 0 &#125;</span><br><span class="line">  <span class="comment">// è·å–æœ€å¤§ç´¢å¼•å †ä¸­çš„å †é¡¶å…ƒç´ </span></span><br><span class="line">  getItem (i) &#123; return this.#data[i + 1] &#125;</span><br><span class="line">  <span class="comment">// ä¼ å…¥çš„ i æ˜¯ä» 0 å¼€å§‹ç´¢å¼•çš„</span></span><br><span class="line">  insert (i, item) &#123;</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    this.#data[this.#count + 1] = item</span><br><span class="line">    this.#indexes[this.#count + 1] = i</span><br><span class="line">    this.#count++</span><br><span class="line">    shiftUp(this.#data, this.#indexes, this.#count)</span><br><span class="line">  &#125;</span><br><span class="line">  extractMax () &#123;</span><br><span class="line">    const ret = this.#data[this.#indexes[1]]</span><br><span class="line">    <span class="comment">// swap(data[indexes[1]], data[indexes[count]])</span></span><br><span class="line">    ;[this.#indexes[1], this.#indexes[this.#count]] = [this.#indexes[this.#count], this.#indexes[1]]</span><br><span class="line">    this.#count -= 1</span><br><span class="line">    shiftDown(this.#data, this.#indexes, 1, this.#count)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">  extractMaxIndex () &#123;</span><br><span class="line">    const ret = this.#indexes[1] - 1</span><br><span class="line">    <span class="comment">// swap(data[indexes[1]], data[indexes[count]])</span></span><br><span class="line">    ;[this.#indexes[1], this.#indexes[this.#count]] = [this.#indexes[this.#count], this.#indexes[1]]</span><br><span class="line">    this.#count -= 1</span><br><span class="line">    shiftDown(this.#data, this.#indexes, 1, this.#count)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†æœ€å¤§ç´¢å¼•å †ä¸­ç´¢å¼•ä¸º i çš„å…ƒç´ ä¿®æ”¹ä¸º newItem</span></span><br><span class="line">  change (i, item) &#123;</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    this.#data[i] = item</span><br><span class="line">    <span class="comment">// æ‰¾åˆ° indexes[j] = i, j è¡¨ç¤º data[i] åœ¨å †ä¸­çš„ä½ç½®</span></span><br><span class="line">    <span class="comment">// ä¹‹å shiftUp(j), å† shiftDown(j)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i; j &lt;= <span class="built_in">this</span>.size(); j++) &#123;</span><br><span class="line">      if (this.#indexes[j] === i) &#123;</span><br><span class="line">        shiftUp(this.#data, this.#indexes, j)</span><br><span class="line">        shiftDown(this.#data, this.#indexes, j, this.#count)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªç´¢å¼•å †çš„ç±»ä¸ä»…å®ç°äº†æœ€åŸºæœ¬çš„å †çš„æ“ä½œï¼Œè¿˜å®ç°äº†ä¸€äº›ç´¢å¼•å †å¯ä»¥å®Œæˆçš„ç‰¹æ®Šæ“ä½œï¼›è€Œæœ€é‡è¦çš„å°±æ˜¯ <code>change</code> æ“ä½œï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç»™å®šä¸€ä¸ªç´¢å¼•æ¥æ–¹ä¾¿çš„ä¿®æ”¹å †ä¸­æŸä¸ªå…ƒç´ çš„å€¼ã€‚ä½†å¯ä»¥æ³¨æ„åˆ°ï¼Œä¿®æ”¹å®Œè¿™ä¸ªå…ƒç´ åï¼Œè¦ä½¿å¾—å †ç»§ç»­å½¢æˆæœ€å¤§å †ï¼Œæˆ‘ä»¬ä»éœ€è¦å¯¹æ–°æ’å…¥çš„å…ƒç´ è¿›è¡Œ <code>shiftUp</code> å’Œ <code>shiftDown</code> æ¥ç»´æŒå †çš„æ€§è´¨ï¼Œè€Œè¿™ä½¿å¾—ä¿®æ”¹å…ƒç´ çš„å¤æ‚åº¦å˜æˆäº† $O(n+log{n}) ~ O(n)$ï¼Œè¿™ä¸å †çš„æ’å…¥åˆ é™¤å…ƒç´  $O(nlog{n})$ çš„å¤æ‚åº¦å¹¶ä¸ç›¸ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å»ºç«‹å¯¹<strong>ç´¢å¼•çš„ç´¢å¼•</strong>æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/RevIndexMaxHeap.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/RevIndexMaxHeap.png" alt="img"></a></p><blockquote><p>ä¼˜åŒ–ç´¢å¼•æœ€å¤§å †ç¤ºæ„å›¾</p></blockquote><p>ç”¨ <code>reverse</code> æ•°ç»„æ¥è¡¨ç¤º <code>i</code> åœ¨ <code>indexes</code>(å †)ä¸­çš„ä½ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if </span><br><span class="line">indexes[i] &#x3D; j</span><br><span class="line">reverse[j] &#x3D; i</span><br><span class="line">then </span><br><span class="line">indexes[reverse[i]] &#x3D; i</span><br><span class="line">reverse[indexes[i]] &#x3D; i</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ $O(1)$ å†…æ‰¾åˆ°ä¸€ä¸ªç´¢å¼•å¯¹åº”çš„å…ƒç´ ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shiftUpEnhance</span> (<span class="params">data, indexes, reverse, k</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = indexes[k]</span><br><span class="line">  <span class="keyword">while</span> (k &gt; <span class="number">1</span> &amp;&amp; data[indexes[<span class="built_in">Math</span>.floor(k / <span class="number">2</span>)]] &lt; data[e]) &#123;</span><br><span class="line">    <span class="comment">// swap(indexes[k/2], indexes[k])</span></span><br><span class="line">    indexes[k] = indexes[<span class="built_in">Math</span>.floor(k / <span class="number">2</span>)]</span><br><span class="line">    reverse[indexes[<span class="built_in">Math</span>.floor(k / <span class="number">2</span>)]] = <span class="built_in">Math</span>.floor(k / <span class="number">2</span>)</span><br><span class="line">    reverse[indexes[k]] = k</span><br><span class="line">    k = <span class="built_in">Math</span>.floor(k /= <span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  indexes[k] = e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shiftDownEnhance</span> (<span class="params">data, indexes, reverse, k, count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = indexes[k]</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= count) &#123;</span><br><span class="line">    <span class="keyword">let</span> j = <span class="number">2</span> * k <span class="comment">// æ­¤è½®å¾ªç¯ä¸­, swap(indexes[k], indexes[j])</span></span><br><span class="line">    <span class="keyword">if</span> (j + <span class="number">1</span> &lt;= count &amp;&amp; data[indexes[j + <span class="number">1</span>]] &gt; data[indexes[j]]) &#123;</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data[e] &gt;= data[indexes[j]]) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// swap(indexes[k], indexes[j])</span></span><br><span class="line">    indexes[k] = indexes[j]</span><br><span class="line">    reverse[indexes[k]] = k</span><br><span class="line">    reverse[indexes[j]] = j</span><br><span class="line">    k = j</span><br><span class="line">  &#125;</span><br><span class="line">  indexes[k] = e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexMaxHeap</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ„é€ å‡½æ•°, æ„é€ ä¸€ä¸ªç©ºå †, å¯å®¹çº³ capacity ä¸ªå…ƒç´ </span></span><br><span class="line">  <span class="keyword">constructor</span> (capacity) &#123;</span><br><span class="line">    this.#data = new Array(capacity + 1)</span><br><span class="line">    this.#indexes = new Array(capacity + 1)</span><br><span class="line">    this.#reverse = new Array(capacity + 1).fill(0) // å¡«å…¥ 0 ä½¿å¾—é»˜è®¤çš„ç´¢å¼•ç´¢å¼•ä½ç½®ä¸º 0 (æ€»æ˜¯æ— æ•ˆçš„å…ƒç´ )</span><br><span class="line">    this.#count = 0</span><br><span class="line">    this.#capacity = capacity</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// ä¼ å…¥çš„ i æ˜¯ä» 0 å¼€å§‹ç´¢å¼•çš„</span></span><br><span class="line">  insert (i, item) &#123;</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    this.#data[this.#count + 1] = item</span><br><span class="line">    this.#indexes[this.#count + 1] = i</span><br><span class="line">    this.#reverse[i] = this.#count + 1</span><br><span class="line">    this.#count++</span><br><span class="line">    shiftUpEnhance(this.#data, this.#indexes, this.#reverse, this.#count)</span><br><span class="line">  &#125;</span><br><span class="line">  extractMax () &#123;</span><br><span class="line">    const ret = this.#data[this.#indexes[1]]</span><br><span class="line">    <span class="comment">// swap(data[indexes[1]], data[indexes[count]])</span></span><br><span class="line">    ;[this.#indexes[1], this.#indexes[this.#count]] = [this.#indexes[this.#count], this.#indexes[1]]</span><br><span class="line">    this.#reverse[this.#indexes[1]] = 1</span><br><span class="line">    this.#reverse[this.#indexes[this.#count]] = 0</span><br><span class="line">    this.#count -= 1</span><br><span class="line">    shiftDownEnhance(this.#data, this.#indexes, this.#reverse, 1, this.#count)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">  extractMaxIndex () &#123;</span><br><span class="line">    const ret = this.#indexes[1] - 1</span><br><span class="line">    <span class="comment">// swap(data[indexes[1]], data[indexes[count]])</span></span><br><span class="line">    ;[this.#indexes[1], this.#indexes[this.#count]] = [this.#indexes[this.#count], this.#indexes[1]]</span><br><span class="line">    this.#reverse[this.#indexes[1]] = 1</span><br><span class="line">    this.#reverse[this.#indexes[this.#count]] = 0</span><br><span class="line">    this.#count -= 1</span><br><span class="line">    shiftDownEnhance(this.#data, this.#indexes, this.#reverse, 1, this.#count)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†æœ€å¤§ç´¢å¼•å †ä¸­ç´¢å¼•ä¸º i çš„å…ƒç´ ä¿®æ”¹ä¸º newItem</span></span><br><span class="line">  change (i, item) &#123;</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    this.#data[i] = item</span><br><span class="line">    <span class="comment">// æ‰¾åˆ° indexes[j] = i, j è¡¨ç¤º data[i] åœ¨å †ä¸­çš„ä½ç½®</span></span><br><span class="line">    <span class="comment">// ä¹‹å shiftUp(j), å† shiftDown(j)</span></span><br><span class="line">    <span class="comment">// for (let j = i; j &lt;= this.size(); j++) &#123;</span></span><br><span class="line">    <span class="comment">//   if (this.#indexes[j] === i) &#123;</span></span><br><span class="line">    <span class="comment">//     shiftUpEnhance(this.#data, this.#indexes, j)</span></span><br><span class="line">    <span class="comment">//     shiftDownEnhance(this.#data, this.#indexes, j, this.#count)</span></span><br><span class="line">    <span class="comment">//     return</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// æœ‰äº† reverse ä¹‹å,</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯ä»¥éå¸¸ç®€å•çš„é€šè¿‡reverseç›´æ¥å®šä½ç´¢å¼•iåœ¨indexesä¸­çš„ä½ç½®</span></span><br><span class="line">    const j = this.#reverse[i]</span><br><span class="line">    shiftUpEnhance(this.#data, this.#indexes, this.#reverse, j)</span><br><span class="line">    shiftDownEnhance(this.#data, this.#indexes, this.#reverse, j, this.#count)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ’åºæ€»ç»“"><a href="#æ’åºæ€»ç»“" class="headerlink" title="æ’åºæ€»ç»“"></a>æ’åºæ€»ç»“</h3><p><a href="http://mitscherlich.me/assets/imooc-algorithms/SortSummary.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/SortSummary.png" alt="img"></a></p><blockquote><p>å››å¤§é‡è¦æ’åºç®—æ³•æ¯”è¾ƒ</p></blockquote><p>æœ¬ç³»åˆ—çš„æ’åºç®—æ³•åˆ°è¿™é‡Œå°±å®Œç»“äº†ã€‚æˆ‘ä»¬ä¸€å…±åªä¸ºå¤§å®¶ä»‹ç»äº†<strong>ä¸¤</strong>ç±»<strong>ä¸ƒ</strong>ç§æ’åºç®—æ³•ï¼Œå¤§å®¶ä¹Ÿè®¸è¿˜çŸ¥é“æˆ–è€…å­¦ä¹ è¿‡å…¶ä»–æ›´å¤šçš„æ’åºç®—æ³•ï¼Œè¿™é‡Œé™äºç¯‡å¹…å°±ä¸ä¸€ä¸€ä¸ºå¤§å®¶ä»‹ç»äº†ã€‚</p><p>æˆ‘ä»¬ä¸»è¦å­¦ä¹ çš„å°±æ˜¯ä¸Šå›¾å››ç§<strong>åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•</strong>ã€‚é™¤äº†æ’å…¥æ’åºå¤æ‚åº¦ä¸º $O(n^2)$ ä»¥å¤–ï¼Œå…¶ä½™å‡ ç§æ’åºç®—æ³•å¤æ‚åº¦å‡ä¸º $O(nlog{n})$ï¼Œä½†è¿™ä¹Ÿå¹¶ä¸æ˜¯è¯´æ˜æ’å…¥æ’åºä¸å¥½ï¼Œäº‹å®ä¸Šæˆ‘ä»¬åœ¨æµ‹è¯•ä¸­å¯ä»¥å‘ç°åœ¨å®Œå…¨æœ‰åºçš„æ•°ç»„ä¸Šæ’å…¥æ’åºçš„å¤æ‚åº¦é€€åŒ–ä¸º $O(n)$ï¼Œç”šè‡³ä¼˜äºåŒç­‰çš„é«˜çº§æ’åºç®—æ³•ã€‚è¿™è¯´æ˜æˆ‘ä»¬åœ¨ç¼–ç¨‹å¼€å‘æ—¶åº”å­¦ä¼šç»“åˆå®é™…æƒ…å†µï¼Œé€‰æ‹©æœ€ä¼˜çš„æ’åºç®—æ³•ï¼Œè€Œä¸æ˜¯åªä¼šåšä¸€ä¸ª <code>API caller</code>ã€‚</p><h4 id="æ’åºç®—æ³•çš„ç¨³å®šæ€§"><a href="#æ’åºç®—æ³•çš„ç¨³å®šæ€§" class="headerlink" title="æ’åºç®—æ³•çš„ç¨³å®šæ€§"></a>æ’åºç®—æ³•çš„ç¨³å®šæ€§</h4><p>å†çœ‹å›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªæ¦‚å¿µï¼š<strong>ç¨³å®šæ’åº</strong>ã€‚è¿™æ˜¯æŒ‡å¯¹äº<strong>ç›¸ç­‰çš„</strong>å…ƒç´ ï¼Œåœ¨æ’åºå‰åï¼Œæƒ³ç­‰å…ƒç´ çš„<strong>ç›¸å¯¹ä½ç½®</strong>æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚ä¾‹å¦‚å¯¹ä¸€ç»„å­¦ç”Ÿæˆç»©æ’åºæ—¶ï¼Œä¸ä»…è¦å¯¹æˆç»©è¿›è¡Œæ’åºï¼Œè¿˜åœ¨åœ¨å­¦ç”Ÿæˆç»©æƒ³ç­‰æ—¶æŒ‰å§“åçš„å­—å…¸åºæ’åºï¼Œå¾ˆå¯èƒ½å¤§éƒ¨åˆ†æ—¶å€™åŸå§‹æ•°æ®éƒ½å·²ç»æŒ‰å§“åçš„å­—å…¸åºæ’å¥½åºäº†ï¼Œä½†æ˜¯å¿«é€Ÿæ’åºå’Œå †æ’åºå°±æœ‰å¯èƒ½æ‰“ä¹±åŸæ¥çš„é¡ºåºã€‚</p><p><a href="http://mitscherlich.me/assets/imooc-algorithms/SortStable.png"><img src= "/img/loading2.gif" data-lazy-src="http://mitscherlich.me/assets/imooc-algorithms/SortStable.png" alt="img"></a></p><blockquote><p>æ’åºç®—æ³•é‡åˆ°ç›¸ç­‰çš„å…ƒç´ æ—¶è¡Œä¸ºæœ‰æ‰€ä¸åŒ</p></blockquote><p>ä½†è¿™å¹¶ä¸æ˜¯è¯„ä»·ç®—æ³•ä¼˜åŠ£çš„å…³é”®ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹æ’åºæ¯”è¾ƒçš„é€»è¾‘ï¼Œæˆ–è€…å¹²è„†æŠŠæ¯”è¾ƒçš„è¿‡ç¨‹å½¢æˆä¸€ä¸ªå›è°ƒæ¥å£ä¼ é€’ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·è‡ªå·±å®Œæˆæ¯”è¾ƒçš„é€»è¾‘ï¼Œä»è€Œä½¿ä¸ç¨³å®šçš„æ’åºå˜å¾—ç¨³å®šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨Ubuntuä¸Šæ­å»ºTimeCapsuleæœåŠ¡</title>
      <link href="/2016/03/30/Linux/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E4%B9%8BUbuntu%E6%90%AD%E5%BB%BAAFP%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8ETimeMachine%E6%9C%8D%E5%8A%A1/"/>
      <url>/2016/03/30/Linux/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E4%B9%8BUbuntu%E6%90%AD%E5%BB%BAAFP%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8ETimeMachine%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´æ˜¯ä½¿ç”¨sambaæœåŠ¡ä½œä¸ºNASï¼Œç§»åŠ¨ç¡¬ç›˜æ’åœ¨macä¸Šä½œä¸ºTimeMachineå¤‡ä»½ç›˜ï¼Œä½†è¿™æ ·è¿˜æ˜¯å¤ªç¬¨æ‹™äº†ã€‚</p><p>ä¸ºäº†å®ç°æ— çº¿å¤‡ä»½ï¼Œä¸€ç§æ–¹æ³•æ˜¯è´­ä¹°Apple TimeCapsuleï¼Œå¦ä¸€ç§åˆ™æ˜¯åˆ©ç”¨Linuxè®¾å¤‡æ¥æ­å»º<a href="http://netatalk.sourceforge.net/">Netatalk</a>æœåŠ¡å™¨ã€‚æ­£å¥½åˆä¸€å°é—²ç½®çš„Ubuntuæœºå™¨ï¼Œäºæ˜¯å°±å†³å®šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</p><p><a href="http://netatalk.sourceforge.net/">Netatalk</a>æ˜¯ä¸€ä¸ªå¼€æºçš„AppleTalké€šä¿¡åè®®çš„å®ç°ï¼Œå¯ä»¥é€šè¿‡åœ¨Linuxç³»ç»Ÿä¸Šæ­å»ºNetatalkæœåŠ¡æ¥ä½œä¸ºmacOSè®¾å¤‡çš„AFPæœåŠ¡å™¨ã€AppleTalkè·¯ç”±ç­‰ç­‰ã€‚ç»“åˆ<a href="https://github.com/lathiat/avahi">avahi</a>æœåŠ¡ï¼Œå¯ä»¥è¾¾åˆ°AppleåŸç”Ÿè®¾å¤‡çš„æ•ˆæœã€‚</p><p>æœ¬æ–‡åŸºäºUbuntu 18.04ç¯å¢ƒæ­å»ºï¼Œå…¶ä»–ç¯å¢ƒé…ç½®ç±»ä¼¼ã€‚</p><a id="more"></a><h2 id="ç¡¬ç›˜æŒ‚è½½ä¸é…ç½®"><a href="#ç¡¬ç›˜æŒ‚è½½ä¸é…ç½®" class="headerlink" title="ç¡¬ç›˜æŒ‚è½½ä¸é…ç½®"></a>ç¡¬ç›˜æŒ‚è½½ä¸é…ç½®</h2><h3 id="æŸ¥çœ‹å·²è¿æ¥çš„ç¡¬ç›˜"><a href="#æŸ¥çœ‹å·²è¿æ¥çš„ç¡¬ç›˜" class="headerlink" title="æŸ¥çœ‹å·²è¿æ¥çš„ç¡¬ç›˜"></a>æŸ¥çœ‹å·²è¿æ¥çš„ç¡¬ç›˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ fdisk -l   <span class="comment">#æŸ¥çœ‹ç³»ç»Ÿè¿æ¥çš„ç£ç›˜ä¿¡æ¯</span></span><br><span class="line">...</span><br><span class="line">/dev/sdb3  649940992 976773119 326832128 155.9G Apple HFS/HFS+  </span><br><span class="line"><span class="comment">#æ˜¾ç¤ºéœ€è¦æŒ‚è½½çš„HFS+åˆ†åŒºåœ¨ /dev/sdb3</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="HFS-åˆ†åŒºå…³é—­journal"><a href="#HFS-åˆ†åŒºå…³é—­journal" class="headerlink" title="HFS+åˆ†åŒºå…³é—­journal"></a>HFS+åˆ†åŒºå…³é—­journal</h3><p>Macçš„HFS+åˆ†åŒºä¸€èˆ¬éƒ½é»˜è®¤å¼€å¯journalåŠŸèƒ½ï¼Œå› ä¸ºLinuxä¸æ”¯æŒè¯»å†™journaled HFS+ï¼Œæ‰€ä»¥å¿…é¡»å…³é—­è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>å¯ä»¥æŠŠç¡¬ç›˜è¿æ¥åˆ°macæ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…³é—­Journal</span></span><br><span class="line">$ diskutil disableJournal disk0s2       <span class="comment">#å‡è®¾disk0s2ä¸ºéœ€è¦æŒ‚è½½åˆ°linuxä¸Šçš„ç£ç›˜åˆ†åŒº</span></span><br><span class="line">Journaling has been disabled on disk0s2</span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ‰“å¼€Journal  </span></span><br><span class="line">$ diskutil enableJournal disk0s2</span><br><span class="line">Journaling has been enabled on disk0s2</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥åœ¨linuxä¸Šæ“ä½œï¼Œé€šè¿‡ä¸‹è½½<code>journalling_off.c</code>æºç ç¼–è¯‘è¿è¡Œæ¥å…³é—­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /tmp</span><br><span class="line">$ curl https://pastebin.com/raw/W8pfgHRe -o journalling_off.c</span><br><span class="line">$ gcc journalling_off.c -o journalling_off</span><br><span class="line">$ sudo ./journalling_off /dev/sdb3   <span class="comment">#æ ¹æ®fdiskçš„ç»“æœ /dev/sdb3 ä¸ºå¯¹åº”HFS+åˆ†åŒº</span></span><br><span class="line">&lt;/code&gt;sudo ./journalling_off /dev/sdb3</span><br><span class="line">attributes = 0x80002100 </span><br><span class="line">journal has been disabled.</span><br></pre></td></tr></table></figure><p>å¦‚æœç½‘é€Ÿä¸å¥½ï¼Œæºç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// journalling_off.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;byteswap.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> fd = open(argv[<span class="number">1</span>], O_RDWR);</span><br><span class="line">        <span class="keyword">if</span>(fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> *buffer = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)mmap(<span class="literal">NULL</span>, <span class="number">2048</span>, PROT_READ|PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(buffer == (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="number">0xffffffff</span>) &#123;</span><br><span class="line">                perror(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span>((buffer[<span class="number">1024</span>] != <span class="string">&#x27;H&#x27;</span>) &amp;&amp; (buffer[<span class="number">1025</span>] != <span class="string">&#x27;+&#x27;</span>)) &#123;</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s: HFS+ signature not found -- aborting.\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> attributes = *(<span class="keyword">unsigned</span> <span class="keyword">long</span> *)(&amp;buffer[<span class="number">1028</span>]);</span><br><span class="line">        attributes = bswap_32(attributes);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;attributes = 0x%8.8lx\n&quot;</span>, attributes);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span>(!(attributes &amp; <span class="number">0x00002000</span>)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;kHFSVolumeJournaledBit not currently set in the volume attributes field.\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        attributes &amp;= <span class="number">0xffffdfff</span>;</span><br><span class="line">        attributes = bswap_32(attributes);</span><br><span class="line">        *(<span class="keyword">unsigned</span> <span class="keyword">long</span> *)(&amp;buffer[<span class="number">1028</span>]) = attributes;</span><br><span class="line">       </span><br><span class="line">        buffer[<span class="number">1032</span>] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        buffer[<span class="number">1033</span>] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        buffer[<span class="number">1034</span>] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">        buffer[<span class="number">1035</span>] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">       </span><br><span class="line">        buffer[<span class="number">1036</span>] = <span class="number">0</span>;</span><br><span class="line">        buffer[<span class="number">1037</span>] = <span class="number">0</span>;</span><br><span class="line">        buffer[<span class="number">1038</span>] = <span class="number">0</span>;</span><br><span class="line">        buffer[<span class="number">1039</span>] = <span class="number">0</span>;</span><br><span class="line">       </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;journal has been disabled.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir /mnt/timemachine<span class="comment">#åˆ›å»ºæŒ‚è½½ç‚¹</span></span><br><span class="line">$ sudo mount  -t hfsplus -o force,rw /dev/sdb3 /mnt/timemachine   </span><br><span class="line"><span class="comment">#æŒ‚è½½ç‚¹è®¾ç½®ä¸º/mnt/timemachine</span></span><br></pre></td></tr></table></figure><h2 id="Netatalkç¼–è¯‘å®‰è£…ä¸é…ç½®"><a href="#Netatalkç¼–è¯‘å®‰è£…ä¸é…ç½®" class="headerlink" title="Netatalkç¼–è¯‘å®‰è£…ä¸é…ç½®"></a>Netatalkç¼–è¯‘å®‰è£…ä¸é…ç½®</h2><p>ç”±äºaptä¸Šçš„Netatalkçš„ç‰ˆæœ¬å¤ªè€ï¼Œæ‰€ä»¥é€‰æ‹©ç¼–è¯‘å®‰è£…ã€‚ </p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>å®‰è£…ä¾èµ–åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install -y \</span><br><span class="line">build-essential \</span><br><span class="line">libevent-dev \</span><br><span class="line">libssl-dev \</span><br><span class="line">libgcrypt-dev \</span><br><span class="line">libkrb5-dev \</span><br><span class="line">libpam0g-dev \</span><br><span class="line">libwrap0-dev \</span><br><span class="line">libdb-dev \</span><br><span class="line">libtdb-dev \</span><br><span class="line">avahi-daemon \</span><br><span class="line">libavahi-client-dev \</span><br><span class="line">libacl1-dev \</span><br><span class="line">libldap2-dev \</span><br><span class="line">libcrack2-dev \</span><br><span class="line">libdbus-1-dev \</span><br><span class="line">libdbus-glib-1-dev \</span><br><span class="line">libglib2.0-dev</span><br></pre></td></tr></table></figure><p>å®‰è£…<a href="https://ubuntu.pkgs.org/18.04/ubuntu-universe-amd64/checkinstall_1.6.2-4ubuntu2_amd64.deb.html">checkinstall</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install --yes checkinstall</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡<a href="https://ubuntu.pkgs.org/18.04/ubuntu-universe-amd64/checkinstall_1.6.2-4ubuntu2_amd64.deb.html">ä¸‹è½½debåŒ…</a>æ¥å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /tmp &amp;&amp; curl http://archive.ubuntu.com/ubuntu/pool/universe/c/checkinstall/checkinstall_1.6.2-4ubuntu2_amd64.deb</span><br><span class="line">$ sudo dpkg -i checkinstall_1.6.2-4ubuntu2_amd64.deb</span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ NETATALK_VERSION=<span class="string">&#x27;3.1.11&#x27;</span></span><br><span class="line">$ MAINTAINER=<span class="string">&#x27;maywzh \&lt;maywzh@gamil.com\&gt;&#x27;</span> <span class="comment"># è¿™é‡Œæ¢æˆ è‡ªå·±çš„åå­—å’Œé‚®ç®±</span></span><br></pre></td></tr></table></figure><p>ä¸‹è½½netatalkæºç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://prdownloads.sourceforge.net/netatalk/netatalk-<span class="variable">$&#123;NETATALK_VERSION&#125;</span>.tar.gz -P /tmp</span><br><span class="line">tar -xzf /tmp/netatalk-<span class="variable">$&#123;NETATALK_VERSION&#125;</span>.tar.gz -C /tmp</span><br><span class="line">$ <span class="built_in">cd</span> /tmp/netatalk-<span class="variable">$&#123;NETATALK_VERSION&#125;</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure \</span><br><span class="line">--with-init-style=debian-systemd \</span><br><span class="line">--without-libevent \</span><br><span class="line">--with-cracklib \</span><br><span class="line">--<span class="built_in">enable</span>-krbV-uam \</span><br><span class="line">--with-pam-confdir=/etc/pam.d \</span><br><span class="line">--with-dbus-daemon=/usr/bin/dbus-daemon \</span><br><span class="line">--with-dbus-sysconf-dir=/etc/dbus-1/system.d</span><br><span class="line">$ make</span><br><span class="line">$ sudo checkinstall -D \</span><br><span class="line">--pkgname=<span class="string">&#x27;netatalk&#x27;</span> \</span><br><span class="line">--pkgversion=<span class="string">&quot;<span class="variable">$&#123;NETATALK_VERSION&#125;</span>&quot;</span> \</span><br><span class="line">--maintainer=<span class="string">&quot;<span class="variable">$&#123;MAINTAINER&#125;</span>&quot;</span> \</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å®‰è£…ä¾èµ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install -y \</span><br><span class="line">avahi-daemon \</span><br><span class="line">cracklib-runtime \</span><br><span class="line">db-util \</span><br><span class="line">db5.3-util \</span><br><span class="line">libtdb1 \</span><br><span class="line">libavahi-client3 \</span><br><span class="line">libcrack2 \</span><br><span class="line">libcups2 \</span><br><span class="line">libpam-cracklib \</span><br><span class="line">libdbus-glib-1-2</span><br></pre></td></tr></table></figure><p>å®‰è£…ç¼–è¯‘åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg -i netatalk_3.1.11-1_amd64.deb</span><br><span class="line">$ sudo ldconfig</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ netatalk -v</span><br><span class="line">netatalk 3.1.11 - Netatalk AFP server service controller daemon</span><br><span class="line"></span><br><span class="line">This program is free software; you can redistribute it and/or modify it under</span><br><span class="line">the terms of the GNU General Public License as published by the Free Software</span><br><span class="line">Foundation; either version 2 of the License, or (at your option) any later</span><br><span class="line">version. Please see the file COPYING <span class="keyword">for</span> further information and details.</span><br><span class="line"></span><br><span class="line">netatalk has been compiled with support <span class="keyword">for</span> these features:</span><br><span class="line"></span><br><span class="line">      Zeroconf support:Avahi</span><br><span class="line">     Spotlight support:No</span><br><span class="line"></span><br><span class="line">                  afpd:/usr/<span class="built_in">local</span>/sbin/afpd</span><br><span class="line">            cnid_metad:/usr/<span class="built_in">local</span>/sbin/cnid_metad</span><br><span class="line">              afp.conf:/usr/<span class="built_in">local</span>/etc/afp.conf</span><br><span class="line">    netatalk lock file:/var/lock/netatalk</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/<span class="built_in">local</span>/etc/afp.conf  </span><br></pre></td></tr></table></figure><p>æƒ³æ·±å…¥äº†è§£é…ç½®è¯·å‚è€ƒ<a href="http://netatalk.sourceforge.net/3.1/htmldocs/afp.conf.5.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[Global]  </span><br><span class="line">mimic model &#x3D; AirPort               #æŒ‡å®šåœ¨macOSçš„Finderæ˜¾ç¤ºçš„å›¾æ ‡  </span><br><span class="line">log level &#x3D; default:warn  </span><br><span class="line">log file &#x3D; &#x2F;var&#x2F;log&#x2F;afpd.log  </span><br><span class="line">hosts allow &#x3D; 192.168.50.0&#x2F;24       #å­ç½‘ å…è®¸è®¿é—®çš„ä¸»æœºåœ°å€,æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹  </span><br><span class="line">hostname &#x3D; M-AFP             #ä¸»æœºå éšæ„è®¾ç½®</span><br><span class="line">uam list &#x3D; uams_dhx.so uams_dhx2.so #é»˜è®¤è®¤è¯æ–¹å¼ ç”¨æˆ·åå¯†ç ç™»å½• å‚çœ‹å®˜æ–¹æ–‡æ¡£  </span><br><span class="line"></span><br><span class="line">[Homes]  </span><br><span class="line">basedir regex &#x3D; &#x2F;home               #ç”¨æˆ·çš„Homeç›®å½•  </span><br><span class="line"></span><br><span class="line">[TimeMachine]  </span><br><span class="line">path &#x3D; &#x2F;mnt&#x2F;TimeMachine             #æ•°æ®ç›®å½•  </span><br><span class="line">time machine &#x3D; yes                  #yesæ‰æ”¯æŒTimeMachine  </span><br><span class="line">spotlight &#x3D; no                      #å…³é—­spotlightç´¢å¼•  </span><br><span class="line">vol size limit &#x3D; 155000             #é™åˆ¶TimeMachineå­˜å‚¨å®¹é‡ï¼Œå•ä½ä¸ºMB</span><br><span class="line"></span><br><span class="line">;[Files]  # ;æ³¨é‡Š</span><br><span class="line">;path &#x3D; &#x2F;mnt&#x2F;files                  #è®¾ç½®æ™®é€šafpç›®å½•</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æƒé™è®¾ç½®"><a href="#æƒé™è®¾ç½®" class="headerlink" title="æƒé™è®¾ç½®"></a>æƒé™è®¾ç½®</h4><p>åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œç”¨äºè®¿é—® AFP æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ useradd afp    <span class="comment">#åˆ›å»ºæ–°ç”¨æˆ·afp  </span></span><br><span class="line">$ paaswd afp     <span class="comment">#ä¿®æ”¹afpç”¨æˆ·å¯†ç </span></span><br></pre></td></tr></table></figure><h2 id="Avahi-é…ç½®å®‰è£…"><a href="#Avahi-é…ç½®å®‰è£…" class="headerlink" title="Avahi é…ç½®å®‰è£…"></a>Avahi é…ç½®å®‰è£…</h2><p>Avahiæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç”¨äºè®©macåœ¨å±€åŸŸç½‘è‡ªåŠ¨å‘ç°Linux AFPæœåŠ¡å™¨ï¼Œå…·ä½“å¯å‚çœ‹é¡¹ç›®åœ°å€<a href="https://github.com/lathiat/avahiã€‚">https://github.com/lathiat/avahiã€‚</a></p><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>è¿™ä¸ªç®€å•ï¼Œç›´æ¥ yum å°±è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install avahi -y  </span><br></pre></td></tr></table></figure><h3 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>é…ç½®æ–‡ä»¶ä½ç½®åœ¨ <code>/etc/avahi/services/afpd.service</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/avahi/services/afpd.service</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; standalone=&#x27;no&#x27;?&gt;</span>   </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">service-group</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;avahi-service.dtd&quot;</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">service-group</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">name</span> <span class="attr">replace-wildcards</span>=<span class="string">&quot;yes&quot;</span>&gt;</span>DUKE-NAS-AFP<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>_afpovertcp._tcp<span class="tag">&lt;/<span class="name">type</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>548<span class="tag">&lt;/<span class="name">port</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>_device-info._tcp<span class="tag">&lt;/<span class="name">type</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>0<span class="tag">&lt;/<span class="name">port</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">txt-record</span>&gt;</span>model=Xserve<span class="tag">&lt;/<span class="name">txt-record</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">service-group</span>&gt;</span>  </span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡å¯åŠ¨"><a href="#æœåŠ¡å¯åŠ¨" class="headerlink" title="æœåŠ¡å¯åŠ¨"></a>æœåŠ¡å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start avahi-daemon  </span><br><span class="line">$ sudo systemctl start netatalk  </span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> avahi-daemon  </span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> netatalk  </span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ netatalk å’Œ avahi ç«¯å£æ˜¯å¦å¯åŠ¨ç›‘å¬, afp ç›‘å¬ 548 ç«¯å£<br>è¯·æ³¨æ„ Linux é˜²ç«å¢™é—®é¢˜ï¼Œå°†å¯¹åº”ç«¯å£æ”¾è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -tulpn</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œ netatalkéƒ¨ç½²å®Œæˆã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="http://netatalk.sourceforge.net/wiki/index.php/Install_Netatalk_3.1.11_on_Ubuntu_18.04_Bionic">Install Netatalk 3.1.11 on Ubuntu 18.04 Bionic</a></li><li><a href="https://en.wikipedia.org/wiki/Zero-configuration_networking">Zero-configuration networking</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œä¹‹TCPåè®®</title>
      <link href="/2016/01/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BTCP%E5%8D%8F%E8%AE%AE/"/>
      <url>/2016/01/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8BTCP%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<p>TCPåè®®ä½œä¸ºTCP/IPåè®®æ ˆä¸­æœ€é‡è¦çš„ä¸€ä¸ªåè®®ä¹‹ä¸€ï¼Œæ˜¯å› ç‰¹ç½‘çš„åŸºç¡€ã€‚</p><a id="more"></a><h2 id="ç«¯å£ä¸è¿›ç¨‹"><a href="#ç«¯å£ä¸è¿›ç¨‹" class="headerlink" title="ç«¯å£ä¸è¿›ç¨‹"></a>ç«¯å£ä¸è¿›ç¨‹</h2><p>TCP çš„åŒ…æ˜¯ä¸åŒ…å« IP åœ°å€ä¿¡æ¯çš„ï¼Œé‚£æ˜¯ IP å±‚ä¸Šçš„äº‹ï¼Œä½†æ˜¯æœ‰æºç«¯å£å’Œç›®çš„ç«¯å£ã€‚<br>å°±æ˜¯è¯´ï¼Œç«¯å£è¿™ä¸€ä¸œè¥¿ï¼Œæ˜¯å±äº TCP çŸ¥è¯†èŒƒç•´çš„ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ä¸¤ä¸ªè¿›ç¨‹ï¼Œåœ¨è®¡ç®—æœºå†…éƒ¨è¿›è¡Œé€šä¿¡ï¼Œå¯ä»¥æœ‰ç®¡é“ã€å†…å­˜å…±äº«ã€ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ–¹æ³•ã€‚<br>è€Œä¸¤ä¸ªè¿›ç¨‹å¦‚æœéœ€è¦è¿›è¡Œé€šè®¯æœ€åŸºæœ¬çš„ä¸€ä¸ªå‰ææ˜¯èƒ½å¤Ÿå”¯ä¸€çš„æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨æœ¬åœ°è¿›ç¨‹é€šè®¯ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>ã€ŒPID(è¿›ç¨‹æ ‡è¯†ç¬¦)ã€</strong> æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚<br>ä½† PID åªåœ¨æœ¬åœ°å”¯ä¸€ï¼Œå¦‚æœæŠŠä¸¤ä¸ªè¿›ç¨‹æ”¾åˆ°äº†ä¸åŒçš„ä¸¤å°è®¡ç®—æœºï¼Œç„¶åä»–ä»¬è¦é€šä¿¡çš„è¯ï¼ŒPID å°±ä¸å¤Ÿç”¨äº†ï¼Œè¿™æ ·å°±éœ€è¦å¦å¤–ä¸€ç§æ‰‹æ®µäº†ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±æ˜¯åœ¨è¿è¾“å±‚ä½¿ç”¨ <strong>ã€Œåè®®ç«¯å£å· (protocol port number)ã€</strong>ï¼Œç®€ç§° <strong>ã€Œç«¯å£ (port)ã€</strong>.<br>æˆ‘ä»¬çŸ¥é“ IP å±‚çš„ ip åœ°å€å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸»æœºï¼Œè€Œ TCP å±‚åè®®å’Œç«¯å£å·å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸»æœºçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ï¼š<strong>ã€Œipåœ°å€ï¼‹åè®®ï¼‹ç«¯å£å·ã€</strong>å”¯ä¸€æ ‡ç¤ºç½‘ç»œä¸­çš„ä¸€ä¸ªè¿›ç¨‹ã€‚<br>åœ¨ä¸€äº›åœºåˆï¼Œä¹ŸæŠŠè¿™ç§å”¯ä¸€æ ‡è¯†çš„æ¨¡å¼ç§°ä¸º<strong>ã€Œå¥—æ¥å­— (Socket)ã€</strong>ã€‚</p><p>è¿™å°±æ˜¯è¯´ï¼Œè™½ç„¶é€šä¿¡çš„é‡ç‚¹æ˜¯åº”ç”¨è¿›ç¨‹ï¼Œä½†æˆ‘ä»¬åªè¦æŠŠè¦ä¼ é€çš„æŠ¥æ–‡äº¤åˆ°ç›®çš„ä¸»æœºçš„æŸä¸€ä¸ªåˆé€‚çš„ç«¯å£ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±ç”± TCP æ¥å®Œæˆäº†ã€‚</p><p>TCP ç”¨ä¸€ä¸ª 16 ä½ç«¯å£å·æ¥æ ‡è¯†ä¸€ä¸ªç«¯å£ï¼Œå¯å…è®¸æœ‰ 65536 ( 2çš„16æ¬¡æ–¹) ä¸ªä¸åŒçš„ç«¯å£å·ï¼ŒèŒƒå›´åœ¨ 0 ~ 65535 ä¹‹é—´ã€‚</p><p>ç«¯å£å·æ ¹æ®æœåŠ¡å™¨ä½¿ç”¨è¿˜æ˜¯å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä»¥åŠå¸¸è§ä¸å¸¸è§çš„ç»´åº¦æ¥åŒºåˆ†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ç±»åˆ«ï¼š</p><ol><li>æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·<ul><li>ç†ŸçŸ¥ç«¯å£å·</li><li>ç™»è®°ç«¯å£å·</li></ul></li><li>å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·</li></ol><p>ä¸‹é¢å±•å¼€æ¥è¯´è¯´ã€‚</p><h3 id="ç«¯å£å·çš„åˆ†ç±»"><a href="#ç«¯å£å·çš„åˆ†ç±»" class="headerlink" title="ç«¯å£å·çš„åˆ†ç±»"></a>ç«¯å£å·çš„åˆ†ç±»</h3><h4 id="æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·"><a href="#æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·" class="headerlink" title="æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·"></a>æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·</h4><p><strong>ç†ŸçŸ¥ç«¯å£å·</strong>ï¼š<br>å–å€¼èŒƒå›´ï¼š0 ~ 1023ã€‚<br>å¯ä»¥åœ¨ www.iana.org æŸ¥åˆ°ï¼ŒæœåŠ¡å™¨æœºå™¨ä¸€æ¥é€šç”µæºï¼ŒæœåŠ¡å™¨ç¨‹åºå°±è¿è¡Œèµ·æ¥ï¼Œä¸ºäº†è®©å› ç‰¹ç½‘ä¸Šæ‰€æœ‰çš„å®¢æˆ·ç¨‹åºéƒ½èƒ½æ‰¾åˆ°æœåŠ¡å™¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç¨‹åºæ‰€ä½¿ç”¨çš„ç«¯å£å°±å¿…é¡»æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ€»æ‰€ä¼—æ‰€å‘¨çŸ¥çš„ã€‚</p><p>ä¸€äº›å¸¸è§çš„ç«¯å£å·ï¼š</p><div class="table-container"><table><thead><tr><th>åº”ç”¨ç¨‹åº</th><th>FTP</th><th>TELNET</th><th>SMTP</th><th>DNS</th><th>TFTP</th><th>HTTP</th><th>HTTPS</th><th>SNMP</th></tr></thead><tbody><tr><td>ç†ŸçŸ¥ç«¯å£å·</td><td><strong>21</strong></td><td>23</td><td>25</td><td>53</td><td>69</td><td><strong>80</strong></td><td><strong>443</strong></td><td>161</td></tr></tbody></table></div><p><strong>ç™»è®°ç«¯å£å·</strong>ï¼š<br>å–å€¼èŒƒå›´ï¼š1024 ~ 49151ã€‚<br>è¿™ç±»ç«¯å£æ²¡æœ‰ç†ŸçŸ¥çš„åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦ç™»è®°ï¼Œä»¥é˜²é‡å¤</p><h4 id="å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·"><a href="#å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·" class="headerlink" title="å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·"></a>å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·</h4><p>å–å€¼èŒƒå›´ï¼š49152 ~ 65535ã€‚<br>è¿™ç±»ç«¯å£ä»…åœ¨å®¢æˆ·ç«¯è¿›ç¨‹è¿è¡Œæ—¶æ‰åŠ¨æ€é€‰æ‹©ã€‚<br>åˆå« çŸ­æš‚ç«¯å£å·ï¼Œè¡¨ç¤ºè¿™ç§ç«¯å£çš„å­˜åœ¨æ—¶é—´æ˜¯çŸ­æš‚çš„ï¼Œå®¢æˆ·è¿›ç¨‹å¹¶ä¸åœ¨æ„æ“ä½œç³»ç»Ÿç»™å®ƒåˆ†é…çš„æ˜¯å“ªä¸€ä¸ªç«¯å£å·ï¼Œå› ä¸ºå®¢æˆ·è¿›ç¨‹ä¹‹æ‰€ä»¥å¿…é¡»æœ‰ä¸€ä¸ªç«¯å£å·ï¼Œæ˜¯ä¸ºäº†è®©ä¼ è¾“å±‚çš„å®ä½“èƒ½å¤Ÿæ‰¾åˆ°è‡ªå·±ã€‚</p><p><strong>åœ¨<code>/etc/services</code>æ–‡ä»¶ä¸­å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çŸ¥åæœåŠ¡ä½¿ç”¨çš„ç«¯å£ã€‚</strong></p><h2 id="TCPæŠ¥æ–‡ç»“æ„"><a href="#TCPæŠ¥æ–‡ç»“æ„" class="headerlink" title="TCPæŠ¥æ–‡ç»“æ„"></a>TCPæŠ¥æ–‡ç»“æ„</h2><p>TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œä½†ä¼ é€çš„æ•°æ®å•å…ƒå´æ˜¯æŠ¥æ–‡æ®µã€‚</p><p><strong>ä»€ä¹ˆæ˜¯æŠ¥æ–‡ï¼Ÿ</strong><br>ä¾‹å¦‚ä¸€ä¸ª 100kb çš„ HTML æ–‡æ¡£éœ€è¦ä¼ é€åˆ°å¦å¤–ä¸€å°è®¡ç®—æœºï¼Œå¹¶ä¸ä¼šæ•´ä¸ªæ–‡æ¡£ç›´æ¥ä¼ é€è¿‡å»ï¼Œå¯èƒ½ä¼šåˆ‡å‰²æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚å››ä¸ªåˆ†åˆ«ä¸º 25kb çš„æ•°æ®æ®µã€‚<br>è€Œæ¯ä¸ªæ•°æ®æ®µå†åŠ ä¸Šä¸€ä¸ª TCP é¦–éƒ¨ï¼Œå°±ç»„æˆäº† TCP æŠ¥æ–‡ã€‚<br>ä¸€å…±å››ä¸ª TCP æŠ¥æ–‡ï¼Œå‘é€åˆ°å¦å¤–ä¸€ä¸ªç«¯ã€‚<br>å¦å¤–ä¸€ç«¯æ”¶åˆ°æ•°æ®åŒ…ï¼Œç„¶åå†å‰”é™¤ TCP é¦–éƒ¨ï¼Œç»„è£…èµ·æ¥ã€‚<br>ç­‰åˆ°å››ä¸ªæ•°æ®åŒ…éƒ½æ”¶åˆ°äº†ï¼Œå°±èƒ½è¿˜åŸå‡ºæ¥ä¸€ä¸ªå®Œæ•´çš„ HTML æ–‡æ¡£äº†ã€‚</p><p>åœ¨ OSI çš„ä¸ƒå±‚åè®®ä¸­ï¼Œç¬¬äºŒå±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰çš„æ•°æ®å«ã€ŒFrameã€ï¼Œç¬¬ä¸‰å±‚ï¼ˆç½‘ç»œå±‚ï¼‰ä¸Šçš„æ•°æ®å«ã€ŒPacketã€ï¼Œç¬¬å››å±‚ï¼ˆä¼ è¾“å±‚ï¼‰çš„æ•°æ®å«ã€ŒSegmentã€ã€‚</p><p>TCP æŠ¥æ–‡ (Segment)ï¼ŒåŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ã€‚</p><p>è€Œ TCP çš„å…¨éƒ¨åŠŸèƒ½éƒ½ä½“ç°åœ¨å®ƒé¦–éƒ¨ä¸­å„å­—æ®µçš„ä½œç”¨ï¼Œåªæœ‰å¼„æ¸… TCP é¦–éƒ¨å„å­—æ®µçš„ä½œç”¨æ‰èƒ½æŒæ¡ TCP çš„å·¥ä½œåŸç†ã€‚<br>TCP æŠ¥æ–‡æ®µé¦–éƒ¨çš„å‰20ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„ï¼Œåé¢æœ‰ 4N å­—èŠ‚æ˜¯æ ¹æ®éœ€è¦è€Œå¢åŠ çš„ã€‚<br>ä¸‹å›¾æ˜¯æŠŠ TCP æŠ¥æ–‡ä¸­çš„é¦–éƒ¨æ”¾å¤§æ¥çœ‹ã€‚</p><p>TCP çš„é¦–éƒ¨åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li>æºç«¯å£ source port</li><li>ç›®çš„ç«¯å£ destination port</li><li>åºå· sequence number</li><li>ç¡®è®¤å· acknowledgment number</li><li>æ•°æ®åç§» offset</li><li>ä¿ç•™ reserved</li><li>æ ‡å¿—ä½ tcp flags</li><li>çª—å£å¤§å° window size</li><li>æ£€éªŒå’Œ checksum</li><li>ç´§æ€¥æŒ‡é’ˆ urgent pointer</li><li>é€‰é¡¹ tcp options</li></ol><p>ä¸‹é¢å±•å¼€æ¥æè¿°ä¸ªå­—æ®µçš„æ„ä¹‰å’Œä½œç”¨ã€‚</p><h3 id="TCP-é¦–éƒ¨å„å­—æ®µçš„æ„ä¹‰å’Œä½œç”¨"><a href="#TCP-é¦–éƒ¨å„å­—æ®µçš„æ„ä¹‰å’Œä½œç”¨" class="headerlink" title="TCP é¦–éƒ¨å„å­—æ®µçš„æ„ä¹‰å’Œä½œç”¨"></a>TCP é¦–éƒ¨å„å­—æ®µçš„æ„ä¹‰å’Œä½œç”¨</h3><h4 id="æºç«¯å£å’Œç›®çš„ç«¯å£-Port"><a href="#æºç«¯å£å’Œç›®çš„ç«¯å£-Port" class="headerlink" title="æºç«¯å£å’Œç›®çš„ç«¯å£ Port"></a>æºç«¯å£å’Œç›®çš„ç«¯å£ Port</h4><p>å„å  2 ä¸ª å­—èŠ‚ï¼Œå…± 4 ä¸ªå­—èŠ‚ã€‚<br>ç”¨æ¥å‘ŠçŸ¥ä¸»æœºè¯¥æŠ¥æ–‡æ®µæ˜¯æ¥è‡ªå“ªé‡Œä»¥åŠä¼ é€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºï¼ˆåº”ç”¨ç¨‹åºç»‘å®šäº†ç«¯å£ï¼‰çš„ã€‚<br>è¿›è¡Œ TCP é€šè®¯æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ï¼Œè€ŒæœåŠ¡å™¨åˆ™ä½¿ç”¨çŸ¥åæœåŠ¡ç«¯å£å·ã€‚</p><h4 id="åºå·-Sequence-Number"><a href="#åºå·-Sequence-Number" class="headerlink" title="åºå· Sequence Number"></a>åºå· Sequence Number</h4><p>å  4 ä¸ªå­—èŠ‚ã€‚<br>TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œåœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­ä¼ è¾“çš„å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æŒ‰ç…§é¡ºåºç¼–å·ã€‚<br>ä¾‹å¦‚ 100 kb çš„ HTML æ–‡æ¡£æ•°æ®ï¼Œä¸€å…± 102400 (100 * 1024) ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªå­—èŠ‚å°±éƒ½æœ‰äº†ç¼–å·ï¼Œæ•´ä¸ªæ–‡æ¡£çš„ç¼–å·çš„èŒƒå›´æ˜¯ 0 ~ 102399ã€‚</p><p>åºå·å­—æ®µå€¼æŒ‡çš„æ˜¯<strong>æœ¬æŠ¥æ–‡æ®µ</strong>æ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚<br>é‚£ä¹ˆ 100 çš„ HTML æ–‡æ¡£åˆ†å‰²æˆå››ä¸ªç­‰åˆ†ä¹‹åï¼Œ<br>ç¬¬ä¸€ä¸ª TCP æŠ¥æ–‡æ®µåŒ…å«çš„æ˜¯ç¬¬ä¸€ä¸ª 25kb çš„æ•°æ®ï¼Œ0 ~ 25599 å­—èŠ‚ï¼Œ è¯¥æŠ¥æ–‡çš„åºå·çš„å€¼å°±æ˜¯ï¼š0<br>ç¬¬äºŒä¸ª TCP æŠ¥æ–‡æ®µåŒ…å«çš„æ˜¯ç¬¬äºŒä¸ª 25kb çš„æ•°æ®ï¼Œ25600 ~ 51199 å­—èŠ‚ï¼Œè¯¥æŠ¥æ–‡çš„åºå·çš„å€¼å°±æ˜¯ï¼š25600<br>â€¦â€¦</p><p>æ ¹æ® 8 ä½ = 1 å­—èŠ‚ï¼Œé‚£ä¹ˆ 4 ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´ï¼š[0, 2^32]ï¼Œä¸€å…± 2^32 (4294967296) ä¸ªåºå·ã€‚<br>åºå·å¢åŠ åˆ°æœ€å¤§å€¼çš„æ—¶å€™ï¼Œä¸‹ä¸€ä¸ªåºå·åˆå›åˆ°äº† 0.<br>ä¹Ÿå°±æ˜¯è¯´ TCP åè®®å¯å¯¹ 4GB çš„æ•°æ®è¿›è¡Œç¼–å·ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¯ä¿è¯å½“åºå·é‡å¤ä½¿ç”¨æ—¶ï¼Œæ—§åºå·çš„æ•°æ®æ—©å·²ç»é€šè¿‡ç½‘ç»œåˆ°è¾¾ç»ˆç‚¹æˆ–è€…ä¸¢å¤±äº†ã€‚</p><h4 id="ç¡®è®¤å·-Acknowledgemt-Number"><a href="#ç¡®è®¤å·-Acknowledgemt-Number" class="headerlink" title="ç¡®è®¤å· Acknowledgemt Number"></a>ç¡®è®¤å· Acknowledgemt Number</h4><p>å  4 ä¸ªå­—èŠ‚ã€‚<br>è¡¨ç¤º<strong>æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·å€¼</strong>ã€‚<br>TCP çš„å¯é æ€§ï¼Œæ˜¯å»ºç«‹åœ¨ã€Œæ¯ä¸€ä¸ªæ•°æ®æŠ¥æ–‡éƒ½éœ€è¦ç¡®è®¤æ”¶åˆ°ã€çš„åŸºç¡€ä¹‹ä¸Šçš„ã€‚<br>å°±æ˜¯è¯´ï¼Œé€šè®¯çš„ä»»ä½•ä¸€æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹çš„ä¸€ä¸ªæŠ¥æ–‡ä¹‹åï¼Œéƒ½è¦å‘é€ä¸€ä¸ªç›¸å¯¹åº”çš„ã€Œç¡®è®¤æŠ¥æ–‡ã€ï¼Œæ¥è¡¨è¾¾ç¡®è®¤æ”¶åˆ°ã€‚<br><strong>é‚£ä¹ˆï¼Œç¡®è®¤æŠ¥æ–‡ï¼Œå°±ä¼šåŒ…å«ç¡®è®¤å·</strong>ã€‚<br>ä¾‹å¦‚ï¼Œé€šè®¯çš„ä¸€æ–¹æ”¶åˆ°äº†ç¬¬ä¸€ä¸ª 25kb çš„æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡çš„ åºå·å€¼=0ï¼Œé‚£ä¹ˆå°±éœ€è¦å›å¤ä¸€ä¸ª<strong>ç¡®è®¤æŠ¥æ–‡</strong>ï¼Œå…¶ä¸­çš„ç¡®è®¤å· = 25600.</p><h4 id="æ•°æ®åç§»-Offset"><a href="#æ•°æ®åç§»-Offset" class="headerlink" title="æ•°æ®åç§» Offset"></a>æ•°æ®åç§» Offset</h4><p>å  0.5 ä¸ªå­—èŠ‚ (4 ä½)ã€‚<br>è¿™ä¸ªå­—æ®µå®é™…ä¸Šæ˜¯æŒ‡å‡ºäº† <strong>TCP æŠ¥æ–‡æ®µçš„é¦–éƒ¨é•¿åº¦</strong> ï¼Œå®ƒæŒ‡å‡ºäº† TCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„ è·ç¦» TCPæŠ¥æ–‡çš„èµ·å§‹å¤„ æœ‰å¤šè¿œã€‚ï¼ˆæ³¨æ„ æ•°æ®èµ·å§‹å¤„ å’Œ æŠ¥æ–‡èµ·å§‹å¤„ çš„æ„æ€ï¼‰</p><p>ä¸€ä¸ªæ•°æ®åç§»é‡ = 4 byteï¼Œç”±äº 4 ä½äºŒè¿›åˆ¶æ•°èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°å­—æ˜¯ 15ï¼Œå› æ­¤æ•°æ®åç§»çš„æœ€å¤§å€¼æ˜¯ 60 byteï¼Œè¿™ä¹Ÿä¾§é¢é™åˆ¶äº† TCP é¦–éƒ¨çš„æœ€å¤§é•¿åº¦ã€‚</p><h4 id="ä¿ç•™-Reserved"><a href="#ä¿ç•™-Reserved" class="headerlink" title="ä¿ç•™ Reserved"></a>ä¿ç•™ Reserved</h4><p>å  0.75 ä¸ªå­—èŠ‚ (6 ä½)ã€‚<br>ä¿ç•™ä¸ºä»Šåä½¿ç”¨ï¼Œä½†ç›®å‰åº”ç½®ä¸º 0ã€‚</p><h4 id="æ ‡å¿—ä½-TCP-Flags"><a href="#æ ‡å¿—ä½-TCP-Flags" class="headerlink" title="æ ‡å¿—ä½ TCP Flags"></a>æ ‡å¿—ä½ TCP Flags</h4><p>æ ‡å¿—ä½ï¼Œä¸€å…±æœ‰ 6 ä¸ªï¼Œåˆ†åˆ«å  1 ä½ï¼Œå…± 6 ä½ ã€‚<br>æ¯ä¸€ä½çš„å€¼åªæœ‰ 0 å’Œ 1ï¼Œåˆ†åˆ«è¡¨è¾¾ä¸åŒæ„æ€ã€‚</p><h5 id="ç´§æ€¥-URG-Urgent"><a href="#ç´§æ€¥-URG-Urgent" class="headerlink" title="ç´§æ€¥ URG (Urgent)"></a>ç´§æ€¥ URG (Urgent)</h5><p>å½“ <code>URG = 1</code> çš„æ—¶å€™ï¼Œè¡¨ç¤ºç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰æœ‰æ•ˆã€‚<br>å®ƒå‘Šè¯‰ç³»ç»Ÿæ­¤æŠ¥æ–‡æ®µä¸­æœ‰ç´§æ€¥æ•°æ®ï¼Œåº”å°½å¿«ä¼ é€ï¼Œè€Œä¸è¦æŒ‰åŸæ¥çš„æ’é˜Ÿé¡ºåºæ¥ä¼ é€ã€‚<br>URG è¦ä¸é¦–éƒ¨ä¸­çš„ ç´§æ€¥æŒ‡é’ˆ å­—æ®µé…åˆä½¿ç”¨ã€‚</p><h5 id="ç¡®è®¤-ACK-Acknowlegemt"><a href="#ç¡®è®¤-ACK-Acknowlegemt" class="headerlink" title="ç¡®è®¤ ACK (Acknowlegemt)"></a>ç¡®è®¤ ACK (Acknowlegemt)</h5><p>å½“ <code>ACK = 1</code> çš„æ—¶å€™ï¼Œç¡®è®¤å·ï¼ˆAcknowledgemt Numberï¼‰æœ‰æ•ˆã€‚<br>ä¸€èˆ¬ç§°æºå¸¦ ACK æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œç¡®è®¤æŠ¥æ–‡æ®µã€ã€‚<br>TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK è®¾ç½®ä¸º 1ã€‚</p><h5 id="æ¨é€-PSH-Push"><a href="#æ¨é€-PSH-Push" class="headerlink" title="æ¨é€ PSH (Push)"></a>æ¨é€ PSH (Push)</h5><p>å½“ <code>PSH = 1</code> çš„æ—¶å€™ï¼Œè¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µé«˜ä¼˜å…ˆçº§ï¼Œæ¥æ”¶æ–¹ TCP åº”è¯¥å°½å¿«æ¨é€ç»™æ¥æ”¶åº”ç”¨ç¨‹åºï¼Œè€Œä¸ç”¨ç­‰åˆ°æ•´ä¸ª TCP ç¼“å­˜éƒ½å¡«æ»¡äº†åå†äº¤ä»˜ã€‚</p><h5 id="å¤ä½-RST-Reset"><a href="#å¤ä½-RST-Reset" class="headerlink" title="å¤ä½ RST (Reset)"></a>å¤ä½ RST (Reset)</h5><p>å½“ <code>RST = 1</code> çš„æ—¶å€™ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°ä¸¥é‡é”™è¯¯ï¼Œéœ€è¦é‡Šæ”¾å¹¶é‡æ–°å»ºç«‹è¿æ¥ã€‚<br>ä¸€èˆ¬ç§°æºå¸¦ RST æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œå¤ä½æŠ¥æ–‡æ®µã€ã€‚</p><h5 id="åŒæ­¥-SYN-SYNchronization"><a href="#åŒæ­¥-SYN-SYNchronization" class="headerlink" title="åŒæ­¥ SYN (SYNchronization)"></a>åŒæ­¥ SYN (SYNchronization)</h5><p>å½“ <code>SYN = 1</code> çš„æ—¶å€™ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¯·æ±‚è¿æ¥æŠ¥æ–‡æ®µã€‚<br>ä¸€èˆ¬ç§°æºå¸¦ SYN æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€ŒåŒæ­¥æŠ¥æ–‡æ®µã€ã€‚<br>åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡å°±æ˜¯åŒæ­¥æŠ¥æ–‡æ®µï¼Œåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚<br>å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™åº”åœ¨å“åº”çš„æŠ¥æ–‡æ®µä¸­ä½¿ SYN = 1 å’Œ ACK = 1ã€‚</p><h5 id="ç»ˆæ­¢-FIN-Finis"><a href="#ç»ˆæ­¢-FIN-Finis" class="headerlink" title="ç»ˆæ­¢ FIN (Finis)"></a>ç»ˆæ­¢ FIN (Finis)</h5><p>å½“ FIN = 1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾ TCP è¿æ¥ã€‚<br>ä¸€èˆ¬ç§°æºå¸¦ FIN çš„æŠ¥æ–‡æ®µä¸ºã€Œç»“æŸæŠ¥æ–‡æ®µã€ã€‚<br>åœ¨ TCP å››æ¬¡æŒ¥æ‰‹é‡Šæ”¾è¿æ¥çš„æ—¶å€™ï¼Œå°±ä¼šç”¨åˆ°è¯¥æ ‡å¿—ã€‚</p><h4 id="çª—å£å¤§å°-Window-Size"><a href="#çª—å£å¤§å°-Window-Size" class="headerlink" title="çª—å£å¤§å° Window Size"></a>çª—å£å¤§å° Window Size</h4><p>å  2 å­—èŠ‚ã€‚<br>è¯¥å­—æ®µæ˜ç¡®æŒ‡å‡ºäº†ç°åœ¨å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œå®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„ TCP æ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚<br>çª—å£å¤§å°çš„å€¼æ˜¯æŒ‡ï¼Œä»æœ¬æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­çš„ç¡®è®¤å·ç®—èµ·ï¼Œæ¥æ”¶æ–¹ç›®å‰å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ã€‚<br>ä¾‹å¦‚ï¼Œå‡å¦‚ç¡®è®¤å·æ˜¯ 701 ï¼Œçª—å£å­—æ®µæ˜¯ 1000ã€‚è¿™å°±è¡¨æ˜ï¼Œä» 701 å·ç®—èµ·ï¼Œå‘é€æ­¤æŠ¥æ–‡æ®µçš„ä¸€æ–¹è¿˜æœ‰æ¥æ”¶ 1000 ï¼ˆå­—èŠ‚åºå·æ˜¯ 701 ~ 1700ï¼‰ ä¸ªå­—èŠ‚çš„æ•°æ®çš„æ¥æ”¶ç¼“å­˜ç©ºé—´ã€‚</p><h4 id="æ ¡éªŒå’Œ-TCP-Checksum"><a href="#æ ¡éªŒå’Œ-TCP-Checksum" class="headerlink" title="æ ¡éªŒå’Œ TCP Checksum"></a>æ ¡éªŒå’Œ TCP Checksum</h4><p>å  2 ä¸ªå­—èŠ‚ã€‚<br>ç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹ TCP æŠ¥æ–‡æ®µæ‰§è¡Œ CRC ç®—æ³•ï¼Œä»¥æ£€éªŒ TCP æŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåï¼Œå¦‚æœæŸåè¿™ä¸¢å¼ƒã€‚<br>æ£€éªŒèŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯ TCP å¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚</p><h4 id="ç´§æ€¥æŒ‡é’ˆ-Urgent-Pointer"><a href="#ç´§æ€¥æŒ‡é’ˆ-Urgent-Pointer" class="headerlink" title="ç´§æ€¥æŒ‡é’ˆ Urgent Pointer"></a>ç´§æ€¥æŒ‡é’ˆ Urgent Pointer</h4><p>å  2 ä¸ªå­—èŠ‚ã€‚<br>ä»…åœ¨ <code>URG = 1</code> æ—¶æ‰æœ‰æ„ä¹‰ï¼Œå®ƒæŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ã€‚<br>å½“ <code>URG = 1</code> æ—¶ï¼Œå‘é€æ–¹ TCP å°±æŠŠç´§æ€¥æ•°æ®æ’å…¥åˆ°æœ¬æŠ¥æ–‡æ®µæ•°æ®çš„<strong>æœ€å‰é¢</strong>ï¼Œè€Œåœ¨ç´§æ€¥æ•°æ®åé¢çš„æ•°æ®ä»æ˜¯æ™®é€šæ•°æ®ã€‚<br>å› æ­¤ï¼Œç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºäº†ç´§æ€¥æ•°æ®çš„æœ«å°¾åœ¨æŠ¥æ–‡æ®µä¸­çš„ä½ç½®ã€‚</p><p>TCP çš„æ•´ä¸ªäº¤æµè¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼šå…ˆå»ºç«‹è¿æ¥ï¼Œç„¶åä¼ è¾“æ•°æ®ï¼Œæœ€åé‡Šæ”¾é“¾æ¥ã€‚</p><h2 id="TCPè¿æ¥å’Œå…³é—­"><a href="#TCPè¿æ¥å’Œå…³é—­" class="headerlink" title="TCPè¿æ¥å’Œå…³é—­"></a>TCPè¿æ¥å’Œå…³é—­</h2><h3 id="TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥"><a href="#TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥" class="headerlink" title="TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥"></a>TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥</h3><p>TCP è¿æ¥å»ºç«‹è¦è§£å†³çš„é¦–è¦é—®é¢˜å°±æ˜¯ï¼š<strong>è¦ä½¿æ¯ä¸€æ–¹èƒ½å¤Ÿç¡®çŸ¥å¯¹æ–¹çš„å­˜åœ¨ã€‚</strong></p><p>ä¸‰æ¬¡æ¡æ‰‹å°±åƒï¼Œåœ¨ä¸€ä¸ªé»‘æš—çš„æ£®æ—ï¼Œä½ çŸ¥é“å‰æ–¹åç‚¹é’Ÿæ–¹å‘å¥½åƒæœ‰äººã€‚<br>ä½ å–Šäº†ä¸€å¥ï¼šHelloï¼ŸIâ€™am JerryCï¼ŒWho are youï¼Ÿ<br>å¯¹é¢å›äº†ä¸€å¥ï¼šHi! Iâ€™am David, and nice to meet you!<br>ç„¶åä½ å›äº†ä¸€å¥ï¼šNice to meet you too!<br>â€¦â€¦(è‡ªæ­¤ï¼Œä½ ä»¬æ‰ç®—çœŸæ­£è®¤è¯†äº†åŒæ–¹ï¼Œå¼€å§‹äº†åé¢çœç•¥3000å­—çš„è°ˆè¯)</p><p>æ‰€ä»¥è¯´ï¼Œä¸¤ä¸ªäººéœ€è¦äº¤æœ‹å‹ï¼ˆä¸¤ä¸ªç«¯ç‚¹éœ€è¦å»ºç«‹è¿æ¥ï¼‰ï¼Œè‡³å°‘éœ€è¦ä¸‰æ¬¡çš„é€šè¯ï¼ˆæ¡æ‰‹ï¼‰</p><p>å…¶å®ï¼Œç½‘ç»œä¸Šçš„ä¼ è¾“æ˜¯æ²¡æœ‰è¿æ¥çš„ï¼ŒTCP ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br>è€Œ TCP æ‰€è°“çš„ã€Œè¿æ¥ã€ï¼Œå…¶å®åªä¸è¿‡æ˜¯åœ¨é€šä¿¡çš„åŒæ–¹ç»´æŠ¤ä¸€ä¸ªã€Œè¿æ¥çŠ¶æ€ã€ï¼Œè®©å®ƒçœ‹ä¸Šå»å¥½åƒæœ‰è¿æ¥ä¸€æ ·ã€‚</p><h4 id="è¿æ¥å»ºç«‹è¿‡ç¨‹"><a href="#è¿æ¥å»ºç«‹è¿‡ç¨‹" class="headerlink" title="è¿æ¥å»ºç«‹è¿‡ç¨‹"></a>è¿æ¥å»ºç«‹è¿‡ç¨‹</h4><p>TCP è¿æ¥çš„å»ºç«‹é‡‡ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ï¼Œä¸»åŠ¨å‘èµ·è¿æ¥å»ºç«‹çš„ä¸€æ–¹å«<strong>å®¢æˆ·ç«¯ï¼ˆClientï¼‰</strong>ï¼Œè¢«åŠ¨ç­‰å¾…è¿æ¥å»ºç«‹çš„ä¸€æ–¹å«<strong>æœåŠ¡å™¨ï¼ˆServerï¼‰</strong>ã€‚</p><p>æœ€åˆçš„æ—¶å€™ï¼Œä¸¤ç«¯éƒ½å¤„äº <strong>CLOSED</strong> çš„çŠ¶æ€ï¼Œç„¶åæœåŠ¡å™¨æ‰“å¼€äº† TCP æœåŠ¡ï¼Œè¿›å…¥ <strong>LISTEN</strong> çŠ¶æ€ï¼Œç›‘å¬ç‰¹å®šç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ TCP è¯·æ±‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨wiresharkæ¥æŠ“å–ä¸€ä¸ªç®€å•çš„TCPä¸‰æ¬¡æ¡æ‰‹çš„åŒ…ã€‚</p><p><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼š å®¢æˆ·ç«¯ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œå‘é€ TCP æŠ¥æ–‡ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œç„¶åè¿›å…¥ <strong>SYN_SEND</strong> çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘å›ç¡®è®¤æŠ¥æ–‡ã€‚<br>è¿™æ—¶é¦–éƒ¨çš„åŒæ­¥ä½ <code>SYN = 1</code>ï¼ŒåŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªåºå· <code>Sequence Number = J</code>ã€‚<br>TCP è§„å®šï¼ŒSYN æŠ¥æ–‡æ®µä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†ä¼šæ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</p><p><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼š æœåŠ¡å™¨æ”¶åˆ°äº† SYN æŠ¥æ–‡ï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ï¼Œç„¶åæœåŠ¡å™¨è¿›å…¥ <strong>SYN_RCVD</strong> çŠ¶æ€ã€‚<br>è¿™æ—¶é¦–éƒ¨çš„ <code>SYN = 1ï¼ŒACK = 1</code>ï¼Œè€Œç¡®è®¤å· <code>Acknowledgemt Number = J + 1</code>ï¼ŒåŒæ—¶ä¹Ÿä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºå· <code>Sequence Number = K</code>ã€‚<br>è¿™ä¸ªæŠ¥æ–‡åŒæ ·ä¸æºå¸¦æ•°æ®ã€‚</p><p><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼š<br>å®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡å™¨å‘è¿‡æ¥çš„ç¡®è®¤æŠ¥æ–‡ï¼Œè¿˜è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ï¼Œç„¶åè¿›å…¥ <strong>ESTABLISHED</strong> çŠ¶æ€ã€‚<br>è¿™æ—¶é¦–éƒ¨çš„ SYN ä¸å†ç½®ä¸º 1ï¼Œè€Œ <code>ACK = 1</code>ï¼Œç¡®è®¤å· <code>Acknowledgemt Number = K + 1</code>ï¼Œåºå· <code>Sequence Number = J + 1</code>ã€‚<br>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸€èˆ¬ä¼šæºå¸¦çœŸæ­£éœ€è¦ä¼ è¾“çš„æ•°æ®ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°è¯¥æ•°æ®æŠ¥æ–‡çš„æ—¶å€™ï¼Œå°±ä¼šåŒæ ·è¿›å…¥ <strong>ESTABLISHED</strong> çŠ¶æ€ã€‚ æ­¤æ—¶ï¼ŒTCP è¿æ¥å·²ç»å»ºç«‹ã€‚</p><p>å¯¹äºå»ºç«‹è¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸»è¦ç›®çš„æ˜¯åˆå§‹åŒ–åºå· Sequence Numberï¼Œå¹¶ä¸”é€šä¿¡çš„åŒæ–¹éƒ½éœ€è¦å‘ŠçŸ¥å¯¹æ–¹è‡ªå·±çš„åˆå§‹åŒ–åºå·ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå« SYNã€‚<br>è¿™ä¸ªåºå·è¦ä½œä¸ºä»¥åçš„æ•°æ®é€šä¿¡çš„åºå·ï¼Œä»¥ä¿è¯åº”ç”¨å±‚æ¥æ”¶åˆ°çš„æ•°æ®ä¸ä¼šå› ä¸ºç½‘ç»œä¸Šçš„ä¼ è¾“é—®é¢˜è€Œä¹±åºï¼Œå› ä¸ºTCP ä¼šç”¨è¿™ä¸ªåºå·æ¥æ‹¼æ¥æ•°æ®ã€‚</p><h4 id="åˆ©ç”¨è¿æ¥è®¾è®¡ç¼ºé™·å®æ–½-TCP-Flood-æ”»å‡»"><a href="#åˆ©ç”¨è¿æ¥è®¾è®¡ç¼ºé™·å®æ–½-TCP-Flood-æ”»å‡»" class="headerlink" title="åˆ©ç”¨è¿æ¥è®¾è®¡ç¼ºé™·å®æ–½ TCP Flood æ”»å‡»"></a>åˆ©ç”¨è¿æ¥è®¾è®¡ç¼ºé™·å®æ–½ TCP Flood æ”»å‡»</h4><p>çŸ¥é“äº† TCP å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œéœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ã€‚<br>ä½†å¦‚æœä½ å¼€å§‹æ€è€ƒã€Œä¸‰æ¬¡æ¡æ‰‹çš„å¿…è¦æ€§ã€çš„æ—¶å€™ï¼Œå°±ä¼šçŸ¥é“ï¼Œå…¶å®ç½‘ç»œæ˜¯å¾ˆå¤æ‚çš„ï¼Œä¸€ä¸ªä¿¡æ¯åœ¨é€”ä¸­ä¸¢å¤±çš„å¯èƒ½æ€§æ˜¯æœ‰çš„ã€‚<br>å¦‚æœæ•°æ®ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆï¼Œå°±éœ€è¦é‡æ–°å‘é€ï¼Œè¿™æ—¶å€™å°±è¦çŸ¥é“æ•°æ®æ˜¯å¦çœŸçš„é€è¾¾äº†ã€‚<br>è¿™å°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„å¿…è¦æ€§ã€‚<br>ä½†æ˜¯å†å‘æ·±ä¸€å±‚æ€è€ƒï¼Œä½ ç»™æˆ‘å‘ä¿¡æ¯ï¼Œæˆ‘æ”¶åˆ°äº†ï¼Œæˆ‘å›å¤ï¼Œå› ä¸ºæˆ‘æ˜¯å›å­ã€‚<br>å¦‚æœæ˜¯å°äººï¼Œä½ ç»™æˆ‘å‘ä¿¡æ¯ï¼Œæˆ‘å°±ç®—æ”¶åˆ°äº†ï¼Œæˆ‘ä¹Ÿä¸å›å¤ï¼Œä½ å°±ä¸€ç›´ç­‰æˆ‘ç€æˆ‘çš„å›å¤ã€‚<br>é‚£ä¹ˆå¾ˆå¤šå°äººéƒ½è¿™æ ·åšï¼Œä½ å°±è¦ä¸€ç›´è®°ä½ä½ åœ¨ç­‰å¾…ç€å°äºº1å·ã€å°äºº2å·ã€å°äºº3å·â€¦â€¦ç›´åˆ°ä½ çš„è„‘å®¹é‡çˆ†æ£šï¼Œçƒ§åè„‘è¢‹ã€‚<br>é»‘å®¢å°±æ˜¯åˆ©ç”¨è¿™æ ·çš„è®¾è®¡ç¼ºé™·ï¼Œå®æ–½ TCP Flood æ”»å‡»ï¼Œå±äº DDOS æ”»å‡»çš„ä¸€ç§ã€‚<br>æƒ³äº†è§£æ›´å¤š SYN Flood æ”»å‡»è¯·çœ‹ï¼š<a href="https://www.wikiwand.com/en/SYN_flood">SYN flood - wiki</a></p><h3 id="TCPå››æ¬¡æŒ¥æ‰‹ï¼Œé‡Šæ”¾è¿æ¥"><a href="#TCPå››æ¬¡æŒ¥æ‰‹ï¼Œé‡Šæ”¾è¿æ¥" class="headerlink" title="TCPå››æ¬¡æŒ¥æ‰‹ï¼Œé‡Šæ”¾è¿æ¥"></a>TCPå››æ¬¡æŒ¥æ‰‹ï¼Œé‡Šæ”¾è¿æ¥</h3><p>TCP æœ‰ä¸€ä¸ªç‰¹åˆ«çš„æ¦‚å¿µå«åš<strong>åŠå…³é—­</strong>ï¼Œè¿™ä¸ªæ¦‚å¿µæ˜¯è¯´ï¼ŒTCP çš„è¿æ¥æ˜¯å…¨åŒå·¥ï¼ˆå¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶ï¼‰çš„è¿æ¥ï¼Œå› æ­¤åœ¨å…³é—­è¿æ¥çš„æ—¶å€™ï¼Œå¿…é¡»å…³é—­ä¼ é€å’Œæ¥æ”¶ä¸¤ä¸ªæ–¹å‘ä¸Šçš„è¿æ¥ã€‚<br>å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªæºå¸¦ FIN çš„ TCP ç»“æŸæŠ¥æ–‡æ®µï¼Œç„¶åæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ª ç¡®è®¤æŠ¥æ–‡æ®µï¼ŒåŒæ—¶å‘é€ä¸€ä¸ª ç»“æŸæŠ¥æ–‡æ®µï¼Œå½“å®¢æˆ·ç«¯å›å¤ä¸€ä¸ª ç¡®è®¤æŠ¥æ–‡æ®µ ä¹‹åï¼Œè¿æ¥å°±ç»“æŸäº†ã€‚</p><h4 id="é‡Šæ”¾è¿æ¥è¿‡ç¨‹"><a href="#é‡Šæ”¾è¿æ¥è¿‡ç¨‹" class="headerlink" title="é‡Šæ”¾è¿æ¥è¿‡ç¨‹"></a>é‡Šæ”¾è¿æ¥è¿‡ç¨‹</h4><p>åœ¨ç»“æŸä¹‹å‰ï¼Œé€šä¿¡åŒæ–¹éƒ½æ˜¯å¤„äº <strong>ESTABLISHED</strong> çŠ¶æ€ï¼Œç„¶åå…¶ä¸­ä¸€æ–¹ä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚<br>ä¸‹é¢å‡å¦‚å®¢æˆ·ç«¯å…ˆä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚</p><p><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼š</strong><br>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ç»“æŸæŠ¥æ–‡æ®µï¼Œç„¶åè¿›å…¥ <strong>FIN_WAIT_1</strong> çŠ¶æ€ã€‚<br>æ­¤æŠ¥æ–‡æ®µ <code>FIN = 1</code>ï¼Œ <code>Sequence Number = M</code>ã€‚</p><p><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼š</strong><br>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ç»“æŸæŠ¥æ–‡æ®µï¼Œç„¶åå‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼Œè¿›å…¥ <strong>CLOSE_WAIT</strong> çŠ¶æ€ã€‚<br>æ­¤æŠ¥æ–‡æ®µ <code>ACK = 1</code>ï¼Œ <code>Sequence Number = M + 1</code>ã€‚</p><p>å®¢æˆ·ç«¯æ”¶åˆ°è¯¥æŠ¥æ–‡ï¼Œä¼šè¿›å…¥ <strong>FIN_WAIT_2</strong> çŠ¶æ€ã€‚</p><p><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼š</strong><br>åŒæ—¶æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ç»“æŸæŠ¥æ–‡æ®µï¼Œç„¶åè¿›å…¥ <strong>LAST_ACK</strong> çŠ¶æ€ã€‚<br>æ­¤æŠ¥æ–‡æ®µ <code>FIN = 1</code>ï¼Œ<code>Sequence Number = N</code>ã€‚</p><p><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼š</strong><br>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ç»“æŸæŠ¥æ–‡æ®µï¼Œç„¶åå‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼Œè¿›å…¥ <strong>TIME_WAIT</strong> çŠ¶æ€ï¼Œç»è¿‡ 2MSL ä¹‹åï¼Œè‡ªåŠ¨è¿›å…¥ <strong>CLOSED</strong> çŠ¶æ€ã€‚<br>æ­¤æŠ¥æ–‡æ®µ <code>ACK = 1</code>, <code>Sequence Number = N + 1</code>ã€‚</p><p>æœåŠ¡ç«¯æ”¶åˆ°è¯¥æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥ <strong>CLOSED</strong> çŠ¶æ€ã€‚</p><p><strong>å…³äº TIME_WAIT è¿‡æ¸¡åˆ° CLOSED çŠ¶æ€è¯´æ˜</strong>ï¼š<br>ä» <strong>TIME_WAIT</strong> è¿›å…¥ <strong>CLOSED</strong> éœ€è¦ç»è¿‡ 2MSLï¼Œå…¶ä¸­ MSL å°±å«åš æœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼ˆMaxinum Segment Lifetimeï¼‰ï¼Œæ ¹æ® RFC 793 å»ºè®®è¯¥å€¼è¿™æ˜¯ä¸º 2 åˆ†é’Ÿï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦ç»è¿‡ 4 åˆ†é’Ÿï¼Œæ‰è¿›å…¥ <strong>CLOSED</strong> çŠ¶æ€ã€‚</p><h2 id="çŠ¶æ€æµè½¬"><a href="#çŠ¶æ€æµè½¬" class="headerlink" title="çŠ¶æ€æµè½¬"></a>çŠ¶æ€æµè½¬</h2><p>æ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œåœ¨åŒæ–¹ TCP é€šè®¯çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šæœ‰ç€ä¸€ä¸ªã€ŒçŠ¶æ€ã€çš„æ¦‚å¿µï¼ŒçŠ¶æ€ä¼šéšç€ TCP é€šè®¯çš„ä¸åŒé˜¶æ®µè€Œå˜åŒ–ã€‚</p><h3 id="TCP-çŠ¶æ€æµè½¬å›¾"><a href="#TCP-çŠ¶æ€æµè½¬å›¾" class="headerlink" title="TCP çŠ¶æ€æµè½¬å›¾"></a>TCP çŠ¶æ€æµè½¬å›¾</h3><h3 id="å„ç§çŠ¶æ€è¡¨ç¤ºçš„æ„æ€"><a href="#å„ç§çŠ¶æ€è¡¨ç¤ºçš„æ„æ€" class="headerlink" title="å„ç§çŠ¶æ€è¡¨ç¤ºçš„æ„æ€"></a>å„ç§çŠ¶æ€è¡¨ç¤ºçš„æ„æ€</h3><ul><li><p><strong>CLOSED</strong>ï¼šè¡¨ç¤ºåˆå§‹çŠ¶æ€</p></li><li><p><strong>LISTEN</strong>ï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„æŸä¸ª socket å¤„äºç›‘å¬çŠ¶æ€ï¼Œå¯ä»¥æ¥å—è¿æ¥</p></li><li><p><strong>SYN_SENT</strong>ï¼šåœ¨æœåŠ¡ç«¯ç›‘å¬åï¼Œå®¢æˆ·ç«¯ socket æ‰§è¡Œ CONNECT è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ SYN æŠ¥æ–‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°±è¿›å…¥ SYN_SENT çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯ç¡®è®¤ã€‚</p></li><li><p><strong>SYN_RCVD</strong>ï¼šè¡¨ç¤ºæœåŠ¡ç«¯æ¥æ”¶åˆ°äº† SYN æŠ¥æ–‡ã€‚</p></li><li><p><strong>ESTABLISHED</strong>ï¼šè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹äº†ã€‚</p></li><li><p><strong>FIN_WAIT_1</strong>ï¼šå…¶ä¸­ä¸€æ–¹è¯·æ±‚ç»ˆæ­¢è¿æ¥ï¼Œç­‰å¾…å¯¹æ–¹çš„ FIN æŠ¥æ–‡ã€‚</p></li><li><p><strong>FIN_WAIT_2</strong>ï¼šåœ¨ <strong>FIN_WAIT_2</strong> ä¹‹åï¼Œ å½“å¯¹æ–¹å›åº” ACK æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥è¯¥çŠ¶æ€ã€‚</p></li><li><p><strong>TIME_WAIT</strong>ï¼šè¡¨ç¤ºæ”¶åˆ°äº†å¯¹æ–¹çš„ FIN æŠ¥æ–‡ï¼Œå¹¶å‘é€å‡ºäº† ACK æŠ¥æ–‡ï¼Œå°±ç­‰ 2MSL ä¹‹åå³å¯å›åˆ° CLOSED çŠ¶æ€ã€‚</p></li><li><p><strong>CLOSING</strong>ï¼šä¸€ç§ç½•è§çŠ¶æ€ï¼Œå‘ç”Ÿåœ¨å‘é€ FIN æŠ¥æ–‡ä¹‹åï¼Œæœ¬åº”æ˜¯å…ˆæ”¶åˆ° ACK æŠ¥æ–‡ï¼Œå´å…ˆæ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±ä» FIN_WAIT_1 çš„çŠ¶æ€è¿›å…¥ CLOSING çŠ¶æ€ã€‚</p></li><li><p><strong>CLOSE_WAIT</strong>ï¼šè¡¨ç¤ºç­‰å¾…å…³é—­ï¼Œåœ¨ ESTABLISHED è¿‡æ¸¡åˆ° LAST_ACK çš„ä¸€ä¸ªè¿‡æ¸¡é˜¶æ®µï¼Œè¯¥é˜¶æ®µéœ€è¦è€ƒè™‘æ˜¯å¦è¿˜æœ‰æ•°æ®å‘é€ç»™å¯¹æ–¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å¯ä»¥å…³é—­è¿æ¥ï¼Œå‘é€ FIN æŠ¥æ–‡ï¼Œç„¶åè¿›å…¥ LAST_ACK çŠ¶æ€ã€‚</p></li><li><p><strong>LAST_ACK</strong>ï¼šè¢«åŠ¨å…³é—­ä¸€æ–¹å‘é€ FIN æŠ¥æ–‡ä¹‹åï¼Œæœ€åç­‰å¾…å¯¹æ–¹çš„ ACK æŠ¥æ–‡æ‰€å¤„çš„çŠ¶æ€ã€‚</p></li><li><p><strong>CLOSED</strong>ï¼šå½“æ”¶åˆ° ACK ä¿æ¸©åï¼Œå°±å¯ä»¥è¿›å…¥ CLOSED çŠ¶æ€äº†ã€‚</p></li></ul><h2 id="TCPå¯é æ€§"><a href="#TCPå¯é æ€§" class="headerlink" title="TCPå¯é æ€§"></a>TCPå¯é æ€§</h2><p>TCP æ˜¯ä¸€ç§æä¾›å¯é æ€§äº¤ä»˜çš„åè®®ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ TCP è¿æ¥ä¼ è¾“çš„æ•°æ®ï¼Œæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€å¹¶ä¸”æŒ‰åºåˆ°è¾¾ã€‚<br>ä½†æ˜¯åœ¨ç½‘ç»œä¸­ç›¸è¿ä¸¤ç«¯ä¹‹é—´çš„ä»‹è´¨ï¼Œæ˜¯å¤æ‚çš„ï¼Œå¹¶ä¸ç¡®ä¿æ•°æ®çš„å¯é æ€§äº¤ä»˜ï¼Œé‚£ä¹ˆ TCP æ˜¯æ€ä¹ˆæ ·è§£å†³é—®é¢˜çš„ï¼Ÿ<br>è¿™å°±éœ€è¦äº†è§£ TCP çš„å‡ ç§æŠ€æœ¯ï¼š</p><ol><li>æ»‘åŠ¨çª—å£</li><li>è¶…æ—¶é‡ä¼ </li><li>æµé‡æ§åˆ¶</li><li>æ‹¥å¡æ§åˆ¶</li></ol><p>ä¸‹é¢æ¥åˆ†åˆ«è®²ä¸€ä¸‹è¿™å‡ ç§æŠ€æœ¯çš„å®ç°åŸç†ã€‚</p><h3 id="è¶…æ—¶é‡ä¼ "><a href="#è¶…æ—¶é‡ä¼ " class="headerlink" title="è¶…æ—¶é‡ä¼ "></a>è¶…æ—¶é‡ä¼ </h3><h4 id="é‡ä¼ æ—¶æœº"><a href="#é‡ä¼ æ—¶æœº" class="headerlink" title="é‡ä¼ æ—¶æœº"></a>é‡ä¼ æ—¶æœº</h4><p>TCP æŠ¥æ–‡æ®µåœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œä¸‹é¢çš„æƒ…å†µéƒ½æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ï¼š</p><ol><li>æ•°æ®åŒ…ä¸­é€”ä¸¢å¤±ï¼›</li><li>æ•°æ®åŒ…é¡ºåˆ©åˆ°è¾¾ï¼Œä½†å¯¹æ–¹å‘é€çš„ ACK æŠ¥æ–‡ä¸­é€”ä¸¢å¤±ï¼›</li><li>æ•°æ®åŒ…é¡ºåˆ©åˆ°è¾¾ï¼Œä½†å¯¹æ–¹å¼‚å¸¸æœªå“åº” ACK æˆ–è¢«å¯¹æ–¹ä¸¢å¼ƒï¼›</li></ol><p>å½“å‡ºç°è¿™äº›å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒTCP å°±ä¼šè¶…æ—¶é‡ä¼ ã€‚<br>TCP æ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå°±å¯¹è¿™ä¸ªæŠ¥æ–‡æ®µè®¾ç½®ä¸€æ¬¡è®¡æ—¶å™¨ã€‚åªè¦è®¡æ—¶å™¨è®¾ç½®çš„é‡ä¼ æ—¶é—´åˆ°äº†ï¼Œä½†è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ è¿™ä¸€æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªå°±å«åšã€Œè¶…æ—¶é‡ä¼ ã€ã€‚</p><h4 id="é‡ä¼ ç®—æ³•"><a href="#é‡ä¼ ç®—æ³•" class="headerlink" title="é‡ä¼ ç®—æ³•"></a>é‡ä¼ ç®—æ³•</h4><h5 id="RTO-Retransmission-Time-Out-é‡ä¼ è¶…æ—¶æ—¶é—´"><a href="#RTO-Retransmission-Time-Out-é‡ä¼ è¶…æ—¶æ—¶é—´" class="headerlink" title="RTO ( Retransmission Time-Out ) é‡ä¼ è¶…æ—¶æ—¶é—´"></a>RTO ( Retransmission Time-Out ) é‡ä¼ è¶…æ—¶æ—¶é—´</h5><p>æŒ‡å‘é€ç«¯å‘é€æ•°æ®åã€é‡ä¼ æ•°æ®å‰ç­‰å¾…æ¥æ”¶æ–¹æ”¶åˆ°è¯¥æ•°æ® ACK æŠ¥æ–‡çš„æ—¶é—´ã€‚<br>å¤§ç™½è¯å°±æ˜¯ï¼Œéœ€è¦ç­‰å¾…å¤šé•¿æ—¶é—´è¿˜æ²¡æ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡æ–°ä¼ ä¸€æ¬¡ã€‚</p><p>RTO çš„è®¾ç½®å¯¹äºé‡ä¼ éå¸¸é‡è¦ï¼š</p><ol><li>è®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œæ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®ï¼›</li><li>è®¾çŸ­äº†ï¼Œé‡å‘å¾—å°±å¿«ï¼Œä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘ã€‚</li></ol><h5 id="RTT-Round-Trip-Time-è¿æ¥å¾€è¿”æ—¶é—´"><a href="#RTT-Round-Trip-Time-è¿æ¥å¾€è¿”æ—¶é—´" class="headerlink" title="RTT ( Round Trip Time ) è¿æ¥å¾€è¿”æ—¶é—´"></a>RTT ( Round Trip Time ) è¿æ¥å¾€è¿”æ—¶é—´</h5><p>æŒ‡å‘é€ç«¯ä»å‘é€ TCP åŒ…å¼€å§‹åˆ°æ¥æ”¶å®ƒçš„ ACK æŠ¥æ–‡ä¹‹é—´æ‰€è€—è´¹çš„æ—¶é—´ã€‚<br>è€Œåœ¨å®é™…çš„ç½‘ç»œä¼ è¾“ä¸­ï¼ŒRTT çš„å€¼æ¯æ¬¡éƒ½æ˜¯éšæœºçš„ï¼Œæ— æ³•äº‹å…ˆé¢„é¢„çŸ¥ã€‚<br>TCP é€šè¿‡æµ‹é‡æ¥è·å¾—è¿æ¥å½“å‰ RTT çš„ä¸€ä¸ªä¼°è®¡å€¼ï¼Œå¹¶ä»¥è¯¥ RTT ä¼°è®¡å€¼ä¸ºåŸºå‡†æ¥è®¾ç½®å½“å‰çš„ RTOã€‚<br>è¿™å°±å¼•å…¥äº†ä¸€ç±»ç®—æ³•çš„ç§°å‘¼ï¼šè‡ªé€‚åº”é‡ä¼ ç®—æ³•ï¼ˆAdaptive Restransmission Algorithmï¼‰<br>è¿™ç±»ç®—æ³•çš„å…³é”®å°±åœ¨äºå¯¹å½“å‰ RTT çš„å‡†ç¡®ä¼°è®¡ï¼Œä»¥ä¾¿é€‚æ—¶è°ƒæ•´ RTOã€‚</p><p>å…³äºè‡ªé€‚åº”é‡ä¼ ç®—æ³•ï¼Œç»å†è¿‡å¤šæ¬¡çš„è¿­ä»£å’Œä¿®æ­£ã€‚<br>ä» 1981 å¹´çš„ <a href="https://tools.ietf.org/html/rfc793">RFC793</a> æåŠçš„ç»å…¸ç®—æ³•ï¼Œåˆ° 1987 å¹´ Karn æå‡ºçš„ Karn/Partridge ç®—æ³•ï¼Œå†åˆ°åæ¥çš„ 1988 å¹´çš„ Jacobson / Karels ç®—æ³•ã€‚<br>æœ€åçš„è¿™ä¸ªç®—æ³•åœ¨è¢«ç”¨åœ¨ä»Šå¤©çš„ TCP åè®®ä¸­ï¼ˆLinuxçš„æºä»£ç åœ¨ï¼š<a href="http://lxr.free-electrons.com/source/net/ipv4/tcp_input.c?v=2.6.32#L609"><code>tcp_rtt_estimator</code></a>ï¼‰ã€‚</p><p>è‡ªé€‚åº”é‡ä¼ ç®—æ³•çš„å‘å±•è¯»è€…æœ‰å…´è¶£å¯ä»¥å‚è€ƒå…¶ä»–èµ„æ–™ï¼Œåœ¨è¿™é‡Œæˆ‘æ‹ä¸€ä¸ªç°åœ¨åœ¨ç”¨çš„ç®—æ³•å‡ºæ¥è®²è®²ï¼Œéšæ„æ„Ÿå—ä¸€ä¸‹ã€‚</p><h5 id="Jacobson-Karels-ç®—æ³•"><a href="#Jacobson-Karels-ç®—æ³•" class="headerlink" title="Jacobson / Karels ç®—æ³•"></a>Jacobson / Karels ç®—æ³•</h5><p>1988å¹´ï¼Œæœ‰äººæ¨å‡ºæ¥äº†ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å« Jacobson / Karels Algorithmï¼ˆå‚çœ‹<a href="https://tools.ietf.org/html/rfc2988">RFC6298</a>ï¼‰ã€‚<br>å…¶è®¡ç®—å…¬å¼ï¼š</p><blockquote><p>SRTT = SRTT + Î± ( RTT â€“ SRTT ) â€”â€” è®¡ç®—å¹³æ»‘ RTT</p><p>DevRTT = ( 1-Î² ) <em>DevRTT + Î²</em> ( | RTT - SRTT | ) â€”â€”è®¡ç®—å¹³æ»‘ RTT å’ŒçœŸå®çš„å·®è·ï¼ˆåŠ æƒç§»åŠ¨å¹³å‡ï¼‰</p><p>RTO= Âµ <em>SRTT + âˆ‚</em> DevRTT</p></blockquote><p>å…¶ä¸­ï¼š</p><ul><li><code>Î±</code>ã€<code>Î²</code>ã€<code>Î¼</code>ã€<code>âˆ‚</code> æ˜¯å¯ä»¥è°ƒæ•´çš„å‚æ•°ï¼Œåœ¨ RFC6298 ä¸­ç»™å‡ºäº†å¯¹åº”çš„å‚è€ƒå€¼ï¼Œè€Œåœ¨Linuxä¸‹ï¼Œ<code>Î± = 0.125ï¼ŒÎ² = 0.25ï¼Œ Î¼ = 1ï¼Œâˆ‚ = 4</code>ï¼›</li><li>SRTT æ˜¯ Smoothed RTT çš„æ„æ€ï¼Œæ˜¯ RTT çš„å¹³æ»‘è®¡ç®—å€¼ï¼Œå³æ ¹æ®æ¯æ¬¡æµ‹é‡çš„ RTT å’Œæ—§çš„ RTT è¿›è¡Œè¿ç®—ï¼Œå¾—å‡ºæ–°çš„ RTTã€‚SRTT çš„å€¼ï¼Œä¼šåœ¨æ¯ä¸€æ¬¡æµ‹é‡åˆ° RTT ä¹‹åè¿›è¡Œæ›´æ–°ï¼›</li><li>DevRTT æ˜¯ Deviation RTT çš„æ„æ€ï¼Œæ ¹æ®æ¯æ¬¡æµ‹é‡çš„ RTT å’Œæ—§çš„ SRTT å€¼è¿›è¡Œè¿ç®—ï¼Œå¾—å‡ºæ–°çš„ DevRTTï¼›</li></ul><p>ç”±ç®—æ³•å¯ä»¥çŸ¥é“ RTO çš„å€¼ä¼šæ ¹æ®æ¯æ¬¡æµ‹é‡çš„ RTT å€¼å˜åŒ–è€Œå˜åŒ–ï¼ŒåŸºæœ¬è¦ç‚¹æ˜¯ TCP ç›‘è§†æ¯ä¸ªè¿æ¥çš„æ€§èƒ½ï¼Œç”±æ¯ä¸€ä¸ª TCP çš„è¿æ¥æƒ…å†µæ¨ç®—å‡ºåˆé€‚çš„ RTO å€¼ï¼Œæ ¹æ®ä¸åŒçš„ç½‘ç»œæƒ…å†µï¼Œè‡ªåŠ¨ä¿®æ”¹ RTO å€¼ï¼Œä»¥é€‚åº”è´Ÿè´£çš„ç½‘ç»œå˜åŒ–ã€‚</p><h3 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h3><h4 id="æ…¢å¯åŠ¨ï¼ˆSlow-Startï¼‰-ä¸-æ‹¥å¡é¿å…ï¼ˆCongestion-Avoidanceï¼‰"><a href="#æ…¢å¯åŠ¨ï¼ˆSlow-Startï¼‰-ä¸-æ‹¥å¡é¿å…ï¼ˆCongestion-Avoidanceï¼‰" class="headerlink" title="æ…¢å¯åŠ¨ï¼ˆSlow Startï¼‰ ä¸ æ‹¥å¡é¿å…ï¼ˆCongestion Avoidanceï¼‰"></a>æ…¢å¯åŠ¨ï¼ˆSlow Startï¼‰ ä¸ æ‹¥å¡é¿å…ï¼ˆCongestion Avoidanceï¼‰</h4><h4 id="å¿«é€Ÿé‡ä¼ ï¼ˆFast-Retransmitï¼‰-ä¸-å¿«é€Ÿæ¢å¤ï¼ˆFast-Recoveryï¼‰"><a href="#å¿«é€Ÿé‡ä¼ ï¼ˆFast-Retransmitï¼‰-ä¸-å¿«é€Ÿæ¢å¤ï¼ˆFast-Recoveryï¼‰" class="headerlink" title="å¿«é€Ÿé‡ä¼ ï¼ˆFast Retransmitï¼‰ ä¸ å¿«é€Ÿæ¢å¤ï¼ˆFast Recoveryï¼‰"></a>å¿«é€Ÿé‡ä¼ ï¼ˆFast Retransmitï¼‰ ä¸ å¿«é€Ÿæ¢å¤ï¼ˆFast Recoveryï¼‰</h4><h3 id="æ»‘åŠ¨çª—å£-Sliding-Window"><a href="#æ»‘åŠ¨çª—å£-Sliding-Window" class="headerlink" title="æ»‘åŠ¨çª—å£ Sliding Window"></a>æ»‘åŠ¨çª—å£ Sliding Window</h3><p>æ»‘åŠ¨çª—å£åè®®æ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿæ˜¯ TCP åè®®çš„ç²¾é«“æ‰€åœ¨ã€‚</p><p>TCP å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« Windowï¼Œå« Advertised-Windowï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯å‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®ã€‚äºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥ã€‚</p><p>æ»‘åŠ¨çª—å£åˆ†ä¸ºã€Œæ¥æ”¶çª—å£ã€å’Œã€Œå‘é€çª—å£ã€<br>å› ä¸º TCP åè®®æ˜¯å…¨åŒå·¥çš„ï¼Œä¼šè¯çš„åŒæ–¹éƒ½å¯ä»¥åŒæ—¶æ¥æ”¶å’Œå‘é€ï¼Œé‚£ä¹ˆå°±éœ€è¦å„è‡ªç»´æŠ¤ä¸€ä¸ªã€Œå‘é€çª—å£ã€å’Œã€Œæ¥æ”¶çª—å£ã€ã€‚</p><h4 id="å‘é€çª—å£"><a href="#å‘é€çª—å£" class="headerlink" title="å‘é€çª—å£"></a>å‘é€çª—å£</h4><p>å¤§å°å–å†³äºå¯¹ç«¯é€šå‘Šçš„æ¥å—çª—å£ã€‚<br>åªæœ‰æ”¶åˆ°å¯¹ç«¯å¯¹äºæœ¬ç«¯å‘é€çª—å£å†…å­—èŠ‚çš„ ACK ç¡®è®¤ï¼Œæ‰ä¼šç§»åŠ¨å‘é€çª—å£çš„å·¦è¾¹ç•Œã€‚</p><p>ä¸‹å›¾æ˜¯å‘é€çª—å£çš„ç¤ºæ„å›¾ï¼š</p><p>å¯¹äºå‘é€çª—å£ï¼Œåœ¨ç¼“å­˜å†…çš„æ•°æ®æœ‰å››ç§çŠ¶æ€ï¼š</p><ul><li>#1 å·²å‘é€ï¼Œå¹¶å¾—åˆ°æ¥æ”¶æ–¹ ACK ç¡®è®¤ï¼›</li><li>#2 å·²å‘é€ï¼Œä½†è¿˜æœªæ”¶åˆ°æ¥æ”¶æ–¹ ACKï¼›</li><li>#3 æœªå‘é€ï¼Œä½†æ¥æ”¶æ–¹å…è®¸å‘é€ï¼Œæ¥æ”¶æ–¹è¿˜æœ‰ç©ºé—´</li><li>#4 æœªå‘é€ï¼Œä¸”æ¥æ”¶æ–¹ä¸å…è®¸å‘é€ï¼Œæ¥æ”¶æ–¹æ²¡æœ‰ç©ºé—´</li></ul><p>å¦‚æœä¸‹ä¸€åˆ»ï¼Œæ”¶åˆ°äº†æ¥æ”¶æ–¹å¯¹äº 32-36 å­—èŠ‚åºçš„æ•°æ®åŒ…çš„ ACK ç¡®è®¤ï¼Œé‚£ä¹ˆå‘é€æ–¹çš„çª—å£å°±ä¼šå‘ç”Ÿã€Œæ»‘åŠ¨ã€ã€‚<br>å¹¶ä¸”å‘é€ä¸‹ä¸€ä¸ª 46-51 å­—èŠ‚åºçš„æ•°æ®åŒ…ã€‚</p><p>æ»‘åŠ¨çª—å£çš„æ¦‚å¿µï¼Œæè¿°äº† TCP çš„æ•°æ®æ˜¯æ€ä¹ˆå‘é€ï¼Œä»¥åŠæ€ä¹ˆæ¥æ”¶çš„ã€‚<br>TCP çš„æ»‘åŠ¨çª—å£æ˜¯åŠ¨æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡æˆå°å­¦å¸¸è§çš„ä¸€ä¸ªæ•°å­¦é¢˜ï¼Œä¸€ä¸ªæ°´æ± ï¼Œä½“ç§¯ Vï¼Œæ¯å°æ—¶è¿›æ°´é‡ V1, å‡ºæ°´é‡ V2ã€‚<br>å½“æ°´æ± æ»¡äº†å°±ä¸å…è®¸å†æ³¨å…¥äº†ï¼Œå¦‚æœæœ‰ä¸ªæ¶²å‹ç³»ç»Ÿæ§åˆ¶æ°´æ± å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ§åˆ¶æ°´çš„æ³¨å…¥é€Ÿç‡å’Œé‡äº†ã€‚<br>åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è‡ªèº«çš„å¤„ç†èƒ½åŠ›å˜åŒ–ï¼Œé€šè¿‡ API æ¥æ§åˆ¶æœ¬ç«¯ TCP æ¥æ”¶çª—å£çš„å¤§å°ï¼Œæ¥è¿›è¡Œæµé‡æ§åˆ¶ã€‚</p><h4 id="æ¥æ”¶çª—å£"><a href="#æ¥æ”¶çª—å£" class="headerlink" title="æ¥æ”¶çª—å£"></a>æ¥æ”¶çª—å£</h4><p>å¤§å°å–å†³äºåº”ç”¨ã€ç³»ç»Ÿã€ç¡¬ä»¶çš„é™åˆ¶ã€‚</p><p>ä¸‹å›¾æ˜¯æ¥æ”¶çª—å£çš„ç¤ºæ„å›¾ï¼ˆæ‰¾ä¸åˆ°å›¾ï¼Œå”¯æœ‰è‡ªå·±ç”»äº†ï¼‰ï¼š</p><p>ç›¸å¯¹äºå‘é€çª—å£ï¼Œæ¥å—çª—å£åœ¨ç¼“å­˜å†…çš„æ•°æ®åªæœ‰ä¸‰ç§çŠ¶æ€ï¼š</p><ul><li>å·²æ¥æ”¶å·²ç¡®è®¤ï¼›</li><li>æœªæ¥æ”¶ï¼Œå‡†å¤‡æ¥æ”¶ï¼›</li><li>æœªæ¥æ”¶ï¼Œå¹¶æœªå‡†å¤‡æ¥æ”¶ï¼›</li></ul><p>ä¸‹ä¸€åˆ»æ¥æ”¶åˆ°æ¥è‡ªå‘é€ç«¯çš„ 32-36 æ•°æ®åŒ…ï¼Œç„¶åå›é€ ACK ç¡®è®¤æŠ¥ï¼Œå¹¶ä¸”ç§»åŠ¨æ¥æ”¶çª—å£ã€‚</p><p>å¦å¤–æ¥æ”¶ç«¯ç›¸å¯¹äºå‘é€ç«¯è¿˜æœ‰ä¸åŒçš„ä¸€ç‚¹ï¼Œåªæœ‰å‰é¢æ‰€æœ‰çš„æ®µéƒ½ç¡®è®¤çš„æƒ…å†µä¸‹æ‰ä¼šç§»åŠ¨å·¦è¾¹ç•Œï¼Œ<br>åœ¨å‰é¢è¿˜æœ‰å­—èŠ‚æœªæ¥æ”¶ä½†æ”¶åˆ°åé¢å­—èŠ‚çš„æƒ…å†µä¸‹ï¼Œçª—å£ä¸ä¼šç§»åŠ¨ï¼Œå¹¶ä¸å¯¹åç»­å­—èŠ‚ç¡®è®¤ï¼Œä»¥æ­¤ç¡®ä¿å¯¹ç«¯ä¼šå¯¹è¿™äº›æ•°æ®é‡ä¼ ã€‚<br>å‡å¦‚ 32-36 å­—èŠ‚ä¸æ˜¯ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ï¼Œè€Œæ˜¯æ¯ä¸ªå­—èŠ‚ä¸€ä¸ªæŠ¥æ–‡æ®µçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šåˆ†æˆäº† 5 ä¸ªæŠ¥æ–‡æ®µã€‚<br>åœ¨å®é™…çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸èƒ½ç¡®ä¿æ˜¯æŒ‰åºæ”¶åˆ°çš„ï¼Œå…¶ä¸­ä¼šæœ‰ä¸€äº›æ—©è¾¾åˆ°ï¼Œä¸€äº›è¿Ÿåˆ°è¾¾ã€‚</p><p>å¦‚å›¾ä¸­çš„ 34ã€35 å­—èŠ‚åºï¼Œå…ˆæ”¶åˆ°äº†ï¼Œæ¥æ”¶çª—å£ä¹Ÿä¸ä¼šç§»åŠ¨ã€‚<br>å› ä¸ºæœ‰å¯èƒ½ 32ã€33 å­—èŠ‚åºä¼šå‡ºç°ä¸¢åŒ…æˆ–è€…è¶…æ—¶ï¼Œè¿™æ—¶å°±éœ€è¦å‘é€ç«¯é‡å‘æŠ¥æ–‡æ®µäº†ã€‚</p><h2 id="ç½‘ç»œç¼–ç¨‹æ¥å£-Socket"><a href="#ç½‘ç»œç¼–ç¨‹æ¥å£-Socket" class="headerlink" title="ç½‘ç»œç¼–ç¨‹æ¥å£ - Socket"></a>ç½‘ç»œç¼–ç¨‹æ¥å£ - Socket</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“ç½‘ç»œä¸­çš„è¿›ç¨‹æ˜¯é€šè¿‡ socket æ¥é€šä¿¡çš„ï¼Œé‚£ä»€ä¹ˆæ˜¯ socket å‘¢ï¼Ÿ socket èµ·æºäº UNIXï¼Œè€Œ UNIX/Linux åŸºæœ¬å“²å­¦ä¹‹ä¸€å°±æ˜¯ã€Œä¸€åˆ‡çš†æ–‡ä»¶ã€ï¼Œéƒ½å¯ä»¥ç”¨ã€Œopen â†’ write/read â†’ closeã€æ¨¡å¼æ¥æ“ä½œã€‚ socket å…¶å®å°±æ˜¯è¯¥æ¨¡å¼çš„ä¸€ä¸ªå®ç°ï¼Œsocket å³æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œä¸€äº› socket å‡½æ•°å°±æ˜¯å¯¹å…¶è¿›è¡Œçš„æ“ä½œã€‚</p><p>ä½¿ç”¨ TCP/IP åè®®çš„åº”ç”¨ç¨‹åºé€šå¸¸é‡‡ç”¨ç³»ç»Ÿæä¾›çš„ç¼–ç¨‹æ¥å£ï¼š<strong>UNIX BSD çš„å¥—æ¥å­—æ¥å£ï¼ˆSocket Interfacesï¼‰</strong> ä»¥æ­¤æ¥å®ç°ç½‘ç»œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ å°±ç›®å‰è€Œè¨€ï¼Œå‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯é‡‡ç”¨ socketï¼Œæ‰€ä»¥è¯´ç°åœ¨çš„ç½‘ç»œæ—¶ä»£ï¼Œç½‘ç»œä¸­è¿›ç¨‹é€šä¿¡æ˜¯æ— å¤„ä¸åœ¨ï¼Œ<strong>ä¸€åˆ‡çš† socket</strong></p><h3 id="å¥—æ¥å­—æ¥å£-Socket-Interfaces"><a href="#å¥—æ¥å­—æ¥å£-Socket-Interfaces" class="headerlink" title="å¥—æ¥å­—æ¥å£ Socket Interfaces"></a>å¥—æ¥å­—æ¥å£ Socket Interfaces</h3><p>å¥—æ¥å­—æ¥å£æ˜¯ä¸€ç»„å‡½æ•°ï¼Œç”±æ“ä½œç³»ç»Ÿæä¾›ï¼Œç”¨ä»¥åˆ›å»ºç½‘ç»œåº”ç”¨ã€‚ å¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿéƒ½å®ç°äº†å¥—æ¥å­—æ¥å£ï¼ŒåŒ…æ‹¬æ‰€æœ‰ Unix å˜ç§ï¼ŒWindows å’Œ Macintosh ç³»ç»Ÿã€‚</p><blockquote><p><strong>å¥—æ¥å­—æ¥å£çš„èµ·æº</strong> å¥—æ¥å­—æ¥å£æ˜¯åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„ç ”ç©¶äººå‘˜åœ¨ 20 ä¸–çºª 80 å¹´ä»£æ—©èµ·æå‡ºçš„ã€‚ ä¼¯å…‹åˆ©çš„ç ”ç©¶è€…ä½¿å¾—å¥—æ¥å­—æ¥å£é€‚ç”¨äºä»»ä½•åº•å±‚çš„åè®®ï¼Œç¬¬ä¸€ä¸ªå®ç°å°±æ˜¯é’ˆå¯¹ TCP/IP åè®®ï¼Œä»–ä»¬æŠŠå®ƒåŒ…æ‹¬åœ¨ Unix 4.2 BSD çš„å†…æ ¸é‡Œï¼Œå¹¶ä¸”åˆ†å‘ç»™è®¸å¤šå­¦æ ¡å’Œå®éªŒå®¤ã€‚ è¿™åœ¨å› ç‰¹ç½‘çš„å†å²æˆä¸ºäº†ä¸€ä¸ªé‡å¤§äº‹ä»¶ã€‚ â€”â€” ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</p></blockquote><p>ä» Linux å†…æ ¸çš„è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ªå¥—æ¥å­—å°±æ˜¯é€šä¿¡çš„ä¸€ä¸ªç«¯ç‚¹ã€‚ ä» Linux ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œå¥—æ¥å­—æ˜¯ä¸€ä¸ªæœ‰ç›¸åº”æè¿°ç¬¦çš„æ–‡ä»¶ã€‚ æ™®é€šæ–‡ä»¶çš„æ‰“å¼€æ“ä½œè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°å­—ï¼Œè€Œ <code>socket()</code> ç”¨äºåˆ›å»ºä¸€ä¸ª socket æè¿°ç¬¦ï¼Œå”¯ä¸€æ ‡è¯†ä¸€ä¸ª socketã€‚ è¿™ä¸ª socket æè¿°å­—è·Ÿæ–‡ä»¶æè¿°å­—ä¸€æ ·ï¼Œåç»­çš„æ“ä½œéƒ½æœ‰ç”¨åˆ°å®ƒï¼ŒæŠŠå®ƒä½œä¸ºå‚æ•°ï¼Œé€šè¿‡å®ƒæ¥è¿›è¡Œä¸€äº›æ“ä½œã€‚</p><p>å¸¸ç”¨çš„å‡½æ•°æœ‰ï¼š</p><ul><li><code>socket()</code></li><li><code>bind()</code></li><li><code>listen()</code></li><li><code>connect()</code></li><li><code>accept()</code></li><li><code>write()</code></li><li><code>read()</code></li><li><code>close()</code></li></ul><h3 id="Socket-çš„äº¤äº’æµç¨‹"><a href="#Socket-çš„äº¤äº’æµç¨‹" class="headerlink" title="Socket çš„äº¤äº’æµç¨‹"></a>Socket çš„äº¤äº’æµç¨‹</h3><p><img src= "/img/loading2.gif" data-lazy-src="/Users/maywzh/Library/Application Support/typora-user-images/image-20181016181108554.png" alt="image-20181016181108554"></p><p>å›¾ä¸­å±•ç¤ºäº† TCP åè®®çš„ socket äº¤äº’æµç¨‹ï¼Œæè¿°å¦‚ä¸‹ï¼š</p><ol><li>æœåŠ¡å™¨æ ¹æ®åœ°å€ç±»å‹ã€socket ç±»å‹ã€ä»¥åŠåè®®æ¥åˆ›å»º socketã€‚</li><li>æœåŠ¡å™¨ä¸º socket ç»‘å®š IP åœ°å€å’Œç«¯å£å·ã€‚</li><li>æœåŠ¡å™¨ socket ç›‘å¬ç«¯å£å·è¯·æ±‚ï¼Œéšæ—¶å‡†å¤‡æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¿æ¥ï¼Œè¿™æ—¶å€™æœåŠ¡å™¨çš„ socket å¹¶æ²¡æœ‰å…¨éƒ¨æ‰“å¼€ã€‚</li><li>å®¢æˆ·ç«¯åˆ›å»º socketã€‚</li><li>å®¢æˆ·ç«¯æ‰“å¼€ socketï¼Œæ ¹æ®æœåŠ¡å™¨ IP åœ°å€å’Œç«¯å£å·è¯•å›¾è¿æ¥æœåŠ¡å™¨ socketã€‚</li><li>æœåŠ¡å™¨ socket æ¥æ”¶åˆ°å®¢æˆ·ç«¯ socket è¯·æ±‚ï¼Œè¢«åŠ¨æ‰“å¼€ï¼Œå¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒçŸ¥é“å®¢æˆ·ç«¯è¿”å›è¿æ¥ä¿¡æ¯ã€‚è¿™æ—¶å€™ socket è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œé˜»å¡æ˜¯ç”±äº accept() æ–¹æ³•ä¼šä¸€ç›´ç­‰åˆ°å®¢æˆ·ç«¯è¿”å›è¿æ¥ä¿¡æ¯åæ‰è¿”å›ï¼Œç„¶åå¼€å§‹è¿æ¥ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</li><li>å®¢æˆ·ç«¯è¿æ¥æˆåŠŸï¼Œå‘æœåŠ¡å™¨å‘é€è¿æ¥çŠ¶æ€ä¿¡æ¯ã€‚</li><li>æœåŠ¡å™¨ accept() æ–¹æ³•è¿”å›ï¼Œè¿æ¥æˆåŠŸã€‚</li><li>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œ I/O å‡½æ•°è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚</li><li>å®¢æˆ·ç«¯å…³é—­ socketã€‚</li><li>æœåŠ¡å™¨å…³é—­ socketã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥çš„éƒ¨åˆ†ï¼Œå°±ä½“ç°äº† TCP ä¸‰æ¬¡æ¡æ‰‹çš„åŸç†ã€‚</p><p>ä¸‹é¢è¯¦ç»†è®²ä¸€ä¸‹ socket çš„å„å‡½æ•°ã€‚</p><h3 id="Socket-æ¥å£"><a href="#Socket-æ¥å£" class="headerlink" title="Socket æ¥å£"></a>Socket æ¥å£</h3><p>socket æ˜¯ç³»ç»Ÿæä¾›çš„æ¥å£ï¼Œè€Œæ“ä½œç³»ç»Ÿå¤§å¤šæ•°éƒ½æ˜¯ç”¨ C/C++ å¼€å‘çš„ï¼Œè‡ªç„¶å‡½æ•°åº“ä¹Ÿæ˜¯ C/C++ ä»£ç ã€‚</p><h4 id="socket-å‡½æ•°"><a href="#socket-å‡½æ•°" class="headerlink" title="socket å‡½æ•°"></a>socket å‡½æ•°</h4><p>è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¥—æ¥å­—æè¿°ç¬¦ï¼ˆsocket descriptorï¼‰ï¼Œä½†æ˜¯è¯¥æè¿°ç¬¦ä»…æ˜¯éƒ¨åˆ†æ‰“å¼€çš„ï¼Œè¿˜ä¸èƒ½ç”¨äºè¯»å†™ã€‚ å¦‚ä½•å®Œæˆæ‰“å¼€å¥—æ¥å­—çš„å·¥ä½œï¼Œå–å†³äºæˆ‘ä»¬æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ã€‚</p><h5 id="å‡½æ•°åŸå‹"><a href="#å‡½æ•°åŸå‹" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socket</span><span class="params">(<span class="keyword">int</span> domain, <span class="keyword">int</span> type, <span class="keyword">int</span> protocol)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><ul><li><p><strong>domain</strong>: åè®®åŸŸï¼Œå†³å®šäº† socket çš„åœ°å€ç±»å‹ï¼Œåœ¨é€šä¿¡ä¸­å¿…é¡»é‡‡ç”¨å¯¹åº”çš„åœ°å€ã€‚ å¸¸ç”¨çš„åè®®æ—æœ‰ï¼š<code>AF_INET</code>ï¼ˆipv4åœ°å€ä¸ç«¯å£å·çš„ç»„åˆï¼‰ã€<code>AF_INET6</code>ï¼ˆipv6åœ°å€ä¸ç«¯å£å·çš„ç»„åˆï¼‰ã€<code>AF_LOCAL</code>ï¼ˆç»å¯¹è·¯å¾„åä½œä¸ºåœ°å€ï¼‰ã€‚ è¯¥å€¼çš„å¸¸é‡å®šä¹‰åœ¨ <code>sys/socket.h</code> æ–‡ä»¶ä¸­ã€‚</p></li><li><p><strong>type</strong>: æŒ‡å®š socket ç±»å‹ã€‚ å¸¸ç”¨çš„ç±»å‹æœ‰ï¼š<code>SOCK_STREAM</code>ã€<code>SOCK_DGRAM</code>ã€<code>SOCK_RAW</code>ã€<code>SOCK_PACKET</code>ã€<code>SOCK_SEQPACKET</code>ç­‰ã€‚ å…¶ä¸­ <code>SOCK_STREAM</code> è¡¨ç¤ºæä¾›é¢å‘è¿æ¥çš„ç¨³å®šæ•°æ®ä¼ è¾“ï¼Œå³ TCP åè®®ã€‚ è¯¥å€¼çš„å¸¸é‡å®šä¹‰åœ¨ <code>sys/socket.h</code> æ–‡ä»¶ä¸­ã€‚</p></li><li><p><strong>protocol</strong>: æŒ‡å®šåè®®ã€‚ å¸¸ç”¨çš„åè®®æœ‰ï¼š<code>IPPROTO_TCP</code>ï¼ˆTCPåè®®ï¼‰ã€<code>IPPTOTO_UDP</code>ï¼ˆUDPåè®®ï¼‰ã€<code>IPPROTO_SCTP</code>ï¼ˆSTCPåè®®ï¼‰ã€‚ å½“å€¼ä½ 0 æ—¶ï¼Œä¼šè‡ªåŠ¨é€‰æ‹© <code>type</code> ç±»å‹å¯¹åº”çš„é»˜è®¤åè®®ã€‚</p></li></ul><h4 id="bind-å‡½æ•°"><a href="#bind-å‡½æ•°" class="headerlink" title="bind å‡½æ•°"></a>bind å‡½æ•°</h4><p>ç”±æœåŠ¡ç«¯è°ƒç”¨ï¼ŒæŠŠä¸€ä¸ªåœ°å€æ—ä¸­çš„ç‰¹å®šåœ°å€å’Œ socket è”ç³»èµ·æ¥ã€‚</p><h5 id="å‡½æ•°åŸå‹-1"><a href="#å‡½æ•°åŸå‹-1" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">const</span> struct sockaddr *addr, <span class="keyword">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜-1"><a href="#å‚æ•°è¯´æ˜-1" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><p><strong>sockfd</strong>: å³ socket æè¿°å­—ï¼Œç”± socket() å‡½æ•°åˆ›å»ºã€‚</p><p><strong>*addr</strong>ï¼š ä¸€ä¸ª <code>const struct sockaddr</code> æŒ‡é’ˆï¼ŒæŒ‡å‘è¦ç»‘å®šç»™ <code>sockfd</code> çš„åè®®åœ°å€ã€‚ è¿™ä¸ªåœ°å€ç»“æ„æ ¹æ®åœ°å€åˆ›å»º socket æ—¶çš„åœ°å€åè®®æ—ä¸åŒè€Œä¸åŒï¼Œä¾‹å¦‚ ipv4 å¯¹åº” <code>sockaddr_in</code>ï¼Œipv6 å¯¹åº” <code>sockaddr_in6</code>. è¿™å‡ ä¸ªç»“æ„ä½“åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½å¯ä»¥å¼ºåˆ¶è½¬æ¢æˆ <code>sockaddr</code>ã€‚ ä¸‹é¢æ˜¯è¿™å‡ ä¸ªç»“æ„ä½“å¯¹åº”çš„æ‰€åœ¨çš„å¤´æ–‡ä»¶ï¼š</p><ol><li><code>sockaddr</code>ï¼š <code>sys/socket.h</code></li><li><code>sockaddr_in</code>ï¼š <code>netinet/in.h</code></li><li><code>sockaddr_in6</code>ï¼š <code>netinet6/in.h</code></li></ol><blockquote><p>_in åç¼€æ„ä¹‰ï¼šäº’è”ç½‘ç»œ(internet)çš„ç¼©å†™ï¼Œè€Œä¸æ˜¯è¾“å…¥(input)çš„ç¼©å†™ã€‚</p></blockquote><h4 id="listen-å‡½æ•°"><a href="#listen-å‡½æ•°" class="headerlink" title="listen å‡½æ•°"></a>listen å‡½æ•°</h4><p>æœåŠ¡å™¨è°ƒç”¨ï¼Œå°† socket ä»ä¸€ä¸ªä¸»åŠ¨å¥—æ¥å­—è½¬åŒ–ä¸ºä¸€ä¸ªç›‘å¬å¥—æ¥å­—ï¼ˆlistening socketï¼‰, è¯¥å¥—æ¥å­—å¯ä»¥æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šè®¤ä¸º socket å‡½æ•°åˆ›å»ºçš„æè¿°ç¬¦å¯¹åº”äºä¸»åŠ¨å¥—æ¥å­—ï¼ˆactive socketï¼‰ã€‚</p><h5 id="å‡½æ•°åŸå‹-2"><a href="#å‡½æ•°åŸå‹-2" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">listen</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">int</span> backlog)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜-2"><a href="#å‚æ•°è¯´æ˜-2" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><ul><li><p><strong>sockfd</strong>: å³ socket æè¿°å­—ï¼Œç”± socket() å‡½æ•°åˆ›å»ºã€‚</p></li><li><p><strong>backlog</strong>: æŒ‡å®šåœ¨è¯·æ±‚é˜Ÿåˆ—ä¸­çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œè¿›å…¥çš„è¿æ¥è¯·æ±‚å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾… accept() å®ƒä»¬ã€‚</p></li></ul><h4 id="connect-å‡½æ•°"><a href="#connect-å‡½æ•°" class="headerlink" title="connect å‡½æ•°"></a>connect å‡½æ•°</h4><p>ç”±å®¢æˆ·ç«¯è°ƒç”¨ï¼Œä¸ç›®çš„æœåŠ¡å™¨çš„å¥—æ¥å­—å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚</p><h5 id="å‡½æ•°åŸå‹-3"><a href="#å‡½æ•°åŸå‹-3" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(<span class="keyword">int</span> clientfd, <span class="keyword">const</span> struct sockaddr *addr, <span class="keyword">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜-3"><a href="#å‚æ•°è¯´æ˜-3" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><ul><li><p><strong>clientfd</strong>: ç›®çš„æœåŠ¡å™¨çš„ socket æè¿°ç¬¦</p></li><li><p><strong>*addr</strong>: ä¸€ä¸ª <code>const struct sockaddr</code> æŒ‡é’ˆï¼ŒåŒ…å«äº†ç›®çš„æœåŠ¡å™¨ IP å’Œç«¯å£ã€‚</p></li><li><p><strong>addrlen</strong>ï¼š åè®®åœ°å€çš„é•¿åº¦ï¼Œå¦‚æœæ˜¯ ipv4 çš„ TCP è¿æ¥ï¼Œä¸€èˆ¬ä¸º <code>sizeof(sockaddr_in)</code>;</p></li></ul><h4 id="accept-å‡½æ•°"><a href="#accept-å‡½æ•°" class="headerlink" title="accept å‡½æ•°"></a>accept å‡½æ•°</h4><p>æœåŠ¡å™¨è°ƒç”¨ï¼Œç­‰å¾…æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ å½“å®¢æˆ·ç«¯è¿æ¥ï¼Œaccept å‡½æ•°ä¼šåœ¨ <code>addr</code> ä¸­ä¼šå¡«å……ä¸Šå®¢æˆ·ç«¯çš„å¥—æ¥å­—åœ°å€ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå·²è¿æ¥æè¿°ç¬¦ï¼ˆconnected descriptorï¼‰ï¼Œè¿™ä¸ªæè¿°ç¬¦å¯ä»¥ç”¨æ¥åˆ©ç”¨ Unix I/O å‡½æ•°ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚</p><h5 id="å‡½æ•°åŸå‹-4"><a href="#å‡½æ•°åŸå‹-4" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#indclude <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">accept</span><span class="params">(<span class="keyword">int</span> listenfd, struct sockaddr *addr, <span class="keyword">int</span> *addrlen)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜-4"><a href="#å‚æ•°è¯´æ˜-4" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><ul><li><p><strong>listenfd</strong>: æœåŠ¡å™¨çš„ socket æè¿°å­—ï¼Œç”± socket() å‡½æ•°åˆ›å»ºã€‚</p></li><li><p><strong>*addr</strong>: ä¸€ä¸ª <code>const struct sockaddr</code> æŒ‡é’ˆï¼Œç”¨æ¥å­˜æ”¾æå‡ºè¿æ¥è¯·æ±‚å®¢æˆ·ç«¯çš„ä¸»æœºçš„ä¿¡æ¯</p></li><li><p><strong>addrlen</strong>: åè®®åœ°å€çš„é•¿åº¦ï¼Œå¦‚æœæ˜¯ ipv4 çš„ TCP è¿æ¥ï¼Œä¸€èˆ¬ä¸º <code>sizeof(sockaddr_in)</code>ã€‚</p></li></ul><h4 id="close-å‡½æ•°"><a href="#close-å‡½æ•°" class="headerlink" title="close å‡½æ•°"></a>close å‡½æ•°</h4><p>åœ¨æ•°æ®ä¼ è¾“å®Œæˆä¹‹åï¼Œæ‰‹åŠ¨å…³é—­è¿æ¥ã€‚</p><h5 id="å‡½æ•°åŸå‹-5"><a href="#å‡½æ•°åŸå‹-5" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">close</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜-5"><a href="#å‚æ•°è¯´æ˜-5" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><ul><li><strong>fd</strong>: éœ€è¦å…³é—­çš„è¿æ¥ socket æè¿°ç¬¦</li></ul><h4 id="ç½‘ç»œ-I-O-å‡½æ•°"><a href="#ç½‘ç»œ-I-O-å‡½æ•°" class="headerlink" title="ç½‘ç»œ I/O å‡½æ•°"></a>ç½‘ç»œ I/O å‡½æ•°</h4><p>å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œå¯ä»¥ä½¿ç”¨ç½‘ç»œ I/O è¿›è¡Œè¯»å†™æ“ä½œã€‚ ç½‘ç»œ I/O æ“ä½œæœ‰ä¸‹é¢å‡ ç»„ï¼š</p><ol><li><code>read()/write()</code></li><li><code>recv()/send()</code></li><li><code>readv()/writev()</code></li><li><code>recvmsg()/sendmsg()</code></li><li><code>recvfrom()/sendto()</code></li></ol><p>æœ€å¸¸ç”¨çš„æ˜¯ read()/write() ä»–ä»¬çš„åŸå‹æ˜¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> count)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">write</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> count)</span></span>;</span><br></pre></td></tr></table></figure><p>é‰´äºè¯¥æ–‡æ˜¯ä¾§é‡äºæè¿° socket çš„å·¥ä½œåŸç†ï¼Œå°±ä¸å†è¯¦ç»†æè¿°è¿™äº›å‡½æ•°äº†ã€‚</p><h3 id="å®éªŒ-ä¸€ä¸ªç®€å•TCPé€šä¿¡ç¨‹åº"><a href="#å®éªŒ-ä¸€ä¸ªç®€å•TCPé€šä¿¡ç¨‹åº" class="headerlink" title="å®éªŒ - ä¸€ä¸ªç®€å•TCPé€šä¿¡ç¨‹åº"></a>å®éªŒ - ä¸€ä¸ªç®€å•TCPé€šä¿¡ç¨‹åº</h3><h4 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// socket_server.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE 4096 <span class="comment">// 4 * 1024</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> listenfd, <span class="comment">// ç›‘å¬ç«¯å£çš„ socket æè¿°ç¬¦</span></span><br><span class="line">        connfd;   <span class="comment">// è¿æ¥ç«¯ socket æè¿°ç¬¦</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></span><br><span class="line">    <span class="keyword">char</span> buff[MAXLINE];</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º socketï¼Œå¹¶ä¸”è¿›è¡Œé”™è¯¯å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> ((listenfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;create socket error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– sockaddr_in æ•°æ®ç»“æ„</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;servaddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(servaddr));</span><br><span class="line">    servaddr.sin_family = AF_INET;</span><br><span class="line">    servaddr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">    servaddr.sin_port = htons(<span class="number">6666</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®š socket å’Œ ç«¯å£</span></span><br><span class="line">    <span class="keyword">if</span> (bind(listenfd, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;bind socket error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> (listen(listenfd, <span class="number">10</span>) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;listen socket error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;====== Waiting for client&#x27;s request======\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒç»­æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((connfd = accept(listenfd, (struct sockaddr *)<span class="literal">NULL</span>, <span class="literal">NULL</span>) == <span class="number">-1</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;accept socket error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        n = recv(connfd, buff, MAXLINE, <span class="number">0</span>);</span><br><span class="line">        buff[n] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv msg from client: %s\n&quot;</span>, buff);</span><br><span class="line">        close(connfd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    close(listenfd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// socket_client.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE 4096</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sockfd, n;</span><br><span class="line">    <span class="keyword">char</span> recvline[<span class="number">4096</span>], sendline[<span class="number">4096</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage: ./client &lt;ipaddress&gt;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º socket æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> ((sockfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>)) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;create socket error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ç›®æ ‡æœåŠ¡å™¨æ•°æ®ç»“æ„</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;servaddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(servaddr));</span><br><span class="line">    servaddr.sin_family = AF_INET;</span><br><span class="line">    servaddr.sin_port = htons(<span class="number">6666</span>);</span><br><span class="line">    <span class="comment">// ä»å‚æ•°ä¸­è¯»å– IP åœ°å€</span></span><br><span class="line">    <span class="keyword">if</span> (inet_pton(AF_INET, argv[<span class="number">1</span>], &amp;servaddr.sin_addr) &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;inet_pton error for %s\n&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶å’Œ sockfd è”ç³»èµ·æ¥ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (connect(sockfd, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr)) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;connect error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;send msg to server: \n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–ä¿¡æ¯</span></span><br><span class="line">    fgets(sendline, <span class="number">4096</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ sockfdï¼Œå‘ç›®æ ‡æœåŠ¡å™¨å‘é€ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (send(sockfd, sendline, <span class="built_in">strlen</span>(sendline), <span class="number">0</span>) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send msg error: %s(errno: %d)\n&quot;</span>, strerror(errno), errno);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°æ®ä¼ è¾“å®Œæ¯•ï¼Œå…³é—­ socket è¿æ¥</span></span><br><span class="line">    close(sockfd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><p>é¦–å…ˆåˆ›å»º <code>makefile</code> æ–‡ä»¶</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SRCDIR=./src</span><br><span class="line">BINDIR=./bin</span><br><span class="line">TMPDIR=./tmp</span><br><span class="line"><span class="comment"># VPATH=$(SRCDIR):$(TMPDIR)</span></span><br><span class="line">SRC=<span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(SRCDIR)</span>/*.cpp)</span></span><br><span class="line">BIN=<span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(SRCDIR)</span>/%.cpp, <span class="variable">$(BINDIR)</span>/%, <span class="variable">$(SRC)</span>)</span></span><br><span class="line">TMP=<span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(SRCDIR)</span>/%.cpp, <span class="variable">$(TMPDIR)</span>/%.o, <span class="variable">$(SRC)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SHARE=--share</span></span><br><span class="line"><span class="comment"># CFLAG= -Wall -I../inc</span></span><br><span class="line"><span class="comment"># LFLAG=-L../lib -ldynamic_test -lstatic_test</span></span><br><span class="line">CC=gcc</span><br><span class="line">CPP=g++</span><br><span class="line">AR=ar -cr</span><br><span class="line"></span><br><span class="line">CO=<span class="variable">$(CPP)</span></span><br><span class="line"><span class="comment">#ç”¨é™æ€æ¨¡å¼æ¥åš</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:clean all</span></span><br><span class="line"><span class="section">all: <span class="variable">$(BIN)</span></span></span><br><span class="line"><span class="variable">$(BIN)</span>: <span class="variable">$(BINDIR)</span>/% : <span class="variable">$(TMPDIR)</span>/%.o</span><br><span class="line"><span class="variable">$(CO)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="variable">$(TMP)</span>: <span class="variable">$(TMPDIR)</span>/%.o : <span class="variable">$(SRCDIR)</span>/%.cpp</span><br><span class="line"><span class="variable">$(CO)</span> -c  <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">clean:all</span></span><br><span class="line">rm <span class="variable">$(BIN)</span> <span class="variable">$(TMP)</span></span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨å‘½ä»¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br></pre></td></tr></table></figure><p>ä¼šç”Ÿæˆä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><ol><li><code>socket_server</code></li><li><code>socket_client</code></li></ol><p>åˆ†åˆ«æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œè¿è¡Œï¼š</p><ol><li><code>./socket_server</code></li><li><code>./socket_client 127.0.0.1</code></li></ol><p>ç„¶ååœ¨ <code>socket_client</code> ä¸­é”®å…¥å‘é€å†…å®¹ï¼Œå¯ä»¥å† <code>socket_server</code> æ¥æ”¶åˆ°åŒæ ·çš„ä¿¡æ¯ã€‚</p><h2 id="å¯¹æ¯”UDP"><a href="#å¯¹æ¯”UDP" class="headerlink" title="å¯¹æ¯”UDP"></a>å¯¹æ¯”UDP</h2><p>TCP åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚<br>TCP ä¸æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ï¼Œç”±äº TCP è¦æä¾›å¯é çš„ã€é¢å‘è¿æ¥çš„è¿è¾“æœåŠ¡ï¼Œå› æ­¤ä¸å¯é¿å…åœ°å¢åŠ äº†è®¸å¤šçš„å¼€é”€ï¼Œå¦‚ç¡®è®¤ã€æµé‡æ§åˆ¶ã€è®¡æ—¶å™¨ä»¥åŠè¿æ¥ç®¡ç†ç­‰ã€‚</p><p>è€Œ UDP åœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ã€‚æ¥æ”¶æ–¹æ”¶åˆ° UDP æŠ¥æ–‡ä¹‹åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚<br>è™½ç„¶ UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP å´æ˜¯ä¸€ç§æœ€æœ‰æ•ˆçš„å·¥ä½œæ–¹å¼ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><p><strong>UDPï¼šå•ä¸ªæ•°æ®æŠ¥ï¼Œä¸ç”¨å»ºç«‹è¿æ¥ï¼Œç®€å•ï¼Œä¸å¯é ï¼Œä¼šä¸¢åŒ…ï¼Œä¼šä¹±åºï¼›</strong></p><p><strong>TCPï¼šæµå¼ï¼Œéœ€è¦å»ºç«‹è¿æ¥ï¼Œå¤æ‚ï¼Œå¯é  ï¼Œæœ‰åºã€‚</strong></p><h3 id="UDP-æ¦‚è¿°"><a href="#UDP-æ¦‚è¿°" class="headerlink" title="UDP æ¦‚è¿°"></a>UDP æ¦‚è¿°</h3><p>UDP å…¨ç§° User Datagram Protocol, ä¸ TCP åŒæ˜¯åœ¨ç½‘ç»œæ¨¡å‹ä¸­çš„ä¼ è¾“å±‚çš„åè®®ã€‚</p><p><strong>UDP çš„ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼š</strong></p><ol><li><strong>æ— è¿æ¥çš„</strong>ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</li><li><strong>ä¸ä¿è¯å¯é äº¤ä»˜</strong>ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ä¸ºæ­¤å¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨</li><li><strong>é¢å‘æŠ¥æ–‡çš„</strong>ï¼Œæ„æ€æ˜¯ UDP å¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå‘ä¸‹äº¤ç»™ IP å±‚ã€‚</li><li><strong>æ²¡æœ‰é˜»å¡æ§åˆ¶</strong>ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿å‘é€æ–¹çš„å‘é€é€Ÿç‡é™ä½ã€‚</li><li><strong>æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</strong>ï¼Œä¹Ÿå³æ˜¯æä¾›å¹¿æ’­å’Œå¤šæ’­çš„åŠŸèƒ½ã€‚</li><li><strong>é¦–éƒ¨å¼€é”€å°</strong>ï¼Œé¦–éƒ¨åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œåˆ†ä¸ºå››éƒ¨åˆ†ã€‚</li></ol><p><strong>UDP çš„å¸¸ç”¨åœºæ™¯ï¼š</strong></p><ol><li>åå­—è½¬æ¢ï¼ˆDNSï¼‰</li><li>æ–‡ä»¶ä¼ é€ï¼ˆTFTPï¼‰</li><li>è·¯ç”±é€‰æ‹©åè®®ï¼ˆRIPï¼‰</li><li>IP åœ°å€é…ç½®ï¼ˆBOOTPï¼ŒDHTPï¼‰</li><li>ç½‘ç»œç®¡ç†ï¼ˆSNMPï¼‰</li><li>è¿œç¨‹æ–‡ä»¶æœåŠ¡ï¼ˆNFSï¼‰</li><li>IP ç”µè¯</li><li>æµå¼å¤šåª’ä½“é€šä¿¡</li></ol><h3 id="UDP-æŠ¥æ–‡ç»“æ„"><a href="#UDP-æŠ¥æ–‡ç»“æ„" class="headerlink" title="UDP æŠ¥æ–‡ç»“æ„"></a>UDP æŠ¥æ–‡ç»“æ„</h3><p>UDP æ•°æ®æŠ¥åˆ†ä¸ºæ•°æ®å­—æ®µå’Œé¦–éƒ¨å­—æ®µã€‚<br>é¦–éƒ¨å­—æ®µåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œç”±å››ä¸ªå­—æ®µç»„æˆï¼Œæ¯ä¸ªå­—æ®µçš„é•¿åº¦æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚</p><p><strong>é¦–éƒ¨å„å­—æ®µæ„ä¹‰</strong>ï¼š</p><ol><li><strong>æºç«¯å£</strong>ï¼šæºç«¯å£å·ï¼Œåœ¨éœ€è¦å¯¹æ–¹å›ä¿¡æ—¶é€‰ç”¨ï¼Œä¸éœ€è¦æ—¶å¯å…¨ 0.</li><li><strong>ç›®çš„ç«¯å£</strong>ï¼šç›®çš„ç«¯å£å·ï¼Œåœ¨ç»ˆç‚¹äº¤ä»˜æŠ¥æ–‡æ—¶å¿…é¡»è¦ä½¿ç”¨åˆ°ã€‚</li><li><strong>é•¿åº¦</strong>ï¼šUDP ç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦ï¼Œåœ¨åªæœ‰é¦–éƒ¨çš„æƒ…å†µï¼Œå…¶æœ€å°å€¼æ˜¯ 8 ã€‚</li><li><strong>æ£€éªŒå’Œ</strong>ï¼šæ£€æµ‹ UDP ç”¨æˆ·æ•°æ®æŠ¥åœ¨ä¼ è¾“ä¸­æ˜¯å¦æœ‰é”™ï¼Œæœ‰é”™å°±ä¸¢å¼ƒã€‚</li></ol><h3 id="UDP-å¦‚ä½•è¿›è¡Œæ ¡éªŒå’Œ"><a href="#UDP-å¦‚ä½•è¿›è¡Œæ ¡éªŒå’Œ" class="headerlink" title="UDP å¦‚ä½•è¿›è¡Œæ ¡éªŒå’Œ"></a>UDP å¦‚ä½•è¿›è¡Œæ ¡éªŒå’Œ</h3><h4 id="ä¼ªé¦–éƒ¨"><a href="#ä¼ªé¦–éƒ¨" class="headerlink" title="ä¼ªé¦–éƒ¨"></a>ä¼ªé¦–éƒ¨</h4><p>UDP æ•°æ®æŠ¥é¦–éƒ¨ä¸­æ£€éªŒå’Œçš„è®¡ç®—æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šã€‚<br>åœ¨è®¡ç®—æ£€éªŒå’Œæ—¶ï¼Œè¦åœ¨æ•°æ®æŠ¥ä¹‹å‰å¢åŠ  12 ä¸ªå­—èŠ‚çš„ä¼ªé¦–éƒ¨ï¼Œç”¨æ¥è®¡ç®—æ ¡éªŒå’Œã€‚<br>ä¼ªé¦–éƒ¨å¹¶ä¸æ˜¯æ•°æ®æŠ¥çœŸæ­£çš„é¦–éƒ¨ï¼Œæ˜¯ä¸ºäº†è®¡ç®—æ ¡éªŒå’Œè€Œä¸´æ—¶æ·»åŠ åœ¨æ•°æ®æŠ¥å‰é¢çš„ï¼Œåœ¨çœŸæ­£ä¼ è¾“çš„æ—¶å€™å¹¶ä¸ä¼šæŠŠä¼ªé¦–éƒ¨ä¸€å¹¶å‘é€ã€‚</p><p><strong>ä¼ªé¦–éƒ¨ä¸ªå­—æ®µæ„ä¹‰</strong>ï¼š</p><ol><li>ç¬¬ä¸€å­—æ®µï¼Œæº IP åœ°å€</li><li>ç¬¬äºŒå­—æ®µï¼Œç›®çš„ IP åœ°å€</li><li>ç¬¬ä¸‰å­—æ®µï¼Œå­—æ®µå…¨ 0</li><li>ç¬¬å››å­—æ®µï¼ŒIP é¦–éƒ¨ä¸­çš„åè®®å­—æ®µçš„å€¼ï¼Œå¯¹äº UDPï¼Œæ­¤å­—æ®µå€¼ä¸º 17</li><li>ç¬¬äº”å­—æ®µï¼ŒUDP ç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦</li></ol><h4 id="æ ¡éªŒå’Œè®¡ç®—æ–¹æ³•"><a href="#æ ¡éªŒå’Œè®¡ç®—æ–¹æ³•" class="headerlink" title="æ ¡éªŒå’Œè®¡ç®—æ–¹æ³•"></a>æ ¡éªŒå’Œè®¡ç®—æ–¹æ³•</h4><p>æ ¡éªŒå’Œçš„è®¡ç®—ä¸­ï¼Œé¢‘ç¹ç”¨åˆ°äº†äºŒè¿›åˆ¶çš„åç æ±‚å’Œè¿ç®—ï¼Œè¿ç®—è§„åˆ™è§ä¸‹ï¼š</p><p><strong>äºŒè¿›åˆ¶åç æ±‚å’Œè¿ç®—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 + 0 = 0</span><br><span class="line">1 + 0 = 0 + 1 = 1</span><br><span class="line">1 + 1 = 10</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ 10 ä¸­çš„ 1 åŠ åˆ°äº†ä¸‹ä¸€åˆ—å»ï¼Œå¦‚æœæ˜¯æœ€é«˜åˆ—çš„ 1 + 1 ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ 10 ç•™ä¸‹ 0 , 1 ç§»åˆ°æœ€ä½åˆ—ï¼Œä¸æœ€ä½ä½å†åšä¸€æ¬¡äºŒè¿›åˆ¶åŠ æ³•å³å¯ã€‚</p><p><strong>æ£€éªŒå’Œè®¡ç®—è¿‡ç¨‹</strong></p><ol><li>æŠŠé¦–éƒ¨çš„æ£€éªŒå’Œå­—æ®µè®¾ç½®ä¸ºå…¨ 0</li><li>æŠŠä¼ªé¦–éƒ¨ä»¥åŠæ•°æ®æ®µçœ‹æˆæ˜¯è®¸å¤š 16 ä½çš„å­—ä¸²æ¥èµ·æ¥ã€‚</li><li>è‹¥æ•°æ®æ®µä¸æ˜¯å¶æ•°ä¸ªå­—èŠ‚ï¼Œåˆ™å¡«å……ä¸€ä¸ªå…¨ 0 å­—èŠ‚ï¼Œä½†æ˜¯è¿™ä¸ªå­—èŠ‚ä¸å‘é€ã€‚</li><li>é€šè¿‡äºŒè¿›åˆ¶åç è¿ç®—ï¼Œè®¡ç®—å‡º 16 ä½å­—çš„å’Œã€‚<ol><li>è®©ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡ŒåšäºŒè¿›åˆ¶åç è¿ç®—ã€‚</li><li>å°†ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œçš„ç»“æœä¸ç¬¬ä¸‰è¡ŒåšäºŒè¿›åˆ¶åç è®¡ç®—ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ol></li><li>æœ€åè¿ç®—ç»“æœå–åï¼Œå¾—åˆ°æ ¡éªŒå’Œã€‚</li><li>æŠŠè®¡ç®—å‡ºæ¥çš„æ ¡éªŒå’Œå€¼ï¼Œå¡«å…¥é¦–éƒ¨æ ¡éªŒå’Œå­—æ®µã€‚</li></ol><p>æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®æŠ¥ä¹‹åï¼ŒæŒ‰ç…§åŒæ ·çš„æ–¹æ³•è®¡ç®—æ ¡éªŒå’Œï¼Œå¦‚æœæœ‰å·®é”™ï¼Œåˆ™ä¸¢å¼ƒè¿™ä¸ªæ•°æ®æŠ¥ã€‚</p><p>å¯ä»¥çœ‹å‡ºæ ¡éªŒå’Œï¼Œæ—¢æ£€æŸ¥äº† UDP ç”¨æˆ·æ•°æ®æŠ¥çš„æºç«¯å£å·å’Œç›®çš„ç«¯å£å·ä»¥åŠæ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ï¼Œåˆæ£€æŸ¥äº† IP æ•°æ®æŠ¥çš„æº IP åœ°å€å’Œç›®çš„åœ°å€ã€‚</p><p><strong>ä¸€ä¸ªæ ¡éªŒå’Œä¾‹å­</strong> </p><p>å‡è®¾ä¸€ä¸ª UDP æ•°æ®æŠ¥ï¼š</p><p>å„å­—æ®µä»¥äºŒè¿›åˆ¶è¡¨ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1001 1001 0001 0011 //ä¼ªé¦–éƒ¨æºIPåœ°å€å‰16ä½ï¼Œå€¼ï¼š153.19</span><br><span class="line">0000 1000 0110 1000 //ä¼ªé¦–éƒ¨æºIPåœ°å€å16ä½ï¼Œå€¼ï¼š8.104</span><br><span class="line">1010 1011 0000 0011 //ä¼ªé¦–éƒ¨ç›®çš„IPåœ°å€å‰16ä½ï¼Œå€¼ï¼š171.3</span><br><span class="line">0000 1110 0000 1011 //ä¼ªé¦–éƒ¨ç›®çš„IPåœ°å€å16ä½ï¼Œå€¼ï¼š14.11</span><br><span class="line">0000 0000 0001 0001 //ä¼ªé¦–éƒ¨UDPåè®®å­—æ®µä»£è¡¨å·ï¼Œå€¼ï¼š17</span><br><span class="line">0000 0000 0000 1111 //ä¼ªé¦–éƒ¨UDPé•¿åº¦å­—æ®µï¼Œå€¼ï¼š15</span><br><span class="line">0000 0100 0011 1111 //UDPå¤´éƒ¨æºIPåœ°å€å¯¹åº”çš„è¿›ç¨‹ç«¯å£å·ï¼Œå€¼ï¼š1087</span><br><span class="line">0000 0000 0000 1101 //UDPå¤´éƒ¨ç›®çš„IPåœ°å€å¯¹åº”çš„è¿›ç¨‹ç«¯å£å·ï¼Œå€¼ï¼š13</span><br><span class="line">0000 0000 0000 1111 //UDPå¤´éƒ¨UDPé•¿åº¦å­—æ®µï¼Œå€¼ï¼š15</span><br><span class="line">0000 0000 0000 0000 //UDPå¤´éƒ¨UDPæ£€éªŒå’Œï¼Œå€¼ï¼š0</span><br><span class="line">0101 0100 0100 0101 //æ•°æ®å­—æ®µ</span><br><span class="line">0101 0011 0101 0100 //æ•°æ®å­—æ®µ</span><br><span class="line">0100 1001 0100 1110 //æ•°æ®å­—æ®µ</span><br><span class="line">0100 0111 0000 0000 //æ•°æ®å­—æ®µ+å¡«å……0å­—æ®µ</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§äºŒè¿›åˆ¶åç è¿ç®—æ±‚å’Œï¼Œç»“æœï¼š<code>10010110 11101101</code><br>ç»“æœæ±‚åç å¾—å‡ºæ ¡éªŒå’Œï¼š<code>01101001 00010010</code></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP/IP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcpdumpæŠ“åŒ…mysqléªŒè¯ä¸‰æ¬¡æ¡æ‰‹</title>
      <link href="/2016/01/16/Linux/Linux%E9%87%8D%E7%9A%84tcpdump%E6%8A%93%E5%8C%85mysql%E9%AA%8C%E8%AF%81%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/"/>
      <url>/2016/01/16/Linux/Linux%E9%87%8D%E7%9A%84tcpdump%E6%8A%93%E5%8C%85mysql%E9%AA%8C%E8%AF%81%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/</url>
      
        <content type="html"><![CDATA[<p><code>TCP</code>çš„ä¸‰æ¬¡æ¡æ‰‹ã€4æ¬¡æŒ¥æ‰‹æ˜¯è€ç”Ÿå¸¸è°ˆçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå…·ä½“çš„åŒ…æ•°æ®ä¼ è¾“è¿‡ç¨‹ä½ æ˜¯å¦çœŸæ­£çš„è¯•è¿‡å‘¢ï¼Ÿæˆ‘ä»¬ä»Šå¤©å°±é€šè¿‡å…·ä½“çš„<code>mysql</code>å»ºè”å®è·µæ¥çœ‹çœ‹æ˜¯æ€ä¹ˆä¼ é€’æ•°æ®åŒ…çš„ã€‚</p><a id="more"></a><h2 id="ç½‘ç»œå—…æ¢å™¨å’Œtcpdump"><a href="#ç½‘ç»œå—…æ¢å™¨å’Œtcpdump" class="headerlink" title="ç½‘ç»œå—…æ¢å™¨å’Œtcpdump"></a>ç½‘ç»œå—…æ¢å™¨å’Œ<code>tcpdump</code></h2><p>åœ¨å…±äº«å¼çš„ç½‘ç»œä¸­ï¼Œæ•°æ®çš„ä¼ è¾“æ˜¯æ€ä¹ˆå®Œæˆçš„å‘¢ï¼Ÿåˆæ˜¯æ€ä¹ˆæ‰¾åˆ°å¯¹åº”çš„æœºå™¨æ¥è¿›è¡Œæ•°æ®äº¤äº’çš„å‘¢ï¼Ÿ</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç½‘ç»œä¸­ï¼Œä¿¡æ¯æŠ¥ä¼šå¹¿æ’­åˆ°ç½‘ç»œä¸­æ‰€æœ‰ä¸»æœºçš„ç½‘ç»œæ¥å£ï¼Œä¸»æœºçš„ç½‘ç»œè®¾å¤‡é€šè¿‡IPå’ŒMACåœ°å€ç­‰ä¿¡æ¯åˆ¤æ–­è¯¥ä¿¡æ¯åŒ…æ˜¯å¦åº”è¯¥æ¥æ”¶ï¼Œé€šè¿‡æŠ›å¼ƒä¸è‡ªå·±æ— å…³çš„æ•°æ®åŒ…ï¼Œè¿™æ ·å°±è¾¾åˆ°äº’è”ç½‘ä¸­æˆ‘ä»¬ä¸æŒ‡å®šæœºå™¨é€šä¿¡çš„ç›®çš„ã€‚</p><p>ä½†æ˜¯åœ¨ä¼—å¤šçš„é»‘å®¢æŠ€æœ¯ä¸­ï¼Œå—…æ¢å™¨<code>ï¼ˆsnifferï¼‰</code>æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„æŠ€æœ¯ï¼Œå®ƒä½¿ä¸»æœºçš„ç½‘ç»œè®¾å¤‡æ¥æ”¶æ‰€æœ‰åˆ°è¾¾çš„ä¿¡æ¯åŒ…ï¼Œä»è€Œè¾¾åˆ°ç½‘ç»œç›‘å¬çš„ç›®çš„ã€‚åœ¨å…±äº«å¼çš„å±€åŸŸç½‘ä¸­ï¼Œå—…æ¢å™¨å¯ä»¥å¯¹è¯¥ç½‘ç»œä¸­çš„æµé‡ä¸€è§ˆæ— ä½™ã€‚é™¤äº†é»‘å®¢ï¼Œç½‘ç»œç®¡ç†å‘˜ä¹Ÿåº”è¯¥å­¦ä¼šä½¿ç”¨å—…æ¢å™¨æ¥éšæ—¶æŒæ¡ç½‘ç»œçš„ä½¿ç”¨æƒ…å†µï¼Œåœ¨ç½‘ç»œæ€§èƒ½æ€¥å‰§ä¸‹é™æ—¶ï¼Œæ‰¾åˆ°ç½‘ç»œé˜»å¡å’Œé—®é¢˜çš„æ ¹æºã€‚</p><p>å…·ä½“çš„å—…æ¢å™¨å·¥å…·åœ¨<code>Windows</code>å¹³å°ä¸Šæœ‰<code>netxray</code>å’Œ<code>sniffer pro</code>è½¯ä»¶ï¼Œåœ¨<code>Linux</code>å¹³å°ä¸Šæœ‰<code>tcpdump</code>ã€‚æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„å°±æ˜¯<code>tcpdump sniffer</code>å—…æ¢å™¨å·¥å…·ã€‚</p><h2 id="å®‰è£…tcpdump"><a href="#å®‰è£…tcpdump" class="headerlink" title="å®‰è£…tcpdump"></a>å®‰è£…<code>tcpdump</code></h2><p><code>tcpdump</code>æ˜¯<code>Linux</code>å¹³å°ä¸€ä¸ªä»¥å‘½ä»¤è¡Œæ–¹å¼è¿è¡Œçš„ç½‘ç»œæµé‡æ£€æµ‹å·¥å…·ï¼Œå®ƒèƒ½æˆªè·ç½‘å¡ä¸Šæ”¶åˆ°çš„æ•°æ®åŒ…ï¼Œå¹¶é€šè¿‡ä¸€å®šçš„é…ç½®æ¥å®Œæˆå¯¹å†…å®¹çš„è§£æå’Œåˆ†æã€‚</p><p>æ£€æµ‹ç³»ç»Ÿä¸­æ˜¯å¦å·²ç»å®‰è£…äº†<code>tcpdump</code>çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œå°±æ˜¯ç›´æ¥æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump</span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰å®‰è£…</span></span><br><span class="line">tcpdump: no suitable device found</span><br><span class="line"><span class="comment"># å¦‚æœå·²ç»å®‰è£…ï¼Œåˆ™å½“æœ‰ç½‘ç»œè¯·æ±‚æ—¶ä¼šå‡ºç°è®¸å¤šçš„è¿™ç§ç½‘ç»œè§£ææ•°æ®</span></span><br><span class="line">21:44:14.109590 IP client.host &gt; server.host: Flags [P.], seq 1031520:1031984, ack 1393, win 95, options [nop,nop,TS val 2242702304 ecr 3381086780], length 464</span><br></pre></td></tr></table></figure><p>æœ€æ–°çš„<code>tcpdump</code>æºç ä¸‹è½½åœ°å€ï¼š<a href="http://www.tcpdump.org/">http://www.tcpdump.org</a> ï¼ˆtcpdumpå®˜ç½‘ï¼‰</p><blockquote><p><code>tcpdump</code>çš„è¿è¡Œéœ€è¦<code>pcap</code>çš„æ”¯æŒï¼Œè¯·åŒæ—¶ä¸‹è½½è¿™ä¸¤ä¸ªå†…å®¹å¹¶å®‰è£…ï¼Œä¸€èˆ¬æœ€æ–°ç‰ˆæœ¬çš„ä¸¤è€…æ˜¯äº’ç›¸å…¼å®¹çš„ã€‚</p></blockquote><p>ç¬”è€…æœ¬æ¬¡ä¸‹è½½çš„æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨wgetä¸‹è½½å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½tcpdumpæ–‡ä»¶</span></span><br><span class="line">$ wget www.tcpdump.org/release/tcpdump-4.9.2.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½pcapæ–‡ä»¶</span></span><br><span class="line">$ wget www.tcpdump.org/release/libpcap-1.9.0.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libpcapï¼Œmake installçš„æ—¶å€™å¯èƒ½éœ€è¦rootæƒé™</span></span><br><span class="line">$ tar -zxvf libpcap-1.9.0.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> libpcap-1.9.0.tar.gz</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…tcpdumpçš„è¿‡ç¨‹</span></span><br><span class="line">$ tar -zxvf tcpdump-4.9.2</span><br><span class="line">$ <span class="built_in">cd</span> tcpdump-4.9.2</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåè·Ÿä¸Šé¢ä¸€æ ·è¾“å…¥<code>tcpdump</code>åˆ¤æ–­æ˜¯å¦æˆåŠŸå®‰è£…äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump</span><br></pre></td></tr></table></figure><h2 id="tcpdumpçš„å‘½ä»¤è¡Œå‚æ•°å’Œè¿‡æ»¤è§„åˆ™"><a href="#tcpdumpçš„å‘½ä»¤è¡Œå‚æ•°å’Œè¿‡æ»¤è§„åˆ™" class="headerlink" title="tcpdumpçš„å‘½ä»¤è¡Œå‚æ•°å’Œè¿‡æ»¤è§„åˆ™"></a><code>tcpdump</code>çš„å‘½ä»¤è¡Œå‚æ•°å’Œè¿‡æ»¤è§„åˆ™</h2><p><code>tcpdump</code>æ˜¯ä¸ªå‘½ä»¤è¡Œæ–¹å¼çš„ç½‘ç»œå—…æ¢å™¨ï¼Œå¦‚æœä¸ä½¿ç”¨ä»»ä½•å‚æ•°ï¼Œä¼šæŒç»­æ•è·æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚å†…å®¹ï¼Œæ— æ³•æœ‰æ•ˆåˆ†æï¼Œå¯ä»¥é’ˆå¯¹è‡ªå·±çš„éœ€æ±‚ä½¿ç”¨åˆé€‚çš„å‚æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°å†…å®¹</span></span><br><span class="line">$ tcpdump --<span class="built_in">help</span></span><br><span class="line">tcpdump version 4.9.2</span><br><span class="line">libpcap version 1.9.0-PRE-GIT (with TPACKET_V2)</span><br><span class="line">OpenSSL 1.0.0-fips 29 Mar 2010</span><br><span class="line">Usage: tcpdump [-aAbdDefhHIJKlLnNOpqStuUvxX<span class="comment">#] [ -B size ] [ -c count ]</span></span><br><span class="line">                [ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]</span><br><span class="line">                [ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]</span><br><span class="line">                [ -Q <span class="keyword">in</span>|out|inout ]</span><br><span class="line">                [ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]</span><br><span class="line">                [ --immediate-mode ] [ -T <span class="built_in">type</span> ] [ --version ] [ -V file ]</span><br><span class="line">                [ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]</span><br><span class="line">                [ -Z user ] [ expression ]</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„å‚æ•°å«ä¹‰ï¼š</p><ul><li><code>-a</code> å°†ç½‘ç»œåœ°å€è½¬å˜ä¸ºæ˜“è¯†åˆ«çš„ä¸»æœºåï¼ˆé»˜è®¤ï¼‰</li><li><code>-n</code> ä¸å°†ç½‘ç»œåœ°å€è½¬å˜ä¸ºæ˜“è¯†åˆ«çš„ä¸»æœºåï¼Œå³ç›´æ¥æ˜¾ç¤ºIPåœ°å€ï¼Œå¯ä»¥çœç•¥DNSæŸ¥è¯¢</li><li><code>-nn</code> ä¸è¿›è¡Œç«¯å£åç§°çš„è½¬æ¢</li><li><code>-t</code> ä¸æ˜¾ç¤ºæ—¶é—´æˆ³</li><li><code>-tttt</code> è¾“å‡ºç”±dateå¤„ç†åçš„æ—¶é—´æˆ³</li><li><code>-c</code> æ•è·æŒ‡å®šæ•°é‡çš„æ•°æ®åŒ…åé€€å‡º</li><li><code>-e</code> æ˜¾ç¤ºæ•°æ®é“¾è·¯å±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå³MACåœ°å€ä¿¡æ¯ï¼š<code>00:8c:fa:f3:e3:04 (oui Unknown) &gt; 00:e0:ec:3e:8d:39 (oui Unknown), ethertype IPv4 (0x0800), length 71</code></li><li><code>-f</code> å°†ç›®æ ‡çš„internetåœ°å€ä»¥IPå½¢å¼å±•ç¤º</li><li><code>-i</code> ç›‘å¬æŒ‡å®šçš„ç½‘ç»œæ¥å£</li><li><code>-S</code> å°†tcpçš„åºå·ä»¥ç»å¯¹å€¼å½¢å¼è¾“å‡ºï¼Œè€Œä¸æ˜¯ç›¸å¯¹å€¼</li><li><code>-r</code> ä»æŒ‡å®šæ–‡æ¡£ä¸­è¯»å–æ•°æ®åŒ…</li><li><code>-w</code> ä¸åˆ†æå’Œè¾“å‡ºï¼Œå°†æˆªè·çš„æ•°æ®åŒ…å†™å…¥æŒ‡å®šæ–‡æ¡£</li><li><code>-T</code> å°†æˆªè·çš„æ•°æ®åŒ…æŒ‰æŒ‡å®šç±»å‹æŠ¥æ–‡è§£æï¼Œå¦‚ï¼š<code>cnfp/rpc/rtp/snmp/vat/wb</code></li><li><code>-F</code> ä»æŒ‡å®šæ–‡æ¡£è¯»å–è¿‡æ»¤è§„åˆ™ï¼Œå¿½ç•¥å‘½ä»¤è¡Œçš„å…¶ä»–å‚æ•°æŒ‡å®šçš„è¿‡æ»¤è§„åˆ™</li><li><code>-v</code> è¾“å‡ºè¾ƒè¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚IPåŒ…çš„TTLå’Œåè®®ç±»å‹</li><li><code>-vv</code> è¾“å‡ºè¯¦ç»†çš„ä¿¡æ¯</li><li><code>-l</code> å°†æ ‡å‡†è¾“å‡ºè½¬å˜ä¸ºè¡Œç¼“å†²æ–¹å¼</li><li><code>-d</code> å°†ä¸Šæ¬¡æ•è·çš„ä¿¡æ¯åŒ…ä»¥æ±‡ç¼–æ ¼å¼æ˜¾ç¤º</li><li><code>-dd</code> å°†ä¸Šæ¬¡æ•è·çš„ä¿¡æ¯åŒ…ä»¥Cè¯­è¨€æ ¼å¼æ˜¾ç¤º</li><li><code>-ddd</code> å°†ä¸Šæ¬¡æ•è·çš„ä¿¡æ¯åŒ…ä»¥åè¿›åˆ¶æ ¼å¼æ˜¾ç¤º</li></ul><p>é™¤äº†å‚æ•°ä¹‹å¤–ï¼Œæ›´é‡è¦çš„æ˜¯è¿‡æ»¤è¡¨è¾¾å¼ï¼ŒåŒ…å«ä¸‰ä¸ªç±»å‹å…³é”®å­—ï¼š</p><ul><li><code>host: 10.10.13.15</code> ç›‘å¬çš„ä¸»æœº</li><li><code>net: 10.10.0.0</code> ç›‘å¬çš„ç½‘ç»œ</li><li><code>port: 21</code> ç›‘å¬çš„ç«¯å£</li></ul><p>å››ä¸ªæˆªè·æ–¹å‘å…³é”®å­—ï¼š</p><ul><li><code>dst: 10.10.13.15</code> ç›®æ ‡ä¸»æœº</li><li><code>src: 10.10.0.0</code> æºç½‘ç»œ</li><li><code>dst and src</code></li><li><code>dst or src</code>ï¼ˆç¼ºçœå€¼ï¼‰</li></ul><p>å¤šä¸ªåè®®å…³é”®å­—ï¼š<code>ether/fddi/tr/ip/ip6/rarp/decnet/tcp/udp</code>ã€‚</p><p>è¿˜æ”¯æŒç»„åˆè¡¨è¾¾å¼ï¼š<code>not/!/and/&amp;&amp;/or/||</code>ã€‚</p><p>ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªæ•è·æŒ‡å®šIPçš„æ•°æ®åŒ…</span></span><br><span class="line">$ tcpdump host 10.10.13.15</span><br><span class="line"><span class="comment"># æ•è·ä¸¤ä¸ªIPçš„æ•°æ®åŒ…</span></span><br><span class="line">$ tcpdump host 1010.13.15 and \(10.10.13.47\)</span><br><span class="line"><span class="comment"># æ•è·æŒ‡å®šç«¯å£å’Œåè®®çš„æ•°æ®åŒ…</span></span><br><span class="line">$ tcpdump tcp port 21 and host 10.10.13.15</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹æµ‹è¯•"><a href="#å®ä¾‹æµ‹è¯•" class="headerlink" title="å®ä¾‹æµ‹è¯•"></a>å®ä¾‹æµ‹è¯•</h2><blockquote><p>è¿™ä¸ªå®ä¾‹æ˜¯Aæœºå™¨<code>ï¼ˆclientï¼‰</code>å‘Bæœºå™¨<code>ï¼ˆserverï¼‰</code>å‘èµ·<code>mysql</code>å®ä¾‹è¿æ¥ï¼Œå¹¶ç«‹åˆ»<code>exit</code>çš„åœºæ™¯ã€‚</p></blockquote><p>æ­¥éª¤ï¼š</p><ol><li>Aæœºå™¨å¯åŠ¨å—…æ¢å™¨ï¼š<code>tcpdump host 10.92.143.15 -tttt -S -nn</code></li><li>Aæœºå™¨æ‰§è¡Œ<code>mysql -u root -h 10.92.143.15 -p</code></li><li>Aæœºå™¨æ•°æ®åº“è¿æ¥æˆåŠŸåï¼Œç«‹åˆ»<code>exit;</code>é€€å‡º<code>mysql</code>å®ä¾‹è¿æ¥</li></ol><p>æŠ¥æ–‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…¶ä¸­Sä»£è¡¨Synï¼Œ.ä»£è¡¨Ackï¼ŒS.ä»£è¡¨Syn, Ack</span></span><br><span class="line">2018-08-19 22:52:42.768100 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [S], seq 864854527, win 14600, options [mss 1460,sackOK,TS val 2246810963 ecr 0,nop,wscale 8], length 0</span><br><span class="line">2018-08-19 22:52:42.810055 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [S.], seq 4288771247, ack 864854528, win 14480, options [mss 1460,sackOK,TS val 2062159250 ecr 2246810963,nop,wscale 8], length 0</span><br><span class="line">2018-08-19 22:52:42.810065 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [.], ack 4288771248, win 58, options [nop,nop,TS val 2246811005 ecr 2062159250], length 0</span><br><span class="line"><span class="comment"># ç™»å½•æ ¡éªŒï¼Œä¼ è¾“ç”¨æˆ·åå’Œå¯†ç éªŒè¯é˜¶æ®µï¼Œå…¶ä¸­Pä»£è¡¨Pushï¼Œä¼ è¾“æ•°æ®éœ€è¦ã€‚è¿™é‡ŒåŒ…å«ç™»å½•éªŒè¯å’Œç‰ˆæœ¬ä¿¡æ¯ç­‰å…ƒæ•°æ®çš„äº¤æ¢</span></span><br><span class="line">2018-08-19 22:52:42.852102 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [P.], seq 4288771248:4288771308, ack 864854528, win 57, options [nop,nop,TS val 2062159292 ecr 2246811005], length 60</span><br><span class="line">2018-08-19 22:52:42.852118 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [.], ack 4288771308, win 58, options [nop,nop,TS val 2246811047 ecr 2062159292], length 0</span><br><span class="line">2018-08-19 22:52:42.853251 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [P.], seq 864854528:864854590, ack 4288771308, win 58, options [nop,nop,TS val 2246811048 ecr 2062159292], length 62</span><br><span class="line">2018-08-19 22:52:42.895198 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [.], ack 864854590, win 57, options [nop,nop,TS val 2062159335 ecr 2246811048], length 0</span><br><span class="line">2018-08-19 22:52:42.895256 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [P.], seq 4288771308:4288771319, ack 864854590, win 57, options [nop,nop,TS val 2062159335 ecr 2246811048], length 11</span><br><span class="line">2018-08-19 22:52:42.895264 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [.], ack 4288771319, win 58, options [nop,nop,TS val 2246811090 ecr 2062159335], length 0</span><br><span class="line">2018-08-19 22:52:42.895312 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [P.], seq 864854590:864854627, ack 4288771319, win 58, options [nop,nop,TS val 2246811090 ecr 2062159335], length 37</span><br><span class="line">2018-08-19 22:52:42.937268 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [.], ack 864854627, win 57, options [nop,nop,TS val 2062159377 ecr 2246811090], length 0</span><br><span class="line">2018-08-19 22:52:42.937405 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [P.], seq 4288771319:4288771409, ack 864854627, win 57, options [nop,nop,TS val 2062159377 ecr 2246811090], length 90</span><br><span class="line">2018-08-19 22:52:42.937414 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [.], ack 4288771409, win 58, options [nop,nop,TS val 2246811132 ecr 2062159377], length 0</span><br><span class="line"><span class="comment"># å‘é€exitï¼›æ­£å¥½5ä¸ªå­—ç¬¦</span></span><br><span class="line">2018-08-19 22:52:44.366633 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [P.], seq 864854627:864854632, ack 4288771409, win 58, options [nop,nop,TS val 2246812561 ecr 2062159377], length 5</span><br><span class="line"><span class="comment"># å››æ¬¡æŒ¥æ‰‹ï¼Œå…¶ä¸­Fä»£è¡¨FINï¼Œå®Œæˆæ•°æ®å‘é€</span></span><br><span class="line">2018-08-19 22:52:44.366649 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [F.], seq 864854632, ack 4288771409, win 58, options [nop,nop,TS val 2246812561 ecr 2062159377], length 0</span><br><span class="line"><span class="comment">## è¿™ä¸ªæ˜¯exitçš„ç­”å¤</span></span><br><span class="line">2018-08-19 22:52:44.408575 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [.], ack 864854632, win 57, options [nop,nop,TS val 2062160848 ecr 2246812561], length 0</span><br><span class="line">2018-08-19 22:52:44.408618 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [.], ack 864854633, win 57, options [nop,nop,TS val 2062160848 ecr 2246812561], length 0</span><br><span class="line">2018-08-19 22:52:44.408652 IP 10.92.143.15.3306 &gt; 10.119.124.24.45298: Flags [F.], seq 4288771409, ack 864854633, win 57, options [nop,nop,TS val 2062160848 ecr 2246812561], length 0</span><br><span class="line">2018-08-19 22:52:44.408657 IP 10.119.124.24.45298 &gt; 10.92.143.15.3306: Flags [.], ack 4288771410, win 58, options [nop,nop,TS val 2246812603 ecr 2062160848], length 0</span><br></pre></td></tr></table></figure><blockquote><p>å…·ä½“çš„<code>mysql</code>é€šä¿¡å†…å®¹å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://jin-yang.github.io/post/mysql-protocol.html">https://jin-yang.github.io/poâ€¦</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> TCP/IP </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨jsDelivræ¥æ”¹å–„ç½‘ç«™å“åº”é€Ÿåº¦</title>
      <link href="/2016/01/13/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E4%B9%8BjsDelivr%E4%BD%BF%E7%94%A8/"/>
      <url>/2016/01/13/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E4%B9%8BjsDelivr%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ ‘è“æ´¾ä¸Šçš„æœåŠ¡æ£€æµ‹è„šæœ¬å¿½ç„¶å‘Šè­¦äº†ï¼Œåšå®¢å‡ºç°äº†å¤§é‡èµ„æºdownæ‰çš„æƒ…å†µï¼Œèµ¶ç´§ä¸Šçº¿æŸ¥çœ‹ï¼Œé¡µé¢éƒ½åˆ·ä¸å‡ºæ¥ï¼ŒåŸæ¥æ˜¯<code>cdn.bootcss.com</code>è¿™ä¸ªCDN downæ‰äº†ï¼Œæˆ‘çš„<code>jquery</code>,<code>fontawesome</code>ç­‰JSåº“è¿˜æœ‰ä¸€äº›CSSåº“éƒ½å¼•ç”¨è¿™ä¸ªCDNå¯¼è‡´é¡µé¢å´©åã€‚å‘çˆ¹å‘¢  (ï¼›ï¿£Ğ”ï¿£ï¼‰</p><p>æˆ‘å¿ƒä¸­é¡¿æ—¶å‡ºç°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç»´æŠ¤ä¸€ä¸ªCDNåˆ—è¡¨ï¼Œç„¶åæœåŠ¡å™¨ä¸Šè·‘ä¸€ä¸ªæ€§èƒ½ç›‘æµ‹è„šæœ¬ï¼Œå¯¹è¿™äº›CDNè¿›è¡Œå¯è¾¾æ€§å’Œæ€§èƒ½æµ‹è¯•ï¼Œç„¶ååœ¨ç½‘ç«™é‡Œå»æ ¹æ®è¿™ä¸ªè„šæœ¬åŠ¨æ€ä¿®æ”¹ä¾èµ–çš„CDNã€‚</p><p>ç­‰ç­‰å¥½åƒæœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒæœåŠ¡å™¨ä¸Šè¿›è¡Œæ€§èƒ½ç›‘æµ‹å¥½åƒæ²¡å•¥åµç”¨å•Šï¼Œæˆ‘ä»¬è¦ä¿è¯å®¢æˆ·ç«¯å¯è¾¾ï¼Œè¿™ä¸ªå¥½åƒæ˜¯CDNè¦åšçš„å·¥ä½œå•Šã€‚</p><p>éš¾é“è¦åœ¨å®¢æˆ·ç«¯å»è·‘è¿™ä¸ªè„šæœ¬ï¼Ÿ =ÍŸÍŸÍÍ(ê’ªâŒ“ê’ª*) ç®—äº†ç®—äº†è¿˜æ˜¯æœä¸€ä¸ªé è°±çš„CDNå§ã€‚</p><p>åœ¨StackOverflowæœç´¢äº†ä¸€ä¸‹å‘ç°æœ‰äººæ¨è<a href="https://www.jsdelivr.com/">jsDelivr</a>ä½œä¸ºCDNã€‚</p><p>è¯•éªŒäº†ä¸€ä¸‹ï¼Œå‘ç°æ•ˆæœç›¸å½“ç»™åŠ›ã€‚æ¨èä¸€ä¸‹ï½</p><a id="more"></a><h2 id="What-is-jsDelivr"><a href="#What-is-jsDelivr" class="headerlink" title="What is jsDelivr"></a>What is jsDelivr</h2><blockquote><p>jsDelivr - Open Source CDN free fast and reliable</p></blockquote><p>å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„CDNï¼Œé€šè¿‡</p><h2 id="How-it-work"><a href="#How-it-work" class="headerlink" title="How it work"></a>How it work</h2><p>å®˜ç½‘ä¸Šæœ‰ä¸€å¼ åŸç†çš„ç®€è¦ä»‹ç»</p><p><img src= "/img/loading2.gif" data-lazy-src="https://www.jsdelivr.com/img/network/infographics.png?v=d4a4024db2475bb20dc7a8166d98130a51606502" alt="img"></p><p>jsDelivré€šè¿‡å¤šä¸ªCDNæœåŠ¡å•†å¯¹å…¨çƒç”¨æˆ·æä¾›é«˜æ€§èƒ½çš„å†…å®¹åˆ†å‘æœåŠ¡ï¼Œå…¶ä¸­å¯¹ä¸­å›½çº¿è·¯åšäº†ç‰¹åˆ«ä¼˜åŒ–ã€‚æ•´ä¸ªå¤§é™†åœ°åŒºæœ‰è¶…è¿‡600ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ã€‚é»˜è®¤ä½¿ç”¨<a href="https://www.cedexis.com/">cedexis</a>æä¾›çš„æ™ºèƒ½è´Ÿè½½å‡è¡¡æœåŠ¡æ¥è¿›è¡ŒCDNé€‰æ‹©ï¼Œå¦‚æœcedexisæŒ‚æ‰ï¼Œåˆ™é»˜è®¤é€‰æ‹©StackPath CDNæˆ–CloudFlare CDNã€‚å¦‚æœè¯·æ±‚å†…å®¹æœªå‘½ä¸­jsDelivrçš„ç¼“å­˜ï¼Œåˆ™å»ä¸Šæ¸¸çš„Amazon S3å¯¹è±¡å­˜å‚¨æœåŠ¡æŸ¥æ‰¾èµ„æºï¼ŒAmazon S3æœåŠ¡ä¹Ÿä¼šåŒæ­¥æœ€ç»ˆæ¥è‡ªäºnpmå’ŒGithubçš„æºæ–‡ä»¶ã€‚å¦‚æœAmazon S3æœåŠ¡downæ‰ï¼ŒjsDelivråˆ™æŠŠè¯·æ±‚ç›´æ¥è½¬å‘ç»™å­˜å‚¨æºæ–‡ä»¶çš„npmå’Œgithubã€‚</p><p>æ€»ä¹‹ï¼ŒjsDelivræœ‰ä¼—å¤šçš„è¾¹ç¼˜æœåŠ¡èŠ‚ç‚¹ï¼Œå¯¹ä¸­å›½å¤§é™†æœåŠ¡å‹å¥½ï¼Œå¹¶æœ‰å®•æœºå¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œä¿è¯äº†CDNçš„å¯è¾¾æ€§å’Œæ€§èƒ½ã€‚</p><h2 id="Performance-test"><a href="#Performance-test" class="headerlink" title="Performance test"></a>Performance test</h2><p>æˆ‘ä»¬åˆ©ç”¨<a href="http://www.17ce.com/site">17ce</a>è¿™ä¸ªæµ‹é€Ÿå·¥å…·æ¥æµ‹é‡jsDelivrçš„æ€§èƒ½ã€‚</p><p>é€Ÿåº¦è¿˜æ˜¯ç›¸å½“ç»™åŠ›çš„ã€‚</p><h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h2><p>jsDelivræä¾›äº†ä¸‰ç§CDNæœåŠ¡æ–¹å¼ï¼šnpmï¼Œgithubå’Œwordpressã€‚æˆ‘ä»¬ç€é‡è®²è®²githubçš„æ–¹å¼ã€‚</p><p>githubæ–¹å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// load any GitHub release or commit</span><br><span class="line">// note: we recommend using npm for projects that support it</span><br><span class="line">https://cdn.jsdelivr.net/gh/user/repo@version/file</span><br><span class="line"></span><br><span class="line">// load jQuery v3.2.1</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js</span><br><span class="line"></span><br><span class="line">// use a version range instead of a specific version</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2/dist/jquery.min.js</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3/dist/jquery.min.js</span><br><span class="line"></span><br><span class="line">// omit the version completely to get the latest one</span><br><span class="line">// you should NOT use this in production</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery/dist/jquery.min.js</span><br><span class="line"></span><br><span class="line">// add &quot;.min&quot; to any JS/CSS file to get a minified version</span><br><span class="line">// if one doesn&#x27;t exist, we&#x27;ll generate it for you</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/src/core.min.js</span><br><span class="line"></span><br><span class="line">// add / at the end to get a directory listing</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery/</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘ä»¬æƒ³è¦<code>pangu</code>çš„ç‰ˆæœ¬å·ä¸º3.3.0çš„<code>pangu.min.js</code>æ’ä»¶çš„CDNåœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å»<a href="https://github.com/vinta/pangu.js">panguçš„githubé¡µé¢</a>ï¼Œ</p><p>ä»commitså†å²æˆ–releasesä¸­æŸ¥æ‰¾3.3.0ç‰ˆæœ¬ï¼ŒæŸ¥çœ‹æ–‡ä»¶å¹¶æœç´¢<code>pangu.min.js</code>çš„ç›¸å¯¹è·¯å¾„</p><p>å…¶è·¯å¾„æ˜¯<code>dist/browser/pangu.min.js</code>ï¼Œæ ¹æ®ä½œè€…åç§°å’Œrepo ååˆ†åˆ«æ˜¯<code>vinta/pangu.js</code>ã€‚æ‰€ä»¥å¼•ç”¨è·¯å¾„æ˜¯</p><p><code>https://cdn.jsdelivr.net/gh/vinta/pangu.js@3.3.0/dist/browser/pangu.min.js</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹è¿™ä¸ªåœ°å€æµ‹é€Ÿã€‚</p><p>awesomeï¼æŠŠå®ƒæ”¾åœ¨æˆ‘ä»¬é¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CDN </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOSç”Ÿäº§åŠ›ä¹‹â€”â€”Terminalå‘½ä»¤</title>
      <link href="/2016/01/05/%E5%B7%A5%E5%85%B7/%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7%E4%B9%8BmacOS%E7%9A%84%E5%AE%9E%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2016/01/05/%E5%B7%A5%E5%85%B7/%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7%E4%B9%8BmacOS%E7%9A%84%E5%AE%9E%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸‹å¸¸ç”¨çš„macOSå‘½ä»¤ã€‚<br><a id="more"></a></p><p>&nbsp;</p><h2 id="open-æ‰“å¼€æ–‡ä»¶ã€ç›®å½•æˆ–æ‰§è¡Œç¨‹åº"><a href="#open-æ‰“å¼€æ–‡ä»¶ã€ç›®å½•æˆ–æ‰§è¡Œç¨‹åº" class="headerlink" title="open - æ‰“å¼€æ–‡ä»¶ã€ç›®å½•æˆ–æ‰§è¡Œç¨‹åº"></a>open - æ‰“å¼€æ–‡ä»¶ã€ç›®å½•æˆ–æ‰§è¡Œç¨‹åº</h2><p><code>open</code>å…¶å®ç­‰åŒäºæˆ‘ä»¬åœ¨GUIä¸‹é¢æ‰§è¡ŒåŒå‡»å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">open /Applications/Dictionary.app <span class="comment">#Dictionaryåº”ç”¨ </span></span><br><span class="line">open ~/Movies <span class="comment">#å¼€å½“å‰ç”¨æˆ·Moviesç›®å½•</span></span><br><span class="line"></span><br><span class="line">touch ~/1.txt <span class="comment">#åˆ›å»º1.txt</span></span><br><span class="line">open -e ~/1.txt <span class="comment">#æ‰“å¼€1.txtå¹¶ç”¨TextEditç¼–è¾‘</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æŠŠæ–‡ä»¶å¤¹æ‹–å…¥Terminalå°±ä¼šåœ¨å‘½ä»¤è¡Œç›´æ¥å‡ºç°è¯¥æ–‡ä»¶å¤¹è·¯å¾„ã€‚</p><p>&nbsp;</p><h2 id="say-æ–‡å­—è½¬è¯­éŸ³"><a href="#say-æ–‡å­—è½¬è¯­éŸ³" class="headerlink" title="say - æ–‡å­—è½¬è¯­éŸ³"></a>say - æ–‡å­—è½¬è¯­éŸ³</h2><p><code>say</code>æ˜¯å‘½ä»¤è¡Œä¸Šçš„VoiceOverï¼š</p><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ </span>say <span class="comment">&quot;Never trust a computer you can&#x27;t lift.&quot;</span></span><br></pre></td></tr></table></figure><p>ç”¨<code>-f</code>é€‰é¡¹æœ—è¯»ç‰¹å®šæ–‡æœ¬æ–‡ä»¶ï¼Œ<code>-o</code>é€‰é¡¹å°†æœ—è¯»ç»“æœå­˜ä¸ºéŸ³é¢‘æ–‡ä»¶è€Œä¸æ˜¯æ’­æ”¾ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> say <span class="operator">-f</span> mynovel.txt <span class="literal">-o</span> myaudiobook.aiff</span><br></pre></td></tr></table></figure><p><code>say</code>å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨äºåœ¨è„šæœ¬ä¸­æ’­æ”¾è­¦å‘Šæˆ–æç¤ºå¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®ï¼ˆSystem Preferencesï¼‰çš„å­—å…¸å’Œè¯­éŸ³ï¼ˆDictation &amp; Speechï¼‰é€‰é¡¹ä¸­è°ƒæ•´ç³»ç»Ÿçš„è¯­éŸ³é€‰é¡¹ç”šè‡³æ˜¯è¯­éŸ³çš„è¯­è¨€ã€‚</p><p>&nbsp;</p><h2 id="screencapture-æˆªå›¾"><a href="#screencapture-æˆªå›¾" class="headerlink" title="screencapture - æˆªå›¾"></a>screencapture - æˆªå›¾</h2><p><code>screencapture</code>å®é™…ä¸Šå°±æ˜¯å‘½ä»¤è¡Œä¸Šçš„Grab.appã€‚</p><p>å…¨å±å¹•æˆªå›¾ï¼Œå¹¶ä¿å­˜ä¸ºimage.pngï¼Œä½œä¸ºæ–°é‚®ä»¶çš„é™„ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screencapture -C -M image.png </span><br></pre></td></tr></table></figure><p>é¼ æ ‡é€‰æ‹©æŠ“å–èŒƒå›´å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screencapture -c -W</span><br></pre></td></tr></table></figure><p>å»¶è¿Ÿ10ç§’æˆªå±ï¼Œç”¨preview.appæ‰“å¼€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screencapture -T 10 -P image.png</span><br></pre></td></tr></table></figure><p>é¼ æ ‡é€‰æ‹©æŠ“å–èŒƒå›´ä¿å­˜åˆ°image.pdfæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screencapture -s -t pdf image.pdf</span><br></pre></td></tr></table></figure><p>æ›´å¤šç”¨æ³•å¯ä»¥å‚é˜…<code>screencapture --help</code>ã€‚</p><p>&nbsp;</p><h2 id="pbcopy-pbpaste-ç›´æ¥ä¸ç³»ç»Ÿå‰ªè´´æ¿äº¤äº’"><a href="#pbcopy-pbpaste-ç›´æ¥ä¸ç³»ç»Ÿå‰ªè´´æ¿äº¤äº’" class="headerlink" title="pbcopy/pbpaste - ç›´æ¥ä¸ç³»ç»Ÿå‰ªè´´æ¿äº¤äº’"></a>pbcopy/pbpaste - ç›´æ¥ä¸ç³»ç»Ÿå‰ªè´´æ¿äº¤äº’</h2><p>åœ¨å‘½ä»¤è¡Œæ‹·è´åˆ°ç³»ç»Ÿå‰ªè´´æ¿ä¸€èˆ¬æ˜¯ç”¨é¼ æ ‡é€‰ä¸­éœ€è¦çš„éƒ¨åˆ†ç„¶å<kbd>âŒ˜</kbd>+<kbd>c</kbd>ï¼Œåä¹‹ä»ç³»ç»Ÿå‰ªè´´æ¿ç²˜è´´åˆ°å‘½ä»¤è¡Œåˆ™æ˜¯<kbd>âŒ˜</kbd>+<kbd>v</kbd>ã€‚ä½†è¿™æ ·æ•ˆç‡å¹¶ä¸é«˜ï¼ŒmacOSæä¾›äº†<code>pbcopy</code>å’Œ<code>pbpaste</code>å·¥å…·æ¥è¿›è¡Œå‘½ä»¤è¡Œå’Œç³»ç»Ÿå‰ªè´´æ¿çš„äº¤äº’ã€‚</p><p>åˆ©ç”¨ç®¡é“ç¬¦æ¥ä¼ é€’å¾…æ‹·è´å†…å®¹åˆ°pbcopyå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls ~ | pbcopy <span class="comment">#æŠŠls ~ çš„ç»“æœæ‹·è´åˆ°ç³»ç»Ÿå‰ªè´´æ¿ </span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åˆ©ç”¨é‡å®šå‘ç¬¦å·æ¥ä¼ é€’å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pbcopy &lt; blogpost.txt</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¤šä¸ªå‘½ä»¤ç»„åˆèµ·æ¥å®ç°ä¸€ä¸ªå¤æ‚çš„æ“ä½œï¼Œå¦‚è®¿é—®Googleæ‹·è´å…¶å¾½æ ‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://www.google.com/doodles\<span class="comment">#oodles/archive | grep -A5 &#x27;latest-doodle on&#x27; | grep &#x27;img src&#x27; | sed s/.*&#x27;&lt;img src=&quot;\/\/&#x27;/&#x27;&#x27;/ | sed s/&#x27;&quot; alt=&quot;.*&#x27;/&#x27;&#x27;/ | pbcopy</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç®¡é“è¯­æ³•å¯ä»¥é€‰å–è¦æ‹·è´çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨pbcopyå’Œpbpasteæ¥å®ç°è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œä¾‹å¦‚æŠ“å–<a href="api.github.com">Githubçš„api</a>åˆ°æœ¬åœ°çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://api.github.com | pbcopy &amp;&amp; pbpaste &gt;&gt; ~/api.json</span><br></pre></td></tr></table></figure><p>&nbsp;</p><h2 id="mdfind-å‘½ä»¤è¡Œä¸Šçš„Spotlight"><a href="#mdfind-å‘½ä»¤è¡Œä¸Šçš„Spotlight" class="headerlink" title="mdfind - å‘½ä»¤è¡Œä¸Šçš„Spotlight"></a>mdfind - å‘½ä»¤è¡Œä¸Šçš„Spotlight</h2><p>ç±»ä¼¼äºSpotlightï¼Œ<code>mdfind</code>å¯ä»¥å®ç°è‡ªå®šä¹‰æŸ¥æ‰¾ï¼Œä¾‹å¦‚æ–‡ä»¶å†…å®¹åŒ¹é…å’Œå…ƒæ•°æ®æŸ¥æ‰¾ã€‚</p><p><code>mdfind</code>è¿˜æä¾›æ›´å¤šçš„æœç´¢é€‰é¡¹ã€‚ä¾‹å¦‚<code>-onlyin</code>é€‰é¡¹å¯ä»¥çº¦æŸæœç´¢èŒƒå›´ä¸ºä¸€ä¸ªç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mdfind -onlyin ~/Documents essay</span><br></pre></td></tr></table></figure><p><code>mdfind</code>çš„ç´¢å¼•æ•°æ®åº“åœ¨åå°è‡ªåŠ¨æ›´æ–°ã€‚</p><p>&nbsp;</p><h2 id="launchctl-macOSå¯åŠ¨è„šæœ¬"><a href="#launchctl-macOSå¯åŠ¨è„šæœ¬" class="headerlink" title="launchctl - macOSå¯åŠ¨è„šæœ¬"></a>launchctl - macOSå¯åŠ¨è„šæœ¬</h2><p><code>launchctl</code>ç®¡ç†OS Xçš„å¯åŠ¨è„šæœ¬å’Œå®šæ—¶æœåŠ¡ã€‚ç±»ä¼¼äºlinuxçš„cronã€‚</p><p>æ˜¾ç¤ºå½“å‰çš„å¯åŠ¨è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ launchctl list</span><br></pre></td></tr></table></figure><p>å¼€æœºè‡ªå¯åŠ¨apacheæœåŠ¡å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist</span><br></pre></td></tr></table></figure><p>åœæ­¢æ­£åœ¨è¿è¡Œçš„apacheæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo launchctl unload /System/Library/LaunchDaemons/org.apache.httpd.plist </span><br></pre></td></tr></table></figure><p>åœæ­¢å¹¶å–æ¶ˆå¼€æœºå¯åŠ¨çš„apacheæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist </span><br></pre></td></tr></table></figure><p>Launchdè„šæœ¬å­˜å‚¨ä½ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/Library/LaunchAgents    </span><br><span class="line">/Library/LaunchAgents          </span><br><span class="line">/Library/LaunchDaemons</span><br><span class="line">/System/Library/LaunchAgents</span><br><span class="line">/System/Library/LaunchDaemons</span><br></pre></td></tr></table></figure><p>å¯åŠ¨è„šæœ¬çš„æ ¼å¼å¯ä»¥å‚è€ƒ<a href="http://paul.annesley.cc/2012/09/mac-os-x-launchd-is-cool/">è¿™ç¯‡blog</a>ï¼Œæˆ–è‹¹æœå¼€å‘è€…ä¸­å¿ƒçš„<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html">æ–‡ç« </a>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="http://www.peterborgapps.com/lingon/">Lingon</a>åº”ç”¨æ¥å®Œå…¨å–ä»£å‘½ä»¤è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHub ä½¿ç”¨ä»£ç†</title>
      <link href="/2015/12/25/git/git%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BB%A3%E7%90%86/"/>
      <url>/2015/12/25/git/git%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<ol><li><p>httpsè®¿é—®<br>ä»…ä¸ºgithub.comè®¾ç½®socks5ä»£ç†(æ¨èè¿™ç§æ–¹å¼, å…¬å¸å†…ç½‘å°±ä¸ç”¨è®¾ä»£ç†äº†, å¤šæ­¤ä¸€ä¸¾):<br><code>git config --global http.https://github.com.proxy socks5://127.0.0.1:1086</code><br>å…¶ä¸­1086æ˜¯socks5çš„ç›‘å¬ç«¯å£, è¿™ä¸ªå¯ä»¥é…ç½®çš„, æ¯ä¸ªäººä¸åŒ, åœ¨macOSä¸Šä¸€èˆ¬ä¸º1086.<br>è®¾ç½®å®Œæˆå, ~/.gitconfigæ–‡ä»¶ä¸­ä¼šå¢åŠ ä»¥ä¸‹æ¡ç›®:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[http <span class="string">&quot;https://github.com&quot;</span>]</span><br><span class="line">    proxy = socks5:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1086</span></span><br></pre></td></tr></table></figure></li><li><p>sshè®¿é—®<br>éœ€è¦ä¿®æ”¹~/.ssh/configæ–‡ä»¶, æ²¡æœ‰çš„è¯æ–°å»ºä¸€ä¸ª. åŒæ ·ä»…ä¸ºgithub.comè®¾ç½®ä»£ç†:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">   <span class="built_in"> User </span>git</span><br><span class="line">    ProxyCommand nc -v -x 127.0.0.1:1086 %h %p</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯åœ¨Windowsä¸‹, åˆ™éœ€è¦ä¸ªæ€§%home%.ssh\config, å…¶ä¸­å†…å®¹ç±»ä¼¼äº:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">   <span class="built_in"> User </span>git</span><br><span class="line">    ProxyCommand connect -S 127.0.0.1:1086 %h %p</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ-Sè¡¨ç¤ºä½¿ç”¨socks5ä»£ç†, å¦‚æœæ˜¯httpä»£ç†åˆ™ä¸º-H. connectå·¥å…·gitè‡ªå¸¦, åœ¨<Git>\mingw64\bin\ä¸‹é¢.</p></li></ol><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¢ç§˜socket</title>
      <link href="/2015/12/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8BSocket/"/>
      <url>/2015/12/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8BSocket/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬ç»å¸¸åœ¨ç½‘ç»œç¼–ç¨‹æ¥è§¦socketè¿™ä¸ªæ¦‚å¿µï¼Œç®€è€Œè¨€ä¹‹ï¼Œsocketå°±æ˜¯ç½‘ç»œå¥—æ¥å­—ï¼Œæä¾›ä¸€ä¸ªç½‘ç»œé€šä¿¡çš„æ¥å£ç»™é€šä¿¡çš„è¿›ç¨‹ï¼Œä½†è¿™æ ·è®²äº†ç­‰äºæ²¡è®²ï¼Œä»Šå¤©å°±æ¥å¥½å¥½ç ”ç©¶ç ”ç©¶ã€‚</p><h2 id="å•¥æ˜¯socket"><a href="#å•¥æ˜¯socket" class="headerlink" title="å•¥æ˜¯socket"></a>å•¥æ˜¯socket</h2><p>è™½ç„¶socketå¹³æ—¶è¿˜æ˜¯ç›¸å½“å¸¸ç”¨çš„ï¼Œæ¯å½“éœ€è¦åšç½‘ç»œç¼–ç¨‹çš„æ—¶å€™éƒ½ä¼šç”¨åˆ°å®ƒï¼Œä½†æ·±ç©¶èµ·æ¥ï¼Œä¼¼ä¹è¿˜çœŸçš„æ²¡åŠæ³•è¯´çš„å¾ˆæ¸…æ¥šã€‚è®¡ç®—æœºé‡Œè¾¹æœ‰è®¸å¤šæ¦‚å¿µå°±æ˜¯è¿™æ ·ï¼Œæ¯”è¾ƒæŠ½è±¡ï¼Œè§£é‡Šäº†è·Ÿæ²¡è§£é‡Šä¸€æ ·ã€‚åœ¨æ­¤æˆ‘ä»¬ç”¨å¤§ç™½è¯æè¿°ä¸€ä¸‹ï¼Œäº‰å–è®©â€è¡—ä¸Šå–ç…é¥¼æœå­çš„å¤§å”â€œéƒ½èƒ½å¬æ‡‚ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œ<strong>socket æ˜¯å¯¹åº•å±‚ç½‘ç»œé€šä¿¡çš„ä¸€å±‚æŠ½è±¡ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥åƒæ–‡ä»¶é‚£æ ·æ“ä½œç½‘ç»œä¸Šå‘é€å’Œæ¥æ”¶çš„æ•°æ®ã€‚</strong></p><a id="more"></a><blockquote><p>veryone knows what a files isâ€¦ Itâ€™s that â€œphotoâ€, â€œdocumentâ€, or â€œmusicâ€ that you use. Programs are made of files, in fact, the whole Linux operating system is just a collection of filesâ€¦ But, now for the weird part. Not only is that digital photo that you uploaded to your computer a file, but your monitor is a file too! You see, in Linux, everything is a file! WOW!!! How can that be? Letâ€™s try to explain it.</p><p>åœ¨linuxå’ŒUnixç³»ç»Ÿä¸­ï¼Œä¸€èµ·éƒ½æ˜¯æ–‡ä»¶ã€‚</p></blockquote><p>è¿™ä¹ˆè¯´æ›´åŠ ä¸€è„¸æ‡µé€¼äº†ã€‚æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ã€‚</p><p>Aä¸Bæ‰“ç”µè¯ï¼ŒAã€Bæ­£å¯¹åº”äºéœ€è¦é€šä¿¡çš„ä¸¤ä¸ªè¿›ç¨‹ã€‚Aæƒ³è¦å’ŒBé€šä¿¡ï¼Œé‚£ä¹ˆAå°±éœ€è¦è°ƒç”¨é€šä¿¡æ¥å£å‘ä¿¡æ¯ï¼ˆæ‹¨æ‰“ç”µè¯ï¼‰ï¼ŒBä¹Ÿè°ƒç”¨é€šä¿¡æ¥å£æ¥å—ä¿¡æ¯ï¼ˆæ¥ç”µè¯ï¼‰ã€‚ç”µè¯åœ¨è¿™é‡Œå°±ç›¸å½“äºsocketï¼Œæ˜¯Aã€Bè¯­éŸ³é€šä¿¡çš„æ¥å£ï¼Œè€Œç”µè¯çš„åŸç†ï¼ŒAã€Bå¹¶ä¸å…³å¿ƒï¼ˆè¿›ç¨‹ä¸å…³å¿ƒç½‘ç»œé€šä¿¡å®ç°çš„ç»†èŠ‚ï¼‰ã€‚</p><p>å‡è®¾ç°åœ¨ä½ è¦ç¼–ç¨‹ç½‘ç»œç¨‹åºï¼Œè¿›è¡ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„é€šä¿¡ï¼ˆæ•°æ®äº¤æ¢ï¼‰ã€‚å¯¹äºæœåŠ¡ç«¯çš„é€šä¿¡è¿›ç¨‹SPrså’Œå®¢æˆ·ç«¯çš„é€šä¿¡è¿›ç¨‹CPrsæ¥è¯´ï¼Œä»–ä»¬çš„æ ¸å¿ƒåŠŸèƒ½å…¶å®å°±æ˜¯å‘é€ã€æ¥å—æ•°æ®ã€‚è€Œä¸­é—´çš„æ•°æ®ç¼“å†²ã€ç›‘å¬ç«¯å£ã€æ§åˆ¶IOã€å°è£…è§£æTCP/IPåè®®ç­‰å·¥ä½œæ˜¯éå¸¸æ ‡å‡†åŒ–è€Œç¹ççš„ã€‚é‚£ä¹ˆæŒ‰ç…§æ¨¡å—åˆ†å±‚è®¾è®¡åŸåˆ™ï¼Œè¿™äº›åº•å±‚çš„åŠŸèƒ½å°±åº”è¯¥ç”¨æ¥å£æ¥å®ç°ã€‚socketæ­£æ˜¯è¿™æ ·ä¸€ä¸ªæ¥å£ï¼Œå®ƒå°†ç½‘ç»œè¿æ¥å°è£…ä¸ºä¸€ä¸ªsocketæ¨¡å—ï¼Œå¯¹äºæƒ³è¦é€šä¿¡çš„åŒæ–¹è€Œè¨€ï¼Œåªè¦è°ƒç”¨socketï¼Œå°±å¥½åƒä»–ä»¬åœ¨ç›´æ¥é€šè¯ä¸€æ ·ã€‚</p><p>socketï¼Œå®ƒç°åœ¨å·²ç»æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ linux ä¸­æ˜¯æ ‡å‡†çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåªè¦è°ƒç”¨å®ƒæä¾›çš„ä¸€ç»„æ¥å£ï¼ˆä¸‹é¢ä¼šè¯¦è§£å¸¸ç”¨å‡½æ•°çš„ä½¿ç”¨ï¼‰ï¼Œå°±èƒ½è½»æ¾åœ°å»ºç«‹è¿æ¥ï¼Œè¯»å†™æ•°æ®ï¼Œå…³é—­è¿æ¥ï¼Œè®©ç½‘ç»œæ“ä½œå°±åƒæ–‡ä»¶æ“ä½œä¸€æ ·ç®€å•ã€‚</p><h2 id="é€šä¿¡åœ°å€"><a href="#é€šä¿¡åœ°å€" class="headerlink" title="é€šä¿¡åœ°å€"></a>é€šä¿¡åœ°å€</h2><p>æ­£å¦‚æƒ³è¦æ‰“ç”µè¯éœ€è¦çŸ¥é“ç”µè¯å·ç å’Œåˆ†æœºå·ä¸€æ ·ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæƒ³è¦é€šä¿¡çš„åŒæ–¹ä¹Ÿéœ€è¦çŸ¥é“å¯¹æ–¹çš„é€šä¿¡åœ°å€ã€‚</p><p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹çš„åœ°å€æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ï¼ˆip, portç«¯å£, protocolåè®®ï¼‰ã€‚</p><p>ip åœ°å€æ˜¯ç½‘ç»œå±‚ç”¨æ¥è·¯ç”±å’Œé€šä¿¡çš„æ ‡è¯†ç¬¦ï¼Œç«¯å£ï¼ˆportï¼‰ æ˜¯ä¼ è¾“å±‚ç®¡ç†çš„ã€‚è€Œ socket æ˜¯åœ¨è¿™ä¸¤å±‚ä¹‹ä¸Šï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸¤ä¸ªåœ°å€æ¥æ ‡è¯†ã€‚è¿™é‡Œçš„åè®®æŒ‡çš„æ˜¯ ipv4ï¼Œipv6 æˆ–è€…å…¶ä»–åè®®ã€‚</p><h2 id="socketç±»å‹"><a href="#socketç±»å‹" class="headerlink" title="socketç±»å‹"></a>socketç±»å‹</h2><p>socketç±»å‹åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼Œå¸¸ç”¨çš„æœ‰ä¸‰ç§</p><ul><li><p><code>SOCK_STREAM</code>ï¼šé¢å‘è¿æ¥çš„ç¨³å®šé€šä¿¡ï¼Œåº•å±‚æ˜¯ TCP åè®®ã€‚</p></li><li><p><code>SOCK_DGRAM</code>ï¼šæ— è¿æ¥çš„é€šä¿¡ï¼Œåº•å±‚æ˜¯ UDP åè®®ï¼Œéœ€è¦ä¸Šå±‚çš„åè®®æ¥ä¿è¯å¯é æ€§ã€‚</p></li><li><p><code>SOCK_RAW</code>ï¼šæ›´åŠ çµæ´»çš„æ•°æ®æ§åˆ¶ï¼Œå¯æŒ‡å®šIPå¤´éƒ¨ã€‚</p></li></ul><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>ä¸€ä¸ªå…¸å‹çš„tcp socketè¿æ¥å¦‚ä¸‹å›¾</p><h3 id="åˆ›å»ºsocket"><a href="#åˆ›å»ºsocket" class="headerlink" title="åˆ›å»ºsocket"></a>åˆ›å»ºsocket</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> socketid = socket(family, type, protocol);</span><br><span class="line"><span class="comment">//socketid: socket æè¿°ç¬¦ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡å®ƒæ¥è¯»/å†™æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//familyï¼šæ•´æ•°ï¼Œé€šä¿¡åŸŸã€‚ </span></span><br><span class="line"><span class="comment">//   - AF_INETï¼šå› ç‰¹ç½‘åè®®åè®®ï¼Œç½‘ç»œåœ°å€ï¼Œæœ€å¸¸ç”¨ã€‚</span></span><br><span class="line"><span class="comment">//   - AF_UNIXï¼Œæœ¬åœ°é€šä¿¡ï¼Œæ–‡ä»¶åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//typeï¼šé€šä¿¡ç±»å‹</span></span><br><span class="line"><span class="comment">//   - SOCK_STREAMï¼šå¯é çš„ï¼Œé¢å‘è¿æ¥çš„æœåŠ¡ï¼ŒTCP åè®®</span></span><br><span class="line"><span class="comment">//   - SOCK_DGRAMï¼šä¸å¯é ï¼Œæ— è¿æ¥çš„æœåŠ¡ï¼ŒUDP åè®®</span></span><br><span class="line"><span class="comment">//   - SOCK_RAWï¼šéœ€è¦è‡ªå·±ç®¡ç† IP å¤´éƒ¨çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//protocolï¼šåè®®, ä¸€èˆ¬è®¾ä¸º 0ï¼Œ è¡¨ç¤ºä½¿ç”¨é»˜è®¤åè®®</span></span><br><span class="line"><span class="comment">//   - IPPROTO_TCPï¼ŒIPPROTO_UDP</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure><h3 id="å…³é—­socket"><a href="#å…³é—­socket" class="headerlink" title="å…³é—­socket"></a>å…³é—­socket</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> status = close(socketid);</span><br><span class="line"><span class="comment">//è¿”å›å€¼0 æ­£ç¡®</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼-1 å‡ºé”™</span></span><br></pre></td></tr></table></figure><p>å…³é—­è¿æ¥å’Œé‡Šæ”¾ç«¯å£ã€‚</p><h3 id="æœåŠ¡ç«¯-å®¢æˆ·ç«¯ç»‘å®šï¼ˆbindï¼‰åœ°å€ä¸‰å…ƒç»„åˆ°-socket"><a href="#æœåŠ¡ç«¯-å®¢æˆ·ç«¯ç»‘å®šï¼ˆbindï¼‰åœ°å€ä¸‰å…ƒç»„åˆ°-socket" class="headerlink" title="æœåŠ¡ç«¯/å®¢æˆ·ç«¯ç»‘å®šï¼ˆbindï¼‰åœ°å€ä¸‰å…ƒç»„åˆ° socket"></a>æœåŠ¡ç«¯/å®¢æˆ·ç«¯ç»‘å®šï¼ˆbindï¼‰åœ°å€ä¸‰å…ƒç»„åˆ° socket</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> struct sockaddr *, <span class="keyword">socklen_t</span>)</span></span>;</span><br><span class="line"><span class="comment">// è¿˜è®°å¾—é‚£å¥è¯å—ï¼Œåœ¨Unixç³»ç»Ÿé‡Œï¼Œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ï¼Œsocketä¹Ÿå¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦fd</span></span><br></pre></td></tr></table></figure><p>æŠŠ socket ç»‘å®šåˆ°æŸä¸ªåœ°å€ä¸‰å…ƒç»„ï¼Œç”¨äº server ç«¯ç›‘å¬ç«¯å£ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ socket çš„æè¿°ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>struct sockaddr</code> æ˜¯åœ°å€ç»“æ„ä½“ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åœ°å€ç»“æ„ä½“çš„é•¿åº¦ã€‚ç»‘å®šå¤±è´¥çš„è¯è¿”å›å€¼ä¸ºè´Ÿæ•°ï¼Œå¦åˆ™ä¸º -1ï¼Œå¹¶ä¸”è®¾ç½® <code>errno</code>ã€‚</p><p>å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯åœ°å€ç»“æ„ä½“ï¼Œå®ƒåœ¨ <code>netinet/in.h</code> ä¸­è¢«å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">short</span>   sin_family; <span class="comment">/* must be AF_INET */</span></span><br><span class="line">  u_short sin_port;   <span class="comment">/* ç«¯å£å·ï¼Œå¿…é¡»è¦é€šè¿‡ htons è½¬æ¢ä¸ºç½‘ç»œæ ¼å¼ */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span>  <span class="title">in_addr</span> <span class="title">sin_addr</span>;</span>  <span class="comment">/* ip åœ°å€ */</span></span><br><span class="line">  <span class="keyword">char</span>    sin_zero[<span class="number">8</span>]; <span class="comment">/* Not used, must be zero */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ <code>in_addr</code> ä¹Ÿæ˜¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹è¢«å®šä¹‰ï¼Œæ ¼å¼ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> s_addr; <span class="comment">//32ä½æ•´æ•° æœ¬æœºåœ°å€</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å¯ä»¥ç”¨ INADDR_ANY å˜é‡è¡¨ç¤ºæ¥å—æ¥è‡ªä»»ä½•åœ°å€çš„è¿æ¥ï¼Œä½¿ç”¨ä¹‹å‰éœ€è¦æŠŠåœ°å€å˜é‡åˆå§‹åŒ–ä¸ºå…¨0</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯çš„ <code>s_addr</code> æ˜¯æœ¬æœºåœ°å€ï¼Œ<code>sockaddr</code> æ˜¯é€šç”¨çš„ socket åœ°å€ç»“æ„ï¼Œ<code>sockaddr_in</code> æ˜¯ç½‘ç»œ socket çš„ç»“æ„ï¼Œå‚æ•°æœ‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„è¿‡ç¨‹ã€‚</p><h3 id="æœåŠ¡ç«¯ç›‘å¬ï¼ˆlistenï¼‰socket"><a href="#æœåŠ¡ç«¯ç›‘å¬ï¼ˆlistenï¼‰socket" class="headerlink" title="æœåŠ¡ç«¯ç›‘å¬ï¼ˆlistenï¼‰socket"></a>æœåŠ¡ç«¯ç›‘å¬ï¼ˆlistenï¼‰socket</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">listen(sockfd, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// å‚æ•°1 socket æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">// å‚æ•°2 æœ€å¤§è¿æ¥æ•°ï¼Œè¡¨ç¤ºå‘æ¥è¯·æ±‚ä½†æ˜¯æ²¡æœ‰è¢« accept çš„è¿æ¥æ•°é‡ã€‚</span></span><br><span class="line"><span class="comment">// listen å‡½æ•°åœ¨æˆåŠŸæ—¶è¿”å› 0ï¼Œå¤±è´¥æ—¶è¿”å› -1ï¼Œå¹¶ä¸”è®¾ç½®é”™è¯¯ä»£ç ã€‚</span></span><br></pre></td></tr></table></figure><p><code>listen</code> ç³»ç»Ÿè°ƒç”¨è®©æœåŠ¡ç«¯è¿›ç¨‹ç›‘å¬åœ¨æŒ‡å®šçš„ socket ä¸Šé¢ï¼Œå‡½æ•°åœ¨æˆåŠŸæ—¶è¿”å› 0ï¼Œå¤±è´¥æ—¶è¿”å› -1ï¼Œå¹¶ä¸”è®¾ç½®é”™è¯¯ä»£ç ã€‚</p><h3 id="å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥ï¼ˆconnectï¼‰"><a href="#å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥ï¼ˆconnectï¼‰" class="headerlink" title="å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥ï¼ˆconnectï¼‰"></a>å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥ï¼ˆconnectï¼‰</h3><p>å®¢æˆ·ç«¯è¦è¿æ¥è‡ªå·±çš„ socket å’ŒæœåŠ¡å™¨çš„ç›‘å¬socketï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(<span class="keyword">int</span> socket, <span class="keyword">const</span> struct sockaddr* address, <span class="keyword">size_t</span> address_len)</span></span>;</span><br><span class="line"><span class="comment">// socket æ˜¯å®¢æˆ·ç«¯æœ¬åœ°åˆ›å»ºçš„å¥—æ¥å­—</span></span><br><span class="line"><span class="comment">// address æ˜¯æœåŠ¡å™¨çš„ä¸‰å…ƒç»„åœ°å€</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸè°ƒç”¨æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å°†æ”¶åˆ°è¯·æ±‚ï¼Œ<code>accept</code> è¿æ¥ä¹‹åï¼Œå°±åœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹äº† socket é€šä¿¡çš„ç®¡é“ï¼Œä¹‹åçš„è¯»å†™å°±æ˜¯ç›´æ¥å¯¹ socket è¿›è¡Œæ“ä½œã€‚</p><h3 id="æœåŠ¡ç«¯æ¥å—ï¼ˆacceptï¼‰è¿æ¥"><a href="#æœåŠ¡ç«¯æ¥å—ï¼ˆacceptï¼‰è¿æ¥" class="headerlink" title="æœåŠ¡ç«¯æ¥å—ï¼ˆacceptï¼‰è¿æ¥"></a>æœåŠ¡ç«¯æ¥å—ï¼ˆacceptï¼‰è¿æ¥</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_socket = accept(socket_desc, (struct sockaddr *)&amp;client, (<span class="keyword">socklen_t</span>*)&amp;c);</span><br></pre></td></tr></table></figure><p>æ¯å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯è°ƒç”¨<code>accept</code> å‡½æ•°æ¥å—è¯¥è¿æ¥ï¼ŒæŠŠå®¢æˆ·ç«¯çš„ socket åœ°å€ä¿¡æ¯ä¿å­˜åˆ° <code>client</code> å˜é‡é‡Œï¼Œæ–°å»ºä¸€ä¸ª socketï¼Œè¿”å›å…¶æè¿°ç¬¦ï¼Œç„¶åæ•°æ®çš„è¯»å†™å°±èƒ½é€šè¿‡æ–° socket è¿›è¡Œã€‚ æ–° socket çš„åœ°å€å’ŒæœåŠ¡å™¨ç›‘å¬ socket æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸å…³å¿ƒå®¢æˆ·ç«¯åœ°å€ä¿¡æ¯çš„è¯ï¼Œå¯ä»¥æŠŠç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸ºç©ºæŒ‡é’ˆ <code>NULL</code>ã€‚</p><p>æœ‰äº† <code>client</code> å˜é‡ï¼Œå°±èƒ½å¾—åˆ°å®¢æˆ·ç«¯çš„ <code>ip</code> å’Œ <code>port</code> ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">char</span> *client_ip = inet<span class="constructor">_ntoa(<span class="params">client</span>.<span class="params">sin_addr</span>)</span>;</span><br><span class="line"><span class="built_in">int</span> client_port = ntohs(client.sin_port);</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œ<code>accept</code> å‡½æ•°å°†ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰è¿æ¥è¿‡æ¥</strong>ã€‚</p><h3 id="è¯»-å†™ï¼ˆWriteï¼‰æ•°æ®"><a href="#è¯»-å†™ï¼ˆWriteï¼‰æ•°æ®" class="headerlink" title="è¯»/å†™ï¼ˆWriteï¼‰æ•°æ®"></a>è¯»/å†™ï¼ˆWriteï¼‰æ•°æ®</h3><p>ä¸Šé¢é‚£ä¹ˆå¤šçš„å‡½æ•°è°ƒç”¨ï¼Œåªæ˜¯å»ºç«‹äº†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç®—æ˜¯é€šä¿¡å‰çš„å‡†å¤‡å·¥ä½œï¼Œä¸¤è€…éƒ½æœ‰äº†è‡ªå·±çš„ socket æè¿°ç¬¦ã€‚ æœ‰äº† socket æè¿°ç¬¦ï¼Œå°±å¯ä»¥åƒæ–‡ä»¶é‚£æ ·è¿›è¡Œè¯»å†™æ•°æ®ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write(socket_des, message, <span class="built_in">strlen</span>(message));</span><br><span class="line">read(socket_des, buffer, <span class="keyword">sizeof</span>(buffer));</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>read</code> å‡½æ•°è°ƒç”¨æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ²¡æœ‰æ•°æ®å‘é€è¿‡æ¥çš„è¯ï¼Œè¯¥å‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å¯ä»¥è¯»åˆ°æ•°æ®ã€‚</p><p><code>read</code>å’Œ <code>write</code> è¿”å›çš„æ˜¯å®é™…è¯»å†™çš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®æœ€å¤§æ˜¯ buffer çš„å¤§å°ã€‚å¦‚æœä¼ è¾“çš„æ•°æ®å¤§äº buffer çš„è¯ï¼Œéœ€è¦åœ¨ç¨‹åºé‡Œæ˜¾å¼åœ°å»è¯»å–ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</p><p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œæˆ‘ä¸€ç›´è¯»åˆ°è¿”å›çš„æ•°æ®å°äº <code>sizeof(buff)</code> ä¸å°±è¡Œäº†ã€‚å—¯ï¼Œè¿™æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡è¦åˆ¤æ–­è¿”å›å€¼ä¸æ˜¯ 0ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯ 0 è¡¨ç¤ºè¿æ¥å·²ç»ä¸­æ–­ï¼ˆéœ€è¦è°ƒç”¨ <code>close</code> æ¥å…³é—­ socketï¼‰ï¼Œè€Œä¸æ˜¯æ²¡æœ‰æ•°æ®å‘é€è¿‡æ¥ã€‚</p><h3 id="å…¶ä»–å¸¸ç”¨å‡½æ•°"><a href="#å…¶ä»–å¸¸ç”¨å‡½æ•°" class="headerlink" title="å…¶ä»–å¸¸ç”¨å‡½æ•°"></a>å…¶ä»–å¸¸ç”¨å‡½æ•°</h3><ol><li><p>è·å– ip åœ°å€</p><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åªçŸ¥é“æœåŠ¡å™¨çš„åŸŸåï¼Œå¹¶ä¸çŸ¥é“ ip åœ°å€ã€‚<code>gethostbyname</code> å‡½æ•°å°±èƒ½å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œ<code>netdb.h</code> æ–‡ä»¶é‡Œæœ‰å®ƒçš„å®šä¹‰ï¼Œå®ƒçš„åŸå‹æ˜¯ï¼š</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span> struct hostent * gethostbyname(const char *name);</span></span><br></pre></td></tr></table></figure><p>å‚æ•° <code>name</code> æ˜¯è¯¸å¦‚ <code>www.google.com</code> çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å€¼æ˜¯ <code>struct hostent</code> ç»“æ„ä½“ï¼Œç”¨æ¥å­˜å‚¨å¾—åˆ°çš„åœ°å€ä¿¡æ¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostent</span> &#123;</span> <span class="keyword">char</span> *h_name; <span class="comment">/* Official name of host. */</span> <span class="keyword">char</span> **h_aliases; <span class="comment">/* Alias list. */</span> <span class="keyword">int</span> h_addrtype; <span class="comment">/* Host address type. */</span> <span class="keyword">int</span> h_length; <span class="comment">/* Length of address. */</span> <span class="keyword">char</span> **h_addr_list; <span class="comment">/* List of addresses from name server. */</span> &#125;;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œè¿”å›ç©ºæŒ‡é’ˆ <code>NULL</code>ã€‚</p></li><li><p>æŠŠ long ç±»å‹çš„ ip è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">include</span> &lt;arpa/inet.h&gt; <span class="built_in">char</span> *inet<span class="constructor">_ntoa(<span class="params">struct</span> <span class="params">in_addr</span>)</span>; <span class="built_in">int</span> inet<span class="constructor">_aton(<span class="params">const</span> <span class="params">char</span> <span class="operator">*</span><span class="params">cp</span>, <span class="params">struct</span> <span class="params">in_addr</span> <span class="operator">*</span><span class="params">inp</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‡½æ•°è¿”å›å¯ç”¨çš„ in_addr ç»“æ„ä½“ï¼Œéœ€è¦ä½ æ‰‹åŠ¨èµ‹å€¼ã€‚ä¸‹é¢çš„å‡½æ•°æŠŠè½¬æ¢åçš„ç»“æ„æ‹·è´åˆ° inp æŒ‡å‘çš„ç»“æ„ä½“é‡Œé¢ï¼Œç„¶å inp å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p></li><li><p>æŠŠå­—ç¬¦ä¸²ç±»å‹çš„ ip è½¬æ¢ä¸º long ç±»å‹</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">include</span> &lt;arpa/inet.h&gt; in_addr_t inet<span class="constructor">_addr(<span class="params">const</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip</span>)</span>;</span><br></pre></td></tr></table></figure></li><li><p>æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">atoi</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *nptr)</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¯ä»¥æŠŠä»é”®ç›˜è¾“å…¥çš„ç«¯å£å·è½¬æ¢æˆå¯ç”¨çš„æ•´æ•°ã€‚</p></li><li><p><code>getpeername</code>ï¼šè·å–è¿åœ¨æŸä¸ª socket å¦ä¸€ç«¯çš„å®¢æˆ·åœ°å€(ip å’Œ port)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getpeername</span><span class="params">(<span class="keyword">int</span> sockfd, struct sockaddr *addr, <span class="keyword">socklen_t</span> *addrlen)</span></span>;</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ä¿¡æ¯ä¿å­˜åœ¨ addr ç»“æ„ä½“é‡Œã€‚</p></li></ol><h2 id="Demoæ¼”ç¤º"><a href="#Demoæ¼”ç¤º" class="headerlink" title="Demoæ¼”ç¤º"></a>Demoæ¼”ç¤º</h2><p>æœ¬demoå®ç°ä¸€ä¸ªEchoServerï¼Œç›‘å¬54321ç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„ä¿¡æ¯å¹¶åŠ ä¸Šæ—¶é—´æˆ³å‘é€å›å»ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFER_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT 54321</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BACKLOG 5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">setup_sock</span><span class="params">(<span class="keyword">int</span> port)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * This function sets up a socket listening on local port.</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * port: port number to listen on.</span></span><br><span class="line"><span class="comment">        * :return: socket file descriptor.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">int</span> listen_fd;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serv_addr</span>;</span></span><br><span class="line">    </span><br><span class="line">    listen_fd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;serv_addr, <span class="number">0</span>, <span class="keyword">sizeof</span>(serv_addr));</span><br><span class="line">    </span><br><span class="line">    serv_addr.sin_family = AF_INET;</span><br><span class="line">    serv_addr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">    serv_addr.sin_port = htons(port);</span><br><span class="line">    </span><br><span class="line">    bind(listen_fd, (struct sockaddr*)&amp;serv_addr, <span class="keyword">sizeof</span>(serv_addr));</span><br><span class="line">    listen(listen_fd, BACKLOG);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> listen_fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echo_request</span><span class="params">(<span class="keyword">int</span> conn_fd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">time_t</span> ticks;</span><br><span class="line">    <span class="keyword">char</span> sendBuff[BUFFER_SIZE];</span><br><span class="line">    <span class="keyword">char</span> recvBuff[BUFFER_SIZE];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memset</span>(sendBuff, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendBuff));</span><br><span class="line">    <span class="built_in">memset</span>(recvBuff, <span class="number">0</span>, <span class="keyword">sizeof</span>(recvBuff));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>( (n = recv(conn_fd, recvBuff, <span class="keyword">sizeof</span>(recvBuff), <span class="number">0</span>)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ticks = time(<span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">snprintf</span>(sendBuff, <span class="keyword">sizeof</span>(sendBuff), <span class="string">&quot;%.24s: &quot;</span>, ctime(&amp;ticks));</span><br><span class="line">    </span><br><span class="line">        recvBuff[n] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;received:  %s&quot;</span>, recvBuff);</span><br><span class="line">        <span class="built_in">strcat</span>(sendBuff, recvBuff);</span><br><span class="line">        send(conn_fd, sendBuff, <span class="built_in">strlen</span>(sendBuff), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;received 0 bytes, close.\n&quot;</span>);</span><br><span class="line">    close(conn_fd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> listen_fd = <span class="number">0</span>, conn_fd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">socklen_t</span> cli_len;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">cli_addr</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;start server...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;cli_addr, <span class="string">&#x27;0&#x27;</span>, <span class="keyword">sizeof</span>(cli_addr));</span><br><span class="line">    </span><br><span class="line">    listen_fd = setup_sock(PORT);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;listening on 0.0.0.0 %d...\n&quot;</span>, PORT);</span><br><span class="line">    </span><br><span class="line">    cli_len = <span class="keyword">sizeof</span>(cli_addr);</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        conn_fd = accept(listen_fd, (struct sockaddr*)&amp;cli_addr, &amp;cli_len);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client ip: %s, port: %d\n&quot;</span>,</span><br><span class="line">                inet_ntoa(cli_addr.sin_addr),</span><br><span class="line">                ntohs(cli_addr.sin_port));</span><br><span class="line">    </span><br><span class="line">        echo_request(conn_fd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ telnet æµ‹è¯•çš„ç»“æœå¦‚ä¸‹ï¼š</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://www.csd.uoc.gr/~hy556/material/tutorials/cs556-3rd-tutorial.pdf">Introduction to Sockets Programming in C using TCP/IP</a></li><li><a href="http://beej.us/guide/bgnet/">Beejâ€™s Guide to Network Programming Using Internet Sockets</a></li><li><a href="http://www.binarytides.com/socket-programming-c-linux-tutorial/">socket programming in C on Linux</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP/IP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸­çš„lsof</title>
      <link href="/2015/12/16/Linux/Linux%E4%B8%AD%E7%9A%84lsof/"/>
      <url>/2015/12/16/Linux/Linux%E4%B8%AD%E7%9A%84lsof/</url>
      
        <content type="html"><![CDATA[<h2 id="lsof-list-open-files"><a href="#lsof-list-open-files" class="headerlink" title="lsof - list open files"></a>lsof - list open files</h2><p>lsofï¼ˆlist open filesï¼‰æ˜¯ä¸€ä¸ªæŸ¥çœ‹å½“å‰ç³»ç»Ÿæ–‡ä»¶çš„å·¥å…·ã€‚åœ¨linuxç¯å¢ƒä¸‹ï¼Œä»»ä½•äº‹ç‰©éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡æ–‡ä»¶ä¸ä»…ä»…å¯ä»¥è®¿é—®å¸¸è§„æ•°æ®ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œè¿æ¥å’Œç¡¬ä»¶ã€‚å¦‚ä¼ è¾“æ§åˆ¶åè®® (TCP) å’Œç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) å¥—æ¥å­—ç­‰ï¼Œç³»ç»Ÿåœ¨åå°éƒ½ä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æä¾›äº†å¤§é‡å…³äºè¿™ä¸ªåº”ç”¨ç¨‹åºæœ¬èº«çš„ä¿¡æ¯ã€‚</p><a id="more"></a><h2 id="æ–‡ä»¶ç±»å‹"><a href="#æ–‡ä»¶ç±»å‹" class="headerlink" title="æ–‡ä»¶ç±»å‹"></a>æ–‡ä»¶ç±»å‹</h2><p>lsofæ‰“å¼€çš„æ–‡ä»¶å¯ä»¥æ˜¯ï¼š</p><ol><li>æ™®é€šæ–‡ä»¶</li><li>ç›®å½•</li><li>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶</li><li>å­—ç¬¦æˆ–è®¾å¤‡æ–‡ä»¶</li><li>(å‡½æ•°)å…±äº«åº“</li><li>ç®¡é“ï¼Œå‘½åç®¡é“</li><li>ç¬¦å·é“¾æ¥</li><li>ç½‘ç»œæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šNFS fileã€ç½‘ç»œsocketï¼ŒunixåŸŸåsocketï¼‰</li><li>è¿˜æœ‰å…¶å®ƒç±»å‹çš„æ–‡ä»¶ï¼Œç­‰ç­‰</li></ol><h2 id="å‘½ä»¤å‚æ•°"><a href="#å‘½ä»¤å‚æ•°" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h2><ul><li>-a åˆ—å‡ºæ‰“å¼€æ–‡ä»¶å­˜åœ¨çš„è¿›ç¨‹</li><li>-i&lt;æ¡ä»¶&gt; åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹ã€‚ï¼ˆ4ã€6ã€åè®®ã€:ç«¯å£ã€ @ip ï¼‰</li><li>-c&lt;è¿›ç¨‹å&gt; åˆ—å‡ºæŒ‡å®šè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶</li><li>-p&lt;è¿›ç¨‹å·&gt; åˆ—å‡ºæŒ‡å®šè¿›ç¨‹å·æ‰€æ‰“å¼€çš„æ–‡ä»¶</li><li>-d&lt;æ–‡ä»¶å·&gt; åˆ—å‡ºå ç”¨è¯¥æ–‡ä»¶å·çš„è¿›ç¨‹</li><li>+d&lt;ç›®å½•&gt; åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶</li><li>+D&lt;ç›®å½•&gt; é€’å½’åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶</li><li>-n&lt;ç›®å½•&gt; åˆ—å‡ºä½¿ç”¨NFSçš„æ–‡ä»¶</li><li>-g åˆ—å‡ºGIDå·è¿›ç¨‹è¯¦æƒ…</li><li>-u åˆ—å‡ºUIDå·è¿›ç¨‹è¯¦æƒ…</li><li>-h æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</li><li>-v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</li></ul><h2 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h2><h3 id="å®ä¾‹ä¸€ï¼šæ— ä»»ä½•å‚æ•°"><a href="#å®ä¾‹ä¸€ï¼šæ— ä»»ä½•å‚æ•°" class="headerlink" title="å®ä¾‹ä¸€ï¼šæ— ä»»ä½•å‚æ•°"></a>å®ä¾‹ä¸€ï¼šæ— ä»»ä½•å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span>| more</span><br><span class="line">COMMAND     PID      USER   FD      TYPE             DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">init          1      root  cwd       DIR              253,0     4096          2 /</span><br><span class="line">init          1      root  rtd       DIR              253,0     4096          2 /</span><br><span class="line">init          1      root  txt       REG              253,0   150352    1310795 /sbin/init</span><br><span class="line">init          1      root  mem       REG              253,0    65928    5505054 /lib64/libnss_files-2.12.so</span><br><span class="line">init          1      root  mem       REG              253,0  1918016    5521405 /lib64/libc-2.12.so</span><br><span class="line">init          1      root  mem       REG              253,0    93224    5521440 /lib64/libgcc_s-4.4.6-20120305.so.1</span><br><span class="line">init          1      root  mem       REG              253,0    47064    5521407 /lib64/librt-2.12.so</span><br><span class="line">init          1      root  mem       REG              253,0   145720    5521406 /lib64/libpthread-2.12.so</span><br></pre></td></tr></table></figure><p><code>lsof</code>è¾“å‡ºå„åˆ—ä¿¡æ¯çš„æ„ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p>COMMANDï¼šè¿›ç¨‹çš„åç§°</p></li><li><p>PIDï¼šè¿›ç¨‹æ ‡è¯†ç¬¦</p></li><li><p>PPIDï¼šçˆ¶è¿›ç¨‹æ ‡è¯†ç¬¦ï¼ˆéœ€è¦æŒ‡å®š-Rå‚æ•°ï¼‰</p></li><li><p>USERï¼šè¿›ç¨‹æ‰€æœ‰è€…</p></li><li><p>PGIDï¼šè¿›ç¨‹æ‰€å±ç»„</p></li><li><p>FDï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯†åˆ«è¯¥æ–‡ä»¶ã€‚å¦‚cwdã€txtç­‰:</p></li></ul><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰cwdï¼šè¡¨ç¤ºcurrent work dirctoryï¼Œå³ï¼šåº”ç”¨ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ï¼Œè¿™æ˜¯è¯¥åº”ç”¨ç¨‹åºå¯åŠ¨çš„ç›®å½•ï¼Œé™¤éå®ƒæœ¬èº«å¯¹è¿™ä¸ªç›®å½•è¿›è¡Œæ›´æ”¹</span><br><span class="line">ï¼ˆ2ï¼‰txt ï¼šè¯¥ç±»å‹çš„æ–‡ä»¶æ˜¯ç¨‹åºä»£ç ï¼Œå¦‚åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«æˆ–å…±äº«åº“ï¼Œå¦‚ä¸Šåˆ—è¡¨ä¸­æ˜¾ç¤ºçš„ <span class="code">`/sbin/init`</span> ç¨‹åº</span><br><span class="line">ï¼ˆ3ï¼‰lnnï¼šlibrary references (AIX);</span><br><span class="line">ï¼ˆ4ï¼‰erï¼šFD information error (see NAME column);</span><br><span class="line">ï¼ˆ5ï¼‰jldï¼šjail directory (FreeBSD);</span><br><span class="line">ï¼ˆ6ï¼‰ltxï¼šshared library text (code and data);</span><br><span class="line">ï¼ˆ7ï¼‰mxx ï¼šhex memory-mapped type number xx.</span><br><span class="line">ï¼ˆ8ï¼‰m86ï¼šDOS Merge mapped file;</span><br><span class="line">ï¼ˆ9ï¼‰memï¼šmemory-mapped file;</span><br><span class="line">ï¼ˆ10ï¼‰mmapï¼šmemory-mapped device;</span><br><span class="line">ï¼ˆ11ï¼‰pdï¼šparent directory;</span><br><span class="line">ï¼ˆ12ï¼‰rtdï¼šroot directory;</span><br><span class="line">ï¼ˆ13ï¼‰trï¼škernel trace file (OpenBSD);</span><br><span class="line">ï¼ˆ14ï¼‰v86  VP/ix mapped file;</span><br><span class="line">ï¼ˆ15ï¼‰0ï¼šè¡¨ç¤ºæ ‡å‡†è¾“å…¥</span><br><span class="line">ï¼ˆ16ï¼‰1ï¼šè¡¨ç¤ºæ ‡å‡†è¾“å‡º</span><br><span class="line">ï¼ˆ17ï¼‰2ï¼šè¡¨ç¤ºæ ‡å‡†é”™è¯¯</span><br><span class="line">ä¸€èˆ¬åœ¨æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯ã€æ ‡å‡†è¾“å…¥åè¿˜è·Ÿç€æ–‡ä»¶çŠ¶æ€æ¨¡å¼ï¼šrã€wã€uç­‰</span><br><span class="line">ï¼ˆ1ï¼‰uï¼šè¡¨ç¤ºè¯¥æ–‡ä»¶è¢«æ‰“å¼€å¹¶å¤„äºè¯»å–/å†™å…¥æ¨¡å¼</span><br><span class="line">ï¼ˆ2ï¼‰rï¼šè¡¨ç¤ºè¯¥æ–‡ä»¶è¢«æ‰“å¼€å¹¶å¤„äºåªè¯»æ¨¡å¼</span><br><span class="line">ï¼ˆ3ï¼‰wï¼šè¡¨ç¤ºè¯¥æ–‡ä»¶è¢«æ‰“å¼€å¹¶å¤„äºå†™å…¥æ¨¡å¼</span><br><span class="line">ï¼ˆ4ï¼‰ç©ºæ ¼ï¼šè¡¨ç¤ºè¯¥æ–‡ä»¶çš„çŠ¶æ€æ¨¡å¼ä¸ºunknowï¼Œä¸”æ²¡æœ‰é”å®š</span><br><span class="line">ï¼ˆ5ï¼‰-ï¼šè¡¨ç¤ºè¯¥æ–‡ä»¶çš„çŠ¶æ€æ¨¡å¼ä¸ºunknowï¼Œä¸”è¢«é”å®š</span><br><span class="line">åŒæ—¶åœ¨æ–‡ä»¶çŠ¶æ€æ¨¡å¼åé¢ï¼Œè¿˜è·Ÿç€ç›¸å…³çš„é”</span><br><span class="line">ï¼ˆ1ï¼‰Nï¼šfor a Solaris NFS lock of unknown type;</span><br><span class="line">ï¼ˆ2ï¼‰rï¼šfor read lock on part of the file;</span><br><span class="line">ï¼ˆ3ï¼‰Rï¼šfor a read lock on the entire file;</span><br><span class="line">ï¼ˆ4ï¼‰wï¼šfor a write lock on part of the file;ï¼ˆæ–‡ä»¶çš„éƒ¨åˆ†å†™é”ï¼‰</span><br><span class="line">ï¼ˆ5ï¼‰Wï¼šfor a write lock on the entire file;ï¼ˆæ•´ä¸ªæ–‡ä»¶çš„å†™é”ï¼‰</span><br><span class="line">ï¼ˆ6ï¼‰uï¼šfor a read and write lock of any length;</span><br><span class="line">ï¼ˆ7ï¼‰Uï¼šfor a lock of unknown type;</span><br><span class="line">ï¼ˆ8ï¼‰xï¼šfor an SCO OpenServer Xenix lock on part of the file;</span><br><span class="line">ï¼ˆ9ï¼‰Xï¼šfor an SCO OpenServer Xenix lock on the entire file;</span><br><span class="line">ï¼ˆ10ï¼‰spaceï¼šif there is no lock.</span><br></pre></td></tr></table></figure><ul><li>TYPEï¼šæ–‡ä»¶ç±»å‹ï¼Œå¦‚DIRã€REGç­‰ï¼Œå¸¸è§çš„æ–‡ä»¶ç±»å‹:</li></ul><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰DIRï¼šè¡¨ç¤ºç›®å½•</span><br><span class="line">ï¼ˆ2ï¼‰CHRï¼šè¡¨ç¤ºå­—ç¬¦ç±»å‹</span><br><span class="line">ï¼ˆ3ï¼‰BLKï¼šå—è®¾å¤‡ç±»å‹</span><br><span class="line">ï¼ˆ4ï¼‰UNIXï¼š UNIX åŸŸå¥—æ¥å­—</span><br><span class="line">ï¼ˆ5ï¼‰FIFOï¼šå…ˆè¿›å…ˆå‡º (FIFO) é˜Ÿåˆ—</span><br><span class="line">ï¼ˆ6ï¼‰IPv4ï¼šç½‘é™…åè®® (IP) å¥—æ¥å­—</span><br></pre></td></tr></table></figure><ul><li><p>DEVICEï¼šæŒ‡å®šç£ç›˜çš„åç§°</p></li><li><p>SIZEï¼šæ–‡ä»¶çš„å¤§å°</p></li><li><p>NODEï¼šç´¢å¼•èŠ‚ç‚¹ï¼ˆæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„æ ‡è¯†ï¼‰</p></li><li><p>NAMEï¼šæ‰“å¼€æ–‡ä»¶çš„ç¡®åˆ‡åç§°</p></li></ul><h3 id="å®ä¾‹2ï¼šæŸ¥æ‰¾æŸä¸ªæ–‡ä»¶ç›¸å…³çš„è¿›ç¨‹"><a href="#å®ä¾‹2ï¼šæŸ¥æ‰¾æŸä¸ªæ–‡ä»¶ç›¸å…³çš„è¿›ç¨‹" class="headerlink" title="å®ä¾‹2ï¼šæŸ¥æ‰¾æŸä¸ªæ–‡ä»¶ç›¸å…³çš„è¿›ç¨‹"></a>å®ä¾‹2ï¼šæŸ¥æ‰¾æŸä¸ªæ–‡ä»¶ç›¸å…³çš„è¿›ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> /bin/bash</span><br><span class="line">COMMAND     PID USER  FD   TYPE DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">mysqld_sa  2169 root txt    REG  253,0   938736 4587562 /bin/bash</span><br><span class="line">ksmtuned   2334 root txt    REG  253,0   938736 4587562 /bin/bash</span><br><span class="line">bash      20121 root txt    REG  253,0   938736 4587562 /bin/bash</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹3ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯"><a href="#å®ä¾‹3ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="å®ä¾‹3ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯"></a>å®ä¾‹3ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="variable">$lsof</span> -u username</span><br><span class="line"></span><br><span class="line">-u é€‰é¡¹ï¼Œuæ˜¯userçš„ç¼©å†™</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹4ï¼šåˆ—å‡ºæŸä¸ªç¨‹åºè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯"><a href="#å®ä¾‹4ï¼šåˆ—å‡ºæŸä¸ªç¨‹åºè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="å®ä¾‹4ï¼šåˆ—å‡ºæŸä¸ªç¨‹åºè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯"></a>å®ä¾‹4ï¼šåˆ—å‡ºæŸä¸ªç¨‹åºè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -c mysql</span><br></pre></td></tr></table></figure><p><code>-c</code> é€‰é¡¹å°†ä¼šåˆ—å‡ºæ‰€æœ‰ä»¥mysqlè¿™ä¸ªè¿›ç¨‹å¼€å¤´çš„ç¨‹åºçš„æ–‡ä»¶ï¼Œå…¶å®ä¹Ÿå¯ä»¥å†™æˆ <code>lsof | grep mysql</code></p><h3 id="å®ä¾‹5ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·ä»¥åŠæŸä¸ªè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯"><a href="#å®ä¾‹5ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·ä»¥åŠæŸä¸ªè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="å®ä¾‹5ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·ä»¥åŠæŸä¸ªè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯"></a>å®ä¾‹5ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·ä»¥åŠæŸä¸ªè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span>  -u <span class="built_in">test</span> -c mysql</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹6ï¼šé€šè¿‡æŸä¸ªè¿›ç¨‹å·æ˜¾ç¤ºè¯¥è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶"><a href="#å®ä¾‹6ï¼šé€šè¿‡æŸä¸ªè¿›ç¨‹å·æ˜¾ç¤ºè¯¥è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶" class="headerlink" title="å®ä¾‹6ï¼šé€šè¿‡æŸä¸ªè¿›ç¨‹å·æ˜¾ç¤ºè¯¥è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶"></a>å®ä¾‹6ï¼šé€šè¿‡æŸä¸ªè¿›ç¨‹å·æ˜¾ç¤ºè¯¥è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -p 11968</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹7ï¼šåˆ—å‡ºæ‰€æœ‰çš„ç½‘ç»œè¿æ¥"><a href="#å®ä¾‹7ï¼šåˆ—å‡ºæ‰€æœ‰çš„ç½‘ç»œè¿æ¥" class="headerlink" title="å®ä¾‹7ï¼šåˆ—å‡ºæ‰€æœ‰çš„ç½‘ç»œè¿æ¥"></a>å®ä¾‹7ï¼šåˆ—å‡ºæ‰€æœ‰çš„ç½‘ç»œè¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -i</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹8ï¼šåˆ—å‡ºæ‰€æœ‰tcp-ç½‘ç»œè¿æ¥ä¿¡æ¯"><a href="#å®ä¾‹8ï¼šåˆ—å‡ºæ‰€æœ‰tcp-ç½‘ç»œè¿æ¥ä¿¡æ¯" class="headerlink" title="å®ä¾‹8ï¼šåˆ—å‡ºæ‰€æœ‰tcp ç½‘ç»œè¿æ¥ä¿¡æ¯"></a>å®ä¾‹8ï¼šåˆ—å‡ºæ‰€æœ‰tcp ç½‘ç»œè¿æ¥ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -i tcp</span><br><span class="line"></span><br><span class="line"><span class="variable">$lsof</span> -n -i tcp</span><br><span class="line">COMMAND     PID  USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">svnserve  11552 weber    3u  IPv4 3799399      0t0  TCP *:svn (LISTEN)</span><br><span class="line">redis-ser 25501 weber    4u  IPv4  113150      0t0  TCP 127.0.0.1:6379 (LISTEN)</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹9ï¼šåˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç«¯å£"><a href="#å®ä¾‹9ï¼šåˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç«¯å£" class="headerlink" title="å®ä¾‹9ï¼šåˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç«¯å£"></a>å®ä¾‹9ï¼šåˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -i :3306</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹10ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒçš„ç½‘ç»œç«¯å£"><a href="#å®ä¾‹10ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒçš„ç½‘ç»œç«¯å£" class="headerlink" title="å®ä¾‹10ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒçš„ç½‘ç»œç«¯å£"></a>å®ä¾‹10ï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒçš„ç½‘ç»œç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -a -u <span class="built_in">test</span> -i</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹11ï¼šæ ¹æ®æ–‡ä»¶æè¿°åˆ—å‡ºå¯¹åº”çš„æ–‡ä»¶ä¿¡æ¯"><a href="#å®ä¾‹11ï¼šæ ¹æ®æ–‡ä»¶æè¿°åˆ—å‡ºå¯¹åº”çš„æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="å®ä¾‹11ï¼šæ ¹æ®æ–‡ä»¶æè¿°åˆ—å‡ºå¯¹åº”çš„æ–‡ä»¶ä¿¡æ¯"></a>å®ä¾‹11ï¼šæ ¹æ®æ–‡ä»¶æè¿°åˆ—å‡ºå¯¹åº”çš„æ–‡ä»¶ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -d description(like 2)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -d 3 | grep PARSER1</span><br><span class="line">tail      6499 tde    3r   REG    253,3   4514722     417798 /opt/applog/open/<span class="built_in">log</span>/HOSTPARSER1_ERROR_141217.log.001</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š 0è¡¨ç¤ºæ ‡å‡†è¾“å…¥ï¼Œ1è¡¨ç¤ºæ ‡å‡†è¾“å‡ºï¼Œ2è¡¨ç¤ºæ ‡å‡†é”™è¯¯ï¼Œä»è€Œå¯çŸ¥ï¼šæ‰€ä»¥å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ‰€æ‰“å¼€çš„æ–‡ä»¶çš„ FD éƒ½æ˜¯ä» 3 å¼€å§‹</p><h3 id="å®ä¾‹12ï¼šåˆ—å‡ºè¢«è¿›ç¨‹å·ä¸º1234çš„è¿›ç¨‹æ‰€æ‰“å¼€çš„æ‰€æœ‰IPV4-network-files"><a href="#å®ä¾‹12ï¼šåˆ—å‡ºè¢«è¿›ç¨‹å·ä¸º1234çš„è¿›ç¨‹æ‰€æ‰“å¼€çš„æ‰€æœ‰IPV4-network-files" class="headerlink" title="å®ä¾‹12ï¼šåˆ—å‡ºè¢«è¿›ç¨‹å·ä¸º1234çš„è¿›ç¨‹æ‰€æ‰“å¼€çš„æ‰€æœ‰IPV4 network files"></a>å®ä¾‹12ï¼šåˆ—å‡ºè¢«è¿›ç¨‹å·ä¸º1234çš„è¿›ç¨‹æ‰€æ‰“å¼€çš„æ‰€æœ‰IPV4 network files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsof</span> -i 4 -a -p 1234</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹13ï¼šåˆ—å‡ºç›®å‰è¿æ¥ä¸»æœºnf5260i5-tdä¸Šç«¯å£ä¸ºï¼š20ï¼Œ21ï¼Œ80ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œä¸”æ¯éš”3ç§’é‡å¤æ‰§è¡Œ"><a href="#å®ä¾‹13ï¼šåˆ—å‡ºç›®å‰è¿æ¥ä¸»æœºnf5260i5-tdä¸Šç«¯å£ä¸ºï¼š20ï¼Œ21ï¼Œ80ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œä¸”æ¯éš”3ç§’é‡å¤æ‰§è¡Œ" class="headerlink" title="å®ä¾‹13ï¼šåˆ—å‡ºç›®å‰è¿æ¥ä¸»æœºnf5260i5-tdä¸Šç«¯å£ä¸ºï¼š20ï¼Œ21ï¼Œ80ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œä¸”æ¯éš”3ç§’é‡å¤æ‰§è¡Œ"></a>å®ä¾‹13ï¼šåˆ—å‡ºç›®å‰è¿æ¥ä¸»æœºnf5260i5-tdä¸Šç«¯å£ä¸ºï¼š20ï¼Œ21ï¼Œ80ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œä¸”æ¯éš”3ç§’é‡å¤æ‰§è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lsof -i @nf5260i5-td:20,21,80 -r 3</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¢ç§˜httpè¯·æ±‚æŠ¥æ–‡ç»“æ„</title>
      <link href="/2015/11/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8B%E6%8E%A2%E7%A7%98http%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84/"/>
      <url>/2015/11/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8B%E6%8E%A2%E7%A7%98http%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>HTTPè¯·æ±‚æŠ¥æ–‡ç”±å®¢æˆ·ç«¯å‘å‡ºï¼Œåœ¨å‘é€æŠ¥æ–‡ä¹‹å‰è¦å…ˆä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼Œå¦‚æœä½¿ç”¨HTTPSåè®®è¿˜éœ€è¦å»ºç«‹TLS/SSLåŠ å¯†éš§é“è¿æ¥ï¼ŒHTTPè¯·æ±‚æŠ¥æ–‡æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆ: <strong>è¯·æ±‚è¡Œ</strong>, <strong>è¯·æ±‚æŠ¥å¤´</strong>å’Œ<strong>è¯·æ±‚æ­£æ–‡</strong>ã€‚</p><a id="more"></a><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯å¯¹www.google.comå‘å‡ºçš„è¯·æ±‚æŠ¥æ–‡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Google Dev Toolsä¸­æŸ¥çœ‹ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.2</span><br><span class="line"><span class="attribute">accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">accept-encoding</span>: gzip, deflate, br</span><br><span class="line"><span class="attribute">accept-language</span>: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6</span><br><span class="line"><span class="attribute">cache-control</span>: no-cache</span><br><span class="line"><span class="attribute">cookie</span>: OTZ=4569705_24_24__24_; _ga=GA1.1.1839148291.1537105919; HSID=AOuQZEx7qIgKNr4Gg; SSID=sdsdfgGFWWA...</span><br><span class="line"><span class="attribute">dnt</span>: 1</span><br><span class="line"><span class="attribute">pragma</span>: no-cache</span><br><span class="line"><span class="attribute">upgrade-insecure-requests</span>: 1</span><br><span class="line"><span class="attribute">user-agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 Safari/537.36</span><br></pre></td></tr></table></figure><h3 id="HTTPè¯·æ±‚è¡Œ"><a href="#HTTPè¯·æ±‚è¡Œ" class="headerlink" title="HTTPè¯·æ±‚è¡Œ"></a>HTTPè¯·æ±‚è¡Œ</h3><p>è¯·æ±‚è¡Œæ ‡ç¤ºè¯·æ±‚æ–¹æ³•ã€è¯·æ±‚èµ„æºç›¸å¯¹åœ°å€å’ŒHTTPåè®®ç‰ˆæœ¬</p><h4 id="å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•"><a href="#å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•" class="headerlink" title="å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•"></a>å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•</h4><div class="table-container"><table><thead><tr><th>è¯·æ±‚æ–¹æ³•</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>GET</td><td>GETæ–¹æ³•è¯·æ±‚ä¸€ä¸ªæŒ‡å®šèµ„æºçš„è¡¨ç¤ºå½¢å¼. ä½¿ç”¨GETçš„è¯·æ±‚åº”è¯¥åªè¢«ç”¨äºè·å–æ•°æ®.</td></tr><tr><td>POST</td><td>POSTæ–¹æ³•ç”¨äºå°†å®ä½“æäº¤åˆ°æŒ‡å®šçš„èµ„æºï¼Œé€šå¸¸å¯¼è‡´çŠ¶æ€æˆ–æœåŠ¡å™¨ä¸Šçš„å‰¯ä½œç”¨çš„æ›´æ”¹.</td></tr><tr><td>PUT</td><td>PUTæ–¹æ³•ç”¨è¯·æ±‚æœ‰æ•ˆè½½è·æ›¿æ¢ç›®æ ‡èµ„æºçš„æ‰€æœ‰å½“å‰è¡¨ç¤ºã€‚</td></tr><tr><td>DELETE</td><td>DELETEæ–¹æ³•åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚</td></tr><tr><td>HEAD</td><td>HEADæ–¹æ³•è¯·æ±‚ä¸€ä¸ªä¸GETè¯·æ±‚çš„å“åº”ç›¸åŒçš„å“åº”ï¼Œä½†æ²¡æœ‰å“åº”ä½“.</td></tr><tr><td>CONNECT</td><td>CONNECTæ–¹æ³•å»ºç«‹ä¸€ä¸ªåˆ°ç”±ç›®æ ‡èµ„æºæ ‡è¯†çš„æœåŠ¡å™¨çš„éš§é“ã€‚</td></tr><tr><td>OPTIONS</td><td>OPTIONSæ–¹æ³•ç”¨äºæè¿°ç›®æ ‡èµ„æºçš„é€šä¿¡é€‰é¡¹ã€‚</td></tr><tr><td>TRACE</td><td>TRACEæ–¹æ³•æ²¿ç€åˆ°ç›®æ ‡èµ„æºçš„è·¯å¾„æ‰§è¡Œä¸€ä¸ªæ¶ˆæ¯ç¯å›æµ‹è¯•ã€‚</td></tr><tr><td>PATCH</td><td>PATCHæ–¹æ³•ç”¨äºå¯¹èµ„æºåº”ç”¨éƒ¨åˆ†ä¿®æ”¹ã€‚</td></tr></tbody></table></div><h3 id="HTTPè¯·æ±‚æŠ¥å¤´"><a href="#HTTPè¯·æ±‚æŠ¥å¤´" class="headerlink" title="HTTPè¯·æ±‚æŠ¥å¤´"></a>HTTPè¯·æ±‚æŠ¥å¤´</h3><p>åŒ…å«è¯·æ±‚çš„é™„åŠ ä¿¡æ¯å’Œå®¢æˆ·ç«¯çš„æ ‡è¯†ä¿¡æ¯ã€‚</p><h4 id="å¸¸ç”¨æ ‡å‡†è¯·æ±‚å¤´å­—æ®µï¼š"><a href="#å¸¸ç”¨æ ‡å‡†è¯·æ±‚å¤´å­—æ®µï¼š" class="headerlink" title="å¸¸ç”¨æ ‡å‡†è¯·æ±‚å¤´å­—æ®µï¼š"></a>å¸¸ç”¨æ ‡å‡†è¯·æ±‚å¤´å­—æ®µï¼š</h4><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>Accept</strong></td><td>è®¾ç½®æ¥å—çš„å†…å®¹ç±»å‹</td><td>Accept: text/plain</td></tr><tr><td><strong>Accept-Charset</strong></td><td>è®¾ç½®æ¥å—çš„å­—ç¬¦ç¼–ç </td><td>Accept-Charset: utf-8</td></tr><tr><td><strong>Accept-Encoding</strong></td><td>è®¾ç½®æ¥å—çš„ç¼–ç æ ¼å¼</td><td>Accept-Encoding: gzip, deflate</td></tr><tr><td><strong>Accept-Datetime</strong></td><td>è®¾ç½®æ¥å—çš„ç‰ˆæœ¬æ—¶é—´</td><td>Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</td></tr><tr><td><strong>Accept-Language</strong></td><td>è®¾ç½®æ¥å—çš„è¯­è¨€</td><td>Accept-Language: en-US</td></tr><tr><td><strong>Authorization</strong></td><td>è®¾ç½®HTTPèº«ä»½éªŒè¯çš„å‡­è¯</td><td>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td><strong>Cache-Control</strong></td><td>è®¾ç½®è¯·æ±‚å“åº”é“¾ä¸Šæ‰€æœ‰çš„ç¼“å­˜æœºåˆ¶å¿…é¡»éµå®ˆçš„æŒ‡ä»¤</td><td>Cache-Control: no-cache</td></tr><tr><td><strong>Connection</strong></td><td>è®¾ç½®å½“å‰è¿æ¥å’Œhop-by-hopåè®®è¯·æ±‚å­—æ®µåˆ—è¡¨çš„æ§åˆ¶é€‰é¡¹</td><td>Connection: keep-alive<br />Connection: Upgrade</td></tr><tr><td><strong>Content-Length</strong></td><td>è®¾ç½®è¯·æ±‚ä½“çš„å­—èŠ‚é•¿åº¦</td><td>Content-Length: 348</td></tr><tr><td><strong>Content-MD5</strong></td><td>è®¾ç½®åŸºäºMD5ç®—æ³•å¯¹è¯·æ±‚ä½“å†…å®¹è¿›è¡ŒBase64äºŒè¿›åˆ¶ç¼–ç </td><td>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td><strong>Content-Type</strong></td><td>è®¾ç½®è¯·æ±‚ä½“çš„MIMEç±»å‹ï¼ˆé€‚ç”¨POSTå’ŒPUTè¯·æ±‚ï¼‰</td><td>Content-Type: application/x-www-form-urlencoded</td></tr><tr><td><strong>Cookie</strong></td><td>è®¾ç½®æœåŠ¡å™¨ä½¿ç”¨Set-Cookieå‘é€çš„http cookie</td><td>Cookie: $Version=1; Skin=new;</td></tr><tr><td><strong>Date</strong></td><td>è®¾ç½®æ¶ˆæ¯å‘é€çš„æ—¥æœŸå’Œæ—¶é—´</td><td>Date: Tue, 15 Nov 1994 08:12:31 GMT</td></tr><tr><td><strong>Expect</strong></td><td>æ ‡è¯†å®¢æˆ·ç«¯éœ€è¦çš„ç‰¹æ®Šæµè§ˆå™¨è¡Œä¸º</td><td>Expect: 100-continue</td></tr><tr><td><strong>Forwarded</strong></td><td>æŠ«éœ²å®¢æˆ·ç«¯é€šè¿‡httpä»£ç†è¿æ¥webæœåŠ¡çš„æºä¿¡æ¯</td><td>Forwarded: for=192.0.2.60;proto=http;by=203.0.113.43 <br />Forwarded: for=192.0.2.43, for=198.51.100.17</td></tr><tr><td><strong>From</strong></td><td>è®¾ç½®å‘é€è¯·æ±‚çš„ç”¨æˆ·çš„emailåœ°å€</td><td>From: <a href="https://link.jianshu.com/?t=mailto:user@example.com">user@example.com</a></td></tr><tr><td><strong>Host</strong></td><td>è®¾ç½®æœåŠ¡å™¨åŸŸåå’ŒTCPç«¯å£å·ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æœåŠ¡è¯·æ±‚æ ‡å‡†ç«¯å£å·ï¼Œç«¯å£å·å¯ä»¥çœç•¥</td><td>Host: en.wikipedia.org:8080<br/>Host: en.wikipedia.org</td></tr><tr><td><strong>If-Match</strong></td><td>è®¾ç½®å®¢æˆ·ç«¯çš„ETag,å½“æ—¶å®¢æˆ·ç«¯ETagå’ŒæœåŠ¡å™¨ç”Ÿæˆçš„ETagä¸€è‡´æ‰æ‰§è¡Œï¼Œé€‚ç”¨äºæ›´æ–°è‡ªä»ä¸Šæ¬¡æ›´æ–°ä¹‹åæ²¡æœ‰æ”¹å˜çš„èµ„æº</td><td>If-Match: â€œ737060cd8c284d8af7ad3082f209582d</td></tr><tr><td><strong>If-Modified-Since</strong></td><td>è®¾ç½®æ›´æ–°æ—¶é—´ï¼Œä»æ›´æ–°æ—¶é—´åˆ°æœåŠ¡ç«¯æ¥å—è¯·æ±‚è¿™æ®µæ—¶é—´å†…å¦‚æœèµ„æºæ²¡æœ‰æ”¹å˜ï¼Œå…è®¸æœåŠ¡ç«¯è¿”å›304 Not Modified</td><td>If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td><strong>If-None-Match</strong></td><td>è®¾ç½®å®¢æˆ·ç«¯ETagï¼Œå¦‚æœå’ŒæœåŠ¡ç«¯æ¥å—è¯·æ±‚ç”Ÿæˆçš„ETageç›¸åŒï¼Œå…è®¸æœåŠ¡ç«¯è¿”å›304 Not Modified</td><td>If-None-Match: â€œ737060cd8c284d8af7ad3082f209582dâ€</td></tr><tr><td><strong>If-Range</strong></td><td>è®¾ç½®å®¢æˆ·ç«¯ETagï¼Œå¦‚æœå’ŒæœåŠ¡ç«¯æ¥å—è¯·æ±‚ç”Ÿæˆçš„ETageç›¸åŒï¼Œè¿”å›ç¼ºå¤±çš„å®ä½“éƒ¨åˆ†ï¼›å¦åˆ™è¿”å›æ•´ä¸ªæ–°çš„å®ä½“</td><td>If-Range: â€œ737060cd8c284d8af7ad3082f209582dâ€</td></tr><tr><td><strong>If-Unmodified-Since</strong></td><td>è®¾ç½®æ›´æ–°æ—¶é—´ï¼Œåªæœ‰ä»æ›´æ–°æ—¶é—´åˆ°æœåŠ¡ç«¯æ¥å—è¯·æ±‚è¿™æ®µæ—¶é—´å†…å®ä½“æ²¡æœ‰æ”¹å˜ï¼ŒæœåŠ¡ç«¯æ‰ä¼šå‘é€å“åº”</td><td>If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td><strong>Max-Forwards</strong></td><td>é™åˆ¶ä»£ç†æˆ–ç½‘å…³è½¬å‘æ¶ˆæ¯çš„æ¬¡æ•°</td><td>Max-Forwards: 10</td></tr><tr><td><strong>Origin</strong></td><td>æ ‡è¯†è·¨åŸŸèµ„æºè¯·æ±‚ï¼ˆè¯·æ±‚æœåŠ¡ç«¯è®¾ç½®Access-Control-Allow-Originå“åº”å­—æ®µï¼‰</td><td>Origin: <code>http://www.example-social-network.com</code></td></tr><tr><td><strong>Pragma</strong></td><td>è®¾ç½®ç‰¹æ®Šå®ç°å­—æ®µï¼Œå¯èƒ½ä¼šå¯¹è¯·æ±‚å“åº”é“¾æœ‰å¤šç§å½±å“</td><td>Pragma: no-cache</td></tr><tr><td><strong>Proxy-Authorization</strong></td><td>ä¸ºè¿æ¥ä»£ç†æˆæƒè®¤è¯ä¿¡æ¯</td><td>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td><strong>Range</strong></td><td>è¯·æ±‚éƒ¨åˆ†å®ä½“ï¼Œè®¾ç½®è¯·æ±‚å®ä½“çš„å­—èŠ‚æ•°èŒƒå›´ï¼Œå…·ä½“å¯ä»¥å‚è§HTTP/1.1ä¸­çš„Byte serving</td><td>Range: bytes=500-999</td></tr><tr><td><strong>Referer</strong></td><td>è®¾ç½®å‰ä¸€ä¸ªé¡µé¢çš„åœ°å€ï¼Œå¹¶ä¸”å‰ä¸€ä¸ªé¡µé¢ä¸­çš„è¿æ¥æŒ‡å‘å½“å‰è¯·æ±‚ï¼Œæ„æ€å°±æ˜¯å¦‚æœå½“å‰è¯·æ±‚æ˜¯åœ¨Aé¡µé¢ä¸­å‘é€çš„ï¼Œé‚£ä¹ˆrefererå°±æ˜¯Aé¡µé¢çš„urlåœ°å€</td><td>Referer: <code>http://en.wikipedia.org/wiki/Main_Page</code></td></tr><tr><td><strong>TE</strong></td><td>è®¾ç½®ç”¨æˆ·ä»£ç†æœŸæœ›æ¥å—çš„ä¼ è¾“ç¼–ç æ ¼å¼ï¼Œå’Œå“åº”å¤´ä¸­çš„Transfer-Encodingå­—æ®µä¸€æ ·</td><td>TE: trailers, deflate</td></tr><tr><td><strong>Upgrade</strong></td><td>è¯·æ±‚æœåŠ¡ç«¯å‡çº§åè®®</td><td>Upgrade: HTTP/2.0, HTTPS/1.3, IRC/6.9, RTA/x11, websocket</td></tr><tr><td><strong>User-Agent</strong></td><td>ç”¨æˆ·ä»£ç†çš„å­—ç¬¦ä¸²å€¼</td><td>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 Safari/537.36</td></tr><tr><td><strong>Via</strong></td><td>é€šçŸ¥æœåŠ¡å™¨ä»£ç†è¯·æ±‚</td><td>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</td></tr><tr><td><strong>Warning</strong></td><td>å®ä½“å¯èƒ½ä¼šå‘ç”Ÿçš„é—®é¢˜çš„é€šç”¨è­¦å‘Š</td><td>Warning: 199 Miscellaneous warning</td></tr></tbody></table></div><h4 id="å¸¸ç”¨éæ ‡å‡†è¯·æ±‚å¤´å­—æ®µ"><a href="#å¸¸ç”¨éæ ‡å‡†è¯·æ±‚å¤´å­—æ®µ" class="headerlink" title="å¸¸ç”¨éæ ‡å‡†è¯·æ±‚å¤´å­—æ®µ"></a>å¸¸ç”¨éæ ‡å‡†è¯·æ±‚å¤´å­—æ®µ</h4><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th><th style="text-align:left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>X-Requested-With</strong></td><td>æ ‡è¯†Ajaxè¯·æ±‚ï¼Œå¤§éƒ¨åˆ†jsæ¡†æ¶å‘é€è¯·æ±‚æ—¶éƒ½ä¼šè®¾ç½®å®ƒä¸ºXMLHttpRequest</td><td style="text-align:left">X-Requested-With: XMLHttpRequest</td></tr><tr><td><strong>DNT</strong></td><td>è¯·æ±‚webåº”ç”¨ç¦ç”¨ç”¨æˆ·è¿½è¸ª</td><td style="text-align:left">DNT: 1 (Do Not Track Enabled) <br />DNT: 0 (Do Not Track Disabled)</td></tr><tr><td><strong>X-Forwarded-For</strong></td><td>ä¸€ä¸ªäº‹å®æ ‡å‡†ï¼Œç”¨æ¥æ ‡è¯†å®¢æˆ·ç«¯é€šè¿‡HTTPä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡å™¨è¿æ¥çš„webæœåŠ¡å™¨çš„åŸå§‹IPåœ°å€</td><td style="text-align:left">X-Forwarded-For: client1, proxy1, proxy2<br/>X-Forwarded-For: 129.78.138.66, 129.78.64.103</td></tr><tr><td><strong>X-Forwarded-Host</strong></td><td>ä¸€ä¸ªäº‹å®æ ‡å‡†ï¼Œç”¨æ¥æ ‡è¯†å®¢æˆ·ç«¯åœ¨HTTPè¯·æ±‚å¤´ä¸­è¯·æ±‚çš„åŸå§‹host,å› ä¸ºä¸»æœºåæˆ–è€…åå‘ä»£ç†çš„ç«¯å£å¯èƒ½ä¸å¤„ç†è¯·æ±‚çš„åŸå§‹æœåŠ¡å™¨ä¸åŒ</td><td style="text-align:left">X-Forwarded-Host: en.wikipedia.org:8080<br/>X-Forwarded-Host: en.wikipedia.org</td></tr><tr><td><strong>X-Forwarded-Proto</strong></td><td>ä¸€ä¸ªäº‹å®æ ‡å‡†ï¼Œç”¨æ¥æ ‡è¯†HTTPåŸå§‹åè®®ï¼Œå› ä¸ºåå‘ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡å™¨å’ŒwebæœåŠ¡å™¨å¯èƒ½ä½¿ç”¨http,ä½†æ˜¯è¯·æ±‚åˆ°åå‘ä»£ç†ä½¿ç”¨çš„æ˜¯https</td><td style="text-align:left">X-Forwarded-Proto: https</td></tr><tr><td><strong>Front-End-Https</strong></td><td>å¾®è½¯åº”ç”¨ç¨‹åºå’Œè´Ÿè½½å‡è¡¡å™¨ä½¿ç”¨çš„éæ ‡å‡†headerå­—æ®µ</td><td style="text-align:left">Front-End-Https: on</td></tr><tr><td><strong>X-Http-Method-Override</strong></td><td>è¯·æ±‚webåº”ç”¨æ—¶ï¼Œä½¿ç”¨headerå­—æ®µä¸­ç»™å®šçš„æ–¹æ³•ï¼ˆé€šå¸¸æ˜¯putæˆ–è€…deleteï¼‰è¦†ç›–è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ï¼ˆé€šå¸¸æ˜¯postï¼‰,<br />å¦‚æœç”¨æˆ·ä»£ç†æˆ–è€…é˜²ç«å¢™ä¸æ”¯æŒç›´æ¥ä½¿ç”¨putæˆ–è€…deleteæ–¹æ³•å‘é€è¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µ</td><td style="text-align:left">X-HTTP-Method-Override: DELETE</td></tr><tr><td><strong>X-ATT-DeviceId</strong></td><td>å…è®¸æ›´ç®€å•çš„è§£æç”¨æˆ·ä»£ç†åœ¨AT&amp;Tè®¾å¤‡ä¸Šçš„MakeModel/Firmware</td><td style="text-align:left">X-Att-Deviceid: GT-P7320/P7320XXLPG</td></tr><tr><td><strong>X-Wap-Profile</strong></td><td>è®¾ç½®æè¿°å½“å‰è¿æ¥è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯çš„xmlæ–‡ä»¶åœ¨ç½‘ç»œä¸­çš„ä½ç½®</td><td style="text-align:left">x-wap-profile: <code>http://wap.samsungmobile.com/uaprof/SGH-I777.xml</code></td></tr><tr><td><strong>Proxy-Connection</strong></td><td>æ—©èµ·HTTPç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªè¯¯ç§°ï¼Œç°åœ¨ä½¿ç”¨æ ‡å‡†çš„connectionå­—æ®µ</td><td style="text-align:left">Proxy-Connection: keep-alive</td></tr><tr><td><strong>X-UIDH</strong></td><td>æœåŠ¡ç«¯æ·±åº¦åŒ…æ£€æµ‹æ’å…¥çš„ä¸€ä¸ªå”¯ä¸€IDæ ‡è¯†Verizon Wirelessçš„å®¢æˆ·</td><td style="text-align:left">X-UIDH: â€¦</td></tr><tr><td><strong>X-Csrf-Token,X-CSRFToken,X-XSRF-TOKEN</strong></td><td>é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ </td><td style="text-align:left">X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql</td></tr><tr><td><strong>X-Request-ID,X-Correlation-ID</strong></td><td>æ ‡è¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„HTTPè¯·æ±‚</td><td style="text-align:left">X-Request-ID: f058ebd6-02f7-4d3f-942e-904344e8cde5</td></tr></tbody></table></div><h3 id="HTTPè¯·æ±‚æ­£æ–‡"><a href="#HTTPè¯·æ±‚æ­£æ–‡" class="headerlink" title="HTTPè¯·æ±‚æ­£æ–‡"></a>HTTPè¯·æ±‚æ­£æ–‡</h3><p>å½“ä½¿ç”¨POST, PUTç­‰æ–¹æ³•æ—¶ï¼Œéœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’å‚æ•°ã€‚è¿™äº›æ•°æ®å°±å‚¨å­˜åœ¨è¯·æ±‚æ­£æ–‡ä¸­ã€‚åœ¨è¯·æ±‚æŠ¥å¤´ä¸­æœ‰ä¸€äº›ä¸è¯·æ±‚æ­£æ–‡ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚: ç°åœ¨çš„Webåº”ç”¨é€šå¸¸é‡‡ç”¨Restfulæ¶æ„ï¼Œè¯·æ±‚çš„æ•°æ®æ ¼å¼ä¸€èˆ¬ä¸ºjsonã€‚è¿™æ—¶å°±éœ€è¦è®¾ç½®Content-Type: application/jsonã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> HTTP/HTTPS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¢ç§˜httpå“åº”æŠ¥æ–‡ç»“æ„</title>
      <link href="/2015/11/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8B%E6%8E%A2%E7%A7%98http%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84/"/>
      <url>/2015/11/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%8B%E6%8E%A2%E7%A7%98http%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>HTTPå“åº”æŠ¥æ–‡é€šè¿‡é€šä¿¡åŒæ–¹å»ºç«‹çš„TCPè¿æ¥ä¼ é€ï¼Œä¼ é€å®Œæˆåæ ¹æ®HTTPåè®®ä¸­çš„Connectionå­—æ®µç¡®å®šæ˜¯å¦è¦ç»§ç»­ä¿æŒTCPè¿æ¥ã€‚HTTP å“åº”æŠ¥æ–‡ç”±çŠ¶æ€è¡Œã€å“åº”å¤´éƒ¨ å’Œ å“åº”åŒ…ä½“ 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><a id="more"></a><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>ä»¥è®¿é—®www.baidu.comä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥<kbd>âŒ¥</kbd> +<kbd>âŒ˜</kbd> +<kbd>j</kbd>æ‰“å¼€Chrome Dev Toolsæ¥çœ‹ä¸€ä¸ªå®ä¾‹ã€‚</p><p>ã€</p><p>å±•å¼€Response Headersé€‰é¡¹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å“åº”æŠ¥æ–‡ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Bdpagetype</span>: 2</span><br><span class="line"><span class="attribute">Bdqid</span>: 0xb8a2e3a70000a2ab</span><br><span class="line"><span class="attribute">Cache-Control</span>: private</span><br><span class="line"><span class="attribute">Connection</span>: Keep-Alive</span><br><span class="line"><span class="attribute">Content-Encoding</span>: gzip</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html;charset=utf-8</span><br><span class="line"><span class="attribute">Date</span>: Mon, 01 Oct 2018 08:11:18 GMT</span><br><span class="line"><span class="attribute">Expires</span>: Mon, 01 Oct 2018 08:11:17 GMT</span><br><span class="line"><span class="attribute">Server</span>: BWS/1.1</span><br><span class="line"><span class="attribute">Set-Cookie</span>: BDSVRTM=171; path=/</span><br><span class="line"><span class="attribute">Set-Cookie</span>: BD_HOME=1; path=/</span><br><span class="line"><span class="attribute">Set-Cookie</span>: H_PS_PSSID=xxxxxxxx; path=/; domain=.baidu.com</span><br><span class="line"><span class="attribute">Strict-Transport-Security</span>: max-age=172800</span><br><span class="line"><span class="attribute">X-Ua-Compatible</span>: IE=Edge,chrome=1</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè€Œä¸‹åˆ†åˆ«æ˜¯æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼šçŠ¶æ€è¡Œï¼Œå“åº”å¤´éƒ¨å’Œå“åº”åŒ…ä½“ã€‚</p><h3 id="HTTPå“åº”çŠ¶æ€è¡Œ"><a href="#HTTPå“åº”çŠ¶æ€è¡Œ" class="headerlink" title="HTTPå“åº”çŠ¶æ€è¡Œ"></a>HTTPå“åº”çŠ¶æ€è¡Œ</h3><p>çŠ¶æ€è¡Œç”±åè®®ç‰ˆæœ¬ å“åº”ç  å’Œå“åº”æè¿°ç»„æˆ</p><h4 id="å“åº”ç "><a href="#å“åº”ç " class="headerlink" title="å“åº”ç "></a>å“åº”ç </h4><p>æ ¹æ®å®¢æˆ·ç«¯çš„HTTPè¯·æ±‚ï¼Œä¼šäº§ç”Ÿä¸åŒçš„HTTPå“åº”çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ç”¨çŠ¶æ€ç æ¥è¡¨ç¤ºã€‚</p><p>æŒ‰ç…§åˆ†ç±»ï¼Œå“åº”å¤§æ¦‚åˆ†ä¸ºä»¥ä¸‹å‡ å¤§ç±»ï¼š</p><div class="table-container"><table><thead><tr><th>çŠ¶æ€ç </th><th>å“åº”ç±»åˆ«</th><th>åŸå› çŸ­è¯­</th></tr></thead><tbody><tr><td>1XX</td><td>ä¿¡æ¯æ€§çŠ¶æ€ç ï¼ˆInformationalï¼‰</td><td>æœåŠ¡å™¨æ­£åœ¨å¤„ç†è¯·æ±‚</td></tr><tr><td>2XX</td><td>æˆåŠŸçŠ¶æ€ç ï¼ˆSuccessï¼‰</td><td>è¯·æ±‚å·²æ­£å¸¸å¤„ç†å®Œæ¯•</td></tr><tr><td>3XX</td><td>é‡å®šå‘çŠ¶æ€ç ï¼ˆRedirectionï¼‰</td><td>éœ€è¦è¿›è¡Œé¢å¤–æ“ä½œä»¥å®Œæˆè¯·æ±‚</td></tr><tr><td>4XX</td><td>å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼ˆClient Errorï¼‰</td><td>å®¢æˆ·ç«¯åŸå› å¯¼è‡´æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚</td></tr><tr><td>5XX</td><td>æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼ˆServer Errorï¼‰</td><td>æœåŠ¡å™¨åŸå› å¯¼è‡´å¤„ç†è¯·æ±‚å‡ºé”™</td></tr></tbody></table></div><p>å¸¸ç”¨çš„çŠ¶æ€ç æœ‰200ï¼Œ204ï¼Œ207ï¼Œ301ï¼Œ302ï¼Œ303ï¼Œ304ï¼Œ307ï¼Œ400ï¼Œ401ï¼Œ403ï¼Œ404ï¼Œ500ï¼Œ503è¿™äº›</p><ul><li>200 OK è¡¨ç¤ºè¯·æ±‚è¢«æœåŠ¡å™¨æ­£å¸¸å¤„ç†</li><li>204 No Content è¡¨ç¤ºè¯·æ±‚å·²æˆåŠŸå¤„ç†ï¼Œä½†æ˜¯æ²¡æœ‰å†…å®¹è¿”å›</li><li>206 Partial Content è¡¨ç¤ºæœåŠ¡å™¨å·²ç»å®Œæˆäº†éƒ¨åˆ†GETè¯·æ±‚</li><li>301 Moved Permanently æ°¸ä¹…é‡å®šå‘ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²ç»æ°¸ä¹…çš„æ¬åˆ°äº†å…¶ä»–ä½ç½®</li><li>302 Found ä¸´æ—¶é‡å®šå‘ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸´æ—¶æ¬åˆ°äº†å…¶ä»–ä½ç½®</li><li>303 See Other è¡¨ç¤ºè¯·æ±‚èµ„æºå­˜åœ¨å¦ä¸€ä¸ªURIï¼Œåº”ä½¿ç”¨GETå®šå‘è·å–è¯·æ±‚èµ„æº</li><li>304 Not Modified è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€é™„å¸¦æ¡ä»¶çš„è¯·æ±‚ï¼ˆGETæ–¹æ³•è¯·æ±‚æŠ¥æ–‡ä¸­çš„IFâ€¦ï¼‰æ—¶ï¼Œæ¡ä»¶ä¸æ»¡è¶³</li><li>307 Temporary Redirect ä¸´æ—¶é‡å®šå‘ï¼Œå’Œ302æœ‰ç€ç›¸åŒå«ä¹‰</li><li>400 Bad Request è¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡å­˜åœ¨è¯­æ³•é”™è¯¯æˆ–å‚æ•°é”™è¯¯ï¼ŒæœåŠ¡å™¨ä¸ç†è§£</li><li>401 Unauthorized è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰HTTPè®¤è¯ä¿¡æ¯æˆ–è€…æ˜¯è®¤è¯å¤±è´¥äº†</li><li>403 Forbidden è¡¨ç¤ºå¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†</li><li>404 Not Found è¡¨ç¤ºæœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„èµ„æº</li><li>500 Internal Server Error è¡¨ç¤ºæœåŠ¡å™¨æ‰§è¡Œè¯·æ±‚çš„æ—¶å€™å‡ºé”™äº†</li><li>503 Service Unavailable è¡¨ç¤ºæœåŠ¡å™¨è¶…è´Ÿè½½æˆ–æ­£åœæœºç»´æŠ¤ï¼Œæ— æ³•å¤„ç†è¯·æ±‚</li></ul><h3 id="HTTPå“åº”å¤´éƒ¨"><a href="#HTTPå“åº”å¤´éƒ¨" class="headerlink" title="HTTPå“åº”å¤´éƒ¨"></a>HTTPå“åº”å¤´éƒ¨</h3><p>å“åº”å¤´éƒ¨ç”±è‹¥å¹²å“åº”å¤´éƒ¨å­—æ®µç»„æˆï¼Œè¿™äº›å­—æ®µç±»ä¼¼äºé”®å€¼å¯¹å½¢å¼ï¼Œæ¯ä¸ªå­—æ®µå æ®ä¸€è¡Œã€‚</p><h4 id="å¸¸ç”¨æ ‡å‡†å“åº”å¤´å­—æ®µ"><a href="#å¸¸ç”¨æ ‡å‡†å“åº”å¤´å­—æ®µ" class="headerlink" title="å¸¸ç”¨æ ‡å‡†å“åº”å¤´å­—æ®µ"></a>å¸¸ç”¨æ ‡å‡†å“åº”å¤´å­—æ®µ</h4><div class="table-container"><table><thead><tr><th>å­—æ®µå</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>Access-Control-Allow-Origin</strong></td><td>æŒ‡å®šå“ªäº›ç«™ç‚¹å¯ä»¥å‚ä¸è·¨ç«™èµ„æºå…±äº«</td><td>Access-Control-Allow-Origin: *</td></tr><tr><td><strong>Accept-Patch</strong></td><td>æŒ‡å®šæœåŠ¡å™¨æ”¯æŒçš„è¡¥ä¸æ–‡æ¡£æ ¼å¼ï¼Œé€‚ç”¨äºhttpçš„patchæ–¹æ³•</td><td>Accept-Patch: text/example;charset=utf-8</td></tr><tr><td><strong>Accept-Ranges</strong></td><td>æœåŠ¡å™¨é€šè¿‡byte servingæ”¯æŒçš„éƒ¨åˆ†å†…å®¹èŒƒå›´ç±»å‹</td><td>Accept-Ranges: bytes</td></tr><tr><td><strong>Age</strong></td><td>å¯¹è±¡åœ¨ä»£ç†ç¼“å­˜ä¸­æš‚å­˜çš„ç§’æ•°</td><td>Age: 1200</td></tr><tr><td><strong>Allow</strong></td><td>è®¾ç½®ç‰¹å®šèµ„æºçš„æœ‰æ•ˆè¡Œä¸ºï¼Œé€‚ç”¨æ–¹æ³•ä¸è¢«å…è®¸çš„http 405é”™è¯¯</td><td>Allow: GET, HEAD</td></tr><tr><td><strong>Alt-Svc</strong></td><td>æœåŠ¡å™¨ä½¿ç”¨â€Alt-Svcâ€ï¼ˆAlternative Servicesdeçš„ç¼©å†™ï¼‰å¤´æ ‡è¯†èµ„æºå¯ä»¥é€šè¿‡ä¸åŒçš„ç½‘ç»œä½ç½®æˆ–è€…ä¸åŒçš„ç½‘ç»œåè®®è·å–</td><td>Alt-Svc: h2=â€http2.example.com:443â€; ma=7200</td></tr><tr><td><strong>Cache-Control</strong></td><td>å‘Šè¯‰æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯æ‰€æœ‰çš„ç¼“å­˜æœºåˆ¶æ˜¯å¦å¯ä»¥ç¼“å­˜è¿™ä¸ªå¯¹è±¡ï¼Œå•ä½æ˜¯ç§’</td><td>Cache-Control: max-age=3600</td></tr><tr><td><strong>Connection</strong></td><td>è®¾ç½®å½“å‰è¿æ¥å’Œhop-by-hopåè®®è¯·æ±‚å­—æ®µåˆ—è¡¨çš„æ§åˆ¶é€‰é¡¹</td><td>Connection: close</td></tr><tr><td><strong>Content-Disposition</strong></td><td>å‘Šè¯‰å®¢æˆ·ç«¯å¼¹å‡ºä¸€ä¸ªæ–‡ä»¶ä¸‹è½½æ¡†ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šä¸‹è½½æ–‡ä»¶å</td><td>Content-Disposition: attachment; filename=â€fname.extâ€</td></tr><tr><td><strong>Content-Encoding</strong></td><td>è®¾ç½®æ•°æ®ä½¿ç”¨çš„ç¼–ç ç±»å‹</td><td>Content-Encoding: gzip</td></tr><tr><td><strong>Content-Language</strong></td><td>ä¸ºå°é—­å†…å®¹è®¾ç½®è‡ªç„¶è¯­è¨€æˆ–è€…ç›®æ ‡ç”¨æˆ·è¯­è¨€</td><td>Content-Language: en</td></tr><tr><td><strong>Content-Length</strong></td><td>å“åº”ä½“çš„å­—èŠ‚é•¿åº¦</td><td>Content-Length: 348</td></tr><tr><td><strong>Content-Location</strong></td><td>è®¾ç½®è¿”å›æ•°æ®çš„å¦ä¸€ä¸ªä½ç½®</td><td>Content-Location: /index.htm</td></tr><tr><td><strong>Content-MD5</strong></td><td>è®¾ç½®åŸºäºMD5ç®—æ³•å¯¹å“åº”ä½“å†…å®¹è¿›è¡ŒBase64äºŒè¿›åˆ¶ç¼–ç </td><td>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td><strong>Content-Range</strong></td><td>æ ‡è¯†å“åº”ä½“å†…å®¹å±äºå®Œæ•´æ¶ˆæ¯ä½“ä¸­çš„é‚£ä¸€éƒ¨åˆ†</td><td>Content-Range: bytes 21010-47021/47022</td></tr><tr><td><strong>Content-Type</strong></td><td>è®¾ç½®å“åº”ä½“çš„MIMEç±»å‹</td><td>Content-Type: text/html; charset=utf-8</td></tr><tr><td><strong>Date</strong></td><td>è®¾ç½®æ¶ˆæ¯å‘é€çš„æ—¥æœŸå’Œæ—¶é—´</td><td>Date: Tue, 15 Nov 1996 08:12:31 GMT</td></tr><tr><td><strong>ETag</strong></td><td>ç‰¹å®šç‰ˆæœ¬èµ„æºçš„æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯æ¶ˆæ¯æ‘˜è¦</td><td>ETag: â€œ737060cd8c284d8af7ad3082f209582dâ€</td></tr><tr><td><strong>Expires</strong></td><td>è®¾ç½®å“åº”ä½“çš„è¿‡æœŸæ—¶é—´</td><td>Expires: Thu, 01 Dec 1996 16:00:00 GMT</td></tr><tr><td><strong>Last-Modified</strong></td><td>è®¾ç½®è¯·æ±‚å¯¹è±¡æœ€åä¸€æ¬¡çš„ä¿®æ”¹æ—¥æœŸ</td><td>Last-Modified: Tue, 15 Nov 1994 12:45:26 GMT</td></tr><tr><td><strong>Link</strong></td><td>è®¾ç½®ä¸å…¶ä»–èµ„æºçš„ç±»å‹å…³ç³»</td><td>Link: &lt;/feed&gt;; rel=â€alternateâ€</td></tr><tr><td><strong>Location</strong></td><td>åœ¨é‡å®šå‘ä¸­æˆ–è€…åˆ›å»ºæ–°èµ„æºæ—¶ä½¿ç”¨</td><td>Location: <code>http://www.w3.org/pub/WWW/People.html</code></td></tr><tr><td><strong>P3P</strong></td><td>ä»¥P3P:CP=â€your_compact_policyâ€çš„æ ¼å¼è®¾ç½®æ”¯æŒP3P(Platform for Privacy Preferences Project)ç­–ç•¥ï¼Œ<br />å¤§éƒ¨åˆ†æµè§ˆå™¨æ²¡æœ‰å®Œå…¨æ”¯æŒP3Pç­–ç•¥ï¼Œè®¸å¤šç«™ç‚¹è®¾ç½®å‡çš„ç­–ç•¥å†…å®¹æ¬ºéª—æ”¯æŒP3Pç­–ç•¥çš„æµè§ˆå™¨ä»¥è·å–ç¬¬ä¸‰æ–¹cookieçš„æˆæƒ</td><td>P3P: CP=â€This is not a P3P policy! See <code>http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657</code> for more info.â€</td></tr><tr><td><strong>Pragma</strong></td><td>è®¾ç½®ç‰¹æ®Šå®ç°å­—æ®µï¼Œå¯èƒ½ä¼šå¯¹è¯·æ±‚å“åº”é“¾æœ‰å¤šç§å½±å“</td><td>Pragma: no-cache</td></tr><tr><td><strong>Proxy-Authenticate</strong></td><td>è®¾ç½®è®¿é—®ä»£ç†çš„è¯·æ±‚æƒé™</td><td>Proxy-Authenticate: Basic</td></tr><tr><td><strong>Public-Key-Pins</strong></td><td>è®¾ç½®ç«™ç‚¹çš„æˆæƒTLSè¯ä¹¦</td><td>Public-Key-Pins: max-age=2592000; pin-sha256=â€E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=â€;</td></tr><tr><td><strong>Refresh</strong></td><td>é‡å®šå‘æˆ–è€…æ–°èµ„æºåˆ›å»ºæ—¶ä½¿ç”¨ï¼Œåœ¨é¡µé¢çš„å¤´éƒ¨æœ‰ä¸ªæ‰©å±•å¯ä»¥å®ç°ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ”¯æŒ<br /><meta http-equiv="refresh" content="5; url=http://example.com/"></td><td>Refresh: 5; url=<code>http://www.w3.org/pub/WWW/People.html</code></td></tr><tr><td><strong>Retry-After</strong></td><td>å¦‚æœå®ä½“æš‚æ—¶ä¸å¯ç”¨ï¼Œå¯ä»¥è®¾ç½®è¿™ä¸ªå€¼è®©å®¢æˆ·ç«¯é‡è¯•ï¼Œå¯ä»¥ä½¿ç”¨æ—¶é—´æ®µï¼ˆå•ä½æ˜¯ç§’ï¼‰æˆ–è€…HTTPæ—¶é—´</td><td>Retry-After: 120<br /> Retry-After: Fri, 07 Nov 2014 23:59:59 GMT</td></tr><tr><td><strong>Server</strong></td><td>æœåŠ¡å™¨åç§°</td><td>Server: nginx/1.14.0 (Ubuntu)</td></tr><tr><td><strong>Set-Cookie</strong></td><td>è®¾ç½®HTTP Cookie</td><td>Set-Cookie: UserID=Andy; Max-Age=3600; Version=1</td></tr><tr><td><strong>Status</strong></td><td>è®¾ç½®HTTPå“åº”çŠ¶æ€</td><td>Status: 200 OK</td></tr><tr><td><strong>Strict-Transport-Security</strong></td><td>ä¸€ç§HSTSç­–ç•¥é€šçŸ¥HTTPå®¢æˆ·ç«¯ç¼“å­˜HTTPSç­–ç•¥å¤šé•¿æ—¶é—´ä»¥åŠæ˜¯å¦åº”ç”¨åˆ°å­åŸŸ</td><td>Strict-Transport-Security: max-age=16070400; includeSubDomains</td></tr><tr><td><strong>Trailer</strong></td><td>æ ‡è¯†ç»™å®šçš„headerå­—æ®µå°†å±•ç¤ºåœ¨åç»­çš„chunkedç¼–ç çš„æ¶ˆæ¯ä¸­</td><td>Trailer: Max-Forwards</td></tr><tr><td><strong>TSV</strong></td><td>åœ¨å“åº”ä¸­è®¾ç½®ç»™DNT(do-not-track),å¯èƒ½çš„å–å€¼</td><td>TSV: N</td></tr><tr><td><strong>Upgrade</strong></td><td>è¯·æ±‚å®¢æˆ·ç«¯å‡çº§åè®®</td><td>Upgrade: HTTP/2.0, HTTPS/1.3, IRC/6.9, RTA/x11, websocket</td></tr><tr><td><strong>Vary</strong></td><td>é€šçŸ¥ä¸‹çº§ä»£ç†å¦‚ä½•åŒ¹é…æœªæ¥çš„è¯·æ±‚å¤´å·²è®©å…¶å†³å®šç¼“å­˜çš„å“åº”æ˜¯å¦å¯ç”¨è€Œä¸æ˜¯é‡æ–°ä»æºä¸»æœºè¯·æ±‚æ–°çš„</td><td>Vary: Accept-Language</td></tr><tr><td><strong>Warning</strong></td><td>å®ä½“å¯èƒ½ä¼šå‘ç”Ÿçš„é—®é¢˜çš„é€šç”¨è­¦å‘Š</td><td>Warning: 199 Miscellaneous warning</td></tr><tr><td><strong>WWW-Authenticate</strong></td><td>æ ‡è¯†è®¿é—®è¯·æ±‚å®ä½“çš„èº«ä»½éªŒè¯æ–¹æ¡ˆ</td><td>WWW-Authenticate: Basic</td></tr><tr><td><strong>X-Frame-Options</strong></td><td>ç‚¹å‡»åŠ«æŒä¿æŠ¤ï¼š<br />deny ä¸æ¸²æŸ“<br />sameorigin <strong>å¦‚æœæºä¸åŒ¹é…ä¸æ¸²æŸ“</strong><br />allow-from å…è®¸æŒ‡å®šä½ç½®è®¿é—®<br />allowall ä¸æ ‡å‡†ï¼Œå…è®¸ä»»æ„ä½ç½®è®¿é—®</td><td>X-Frame-Options: deny</td></tr></tbody></table></div><h4 id="å¸¸ç”¨éæ ‡å‡†å“åº”å¤´å­—æ®µ"><a href="#å¸¸ç”¨éæ ‡å‡†å“åº”å¤´å­—æ®µ" class="headerlink" title="å¸¸ç”¨éæ ‡å‡†å“åº”å¤´å­—æ®µ"></a>å¸¸ç”¨éæ ‡å‡†å“åº”å¤´å­—æ®µ</h4><div class="table-container"><table><thead><tr><th>å­—æ®µå</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>X-XSS-Protection</strong></td><td>è¿‡æ»¤è·¨ç«™è„šæœ¬</td><td>X-XSS-Protection: 1; mode=block</td></tr><tr><td><strong>Content-Security-Policy</strong></td><td>å®šä¹‰å†…å®¹å®‰å…¨ç­–ç•¥</td><td></td></tr><tr><td><strong>X-Content-Security-Policy</strong></td><td>å®šä¹‰å†…å®¹å®‰å…¨ç­–ç•¥</td><td></td></tr><tr><td><strong>X-WebKit-CSP</strong></td><td>å®šä¹‰å†…å®¹å®‰å…¨ç­–ç•¥</td><td>X-WebKit-CSP: default-src â€˜selfâ€™</td></tr><tr><td><strong>X-Content-Type-Options</strong></td><td>å”¯ä¸€çš„å–å€¼æ˜¯â€â€,é˜»æ­¢IEåœ¨å“åº”ä¸­å—…æ¢å®šä¹‰çš„å†…å®¹æ ¼å¼ä»¥å¤–çš„å…¶ä»–MIMEæ ¼å¼</td><td>X-Content-Type-Options: nosniff</td></tr><tr><td><strong>X-Powered-By</strong></td><td>æŒ‡å®šæ”¯æŒwebåº”ç”¨çš„æŠ€æœ¯</td><td>X-Powered-By: PHP/5.4.0</td></tr><tr><td><strong>X-UA-Compatible</strong></td><td>æ¨èé¦–é€‰çš„æ¸²æŸ“å¼•æ“æ¥å±•ç¤ºå†…å®¹ï¼Œé€šå¸¸å‘åå…¼å®¹ï¼Œä¹Ÿç”¨äºæ¿€æ´»IEä¸­å†…åµŒchromeæ¡†æ¶æ’ä»¶<br /><meta http-equiv="X-UA-Compatible" content="chrome=1" /></td><td>X-UA-Compatible: IE=EmulateIE7<br/> X-UA-Compatible: IE=edge</td></tr></tbody></table></div><p> X-UA-Compatible: Chrome=1 |<br>| <strong>X-Content-Duration</strong>            | æä¾›éŸ³è§†é¢‘çš„æŒç»­æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œåªæœ‰Geckoå†…æ ¸æµè§ˆå™¨æ”¯æŒ      | X-Content-Duration: 42.666                                   |<br>| <strong>Upgrade-Insecure-Requests</strong>     | æ ‡è¯†æœåŠ¡å™¨æ˜¯å¦å¯ä»¥å¤„ç†HTTPSåè®®                              | Upgrade-Insecure-Requests: 1                                 |<br>| <strong>X-Request-ID,X-Correlation-ID</strong> | æ ‡è¯†ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¯·æ±‚                                 | X-Request-ID: f058ebd6-02f7-4d3f-942e-904344e8cde5           |</p><h3 id="HTTP-å“åº”åŒ…ä½“"><a href="#HTTP-å“åº”åŒ…ä½“" class="headerlink" title="HTTP å“åº”åŒ…ä½“"></a>HTTP å“åº”åŒ…ä½“</h3><p>å“åº”åŒ…ä½“åŒ…å«HTTPå“åº”æ‰€è¿”å›çš„æ•°æ®ï¼Œå…¶æ•°æ®ç±»å‹ç”±å“åº”å¤´éƒ¨ä¸­çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type">Content-Typeå­—æ®µ</a>æŒ‡å®šã€‚</p><p>ä¾‹å¦‚å“åº”ä¸€ä¸ªjsèµ„æº</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</span><br><span class="line"><span class="attribute">cache-control</span>: no-cache</span><br><span class="line"><span class="attribute">Content-Security-Policy</span>: script-src &#x27;self&#x27; blob: filesystem: chrome-extension-resource:; object-src &#x27;self&#x27; blob: filesystem:;</span><br><span class="line"><span class="attribute">Content-Type</span>: text/javascript</span><br><span class="line"><span class="attribute">ETag</span>: &quot;xx+STUs6bw=&quot;</span><br><span class="line"></span><br><span class="line">define([&quot;core/Logger&quot;],function(t)&#123;var i,n=&#123;settings:[300,60,10],NOTIFICATION_TTL:5e3,initAPI:function(t)&#123;i=t,i.mixin(&quot;Notification&quot;,&#123;get:this.get.bind(this),saveSettings:this.saveSettings.bind(this)&#125;)&#125;,init:function(t)&#123;this.loadSettings(),&quot;function&quot;==typeof t&amp;&amp;t()&#125;,get:function()&#123;return this.settings&#125;,show:function(t)&#123;var n=&quot;&quot;,e=&quot;&quot;,o=0,s=this;&quot;nuclear&quot;===t?(o=i.NuclearOption.getSecondsUntilActive(),n=&quot;common/img/eye_48x48_nuclear.png&quot;,e=i.Chrome.Translation.get(&quot;nuclearNotification&quot;)||&quot;The Nuclear Option will start blocking sites in&quot;):&quot;block&quot;===t&amp;&amp;(o=i.StayFocusd.getTotalSecondsRemaining(),n=&quot;common/img/eye_48x48_red.png&quot;,e=i.Chrome.Translation.get(&quot;blockNotification&quot;)||&quot;StayFocusd will start blocking your Blocked Sites in&quot;),e+=o&gt;60?&quot; &quot;+i.Date.secondsToMinsAndSecs(o):&quot; &quot;+o+&quot; seconds&quot;;var c=&#123;type:&quot;basic&quot;,title:&quot;StayFocusd&quot;,iconUrl:n,message:e&#125;;i.Chrome.Notification.create(&quot;&quot;,c,function(t)&#123;setTimeout(function()&#123;i.Chrome.Notification.clear(t,function()&#123;&#125;)&#125;,s.NOTIFICATION_TTL)&#125;)&#125;,isset:function(t)&#123;return this.settings.inArray(t)&#125;,saveSettings:function(t)&#123;this.settings=t,i.Settings.set(&#123;notificationSettings:t&#125;)&#125;,loadSettings:function()&#123;var t=i.Settings.get(&quot;notificationSettings&quot;);t&amp;&amp;(this.settings=t)&#125;&#125;;return n&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>HTTPå“åº”æŠ¥æ–‡çš„æ§åˆ¶ä¿¡æ¯ä¿å­˜åœ¨HTTPå“åº”çŠ¶æ€è¡Œå’Œå“åº”å¤´éƒ¨ï¼Œæ•°æ®åˆ™è¢«ä¿å­˜åœ¨åŒ…ä½“ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> HTTP/HTTPS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¸©å‘è®°ä¹‹Mysqlè®¿é—®æ‹’ç»æ•…éšœ</title>
      <link href="/2015/11/01/MySQL/%E8%B8%A9%E5%9D%91%E8%AE%B0%E4%B9%8BMysql%E8%AE%BF%E9%97%AE%E6%8B%92%E7%BB%9D/"/>
      <url>/2015/11/01/MySQL/%E8%B8%A9%E5%9D%91%E8%AE%B0%E4%B9%8BMysql%E8%AE%BF%E9%97%AE%E6%8B%92%E7%BB%9D/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜äº§ç”Ÿ"><a href="#é—®é¢˜äº§ç”Ÿ" class="headerlink" title="é—®é¢˜äº§ç”Ÿ"></a>é—®é¢˜äº§ç”Ÿ</h2><p>ä»Šå¤©ç”¨å‘½ä»¤è¡Œç™»é™†mysqlæ—¶å‡ºç°äº†Errorã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">ERROR 16958(28000): Access denied <span class="keyword">for</span> user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br></pre></td></tr></table></figure><p>èµ·åˆæˆ‘ä»¥ä¸ºæ˜¯rootå¯†ç é”™äº†ï¼Œäºæ˜¯å°±å»mysqlå®˜æ–¹æ–‡æ¡£æŸ¥äº†ä¸‹æ”¹å¯†ç çš„æ–¹æ³•</p><p>å…³é—­mysqlè¿›ç¨‹ç„¶åå†å»ºç«‹ä¸€ä¸ªæ”¹å¯†ç çš„sqlæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop mysql.service</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /tmp &amp;&amp; vim init.sql <span class="comment">#xxxxxxä»£è¡¨è¦ä¿®æ”¹çš„å¯†ç </span></span><br><span class="line">alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;xxxxxx&#x27;</span>; </span><br></pre></td></tr></table></figure><p>å®‰å…¨æ¨¡å¼å¯åŠ¨mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysqld_safe --defaults-file=/etc/mysql/my.cnf --init-file=/tmp/init.sql &amp;</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart mysql.service</span><br></pre></td></tr></table></figure><p>è¿™æ ·æŠŠå¯†ç æ”¹ä¸ºäº†<code>xxxxxx</code></p><p>ç„¶åæˆ‘å†å»ç™»é™†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">ERROR 16958(28000): Access denied <span class="keyword">for</span> user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br></pre></td></tr></table></figure><p>=ÍŸÍŸÍÍ(ê’ªâŒ“ê’ª*)</p><p>å¹¶ä¸æ˜¯å¯†ç é”™è¯¯çš„é”…</p><h2 id="é—®é¢˜å…³é”®"><a href="#é—®é¢˜å…³é”®" class="headerlink" title="é—®é¢˜å…³é”®"></a>é—®é¢˜å…³é”®</h2><p>æ±‚åŠ©äº†å¼ºå¤§çš„googleå’Œstackoverflowï¼Œç»ˆäºæ‰¾åˆ°äº†é—®é¢˜ã€‚</p><blockquote><p>The reason is that recent Ubuntu installation (maybe others also), mysql is using by default the <a href="https://dev.mysql.com/doc/mysql-security-excerpt/5.5/en/socket-authentication-plugin.html">UNIX auth_socket plugin</a>.</p><p>Basically means that: <em>db_users using it, will be â€œauthâ€ by *</em>the system user credentias.</p></blockquote><p>userè¡¨ä¸­çš„ç”¨æˆ·çš„pluginé»˜è®¤ä¼šè®¾ç½®ä¸ºauth_socketï¼Œè¿™æ ·çš„è¯ï¼Œè®¤è¯ä¼šç”±ç³»ç»Ÿç”¨æˆ·è¯ä¹¦æ¥è¿›è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mysql -u root <span class="comment"># I had to use &quot;sudo&quot; since is new installation</span></span><br><span class="line"></span><br><span class="line">mysql&gt; USE mysql;</span><br><span class="line">mysql&gt; SELECT User, Host, plugin FROM mysql.user;</span><br><span class="line"></span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| User             | plugin                |</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| root             | auth_socket           |</span><br><span class="line">| mysql.sys        | mysql_native_password |</span><br><span class="line">| debian-sys-maint | mysql_native_password |</span><br><span class="line">+------------------+-----------------------+</span><br></pre></td></tr></table></figure><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä½†éƒ½éœ€è¦ç™»é™†è¿›mysqlï¼Œæ‰€ä»¥éœ€è¦é‡å¯mysqlå¼€å¯<code>--skip-grant-tables</code>å‚æ•°ï¼Œæ¥è·³è¿‡æƒé™è¡¨çš„åŠ è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop mysql.service</span><br><span class="line">$ mysqld_safe --defaults-file=/etc/mysql/my.cnf --skip-grant-tables  --skip-networking &amp;</span><br><span class="line">$ sudo mysql  <span class="comment">#è¿™æ ·å°±å¯ä»¥å…ç™»å½•ç›´æ¥è¿›å…¥mysqläº¤äº’ç•Œé¢</span></span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h3><p>æŠŠmysqlçš„rootç”¨æˆ·çš„pluginå­—æ®µè®¾ç½®ä¸º<code>mysql_native_password</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql;</span><br><span class="line">mysql&gt; UPDATE user SET plugin=<span class="string">&#x27;mysql_native_password&#x27;</span> WHERE User=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line">$ systemctl restart mysql.service</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h3><p>æ–°å»ºä¸€ä¸ªrootç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql;</span><br><span class="line">mysql&gt; CREATE USER <span class="string">&#x27;YOUR_SYSTEM_USER&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root2&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">mysql&gt; UPDATE user SET plugin=<span class="string">&#x27;auth_socket&#x27;</span> WHERE User=<span class="string">&#x27;root2&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line">$ service mysql restart</span><br><span class="line">$ mysql -u root2 -pxxxxxx <span class="comment">#ç”¨root2æ¥ç™»é™†</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> bugfix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸­çš„envæ˜¯ä»€ä¹ˆ</title>
      <link href="/2015/10/22/Linux/Linux%E4%B8%AD%E7%9A%84env/"/>
      <url>/2015/10/22/Linux/Linux%E4%B8%AD%E7%9A%84env/</url>
      
        <content type="html"><![CDATA[<p>envæ˜¯ç¯å¢ƒEnvironmentçš„ç¼©å†™ï¼Œæ­£å¦‚å®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒç”¨äº<strong>æ˜¾ç¤ºç³»ç»Ÿä¸­å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡</strong>ï¼Œä»¥åŠ<strong>åœ¨å®šä¹‰çš„ç¯å¢ƒä¸­æ‰§è¡ŒæŒ‡ä»¤</strong>ï¼Œä¸€èˆ¬ä½äº<code>/usr/bin/env</code>ã€‚</p><a id="more"></a><h2 id="envä½œä¸ºè„šæœ¬è§£é‡Šå™¨æŒ‡å®šç¨‹åº"><a href="#envä½œä¸ºè„šæœ¬è§£é‡Šå™¨æŒ‡å®šç¨‹åº" class="headerlink" title="envä½œä¸ºè„šæœ¬è§£é‡Šå™¨æŒ‡å®šç¨‹åº"></a>envä½œä¸ºè„šæœ¬è§£é‡Šå™¨æŒ‡å®šç¨‹åº</h2><p>ç”¨envå¯åŠ¨æ˜¯å› ä¸ºè„šæœ¬è§£é‡Šå™¨åœ¨linuxå¯èƒ½è¢«å®‰è£…äºä¸åŒç›®å½•ï¼Œæ‰€ä»¥è¦åœ¨PATHç¯å¢ƒå˜é‡ä¸­æ‰¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/env</span><br><span class="line">...</span><br><span class="line">SHELL=/bin/zsh</span><br><span class="line">...</span><br><span class="line">PATH=/Users/maywzh/.pyenv/shims:/Users/maywzh/.pyenv/bin:/usr/<span class="built_in">local</span>/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Applications/Wireshark.app/Contents/MacOS</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä»¥pythonä¸ºä¾‹"><a href="#ä»¥pythonä¸ºä¾‹" class="headerlink" title="ä»¥pythonä¸ºä¾‹"></a>ä»¥pythonä¸ºä¾‹</h3><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†pyenvæ¥ç®¡ç†å¤šç‰ˆæœ¬pythonï¼Œå®ƒçš„å…·ä½“å¯è§<a href="https://github.com/pyenv/pyenv">https://github.com/pyenv/pyenv</a></p><p>å®ƒå¯ä»¥é€‰ç”¨ç‰¹å®šç¯å¢ƒä½¿ç”¨çš„pythonç‰ˆæœ¬ï¼ŒæŠŠ<code>~/.pyenv/shims</code>ä½œä¸ºä¸€ä¸ªå«ç‰‡è·¯å¾„ï¼Œé‡Œé¢æ˜¯é€‰å®šçš„pythonç‰ˆæœ¬çš„è§£é‡Šå™¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls /Users/maywzh/.pyenv/shims</span><br><span class="line">2to3              easy_install      idle              idle3.7           pip3              pydoc             pydoc3.7          python-config     python3-config    python3.7-config  python3.7m-config pyvenv-3.7</span><br><span class="line">2to3-3.7          easy_install-3.7  idle3             pip               pip3.7            pydoc3            python            python3           python3.7         python3.7m        pyvenv</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé€‰ç”¨äº†python3.7ï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸‹é¢å‘½ä»¤æ¥ç¡®å®šä½¿ç”¨çš„ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ env python</span><br><span class="line">Python 3.7.1 (default, Oct 22 2018, 04:20:43)</span><br><span class="line">[Clang 10.0.0 (clang-1000.10.44.2)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>ç”¨è¿™ç§æ–¹å¼ä½¿ç”¨pythonå°±ç›¸å½“çµæ´»ï¼Œåªéœ€è¦é…ç½®PATHå˜é‡å³å¯ï¼Œä¸ä¼šå‡ºç°å› ä¸ºå†™æ­»è§£é‡Šå™¨è·¯å¾„è€Œæ‰¾ä¸åˆ°è§£é‡Šå™¨çš„æƒ…å†µã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hello.py</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;hello&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¦è¿è¡Œè¯¥ç¨‹åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x hello.py <span class="comment">#ä¸ºè¯¥è„šæœ¬ç¨‹åºæ·»åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line">$ ./hello.py <span class="comment">#å› ä¸ºæŒ‡å®šäº†#!/usr/bin/env python ï¼Œ è°ƒç”¨pythonè§£é‡Šå™¨æ¥è¿è¡Œè¯¥è„šæœ¬ç¨‹åº</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux GNU-gccç®€æ˜æ•™ç¨‹</title>
      <link href="/2015/10/18/Linux/Linux-gcc%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/"/>
      <url>/2015/10/18/Linux/Linux-gcc%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>gcc/g++æ˜¯GNUå·¥å…·åŒ…ä¸­å¼ºå¤§çš„c/c++ç¼–è¯‘å·¥å…·ï¼Œç»“åˆmakeå·¥å…·ï¼Œå¯ä»¥åšåˆ°è‡ªåŠ¨åŒ–ç¼–è¯‘åŠŸèƒ½ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œç¼–è¯‘cè¯­è¨€ä½¿ç”¨gccï¼Œç¼–è¯‘c++è¯­è¨€ä½¿ç”¨g++ï¼Œä¸¤è€…çš„å‘½ä»¤å‡ ä¹ç›¸åŒã€‚</p><a id="more"></a><h2 id="ç¼–è¯‘æµç¨‹"><a href="#ç¼–è¯‘æµç¨‹" class="headerlink" title="ç¼–è¯‘æµç¨‹"></a>ç¼–è¯‘æµç¨‹</h2><p>åˆ†ä¸ºå››æ­¥ï¼Œé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥</p><p>æ ·ä¾‹ç¨‹åº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*************************</span></span><br><span class="line"><span class="comment">hello.cpp</span></span><br><span class="line"><span class="comment">*************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;IOSTREAM&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> t = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T 9</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Status i = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; T * i &lt;&lt; <span class="built_in">endl</span>; <span class="comment">//Test Cout</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŒ‡å®šè¾“å‡ºæ–‡ä»¶-o"><a href="#æŒ‡å®šè¾“å‡ºæ–‡ä»¶-o" class="headerlink" title="æŒ‡å®šè¾“å‡ºæ–‡ä»¶ -o"></a>æŒ‡å®šè¾“å‡ºæ–‡ä»¶ -o</h3><p>è¡¨ç¤ºæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶,oä¸ºå°å†™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ [-é€‰é¡¹] inputfile -o outputfile</span><br></pre></td></tr></table></figure><h3 id="é¢„å¤„ç†-E"><a href="#é¢„å¤„ç†-E" class="headerlink" title="é¢„å¤„ç† -E"></a>é¢„å¤„ç† -E</h3><p>ä½¿ç”¨é¢„å¤„ç†å™¨cppã€‚è¾“å‡ºé¢„å¤„ç†åçš„æ–‡ä»¶ï¼Œlinuxä¸‹ä»¥<code>.i</code>ä¸ºåç¼€åã€‚é»˜è®¤ä¸ç”Ÿæˆæ–‡ä»¶ï¼Œå¯ä»¥é‡å®šå‘åˆ°ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­ã€‚è¿™ä¸€æ­¥ä¸»è¦åšäº†è¿™äº›äº‹æƒ…ï¼šå®çš„æ›¿æ¢ï¼Œè¿˜æœ‰æ³¨é‡Šçš„æ¶ˆé™¤ï¼Œè¿˜æœ‰æ‰¾åˆ°ç›¸å…³çš„åº“æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºæ— å…³ä»£ç çš„æ¸…é™¤ã€‚</p><p>å¦‚æœæƒ³æŸ¥çœ‹å¾…ç¼–è¯‘æ–‡ä»¶çš„é¢„å¤„ç†è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -E hello.cpp</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¼šç›´æ¥åœ¨terminalä¸­æ˜¾ç¤ºé¢„å¤„ç†è¿‡ç¨‹ï¼Œå¦‚æœ<code>main.cxx</code>ä¸­åŒ…å«<code>include</code>ï¼Œä¾‹å¦‚<code>#include&lt;iostream&gt;</code>,åªèƒ½çœ‹åˆ°éƒ¨åˆ†é¢„å¤„ç†ç»“æœï¼›è¿™ä¸ªåªæ˜¾ç¤ºé¢„å¤„ç†ï¼Œä¸ç”Ÿæˆæ–‡ä»¶ã€‚</p><p>ä¹Ÿå¯ä»¥å§é¢„å¤„ç†çš„è¿‡ç¨‹é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -E hello.cpp -o hello.i</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<a href="http://gcc.gnu.org/onlinedocs/cpp/Preprocessor-Output.html">å®˜æ–¹æ–‡æ¡£</a>æ¥äº†è§£æ›´å¤šã€‚</p><h3 id="ç¼–è¯‘-S"><a href="#ç¼–è¯‘-S" class="headerlink" title="ç¼–è¯‘ -S"></a>ç¼–è¯‘ -S</h3><p>ç¼–è¯‘å°±æ˜¯æŒ‡ä½¿ç”¨ç¼–è¯‘å™¨egcsæŠŠé¢„å¤„ç†çš„ä»£ç ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç ã€‚</p><p>ä¾‹å¦‚å§æŠŠé¢„å¤„ç†åçš„æ–‡ä»¶<code>hello.i</code>ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç æ–‡ä»¶<code>hello.s</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -S hello.i -o hello.s</span><br></pre></td></tr></table></figure><h3 id="æ±‡ç¼–-c"><a href="#æ±‡ç¼–-c" class="headerlink" title="æ±‡ç¼– -c"></a>æ±‡ç¼– -c</h3><p>æ±‡ç¼–å°±æ˜¯æŒ‡ä½¿ç”¨æ±‡ç¼–å™¨asæŠŠæ±‡ç¼–ä»£ç ç”Ÿæˆç›®æ ‡ä»£ç ï¼Œç›®æ ‡ä»£ç å°±æ˜¯äºŒè¿›åˆ¶æœºå™¨ç ã€‚</p><p>ä¾‹å¦‚æŠŠ<code>hello.s</code>ç”Ÿæˆä¸ºç›®æ ‡ä»£ç <code>hello.o</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -c hello.s -o hello.o</span><br></pre></td></tr></table></figure><h3 id="é“¾æ¥-O"><a href="#é“¾æ¥-O" class="headerlink" title="é“¾æ¥ -O"></a>é“¾æ¥ -O</h3><p>é“¾æ¥å°±æ˜¯æŒ‡æŠŠ<code>.o</code>æ–‡ä»¶ä¸æ‰€éœ€çš„åº“æ–‡ä»¶é“¾æ¥æ•´åˆå½¢æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚ <code>-L</code>è¡¨ç¤ºé“¾æ¥ã€‚</p><p>æ³¨æ„æ­¤å¤„çš„<code>-O</code>ä¸ºå¤§å†™ä¸åŒäºæŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„<code>-o</code>å°å†™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -O hello.o lib1.a lib2.a -o main</span><br><span class="line">$ g++ hello.o -L /usr/include/iostream</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§å‚æ•°"><a href="#å¸¸è§å‚æ•°" class="headerlink" title="å¸¸è§å‚æ•°"></a>å¸¸è§å‚æ•°</h2><h3 id="è­¦å‘Šç›¸å…³"><a href="#è­¦å‘Šç›¸å…³" class="headerlink" title="è­¦å‘Šç›¸å…³"></a>è­¦å‘Šç›¸å…³</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -pedantic main.cpp -o illcode <span class="comment"># æ˜¾ç¤ºä¸ç¬¦åˆANSI/ISO C è¯­è¨€æ ‡å‡†çš„è­¦å‘Šä¿¡æ¯</span></span><br><span class="line">$ g++ -Wall main.cpp -o illcode <span class="comment">#äº§ç”Ÿå°½å¯èƒ½å¤šçš„è­¦å‘Šä¿¡æ¯</span></span><br><span class="line">$ g++ -Werror main.cpp -o illcode <span class="comment"># å°†æ‰€æœ‰çš„è­¦å‘Šå½“æˆé”™è¯¯è¿›è¡Œå¤„ç†</span></span><br></pre></td></tr></table></figure><h3 id="è°ƒè¯•ä¿¡æ¯-g"><a href="#è°ƒè¯•ä¿¡æ¯-g" class="headerlink" title="è°ƒè¯•ä¿¡æ¯ -g"></a>è°ƒè¯•ä¿¡æ¯ -g</h3><p>ç¼–è¯‘çš„æ—¶å€™ï¼Œäº§ç”Ÿè°ƒè¯•ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -g main.cxx -o main</span><br></pre></td></tr></table></figure><h3 id="æŒ‡å®šè¯­è¨€-x"><a href="#æŒ‡å®šè¯­è¨€-x" class="headerlink" title="æŒ‡å®šè¯­è¨€ -x"></a>æŒ‡å®šè¯­è¨€ -x</h3><p>æ”¯æŒc c++ assembler noneï¼Œâ€˜noneâ€™æ„å‘³ç€æ¢å¤é»˜è®¤è¡Œä¸ºï¼Œå³æ ¹æ®æ–‡ä»¶çš„æ‰©å±•åçŒœæµ‹æºæ–‡ä»¶çš„è¯­è¨€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -x c++ main.cxx // æŒ‡å®šæºä»£ç ä¸ºc++</span><br></pre></td></tr></table></figure><h3 id="å…³è”ä¿¡æ¯-M"><a href="#å…³è”ä¿¡æ¯-M" class="headerlink" title="å…³è”ä¿¡æ¯ -M"></a>å…³è”ä¿¡æ¯ -M</h3><p>ç”Ÿæˆæ–‡ä»¶å…³è”ä¿¡æ¯ï¼ŒåŒ…å«ç›®æ ‡æ–‡ä»¶ä¾èµ–çš„æ‰€æœ‰æºä»£ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -M main.cxx</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–çº§åˆ«-O0-O1-O2-O3"><a href="#ä¼˜åŒ–çº§åˆ«-O0-O1-O2-O3" class="headerlink" title="ä¼˜åŒ–çº§åˆ«-O0 -O1 -O2 -O3"></a>ä¼˜åŒ–çº§åˆ«-O0 -O1 -O2 -O3</h3><p>ç¼–è¯‘å™¨çš„ä¼˜åŒ–é€‰é¡¹çš„4ä¸ªçº§åˆ«ï¼Œ-O0è¡¨ç¤ºæ²¡æœ‰ä¼˜åŒ–,-O1ä¸ºç¼ºçœå€¼ï¼Œ-O3ä¼˜åŒ–çº§åˆ«æœ€é«˜ã€€ã€€ ã€€ã€€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ main.cxx -o main -o2</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹-v"><a href="#æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹-v" class="headerlink" title="æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹ -v"></a>æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹ -v</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ main.cxx -v -o main</span><br></pre></td></tr></table></figure><h2 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h2><h3 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h3><p>å¯ä»¥ä½¿ç”¨-Dname é€‰é¡¹æ¥å®šä¹‰ä¸€ä¸ªå®ï¼Œæˆ–è€…-Dname=value å®šä¹‰ä¸€ä¸ªå€¼valueçš„å®ã€‚å¦‚æœè¯¥å€¼åŒ…å«ç©ºæ ¼ï¼Œåˆ™åº”åŒ…å«åœ¨åŒå¼•å·ä¸­ã€‚</p><h3 id="åº“"><a href="#åº“" class="headerlink" title="åº“"></a>åº“</h3><p>åº“æ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘çš„å¯¹è±¡æ–‡ä»¶çš„é›†åˆï¼Œå¯ä»¥é€šè¿‡é“¾æ¥å™¨é“¾æ¥åˆ°ç¨‹åºä¸­ã€‚<br>æœ‰ä¸¤ç§ç±»å‹çš„å¤–éƒ¨åº“ï¼šé™æ€åº“å’ŒåŠ¨æ€åº“ã€‚ </p><p>Windowsç³»ç»Ÿçš„é™æ€åº“æ–‡ä»¶æ‰©å±•åä¸º<code>*.lib</code>ï¼ŒåŠ¨æ€åº“æ–‡ä»¶æ‰©å±•åä¸º<code>*.dll</code></p><p>Unixç±»ç³»ç»Ÿçš„é™æ€åº“æ–‡ä»¶æ‰©å±•åä¸º<code>*.a</code>ï¼ŒåŠ¨æ€åº“æ–‡ä»¶æ‰©å±•åä¸º<code>*.so</code></p><p>å½“ç¨‹åºä¸é™æ€åº“é“¾æ¥æ—¶ï¼Œç¨‹åºä¸­ä½¿ç”¨çš„å¤–éƒ¨å‡½æ•°çš„æœºå™¨ä»£ç å°†è¢«å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ä¸€ä¸ªé™æ€åº“å¯ä»¥é€šè¿‡å­˜æ¡£ç¨‹åºâ€ar.exeâ€åˆ›å»ºã€‚<br>å½“ç¨‹åºä¸ä¸€ä¸ªåŠ¨æ€åº“é“¾æ¥æ—¶ï¼Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­åˆ›å»ºäº†ä¸€ä¸ªè¡¨ã€‚åœ¨å¯æ‰§è¡Œæ–‡ä»¶å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œæ“ä½œç³»ç»ŸåŠ è½½æ‰€éœ€çš„å¤–éƒ¨å‡½æ•° <code>- a</code> çš„æœºå™¨ä»£ç ï¼Œè¿™è¢«ç§°ä¸º<strong>åŠ¨æ€é“¾æ¥</strong>çš„è¿‡ç¨‹ã€‚å› ä¸ºä¸€ä¸ªåº“çš„ä¸€ä¸ªå‰¯æœ¬å¯ä»¥åœ¨å¤šä¸ªç¨‹åºä¹‹é—´å…±äº«ï¼Œæ‰€ä»¥åŠ¨æ€é“¾æ¥ä½¿å¯æ‰§è¡Œæ–‡ä»¶æ›´å°ï¼Œå¹¶<strong>èŠ‚çœç£ç›˜ç©ºé—´</strong>ã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿå…è®¸åœ¨å†…å­˜ä¸­çš„å…±äº«åº“çš„ä¸€ä¸ªå‰¯æœ¬è¢«æ‰€æœ‰çš„è¿è¡Œç¨‹åºä½¿ç”¨ï¼Œå› æ­¤ï¼Œä¹Ÿ<strong>èŠ‚çœå†…å­˜</strong>ã€‚åŠ¨æ€åº“çš„ä»£ç å¯ä»¥å‡çº§è€Œ<strong>æ— éœ€é‡æ–°ç¼–è¯‘</strong>ç¨‹åºã€‚<br>åŠ¨æ€é“¾æ¥åº“çš„ä¼˜ç‚¹éå¸¸å¤šï¼ŒGCCé»˜è®¤æ˜¯é“¾æ¥åŠ¨æ€åº“çš„ã€‚ </p><h3 id="æœç´¢å¤´æ–‡ä»¶å’Œåº“"><a href="#æœç´¢å¤´æ–‡ä»¶å’Œåº“" class="headerlink" title="æœç´¢å¤´æ–‡ä»¶å’Œåº“"></a>æœç´¢å¤´æ–‡ä»¶å’Œåº“</h3><p>ç¼–è¯‘ç¨‹åºæ—¶ï¼Œç¼–è¯‘å™¨éœ€è¦å¤´æ–‡ä»¶æ¥ç¼–è¯‘æºä»£ç ï¼›é“¾æ¥å™¨éœ€è¦åº“æ¥è§£ææ¥è‡ªå…¶ä»–å¯¹è±¡æ–‡ä»¶æˆ–åº“çš„å¤–éƒ¨å¼•ç”¨ã€‚éœ€è¦åˆé€‚çš„è®¾ç½®æ¥å‘Šè¯‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨å¤´æ–‡ä»¶å’Œåº“çš„ä½ç½®ã€‚</p><p>æ¯ä¸€ä¸ªåœ¨æºæ–‡ä»¶é‡Œä½¿ç”¨çš„å¤´æ–‡ä»¶(<code>#include &lt;å¤´æ–‡ä»¶åå­—&gt;</code>)ï¼Œç¼–è¯‘å™¨æœç´¢<code>include-paths</code> æ¥æ‰¾å¤´æ–‡ä»¶ã€‚<code>include-paths</code>æ˜¯é€šè¿‡ <code>-Idir</code> é€‰é¡¹æŒ‡å®šï¼Œæˆ–è€…æ˜¯ç¯å¢ƒå˜é‡ <code>CPATH</code>æŒ‡å®šã€‚ç”±äºå¤´æ–‡ä»¶çš„æ–‡ä»¶åæ˜¯å·²çŸ¥çš„ï¼Œæ‰€ä»¥åªéœ€è¦è·¯å¾„åå°±å¯ä»¥ã€‚ </p><p>é“¾æ¥å™¨ æœç´¢ <code>library-paths</code> ï¼Œå°†ç¨‹åºé“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€çš„åº“ã€‚<code>library-paths</code>æ˜¯é€šè¿‡ <code>-Ldir</code> é€‰é¡¹æŒ‡å®šï¼ˆæˆ–ç¯å¢ƒå˜é‡<code>LIBRARY_PATH</code>ã€‚</p><p>æ­¤å¤–è¿˜å¿…é¡»æŒ‡å®šåº“åç§°ï¼Œè¿™é‡Œå’Œç¼–è¯‘å™¨æ‰¾å¤´æ–‡ä»¶ä¸åŒï¼Œå¤´æ–‡ä»¶åœ¨æºä»£ç å°±æœ‰å£°æ˜ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–å†å»æŒ‡å®šï¼Œè€Œåº“éœ€è¦ä½¿ç”¨ <code>-l</code> é€‰é¡¹æ¥å‘Šè¯‰é“¾æ¥å™¨ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><h3 id="fileå·¥å…·"><a href="#fileå·¥å…·" class="headerlink" title="fileå·¥å…·"></a>fileå·¥å…·</h3><p>fileå·¥å…·å¯ä»¥ç”¨æ¥æ˜¾ç¤ºç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„ç±»å‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -c hello.cpp</span><br><span class="line">$ g++ -o hello hello.o</span><br><span class="line">$ file hello.o</span><br><span class="line">hello.o: ELF 64-bit LSB  relocatable, x86-64, version 1 (SYSV), not stripped</span><br></pre></td></tr></table></figure><h3 id="nmå·¥å…·"><a href="#nmå·¥å…·" class="headerlink" title="nmå·¥å…·"></a>nmå·¥å…·</h3><p>nmå·¥å…·ç”¨äºåˆ—å‡ºç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ï¼Œ<br>å¸¸ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªç‰¹å®šçš„å‡½æ•°æ˜¯å¦è¢«å®šä¹‰åœ¨ä¸€ä¸ªå¯¹è±¡æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nm hello.o</span><br><span class="line">0000000000000000 T _main</span><br></pre></td></tr></table></figure><h3 id="ldd-å·¥å…·"><a href="#ldd-å·¥å…·" class="headerlink" title="ldd å·¥å…·"></a>ldd å·¥å…·</h3><p>lddå¯ä»¥ç¡®å®šç¨‹åºä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“æœ‰å“ªäº›ã€‚ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºå®ƒæ‰€ä¾èµ–çš„å…±äº«åº“çš„åˆ—è¡¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ldd hello</span><br><span class="line">/media/study/mycode/GCC_test$ ldd hello</span><br><span class="line">linux-vdso.so.1 =&gt;  (0x00007ffe6653a000)</span><br><span class="line">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd06d171000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007fd06d536000)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£cè¯­è¨€ä¸­çš„æŒ‡é’ˆ</title>
      <link href="/2015/10/16/C&amp;C++/c%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%8C%87%E9%92%88/"/>
      <url>/2015/10/16/C&amp;C++/c%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%8C%87%E9%92%88/</url>
      
        <content type="html"><![CDATA[<p>åœ¨è€ƒè™‘æŒ‡é’ˆçš„é—®é¢˜ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹å¦‚ä½•å®šä¹‰ä¸€ä¸ªå˜é‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x;</span><br></pre></td></tr></table></figure><p><code>int</code>ç±»å‹éœ€è¦å››ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼Œè¿™å››ä¸ªå­—èŠ‚æ˜¯ä»å†…å­˜ä¸­åˆ†é…è€Œæ¥çš„ï¼Œå†…å­˜åœ¨é€»è¾‘ä¸Šæ˜¯ä¸€ä¸ªçº¿æ€§çš„å­˜å‚¨å™¨ï¼Œå®ƒä»¥å­—èŠ‚ä¸ºå•ä½è¢«åˆ’åˆ†ä¸ºè®¸å¤šå°çš„å•å…ƒã€‚ä¸ºäº†åŒºåˆ†è¿™äº›å•å…ƒï¼Œè®¡ç®—æœºç»™æ¯ä¸€ä¸ªå•å…ƒéƒ½åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„åå…­è¿›åˆ¶æ•´æ•°ä½œä¸ºç¼–å·ï¼Œå«åšå†…å­˜åœ°å€(ç®€ç§°åœ°å€)ã€‚ç”±äºè¿™äº›å•å…ƒå•Šæ•°é‡ä¼—å¤šï¼Œæ‰€ä»¥è¿™ä¸ªå†…å­˜åœ°å€æœ¬èº«å°±éœ€è¦å››ä¸ªå­—èŠ‚(32ä½bitä½)æ¥è¡¨ç¤ºã€‚æˆ‘ä»¬æ‰€è¯´çš„32ä½ç³»ç»Ÿå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚å®ƒæœ€å¤§çš„å¯å¯»å€èŒƒå›´ä¸º<code>2^32</code>å­—èŠ‚ï¼Œå³4GBã€‚ç›®å‰æ­£åœ¨å æ®ä¸»æµçš„64ä½ç³»ç»Ÿçš„æœ€å¤§å¯å¯»å€èŒƒå›´æ˜¯<code>2^64</code>å­—èŠ‚ã€‚</p><p>ç†è®ºä¸Šè¯´ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™äº›å†…å­˜åœ°å€å°±å¯ä»¥å®šä½åˆ°æˆ‘ä»¬æ‰€è¦è¯»å†™çš„å†…å­˜å•å…ƒï¼Œä½†è¿™äº›åœ°å€ä¸æ–¹ä¾¿ç†è§£å’Œè®°å¿†ï¼Œcè¯­è¨€å…è®¸ç¨‹åºå‘˜ç»™è¿™äº›åœ°å€èµ·åå­—ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å˜é‡åã€‚</p><p>å›åˆ°<code>int x</code>è¿™ä¸ªå£°æ˜ï¼Œå®ƒå®é™…ä¸Šåšäº†ä¸¤ä»¶äº‹ï¼š</p><ol><li>ä»å†…å­˜ä¸­åˆ’åˆ†å‡º4ä¸ªå­—èŠ‚ï¼›</li><li>å°†è¿™ä¸ªå†…å­˜å•å…ƒçº¦å®šä¸€ä¸ªåå­—ä¸ºxï¼›</li></ol><p>ä¸€ä¸ªå›ºå®šçš„å†…å­˜å•å…ƒçš„åœ°å€æ˜¯å›ºå®šçš„ï¼Œä½†å­˜å‚¨çš„å€¼ç¡®æ˜¯å¯å˜çš„ã€‚</p><a id="more"></a><h2 id="æŒ‡é’ˆæ¦‚å¿µ"><a href="#æŒ‡é’ˆæ¦‚å¿µ" class="headerlink" title="æŒ‡é’ˆæ¦‚å¿µ"></a>æŒ‡é’ˆæ¦‚å¿µ</h2><h3 id="è·å–å˜é‡çš„åœ°å€"><a href="#è·å–å˜é‡çš„åœ°å€" class="headerlink" title="è·å–å˜é‡çš„åœ°å€"></a>è·å–å˜é‡çš„åœ°å€</h3><p>ç”±äºæœ‰å˜é‡åçš„å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå…·ä½“åœ°å€å°±å¯ä»¥æ“ä½œå®ƒæ¥è¿›è¡Œå„ç§è¿ç®—ï¼Œä½†æœ‰çš„æ—¶å€™éœ€è¦å¾—åˆ°å…¶åœ°å€ï¼Œä¸ºäº†æ»¡è¶³å…¶éœ€è¦ï¼Œcè¯­è¨€æä¾›äº†å–åœ°å€è¿ç®—ç¬¦<code>&amp;</code>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;value is %d\n&quot;</span>, x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;address is %d\n&quot;</span>, &amp;x);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5ï¼›</span></span><br><span class="line"><span class="comment">// 2293620</span></span><br></pre></td></tr></table></figure><p><code>int</code>å˜é‡éœ€è¦å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå†…å­˜å•å…ƒåªæœ‰ä¸€ä¸ªå­—èŠ‚çš„å®¹é‡ï¼Œæ‰€ä»¥ç¨‹åºä¼šåˆ†é…å››ä¸ªè¿ç»­çš„å•å…ƒç»™xã€‚<code>&amp;x</code>å°±æ˜¯ç¬¬ä¸€ä¸ªå•å…ƒçš„åœ°å€ï¼Œå³<strong>é¦–åœ°å€</strong>ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ— ç¬¦å·æ•´å‹å˜é‡æ¥å­˜å‚¨å®ƒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> addr = (<span class="keyword">int</span>)&amp;x;</span><br></pre></td></tr></table></figure><p>Cè¯­è¨€å¤„äºç±»å‹å®‰å…¨çš„è€ƒè™‘ï¼Œè®¤ä¸ºä¸€ä¸ªåœ°å€ä¸ä¸€ä¸ªæ•´æ•°ä¸ç­‰ä»·ï¼ˆè™½ç„¶å®é™…ä¸Šæ˜¯ä¸€å›äº‹ï¼‰ï¼Œæ‰€ä»¥æƒ³æŠŠå˜é‡<code>x</code>çš„åœ°å€å­˜åœ¨ä¸€ä¸ª<code>int</code>ä¸­ï¼Œéœ€è¦ä½¿ç”¨å¼ºåˆ¶è½¬åŒ–ã€‚</p><p>ä¸Šé¢çš„ä»£ç ä¸­<code>addr</code>ä¹Ÿæ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„åœ°å€ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡<code>&amp;</code>æ¥è·å–å®ƒçš„åœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> addr_of_addr = (<span class="keyword">int</span>)&amp;addr;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™æ ·æ˜¯å¦å¯ä»¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> addr_of_addr = (<span class="keyword">int</span>)&amp;&amp;x; <span class="comment">//ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¼šç¼–è¯‘æŠ¥é”™å‘¢ï¼Œè¿™æ˜¯å› ä¸ºå–ä¸€ä¸ªå˜é‡çš„åœ°å€åï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå–åœ°å€åªå¯¹äºå˜é‡æ‰æœ‰æ„ä¹‰ã€‚æ‰€ä»¥åªæœ‰å°†è¿™ä¸ªæ•°å€¼å­˜æ”¾äºä¸€ä¸ªå˜é‡addrä¸­ï¼Œæ‰èƒ½å–å¾—è¿™ä¸ªå˜é‡<code>addr</code>çš„åœ°å€ã€‚</p><h3 id="æŒ‡é’ˆå˜é‡"><a href="#æŒ‡é’ˆå˜é‡" class="headerlink" title="æŒ‡é’ˆå˜é‡"></a>æŒ‡é’ˆå˜é‡</h3><p>ç”±äºä½¿ç”¨<code>unsigned int</code>å­˜å‚¨åœ°å€ä¼šå¯¼è‡´æ— æ³•æ ¹æ®åœ°å€å¾—åˆ°ç›¸åº”å†…å­˜å•å…ƒçš„å€¼ï¼Œå³å–å†…å®¹ï¼Œæ‰€ä»¥Cè¯­è¨€ä¸­ç”¨æŒ‡é’ˆå˜é‡æ¥å­˜å‚¨åœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* p = &amp;x;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦å£°æ˜ä¸€ä¸ªåªæƒ³<code>int</code>å˜é‡çš„æŒ‡é’ˆæ˜¯ï¼Œå°±ä½¿ç”¨å˜é‡ä¹‹å‰åŠ ä¸€ä¸ª<code>*</code>æ¥è¯´æ˜è¿™æ˜¯ä¸ªæŒ‡é’ˆå˜é‡ã€‚</p><p>å¦‚æœè¦å®šä¹‰å¤šä¸ªæŒ‡é’ˆï¼Œåˆ™å¿…é¡»æ¯ä¸ªå˜é‡åå‰éƒ½åŠ æ˜Ÿå·<code>*</code>ã€‚å¯¹ä¸€ä¸ªæŒ‡é’ˆå˜é‡å‰é¢åŠ ä¸Š<code>*</code>ä»£è¡¨å–æŒ‡é’ˆæŒ‡å‘çš„åœ°å€å†…å­˜å‚¨çš„å˜é‡çš„å€¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> * p = &amp;x;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;x = %d\n&quot;</span>, x);  <span class="comment">//5</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;add_x = %d\n&quot;</span> , &amp;x); <span class="comment">//-345631352</span></span><br><span class="line">    *p = <span class="number">6</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;x = %d\n&quot;</span>, x); <span class="comment">//6</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;add_x = %d\n&quot;</span> , &amp;x); <span class="comment">//-345631352</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œä¿®æ”¹<code>*p</code>ä¹Ÿä¼šç›´æ¥ä¿®æ”¹<code>x</code>çš„å€¼ï¼Œå› ä¸ºè¿™æ˜¯å¯¹<code>p</code>ç›´æ¥æŒ‡å‘çš„å†…å­˜å•å…ƒè¿›è¡Œæ“ä½œã€‚</p><p>å¦‚æœå¯¹æŒ‡é’ˆå˜é‡è¿›è¡ŒåŠ å‡ä¸€ä¸ªæ•´æ•°ï¼Œç§°ä¹‹ä¸ºæŒ‡é’ˆçš„ç§»åŠ¨ã€‚</p><p><code>p+n</code> ç­‰ä»·äº<code>(TYPE*)(int)p+n*sizeof(TYPE)</code></p><p>ä¸€ä¸ªæŒ‡é’ˆåŠ å‡ä¸€ä¸ªæ•´æ•°<code>n</code>ï¼Œå­˜å‚¨çš„åœ°å€å°†ä¼šåŠ ä¸Š<code>n</code>å€æ‰€æŒ‡å‘ç±»å‹çš„å¤§å°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> val=<span class="number">5.0</span>;</span><br><span class="line">    <span class="keyword">double</span> *p = &amp;val;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;d%\n&quot;</span>, p); <span class="comment">//12344426</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;d%\n&quot;</span>, p + <span class="number">1</span>); <span class="comment">//12344434 å¢åŠ äº†sizeof(double)==8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŒ‡é’ˆç±»å‹"><a href="#æŒ‡é’ˆç±»å‹" class="headerlink" title="æŒ‡é’ˆç±»å‹"></a>æŒ‡é’ˆç±»å‹</h3><p>æŒ‡é’ˆçš„ç±»å‹çš„å«ä¹‰æ˜¯ï¼š<strong>æŒ‡é’ˆå˜é‡çš„æœ¬èº«çš„ç±»å‹</strong>ã€‚</p><p>ä¸Šæ–‡æˆ‘ä»¬å·²ç»çŸ¥é“äº†æŒ‡é’ˆå˜é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯32ä½æˆ–è€…64ä½ï¼Œå–å†³äºæ“ä½œç³»ç»Ÿã€‚</p><p>é‚£ä¹ˆå¯ä»¥å¾—å‡ºç»“è®ºï¼Œä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰çš„æŒ‡é’ˆå˜é‡çš„å¤§å°éƒ½æ˜¯ç›¸ç­‰çš„ã€‚</p><p>ä»è¯­æ³•çš„è§’åº¦çœ‹ï¼Œä½ åªè¦<strong>æŠŠæŒ‡é’ˆå£°æ˜è¯­å¥é‡Œçš„æŒ‡é’ˆåå­—å»æ‰</strong>ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å°±æ˜¯è¿™ä¸ªæŒ‡é’ˆçš„ç±»å‹ã€‚è¿™æ˜¯æŒ‡é’ˆæœ¬èº«æ‰€å…·æœ‰çš„ç±»å‹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¾‹ä¸€ä¸­å„ä¸ªæŒ‡é’ˆçš„ç±»å‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* ptr;<span class="comment">//æŒ‡é’ˆçš„ç±»å‹æ˜¯int*</span></span><br><span class="line"><span class="keyword">char</span>* ptr;<span class="comment">//æŒ‡é’ˆçš„ç±»å‹æ˜¯char*</span></span><br><span class="line"><span class="keyword">int</span>** ptr;<span class="comment">//æŒ‡é’ˆçš„ç±»å‹æ˜¯int**</span></span><br><span class="line"><span class="keyword">int</span>(*ptr)[<span class="number">3</span>];<span class="comment">//æŒ‡é’ˆçš„ç±»å‹æ˜¯int(*)[3]</span></span><br><span class="line"><span class="keyword">int</span>*(*ptr)[<span class="number">4</span>];<span class="comment">//æŒ‡é’ˆçš„ç±»å‹æ˜¯int*(*)[4]</span></span><br></pre></td></tr></table></figure><h3 id="æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹"><a href="#æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹" class="headerlink" title="æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹"></a>æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹</h3><p>å½“é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºæ—¶ï¼ŒæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹å†³å®šäº†ç¼–è¯‘å™¨å°†æŠŠé‚£ç‰‡å†…å­˜åŒºé‡Œçš„å†…å®¹å½“åšä»€ä¹ˆæ¥çœ‹å¾…ã€‚</p><p>ä»è¯­æ³•ä¸Šçœ‹ï¼Œåªé¡»æŠŠæŒ‡é’ˆå£°æ˜è¯­å¥ä¸­çš„æŒ‡é’ˆåå­—å’Œåå­—å·¦è¾¹çš„æŒ‡é’ˆå£°æ˜ç¬¦<code>*</code>å»æ‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>*ptr; <span class="comment">//æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹æ˜¯int</span></span><br><span class="line"><span class="keyword">char</span>*ptr; <span class="comment">//æŒ‡é’ˆæ‰€æŒ‡å‘çš„çš„ç±»å‹æ˜¯char</span></span><br><span class="line"><span class="keyword">int</span>**ptr; <span class="comment">//æŒ‡é’ˆæ‰€æŒ‡å‘çš„çš„ç±»å‹æ˜¯int*</span></span><br><span class="line"><span class="keyword">int</span>(*ptr)[<span class="number">3</span>]; <span class="comment">//æŒ‡é’ˆæ‰€æŒ‡å‘çš„çš„ç±»å‹æ˜¯int()[3]</span></span><br><span class="line"><span class="keyword">int</span>*(*ptr)[<span class="number">4</span>]; <span class="comment">//æŒ‡é’ˆæ‰€æŒ‡å‘çš„çš„ç±»å‹æ˜¯int*()[4]</span></span><br></pre></td></tr></table></figure><p>åœ¨æŒ‡é’ˆçš„ç®—æœ¯è¿ç®—ä¸­ï¼ŒæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹æœ‰å¾ˆå¤§çš„ä½œç”¨ã€‚</p><p><strong>æŒ‡é’ˆçš„ç±»å‹(å³æŒ‡é’ˆæœ¬èº«çš„ç±»å‹)å’ŒæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹æ˜¯ä¸¤ä¸ªæ¦‚å¿µ</strong>ã€‚åˆ†æ¸…è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ç†è§£æŒ‡é’ˆçš„å…³é”®ç‚¹ä¹‹ä¸€ã€‚</p><h3 id="æŒ‡é’ˆçš„å€¼"><a href="#æŒ‡é’ˆçš„å€¼" class="headerlink" title="æŒ‡é’ˆçš„å€¼"></a>æŒ‡é’ˆçš„å€¼</h3><p>æŒ‡é’ˆçš„å€¼æ˜¯æŒ‡é’ˆæœ¬èº«å­˜å‚¨çš„æ•°å€¼ï¼Œè¿™ä¸ªå€¼å°†è¢«ç¼–è¯‘å™¨å½“ä½œä¸€ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€èˆ¬çš„æ•°å€¼ã€‚åœ¨32 ä½ç¨‹åºé‡Œï¼Œæ‰€æœ‰ç±»å‹çš„æŒ‡é’ˆçš„å€¼éƒ½æ˜¯ä¸€ä¸ª32 ä½æ•´æ•°ï¼Œå› ä¸º32 ä½ç¨‹åºé‡Œå†…å­˜åœ°å€å…¨éƒ½æ˜¯32 ä½é•¿ã€‚æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºå°±æ˜¯ä»æŒ‡é’ˆçš„å€¼æ‰€ä»£è¡¨çš„é‚£ä¸ªå†…å­˜åœ°å€å¼€å§‹ï¼Œé•¿åº¦ä¸ºsizeof(æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹)çš„ä¸€ç‰‡å†…å­˜åŒºã€‚ä»¥åï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªæŒ‡é’ˆçš„å€¼æ˜¯XXï¼Œå°±ç›¸å½“äºè¯´è¯¥æŒ‡é’ˆæŒ‡å‘äº†ä»¥XX ä¸ºé¦–åœ°å€çš„ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼›æˆ‘ä»¬è¯´ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†æŸå—å†…å­˜åŒºåŸŸï¼Œå°±ç›¸å½“äºè¯´è¯¥æŒ‡é’ˆçš„å€¼æ˜¯è¿™å—å†…å­˜åŒºåŸŸçš„é¦–åœ°å€ã€‚æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºå’ŒæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚</p><h3 id="æŒ‡é’ˆè‡ªèº«å æ®çš„å†…å­˜"><a href="#æŒ‡é’ˆè‡ªèº«å æ®çš„å†…å­˜" class="headerlink" title="æŒ‡é’ˆè‡ªèº«å æ®çš„å†…å­˜"></a>æŒ‡é’ˆè‡ªèº«å æ®çš„å†…å­˜</h3><p>å› ä¸ºæŒ‡é’ˆæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå›ºå®šä½æ•°æ•´æ•°ï¼Œåœ¨32 ä½å¹³å°é‡Œï¼ŒæŒ‡é’ˆæœ¬èº«å æ®äº†4 ä¸ªå­—èŠ‚çš„é•¿åº¦ã€‚æŒ‡é’ˆæœ¬èº«å æ®çš„å†…å­˜è¿™ä¸ªæ¦‚å¿µåœ¨åˆ¤æ–­ä¸€ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼æ˜¯å¦æ˜¯å·¦å€¼æ—¶å¾ˆæœ‰ç”¨ã€‚</p><h2 id="æŒ‡é’ˆè¿ç®—"><a href="#æŒ‡é’ˆè¿ç®—" class="headerlink" title="æŒ‡é’ˆè¿ç®—"></a>æŒ‡é’ˆè¿ç®—</h2><p>æŒ‡é’ˆå¯ä»¥åŠ ä¸Šæˆ–å‡å»ä¸€ä¸ªæ•´æ•°ã€‚æŒ‡é’ˆçš„è¿™ç§è¿ç®—çš„æ„ä¹‰å’Œé€šå¸¸çš„æ•°å€¼çš„åŠ å‡è¿ç®—çš„æ„ä¹‰æ˜¯ä¸ä¸€æ ·çš„ï¼Œä»¥å•å…ƒä¸ºå•ä½ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> a[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> *ptr=(<span class="keyword">int</span> *)a; <span class="comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢å¹¶ä¸ä¼šæ”¹å˜a çš„ç±»å‹</span></span><br><span class="line">ptr++;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¾‹ä¸­ï¼ŒæŒ‡é’ˆptr çš„ç±»å‹æ˜¯int*,å®ƒæŒ‡å‘çš„ç±»å‹æ˜¯intï¼Œå®ƒè¢«åˆå§‹åŒ–ä¸ºæŒ‡å‘æ•´å‹å˜é‡aã€‚æ¥ä¸‹æ¥çš„ç¬¬3å¥ä¸­ï¼ŒæŒ‡é’ˆptrè¢«åŠ äº†1ï¼Œç¼–è¯‘å™¨æ˜¯è¿™æ ·å¤„ç†çš„ï¼šå®ƒæŠŠæŒ‡é’ˆptr çš„å€¼åŠ ä¸Šäº†sizeof(int)ï¼Œåœ¨32 ä½ç¨‹åºä¸­ï¼Œæ˜¯è¢«åŠ ä¸Šäº†4ï¼Œå› ä¸ºåœ¨32 ä½ç¨‹åºä¸­ï¼Œint å 4 ä¸ªå­—èŠ‚ã€‚ç”±äºåœ°å€æ˜¯ç”¨å­—èŠ‚åšå•ä½çš„ï¼Œæ•…ptr æ‰€æŒ‡å‘çš„åœ°å€ç”±åŸæ¥çš„å˜é‡a çš„åœ°å€å‘é«˜åœ°å€æ–¹å‘å¢åŠ äº†4 ä¸ªå­—èŠ‚ã€‚ç”±äºchar ç±»å‹çš„é•¿åº¦æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ï¼ŒåŸæ¥ptr æ˜¯æŒ‡å‘æ•°ç»„a çš„ç¬¬0 å·å•å…ƒå¼€å§‹çš„å››ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶æŒ‡å‘äº†æ•°ç»„a ä¸­ä»ç¬¬4 å·å•å…ƒå¼€å§‹çš„å››ä¸ªå­—èŠ‚ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæŒ‡é’ˆå’Œä¸€ä¸ªå¾ªç¯æ¥éå†ä¸€ä¸ªæ•°ç»„ï¼Œçœ‹ä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> *ptr = <span class="built_in">array</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        (*ptr)++;</span><br><span class="line">        ptr++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å°†æ•´å‹æ•°ç»„ä¸­å„ä¸ªå•å…ƒçš„å€¼åŠ 1ã€‚ç”±äºæ¯æ¬¡å¾ªç¯éƒ½å°†æŒ‡é’ˆptråŠ 1 ä¸ªå•å…ƒï¼Œæ‰€ä»¥æ¯æ¬¡å¾ªç¯éƒ½èƒ½è®¿é—®æ•°ç»„çš„ä¸‹ä¸€ä¸ªå•å…ƒã€‚</p><h2 id="æŒ‡é’ˆè¡¨è¾¾å¼"><a href="#æŒ‡é’ˆè¡¨è¾¾å¼" class="headerlink" title="æŒ‡é’ˆè¡¨è¾¾å¼"></a>æŒ‡é’ˆè¡¨è¾¾å¼</h2><p>ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœå¦‚æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼å°±å«æŒ‡é’ˆè¡¨è¾¾å¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">int</span> a, b;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span> *pa;</span><br><span class="line">pa = &amp;a;         <span class="comment">//&amp;a æ˜¯ä¸€ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼ã€‚</span></span><br><span class="line"><span class="keyword">int</span> **ptr = &amp;pa; <span class="comment">//&amp;pa ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼ã€‚</span></span><br><span class="line">*ptr = &amp;b;       <span class="comment">//*ptr å’Œ&amp;b éƒ½æ˜¯æŒ‡é’ˆè¡¨è¾¾å¼ã€‚</span></span><br><span class="line">pa = <span class="built_in">array</span>;</span><br><span class="line">pa++; <span class="comment">//è¿™ä¹Ÿæ˜¯æŒ‡é’ˆè¡¨è¾¾å¼ã€‚</span></span><br><span class="line"><span class="keyword">char</span> *arr[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">char</span> **parr = arr; <span class="comment">//å¦‚æœæŠŠarr çœ‹ä½œæŒ‡é’ˆçš„è¯ï¼Œarr ä¹Ÿæ˜¯æŒ‡é’ˆè¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line">str = *parr;       <span class="comment">//*parr æ˜¯æŒ‡é’ˆè¡¨è¾¾å¼</span></span><br><span class="line">str = *(parr + <span class="number">1</span>); <span class="comment">//*(parr+1)æ˜¯æŒ‡é’ˆè¡¨è¾¾å¼</span></span><br><span class="line">str = *(parr + <span class="number">2</span>); <span class="comment">//*(parr+2)æ˜¯æŒ‡é’ˆè¡¨è¾¾å¼</span></span><br></pre></td></tr></table></figure><p>ç”±äºæŒ‡é’ˆè¡¨è¾¾å¼çš„ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æŒ‡é’ˆè¡¨è¾¾å¼ä¹Ÿå…·æœ‰æŒ‡é’ˆæ‰€å…·æœ‰çš„å››ä¸ªè¦ç´ ï¼šæŒ‡é’ˆçš„ç±»å‹ï¼ŒæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒºï¼ŒæŒ‡é’ˆè‡ªèº«å æ®çš„å†…å­˜ã€‚</p><p>å½“ä¸€ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼çš„ç»“æœæŒ‡é’ˆå·²ç»æ˜ç¡®åœ°å…·æœ‰äº†æŒ‡é’ˆè‡ªèº«å æ®çš„å†…å­˜çš„è¯ï¼Œè¿™ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå¦åˆ™å°±ä¸æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚</p><h2 id="æ•°ç»„å’ŒæŒ‡é’ˆ"><a href="#æ•°ç»„å’ŒæŒ‡é’ˆ" class="headerlink" title="æ•°ç»„å’ŒæŒ‡é’ˆ"></a>æ•°ç»„å’ŒæŒ‡é’ˆ</h2><p>æ•°ç»„çš„æ•°ç»„åå¯ä»¥çœ‹ä½œä¸€ä¸ªæŒ‡é’ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *str[<span class="number">3</span>] = &#123;</span><br><span class="line">        <span class="string">&quot;Hello,thisisasample!&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Hi,goodmorning.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Helloworld&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">80</span>];</span><br><span class="line"><span class="built_in">strcpy</span>(s, str[<span class="number">0</span>]); <span class="comment">//ä¹Ÿå¯å†™æˆstrcpy(s,*str);</span></span><br><span class="line"><span class="built_in">strcpy</span>(s, str[<span class="number">1</span>]); <span class="comment">//ä¹Ÿå¯å†™æˆstrcpy(s,*(str+1));</span></span><br><span class="line"><span class="built_in">strcpy</span>(s, str[<span class="number">2</span>]); <span class="comment">//ä¹Ÿå¯å†™æˆstrcpy(s,*(str+2));</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­ï¼Œstr æ˜¯ä¸€ä¸ªä¸‰å•å…ƒçš„æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æ¯ä¸ªå•å…ƒéƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™äº›æŒ‡é’ˆå„æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æŠŠæŒ‡é’ˆæ•°ç»„åstr å½“ä½œä¸€ä¸ªæŒ‡é’ˆçš„è¯ï¼Œå®ƒæŒ‡å‘æ•°ç»„çš„ç¬¬0 å·å•å…ƒï¼Œå®ƒçš„ç±»å‹æ˜¯char <em>*ï¼Œå®ƒæŒ‡å‘çš„ç±»å‹æ˜¯char </em>ã€‚</p><p><em>str ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒçš„ç±»å‹æ˜¯char </em>ï¼Œå®ƒæ‰€æŒ‡å‘çš„ç±»å‹æ˜¯charï¼Œå®ƒæŒ‡å‘çš„åœ°å€æ˜¯å­—ç¬¦ä¸²â€Hello,thisisasample!â€çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„åœ°å€ï¼Œå³â€™Hâ€™çš„åœ°å€ã€‚æ³¨æ„:å­—ç¬¦ä¸²ç›¸å½“äºæ˜¯ä¸€ä¸ªæ•°ç»„,åœ¨å†…å­˜ä¸­ä»¥æ•°ç»„çš„å½¢å¼å‚¨å­˜,åªä¸è¿‡å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„å¸¸é‡,å†…å®¹ä¸å¯æ”¹å˜,ä¸”åªèƒ½æ˜¯å³å€¼.å¦‚æœçœ‹æˆæŒ‡é’ˆçš„è¯,ä»–å³æ˜¯å¸¸é‡æŒ‡é’ˆ,ä¹Ÿæ˜¯æŒ‡é’ˆå¸¸é‡.</p><p>str+1 ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æ•°ç»„çš„ç¬¬1 å·å•å…ƒï¼Œå®ƒçš„ç±»å‹æ˜¯char<em>*ï¼Œå®ƒæŒ‡å‘çš„ç±»å‹æ˜¯char</em>ã€‚</p><p><em>(str+1)ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒçš„ç±»å‹æ˜¯char</em>ï¼Œå®ƒæ‰€æŒ‡å‘çš„ç±»å‹æ˜¯charï¼Œå®ƒæŒ‡å‘â€Hi,goodmorning.â€çš„ç¬¬ä¸€ä¸ªå­—ç¬¦â€™Hâ€™</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span>(*ptr)[<span class="number">10</span>];</span><br><span class="line">ptr = &amp;<span class="built_in">array</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­ptr æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒçš„ç±»å‹æ˜¯int(*)[10]ï¼Œä»–æŒ‡å‘çš„ç±»å‹æ˜¯int[10] ï¼Œæˆ‘ä»¬ç”¨æ•´ä¸ªæ•°ç»„çš„é¦–åœ°å€æ¥åˆå§‹åŒ–å®ƒã€‚åœ¨è¯­å¥ptr=&amp;arrayä¸­ï¼Œarray ä»£è¡¨æ•°ç»„æœ¬èº«ã€‚</p><p>æœ¬èŠ‚ä¸­æåˆ°äº†å‡½æ•°sizeof()ï¼Œé‚£ä¹ˆæˆ‘æ¥é—®ä¸€é—®ï¼Œsizeof(æŒ‡é’ˆåç§°)æµ‹å‡ºçš„ç©¶ç«Ÿæ˜¯æŒ‡é’ˆè‡ªèº«ç±»å‹çš„å¤§å°å‘¢è¿˜æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±»å‹çš„å¤§å°ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å‰è€…ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>(*ptr)[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p>åˆ™åœ¨32 ä½ç¨‹åºä¸­ï¼Œæœ‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sizeof</span>(<span class="keyword">int</span>(*)[<span class="number">10</span>])==<span class="number">4</span></span><br><span class="line"><span class="keyword">sizeof</span>(<span class="keyword">int</span>[<span class="number">10</span>])==<span class="number">40</span></span><br><span class="line"><span class="keyword">sizeof</span>(ptr)==<span class="number">4</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œsizeof(å¯¹è±¡)æµ‹å‡ºçš„éƒ½æ˜¯å¯¹è±¡è‡ªèº«çš„ç±»å‹çš„å¤§å°ï¼Œè€Œä¸æ˜¯åˆ«çš„ä»€ä¹ˆç±»å‹çš„å¤§å°ã€‚</p><h2 id="æŒ‡é’ˆå’Œç»“æ„ç±»å‹çš„å…³ç³»"><a href="#æŒ‡é’ˆå’Œç»“æ„ç±»å‹çš„å…³ç³»" class="headerlink" title="æŒ‡é’ˆå’Œç»“æ„ç±»å‹çš„å…³ç³»"></a>æŒ‡é’ˆå’Œç»“æ„ç±»å‹çš„å…³ç³»</h2><p>æ‰€æœ‰çš„C/C++ç¼–è¯‘å™¨åœ¨æ’åˆ—æ•°ç»„çš„å•å…ƒæ—¶ï¼Œæ€»æ˜¯æŠŠå„ä¸ªæ•°ç»„å•å…ƒå­˜æ”¾åœ¨è¿ç»­çš„å­˜å‚¨åŒºé‡Œï¼Œå•å…ƒå’Œå•å…ƒä¹‹é—´æ²¡æœ‰ç©ºéš™ã€‚ä½†åœ¨å­˜æ”¾ç»“æ„å¯¹è±¡çš„å„ä¸ªæˆå‘˜æ—¶ï¼Œåœ¨æŸç§ç¼–è¯‘ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šéœ€è¦å­—å¯¹é½æˆ–åŒå­—å¯¹é½æˆ–è€…æ˜¯åˆ«çš„ä»€ä¹ˆå¯¹é½ï¼Œéœ€è¦åœ¨ç›¸é‚»ä¸¤ä¸ªæˆå‘˜ä¹‹é—´åŠ è‹¥å¹²ä¸ªâ€å¡«å……å­—èŠ‚â€ï¼Œè¿™å°±å¯¼è‡´å„ä¸ªæˆå‘˜ä¹‹é—´å¯èƒ½ä¼šæœ‰è‹¥å¹²ä¸ªå­—èŠ‚çš„ç©ºéš™ã€‚</p><h2 id="æŒ‡é’ˆå’Œå‡½æ•°çš„å…³ç³»"><a href="#æŒ‡é’ˆå’Œå‡½æ•°çš„å…³ç³»" class="headerlink" title="æŒ‡é’ˆå’Œå‡½æ•°çš„å…³ç³»"></a>æŒ‡é’ˆå’Œå‡½æ•°çš„å…³ç³»</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fun1</span><span class="params">(<span class="keyword">char</span> *,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="keyword">int</span> (*pfun1)(<span class="keyword">char</span> *,<span class="keyword">int</span>);</span><br><span class="line">pfun1=fun1;</span><br><span class="line"><span class="keyword">int</span> a = (*pfun1)(<span class="string">&quot;abcdefg&quot;</span>,<span class="number">7</span>); <span class="comment">//é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ã€‚</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æŠŠæŒ‡é’ˆä½œä¸ºå‡½æ•°çš„å½¢å‚ã€‚åœ¨å‡½æ•°è°ƒç”¨è¯­å¥ä¸­ï¼Œå¯ä»¥ç”¨æŒ‡é’ˆè¡¨è¾¾å¼æ¥ä½œä¸ºå®å‚ã€‚</p><p>æ€»ç»“ï¼š</p><ol><li><p>å…¶å®ï¼ŒmyFunçš„å‡½æ•°åä¸funPã€funAå‡½æ•°æŒ‡é’ˆéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³éƒ½æ˜¯å‡½æ•°æŒ‡é’ˆã€‚myFunå‡½æ•°åæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆå¸¸é‡ï¼Œè€ŒfunPã€funAæ˜¯å‡½æ•°æ•°æŒ‡é’ˆå˜é‡ï¼Œè¿™æ˜¯å®ƒä»¬çš„å…³ç³»ã€‚</p></li><li><p>ä½†å‡½æ•°åè°ƒç”¨å¦‚æœéƒ½å¾—å¦‚(*myFun)(10)è¿™æ ·ï¼Œé‚£ä¹¦å†™ä¸è¯»èµ·æ¥éƒ½æ˜¯ä¸æ–¹ä¾¿å’Œä¸ä¹ æƒ¯çš„ã€‚æ‰€ä»¥Cè¯­è¨€çš„è®¾è®¡è€…ä»¬æ‰ä¼šè®¾è®¡æˆåˆå¯å…è®¸myFun(10)è¿™ç§å½¢å¼åœ°è°ƒç”¨ï¼ˆè¿™æ ·æ–¹ä¾¿å¤šäº†ï¼Œå¹¶ä¸æ•°å­¦ä¸­çš„å‡½æ•°å½¢å¼ä¸€æ ·ï¼‰ã€‚</p></li><li><p>ä¸ºäº†ç»Ÿä¸€è°ƒç”¨æ–¹å¼ï¼ŒfunPå‡½æ•°æŒ‡é’ˆå˜é‡ä¹Ÿå¯ä»¥funP(10)çš„å½¢å¼æ¥è°ƒç”¨ã€‚</p></li><li><p>èµ‹å€¼æ—¶ï¼Œå¯ä»¥å†™æˆfunP=&amp;myFunå½¢å¼ï¼Œä¹Ÿå¯ä»¥å†™æˆfunP=myFunã€‚</p></li><li><p>ä½†æ˜¯åœ¨å£°æ˜æ—¶ï¼Œvoid myFun(int )ä¸èƒ½å†™æˆvoid (<em>myFun)(int )ã€‚void (</em>funP)(int )ä¸èƒ½å†™æˆvoid funP(int )ã€‚</p></li><li><p>å‡½æ•°æŒ‡é’ˆå˜é‡ä¹Ÿå¯ä»¥å­˜å…¥ä¸€ä¸ªæ•°ç»„å†…ã€‚æ•°ç»„çš„å£°æ˜æ–¹æ³•ï¼šint (*fArray[10]) ( int );</p></li></ol><h2 id="é™„å½•-æŒ‡é’ˆç±»å‹åˆ¤æ–­å®ä¾‹"><a href="#é™„å½•-æŒ‡é’ˆç±»å‹åˆ¤æ–­å®ä¾‹" class="headerlink" title="é™„å½• - æŒ‡é’ˆç±»å‹åˆ¤æ–­å®ä¾‹"></a>é™„å½• - æŒ‡é’ˆç±»å‹åˆ¤æ–­å®ä¾‹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> p; <span class="comment">//è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•´å‹å˜é‡</span></span><br><span class="line"><span class="keyword">int</span> *p; <span class="comment">//é¦–å…ˆä»P å¤„å¼€å§‹,å…ˆä¸*ç»“åˆ,æ‰€ä»¥è¯´æ˜P æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,ç„¶åå†ä¸int ç»“åˆ,è¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹çš„ç±»å‹ä¸ºint å‹.æ‰€ä»¥Pæ˜¯ä¸€ä¸ªè¿”å›æ•´å‹æ•°æ®çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p[<span class="number">3</span>]; <span class="comment">//é¦–å…ˆä»P å¤„å¼€å§‹,å…ˆä¸[]ç»“åˆ,è¯´æ˜P æ˜¯ä¸€ä¸ªæ•°ç»„,ç„¶åä¸int ç»“åˆ,è¯´æ˜æ•°ç»„é‡Œçš„å…ƒç´ æ˜¯æ•´å‹çš„,æ‰€ä»¥P æ˜¯ä¸€ä¸ªç”±æ•´å‹æ•°æ®ç»„æˆçš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *p[<span class="number">3</span>]; <span class="comment">//é¦–å…ˆä»P å¤„å¼€å§‹,å…ˆä¸[]ç»“åˆ,å› ä¸ºå…¶ä¼˜å…ˆçº§æ¯”*é«˜,æ‰€ä»¥P æ˜¯ä¸€ä¸ªæ•°ç»„,ç„¶åå†ä¸*ç»“åˆ,è¯´æ˜æ•°ç»„é‡Œçš„å…ƒç´ æ˜¯æŒ‡é’ˆç±»å‹,ç„¶åå†ä¸int ç»“åˆ,è¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹çš„ç±»å‹æ˜¯æ•´å‹çš„,æ‰€ä»¥P æ˜¯ä¸€ä¸ªç”±è¿”å›æ•´å‹æ•°æ®çš„æŒ‡é’ˆæ‰€ç»„æˆçš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> (*p)[<span class="number">3</span>]; <span class="comment">//é¦–å…ˆä»P å¤„å¼€å§‹,å…ˆä¸*ç»“åˆ,è¯´æ˜P æ˜¯ä¸€ä¸ªæŒ‡é’ˆç„¶åå†ä¸[]ç»“åˆ(ä¸&quot;()&quot;è¿™æ­¥å¯ä»¥å¿½ç•¥,åªæ˜¯ä¸ºäº†æ”¹å˜ä¼˜å…ˆçº§),è¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹æ˜¯ä¸€ä¸ªæ•°ç»„,ç„¶åå†ä¸int ç»“åˆ,è¯´æ˜æ•°ç»„é‡Œçš„å…ƒç´ æ˜¯æ•´å‹çš„.æ‰€ä»¥P æ˜¯ä¸€ä¸ªæŒ‡å‘ç”±æ•´å‹æ•°æ®ç»„æˆçš„æ•°ç»„çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> **p; <span class="comment">//é¦–å…ˆä»P å¼€å§‹,å…ˆä¸*ç»“åˆ,è¯´æ˜¯P æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,ç„¶åå†ä¸*ç»“åˆ,è¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ æ˜¯æŒ‡é’ˆ,ç„¶åå†ä¸int ç»“åˆ,è¯´æ˜è¯¥æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ æ˜¯æ•´å‹æ•°æ®.ç”±äºäºŒçº§æŒ‡é’ˆä»¥åŠæ›´é«˜çº§çš„æŒ‡é’ˆæå°‘ç”¨åœ¨å¤æ‚çš„ç±»å‹ä¸­,æ‰€ä»¥åé¢æ›´å¤æ‚çš„ç±»å‹æˆ‘ä»¬å°±ä¸è€ƒè™‘å¤šçº§æŒ‡é’ˆäº†,æœ€å¤šåªè€ƒè™‘ä¸€çº§æŒ‡é’ˆ.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">p</span><span class="params">(<span class="keyword">int</span>)</span></span>; <span class="comment">//ä»P å¤„èµ·,å…ˆä¸()ç»“åˆ,è¯´æ˜P æ˜¯ä¸€ä¸ªå‡½æ•°,ç„¶åè¿›å…¥()é‡Œåˆ†æ,è¯´æ˜è¯¥å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å˜é‡çš„å‚æ•°,ç„¶åå†ä¸å¤–é¢çš„int ç»“åˆ,è¯´æ˜å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•´å‹æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> (*p)(<span class="keyword">int</span>); <span class="comment">//ä»P å¤„å¼€å§‹,å…ˆä¸æŒ‡é’ˆç»“åˆ,è¯´æ˜P æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,ç„¶åä¸()ç»“åˆ,è¯´æ˜æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå‡½æ•°,ç„¶åå†ä¸()é‡Œçš„int ç»“åˆ,è¯´æ˜å‡½æ•°æœ‰ä¸€ä¸ªint å‹çš„å‚æ•°,å†ä¸æœ€å¤–å±‚çš„int ç»“åˆ,è¯´æ˜å‡½æ•°çš„è¿”å›ç±»å‹æ˜¯æ•´å‹,æ‰€ä»¥P æ˜¯ä¸€ä¸ªæŒ‡å‘æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºæ•´å‹çš„å‡½æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *(*p(<span class="keyword">int</span>))[<span class="number">3</span>]; <span class="comment">//å¯ä»¥å…ˆè·³è¿‡,ä¸çœ‹è¿™ä¸ªç±»å‹,è¿‡äºå¤æ‚ä»P å¼€å§‹,å…ˆä¸()ç»“åˆ,è¯´æ˜P æ˜¯ä¸€ä¸ªå‡½æ•°,ç„¶åè¿›å…¥()é‡Œé¢,ä¸int ç»“åˆ,è¯´æ˜å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å˜é‡å‚æ•°,ç„¶åå†ä¸å¤–é¢çš„*ç»“åˆ,è¯´æ˜å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,,ç„¶ååˆ°æœ€å¤–é¢ä¸€å±‚,å…ˆä¸[]ç»“åˆ,è¯´æ˜è¿”å›çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ•°ç»„,ç„¶åå†ä¸*ç»“åˆ,è¯´æ˜æ•°ç»„é‡Œçš„å…ƒç´ æ˜¯æŒ‡é’ˆ,ç„¶åå†ä¸int ç»“åˆ,è¯´æ˜æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ˜¯æ•´å‹æ•°æ®.æ‰€ä»¥P æ˜¯ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•´æ•°æ®ä¸”è¿”å›ä¸€ä¸ªæŒ‡å‘ç”±æ•´å‹æŒ‡é’ˆå˜é‡ç»„æˆçš„æ•°ç»„çš„æŒ‡é’ˆå˜é‡çš„å‡½æ•°</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxè¿›ç¨‹ç®¡ç†ä¹‹ipcs</title>
      <link href="/2015/10/16/Linux/Linux%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B9%8Bipcs/"/>
      <url>/2015/10/16/Linux/Linux%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B9%8Bipcs/</url>
      
        <content type="html"><![CDATA[<h2 id="ipcs-æŸ¥è¯¢è¿›ç¨‹é—´é€šä¿¡çŠ¶æ€"><a href="#ipcs-æŸ¥è¯¢è¿›ç¨‹é—´é€šä¿¡çŠ¶æ€" class="headerlink" title="ipcs - æŸ¥è¯¢è¿›ç¨‹é—´é€šä¿¡çŠ¶æ€"></a>ipcs - æŸ¥è¯¢è¿›ç¨‹é—´é€šä¿¡çŠ¶æ€</h2><p>ipcsæ˜¯Linuxä¸‹æ˜¾ç¤ºè¿›ç¨‹é—´é€šä¿¡è®¾æ–½çŠ¶æ€çš„å·¥å…·ã€‚å¯ä»¥æ˜¾ç¤ºæ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜å’Œä¿¡å·é‡çš„ä¿¡æ¯ã€‚å¯ä»¥ä¸ºç¨‹åºå‘˜æä¾›å¤§é‡ä¿¡æ¯æ¥åˆ†æç¨‹åºè¿è¡ŒçŠ¶æ€ã€‚</p><a id="more"></a><h2 id="IPCèµ„æºæŸ¥è¯¢"><a href="#IPCèµ„æºæŸ¥è¯¢" class="headerlink" title="IPCèµ„æºæŸ¥è¯¢"></a>IPCèµ„æºæŸ¥è¯¢</h2><h3 id="æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCèµ„æº"><a href="#æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCèµ„æº" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCèµ„æº"></a>æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCèµ„æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ipcs</span></span><br><span class="line"></span><br><span class="line">------ Shared Memory Segments --------</span><br><span class="line">key        shmid      owner      perms      bytes      nattch     status</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x00000000 229376     weber      600        1</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«æŸ¥è¯¢IPCèµ„æº:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ipcs</span> -m <span class="comment">#æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCå…±äº«å†…å­˜èµ„æº</span></span><br><span class="line"><span class="variable">$ipcs</span> -q <span class="comment">#æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCé˜Ÿåˆ—èµ„æº</span></span><br><span class="line"><span class="variable">$ipcs</span> -s <span class="comment">#æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨çš„IPCä¿¡å·é‡èµ„æº</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹IPCèµ„æºè¢«è°å ç”¨"><a href="#æŸ¥çœ‹IPCèµ„æºè¢«è°å ç”¨" class="headerlink" title="æŸ¥çœ‹IPCèµ„æºè¢«è°å ç”¨"></a>æŸ¥çœ‹IPCèµ„æºè¢«è°å ç”¨</h3><p>ç¤ºä¾‹ï¼šæœ‰ä¸ªIPCKEY(51036)ï¼Œéœ€è¦æŸ¥è¯¢å…¶æ˜¯å¦è¢«å ç”¨ï¼›</p><ol><li><p>é¦–å…ˆé€šè¿‡è®¡ç®—å™¨å°†å…¶è½¬ä¸ºåå…­è¿›åˆ¶:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">printf</span> %x 51036</span><br><span class="line">c75c</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœçŸ¥é“æ˜¯è¢«å…±äº«å†…å­˜å ç”¨:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ipcs -m | grep c75c</span><br><span class="line">0x0000c75c 40403197   tdea3    666        536870912  2</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœä¸ç¡®å®šï¼Œåˆ™ç›´æ¥æŸ¥æ‰¾:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ipcs</span> | grep c75c</span><br><span class="line">0x0000c75c 40403197   tdea3    666        536870912  2</span><br><span class="line">0x0000c75c 5079070    tdea3    666        4</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç³»ç»ŸIPCå‚æ•°æŸ¥è¯¢"><a href="#ç³»ç»ŸIPCå‚æ•°æŸ¥è¯¢" class="headerlink" title="ç³»ç»ŸIPCå‚æ•°æŸ¥è¯¢"></a>ç³»ç»ŸIPCå‚æ•°æŸ¥è¯¢</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ipcs -l</span><br><span class="line">------ Messages Limits --------</span><br><span class="line">max queues system wide = 32000</span><br><span class="line">max size of message (bytes) = 8192</span><br><span class="line">default max size of queue (bytes) = 16384</span><br><span class="line"></span><br><span class="line">------ Shared Memory Limits --------</span><br><span class="line">max number of segments = 4096</span><br><span class="line">max seg size (kbytes) = 18014398509465599</span><br><span class="line">max total shared memory (kbytes) = 18014398509481980</span><br><span class="line">min seg size (bytes) = 1</span><br><span class="line"></span><br><span class="line">------ Semaphore Limits --------</span><br><span class="line">max number of arrays = 32000</span><br><span class="line">max semaphores per array = 32000</span><br><span class="line">max semaphores system wide = 1024000000</span><br><span class="line">max ops per semop call = 500</span><br><span class="line">semaphore max value = 32767</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¾“å‡ºæ˜¾ç¤ºï¼Œç›®å‰è¿™ä¸ªç³»ç»Ÿçš„å…è®¸çš„æœ€å¤§å†…å­˜ä¸º18014398509481980kbï¼›æœ€å¤§å¯ä½¿ç”¨32000ä¸ªä¿¡å·é‡ï¼Œæ¯ä¸ªæ¶ˆæ¯çš„æœ€å¤§é•¿åº¦ä¸º16384bytesï¼›</p><h2 id="ä¿®æ”¹IPCç³»ç»Ÿå‚æ•°"><a href="#ä¿®æ”¹IPCç³»ç»Ÿå‚æ•°" class="headerlink" title="ä¿®æ”¹IPCç³»ç»Ÿå‚æ•°"></a>ä¿®æ”¹IPCç³»ç»Ÿå‚æ•°</h2><p>ä»¥linuxç³»ç»Ÿä¸ºä¾‹ï¼Œåœ¨rootç”¨æˆ·ä¸‹ä¿®æ”¹/etc/sysctl.conf æ–‡ä»¶ï¼Œä¿å­˜åä½¿ç”¨sysctl -pç”Ÿæ•ˆ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/sysctl.conf</span><br><span class="line"><span class="comment"># ä¸€ä¸ªæ¶ˆæ¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">kernel.msgmax = 524288</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸Šçš„æœ€å¤§å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment"># 524288*10</span></span><br><span class="line">kernel.msgmnb = 5242880</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ€å¤§æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸ªæ•°</span></span><br><span class="line">kernel.msgmni=2048</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€ä¸ªå…±äº«å†…å­˜åŒºçš„æœ€å¤§å­—èŠ‚æ•°</span></span><br><span class="line">kernel.shmmax = 17179869184</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç³»ç»ŸèŒƒå›´å†…æœ€å¤§å…±äº«å†…å­˜æ ‡è¯†æ•°</span></span><br><span class="line">kernel.shmmni=4096</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¯ä¸ªä¿¡å·ç¯é›†çš„æœ€å¤§ä¿¡å·ç¯æ•° ç³»ç»ŸèŒƒå›´å†…æœ€å¤§ä¿¡å·ç¯æ•° æ¯ä¸ªä¿¡å·ç¯æ”¯æŒçš„æœ€å¤§æ“ä½œæ•° ç³»ç»ŸèŒƒå›´å†…æœ€å¤§ä¿¡å·ç¯é›†æ•°</span></span><br><span class="line"><span class="comment">#æ­¤å‚æ•°ä¸ºç³»ç»Ÿé»˜è®¤ï¼Œå¯ä»¥ä¸ç”¨ä¿®æ”¹</span></span><br><span class="line"><span class="comment">#kernel.sem = &lt;semmsl&gt; &lt;semmni&gt;*&lt;semmsl&gt; &lt;semopm&gt; &lt;semmni&gt;</span></span><br><span class="line">kernel.sem = 250 32000 32 128</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºè¾“å…¥ä¸å¸¦æ ‡å¿—çš„ ipcsï¼šçš„è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ipcs</span><br><span class="line">IPC status from /dev/mem as of Mon Aug 14 15:03:46 1989</span><br><span class="line">T    ID         KEY        MODE       OWNER     GROUP</span><br><span class="line">Message Queues:</span><br><span class="line">q       0    0x00010381 -Rrw-rw-rw-   root      system</span><br><span class="line">q   65537    0x00010307 -Rrw-rw-rw-   root      system</span><br><span class="line">q   65538    0x00010311 -Rrw-rw-rw-   root      system</span><br><span class="line">q   65539    0x0001032f -Rrw-rw-rw-   root      system</span><br><span class="line">q   65540    0x0001031b -Rrw-rw-rw-   root      system</span><br><span class="line">q   65541    0x00010339--rw-rw-rw-    root      system</span><br><span class="line">q       6    0x0002fe03 -Rrw-rw-rw-   root      system</span><br><span class="line">Shared Memory:</span><br><span class="line">m   65537    0x00000000 DCrw-------   root      system</span><br><span class="line">m  720898    0x00010300 -Crw-rw-rw-   root      system</span><br><span class="line">m   65539    0x00000000 DCrw-------   root      system</span><br><span class="line">Semaphores:</span><br><span class="line">s  131072    0x4d02086a --ra-ra----   root      system</span><br><span class="line">s   65537    0x00000000 --ra-------   root      system</span><br><span class="line">s 1310722    0x000133d0 --ra-------   7003      30720</span><br></pre></td></tr></table></figure><h2 id="æ¸…é™¤IPCèµ„æº"><a href="#æ¸…é™¤IPCèµ„æº" class="headerlink" title="æ¸…é™¤IPCèµ„æº"></a>æ¸…é™¤IPCèµ„æº</h2><p>ä½¿ç”¨ipcrm å‘½ä»¤æ¥æ¸…é™¤IPCèµ„æºï¼šè¿™ä¸ªå‘½ä»¤åŒæ—¶ä¼šå°†ä¸ipcå¯¹è±¡ç›¸å…³è”çš„æ•°æ®ä¹Ÿä¸€èµ·ç§»é™¤ã€‚å½“ç„¶ï¼Œåªæœ‰rootç”¨æˆ·ï¼Œæˆ–è€…ipcå¯¹è±¡çš„åˆ›å»ºè€…æ‰æœ‰è¿™é¡¹æƒåˆ©ï¼›</p><p>ipcrmç”¨æ³•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ipcrm -M shmkey  <span class="comment">#ç§»é™¤ç”¨shmkeyåˆ›å»ºçš„å…±äº«å†…å­˜æ®µ</span></span><br><span class="line">ipcrm -m shmid    <span class="comment">#ç§»é™¤ç”¨shmidæ ‡è¯†çš„å…±äº«å†…å­˜æ®µ</span></span><br><span class="line">ipcrm -Q msgkey  <span class="comment">#ç§»é™¤ç”¨msqkeyåˆ›å»ºçš„æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">ipcrm -q msqid  <span class="comment">#ç§»é™¤ç”¨msqidæ ‡è¯†çš„æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">ipcrm -S semkey  <span class="comment">#ç§»é™¤ç”¨semkeyåˆ›å»ºçš„ä¿¡å·</span></span><br><span class="line">ipcrm -s semid  <span class="comment">#ç§»é™¤ç”¨semidæ ‡è¯†çš„ä¿¡å·</span></span><br></pre></td></tr></table></figure><p>æ¸…é™¤å½“å‰ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰çš„IPCèµ„æº:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipcs -q | awk <span class="string">&#x27;&#123; print &quot;ipcrm -q &quot;$2&#125;&#x27;</span> | sh &gt; /dev/null 2&gt;&amp;1;</span><br><span class="line">ipcs -m | awk <span class="string">&#x27;&#123; print &quot;ipcrm -m &quot;$2&#125;&#x27;</span> | sh &gt; /dev/null 2&gt;&amp;1;</span><br><span class="line">ipcs -s | awk <span class="string">&#x27;&#123; print &quot;ipcrm -s &quot;$2&#125;&#x27;</span> | sh &gt; /dev/null 2&gt;&amp;1;</span><br></pre></td></tr></table></figure><h2 id="ç»¼åˆåº”ç”¨"><a href="#ç»¼åˆåº”ç”¨" class="headerlink" title="ç»¼åˆåº”ç”¨"></a>ç»¼åˆåº”ç”¨</h2><h3 id="æŸ¥è¯¢user1ç”¨æˆ·ç¯å¢ƒä¸Šæ˜¯å¦å­˜åœ¨ç§¯Queueç°è±¡"><a href="#æŸ¥è¯¢user1ç”¨æˆ·ç¯å¢ƒä¸Šæ˜¯å¦å­˜åœ¨ç§¯Queueç°è±¡" class="headerlink" title="æŸ¥è¯¢user1ç”¨æˆ·ç¯å¢ƒä¸Šæ˜¯å¦å­˜åœ¨ç§¯Queueç°è±¡"></a>æŸ¥è¯¢user1ç”¨æˆ·ç¯å¢ƒä¸Šæ˜¯å¦å­˜åœ¨ç§¯Queueç°è±¡</h3><ol><li><p>æŸ¥è¯¢é˜Ÿåˆ—Queue:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ipcs -q</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages</span><br><span class="line">0x49060005 58261504   user1    660        0            0</span><br><span class="line">0x4f060005 58294273   user1    660        0            0</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æ‰¾å‡ºç¬¬6åˆ—å¤§äº0çš„æœåŠ¡:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ipcs -q |grep user1 |awk <span class="string">&#x27;&#123;if($5&gt;0) print $0&#125;&#x27;</span></span><br><span class="line">0x00000000 1071579324 user1       644        1954530      4826</span><br><span class="line">0x00000000 1071644862 user1       644        1961820      4844</span><br><span class="line">0x00000000 1071677631 user1       644        1944810      4802</span><br><span class="line">0x00000000 1071710400 user1       644        1961820      4844</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxè¿›ç¨‹ç®¡ç†ä¹‹ps</title>
      <link href="/2015/10/14/Linux/Linux%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B9%8Bps/"/>
      <url>/2015/10/14/Linux/Linux%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B9%8Bps/</url>
      
        <content type="html"><![CDATA[<h2 id="ps-è¿›ç¨‹æŸ¥çœ‹å™¨"><a href="#ps-è¿›ç¨‹æŸ¥çœ‹å™¨" class="headerlink" title="ps - è¿›ç¨‹æŸ¥çœ‹å™¨"></a>ps - è¿›ç¨‹æŸ¥çœ‹å™¨</h2><p>Linuxä¸­çš„pså‘½ä»¤æ˜¯Process Statusçš„ç¼©å†™ã€‚pså‘½ä»¤ç”¨æ¥åˆ—å‡ºç³»ç»Ÿä¸­å½“å‰è¿è¡Œçš„é‚£äº›è¿›ç¨‹ã€‚pså‘½ä»¤åˆ—å‡ºçš„æ˜¯å½“å‰é‚£äº›è¿›ç¨‹çš„å¿«ç…§ï¼Œå°±æ˜¯æ‰§è¡Œpså‘½ä»¤çš„é‚£ä¸ªæ—¶åˆ»çš„é‚£äº›è¿›ç¨‹ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€çš„æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨topå‘½ä»¤ã€‚</p><a id="more"></a><p>è¦å¯¹è¿›ç¨‹è¿›è¡Œç›‘æµ‹å’Œæ§åˆ¶ï¼Œé¦–å…ˆå¿…é¡»è¦äº†è§£å½“å‰è¿›ç¨‹çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŸ¥çœ‹å½“å‰è¿›ç¨‹ï¼Œè€Œ ps å‘½ä»¤å°±æ˜¯æœ€åŸºæœ¬åŒæ—¶ä¹Ÿæ˜¯éå¸¸å¼ºå¤§çš„è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ã€‚ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥ç¡®å®šæœ‰å“ªäº›è¿›ç¨‹æ­£åœ¨è¿è¡Œå’Œè¿è¡Œçš„çŠ¶æ€ã€è¿›ç¨‹æ˜¯å¦ç»“æŸã€è¿›ç¨‹æœ‰æ²¡æœ‰åƒµæ­»ã€å“ªäº›è¿›ç¨‹å ç”¨äº†è¿‡å¤šçš„èµ„æºç­‰ç­‰ã€‚æ€»ä¹‹å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½æ˜¯å¯ä»¥é€šè¿‡æ‰§è¡Œè¯¥å‘½ä»¤å¾—åˆ°çš„ã€‚</p><p>ps ä¸ºæˆ‘ä»¬æä¾›äº†è¿›ç¨‹çš„ä¸€æ¬¡æ€§çš„æŸ¥çœ‹ï¼Œå®ƒæ‰€æä¾›çš„æŸ¥çœ‹ç»“æœå¹¶ä¸åŠ¨æ€è¿ç»­çš„ï¼›å¦‚æœæƒ³å¯¹è¿›ç¨‹æ—¶é—´ç›‘æ§ï¼Œåº”è¯¥ç”¨ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/top.html#top">top linuxä¸‹çš„ä»»åŠ¡ç®¡ç†å™¨</a> å·¥å…·ã€‚</p><p>æ³¨ï¼škill å‘½ä»¤ç”¨äºæ€æ­»è¿›ç¨‹ã€‚</p><h2 id="è¿›ç¨‹çŠ¶æ€"><a href="#è¿›ç¨‹çŠ¶æ€" class="headerlink" title="è¿›ç¨‹çŠ¶æ€"></a>è¿›ç¨‹çŠ¶æ€</h2><p>linuxä¸Šè¿›ç¨‹æœ‰5ç§çŠ¶æ€:</p><ol><li>è¿è¡Œ(æ­£åœ¨è¿è¡Œæˆ–åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…)</li><li>ä¸­æ–­(ä¼‘çœ ä¸­, å—é˜», åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å½¢æˆæˆ–æ¥å—åˆ°ä¿¡å·)</li><li>ä¸å¯ä¸­æ–­(æ”¶åˆ°ä¿¡å·ä¸å”¤é†’å’Œä¸å¯è¿è¡Œ, è¿›ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æœ‰ä¸­æ–­å‘ç”Ÿ)</li><li>åƒµæ­»(è¿›ç¨‹å·²ç»ˆæ­¢, ä½†è¿›ç¨‹æè¿°ç¬¦å­˜åœ¨, ç›´åˆ°çˆ¶è¿›ç¨‹è°ƒç”¨wait4()ç³»ç»Ÿè°ƒç”¨åé‡Šæ”¾)</li><li>åœæ­¢(è¿›ç¨‹æ”¶åˆ°SIGSTOP, SIGTSTP, SIGTTIN, SIGTTOUä¿¡å·ååœæ­¢è¿è¡Œè¿è¡Œ)</li></ol><p>pså·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç :</p><ul><li>D ä¸å¯ä¸­æ–­ uninterruptible sleep (usually IO)</li><li>R è¿è¡Œ runnable (on run queue)</li><li>S ä¸­æ–­ sleeping</li><li>T åœæ­¢ traced or stopped</li><li>Z åƒµæ­» a defunct (â€zombieâ€) process</li></ul><h2 id="å‘½ä»¤å‚æ•°"><a href="#å‘½ä»¤å‚æ•°" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h2><ul><li>a æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</li><li>-a æ˜¾ç¤ºåŒä¸€ç»ˆç«¯ä¸‹çš„æ‰€æœ‰ç¨‹åº</li><li>-A æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</li><li>c æ˜¾ç¤ºè¿›ç¨‹çš„çœŸå®åç§°</li><li>-N åå‘é€‰æ‹©</li><li>-e ç­‰äºâ€œ-Aâ€</li><li>e æ˜¾ç¤ºç¯å¢ƒå˜é‡</li><li>f æ˜¾ç¤ºç¨‹åºé—´çš„å…³ç³»</li><li>-H æ˜¾ç¤ºæ ‘çŠ¶ç»“æ„</li><li>r æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„è¿›ç¨‹</li><li>T æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„æ‰€æœ‰ç¨‹åº</li><li>u æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹</li><li>-au æ˜¾ç¤ºè¾ƒè¯¦ç»†çš„èµ„è®¯</li><li>-aux æ˜¾ç¤ºæ‰€æœ‰åŒ…å«å…¶ä»–ä½¿ç”¨è€…çš„è¡Œç¨‹</li><li>-C&lt;å‘½ä»¤&gt; åˆ—å‡ºæŒ‡å®šå‘½ä»¤çš„çŠ¶å†µ</li><li>â€“lines&lt;è¡Œæ•°&gt; æ¯é¡µæ˜¾ç¤ºçš„è¡Œæ•°</li><li>â€“width&lt;å­—ç¬¦æ•°&gt; æ¯é¡µæ˜¾ç¤ºçš„å­—ç¬¦æ•°</li><li>â€“help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</li><li>â€“version æ˜¾ç¤ºç‰ˆæœ¬æ˜¾ç¤º</li></ul><h2 id="è¾“å‡ºåˆ—çš„å«ä¹‰"><a href="#è¾“å‡ºåˆ—çš„å«ä¹‰" class="headerlink" title="è¾“å‡ºåˆ—çš„å«ä¹‰"></a>è¾“å‡ºåˆ—çš„å«ä¹‰</h2><ul><li>F ä»£è¡¨è¿™ä¸ªç¨‹åºçš„æ——æ ‡ (flag)ï¼Œ 4 ä»£è¡¨ä½¿ç”¨è€…ä¸º super user</li><li>S ä»£è¡¨è¿™ä¸ªç¨‹åºçš„çŠ¶æ€ (STAT)</li><li>UID ç¨‹åºè¢«è¯¥ UID æ‰€æ‹¥æœ‰</li><li>PID è¿›ç¨‹çš„ID</li><li>PPID åˆ™æ˜¯å…¶ä¸Šçº§çˆ¶ç¨‹åºçš„ID</li><li>C CPU ä½¿ç”¨çš„èµ„æºç™¾åˆ†æ¯”</li><li>PRI è¿™ä¸ªæ˜¯ Priority (ä¼˜å…ˆæ‰§è¡Œåº) çš„ç¼©å†™</li><li>NI Niceå€¼</li><li>ADDR è¿™ä¸ªæ˜¯ kernel functionï¼ŒæŒ‡å‡ºè¯¥ç¨‹åºåœ¨å†…å­˜çš„å“ªä¸ªéƒ¨åˆ†ã€‚å¦‚æœæ˜¯ä¸ª runningçš„ç¨‹åºï¼Œä¸€èˆ¬å°±æ˜¯ â€œ-â€œ</li><li>SZ ä½¿ç”¨æ‰çš„å†…å­˜å¤§å°</li><li>WCHAN ç›®å‰è¿™ä¸ªç¨‹åºæ˜¯å¦æ­£åœ¨è¿ä½œå½“ä¸­ï¼Œè‹¥ä¸º - è¡¨ç¤ºæ­£åœ¨è¿ä½œ</li><li>TTY ç™»å…¥è€…çš„ç»ˆç«¯æœºä½ç½®</li><li>TIME ä½¿ç”¨æ‰çš„ CPU æ—¶é—´ã€‚</li><li>CMD æ‰€ä¸‹è¾¾çš„æŒ‡ä»¤ä¸ºä½•</li></ul><h2 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h2><h3 id="å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯"><a href="#å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯"></a>å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ps -A</span><br><span class="line">PID TTY          TIME CMD</span><br><span class="line">1 ?        00:00:00 init</span><br><span class="line">2 ?        00:00:01 migration/0</span><br><span class="line">3 ?        00:00:00 ksoftirqd/0</span><br><span class="line">4 ?        00:00:01 migration/1</span><br><span class="line">5 ?        00:00:00 ksoftirqd/1</span><br><span class="line">6 ?        00:29:57 events/0</span><br><span class="line">7 ?        00:00:00 events/1</span><br><span class="line">8 ?        00:00:00 khelper</span><br><span class="line">49 ?        00:00:00 kthread</span><br><span class="line">54 ?        00:00:00 kblockd/0</span><br><span class="line">55 ?        00:00:00 kblockd/1</span><br><span class="line">56 ?        00:00:00 kacpid</span><br><span class="line">217 ?        00:00:00 cqueue/0</span><br><span class="line">â€¦â€¦çœç•¥éƒ¨åˆ†ç»“æœ</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯"><a href="#å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯" class="headerlink" title="å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯"></a>å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ ps -u root</span><br><span class="line">PID TTY          TIME CMD</span><br><span class="line">1 ?        00:00:00 init</span><br><span class="line">2 ?        00:00:01 migration/0</span><br><span class="line">3 ?        00:00:00 ksoftirqd/0</span><br><span class="line">4 ?        00:00:01 migration/1</span><br><span class="line">5 ?        00:00:00 ksoftirqd/1</span><br><span class="line">6 ?        00:29:57 events/0</span><br><span class="line">7 ?        00:00:00 events/1</span><br><span class="line">8 ?        00:00:00 khelper</span><br><span class="line">49 ?        00:00:00 kthread</span><br><span class="line">54 ?        00:00:00 kblockd/0</span><br><span class="line">55 ?        00:00:00 kblockd/1</span><br><span class="line">56 ?        00:00:00 kacpid</span><br><span class="line">â€¦â€¦çœç•¥éƒ¨åˆ†ç»“æœ</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹3ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œè¿åŒå‘½ä»¤è¡Œ"><a href="#å®ä¾‹3ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œè¿åŒå‘½ä»¤è¡Œ" class="headerlink" title="å®ä¾‹3ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œè¿åŒå‘½ä»¤è¡Œ"></a>å®ä¾‹3ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œè¿åŒå‘½ä»¤è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 Nov02 ?        00:00:00 init [3]</span><br><span class="line">root         2     1  0 Nov02 ?        00:00:01 [migration/0]</span><br><span class="line">root         3     1  0 Nov02 ?        00:00:00 [ksoftirqd/0]</span><br><span class="line">root         4     1  0 Nov02 ?        00:00:01 [migration/1]</span><br><span class="line">root         5     1  0 Nov02 ?        00:00:00 [ksoftirqd/1]</span><br><span class="line">root         6     1  0 Nov02 ?        00:29:57 [events/0]</span><br><span class="line">root         7     1  0 Nov02 ?        00:00:00 [events/1]</span><br><span class="line">root         8     1  0 Nov02 ?        00:00:00 [khelper]</span><br><span class="line">root        49     1  0 Nov02 ?        00:00:00 [kthread]</span><br><span class="line">root        54    49  0 Nov02 ?        00:00:00 [kblockd/0]</span><br><span class="line">root        55    49  0 Nov02 ?        00:00:00 [kblockd/1]</span><br><span class="line">root        56    49  0 Nov02 ?        00:00:00 [kacpid]</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹4ï¼š-ps-ä¸grep-ç»„åˆä½¿ç”¨ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹"><a href="#å®ä¾‹4ï¼š-ps-ä¸grep-ç»„åˆä½¿ç”¨ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹" class="headerlink" title="å®ä¾‹4ï¼š ps ä¸grep ç»„åˆä½¿ç”¨ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹"></a>å®ä¾‹4ï¼š ps ä¸grep ç»„åˆä½¿ç”¨ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef|grep ssh</span><br><span class="line">root      2720     1  0 Nov02 ?        00:00:00 /usr/sbin/sshd</span><br><span class="line">root     17394  2720  0 14:58 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root     17465 17398  0 15:57 pts/0    00:00:00 grep ssh</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹5ï¼šå°†ä¸è¿™æ¬¡ç™»å…¥çš„-PID-ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥"><a href="#å®ä¾‹5ï¼šå°†ä¸è¿™æ¬¡ç™»å…¥çš„-PID-ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥" class="headerlink" title="å®ä¾‹5ï¼šå°†ä¸è¿™æ¬¡ç™»å…¥çš„ PID ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥"></a>å®ä¾‹5ï¼šå°†ä¸è¿™æ¬¡ç™»å…¥çš„ PID ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ps -l</span><br><span class="line">F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0 17398 17394  0  75   0 - 16543 <span class="built_in">wait</span>   pts/0    00:00:00 bash</span><br><span class="line">4 R     0 17469 17398  0  77   0 - 15877 -      pts/0    00:00:00 ps</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜ä¸­çš„ç¨‹åº"><a href="#å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜ä¸­çš„ç¨‹åº" class="headerlink" title="å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜ä¸­çš„ç¨‹åº"></a>å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜ä¸­çš„ç¨‹åº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0  10368   676 ?        Ss   Nov02   0:00 init [3]</span><br><span class="line">root         2  0.0  0.0      0     0 ?        S&lt;   Nov02   0:01 [migration/0]</span><br><span class="line">root         3  0.0  0.0      0     0 ?        SN   Nov02   0:00 [ksoftirqd/0]</span><br><span class="line">root         4  0.0  0.0      0     0 ?        S&lt;   Nov02   0:01 [migration/1]</span><br><span class="line">root         5  0.0  0.0      0     0 ?        SN   Nov02   0:00 [ksoftirqd/1]</span><br><span class="line">root         6  0.0  0.0      0     0 ?        S&lt;   Nov02  29:57 [events/0]</span><br><span class="line">root         7  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [events/1]</span><br><span class="line">root         8  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [khelper]</span><br><span class="line">root        49  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kthread]</span><br><span class="line">root        54  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kblockd/0]</span><br><span class="line">root        55  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kblockd/1]</span><br><span class="line">root        56  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kacpid]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åˆ†è¾¨CLIã€Terminalã€Consoleå’ŒShell</title>
      <link href="/2015/09/25/%E7%A7%91%E6%99%AE/%E7%A7%91%E6%99%AE%E4%B9%8B%E5%88%86%E8%BE%A8CLI%E3%80%81Terminal%E3%80%81Console%E5%92%8CShell/"/>
      <url>/2015/09/25/%E7%A7%91%E6%99%AE/%E7%A7%91%E6%99%AE%E4%B9%8B%E5%88%86%E8%BE%A8CLI%E3%80%81Terminal%E3%80%81Console%E5%92%8CShell/</url>
      
        <content type="html"><![CDATA[<p>CLI å‘½ä»¤è¡Œç•Œé¢ã€Terminal ç»ˆç«¯ ã€Console æ§åˆ¶å°å’Œ Shellï¼Œæ˜¯å‡ ä¸ªæ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚</p><p>è™½ç„¶ç»å¸¸åœ¨å·¥ä½œä¸­é‡åˆ°è¿™äº›æ¦‚å¿µï¼Œä½†å¸¸å¸¸å¤„äºåŠçŸ¥åŠè§£çš„çŠ¶æ€ï¼Œä¸‹æ–‡é€šè¿‡èŠèŠè®¡ç®—æœºå‘å±•å²çš„æ–¹å¼åˆæ­¥æ¢è®¨ä¸€ä¸‹è¿™äº›æœ¯è¯­ã€‚</p><hr><h2 id="ä¸€å¥è¯æ¦‚æ‹¬"><a href="#ä¸€å¥è¯æ¦‚æ‹¬" class="headerlink" title="ä¸€å¥è¯æ¦‚æ‹¬"></a>ä¸€å¥è¯æ¦‚æ‹¬</h2><ul><li><strong>å‘½ä»¤è¡Œç•Œé¢</strong> (CLI) = ä½¿ç”¨æ–‡æœ¬å‘½ä»¤è¿›è¡Œäº¤äº’çš„ç”¨æˆ·ç•Œé¢</li><li><strong>ç»ˆç«¯</strong> (Terminal) = <strong>TTY</strong> = æ–‡æœ¬è¾“å…¥/è¾“å‡ºç¯å¢ƒ</li><li><strong>æ§åˆ¶å°</strong> (Console) = ä¸€ç§ç‰¹æ®Šçš„ç»ˆç«¯</li><li><p><strong>Shell</strong> = å‘½ä»¤è¡Œè§£é‡Šå™¨ï¼Œæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å¹¶è¿”å›ç»“æœ</p><a id="more"></a></li></ul><h2 id="å‘½ä»¤è¡Œç•Œé¢-CLI"><a href="#å‘½ä»¤è¡Œç•Œé¢-CLI" class="headerlink" title="å‘½ä»¤è¡Œç•Œé¢(CLI)"></a>å‘½ä»¤è¡Œç•Œé¢(CLI)</h2><blockquote><p>å‘½ä»¤è¡Œç•Œé¢ï¼ˆè‹±è¯­ï¼šCommand-line Interfaceï¼Œç¼©å†™ï¼šCLIï¼‰æ˜¯åœ¨å›¾å½¢ç”¨æˆ·ç•Œé¢å¾—åˆ°æ™®åŠä¹‹å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ç”¨æˆ·ç•Œé¢ï¼Œå®ƒé€šå¸¸ä¸æ”¯æŒé¼ æ ‡ï¼Œç”¨æˆ·é€šè¿‡é”®ç›˜è¾“å…¥æŒ‡ä»¤ï¼Œè®¡ç®—æœºæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œäºˆä»¥æ‰§è¡Œã€‚</p></blockquote><p>å‘½ä»¤è¡Œç•Œé¢ç›¸å¯¹äºæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„å›¾å½¢ç”¨æˆ·ç•Œé¢(GUI)è€Œè¨€ï¼Œæ˜¯ä¸€ç§æ“ä½œæ•ˆç‡æé«˜çš„æ“ä½œç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶æ–¹å¼ã€‚</p><p>â–² <em>å‘½ä»¤è¡Œç•Œé¢</em></p><p>â–²<em>å›¾å½¢ç•Œé¢</em></p><p>å°½ç®¡å›¾å½¢ç•Œé¢äººæœºäº¤äº’æ›´åŠ å‹å¥½å’Œç°ä»£åŒ–ï¼Œä½†ç›¸å¯¹äºç›´è§‚çš„å‘½ä»¤è¡Œç•Œé¢æ¥è¯´ï¼Œå…¶æ“ä½œæ•ˆç‡è¿œè¿œä¸å¦‚ï¼Œæ‰€ä»¥ç°ä»£æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æä¾›äº†å‘½ä»¤è¡Œçš„æ“ä½œæ–¹å¼ã€‚ä¾‹å¦‚ macOS çš„ Terminalï¼ŒWindows çš„ Powershellã€‚</p><h2 id="ç»ˆç«¯-Terminal"><a href="#ç»ˆç«¯-Terminal" class="headerlink" title="ç»ˆç«¯(Terminal)"></a>ç»ˆç«¯(Terminal)</h2><p>ç»ˆç«¯æ˜¯ä¸€ç§ç”¨äºä¸è®¡ç®—æœºè¿›è¡Œäº¤äº’çš„è¾“å…¥è¾“å‡ºè®¾å¤‡ï¼Œå…¶ç‰¹å¾å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢è¾“å…¥å‘½ä»¤ï¼Œå‘½ä»¤ä¼ é€’ç»™è®¡ç®—æœºï¼Œè®¡ç®—æœºæŠŠå¤„ç†ç»“æœåé¦ˆåˆ°ç»ˆç«¯çš„æ˜¾ç¤ºç•Œé¢ä¸Šã€‚ç»ˆç«¯æœ¬èº«ä¸å‚ä¸è®¡ç®—å’Œå¤„ç†ä»»åŠ¡ã€‚</p><h3 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h3><p>åœ¨å¤§å‹æœºå’Œå°å‹æœºæ—¶ä»£ï¼Œè®¡ç®—æœºä½“å‹ç›¸å½“å·¨å¤§ï¼Œå¾€å¾€æ˜¯å®‰æ”¾åœ¨å•ç‹¬çš„è®¡ç®—æœºå®¤ï¼Œæ“ä½œç”¨æˆ·åˆ™åˆ©ç”¨å¦å¤–çš„ç»ˆç«¯è®¾å¤‡ä¸ä¹‹äº¤äº’ã€‚è€Œç°åœ¨å¸¸è§çš„é”®ç›˜å’Œæ˜¾ç¤ºå™¨åœ¨å½“æ—¶ç›¸å½“æ˜‚è´µã€‚</p><p>Unix çš„åˆ›å§‹äºº Ken Thompson å’Œ Dennis Ritchie æƒ³è®© Unix æˆä¸ºä¸€ä¸ªå¤šç”¨æˆ·ç³»ç»Ÿã€‚å¤šç”¨æˆ·ç³»ç»Ÿå°±æ„å‘³ç€è¦ç»™æ¯ä¸ªç”¨æˆ·é…ç½®ä¸€ä¸ªç»ˆç«¯ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½è¦æœ‰ä¸€ä¸ªæ˜¾ç¤ºå™¨ã€ä¸€ä¸ªé”®ç›˜ã€‚ä½†å½“æ—¶æ‰€æœ‰çš„è®¡ç®—æœºè®¾å¤‡éƒ½éå¸¸æ˜‚è´µï¼ˆåŒ…æ‹¬æ˜¾ç¤ºå™¨ï¼‰ï¼Œè€Œä¸”é”®ç›˜å’Œä¸»æœºæ˜¯é›†æˆåœ¨ä¸€èµ·çš„ï¼Œæ ¹æœ¬æ²¡æœ‰ç‹¬ç«‹çš„é”®ç›˜ã€‚</p><p>å½“æ—¶æœ‰ä¸€ç§ç”µä¼ æ‰“å­—æœºï¼Œå…¶åŸæœ¬ç”¨é€”æ˜¯åœ¨ç”µæŠ¥çº¿è·¯ä¸Šé¦–å‘ç”µæŠ¥ï¼Œå®ƒæœ‰å¯ä»¥ä½œä¸ºè¾“å…¥è®¾å¤‡çš„é”®ç›˜ï¼Œä¹Ÿæœ‰ä½œä¸ºè¾“å‡ºè®¾å¤‡çš„çº¸è¢‹æ‰“å°æœºï¼Œä»·æ ¼ä¹Ÿæ¯”è¾ƒä½å»‰ã€‚äºæ˜¯å®Œç¾æ»¡è¶³äº†è¿™ä¸€éœ€æ±‚ã€‚</p><p>â–²<em>ç”µä¼ æ‰“å­—æœº</em></p><p>äºæ˜¯ä»–ä»¬æœºæ™ºåœ°æŠŠç”µä¼ æ‰“å­—æœºè¿æ¥åˆ°è®¡ç®—æœºä¸Šï¼Œæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥åœ¨ç»ˆç«¯ç™»å½•å¹¶æ“ä½œä¸»æœºã€‚çœ‹èµ·æ¥æ˜¯ä¸æ˜¯ååˆ† geekï¼Ÿ</p><h3 id="æ§åˆ¶å°"><a href="#æ§åˆ¶å°" class="headerlink" title="æ§åˆ¶å°"></a>æ§åˆ¶å°</h3><p>æ§åˆ¶å°æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç»ˆç«¯ï¼Œæ™®é€šçš„ç»ˆç«¯éƒ½æ˜¯ä»¥å¤–è®¾çš„å½¢å¼è¿æ¥åˆ°è®¡ç®—æœºï¼Œè€Œæ§åˆ¶å°æ˜¯è®¡ç®—æœºè‡ªå¸¦çš„çš„æ§åˆ¶é¢æ¿ã€‚</p><p>â–²<em>å·¦è¾¹æ˜¯æ§åˆ¶å° å³è¾¹æ˜¯ç»ˆç«¯</em></p><p>æ§åˆ¶å°ä¸€èˆ¬æ˜¯ç³»ç»Ÿç®¡ç†å‘˜æ“ä½œï¼Œæœ‰æ›´é«˜çš„æ§åˆ¶æƒé™ã€‚</p><p>ä½†éšç€ä¸ªäººè®¡ç®—æœºçš„æ™®åŠï¼Œæ§åˆ¶å°å’Œç»ˆç«¯çš„æ¦‚å¿µå·²ç»é€æ¸æ¨¡ç³Šï¼Œæˆ‘ä»¬å¾€å¾€å…·æœ‰å¯¹è®¡ç®—æœºçš„å…¨éƒ¨æ§åˆ¶æƒé™ã€‚ç›®å‰çš„è¾“å…¥ï¼ˆé”®ç›˜ç­‰ï¼‰è¾“å‡ºè®¾å¤‡ï¼ˆæ˜¾ç¤ºå™¨ç­‰ï¼‰æ—¢å¯ä»¥å……å½“æ§åˆ¶å°å¯ä»¥ä½œä¸ºç»ˆç«¯ä½¿ç”¨ã€‚å› æ­¤ï¼Œç°åœ¨ Console ä¸ Terminal åŸºæœ¬è¢«çœ‹ä½œæ˜¯åŒä¹‰è¯ã€‚</p><h3 id="ç»ˆç«¯æ¨¡æ‹Ÿå™¨"><a href="#ç»ˆç«¯æ¨¡æ‹Ÿå™¨" class="headerlink" title="ç»ˆç«¯æ¨¡æ‹Ÿå™¨"></a>ç»ˆç«¯æ¨¡æ‹Ÿå™¨</h3><p>å¦‚ä»Šï¼Œå›¾å½¢æ“ä½œç•Œé¢å·²ç»æˆä¸ºäº†ä¸»æµã€‚æœ‰è®¸å¤šä¼˜ç§€çš„å‘½ä»¤è¡Œç¨‹åºä¸å…¼å®¹å¦‚ä»Šçš„å›¾å½¢åŒ–æ“ä½œç•Œé¢ï¼Œä¸ºäº†åœ¨å›¾å½¢ç•Œé¢ä¸‹ä¸ä¹‹äº¤äº’ï¼Œäººä»¬å‘æ˜äº†ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ¥æ¨¡æ‹Ÿç»ˆç«¯ã€‚</p><p>å¯¹äºå‘½ä»¤è¡Œç¨‹åºï¼Œç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¸ä¼ ç»Ÿçš„ç»ˆç«¯å®ä½“æœºæ— å¼‚ï¼Œè€Œå¯¹äºæˆ‘ä»¬çš„å›¾å½¢æ“ä½œç•Œé¢ï¼Œå®ƒåˆç›¸å½“äºä¸€ä¸ª GUI ç¨‹åºã€‚</p><p>å…¶å·¥ä½œæµå¦‚ä¸‹</p><p>å®é™…ä¸Šèµ·åˆ°ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºå’Œ GUI çš„ä¸­ä»‹ä½œç”¨ã€‚</p><p>ç»ˆç«¯æ¨¡æ‹Ÿå™¨æœ‰å¾ˆå¤š</p><ul><li>GNU/Linuxï¼šgnome-terminalã€Konsoleï¼›</li><li>macOSï¼šTerminalã€iTerm2ï¼›</li><li>Windowsï¼šcmd.exeã€ConEmu ç­‰ã€‚</li></ul><p><img src= "/img/loading2.gif" data-lazy-src="/Users/maywzh/Desktop/Screen Shot 2018-09-25 at 7.16.13 PM.png" alt="Screen Shot 2018-09-25 at 7.16.13 PM"></p><p>â–²<em>macOS ä¸‹çš„ Terminal å°±æ˜¯ä¸€ç§ç»ˆç«¯æ¨¡æ‹Ÿå™¨</em></p><h3 id="tty-æ˜¯å•¥"><a href="#tty-æ˜¯å•¥" class="headerlink" title="tty æ˜¯å•¥"></a>tty æ˜¯å•¥</h3><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°ç³»ç»Ÿè¿›ç¨‹ä¸­æœ‰ä¸€äº›åå­—å« tty*çš„è¿›ç¨‹ï¼Œå¯¹åº”äºæˆ‘ä»¬çš„ç»ˆç«¯ç¨‹åºã€‚</p><p>è¿™äº› tty æ˜¯ä»€ä¹ˆå‘¢ï¼Œå®é™…ä¸Šï¼Œtty å°±æ˜¯ç”µä¼ æ‰“å­—æœº (Teletype / Teletypewriter) çš„è‹±æ–‡ç¼©å†™ï¼Œå®ƒè¡¨ç¤ºç»ˆç«¯çš„ç»Ÿç§°ã€‚</p><p>åœ¨ç±» UNIX ç³»ç»Ÿä¸­ï¼Œç¡¬ä»¶è®¾å¤‡éƒ½è¢«æŠ½è±¡ä¸ºæ–‡ä»¶ï¼Œè€Œå½“æ—¶çš„ä½œä¸ºç»ˆç«¯æœºçš„ç”µä¼ æ‰“å­—æœºå°±å¯¹åº”äºæ“ä½œç³»ç»Ÿçš„/dev/tty*çš„è®¾å¤‡æ–‡ä»¶ã€‚éšç€è®¡ç®—æœºçš„å‘å±•ï¼Œç»ˆç«¯è®¾å¤‡å·²ç»æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯ tty è¿™ä¸ªåå­—è¿˜æ˜¯ä¿ç•™äº†ä¸‹æ¥ã€‚</p><blockquote><p>å®é™…ä¸Š UNIX ç³»ç»Ÿæœ‰è®¸å¤šæˆ‘ä»¬å½“ä»Šçœ‹èµ·æ¥ååˆ†å¥‡æ€ªçš„è®¾è®¡ï¼Œéƒ½æ˜¯æ—©æœŸè®¡ç®—æœºå‘å±•ç›¸å¯¹ä¸å®Œå–„çš„å†å²é—ç•™é—®é¢˜ã€‚ä¾‹å¦‚/bin å’Œ/usr/bin è¿™ä¸¤ä¸ªç›®å½•ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»æŸ¥ä¸€æŸ¥ã€‚</p></blockquote><h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><p>å¤„äºç¨³å®šæ€§å’Œå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œæˆ‘ä»¬å¾€å¾€ä¸å»ºè®®ç”¨æˆ·ç›´æ¥å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œæ“ä½œï¼Œè€Œæ˜¯é€šè¿‡åº”ç”¨ç¨‹åºè°ƒç”¨æ“ä½œç³»ç»Ÿçš„ API è¿›è¡Œæ“ä½œã€‚ä½†ç”Ÿäº§ç”Ÿæ´»ä¸­è¿˜æ˜¯éœ€è¦ç›´æ¥æ“ä½œæ“ä½œç³»ç»Ÿçš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªä¸“é—¨çš„ç¨‹åºï¼Œæ¥å—ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œç„¶åå¸®æˆ‘ä»¬ä¸å†…æ ¸æ²Ÿé€šï¼Œæœ€åè®©å†…æ ¸å®Œæˆæˆ‘ä»¬çš„ä»»åŠ¡ã€‚å®ƒå°±æ˜¯ Shellã€‚å®ƒä¸æ“ä½œç³»ç»Ÿçš„æ„æ¶å¦‚ä¸‹å›¾ã€‚</p><p>Shell åˆ†ä¸ºå‘½ä»¤è¡Œ Shell å’Œå›¾å½¢ Shellï¼Œå‰è€…æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢(CLI)ï¼Œåè€…åˆ™æä¾›ä¸€ä¸ªå›¾å½¢ç•Œé¢(GUI)ã€‚</p><p>åƒ macOS çš„ Finder å®é™…ä¸Šå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå›¾å½¢ Shellã€‚è€Œ Terminal å°±æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œ Shellã€‚</p><p>å¸¸è§æˆ–å†å²ä¸ŠçŸ¥åçš„å‘½ä»¤è¡Œ Shell æœ‰ï¼š</p><ul><li>é€‚ç”¨äº Unix åŠç±» Unix ç³»ç»Ÿï¼š<ul><li><strong>sh</strong> (Bourne shell)ï¼Œæœ€ç»å…¸çš„ Unix shellï¼›</li><li><strong>bash</strong> (Bourne-Again shell)ï¼Œç›®å‰ç»å¤§å¤šæ•° Linux å‘è¡Œç‰ˆçš„é»˜è®¤ shellï¼›</li><li><strong>zsh</strong> (Z shell)ï¼Œæˆ‘ä¸ªäººæœ€å–œæ¬¢çš„ shellï¼›</li><li><strong>fish</strong> (Friendly interactive shell)ï¼Œä¸“æ³¨äºæ˜“ç”¨æ€§ä¸å‹å¥½ç”¨æˆ·ä½“éªŒçš„ shellï¼›</li></ul></li><li>Windows ä¸‹çš„ <strong>cmd.exe</strong> (å‘½ä»¤æç¤ºç¬¦) ä¸ <strong>PowerShell</strong>ã€‚</li></ul><h3 id="Shell-ä¸ç»ˆç«¯"><a href="#Shell-ä¸ç»ˆç«¯" class="headerlink" title="Shell ä¸ç»ˆç«¯"></a>Shell ä¸ç»ˆç«¯</h3><p>ä»å‰æ–‡æˆ‘ä»¬å¾—çŸ¥ï¼Œç»ˆç«¯çš„ä½œç”¨åœ¨äºæ¥å—ç”¨æˆ·è¾“å…¥æŒ‡ä»¤å¹¶æ˜¾ç¤ºè¾“å‡ºç»“æœã€‚è€Œ Shell æä¾›äº†ä¸æ“ä½œç³»ç»Ÿå†…æ ¸çš„äº¤äº’æ¥å£ã€‚å¯ä»¥æŠŠç»ˆç«¯ç†è§£ä¸º Shell çš„å‰ç«¯ï¼Œ</p><ul><li><p>ç»ˆç«¯æŠŠç”¨æˆ·è¾“å…¥ä¼ é€’ç»™ Shellï¼ŒæŠŠ Shell è¿”å›çš„ç»“æœæ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p></li><li><p>Shell ä»ç»ˆç«¯é‚£é‡Œæ‹¿åˆ°ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œè§£æåäº¤ç»™æ“ä½œç³»ç»Ÿå†…æ ¸å»æ‰§è¡Œï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœè¿”å›ç»™ç»ˆç«¯ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç§‘å­¦ä¸­æœ€é‡è¦çš„32ä¸ªç®—æ³•</title>
      <link href="/2015/09/16/%E7%A7%91%E6%99%AE/%E7%A7%91%E6%99%AE%E4%B9%8B%E5%B8%B8%E8%A7%8132%E4%B8%AA%E7%AE%97%E6%B3%95/"/>
      <url>/2015/09/16/%E7%A7%91%E6%99%AE/%E7%A7%91%E6%99%AE%E4%B9%8B%E5%B8%B8%E8%A7%8132%E4%B8%AA%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p> å¥¥åœ°åˆ©ç¬¦å·è®¡ç®—ç ”ç©¶æ‰€ï¼ˆResearch Institute for Symbolic Computationï¼Œç®€ç§°RISCï¼‰çš„Christoph Koutschanåšå£«åœ¨è‡ªå·±çš„é¡µé¢ä¸Šå‘å¸ƒäº†<a href="http://www.risc.jku.at/people/ckoutsch/stuff/e_algorithms.html">ä¸€ç¯‡æ–‡ç« </a>ï¼Œæåˆ°ä»–åšäº†ä¸€ä¸ªè°ƒæŸ¥ï¼Œå‚ä¸è€…å¤§å¤šæ•°æ˜¯è®¡ç®—æœºç§‘å­¦å®¶ï¼Œä»–è¯·è¿™äº›ç§‘å­¦å®¶æŠ•ç¥¨é€‰å‡ºæœ€é‡è¦çš„ç®—æ³•ï¼Œä»¥ä¸‹æ˜¯è¿™æ¬¡è°ƒæŸ¥çš„ç»“æœï¼ŒæŒ‰ç…§è‹±æ–‡åç§°å­—æ¯é¡ºåºæ’åºã€‚</p><a id="more"></a><ol><li><p>A<em> æœç´¢ç®—æ³•â€”â€”å›¾å½¢æœç´¢ç®—æ³•ï¼Œä»ç»™å®šèµ·ç‚¹åˆ°ç»™å®šç»ˆç‚¹è®¡ç®—å‡ºè·¯å¾„ã€‚å…¶ä¸­ä½¿ç”¨äº†ä¸€ç§å¯å‘å¼çš„ä¼°ç®—ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ä¼°ç®—é€šè¿‡è¯¥èŠ‚ç‚¹çš„æœ€ä½³è·¯å¾„ï¼Œå¹¶ä»¥ä¹‹ä¸ºå„ä¸ªåœ°ç‚¹æ’å®šæ¬¡åºã€‚ç®—æ³•ä»¥å¾—åˆ°çš„æ¬¡åºè®¿é—®è¿™äº›èŠ‚ç‚¹ã€‚å› æ­¤ï¼ŒA</em>æœç´¢ç®—æ³•æ˜¯æœ€ä½³ä¼˜å…ˆæœç´¢çš„èŒƒä¾‹ã€‚</p></li><li><p>é›†æŸæœç´¢ï¼ˆåˆåå®šå‘æœç´¢ï¼ŒBeam Searchï¼‰â€”â€”æœ€ä½³ä¼˜å…ˆæœç´¢ç®—æ³•çš„ä¼˜åŒ–ã€‚ä½¿ç”¨å¯å‘å¼å‡½æ•°è¯„ä¼°å®ƒæ£€æŸ¥çš„æ¯ä¸ªèŠ‚ç‚¹çš„èƒ½åŠ›ã€‚ä¸è¿‡ï¼Œé›†æŸæœç´¢åªèƒ½åœ¨æ¯ä¸ªæ·±åº¦ä¸­å‘ç°æœ€å‰é¢çš„mä¸ªæœ€ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œmæ˜¯å›ºå®šæ•°å­—â€”â€”é›†æŸçš„å®½åº¦ã€‚</p></li><li><p>äºŒåˆ†æŸ¥æ‰¾ï¼ˆBinary Searchï¼‰â€”â€”åœ¨çº¿æ€§æ•°ç»„ä¸­æ‰¾ç‰¹å®šå€¼çš„ç®—æ³•ï¼Œæ¯ä¸ªæ­¥éª¤å»æ‰ä¸€åŠä¸ç¬¦åˆè¦æ±‚çš„æ•°æ®ã€‚</p></li><li><p>åˆ†æ”¯ç•Œå®šç®—æ³•ï¼ˆBranch and Boundï¼‰â€”â€”åœ¨å¤šç§æœ€ä¼˜åŒ–é—®é¢˜ä¸­å¯»æ‰¾ç‰¹å®šæœ€ä¼˜åŒ–è§£å†³æ–¹æ¡ˆçš„ç®—æ³•ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ç¦»æ•£ã€ç»„åˆçš„æœ€ä¼˜åŒ–ã€‚</p></li><li><p>Buchbergerç®—æ³•â€”â€”ä¸€ç§æ•°å­¦ç®—æ³•ï¼Œå¯å°†å…¶è§†ä¸ºé’ˆå¯¹å•å˜é‡æœ€å¤§å…¬çº¦æ•°æ±‚è§£çš„æ¬§å‡ é‡Œå¾—ç®—æ³•å’Œçº¿æ€§ç³»ç»Ÿä¸­é«˜æ–¯æ¶ˆå…ƒæ³•çš„æ³›åŒ–ã€‚</p></li><li><p>æ•°æ®å‹ç¼©â€”â€”é‡‡å–ç‰¹å®šç¼–ç æ–¹æ¡ˆï¼Œä½¿ç”¨æ›´å°‘çš„å­—èŠ‚æ•°ï¼ˆæˆ–æ˜¯å…¶ä»–ä¿¡æ¯æ‰¿è½½å•å…ƒï¼‰å¯¹ä¿¡æ¯ç¼–ç çš„è¿‡ç¨‹ï¼Œåˆå«æ¥æºç¼–ç ã€‚</p></li><li><p>Diffie-Hellmanå¯†é’¥äº¤æ¢ç®—æ³•â€”â€”ä¸€ç§åŠ å¯†åè®®ï¼Œå…è®¸åŒæ–¹åœ¨äº‹å…ˆä¸äº†è§£å¯¹æ–¹çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸å®‰å…¨çš„é€šä¿¡ä¿¡é“ä¸­ï¼Œå…±åŒå»ºç«‹å…±äº«å¯†é’¥ã€‚è¯¥å¯†é’¥ä»¥åå¯ä¸ä¸€ä¸ªå¯¹ç§°å¯†ç ä¸€èµ·ï¼ŒåŠ å¯†åç»­é€šè®¯ã€‚</p></li><li><p>Dijkstraç®—æ³•â€”â€”é’ˆå¯¹æ²¡æœ‰è´Ÿå€¼æƒé‡è¾¹çš„æœ‰å‘å›¾ï¼Œè®¡ç®—å…¶ä¸­çš„å•ä¸€èµ·ç‚¹æœ€çŸ­ç®—æ³•ã€‚</p></li><li><p>ç¦»æ•£å¾®åˆ†ç®—æ³•ï¼ˆDiscrete differentiationï¼‰</p></li><li><p>åŠ¨æ€è§„åˆ’ç®—æ³•ï¼ˆDynamic Programmingï¼‰â€”â€”å±•ç¤ºäº’ç›¸è¦†ç›–çš„å­é—®é¢˜å’Œæœ€ä¼˜å­æ¶æ„ç®—æ³•</p></li><li><p>æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆEuclidean algorithmï¼‰â€”â€”è®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°ã€‚æœ€å¤è€çš„ç®—æ³•ä¹‹ä¸€ï¼Œå‡ºç°åœ¨å…¬å…ƒå‰300å‰æ¬§å‡ é‡Œå¾—çš„ã€Šå‡ ä½•åŸæœ¬ã€‹ã€‚</p></li><li><p>æœŸæœ›-æœ€å¤§ç®—æ³•ï¼ˆExpectation-maximization algorithmï¼ŒåˆåEM-Trainingï¼‰â€”â€”åœ¨ç»Ÿè®¡è®¡ç®—ä¸­ï¼ŒæœŸæœ›-æœ€å¤§ç®—æ³•åœ¨æ¦‚ç‡æ¨¡å‹ä¸­å¯»æ‰¾å¯èƒ½æ€§æœ€å¤§çš„å‚æ•°ä¼°ç®—å€¼ï¼Œå…¶ä¸­æ¨¡å‹ä¾èµ–äºæœªå‘ç°çš„æ½œåœ¨å˜é‡ã€‚EMåœ¨ä¸¤ä¸ªæ­¥éª¤ä¸­äº¤æ›¿è®¡ç®—ï¼Œç¬¬ä¸€æ­¥æ˜¯è®¡ç®—æœŸæœ›ï¼Œåˆ©ç”¨å¯¹éšè—å˜é‡çš„ç°æœ‰ä¼°è®¡å€¼ï¼Œè®¡ç®—å…¶æœ€å¤§å¯èƒ½ä¼°è®¡å€¼ï¼›ç¬¬äºŒæ­¥æ˜¯æœ€å¤§åŒ–ï¼Œæœ€å¤§åŒ–åœ¨ç¬¬ä¸€æ­¥ä¸Šæ±‚å¾—çš„æœ€å¤§å¯èƒ½å€¼æ¥è®¡ç®—å‚æ•°çš„å€¼ã€‚</p></li><li><p>å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFast Fourier transformï¼ŒFFTï¼‰â€”â€”è®¡ç®—ç¦»æ•£çš„å‚…é‡Œå¶å˜æ¢ï¼ˆDFTï¼‰åŠå…¶åè½¬ã€‚è¯¥ç®—æ³•åº”ç”¨èŒƒå›´å¾ˆå¹¿ï¼Œä»æ•°å­—ä¿¡å·å¤„ç†åˆ°è§£å†³åå¾®åˆ†æ–¹ç¨‹ï¼Œåˆ°å¿«é€Ÿè®¡ç®—å¤§æ•´æ•°ä¹˜ç§¯ã€‚</p></li><li><p><a href="http://www.infoq.com/32-most-important-algorithms/zh.wikipedia.org/wiki/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D">æ¢¯åº¦ä¸‹é™</a>ï¼ˆGradient descentï¼‰â€”â€”ä¸€ç§æ•°å­¦ä¸Šçš„æœ€ä¼˜åŒ–ç®—æ³•ã€‚</p></li><li><p>å“ˆå¸Œç®—æ³•ï¼ˆHashingï¼‰</p></li><li><p>å †æ’åºï¼ˆHeapsï¼‰</p></li><li><p>Karatsubaä¹˜æ³•â€”â€”éœ€è¦å®Œæˆä¸Šåƒä½æ•´æ•°çš„ä¹˜æ³•çš„ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚è®¡ç®—æœºä»£æ•°ç³»ç»Ÿå’Œå¤§æ•°ç¨‹åºåº“ï¼Œå¦‚æœä½¿ç”¨é•¿ä¹˜æ³•ï¼Œé€Ÿåº¦å¤ªæ…¢ã€‚è¯¥ç®—æ³•å‘ç°äº1962å¹´ã€‚</p></li><li><p>LLLç®—æ³•ï¼ˆLenstra-Lenstra-Lovasz  lattice reductionï¼‰â€”â€”ä»¥æ ¼è§„çº¦ï¼ˆlatticeï¼‰åŸºæ•°ä¸ºè¾“å…¥ï¼Œè¾“å‡ºçŸ­æ­£äº¤å‘é‡åŸºæ•°ã€‚LLLç®—æ³•åœ¨ä»¥ä¸‹å…¬å…±å¯†é’¥åŠ å¯†æ–¹æ³•ä¸­æœ‰å¤§é‡ä½¿ç”¨ï¼šèƒŒåŒ…åŠ å¯†ç³»ç»Ÿï¼ˆknapsackï¼‰ã€æœ‰ç‰¹å®šè®¾ç½®çš„RSAåŠ å¯†ç­‰ç­‰ã€‚</p></li><li><p>æœ€å¤§æµé‡ç®—æ³•ï¼ˆMaximum flowï¼‰â€”â€”è¯¥ç®—æ³•è¯•å›¾ä»ä¸€ä¸ªæµé‡ç½‘ç»œä¸­æ‰¾åˆ°æœ€å¤§çš„æµã€‚å®ƒä¼˜åŠ¿è¢«å®šä¹‰ä¸ºæ‰¾åˆ°è¿™æ ·ä¸€ä¸ªæµçš„å€¼ã€‚æœ€å¤§æµé—®é¢˜å¯ä»¥çœ‹ä½œæ›´å¤æ‚çš„ç½‘ç»œæµé—®é¢˜çš„ç‰¹å®šæƒ…å†µã€‚æœ€å¤§æµä¸ç½‘ç»œä¸­çš„ç•Œé¢æœ‰å…³ï¼Œè¿™å°±æ˜¯æœ€å¤§æµ-æœ€å°æˆªå®šç†ï¼ˆMax-flow min-cut theoremï¼‰ã€‚Ford-Fulkerson èƒ½æ‰¾åˆ°ä¸€ä¸ªæµç½‘ç»œä¸­çš„æœ€å¤§æµã€‚</p></li><li><p>åˆå¹¶æ’åºï¼ˆMerge Sortï¼‰</p></li><li><p>ç‰›é¡¿æ³•ï¼ˆNewtonâ€™s methodï¼‰â€”â€”æ±‚éçº¿æ€§æ–¹ç¨‹ï¼ˆç»„ï¼‰é›¶ç‚¹çš„ä¸€ç§é‡è¦çš„è¿­ä»£æ³•ã€‚</p></li><li><p>Q-learningå­¦ä¹ ç®—æ³•â€”â€”è¿™æ˜¯ä¸€ç§é€šè¿‡å­¦ä¹ åŠ¨ä½œå€¼å‡½æ•°ï¼ˆaction-value functionï¼‰å®Œæˆçš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œå‡½æ•°é‡‡å–åœ¨ç»™å®šçŠ¶æ€çš„ç»™å®šåŠ¨ä½œï¼Œå¹¶è®¡ç®—å‡ºæœŸæœ›çš„æ•ˆç”¨ä»·å€¼ï¼Œåœ¨æ­¤åéµå¾ªå›ºå®šçš„ç­–ç•¥ã€‚Q-leanringçš„ä¼˜åŠ¿æ˜¯ï¼Œåœ¨ä¸éœ€è¦ç¯å¢ƒæ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¹æ¯”å¯é‡‡çº³è¡ŒåŠ¨çš„æœŸæœ›æ•ˆç”¨ã€‚</p></li><li><p>ä¸¤æ¬¡ç­›æ³•ï¼ˆQuadratic Sieveï¼‰â€”â€”ç°ä»£æ•´æ•°å› å­åˆ†è§£ç®—æ³•ï¼Œåœ¨å®è·µä¸­ï¼Œæ˜¯ç›®å‰å·²çŸ¥ç¬¬äºŒå¿«çš„æ­¤ç±»ç®—æ³•ï¼ˆä»…æ¬¡äºæ•°åŸŸç­›æ³•Number Field Sieveï¼‰ã€‚å¯¹äº110ä½ä»¥ä¸‹çš„åä½æ•´æ•°ï¼Œå®ƒä»æ˜¯æœ€å¿«çš„ï¼Œè€Œä¸”éƒ½è®¤ä¸ºå®ƒæ¯”æ•°åŸŸç­›æ³•æ›´ç®€å•ã€‚</p></li><li><p>RANSACâ€”â€”æ˜¯â€œRANdom SAmple Consensusâ€çš„ç¼©å†™ã€‚è¯¥ç®—æ³•æ ¹æ®ä¸€ç³»åˆ—è§‚å¯Ÿå¾—åˆ°çš„æ•°æ®ï¼Œæ•°æ®ä¸­åŒ…å«å¼‚å¸¸å€¼ï¼Œä¼°ç®—ä¸€ä¸ªæ•°å­¦æ¨¡å‹çš„å‚æ•°å€¼ã€‚å…¶åŸºæœ¬å‡è®¾æ˜¯ï¼šæ•°æ®åŒ…å«éå¼‚åŒ–å€¼ï¼Œä¹Ÿå°±æ˜¯èƒ½å¤Ÿé€šè¿‡æŸäº›æ¨¡å‹å‚æ•°è§£é‡Šçš„å€¼ï¼Œå¼‚åŒ–å€¼å°±æ˜¯é‚£äº›ä¸ç¬¦åˆæ¨¡å‹çš„æ•°æ®ç‚¹ã€‚</p></li><li><p>RSAâ€”â€”å…¬é’¥åŠ å¯†ç®—æ³•ã€‚é¦–ä¸ªé€‚ç”¨äºä»¥ç­¾åä½œä¸ºåŠ å¯†çš„ç®—æ³•ã€‚RSAåœ¨ç”µå•†è¡Œä¸šä¸­ä»å¤§è§„æ¨¡ä½¿ç”¨ï¼Œå¤§å®¶ä¹Ÿç›¸ä¿¡å®ƒæœ‰è¶³å¤Ÿå®‰å…¨é•¿åº¦çš„å…¬é’¥ã€‚</p></li><li><p>SchÃ¶nhage-Strassenç®—æ³•â€”â€”åœ¨æ•°å­¦ä¸­ï¼ŒSchÃ¶nhage-Strassenç®—æ³•æ˜¯ç”¨æ¥å®Œæˆå¤§æ•´æ•°çš„ä¹˜æ³•çš„å¿«é€Ÿæ¸è¿‘ç®—æ³•ã€‚å…¶ç®—æ³•å¤æ‚åº¦ä¸ºï¼šO(N log(N) log(log(N)))ï¼Œè¯¥ç®—æ³•ä½¿ç”¨äº†å‚…é‡Œå¶å˜æ¢ã€‚</p></li><li><p>å•çº¯å‹ç®—æ³•ï¼ˆSimplex Algorithmï¼‰â€”â€”åœ¨æ•°å­¦çš„ä¼˜åŒ–ç†è®ºä¸­ï¼Œå•çº¯å‹ç®—æ³•æ˜¯å¸¸ç”¨çš„æŠ€æœ¯ï¼Œç”¨æ¥æ‰¾åˆ°çº¿æ€§è§„åˆ’é—®é¢˜çš„æ•°å€¼è§£ã€‚çº¿æ€§è§„åˆ’é—®é¢˜åŒ…æ‹¬åœ¨ä¸€ç»„å®å˜é‡ä¸Šçš„ä¸€ç³»åˆ—çº¿æ€§ä¸ç­‰å¼ç»„ï¼Œä»¥åŠä¸€ä¸ªç­‰å¾…æœ€å¤§åŒ–ï¼ˆæˆ–æœ€å°åŒ–ï¼‰çš„å›ºå®šçº¿æ€§å‡½æ•°ã€‚</p></li><li><p>å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSingular value decompositionï¼Œç®€ç§°SVDï¼‰â€”â€”åœ¨çº¿æ€§ä»£æ•°ä¸­ï¼ŒSVDæ˜¯é‡è¦çš„å®æ•°æˆ–å¤æ•°çŸ©é˜µçš„åˆ†è§£æ–¹æ³•ï¼Œåœ¨ä¿¡å·å¤„ç†å’Œç»Ÿè®¡ä¸­æœ‰å¤šç§åº”ç”¨ï¼Œæ¯”å¦‚è®¡ç®—çŸ©é˜µçš„ä¼ªé€†çŸ©é˜µï¼ˆä»¥æ±‚è§£æœ€å°äºŒä¹˜æ³•é—®é¢˜ï¼‰ã€è§£å†³è¶…å®šçº¿æ€§ç³»ç»Ÿï¼ˆoverdetermined linear systemsï¼‰ã€çŸ©é˜µé€¼è¿‘ã€æ•°å€¼å¤©æ°”é¢„æŠ¥ç­‰ç­‰ã€‚</p></li><li><p>æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼ˆSolving a system of linear equationsï¼‰â€”â€”çº¿æ€§æ–¹ç¨‹ç»„æ˜¯æ•°å­¦ä¸­æœ€å¤è€çš„é—®é¢˜ï¼Œå®ƒä»¬æœ‰å¾ˆå¤šåº”ç”¨ï¼Œæ¯”å¦‚åœ¨æ•°å­—ä¿¡å·å¤„ç†ã€çº¿æ€§è§„åˆ’ä¸­çš„ä¼°ç®—å’Œé¢„æµ‹ã€æ•°å€¼åˆ†æä¸­çš„éçº¿æ€§é—®é¢˜é€¼è¿‘ç­‰ç­‰ã€‚æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼Œå¯ä»¥ä½¿ç”¨é«˜æ–¯â€”çº¦å½“æ¶ˆå»æ³•ï¼ˆGauss-Jordan eliminationï¼‰ï¼Œæˆ–æ˜¯æŸ¯åˆ—æ–¯åŸºåˆ†è§£ï¼ˆ Cholesky decompositionï¼‰ã€‚</p></li><li><p>Strukturtensorç®—æ³•â€”â€”åº”ç”¨äºæ¨¡å¼è¯†åˆ«é¢†åŸŸï¼Œä¸ºæ‰€æœ‰åƒç´ æ‰¾å‡ºä¸€ç§è®¡ç®—æ–¹æ³•ï¼Œçœ‹çœ‹è¯¥åƒç´ æ˜¯å¦å¤„äºåŒè´¨åŒºåŸŸï¼ˆ homogenous regionï¼‰ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦å±äºè¾¹ç¼˜ï¼Œè¿˜æ˜¯æ˜¯ä¸€ä¸ªé¡¶ç‚¹ã€‚</p></li><li><p>åˆå¹¶æŸ¥æ‰¾ç®—æ³•ï¼ˆUnion-findï¼‰â€”â€”ç»™å®šä¸€ç»„å…ƒç´ ï¼Œè¯¥ç®—æ³•å¸¸å¸¸ç”¨æ¥æŠŠè¿™äº›å…ƒç´ åˆ†ä¸ºå¤šä¸ªåˆ†ç¦»çš„ã€å½¼æ­¤ä¸é‡åˆçš„ç»„ã€‚ä¸ç›¸äº¤é›†ï¼ˆdisjoint-setï¼‰çš„æ•°æ®ç»“æ„å¯ä»¥è·Ÿè¸ªè¿™æ ·çš„åˆ‡åˆ†æ–¹æ³•ã€‚åˆå¹¶æŸ¥æ‰¾ç®—æ³•å¯ä»¥åœ¨æ­¤ç§æ•°æ®ç»“æ„ä¸Šå®Œæˆä¸¤ä¸ªæœ‰ç”¨çš„æ“ä½œï¼š</p><ul><li><ul><li>æŸ¥æ‰¾ï¼šåˆ¤æ–­æŸç‰¹å®šå…ƒç´ å±äºå“ªä¸ªç»„ã€‚</li><li>åˆå¹¶ï¼šè”åˆæˆ–åˆå¹¶ä¸¤ä¸ªç»„ä¸ºä¸€ä¸ªç»„ã€‚</li></ul></li></ul></li><li><p>ç»´ç‰¹æ¯”ç®—æ³•ï¼ˆViterbi algorithmï¼‰â€”â€”å¯»æ‰¾éšè—çŠ¶æ€æœ€æœ‰å¯èƒ½åºåˆ—çš„åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œè¿™ç§åºåˆ—è¢«ç§°ä¸ºç»´ç‰¹æ¯”è·¯å¾„ï¼Œå…¶ç»“æœæ˜¯ä¸€ç³»åˆ—å¯ä»¥è§‚å¯Ÿåˆ°çš„äº‹ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨éšè—çš„Markovæ¨¡å‹ä¸­ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPåœ°å€åˆ†ç±»</title>
      <link href="/2015/09/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB/"/>
      <url>/2015/09/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­æœ‰è‘—åçš„OSIä¸ƒå±‚åè®®ä½“ç³»ç»“æ„ï¼Œæ¦‚å¿µæ¸…æ¥šï¼Œç†è®ºå®Œæ•´ï¼Œä½†æ˜¯å®ƒæ—¢å¤æ‚åˆä¸å®ç”¨ã€‚TCP/IPä½“ç³»ç»“æ„åˆ™ä¸åŒï¼Œå¾—åˆ°çš„å¹¿æ³›çš„åº”ç”¨ã€‚æœ€ç»ˆç»“åˆOSIå’ŒTCP/IPçš„ä¼˜ç‚¹ï¼Œé‡‡ç”¨äº†ä¸€ç§åªæœ‰äº”å±‚åè®®çš„ä½“ç³»ç»“æ„ï¼Œæœ¬æ–‡çš„è®²è¿°çš„IPéƒ½æ˜¯åŸºäºäº”å±‚åè®®æ¨¡å‹ä¸­çš„<strong><em>ç½‘ç»œå±‚\</em></strong>ã€‚</p><a id="more"></a><h2 id="ç½‘ç»œæ¨¡å‹ä»‹ç»"><a href="#ç½‘ç»œæ¨¡å‹ä»‹ç»" class="headerlink" title="ç½‘ç»œæ¨¡å‹ä»‹ç»"></a>ç½‘ç»œæ¨¡å‹ä»‹ç»</h2><div class="table-container"><table><thead><tr><th>OSIä½“ç³»ç»“æ„</th><th>TCP/IPä½“ç³»ç»“æ„</th><th>äº”å±‚ä½“ç³»ç»“æ„</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td>7 åº”ç”¨å±‚</td><td>åº”ç”¨å±‚</td><td>5 åº”ç”¨å±‚</td></tr><tr><td>6 è¡¨ç¤ºå±‚</td><td></td><td></td></tr><tr><td>5 ä¼šè¯å±‚</td><td></td><td></td></tr><tr><td>4 ä¼ è¾“å±‚</td><td>ä¼ è¾“å±‚</td><td>4 ä¼ è¾“å±‚</td></tr><tr><td>3 ç½‘ç»œå±‚</td><td>ç½‘ç»œå±‚</td><td>3 ç½‘ç»œå±‚</td></tr><tr><td>2 æ•°æ®é“¾è·¯å±‚</td><td>ç½‘ç»œæ¥å£å±‚</td><td>2 æ•°æ®é“¾è·¯å±‚</td></tr><tr><td>1 ç‰©ç†å±‚</td><td>1 ç‰©ç†å±‚</td></tr></tbody></table></div><h2 id="åˆ†ç±»çš„IPåœ°å€"><a href="#åˆ†ç±»çš„IPåœ°å€" class="headerlink" title="åˆ†ç±»çš„IPåœ°å€"></a>åˆ†ç±»çš„IPåœ°å€</h2><h3 id="IPåœ°å€çš„è¡¨ç¤ºæ–¹æ³•"><a href="#IPåœ°å€çš„è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="IPåœ°å€çš„è¡¨ç¤ºæ–¹æ³•"></a>IPåœ°å€çš„è¡¨ç¤ºæ–¹æ³•</h3><p>IPåœ°å€å°±æ˜¯ç»™è‹±ç‰¹ç½‘ä¸Šçš„æ¯ä¸ªä¸»æœºï¼ˆè·¯ç”±å™¨ï¼‰çš„æ¯ä¸ªæ¥å£åˆ†é…ä¸€ä¸ªåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…æ˜¯å”¯ä¸€çš„32ä½çš„æ ‡è¯†ç¬¦ã€‚å…¶ç»„æˆç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç½‘ç»œå·ï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯ä¸»æœºå·ã€‚ä¸€ä¸ªä¸»æœºå·åœ¨å‰é¢çš„ç½‘ç»œå·æ‰€æŒ‡æ˜çš„ç½‘ç»œèŒƒå›´å†…å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªIPåœ°å€åœ¨æ•´ä¸ªç½‘ç»œä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚ç›®å‰åˆ†ä¸ºAã€Bã€Cã€Dã€E äº”ç±»IPåœ°å€ã€‚<br><img src= "/img/loading2.gif" data-lazy-src="https://img-blog.csdn.net/20170604163951489?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXpjc3U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="IP"></p><ul><li>åœ¨Aã€Bã€C ä¸‰ç±»åœ°å€ä¸­ç°è‰²çš„éƒ¨åˆ†å³ä¸ºç½‘ç»œå·ï¼Œç½‘ç»œå·çš„å‰ä¸‰ä½æ˜¯ç±»åˆ«ä½ï¼Œåˆ†åˆ«æ˜¯0,10ï¼Œ110ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å‡­å€Ÿè¿™ä¸ªç±»åˆ«ä½ç½®æ¥åˆ¤æ–­ç½‘ç»œç±»åˆ«ã€‚</li><li>32ä½çš„æ€»é•¿åº¦ï¼Œç”±äºAã€Bã€C ä¸‰ç±»ç½‘ç»œå·çš„é•¿åº¦çš„ä¸åŒï¼Œå¯¼è‡´Aã€Bã€C ç±»åœ°å€çš„ä¸»æœºå·å­—æ®µçš„å­—èŠ‚æ•°åˆ†åˆ«ä¸º3ã€2ã€1ï¼ˆä¸€ä¸ªå­—èŠ‚8ä½ï¼‰ã€‚</li><li>D ç±»åœ°å€çš„ç½‘ç»œå·ä¸º1110ï¼Œç”¨äºå¤šæ’­ï¼ˆä¸€å¯¹å¤šé€šè®¯ï¼‰ã€‚E ç±»åœ°å€çš„ç½‘ç»œå·ä¸º1111ï¼Œä¿ç•™ä»¥åä½¿ç”¨ã€‚</li></ul><p>å› æ­¤æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„å°±æ˜¯ABCä¸‰ç±»ç½‘ç»œåœ°å€ï¼ŒIPåœ°å€æ˜¯32ä½çš„äºŒè¿›åˆ¶ä»£ç ï¼Œä¸ºäº†æé«˜å¯è¯»æ€§ï¼ŒæŠŠ32ä½çš„IPåœ°å€ä¸­çš„æ¯8ä½ç”¨ç­‰æ•ˆçš„åè¿›åˆ¶è¡¨ç¤ºå‡ºæ¥ï¼ˆç‚¹åˆ†åè¿›åˆ¶ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­å¸¸è§çš„IPåœ°å€å°±å‡ºç°äº†ã€‚</p><p>ä¾‹å¦‚ï¼šIPåœ°å€ï¼Œ128.11.3.31ï¼Œè½¬åŒ–ä¸ºäºŒè¿›åˆ¶ä¸º 100000000 00001011 00000011 00011111 ï¼Œå¯ä»¥çœ‹å‡ºç±»åˆ«ä½ä¸º 10ï¼Œå¯ä»¥åˆ¤æ–­ä¸ºä¸€ä¸ªBç±»åœ°å€ã€‚</p><h3 id="å¸¸ç”¨IPåœ°å€çš„æŒ‡æ´¾èŒƒå›´"><a href="#å¸¸ç”¨IPåœ°å€çš„æŒ‡æ´¾èŒƒå›´" class="headerlink" title="å¸¸ç”¨IPåœ°å€çš„æŒ‡æ´¾èŒƒå›´"></a>å¸¸ç”¨IPåœ°å€çš„æŒ‡æ´¾èŒƒå›´</h3><h4 id="ç½‘ç»œå·æŒ‡æ´¾èŒƒå›´"><a href="#ç½‘ç»œå·æŒ‡æ´¾èŒƒå›´" class="headerlink" title="ç½‘ç»œå·æŒ‡æ´¾èŒƒå›´"></a>ç½‘ç»œå·æŒ‡æ´¾èŒƒå›´</h4><ul><li>Aç±»åœ°å€ç½‘ç»œå·å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯ç”±äºæœ‰ä¸€ä½æ˜¯ç±»åˆ«ä½ï¼Œåªæœ‰7ä½å¯ä¾›ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºè§„å®šï¼Œç½‘ç»œå­—æ®µå…¨0æ˜¯ä¸ªä¿ç•™å­—æ®µè¡¨ç¤ºæœ¬ç½‘ç»œï¼Œè€Œ127ï¼ˆ01111111ï¼‰æ˜¯å¦å¤–ä¸€ä¸ªä¿ç•™å­—æ®µï¼Œä½œä¸ºæœ¬åœ°è½¯ä»¶çš„ç¯å›æµ‹è¯•ã€‚<strong>æˆ‘ä»¬å¸¸è§çš„127.0.0.1è¡¨ç¤ºæœ¬æœºï¼ŒåŸå› ä¹Ÿæ˜¯å‡ºè‡ªè¿™é‡Œã€‚</strong>æ‰€ä»¥Aç±»åœ°å€å¯ä»¥æŒ‡æ´¾çš„ç½‘ç»œå·ä¸ªæ•°ä¸ºï¼ˆ27-2ï¼‰.</li><li>Bç±»ç½‘ç»œåœ°å€ç½‘ç»œå·æœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œå‰ä¸¤ä½ä¸º10å·²ç»å›ºå®šï¼Œåªå‰©ä¸‹14ä½å¯ç”¨ï¼Œç”±äºè¿™14ä½æ— è®ºæ€ä¹ˆå–å€¼éƒ½ä¸ä¼šä½¿å¾—ç½‘ç»œå·ä¸ºå…¨0æˆ–è€…å…¨1ï¼Œå•å®é™…ä¸Šè§„å®šï¼Œè§„å®šBç±»æœ€å°ç½‘ç»œåœ°å€ä¸º128.1.0.0ã€‚å› æ­¤Bç±»åœ°å€å¯æŒ‡æ´¾çš„ç½‘ç»œå·ä¸ªæ•°ä¸ºï¼ˆ214-1ï¼‰.</li><li>Cç±»åœ°å€æœ‰3ä¸ªå­—èŠ‚çš„ç½‘ç»œå­—æ®µå·ï¼Œå‰ä¸‰ä½å›ºå®š110ï¼Œåªæœ‰å‰©ä¸‹21ä½å¯ç”¨ï¼ŒåŒæ ·Cç±»åœ°å€å¯æŒ‡æ´¾çš„æœ€å°ç½‘ç»œåœ°å€ä¹Ÿæ˜¯192.0.1.0ã€‚å› æ­¤Cç±»åœ°å€å¯æŒ‡æ´¾çš„ç½‘ç»œå·ä¸ªæ•°ä¸ºï¼ˆ221-1ï¼‰.</li></ul><h4 id="ä¸»æœºå·æŒ‡æ´¾èŒƒå›´"><a href="#ä¸»æœºå·æŒ‡æ´¾èŒƒå›´" class="headerlink" title="ä¸»æœºå·æŒ‡æ´¾èŒƒå›´"></a>ä¸»æœºå·æŒ‡æ´¾èŒƒå›´</h4><ul><li>ç”±äºä¸»æœºå·æœ‰è§„å®šï¼Œå…¨0çš„ä¸»æœºå·ä»£è¡¨IPåœ°å€æ˜¯â€œæœ¬ä¸»æœºâ€æ‰€è¿æ¥åˆ°çš„å•ä¸ªç½‘ç»œåœ°å€ï¼ˆä¾‹ï¼Œä¸€ä¸»æœºåœ°å€ä¸º5.6.7.8ï¼Œåˆ™è¯¥ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œåœ°å€ä¸º5.0.0.0ï¼‰ï¼Œè€Œå…¨1åˆ™è¡¨ç¤ºâ€œæ‰€æœ‰çš„â€ï¼Œå³è¡¨ç¤ºè¯¥ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºã€‚</li><li>Aç±»åœ°å€çš„ä¸»æœºå·æ˜¯ç”±ä¸‰ä¸ªå­—èŠ‚ï¼Œ24ä½ç»„æˆï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªAç±»ç½‘ç»œä¸­å¯åˆ†é…çš„ä¸»æœºä¸ªæ•°ä¸ºï¼ˆ224-2ï¼‰.</li><li>Bç±»åœ°å€çš„ä¸»æœºå·æ˜¯ç”±ä¸¤ä¸ªå­—èŠ‚ï¼Œ16ä½ç»„æˆï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªBç±»ç½‘ç»œä¸­å¯åˆ†é…çš„ä¸»æœºä¸ªæ•°ä¸ºï¼ˆ216-2ï¼‰.</li><li>Cç±»åœ°å€çš„ä¸»æœºå·æ˜¯ç”±ä¸€ä¸ªå­—èŠ‚ï¼Œ8ä½ç»„æˆï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªCç±»ç½‘ç»œä¸­å¯åˆ†é…çš„ä¸»æœºä¸ªæ•°ä¸ºï¼ˆ28-2ï¼‰.</li></ul><h4 id="æ€»ç»“IPæŒ‡æ´¾èŒƒå›´"><a href="#æ€»ç»“IPæŒ‡æ´¾èŒƒå›´" class="headerlink" title="æ€»ç»“IPæŒ‡æ´¾èŒƒå›´"></a>æ€»ç»“IPæŒ‡æ´¾èŒƒå›´</h4><p>ç»¼ä¸Šç½‘ç»œå·å’Œä¸»æœºå·çš„æŒ‡æ´¾æè¿°å¯çŸ¥ï¼ŒIPåœ°å€ç©ºé—´å…±æœ‰232ä¸ªåœ°å€ã€‚<br>æ‰€æœ‰Aç±»åœ°å€å…±æœ‰ï¼ˆ27-2ï¼‰âˆ—âˆ—ï¼ˆ224-2ï¼‰ä¸ªï¼Œå¤§çº¦231ï¼Œå 50%ï¼›<br>æ‰€æœ‰Bç±»åœ°å€å…±æœ‰ï¼ˆ214-1ï¼‰âˆ—âˆ—ï¼ˆ216-2ï¼‰ä¸ªï¼Œå¤§çº¦230,å 25%ï¼›<br>æ‰€æœ‰Cç±»åœ°å€å…±æœ‰ï¼ˆ221-1ï¼‰âˆ—âˆ—ï¼ˆ28-2ï¼‰ä¸ªï¼Œå¤§çº¦229,å 12.5%ï¼›</p><div class="table-container"><table><thead><tr><th>ç½‘ç»œç±»åˆ«</th><th>æœ€å¤§å¯åˆ†é…ç½‘ç»œæ•°</th><th>é¦–ä¸ªå¯åˆ†é…ç½‘ç»œå·</th><th>æœ€åä¸€ä¸ªå¯åˆ†é…ç½‘ç»œå·</th><th>æ¯ä¸ªç½‘ç»œä¸­æœ€å¤§ä¸»æœºæ•°</th></tr></thead><tbody><tr><td>A</td><td>126ï¼ˆ27-2ï¼‰</td><td>1</td><td>126</td><td>16777214</td></tr><tr><td>B</td><td>16383ï¼ˆ214-1ï¼‰</td><td>128.1</td><td>191.255</td><td>65534</td></tr><tr><td>C</td><td>2097151ï¼ˆ221-1ï¼‰</td><td>192.0.1</td><td>223.255.255</td><td>254</td></tr></tbody></table></div><ul><li>æ‰€ä»¥å¯ä»¥è¿™æ ·æ¥è¡¨ç¤ºä¸€ä¸ªAç±»IPåœ°å€ n.x.y.zn.x.y.zï¼Œè‹¥1â‰¤nâ‰¤1261â‰¤nâ‰¤126ï¼Œ0â‰¤x,y,zâ‰¤2550â‰¤x,y,zâ‰¤255ï¼Œå…¶ä¸­ x,y,zx,y,zä¸åŒæ—¶ä¸º0ä¹Ÿä¸èƒ½åŒæ—¶ä¸º255.</li><li>æ‰€ä»¥å¯ä»¥è¿™æ ·æ¥è¡¨ç¤ºä¸€ä¸ªBç±»IPåœ°å€ n.m.x.yn.m.x.yï¼Œè‹¥128â‰¤nâ‰¤191128â‰¤nâ‰¤191ï¼Œ0â‰¤mâ‰¤2550â‰¤mâ‰¤255ï¼Œ0â‰¤x,yâ‰¤2550â‰¤x,yâ‰¤255ï¼Œå…¶ä¸­ I. å½“n=128n=128æ—¶ï¼Œmâ‰ 0mâ‰ 0; II. x,yx,yä¸åŒæ—¶ä¸º0ä¹Ÿä¸èƒ½åŒæ—¶ä¸º255;</li><li>æ‰€ä»¥å¯ä»¥è¿™æ ·æ¥è¡¨ç¤ºä¸€ä¸ªCç±»IPåœ°å€ n.m.k.xn.m.k.xï¼Œè‹¥192â‰¤nâ‰¤223192â‰¤nâ‰¤223ï¼Œ0â‰¤m,kâ‰¤2550â‰¤m,kâ‰¤255ï¼Œ1â‰¤xâ‰¤2541â‰¤xâ‰¤254ï¼Œå…¶ä¸­ å½“n=192n=192æ—¶ï¼Œkâ‰ 0kâ‰ 0.</li></ul><h2 id="IPåœ°å€å’Œç¡¬ä»¶åœ°å€"><a href="#IPåœ°å€å’Œç¡¬ä»¶åœ°å€" class="headerlink" title="IPåœ°å€å’Œç¡¬ä»¶åœ°å€"></a>IPåœ°å€å’Œç¡¬ä»¶åœ°å€</h2><p>ä»å±‚æ¬¡è§’åº¦æ¥çœ‹ï¼Œç¡¬ä»¶åœ°å€æ˜¯æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ä½¿ç”¨çš„åœ°å€ï¼ˆå¸¸ç§°ä½œMACåœ°å€ï¼‰ï¼Œè€ŒIPåœ°å€æ˜¯ç½‘ç»œå±‚å’Œä»¥ä¸Šå„å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯ä¸€ç§é€»è¾‘åœ°å€ã€‚åœ¨ç½‘ç»œå±‚æˆ‘ä»¬è¿›è¡Œæ•°æ®æŠ¥æ–‡ä»IP1ä¼ è¾“åˆ°IP2ï¼Œæ— è®ºæˆ‘ä»¬ä¸­é—´ç»è¿‡å¤šå°‘æ¬¡è½¬å‘ï¼Œä»ç½‘ç»œå±‚æ¥çœ‹ï¼Œæºåœ°å€å§‹ç»ˆæ˜¯IP1ï¼Œç›®çš„åœ°å€å§‹ç»ˆæ˜¯IP2ã€‚ä½†æ˜¯ä»æ•°æ®é“¾è·¯å±‚æ¥çœ‹ï¼Œæ˜¾ç„¶å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œè¿™äº›æ˜¯ç‰©ç†åœ°å€ï¼Œå¾ˆæœ‰å¯èƒ½ä»æºèŠ‚ç‚¹ç»è¿‡å¤šæ¬¡ä¸­é—´èŠ‚ç‚¹çš„ç‰©ç†åœ°å€çš„è½¬å˜æ‰èƒ½åˆ°è¾¾ç›®çš„èŠ‚ç‚¹ã€‚</p><blockquote><p>è€ŒIPåœ°å€å’Œç‰©ç†åœ°å€çš„ä¹‹é—´çš„è½¬åŒ–åˆ™éœ€è¦ä¾é ä¸¤ä¸ªé‡è¦çš„åè®®ARPï¼ˆåœ°å€è§£æåè®®ï¼‰ï¼ŒRARPï¼ˆé€†åœ°å€è§£æåè®®ï¼‰ã€‚IPåœ°å€é€šè¿‡ARPè½¬åŒ–æˆç‰©ç†åœ°å€ï¼Œç‰©ç†åœ°å€å¯ä»¥é€šè¿‡RARPè½¬åŒ–æˆç›¸åº”çš„IPåœ°å€ã€‚</p></blockquote><h2 id="å­ç½‘å’Œè¶…ç½‘"><a href="#å­ç½‘å’Œè¶…ç½‘" class="headerlink" title="å­ç½‘å’Œè¶…ç½‘"></a>å­ç½‘å’Œè¶…ç½‘</h2><p>ç®€å•çš„æ¥è¯´å°±æ˜¯å¦‚ä½•æ¥ç®¡ç†ä¸€ä¸ªIPåœ°å€ä¸‹çš„å¤šå°ä¸»æœº</p><h3 id="å­ç½‘"><a href="#å­ç½‘" class="headerlink" title="å­ç½‘"></a>å­ç½‘</h3><p>ç°åœ¨å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œä¸€ä¸ªæ•°æ®æŠ¥èµ·ç›®çš„åœ°å€æ˜¯145.13.3.10ï¼ˆåœ¨å­ç½‘ 145.13.3.0ä¸­ï¼‰ï¼Œå·²ç»åˆ°è¾¾è·¯ç”±å™¨R1ï¼ˆ145.13.0.0ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯ç”±å™¨æ€ä¹ˆå°†å®ƒè½¬å‘åˆ°145.13.3.0å‘¢ï¼Ÿ<br>æˆ‘ä»¬å¹¶ä¸çŸ¥é“ç›®çš„åœ°å€æ˜¯å¦è¿›è¡Œäº†å­ç½‘çš„åˆ’åˆ†ã€‚<br>è¿™å°±å¼•å‡ºäº†å­ç½‘æ©ç çš„æ¦‚å¿µäº†ï¼Œå­ç½‘æ©ç ä¹Ÿæ˜¯32ä½ï¼Œç”±ä¸€ä¸²1å’Œ0ç»„æˆï¼Œå­ç½‘æ©ç ä¸­çš„1å¯¹åº”äºIPåœ°å€ä¸­çš„ç½‘ç»œå·ä½ç½®+å­ç½‘ç½‘ç»œå·ä½ç½®ï¼Œå­ç½‘æ©ç ä¸­çš„0å¯¹åº”ä¸IPåœ°å€ä¸­ç°åœ¨çš„ä¸»æœºå·ä½ç½®ã€‚<br>æˆ‘ä»¬åªè¦å°†IPåœ°å€å’Œå­ç½‘æ©ç è¿›è¡Œâ€œä¸â€è¿ç®—ï¼Œå¦‚æœè¿›è¡Œå­ç½‘çš„åˆ’åˆ†ï¼Œå°±ç«‹åˆ»å¾—å‡ºè¦æ‰¾çš„å­ç½‘çš„ç½‘ç»œåœ°å€ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œå­ç½‘åˆ’åˆ†ï¼ˆæœ‰é»˜è®¤çš„å­ç½‘æ©ç ï¼‰ï¼Œåˆ™ç›´æ¥èƒ½å¤Ÿå¾—å‡ºè¯¥IPåœ°å€çš„ç½‘ç»œåœ°å€å‡ºæ¥ã€‚</p><ul><li>Aç±»åœ°å€çš„é»˜è®¤å­ç½‘æ©ç æ˜¯255.0.0.0</li><li>Bç±»åœ°å€çš„é»˜è®¤å­ç½‘æ©ç æ˜¯255.255.0.0</li><li>Cç±»åœ°å€çš„é»˜è®¤å­ç½‘æ©ç æ˜¯255.255.255.0</li></ul><h3 id="è¶…ç½‘"><a href="#è¶…ç½‘" class="headerlink" title="è¶…ç½‘"></a>è¶…ç½‘</h3><p>æ— åˆ†ç±»ç¼–å€CIDRï¼Œä½¿ç”¨å˜é•¿çš„å­ç½‘æ©ç ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜IPåœ°å€çš„èµ„æºåˆ©ç”¨ç‡ã€‚æœ‰ä¸¤ä¸ªç‰¹ç‚¹<br>ç¬¬ä¸€ï¼Œæ¶ˆé™¤äº†ä¼ ç»Ÿçš„ABCç±»åœ°å€åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼ŒCIRDæŠŠ32ä½çš„IPåœ°å€åˆ’åˆ†æˆä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç½‘ç»œå‰ç¼€å’Œå‰©ä¸‹çš„éƒ¨åˆ†ï¼Œè¡¨ç¤ºæ–¹æ³•ä¸ºï¼Œåœ¨IPåœ°å€åé¢åŠ ä¸Šâ€œ/â€ï¼Œç„¶åå†™ä¸Šç½‘ç»œå‰ç¼€æ‰€å ä½æ•°ã€‚<br>ç¬¬äºŒï¼ŒæŠŠç½‘ç»œå‰ç¼€ç›¸åŒçš„IPåœ°å€ç»„æˆä¸€ä¸ªCIDRåœ°å€å—ï¼Œä¾‹å¦‚ï¼ŒIPåœ°å€ 128.14.35.7/20 ç”¨äºŒè¿›åˆ¶è¡¨ç¤º 100000000 00001110 00100011 00000111ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥å¾—å‡ºè¿™å—åœ°å€ä¸­æœ€å°åœ°å€ä¸º128.14.32.0,å³ 100000000 00001110 00100000 00000000ï¼Œæœ€å¤§åœ°å€ä¸º128.14.47.255ï¼Œå³ 100000000 00001110 00101111 11111111.</p><p>ä¸ºäº†æ›´åŠ æ–¹ä¾¿è¿›è¡Œè·¯ç”±é€‰æ‹©ï¼ŒCIDRä½¿ç”¨32ä½çš„åœ°å€æ©ç ï¼Œ1çš„ä¸ªæ•°å°±æ˜¯ç½‘ç»œå‰ç¼€çš„é•¿åº¦ï¼Œå¦‚ä¸Šé¢æ‰€ä¸¾ä¾‹ä¸­çš„/20çš„åœ°å€å—çš„åœ°å€æ©ç æ˜¯ 11111111 11111111 11110000 00000000</p><p>å› æ­¤å¯ä»¥çœ‹å‡ºï¼Œç½‘ç»œå‰ç¼€è¶ŠçŸ­ï¼Œå…¶åœ°å€å—æ‰€åŒ…å«çš„åœ°å€å°±è¶Šå¤šï¼Œè¿™æ ·å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ›´åŠ æœ‰æ•ˆçš„åˆ†é…IPv4çš„åœ°å€ç©ºé—´ã€‚è€Œç”±å¾ˆå¤šä¸ªCIDRåœ°å€å¿«æ„æˆçš„åºå¤§çš„ç½‘ç»œå°±å°±è¢«ç§°ä¸ºâ€œè¶…ç½‘â€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gitç¬”è®°ä¹‹ignore</title>
      <link href="/2015/08/29/git/git%E7%AC%94%E8%AE%B0%E4%B9%8Bignore/"/>
      <url>/2015/08/29/git/git%E7%AC%94%E8%AE%B0%E4%B9%8Bignore/</url>
      
        <content type="html"><![CDATA[<p>åœ¨pushåˆ°è¿œç¨‹ä»“åº“ä¸­ï¼Œå¾€å¾€è¦å¿½ç•¥ä¸­é—´æ–‡ä»¶å’Œå¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶ç­‰æ–‡ä»¶çš„æäº¤ï¼Œè¿™æ—¶å°±è¦è®¾ç½®ç›¸åº”çš„å¿½ç•¥è§„åˆ™ï¼Œæ¥è‡ªåŠ¨å¿½ç•¥è¿™äº›æ–‡ä»¶ã€‚</p><h2 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h2><p><strong>Gitå¿½ç•¥æ–‡ä»¶çš„åŸåˆ™</strong></p><ul><li>å¿½ç•¥æ“ä½œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¾‹å¦‚macOSä¸­çš„<code>.DS_Store</code></li><li>å¿½ç•¥ç¼–è¯‘ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶ç­‰ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯é€šè¿‡å¦ä¸€ä¸ªæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦æ”¾è¿›ç‰ˆæœ¬åº“ï¼Œæ¯”å¦‚Javaç¼–è¯‘äº§ç”Ÿçš„<code>.class</code>æ–‡ä»¶</li><li>å¿½ç•¥å¸¦æœ‰æ•æ„Ÿä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚å­˜æ”¾å£ä»¤çš„é…ç½®æ–‡ä»¶</li></ul><h2 id="æ–¹å¼"><a href="#æ–¹å¼" class="headerlink" title="æ–¹å¼"></a>æ–¹å¼</h2><p><strong>æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å®ç°å¿½ç•¥Gitä¸­ä¸æƒ³æäº¤çš„æ–‡ä»¶</strong>ï¼š</p><ol><li>åœ¨é¡¹ç›®ä¸­å®šä¹‰.gitignoreæ–‡ä»¶<br>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®šä¹‰.gitignore æ–‡ä»¶ï¼Œå®ƒå¾€å¾€è¦æäº¤åˆ°å…¬æœ‰ä»“åº“ä¸­ï¼Œä¸ºè¯¥é¡¹ç›®ä¸‹çš„æ‰€æœ‰å¼€å‘è€…éƒ½é¢„è®¾å®šä¹‰å¥½çš„å¿½ç•¥è§„åˆ™ã€‚.gitingore æ–‡ä»¶æ¯ä¸€è¡ŒæŒ‡å®šä¸€ä¸ªå¿½ç•¥è§„åˆ™ã€‚å¦‚ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*.log</span><br><span class="line">*.temp</span><br><span class="line">&#x2F;vendor</span><br></pre></td></tr></table></figure><ol><li><p>åœ¨é¡¹ç›®çš„è®¾ç½®ä¸­ä¸´æ—¶æŒ‡å®šæ’é™¤æ–‡ä»¶<br>è¿™ç§æ–¹å¼åªæ˜¯ä¸´æ—¶æŒ‡å®šè¯¥é¡¹ç›®çš„è¡Œä¸ºï¼Œéœ€è¦ç¼–è¾‘å½“å‰é¡¹ç›®ä¸‹çš„ <code>.git/info/exclude</code>æ–‡ä»¶ï¼Œç„¶åå°†éœ€è¦å¿½ç•¥æäº¤çš„æ–‡ä»¶å†™å…¥å…¶ä¸­ã€‚è¿™ç§æ–¹å¼æŒ‡å®šçš„å¿½ç•¥æ–‡ä»¶çš„æ ¹ç›®å½•æ˜¯é¡¹ç›®æ ¹ç›®å½•ã€‚</p></li><li><p>å®šä¹‰å…¨å±€çš„ .gitignore æ–‡ä»¶<br>é™¤äº†å¯ä»¥åœ¨é¡¹ç›®ä¸­å®šä¹‰ <code>.gitignore</code> æ–‡ä»¶å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¨å±€çš„git <code>.gitignore</code>æ–‡ä»¶æ¥ç®¡ç†æ‰€æœ‰ç”±gitç‰ˆæœ¬æ§åˆ¶é¡¹ç›®çš„è¡Œä¸ºã€‚è¿™ç§æ–¹å¼æ˜¯å®šä¹‰ä¸ªäººå¼€å‘æœºçš„å…¨å±€ç¯å¢ƒï¼Œä¸åœ¨é¡¹ç›®æˆå‘˜ä¸­å…±äº«ã€‚è¿™ç§æ–¹å¼ä¹Ÿéœ€è¦åˆ›å»ºç›¸åº”çš„ .gitignore æ–‡ä»¶ï¼Œå¯ä»¥æ”¾åœ¨ä»»æ„ä½ç½®ã€‚ç„¶ååœ¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®ï¼š</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.excludesfile ~/.gitignore</span><br></pre></td></tr></table></figure><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="åŒ¹é…è¯­æ³•"><a href="#åŒ¹é…è¯­æ³•" class="headerlink" title="åŒ¹é…è¯­æ³•"></a>åŒ¹é…è¯­æ³•</h3><ol><li>ç©ºæ ¼ä¸åŒ¹é…ä»»æ„æ–‡ä»¶ï¼Œå¯ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¯ç”¨åæ–œæ è½¬ä¹‰</li><li><code>#</code>å¼€å¤´çš„è¡Œä»£è¡¨æ³¨é‡Šï¼Œgitå¿½ç•¥ï¼Œå¯ä»¥ä½¿ç”¨åæ–œæ è¿›è¡Œè½¬ä¹‰</li><li><code>.gitignore</code>ä½¿ç”¨æ ‡å‡†çš„globæ¨¡å¼åŒ¹é…ã€‚<a href="https://en.wikipedia.org/wiki/Glob_(programming">globæ¨¡å¼</a>)å¾€å¾€ç”¨äºåœ¨ç±»UNIXç³»ç»Ÿä¸­åŒ¹é…æ–‡ä»¶è·¯å¾„ã€‚</li><li>æ–œæ <code>/</code>å¼€å¤´è¡¨ç¤ºç›®å½•ï¼Œ<code>/</code>ç»“æŸçš„æ¨¡å¼åªåŒ¹é…æ–‡ä»¶å¤¹å’Œè¯¥æ–‡ä»¶å¤¹è·¯å¾„ä¸‹çš„å†…å®¹ï¼Œ<code>/</code>å¼€å§‹çš„æ¨¡å¼åŒ¹é…é¡¹ç›®æ ¹ç›®å½•</li><li>æ˜Ÿå·<code>*</code>é€šé…å¤šä¸ªå­—ç¬¦ï¼Œé—®å·<code>?</code>é€šé…å•ä¸ªå­—ç¬¦ï¼Œ ä½¿ç”¨ä¸¤ä¸ªæ˜Ÿå·<code>**</code>è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸­é—´ç›®å½•</li><li>æ–¹æ‹¬å·<code>[]</code>åŒ…å«å•ä¸ªå­—ç¬¦çš„åŒ¹é…åˆ—è¡¨ï¼Œå³åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦ã€‚</li><li>æ„Ÿå¹å·<code>!</code>è¡¨ç¤ºä¸å¿½ç•¥(è·Ÿè¸ª)åŒ¹é…åˆ°çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸ŠæƒŠå¹å·<code>ï¼ˆ!ï¼‰</code>å–åã€‚<strong>å¦‚æœæ–‡ä»¶çš„çˆ¶ç›®å½•å·²ç»è¢«å‰é¢çš„è§„åˆ™æ’é™¤æ‰äº†ï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªæ–‡ä»¶ç”¨â€!â€è§„åˆ™æ˜¯ä¸èµ·ä½œç”¨çš„</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´â€!â€å¼€å¤´çš„æ¨¡å¼è¡¨ç¤ºå¦å®šï¼Œè¯¥æ–‡ä»¶å°†ä¼šå†æ¬¡è¢«åŒ…å«ï¼Œå¦‚æœæ’é™¤äº†è¯¥æ–‡ä»¶çš„çˆ¶çº§ç›®å½•ï¼Œåˆ™ä½¿ç”¨â€!â€ä¹Ÿä¸ä¼šå†æ¬¡è¢«åŒ…å«ã€‚å¯ä»¥ä½¿ç”¨åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚</li><li>.gitå¯¹äº.ignoreé…ç½®æ–‡ä»¶æ˜¯æŒ‰è¡Œä»ä¸Šåˆ°ä¸‹è¿›è¡Œè§„åˆ™åŒ¹é…çš„ï¼Œæ„å‘³ç€å¦‚æœå‰é¢çš„è§„åˆ™åŒ¹é…çš„èŒƒå›´æ›´å¤§ï¼Œåˆ™åé¢çš„è§„åˆ™å°†ä¸ä¼šç”Ÿæ•ˆï¼</li></ol><h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><p>åœ¨ .gitingore æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡ŒæŒ‡å®šä¸€ä¸ªå¿½ç•¥è§„åˆ™ï¼ŒGitæ£€æŸ¥å¿½ç•¥è§„åˆ™çš„æ—¶å€™æœ‰å¤šä¸ªæ¥æºï¼Œå®ƒçš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼ˆç”±é«˜åˆ°ä½ï¼‰ï¼š</p><ol><li>ä»å‘½ä»¤è¡Œä¸­è¯»å–å¯ç”¨çš„å¿½ç•¥è§„åˆ™</li><li>å½“å‰ç›®å½•å®šä¹‰çš„è§„åˆ™</li><li>çˆ¶çº§ç›®å½•å®šä¹‰çš„è§„åˆ™ï¼Œä¾æ¬¡é€’æ¨</li><li>$GIT_DIR/info/exclude æ–‡ä»¶ä¸­å®šä¹‰çš„è§„åˆ™</li><li>core.excludesfileä¸­å®šä¹‰çš„å…¨å±€è§„åˆ™</li></ol><p>ä¾‹ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*<span class="string">.a</span>             <span class="comment">#å¿½ç•¥æ‰€æœ‰ç›®å½•ä¸­æ‰€æœ‰ .a ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">/*<span class="string">.b</span>            <span class="comment">#å¿½ç•¥æ ¹ç›®å½•ä¸­æ‰€æœ‰ .b ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">**/*<span class="string">.c</span>          <span class="comment">#å¿½ç•¥æ‰€æœ‰ç›®å½•ä¸­å­ç›®å½•ä¸­çš„ .c ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">!<span class="string">/1.b</span>           <span class="comment">#ä¸å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„1.bæ–‡ä»¶</span></span><br><span class="line">bin/            <span class="comment">#å¿½ç•¥å½“å‰è·¯å¾„ä¸‹çš„binæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸å¿½ç•¥ bin æ–‡ä»¶</span></span><br><span class="line"><span class="string">/bin</span>            <span class="comment">#è¡¨ç¤ºå¿½ç•¥æ ¹ç›®å½•ä¸‹çš„binæ–‡ä»¶</span></span><br><span class="line">a/**<span class="string">/b</span>          <span class="comment">#è¡¨ç¤ºå¿½ç•¥aç›®å½•ä¸‹æ‰€æœ‰ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„bæ–‡ä»¶ï¼Œä¾‹å¦‚a/bï¼Œ a/c/b ï¼Œ a/c/d/b</span></span><br></pre></td></tr></table></figure><p>âš ï¸<br>å¦‚æœå¦‚æœåœ¨ç‰ˆæœ¬åº“ä¸­å†™<code>.gitignore</code>æ–‡ä»¶ä¹‹å‰å°±å·²ç»æäº¤äº†è¦å¿½ç•¥çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆGitä»ç„¶ä¼šå¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚ä¾‹å¦‚å·²ç»commitäº†<code>1.a</code>è¿™ä¸ªæ–‡ä»¶åˆ°ç‰ˆæœ¬åº“ï¼Œå†å†™å…¥<code>1.a</code>è¿™æ¡å¿½ç•¥è§„åˆ™åˆ°<code>.gitignore</code>æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™æ¡è§„åˆ™å°±å¤±æ•ˆäº†ã€‚å¯¹<code>1.a</code>æ–‡ä»¶çš„ä¿®æ”¹ä»ç„¶ä¼šè¢«ç‰ˆæœ¬æ§åˆ¶ã€‚è¿™ç§æƒ…å†µçš„è§£å†³æ–¹å¼å¯ä»¥å‚çœ‹<a href="https://maywzh.com/gitç¬”è®°ä¹‹rm/">git rmåˆ é™¤ç‰ˆæœ¬æ§åˆ¶</a>ã€‚<br><a id="more"></a></p><h2 id="æŸ¥çœ‹è§„åˆ™"><a href="#æŸ¥çœ‹è§„åˆ™" class="headerlink" title="æŸ¥çœ‹è§„åˆ™"></a>æŸ¥çœ‹è§„åˆ™</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨<code>git check-ignore</code>å‘½ä»¤æ£€æŸ¥å¿½ç•¥è§„åˆ™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git check-ignore -v ./bin/root-bin.a</span><br><span class="line">.gitignore:2:/bin./bin/root-bin.a</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>./bin/root-bin.a</code>åŒ¹é…åˆ°äº†æˆ‘ä»¬çš„ç¬¬äºŒè¡Œ<code>/bin</code>çš„å¿½ç•¥è§„åˆ™ï¼Œæ‰€ä»¥æ–‡ä»¶è¢«å¿½ç•¥äº†ã€‚</p><h2 id="åˆ é™¤æœ¬åœ°ç¼“å­˜"><a href="#åˆ é™¤æœ¬åœ°ç¼“å­˜" class="headerlink" title="åˆ é™¤æœ¬åœ°ç¼“å­˜"></a>åˆ é™¤æœ¬åœ°ç¼“å­˜</h2><p>æœ‰çš„æ—¶å€™å·²ç»åœ¨.gitignoreä¸­æ ‡æ˜å¿½ç•¥çš„æ–‡ä»¶ï¼Œä½†git statusä¸­è¯¥æ–‡ä»¶ä¾æ—§å¤„äºtractedçŠ¶æ€ï¼Œè¿™æ˜¯å› ä¸ºåœ¨gitå¿½ç•¥ç›®å½•ä¸­ï¼Œæ–°å»ºçš„æ–‡ä»¶ä¼šæœ‰ç¼“å­˜ï¼Œå¦‚æœæŸæ–‡ä»¶å·²ç»è¢«çº³å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œé‚£ä¹ˆå†åœ¨.gitignoreä¸­å£°æ˜ä¹Ÿæ˜¯æ— æ•ˆçš„ï¼Œæ­¤æ—¶éœ€è¦åˆ é™¤æœ¬åœ°ç¼“å­˜ï¼Œè¿™æ ·ä¸ä¼šç›´æ¥åˆ é™¤æ–‡ä»¶ã€‚å¦‚æœå»æ‰<code>--cached</code>é€‰é¡¹åˆ™æ˜¯ç›´æ¥åˆ é™¤å¯¹åº”æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git rm -r --cached .</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">&quot;.gitignore updated&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è¿œç¨‹ä»“åº“ä¸­åˆ é™¤ç‰ˆæœ¬æ§åˆ¶"><a href="#è¿œç¨‹ä»“åº“ä¸­åˆ é™¤ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="è¿œç¨‹ä»“åº“ä¸­åˆ é™¤ç‰ˆæœ¬æ§åˆ¶"></a>è¿œç¨‹ä»“åº“ä¸­åˆ é™¤ç‰ˆæœ¬æ§åˆ¶</h2><p>æœ‰çš„æ—¶å€™æƒ³ç§»é™¤è¿œç¨‹ä»“åº“ä¸­çš„æŸäº›æ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†ä¾æ—§åœ¨æœ¬åœ°ä¿ç•™è¯¥æ–‡ä»¶ã€‚è¿™æ—¶å€™ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨<code>git rm directory</code>ï¼Œè¿™æ ·ä¼šåˆ é™¤æœ¬åœ°ä»“åº“çš„æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨<code>git rm -r â€“cached directory</code>æ¥åˆ é™¤æœ¬åœ°ç¼“å­˜ï¼Œç„¶åè¿›è¡Œcommit å’Œpushï¼Œè¿™æ ·ä¼šå‘ç°è¿œç¨‹ä»“åº“ä¸­çš„ä¸å¿…è¦æ–‡ä»¶å°±è¢«åˆ é™¤äº†ï¼Œä»¥åå¯ä»¥ç›´æ¥ä½¿ç”¨<code>git add -A</code>æ¥æ·»åŠ ä¿®æ”¹çš„å†…å®¹ï¼Œä¸Šä¼ çš„æ–‡ä»¶å°±ä¼šå—åˆ°.gitignoreæ–‡ä»¶çš„å†…å®¹çº¦æŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git rm -r --cached 1.a</span><br><span class="line">$ git add -A</span><br><span class="line">$ git commit -m <span class="string">&quot;update .gitignore&quot;</span></span><br><span class="line">$ git push origin</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ€§èƒ½åˆ†æå·¥å…· - sar</title>
      <link href="/2015/08/26/Linux/Linux%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20-%20sar/"/>
      <url>/2015/08/26/Linux/Linux%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20-%20sar/</url>
      
        <content type="html"><![CDATA[<p>saræ˜¯System Activity Reporterï¼ˆç³»ç»Ÿæ´»åŠ¨æƒ…å†µæŠ¥å‘Šï¼‰çš„ç¼©å†™ã€‚sarå·¥å…·å°†å¯¹ç³»ç»Ÿå½“å‰çš„çŠ¶æ€è¿›è¡Œå–æ ·ï¼Œç„¶åé€šè¿‡è®¡ç®—æ•°æ®å’Œæ¯”ä¾‹æ¥è¡¨è¾¾ç³»ç»Ÿçš„å½“å‰è¿è¡ŒçŠ¶æ€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å¯ä»¥è¿ç»­å¯¹ç³»ç»Ÿå–æ ·ï¼Œè·å¾—å¤§é‡çš„å–æ ·æ•°æ®ï¼›å–æ ·æ•°æ®å’Œåˆ†æçš„ç»“æœéƒ½å¯ä»¥å­˜å…¥æ–‡ä»¶ï¼Œæ‰€éœ€çš„è´Ÿè½½å¾ˆå°ã€‚saræ˜¯ç›®å‰Linuxä¸Šæœ€ä¸ºå…¨é¢çš„ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·ä¹‹ä¸€ï¼Œå¯ä»¥ä»14ä¸ªå¤§æ–¹é¢å¯¹ç³»ç»Ÿçš„æ´»åŠ¨è¿›è¡ŒæŠ¥å‘Šï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„è¯»å†™æƒ…å†µã€ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨æƒ…å†µã€ä¸²å£ã€CPUæ•ˆç‡ã€å†…å­˜ä½¿ç”¨çŠ¶å†µã€è¿›ç¨‹æ´»åŠ¨åŠIPCæœ‰å…³çš„æ´»åŠ¨ç­‰ï¼Œä½¿ç”¨ä¹Ÿæ˜¯è¾ƒä¸ºå¤æ‚ã€‚</p><p>saræ˜¯æŸ¥çœ‹æ“ä½œç³»ç»ŸæŠ¥å‘ŠæŒ‡æ ‡çš„å„ç§å·¥å…·ä¸­ï¼Œæœ€ä¸ºæ™®éå’Œæ–¹ä¾¿çš„ï¼›å®ƒæœ‰ä¸¤ç§ç”¨æ³•ï¼›</p><ol><li>è¿½æº¯è¿‡å»çš„ç»Ÿè®¡æ•°æ®ï¼ˆé»˜è®¤ï¼‰</li><li>å‘¨æœŸæ€§çš„æŸ¥çœ‹å½“å‰æ•°æ®</li></ol><a id="more"></a><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æœ‰çš„linuxç³»ç»Ÿä¸‹ï¼Œé»˜è®¤å¯èƒ½æ²¡æœ‰å®‰è£…è¿™ä¸ªåŒ…ï¼Œä½¿ç”¨<code>apt-get</code>æ¥å®‰è£…ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install sysstat</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•ï¼Œå°†æ€§èƒ½æ”¶é›†å·¥å…·çš„å¼€å…³æ‰“å¼€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/default/sysstat</span><br><span class="line">ENABLED=<span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨è¿™ä¸ªå·¥å…·æ¥æ”¶é›†ç³»ç»Ÿæ€§èƒ½æ•°æ®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /etc/init.d/sysstat start</span><br></pre></td></tr></table></figure><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><ul><li>-A æ±‡æ€»æ‰€æœ‰çš„æŠ¥å‘Š</li><li>-a æŠ¥å‘Šæ–‡ä»¶è¯»å†™ä½¿ç”¨æƒ…å†µ</li><li>-B æŠ¥å‘Šé™„åŠ çš„ç¼“å­˜çš„ä½¿ç”¨æƒ…å†µ</li><li>-b æŠ¥å‘Šç¼“å­˜çš„ä½¿ç”¨æƒ…å†µ</li><li>-c æŠ¥å‘Šç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨æƒ…å†µ</li><li>-d æŠ¥å‘Šç£ç›˜çš„ä½¿ç”¨æƒ…å†µ</li><li>-g æŠ¥å‘Šä¸²å£çš„ä½¿ç”¨æƒ…å†µ</li><li>-h æŠ¥å‘Šå…³äºbufferä½¿ç”¨çš„ç»Ÿè®¡æ•°æ®</li><li>-m æŠ¥å‘ŠIPCæ¶ˆæ¯é˜Ÿåˆ—å’Œä¿¡å·é‡çš„ä½¿ç”¨æƒ…å†µ</li><li>-n æŠ¥å‘Šå‘½åcacheçš„ä½¿ç”¨æƒ…å†µ</li><li>-p æŠ¥å‘Šè°ƒé¡µæ´»åŠ¨çš„ä½¿ç”¨æƒ…å†µ</li><li>-q æŠ¥å‘Šè¿è¡Œé˜Ÿåˆ—å’Œäº¤æ¢é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦</li><li>-R æŠ¥å‘Šè¿›ç¨‹çš„æ´»åŠ¨æƒ…å†µ</li><li>-r æŠ¥å‘Šæ²¡æœ‰ä½¿ç”¨çš„å†…å­˜é¡µé¢å’Œç¡¬ç›˜å—</li><li>-u æŠ¥å‘ŠCPUçš„åˆ©ç”¨ç‡</li><li>-v æŠ¥å‘Šè¿›ç¨‹ã€ièŠ‚ç‚¹ã€æ–‡ä»¶å’Œé”è¡¨çŠ¶æ€</li><li>-w æŠ¥å‘Šç³»ç»Ÿäº¤æ¢æ´»åŠ¨çŠ¶å†µ</li><li>-y æŠ¥å‘ŠTTYè®¾å¤‡æ´»åŠ¨çŠ¶å†µ</li></ul><h3 id="è¿½æº¯è¿‡å»çš„ç»Ÿè®¡æ•°æ®-f"><a href="#è¿½æº¯è¿‡å»çš„ç»Ÿè®¡æ•°æ®-f" class="headerlink" title="è¿½æº¯è¿‡å»çš„ç»Ÿè®¡æ•°æ® -f"></a>è¿½æº¯è¿‡å»çš„ç»Ÿè®¡æ•°æ® -f</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsarä»æœ€è¿‘çš„0ç‚¹0åˆ†å¼€å§‹æ˜¾ç¤ºæ•°æ®ï¼›å¦‚æœæƒ³ç»§ç»­æŸ¥çœ‹ä¸€å¤©å‰çš„æŠ¥å‘Šï¼›å¯ä»¥æŸ¥çœ‹ä¿å­˜åœ¨/var/log/sysstat/ä¸‹çš„saæ—¥å¿—ï¼› ä½¿ç”¨sarå·¥å…·æŸ¥çœ‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sar</span> -f /var/<span class="built_in">log</span>/sysstat/sa28 \| head sar -r -f</span><br><span class="line">/var/<span class="built_in">log</span>/sysstat/sa28</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹CPUä½¿ç”¨ç‡-u"><a href="#æŸ¥çœ‹CPUä½¿ç”¨ç‡-u" class="headerlink" title="æŸ¥çœ‹CPUä½¿ç”¨ç‡ -u"></a>æŸ¥çœ‹CPUä½¿ç”¨ç‡ -u</h3><p><code>sar -u</code> : æ˜¾ç¤ºçš„cpuä½¿ç”¨ç‡ç­‰ä¿¡æ¯</p><p>å¯ä»¥çœ‹åˆ°è¿™å°æœºå™¨ä½¿ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæœ‰ç›¸åº”çš„æ—¶é—´æ¶ˆè€—ï¼› å„åˆ—çš„æŒ‡æ ‡åˆ†åˆ«æ˜¯:</p><ul><li><p><code>%user</code> ç”¨æˆ·æ¨¡å¼ä¸‹æ¶ˆè€—çš„CPUæ—¶é—´çš„æ¯”ä¾‹ï¼›</p></li><li><p><code>%nice</code> é€šè¿‡niceæ”¹å˜äº†è¿›ç¨‹è°ƒåº¦ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ¶ˆè€—çš„CPUæ—¶é—´çš„æ¯”ä¾‹</p></li><li><p><code>%system</code> ç³»ç»Ÿæ¨¡å¼ä¸‹æ¶ˆè€—çš„CPUæ—¶é—´çš„æ¯”ä¾‹ï¼›</p></li><li><p><code>%iowait</code> CPUç­‰å¾…ç£ç›˜I/Oå¯¼è‡´ç©ºé—²çŠ¶æ€æ¶ˆè€—çš„æ—¶é—´æ¯”ä¾‹ï¼›</p></li><li><p><code>%steal</code> åˆ©ç”¨Xenç­‰æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç­‰å¾…å…¶å®ƒè™šæ‹ŸCPUè®¡ç®—å ç”¨çš„æ—¶é—´æ¯”ä¾‹ï¼›</p></li><li><p><code>%idle</code> CPUç©ºé—²æ—¶é—´æ¯”ä¾‹ï¼›</p></li></ul><h3 id="æŸ¥çœ‹å¹³å‡è´Ÿè½½-q"><a href="#æŸ¥çœ‹å¹³å‡è´Ÿè½½-q" class="headerlink" title="æŸ¥çœ‹å¹³å‡è´Ÿè½½ -q"></a>æŸ¥çœ‹å¹³å‡è´Ÿè½½ -q</h3><p><code>sar -q</code>: æŸ¥çœ‹å¹³å‡è´Ÿè½½</p><p>æŒ‡å®š-qåï¼Œå°±èƒ½æŸ¥çœ‹è¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ã€ç³»ç»Ÿä¸Šçš„è¿›ç¨‹å¤§å°ã€å¹³å‡è´Ÿè½½ç­‰ï¼›ä¸å…¶å®ƒå‘½ä»¤ç›¸æ¯”ï¼Œå®ƒèƒ½æŸ¥çœ‹å„é¡¹æŒ‡æ ‡éšæ—¶é—´å˜åŒ–çš„æƒ…å†µï¼›</p><ul><li><code>runq-sz</code>ï¼šè¿è¡Œé˜Ÿåˆ—çš„é•¿åº¦ï¼ˆç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•°ï¼‰</li><li><code>plist-sz</code>ï¼šè¿›ç¨‹åˆ—è¡¨ä¸­è¿›ç¨‹ï¼ˆprocessesï¼‰å’Œçº¿ç¨‹ï¼ˆthreadsï¼‰çš„æ•°é‡</li><li><code>ldavg-1</code>ï¼šæœ€å1åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½ ldavg-5ï¼šè¿‡å»5åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½</li><li><code>ldavg-15</code>ï¼šè¿‡å»15åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½</li></ul><h3 id="æŸ¥çœ‹å†…å­˜ä½¿ç”¨çŠ¶å†µ-r"><a href="#æŸ¥çœ‹å†…å­˜ä½¿ç”¨çŠ¶å†µ-r" class="headerlink" title="æŸ¥çœ‹å†…å­˜ä½¿ç”¨çŠ¶å†µ -r"></a>æŸ¥çœ‹å†…å­˜ä½¿ç”¨çŠ¶å†µ -r</h3><p><code>sar -r</code>ï¼š å¯æŸ¥çœ‹ç‰©ç†å†…å­˜ä½¿ç”¨çŠ¶å†µï¼›</p><ul><li><code>kbmemfree</code>ï¼šè¿™ä¸ªå€¼å’Œfreeå‘½ä»¤ä¸­çš„freeå€¼åŸºæœ¬ä¸€è‡´,æ‰€ä»¥å®ƒä¸åŒ…æ‹¬bufferå’Œcacheçš„ç©ºé—´.</li><li><code>kbmemused</code>ï¼šè¿™ä¸ªå€¼å’Œfreeå‘½ä»¤ä¸­çš„usedå€¼åŸºæœ¬ä¸€è‡´,æ‰€ä»¥å®ƒåŒ…æ‹¬bufferå’Œcacheçš„ç©ºé—´.</li><li><code>%memused</code>ï¼šç‰©ç†å†…å­˜ä½¿ç”¨ç‡ï¼Œè¿™ä¸ªå€¼æ˜¯kbmemusedå’Œå†…å­˜æ€»é‡(ä¸åŒ…æ‹¬swap)çš„ä¸€ä¸ªç™¾åˆ†æ¯”.</li><li><code>kbbuffers</code>å’Œ<code>kbcached</code>ï¼šè¿™ä¸¤ä¸ªå€¼å°±æ˜¯freeå‘½ä»¤ä¸­çš„bufferå’Œcache.</li><li><code>kbcommit</code>ï¼šä¿è¯å½“å‰ç³»ç»Ÿæ‰€éœ€è¦çš„å†…å­˜,å³ä¸ºäº†ç¡®ä¿ä¸æº¢å‡ºè€Œéœ€è¦çš„å†…å­˜(RAM+swap).</li><li><code>%commit</code>ï¼šè¿™ä¸ªå€¼æ˜¯kbcommitä¸å†…å­˜æ€»é‡(åŒ…æ‹¬swap)çš„ä¸€ä¸ªç™¾åˆ†æ¯”.</li></ul><h3 id="æŸ¥çœ‹é¡µé¢äº¤æ¢å‘ç”ŸçŠ¶å†µ-W"><a href="#æŸ¥çœ‹é¡µé¢äº¤æ¢å‘ç”ŸçŠ¶å†µ-W" class="headerlink" title="æŸ¥çœ‹é¡µé¢äº¤æ¢å‘ç”ŸçŠ¶å†µ -W"></a>æŸ¥çœ‹é¡µé¢äº¤æ¢å‘ç”ŸçŠ¶å†µ -W</h3><p><code>sar -W</code>ï¼šæŸ¥çœ‹é¡µé¢äº¤æ¢å‘ç”ŸçŠ¶å†µ</p><p>é¡µé¢å‘ç”Ÿäº¤æ¢æ—¶ï¼ŒæœåŠ¡å™¨çš„ååé‡ä¼šå¤§å¹…ä¸‹é™ï¼›æœåŠ¡å™¨çŠ¶å†µä¸è‰¯æ—¶ï¼Œå¦‚æœæ€€ç–‘å› ä¸ºå†…å­˜ä¸è¶³è€Œå¯¼è‡´äº†é¡µé¢äº¤æ¢çš„å‘ç”Ÿï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥ç¡®è®¤æ˜¯å¦å‘ç”Ÿäº†å¤§é‡çš„äº¤æ¢ï¼›</p><ul><li><code>pswpin/s</code>ï¼šæ¯ç§’ç³»ç»Ÿæ¢å…¥çš„äº¤æ¢é¡µé¢ï¼ˆswap pageï¼‰æ•°é‡</li><li><code>pswpout/s</code>ï¼šæ¯ç§’ç³»ç»Ÿæ¢å‡ºçš„äº¤æ¢é¡µé¢ï¼ˆswap pageï¼‰æ•°é‡</li></ul><h3 id="ç»¼åˆåˆ†æ"><a href="#ç»¼åˆåˆ†æ" class="headerlink" title="ç»¼åˆåˆ†æ"></a>ç»¼åˆåˆ†æ</h3><p>è¦åˆ¤æ–­ç³»ç»Ÿç“¶é¢ˆé—®é¢˜ï¼Œæœ‰æ—¶éœ€å‡ ä¸ª sar å‘½ä»¤é€‰é¡¹ç»“åˆèµ·æ¥ï¼›</p><ul><li>æ€€ç–‘CPUå­˜åœ¨ç“¶é¢ˆï¼Œå¯ç”¨ <code>sar -u</code> å’Œ <code>sar -q</code> ç­‰æ¥æŸ¥çœ‹</li><li>æ€€ç–‘å†…å­˜å­˜åœ¨ç“¶é¢ˆï¼Œå¯ç”¨<code>sar -B</code>ã€<code>sar -r</code> å’Œ <code>sar -W</code> ç­‰æ¥æŸ¥çœ‹</li><li>æ€€ç–‘I/Oå­˜åœ¨ç“¶é¢ˆï¼Œå¯ç”¨ <code>sar -b</code>ã€<code>sar -u</code> å’Œ <code>sar -d</code> ç­‰æ¥æŸ¥çœ‹</li></ul>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå†…å­˜åˆ†æå·¥å…· - free</title>
      <link href="/2015/08/21/Linux/Linux%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20-%20free/"/>
      <url>/2015/08/21/Linux/Linux%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20-%20free/</url>
      
        <content type="html"><![CDATA[<p>freeå·¥å…·ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿå¯ç”¨å†…å­˜</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/opt/app/tdev1 $ free</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:       8175320    6159248    2016072          0     310208    5243680</span><br><span class="line">-/+ buffers/cache:     605360    7569960</span><br><span class="line">Swap:      6881272      16196    6865076</span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹Linuxä¸Šfreeå‘½ä»¤çš„è¾“å‡ºã€‚</p><p>reeçš„è¾“å‡ºçœ‹æˆä¸€ä¸ªäºŒç»´æ•°ç»„<code>FO(Free Output)</code>ã€‚ä¾‹å¦‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FO[2][1] = 24677460</span><br><span class="line">FO[3][2] = 10321516</span><br><span class="line"></span><br><span class="line">                   1          2          3          4          5          6</span><br><span class="line">1              total       used       free     shared    buffers     cached</span><br><span class="line">2 Mem:      24677460   23276064    1401396          0     870540   12084008</span><br><span class="line">3 -/+ buffers/cache:   10321516   14355944</span><br><span class="line">4 Swap:     25151484     224188   24927296</span><br></pre></td></tr></table></figure><p>freeçš„è¾“å‡ºä¸€å…±æœ‰å››è¡Œï¼Œç¬¬å››è¡Œä¸ºäº¤æ¢åŒºçš„ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯äº¤æ¢çš„æ€»é‡ï¼ˆtotalï¼‰ï¼Œä½¿ç”¨é‡ï¼ˆusedï¼‰å’Œæœ‰å¤šå°‘ç©ºé—²çš„äº¤æ¢åŒºï¼ˆfreeï¼‰ï¼Œè¿™ä¸ªæ¯”è¾ƒæ¸…æ¥šï¼Œä¸è¯´å¤ªå¤šã€‚</p><p>freeè¾“å‡ºåœ°ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œæ˜¯æ¯”è¾ƒè®©äººè¿·æƒ‘çš„ã€‚è¿™ä¸¤è¡Œéƒ½æ˜¯è¯´æ˜å†…å­˜ä½¿ç”¨æƒ…å†µçš„ã€‚ç¬¬ä¸€åˆ—æ˜¯æ€»é‡ï¼ˆtotalï¼‰ï¼Œç¬¬äºŒåˆ—æ˜¯ä½¿ç”¨é‡ï¼ˆusedï¼‰ï¼Œç¬¬ä¸‰åˆ—æ˜¯å¯ç”¨é‡ï¼ˆfreeï¼‰ã€‚</p><p>ã€€ã€€ç¬¬ä¸€è¡Œçš„è¾“å‡ºæ—¶ä»æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æ¥çœ‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»OSçš„è§’åº¦æ¥çœ‹ï¼Œè®¡ç®—æœºä¸Šä¸€å…±æœ‰:</p><p>24677460KBï¼ˆç¼ºçœæ—¶freeçš„å•ä½ä¸ºKBï¼‰ç‰©ç†å†…å­˜ï¼Œå³<code>FO[2][1]</code>ï¼› åœ¨è¿™äº›ç‰©ç†å†…å­˜ä¸­æœ‰23276064KBï¼ˆå³<code>FO[2][2]</code>ï¼‰è¢«ä½¿ç”¨äº†ï¼› è¿˜ç”¨1401396KBï¼ˆå³FO[2][3]ï¼‰æ˜¯å¯ç”¨çš„ï¼›</p><p>è¿™é‡Œå¾—åˆ°ç¬¬ä¸€ä¸ªç­‰å¼ï¼š</p><p><code>FO[2][1] = FO[2][2] + FO[2][3]</code></p><p><code>FO[2][4]</code>è¡¨ç¤ºè¢«å‡ ä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜çš„ï¼Œç°åœ¨å·²ç»deprecatedï¼Œå…¶å€¼æ€»æ˜¯0ï¼ˆå½“ç„¶åœ¨ä¸€äº›ç³»ç»Ÿä¸Šä¹Ÿå¯èƒ½ä¸æ˜¯0ï¼Œä¸»è¦å–å†³äºfreeå‘½ä»¤æ˜¯æ€ä¹ˆå®ç°çš„ï¼‰ã€‚</p><p><code>FO[2][5]</code>è¡¨ç¤ºè¢«OS bufferä½çš„å†…å­˜ã€‚<code>FO[2][6]</code>è¡¨ç¤ºè¢«OS cacheçš„å†…å­˜ã€‚åœ¨æœ‰äº›æ—¶å€™bufferå’Œcacheè¿™ä¸¤ä¸ªè¯ç»å¸¸æ··ç”¨ã€‚ä¸è¿‡åœ¨ä¸€äº›æ¯”è¾ƒä½å±‚çš„è½¯ä»¶é‡Œæ˜¯è¦åŒºåˆ†è¿™ä¸¤ä¸ªè¯çš„ï¼Œçœ‹è€å¤–çš„æ´‹æ–‡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A buffer is something that has yet to be &quot;written&quot; to disk.</span><br><span class="line">A cache is something that has been &quot;read&quot; from the disk and stored for later use.</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´bufferæ˜¯ç”¨äºå­˜æ”¾è¦è¾“å‡ºåˆ°diskï¼ˆå—è®¾å¤‡ï¼‰çš„æ•°æ®çš„ï¼Œè€Œcacheæ˜¯å­˜æ”¾ä»diskä¸Šè¯»å‡ºçš„æ•°æ®ã€‚è¿™äºŒè€…æ˜¯ä¸ºäº†æé«˜IOæ€§èƒ½çš„ï¼Œå¹¶ç”±OSç®¡ç†ã€‚</p><p>Linuxå’Œå…¶ä»–æˆç†Ÿçš„æ“ä½œç³»ç»Ÿï¼ˆä¾‹å¦‚windowsï¼‰ï¼Œä¸ºäº†æé«˜IO readçš„æ€§èƒ½ï¼Œæ€»æ˜¯è¦å¤šcacheä¸€äº›æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ<code>FO[2][6]</code>ï¼ˆcached memoryï¼‰æ¯”è¾ƒå¤§ï¼Œè€ŒFO[2][3]æ¯”è¾ƒå°çš„åŸå› ã€‚æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„æµ‹è¯•:</p><p>é‡Šæ”¾æ‰è¢«ç³»ç»Ÿcacheå ç”¨çš„æ•°æ®:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 3&gt;/proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure><ol><li>è¯»ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶è®°å½•æ—¶é—´ï¼›</li><li>å…³é—­è¯¥æ–‡ä»¶ï¼›</li><li>é‡è¯»è¿™ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶è®°å½•æ—¶é—´ï¼›</li></ol><p>ç¬¬äºŒæ¬¡è¯»åº”è¯¥æ¯”ç¬¬ä¸€æ¬¡å¿«å¾ˆå¤šã€‚åŸæ¥æˆ‘åšè¿‡ä¸€ä¸ªBerkeleyDBçš„è¯»æ“ä½œï¼Œå¤§æ¦‚è¦è¯»5Gçš„æ–‡ä»¶ï¼Œå‡ åƒä¸‡æ¡è®°å½•ã€‚åœ¨æˆ‘çš„ç¯å¢ƒä¸Šï¼Œç¬¬äºŒæ¬¡è¯»æ¯”ç¬¬ä¸€æ¬¡å¤§æ¦‚å¯ä»¥å¿«9å€å·¦å³ã€‚</p><p>freeè¾“å‡ºçš„ç¬¬äºŒè¡Œæ˜¯ä»ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è§’åº¦çœ‹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</p><ul><li>å¯¹äº<code>FO[3][2]</code>ï¼Œå³<code>-buffers/cache</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªåº”ç”¨ç¨‹åºè®¤ä¸ºç³»ç»Ÿè¢«ç”¨æ‰å¤šå°‘å†…å­˜ï¼›</li><li>å¯¹äº<code>FO[3][3]</code>ï¼Œå³<code>+buffers/cache</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªåº”ç”¨ç¨‹åºè®¤ä¸ºç³»ç»Ÿè¿˜æœ‰å¤šå°‘å†…å­˜ï¼›</li></ul><p>å› ä¸ºè¢«ç³»ç»Ÿcacheå’Œbufferå ç”¨çš„å†…å­˜å¯ä»¥è¢«å¿«é€Ÿå›æ”¶ï¼Œæ‰€ä»¥é€šå¸¸FO[3][3]æ¯”FO[2][3]ä¼šå¤§å¾ˆå¤šã€‚</p><p>è¿™é‡Œè¿˜ç”¨ä¸¤ä¸ªç­‰å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FO[3][2] &#x3D; FO[2][2] - FO[2][5] - FO[2][6]</span><br><span class="line">FO[3][3] &#x3D; FO[2][3] + FO[2][5] + FO[2][6]</span><br></pre></td></tr></table></figure><p>è¿™äºŒè€…éƒ½ä¸éš¾ç†è§£ã€‚</p><p>freeå‘½ä»¤ç”±<code>procps.*.rpm</code>æä¾›ï¼ˆåœ¨Redhatç³»åˆ—çš„OSä¸Šï¼‰ã€‚freeå‘½ä»¤çš„æ‰€æœ‰è¾“å‡ºå€¼éƒ½æ˜¯ä»<code>/proc/meminfo</code>ä¸­è¯»å‡ºçš„ã€‚</p><p>åœ¨ç³»ç»Ÿä¸Šå¯èƒ½æœ‰<code>meminfo(2)</code>è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå°±æ˜¯ä¸ºäº†è§£æ<code>/proc/meminfo</code>çš„ã€‚procpsè¿™ä¸ªåŒ…è‡ªå·±å®ç°äº†<code>meminfo()</code>è¿™ä¸ªå‡½æ•°ã€‚å¯ä»¥ä¸‹è½½ä¸€ä¸ªprocpsçš„taråŒ…çœ‹çœ‹å…·ä½“å®ç°ï¼Œç°åœ¨æœ€æ–°ç‰ˆå¼3.2.8ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitç¬”è®°ä¹‹rm</title>
      <link href="/2015/08/15/git/git%E7%AC%94%E8%AE%B0%E4%B9%8Brm/"/>
      <url>/2015/08/15/git/git%E7%AC%94%E8%AE%B0%E4%B9%8Brm/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ä¸ª-gitignoreçš„å¸¸è§é—®é¢˜"><a href="#ä¸€ä¸ª-gitignoreçš„å¸¸è§é—®é¢˜" class="headerlink" title="ä¸€ä¸ª.gitignoreçš„å¸¸è§é—®é¢˜"></a>ä¸€ä¸ª.gitignoreçš„å¸¸è§é—®é¢˜</h2><blockquote><p>æ˜æ˜æˆ‘åœ¨.gitignoreä¸Šå†™äº†è¿™ä¸ªè§„åˆ™å•Šï¼Œä¸ºæ¯›å®ƒè¿˜æ˜¯è¢«gitç‰ˆæœ¬æ§åˆ¶äº†</p></blockquote><p>ä»Šå¤©å°±é‡åˆ°äº†è¿™ä¸ªè›‹ç–¼çš„é—®é¢˜ï¼Œ.vscodeæ–‡ä»¶å¤¹ä¸­çš„è°ƒè¯•é…ç½®ä¹Ÿè¢«æäº¤åˆ°ç‰ˆæœ¬åº“äº†ï¼Œä½†å®ƒå¹¶ä¸éœ€è¦ç‰ˆæœ¬æ§åˆ¶ã€‚æˆ‘å°è¯•åœ¨.gitignoreé‡Œå†™ä¸Š.vscodeè¿™ä¸ªè§„åˆ™ï¼Œä½†ä¾æ—§ä¸èµ·ä½œç”¨ã€‚</p><a id="more"></a><p>Googleä¹‹ï¼ŒåŸæ¥è¿™æ˜¯å› ä¸ºï¼Œè¯¥æ–‡ä»¶å·²ç»å­˜åœ¨äºè¿œç¨‹ç›®å½•ã€‚éš¾é“æ³¼å‡ºå»çš„æ°´è¿˜èƒ½æ”¶å›æ¥å—ã€‚</p><p>âšˆà¹‰Ì¤Í¡ ËŒÌ«Ì® âšˆà¹‰Ì¤Í¡â€ æ˜¯å¯ä»¥çš„ï¼gitä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·çš„å·¥å…·â€”<code>git rm</code></p><h2 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>å®ƒçš„ä½œç”¨æ—¶æŠŠç›¸åº”æ–‡ä»¶ä»å½“å‰çš„ç‰ˆæœ¬ç§»é™¤å‡ºå·¥ä½œæ ‘ã€‚</p><p>å¥½çš„æˆ‘ä»¬æƒ³è¦å§.vscodeä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ç§»é™¤å‡ºå»ï¼Œæ‰€ä»¥åº”å½“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm -r .vscode</span><br></pre></td></tr></table></figure><p>è¾“å…¥ï¼Œå›è½¦ï¼Œè‚¿ä¹ˆæ–‡ä»¶éƒ½æ²¡äº†ï¼ï¼ï¼æˆ‘ä»¬åªæ˜¯æƒ³è¦ç§»é™¤ç‰ˆæœ¬æ§åˆ¶è€Œå·²ï¼Œå¹¶ä¸æƒ³ç§»é™¤æ–‡ä»¶å•Šã€‚å›å¤</p><p>ä»”ç»†çœ‹çœ‹ï¼ŒåŸæ¥æœ‰ä¸ªâ€”cachedé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹ç§»é™¤ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†æ˜¯ä¸æŠŠæ–‡ä»¶ç§»é™¤å‡ºå·¥ä½œåŒºã€‚</p><p>æ‰€ä»¥è¾“å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .vscode</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥è¦è¢«ç§»é™¤çš„æ–‡ä»¶"><a href="#æ£€æŸ¥è¦è¢«ç§»é™¤çš„æ–‡ä»¶" class="headerlink" title="æ£€æŸ¥è¦è¢«ç§»é™¤çš„æ–‡ä»¶"></a>æ£€æŸ¥è¦è¢«ç§»é™¤çš„æ–‡ä»¶</h2><p>ç­‰ç­‰ï¼Œæˆ‘ä¸æ”¾å¿ƒï¼æˆ‘è¦çœ‹çœ‹ç§»é™¤çš„æ˜¯å“ªäº›æ–‡ä»¶ï¼æ‰“å¼€æ–‡ä»¶å¤¹çœ‹çœ‹â€¦</p><p>STOPï¼ gitæ—©ä¸ºä½ ä»¬è¿™äº›å¼ºè¿«ç—‡å‡†å¤‡å¥½äº†è¿™ä¸ªç¥å™¨<code>-n</code> é€‰é¡¹ï¼Œå®ƒä¸å¯¹æ–‡ä»¶ç§»é™¤ï¼Œåªæ˜¯æ˜¾ç¤ºå‡ºè¿™æ¡å‘½ä»¤ä¼šç§»é™¤çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm -r -n --cached  .vscode</span><br></pre></td></tr></table></figure><p>okï¼Œè¿™å°±æ˜¯è¦ç§»é™¤çš„æ–‡ä»¶ï¼Œåˆ é™¤<code>-n</code>å‘½ä»¤ï¼Œå†æ‰§è¡Œä¸€æ¬¡å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .vscode</span><br><span class="line">git status</span><br></pre></td></tr></table></figure><p>å¾ˆå¥½ï¼Œè¦ç§»é™¤çš„æ–‡ä»¶éƒ½å˜æˆäº†untrackedï¼Œç„¶åcommitï¼Œpushåˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚æå®šï¼</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®è·µLinuxç¼–ç¨‹ä¹‹å - ä¼˜åŒ–</title>
      <link href="/2015/08/01/Linux/Linux%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%8F%81%20-%20%E4%BC%98%E5%8C%96/"/>
      <url>/2015/08/01/Linux/Linux%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%8F%81%20-%20%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>æ ¹æ®æœ¨æ¡¶æ•ˆåº”ï¼Œä¸€ä¸ªç¨‹åºç“¶é¢ˆå†³å®šå®ƒçš„æ€§èƒ½ï¼Œæ‰€ä»¥æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯æ‰¾å‡ºç³»ç»Ÿçš„ç“¶é¢ˆç‚¹ã€‚</p><a id="more"></a><h2 id="åˆ†æç³»ç»Ÿç“¶é¢ˆ"><a href="#åˆ†æç³»ç»Ÿç“¶é¢ˆ" class="headerlink" title="åˆ†æç³»ç»Ÿç“¶é¢ˆ"></a>åˆ†æç³»ç»Ÿç“¶é¢ˆ</h2><p>ç³»ç»Ÿå“åº”å˜æ…¢ï¼Œé¦–å…ˆå¾—å®šä½å¤§è‡´çš„é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Œæ˜¯IOç“¶é¢ˆã€CPUç“¶é¢ˆã€å†…å­˜ç“¶é¢ˆè¿˜æ˜¯ç¨‹åºå¯¼è‡´çš„ç³»ç»Ÿé—®é¢˜ï¼›</p><p>ä½¿ç”¨topå·¥å…·èƒ½å¤Ÿæ¯”è¾ƒå…¨é¢çš„æŸ¥çœ‹æˆ‘ä»¬å…³æ³¨çš„ç‚¹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$top</span></span><br><span class="line">    top - 09:14:56 up 264 days, 20:56,  1 user,  load average: 0.02, 0.04, 0.00</span><br><span class="line">    Tasks:  87 total,   1 running,  86 sleeping,   0 stopped,   0 zombie</span><br><span class="line">    Cpu(s):  0.0%us,  0.2%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.2%st</span><br><span class="line">    Mem:    377672k total,   322332k used,    55340k free,    32592k buffers</span><br><span class="line">    Swap:   397308k total,    67192k used,   330116k free,    71900k cached</span><br><span class="line">    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</span><br><span class="line">    1 root      20   0  2856  656  388 S  0.0  0.2   0:49.40 init</span><br><span class="line">    2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd</span><br><span class="line">    3 root      20   0     0    0    0 S  0.0  0.0   7:15.20 ksoftirqd/0</span><br><span class="line">    4 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 migration/</span><br></pre></td></tr></table></figure><ul><li><p>è¿›å…¥äº¤äº’æ¨¡å¼å:</p><p>è¾“å…¥<code>M</code>ï¼Œè¿›ç¨‹åˆ—è¡¨æŒ‰å†…å­˜ä½¿ç”¨å¤§å°é™åºæ’åºï¼Œä¾¿äºæˆ‘ä»¬è§‚å¯Ÿæœ€å¤§å†…å­˜ä½¿ç”¨è€…ä½¿ç”¨æœ‰é—®é¢˜ï¼ˆæ£€æµ‹å†…å­˜æ³„æ¼é—®é¢˜ï¼‰;è¾“å…¥<code>P</code>ï¼Œè¿›ç¨‹åˆ—è¡¨æŒ‰CPUä½¿ç”¨å¤§å°é™åºæ’åºï¼Œä¾¿äºæˆ‘ä»¬è§‚å¯Ÿæœ€è€—CPUèµ„æºçš„ä½¿ç”¨è€…æ˜¯å¦æœ‰é—®é¢˜ï¼›</p></li><li><p><code>top</code>ç¬¬ä¸‰è¡Œæ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå€¼å¾ˆå…³é”®:</p><p><code>%id</code>ï¼šç©ºé—²CPUæ—¶é—´ç™¾åˆ†æ¯”ï¼Œå¦‚æœè¿™ä¸ªå€¼è¿‡ä½ï¼Œè¡¨æ˜ç³»ç»ŸCPUå­˜åœ¨ç“¶é¢ˆï¼›</p><p><code>%wa</code>ï¼šç­‰å¾…I/Oçš„CPUæ—¶é—´ç™¾åˆ†æ¯”ï¼Œå¦‚æœè¿™ä¸ªå€¼è¿‡é«˜ï¼Œè¡¨æ˜IOå­˜åœ¨ç“¶é¢ˆï¼›</p></li></ul><h2 id="åˆ†æå†…å­˜ç“¶é¢ˆ"><a href="#åˆ†æå†…å­˜ç“¶é¢ˆ" class="headerlink" title="åˆ†æå†…å­˜ç“¶é¢ˆ"></a>åˆ†æå†…å­˜ç“¶é¢ˆ</h2><p>æŸ¥çœ‹å†…å­˜æ˜¯å¦å­˜åœ¨ç“¶é¢ˆï¼Œä½¿ç”¨<code>top</code>æŒ‡ä»¤çœ‹æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œ<code>free</code>å‘½ä»¤æ›´ä¸ºç›´è§‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ free</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:        501820     452028      49792      37064       5056     136732</span><br><span class="line">-/+ buffers/cache:     310240     191580</span><br><span class="line">Swap:            0          0          0</span><br><span class="line">$ top</span><br><span class="line">top - 17:52:17 up 42 days,  7:10,  1 user,  load average: 0.02, 0.02, 0.05</span><br><span class="line">Tasks:  80 total,   1 running,  79 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem:    501820 total,   452548 used,    49272 free,     5144 buffers</span><br><span class="line">KiB Swap:        0 total,        0 used,        0 free.   136988 cached Mem</span><br></pre></td></tr></table></figure><p><code>top</code>å·¥å…·æ˜¾ç¤ºäº†<code>free</code>å·¥å…·çš„ç¬¬ä¸€è¡Œæ‰€æœ‰ä¿¡æ¯ï¼Œä½†çœŸå®å¯ç”¨çš„å†…å­˜ï¼Œè¿˜éœ€è¦è‡ªå·±è®¡ç®—æ‰çŸ¥é“; ç³»ç»Ÿå®é™…å¯ç”¨çš„å†…å­˜ä¸º<code>free</code>å·¥å…·è¾“å‡ºç¬¬äºŒè¡Œçš„<code>free+buffer+cached</code>ï¼›ä¹Ÿå°±æ˜¯ç¬¬ä¸‰è¡Œçš„<code>free</code>å€¼191580ï¼›å…³äº<code>free</code>å‘½ä»¤å„ä¸ªå€¼çš„è¯¦æƒ…è§£è¯»ï¼Œè¯·å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/free.html#free">free æŸ¥è¯¢å¯ç”¨å†…å­˜</a> ;</p><p>å¦‚æœæ˜¯å› ä¸ºç¼ºå°‘å†…å­˜ï¼Œç³»ç»Ÿå“åº”å˜æ…¢å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºè¿™ä½¿å¾—ç³»ç»Ÿä¸åœçš„åšæ¢å…¥æ¢å‡ºçš„å·¥ä½œ;</p><p>è¿›ä¸€æ­¥çš„ç›‘è§†å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¯ä½¿ç”¨<code>vmstat</code>å·¥å…·ï¼Œå®æ—¶åŠ¨æ€ç›‘è§†æ“ä½œç³»ç»Ÿçš„å†…å­˜å’Œè™šæ‹Ÿå†…å­˜çš„åŠ¨æ€å˜åŒ–ã€‚ å‚è€ƒï¼š <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/vmstat.html#vmstat">vmstat ç›‘è§†å†…å­˜ä½¿ç”¨æƒ…å†µ</a> ;</p><h2 id="åˆ†æIOç“¶é¢ˆ"><a href="#åˆ†æIOç“¶é¢ˆ" class="headerlink" title="åˆ†æIOç“¶é¢ˆ"></a>åˆ†æIOç“¶é¢ˆ</h2><p>å¦‚æœIOå­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œ<code>top</code>å·¥å…·ä¸­çš„<code>%wa</code>ä¼šåé«˜ï¼›</p><p>è¿›ä¸€æ­¥åˆ†æä½¿ç”¨<code>iostat</code>å·¥å…·:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ iostat -d -x -k 1 1</span><br><span class="line">Linux 2.6.32-279.el6.x86_64 (colin)   07/16/2014      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util</span><br><span class="line">sda               0.02     7.25    0.04    1.90     0.74    35.47    37.15     0.04   19.13   5.58   1.09</span><br><span class="line">dm-0              0.00     0.00    0.04    3.05     0.28    12.18     8.07     0.65  209.01   1.11   0.34</span><br><span class="line">dm-1              0.00     0.00    0.02    5.82     0.46    23.26     8.13     0.43   74.33   1.30   0.76</span><br><span class="line">dm-2              0.00     0.00    0.00    0.01     0.00     0.02     8.00     0.00    5.41   3.28   0.00</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ<code>%iowait</code>çš„å€¼è¿‡é«˜ï¼Œè¡¨ç¤ºç¡¬ç›˜å­˜åœ¨I/Oç“¶é¢ˆã€‚</li><li>å¦‚æœ <code>%util</code> æ¥è¿‘ 100%ï¼Œè¯´æ˜äº§ç”Ÿçš„I/Oè¯·æ±‚å¤ªå¤šï¼ŒI/Oç³»ç»Ÿå·²ç»æ»¡è´Ÿè·ï¼Œè¯¥ç£ç›˜å¯èƒ½å­˜åœ¨ç“¶é¢ˆã€‚</li><li>å¦‚æœ <code>svctm</code> æ¯”è¾ƒæ¥è¿‘ <code>await</code>ï¼Œè¯´æ˜ I/O å‡ ä¹æ²¡æœ‰ç­‰å¾…æ—¶é—´ï¼›</li><li>å¦‚æœ <code>await</code> è¿œå¤§äº <code>svctm</code>ï¼Œè¯´æ˜I/O é˜Ÿåˆ—å¤ªé•¿ï¼Œioå“åº”å¤ªæ…¢ï¼Œåˆ™éœ€è¦è¿›è¡Œå¿…è¦ä¼˜åŒ–ã€‚</li><li>å¦‚æœ<code>avgqu-sz</code>æ¯”è¾ƒå¤§ï¼Œä¹Ÿè¡¨ç¤ºæœ‰å¤§é‡ioåœ¨ç­‰å¾…ã€‚</li></ul><p>æ›´å¤šå‚æ•°è¯´æ˜è¯·å‚è€ƒ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/iostat.html#iostat">iostat ç›‘è§†I/Oå­ç³»ç»Ÿ</a> ;</p><h2 id="åˆ†æè¿›ç¨‹è°ƒç”¨"><a href="#åˆ†æè¿›ç¨‹è°ƒç”¨" class="headerlink" title="åˆ†æè¿›ç¨‹è°ƒç”¨"></a>åˆ†æè¿›ç¨‹è°ƒç”¨</h2><p>é€šè¿‡<code>top</code>ç­‰å·¥å…·å‘ç°ç³»ç»Ÿæ€§èƒ½é—®é¢˜æ˜¯ç”±æŸä¸ªè¿›ç¨‹å¯¼è‡´çš„ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦åˆ†æè¿™ä¸ªè¿›ç¨‹ï¼›ç»§ç»­ æŸ¥è¯¢é—®é¢˜åœ¨å“ªï¼›</p><p>è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªå¥½ç”¨çš„å·¥å…·ï¼š <code>pstack</code>å’Œ<code>pstrace</code></p><p>pstackç”¨æ¥è·Ÿè¸ªè¿›ç¨‹æ ˆï¼Œè¿™ä¸ªå‘½ä»¤åœ¨æ’æŸ¥è¿›ç¨‹é—®é¢˜æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å‘ç°ä¸€ä¸ªæœåŠ¡ä¸€ç›´å¤„äºworkçŠ¶æ€ï¼ˆå¦‚å‡æ­»çŠ¶æ€ï¼Œå¥½ä¼¼æ­»å¾ªç¯ï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±èƒ½è½»æ¾å®šä½é—®é¢˜æ‰€åœ¨ï¼›å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå¤šæ‰§è¡Œå‡ æ¬¡pstackï¼Œè‹¥å‘ç°ä»£ç æ ˆæ€»æ˜¯åœåœ¨åŒä¸€ä¸ªä½ç½®ï¼Œé‚£ä¸ªä½ç½®å°±éœ€è¦é‡ç‚¹å…³æ³¨ï¼Œå¾ˆå¯èƒ½å°±æ˜¯å‡ºé—®é¢˜çš„åœ°æ–¹ï¼›</p><p>ç¤ºä¾‹ï¼šæŸ¥çœ‹bashç¨‹åºè¿›ç¨‹æ ˆ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/opt/app/tdev1<span class="variable">$ps</span> -fe| grep bash</span><br><span class="line">tdev1   7013  7012  0 19:42 pts/1    00:00:00 -bash</span><br><span class="line">tdev1  11402 11401  0 20:31 pts/2    00:00:00 -bash</span><br><span class="line">tdev1  11474 11402  0 20:32 pts/2    00:00:00 grep bash</span><br><span class="line">/opt/app/tdev1<span class="variable">$pstack</span> 7013</span><br><span class="line"><span class="comment">#0  0x00000039958c5620 in __read_nocancel () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#1  0x000000000047dafe in rl_getc ()</span></span><br><span class="line"><span class="comment">#2  0x000000000047def6 in rl_read_key ()</span></span><br><span class="line"><span class="comment">#3  0x000000000046d0f5 in readline_internal_char ()</span></span><br><span class="line"><span class="comment">#4  0x000000000046d4e5 in readline ()</span></span><br><span class="line"><span class="comment">#5  0x00000000004213cf in ?? ()</span></span><br><span class="line"><span class="comment">#6  0x000000000041d685 in ?? ()</span></span><br><span class="line"><span class="comment">#7  0x000000000041e89e in ?? ()</span></span><br><span class="line"><span class="comment">#8  0x00000000004218dc in yyparse ()</span></span><br><span class="line"><span class="comment">#9  0x000000000041b507 in parse_command ()</span></span><br><span class="line"><span class="comment">#10 0x000000000041b5c6 in read_command ()</span></span><br><span class="line"><span class="comment">#11 0x000000000041b74e in reader_loop ()</span></span><br><span class="line"><span class="comment">#12 0x000000000041b2aa in main ()</span></span><br></pre></td></tr></table></figure><p>è€Œ<code>strace</code>ç”¨æ¥è·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨ï¼›è¿™ä¸ªå·¥å…·èƒ½å¤ŸåŠ¨æ€çš„è·Ÿè¸ªè¿›ç¨‹æ‰§è¡Œæ—¶çš„ç³»ç»Ÿè°ƒç”¨å’Œæ‰€æ¥æ”¶çš„ä¿¡å·ã€‚æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æ£€æµ‹ã€æŒ‡å¯¼å’Œè°ƒè¯•å·¥å…·ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤å®¹æ˜“åœ°è§£å†³ç¨‹åºé—®é¢˜ã€‚</p><p>å‚è€ƒï¼š <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/strace.html#strace">strace è·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨</a> ;</p><h2 id="ä¼˜åŒ–ç¨‹åºä»£ç "><a href="#ä¼˜åŒ–ç¨‹åºä»£ç " class="headerlink" title="ä¼˜åŒ–ç¨‹åºä»£ç "></a>ä¼˜åŒ–ç¨‹åºä»£ç </h2><p>ä¼˜åŒ–è‡ªå·±å¼€å‘çš„ç¨‹åºï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹å‡†åˆ™:</p><ol><li>äºŒå…«æ³•åˆ™ï¼šåœ¨ä»»ä½•ä¸€ç»„ä¸œè¥¿ä¸­ï¼Œæœ€é‡è¦çš„åªå å…¶ä¸­ä¸€å°éƒ¨åˆ†ï¼Œçº¦20%ï¼Œå…¶ä½™80%çš„å°½ç®¡æ˜¯å¤šæ•°ï¼Œå´æ˜¯æ¬¡è¦çš„ï¼›åœ¨ä¼˜åŒ–å®è·µä¸­ï¼Œæˆ‘ä»¬å°†ç²¾åŠ›é›†ä¸­åœ¨ä¼˜åŒ–é‚£20%æœ€è€—æ—¶çš„ä»£ç ä¸Šï¼Œæ•´ä½“æ€§èƒ½å°†æœ‰æ˜¾è‘—çš„æå‡ï¼›è¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚å‡½æ•°Aè™½ç„¶ä»£ç é‡å¤§ï¼Œä½†åœ¨ä¸€æ¬¡æ­£å¸¸æ‰§è¡Œæµç¨‹ä¸­ï¼Œåªè°ƒç”¨äº†ä¸€æ¬¡ã€‚è€Œå¦ä¸€ä¸ªå‡½æ•°Bä»£ç é‡æ¯”Aå°å¾ˆå¤šï¼Œä½†è¢«è°ƒç”¨äº†1000æ¬¡ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬æ›´åº”å…³æ³¨Bçš„ä¼˜åŒ–ã€‚</li><li>å…ˆç¼–ç åä¼˜åŒ–ï¼›ç¼–ç çš„æ—¶å€™æ€»æ˜¯è€ƒè™‘æœ€ä½³æ€§èƒ½æœªå¿…æ€»æ˜¯å¥½çš„ï¼›åœ¨å¼ºè°ƒæœ€ä½³æ€§èƒ½çš„ç¼–ç æ–¹å¼çš„åŒæ—¶ï¼Œå¯èƒ½å°±æŸå¤±äº†ä»£ç çš„å¯è¯»æ€§å’Œå¼€å‘æ•ˆç‡ï¼›</li></ol><h3 id="gprofä½¿ç”¨æ­¥éª¤"><a href="#gprofä½¿ç”¨æ­¥éª¤" class="headerlink" title="gprofä½¿ç”¨æ­¥éª¤"></a><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/advance/03_optimization.html#id16">gprofä½¿ç”¨æ­¥éª¤</a></h3><ol><li>ç”¨gccã€g++ã€xlCç¼–è¯‘ç¨‹åºæ—¶ï¼Œä½¿ç”¨<code>-pg</code>å‚æ•°ï¼Œå¦‚ï¼š<code>g++ -pg -o test.exe test.cpp</code>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ¨ç›®æ ‡ä»£ç ä¸­æ’å…¥ç”¨äºæ€§èƒ½æµ‹è¯•çš„ä»£ç ç‰‡æ–­ï¼Œè¿™äº›ä»£ç åœ¨ç¨‹åºè¿è¡Œæ—¶é‡‡é›†å¹¶è®°å½•å‡½æ•°çš„è°ƒç”¨å…³ç³»å’Œè°ƒç”¨æ¬¡æ•°ï¼Œå¹¶è®°å½•å‡½æ•°è‡ªèº«æ‰§è¡Œæ—¶é—´å’Œè¢«è°ƒç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚</li><li>æ‰§è¡Œç¼–è¯‘åçš„å¯æ‰§è¡Œç¨‹åºï¼Œå¦‚ï¼š<code>./test.exe</code>ã€‚è¯¥æ­¥éª¤è¿è¡Œç¨‹åºçš„æ—¶é—´ä¼šç¨æ…¢äºæ­£å¸¸ç¼–è¯‘çš„å¯æ‰§è¡Œç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚ç¨‹åºè¿è¡Œç»“æŸåï¼Œä¼šåœ¨ç¨‹åºæ‰€åœ¨è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ªç¼ºçœæ–‡ä»¶åä¸º<code>gmon.out</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•ç¨‹åºè¿è¡Œçš„æ€§èƒ½ã€è°ƒç”¨å…³ç³»ã€è°ƒç”¨æ¬¡æ•°ç­‰ä¿¡æ¯çš„æ•°æ®æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨<code>gprof</code>å‘½ä»¤æ¥åˆ†æè®°å½•ç¨‹åºè¿è¡Œä¿¡æ¯çš„gmon.outæ–‡ä»¶ï¼Œå¦‚ï¼š<code>gprof test.exe gmon.out</code>åˆ™å¯ä»¥åœ¨æ˜¾ç¤ºå™¨ä¸Šçœ‹åˆ°å‡½æ•°è°ƒç”¨ç›¸å…³çš„ç»Ÿè®¡ã€åˆ†æä¿¡æ¯ã€‚ä¸Šè¿°ä¿¡æ¯ä¹Ÿå¯ä»¥é‡‡ç”¨<code>gprof test.exe gmon.out&gt; gprofresult.txt</code>é‡å®šå‘åˆ°æ–‡æœ¬æ–‡ä»¶ä»¥ä¾¿äºåç»­åˆ†æã€‚</li></ol><p>å…³äº<code>gprof</code>çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œè¯·å‚è€ƒ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/advance/03_optimization.html#f1">[f1]</a> ;</p><h2 id="å…¶å®ƒå·¥å…·"><a href="#å…¶å®ƒå·¥å…·" class="headerlink" title="å…¶å®ƒå·¥å…·"></a>å…¶å®ƒå·¥å…·</h2><p>å¯ä»¥ä½¿ç”¨<a href="https://www.ibm.com/developerworks/cn/linux/l-cn-valgrind/index.html">valgrind</a>æ¥åˆ†æå†…å­˜æ³„æ¼é—®é¢˜ã€‚</p><p>ä½¿ç”¨<a href="http://www.ibm.com/developerworks/cn/linux/l-oprof/">OProfile</a>æˆ–saræ¥åˆ†æç¨‹åºæ€§èƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®è·µLinuxç¼–ç¨‹ä¹‹è´° - è°ƒè¯•</title>
      <link href="/2015/07/20/Linux/Linux%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%B4%B0%20-%20%E8%B0%83%E8%AF%95/"/>
      <url>/2015/07/20/Linux/Linux%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%B4%B0%20-%20%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>ç°ä»£çš„IDEå·²ç»æä¾›äº†ç›¸å½“ä¸°å¯Œçš„è°ƒè¯•åŠŸèƒ½ï¼Œä½†æœ‰çš„æ—¶å€™åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦åˆ©ç”¨Linuxçš„å·¥å…·æ¥å¯¹è¿è¡Œçš„è¿›ç¨‹æ¥è¿›è¡Œè°ƒè¯•å’Œåˆ†æã€‚</p><a id="more"></a><h3 id="è¿›ç¨‹è°ƒè¯•"><a href="#è¿›ç¨‹è°ƒè¯•" class="headerlink" title="è¿›ç¨‹è°ƒè¯•"></a>è¿›ç¨‹è°ƒè¯•</h3><h4 id="gdb-ç¨‹åºäº¤äº’è°ƒè¯•"><a href="#gdb-ç¨‹åºäº¤äº’è°ƒè¯•" class="headerlink" title="gdb ç¨‹åºäº¤äº’è°ƒè¯•"></a>gdb ç¨‹åºäº¤äº’è°ƒè¯•</h4><p>GDBæ˜¯ä¸€ä¸ªç”±GNUå¼€æºç»„ç»‡å‘å¸ƒçš„ã€UNIX/LINUXæ“ä½œç³»ç»Ÿä¸‹çš„ã€åŸºäºå‘½ä»¤è¡Œçš„ã€åŠŸèƒ½å¼ºå¤§çš„ç¨‹åºè°ƒè¯•å·¥å…·ã€‚</p><p>å¯¹äºä¸€åLinuxä¸‹å·¥ä½œçš„c++ç¨‹åºå‘˜ï¼Œgdbæ˜¯å¿…ä¸å¯å°‘çš„å·¥å…·ï¼›</p><p>GDBä¸­çš„å‘½ä»¤å›ºç„¶å¾ˆå¤šï¼Œä½†æˆ‘ä»¬åªéœ€æŒæ¡å…¶ä¸­åä¸ªå·¦å³çš„å‘½ä»¤ï¼Œå°±å¤§è‡´å¯ä»¥å®Œæˆæ—¥å¸¸çš„åŸºæœ¬çš„ç¨‹åºè°ƒè¯•å·¥ä½œã€‚</p><p>ä»¥ä¸‹ä»ä¸€ä¸ªå®Œæ•´çš„è°ƒè¯•è¿‡ç¨‹ç®€å•è¯´æ˜æœ€åŸºæœ¬çš„å‡ ä¸ªå‘½ä»¤;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ gdb programmer     <span class="comment"># å¯åŠ¨gdb</span></span><br><span class="line">&gt;<span class="built_in">break</span> main         <span class="comment"># è®¾ç½®æ–­ç‚¹</span></span><br><span class="line">&gt;run                <span class="comment"># è¿è¡Œè°ƒè¯•ç¨‹åº</span></span><br><span class="line">&gt;next               <span class="comment"># å•æ­¥è°ƒè¯•</span></span><br><span class="line">&gt;<span class="built_in">print</span> var1         <span class="comment"># åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹å½“å‰æŸä¸ªå˜é‡å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨print å‘½ä»¤æ‰“å°è¯¥å€¼</span></span><br><span class="line">&gt;list               <span class="comment"># æ˜¾ç¤ºå½“å‰è°ƒè¯•å¤„çš„æºä»£ç </span></span><br><span class="line">&gt;info b             <span class="comment"># æ˜¾ç¤ºå½“å‰æ–­ç‚¹è®¾ç½®æƒ…å†µ</span></span><br></pre></td></tr></table></figure><p>å½“ä½ å®Œæˆäº†ç¬¬ä¸€ä¸ªç¨‹åºè°ƒè¯•ä¹‹åï¼Œä½ å½“ç„¶ä¼šéœ€è¦æ›´å¤šçš„å‘½ä»¤ï¼šå…³äºgdbå¸¸ç”¨å‘½ä»¤åŠå„ç§è°ƒè¯•æ–¹æ³•è¯¦è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html#gdb">gdb è°ƒè¯•åˆ©å™¨</a> ;</p><p>åŒæ—¶ï¼Œä½ éœ€è¦æ›´é«˜æ•ˆçš„è°ƒè¯•ï¼šå¸¸ç”¨çš„è°ƒè¯•å‘½ä»¤éƒ½ä¼šæœ‰å•å­—ç¬¦çš„ç¼©å†™ï¼Œä½¿ç”¨ç¼©å†™æ›´æ–¹ä¾¿ï¼›åŒæ—¶ï¼Œç›´æ¥æ•²å›è½¦è¡¨ç¤ºé‡å¤æ‰§è¡Œä¸Šä¸€æ­¥å‘½ä»¤ï¼›è¿™åœ¨å•æ­¥è°ƒè¯•æ—¶éå¸¸æœ‰ç”¨ï¼›</p><h4 id="pstack-è·Ÿè¸ªæ ˆç©ºé—´"><a href="#pstack-è·Ÿè¸ªæ ˆç©ºé—´" class="headerlink" title="pstack è·Ÿè¸ªæ ˆç©ºé—´"></a>pstack è·Ÿè¸ªæ ˆç©ºé—´</h4><p>pstackæ˜¯ä¸€ä¸ªè„šæœ¬å·¥å…·ï¼Œå¯æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„æ ˆè·Ÿè¸ªã€‚pstack å‘½ä»¤å¿…é¡»ç”±ç›¸åº”è¿›ç¨‹çš„å±ä¸»æˆ– root è¿è¡Œã€‚å…¶æ ¸å¿ƒå®ç°å°±æ˜¯ä½¿ç”¨äº†gdbä»¥åŠthread apply all btå‘½ä»¤;</p><p>è¯­æ³•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pstrack &lt;program-pid&gt;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ pstack 4551</span><br><span class="line">Thread 7 (Thread 1084229984 (LWP 4552)):</span><br><span class="line"><span class="comment">#0  0x000000302afc63dc in epoll_wait () from /lib64/tls/libc.so.6</span></span><br><span class="line"><span class="comment">#1  0x00000000006f0730 in ub::EPollEx::poll ()</span></span><br><span class="line"><span class="comment">#2  0x00000000006f172a in ub::NetReactor::callback ()</span></span><br><span class="line"><span class="comment">#3  0x00000000006fbbbb in ub::UBTask::CALLBACK ()</span></span><br><span class="line"><span class="comment">#4  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0</span></span><br><span class="line"><span class="comment">#5  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6</span></span><br><span class="line"><span class="comment">#6  0x0000000000000000 in ?? ()</span></span><br></pre></td></tr></table></figure><h4 id="strace-åˆ†æç³»ç»Ÿè°ƒç”¨"><a href="#strace-åˆ†æç³»ç»Ÿè°ƒç”¨" class="headerlink" title="strace åˆ†æç³»ç»Ÿè°ƒç”¨"></a>strace åˆ†æç³»ç»Ÿè°ƒç”¨</h4><p>straceå¸¸ç”¨æ¥è·Ÿè¸ªè¿›ç¨‹æ‰§è¡Œæ—¶çš„ç³»ç»Ÿè°ƒç”¨å’Œæ‰€æ¥æ”¶çš„ä¿¡å·ã€‚åœ¨Linuxä¸–ç•Œï¼Œè¿›ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡ï¼Œå½“è¿›ç¨‹éœ€è¦è®¿é—®ç¡¬ä»¶è®¾å¤‡(æ¯”å¦‚è¯»å–ç£ç›˜æ–‡ä»¶ï¼Œæ¥æ”¶ç½‘ç»œæ•°æ®ç­‰ç­‰)æ—¶ï¼Œå¿…é¡»ç”±ç”¨æˆ·æ€æ¨¡å¼åˆ‡æ¢è‡³å†…æ ¸æ€æ¨¡å¼ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®ç¡¬ä»¶è®¾å¤‡ã€‚straceå¯ä»¥è·Ÿè¸ªåˆ°ä¸€ä¸ªè¿›ç¨‹äº§ç”Ÿçš„ç³»ç»Ÿè°ƒç”¨,åŒ…æ‹¬å‚æ•°ï¼Œè¿”å›å€¼ï¼Œæ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´ã€‚</p><p>å®Œæ•´ç¨‹åº:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ strace -o output.txt -T -tt -e trace=all -p 28979</span><br></pre></td></tr></table></figure><p>è·Ÿè¸ª28979è¿›ç¨‹çš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ï¼ˆ<code>-e trace=all</code>ï¼‰ï¼Œå¹¶ç»Ÿè®¡ç³»ç»Ÿè°ƒç”¨çš„èŠ±è´¹æ—¶é—´ï¼Œä»¥åŠå¼€å§‹æ—¶é—´ï¼ˆä»¥å¯è§†åŒ–çš„æ—¶åˆ†ç§’æ ¼å¼æ˜¾ç¤ºï¼‰ï¼Œæœ€åå°†è®°å½•ç»“æœå­˜åœ¨<code>output.txt</code>æ–‡ä»¶é‡Œé¢ã€‚</p><p>æŸ¥çœ‹è¿›ç¨‹æ­£åœ¨åšä»€ä¹ˆ(å®æ—¶è¾“å‡ºè¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µ):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ strace -p &lt;process-pid&gt;</span><br></pre></td></tr></table></figure><p>å…³äºstraceçš„è¯¦ç»†ä»‹ç»ï¼Œè¯¦è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/strace.html#strace">strace è·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨</a> ;</p><h3 id="ç›®æ ‡æ–‡ä»¶åˆ†æ"><a href="#ç›®æ ‡æ–‡ä»¶åˆ†æ" class="headerlink" title="ç›®æ ‡æ–‡ä»¶åˆ†æ"></a>ç›®æ ‡æ–‡ä»¶åˆ†æ</h3><h4 id="nm-ç¬¦å·æ¸…å•"><a href="#nm-ç¬¦å·æ¸…å•" class="headerlink" title="nm ç¬¦å·æ¸…å•"></a>nm ç¬¦å·æ¸…å•</h4><p>nmç”¨æ¥åˆ—å‡ºç›®æ ‡æ–‡ä»¶çš„ç¬¦å·æ¸…å•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ nm myProgrammer</span><br><span class="line">08049f28 d _DYNAMIC</span><br><span class="line">08049ff4 d _GLOBAL_OFFSET_TABLE_</span><br><span class="line">080484dc R _IO_stdin_used</span><br><span class="line">         w _Jv_RegisterClasses</span><br><span class="line">08049f18 d __CTOR_END__</span><br><span class="line">08049f14 d __CTOR_LIST__</span><br><span class="line">08049f20 D __DTOR_END__</span><br><span class="line">08049f1c d __DTOR_LIST__</span><br><span class="line">080485e0 r __FRAME_END__</span><br><span class="line">08049f24 d __JCR_END__</span><br><span class="line">08049f24 d __JCR_LIST__</span><br><span class="line">0804a014 A __bss_start</span><br><span class="line">0804a00c D __data_start</span><br><span class="line">08048490 t __do_global_ctors_aux</span><br><span class="line">08048360 t __do_global_dtors_aux</span><br><span class="line">0804a010 D __dso_handle</span><br><span class="line">         w __gmon_start__</span><br><span class="line">08048482 T __i686.get_pc_thunk.bx</span><br><span class="line">08049f14 d __init_array_end</span><br><span class="line">08049f14 d __init_array_start</span><br><span class="line">08048480 T __libc_csu_fini</span><br><span class="line">08048410 T __libc_csu_init</span><br><span class="line">         U __libc_start_main@@GLIBC_2.0</span><br><span class="line">0804a014 A _edata</span><br><span class="line">0804a01c A _end</span><br><span class="line">080484bc T _fini</span><br><span class="line">080484d8 R _fp_hw</span><br><span class="line">080482b4 T _init</span><br><span class="line">08048330 T _start</span><br><span class="line">0804a014 b completed.6086</span><br><span class="line">0804a00c W data_start</span><br><span class="line">0804a018 b dtor_idx.6088</span><br><span class="line">080483c0 t frame_dummy</span><br><span class="line">080483e4 T main</span><br><span class="line">         U <span class="built_in">printf</span>@@GLIBC_2.0</span><br></pre></td></tr></table></figure><p>è¿™äº›åŒ…å«å¯æ‰§è¡Œä»£ç çš„æ®µç§°ä¸ºæ­£æ–‡æ®µã€‚åŒæ ·åœ°ï¼Œæ•°æ®æ®µåŒ…å«äº†ä¸å¯æ‰§è¡Œçš„ä¿¡æ¯æˆ–æ•°æ®ã€‚å¦ä¸€ç§ç±»å‹çš„æ®µï¼Œç§°ä¸º BSS æ®µï¼Œå®ƒåŒ…å«ä»¥ç¬¦å·æ•°æ®å¼€å¤´çš„å—ã€‚å¯¹äº nm å‘½ä»¤åˆ—å‡ºçš„æ¯ä¸ªç¬¦å·ï¼Œå®ƒä»¬çš„å€¼ä½¿ç”¨åå…­è¿›åˆ¶æ¥è¡¨ç¤ºï¼ˆç¼ºçœè¡Œä¸ºï¼‰ï¼Œå¹¶ä¸”åœ¨è¯¥ç¬¦å·å‰é¢åŠ ä¸Šäº†ä¸€ä¸ªè¡¨ç¤ºç¬¦å·ç±»å‹çš„ç¼–ç å­—ç¬¦ã€‚</p><p>å¸¸è§çš„å„ç§ç¼–ç åŒ…æ‹¬ï¼š</p><ul><li>A è¡¨ç¤ºç»å¯¹ (absolute)ï¼Œè¿™æ„å‘³ç€ä¸èƒ½å°†è¯¥å€¼æ›´æ”¹ä¸ºå…¶ä»–çš„è¿æ¥ï¼›</li><li>B è¡¨ç¤º BSS æ®µä¸­çš„ç¬¦å·ï¼›</li><li>C è¡¨ç¤ºå¼•ç”¨æœªåˆå§‹åŒ–çš„æ•°æ®çš„ä¸€èˆ¬ç¬¦å·ã€‚</li></ul><p>å¯ä»¥å°†ç›®æ ‡æ–‡ä»¶ä¸­æ‰€åŒ…å«çš„ä¸åŒçš„éƒ¨åˆ†åˆ’åˆ†ä¸ºæ®µã€‚æ®µå¯ä»¥åŒ…å«å¯æ‰§è¡Œä»£ç ã€ç¬¦å·åç§°ã€åˆå§‹æ•°æ®å€¼å’Œè®¸å¤šå…¶ä»–ç±»å‹çš„æ•°æ®ã€‚æœ‰å…³è¿™äº›ç±»å‹çš„æ•°æ®çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯» UNIX ä¸­ nm çš„ man é¡µé¢ï¼Œå…¶ä¸­æŒ‰ç…§è¯¥å‘½ä»¤è¾“å‡ºä¸­çš„å­—ç¬¦ç¼–ç åˆ†åˆ«å¯¹æ¯ç§ç±»å‹è¿›è¡Œäº†æè¿°ã€‚</p><p>åœ¨ç›®æ ‡æ–‡ä»¶é˜¶æ®µï¼Œå³ä½¿æ˜¯ä¸€ä¸ªç®€å•çš„ Hello World ç¨‹åºï¼Œå…¶ä¸­ä¹ŸåŒ…å«äº†å¤§é‡çš„ç»†èŠ‚ä¿¡æ¯ã€‚nm ç¨‹åºå¯ç”¨äºåˆ—ä¸¾ç¬¦å·åŠå…¶ç±»å‹å’Œå€¼ï¼Œä½†æ˜¯ï¼Œè¦æ›´ä»”ç»†åœ°ç ”ç©¶ç›®æ ‡æ–‡ä»¶ä¸­è¿™äº›å‘½åæ®µçš„å†…å®¹ï¼Œéœ€è¦ä½¿ç”¨åŠŸèƒ½æ›´å¼ºå¤§çš„å·¥å…·ã€‚</p><p>å…¶ä¸­ä¸¤ç§åŠŸèƒ½å¼ºå¤§çš„å·¥å…·æ˜¯ objdump å’Œ readelf ç¨‹åºã€‚</p><p>æ³¨è§£</p><p>å…³äºnmå·¥å…·çš„å‚æ•°è¯´æ˜åŠæ›´å¤šç¤ºä¾‹è¯¦è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/nm.html#nm">nm ç›®æ ‡æ–‡ä»¶æ ¼å¼åˆ†æ</a> ;</p><h4 id="objdump-åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#objdump-åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="objdump åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶"></a>objdump åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶</h4><p>ogjdumpå·¥å…·ç”¨æ¥æ˜¾ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå°±æ˜¯ä»¥ä¸€ç§å¯é˜…è¯»çš„æ ¼å¼è®©ä½ æ›´å¤šåœ°äº†è§£äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¸¦æœ‰çš„é™„åŠ ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -d myprogrammer</span><br><span class="line">a.out:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .init:</span><br><span class="line"></span><br><span class="line">080482b4 &lt;_init&gt;:</span><br><span class="line"> 80482b4:   53                      push   %ebx</span><br><span class="line"> 80482b5:   83 ec 08                sub    <span class="variable">$0x8</span>,%esp</span><br><span class="line"> 80482b8:   e8 00 00 00 00          call   80482bd &lt;_init+0x9&gt;</span><br><span class="line"> 80482bd:   5b                      pop    %ebx</span><br><span class="line"> 80482be:   81 c3 37 1d 00 00       add    <span class="variable">$0x1d37</span>,%ebx</span><br><span class="line"> 80482c4:   8b 83 <span class="built_in">fc</span> ff ff ff       mov    -0x4(%ebx),%eax</span><br><span class="line"> 80482ca:   85 c0                   <span class="built_in">test</span>   %eax,%eax</span><br><span class="line"> 80482cc:   74 05                   je     80482d3 &lt;_init+0x1f&gt;</span><br><span class="line"> 80482ce:   e8 3d 00 00 00          call   8048310 &lt;__gmon_start__@plt&gt;</span><br><span class="line"> 80482d3:   e8 e8 00 00 00          call   80483c0 &lt;frame_dummy&gt;</span><br><span class="line"> 80482d8:   e8 b3 01 00 00          call   8048490 &lt;__do_global_ctors_aux&gt;</span><br><span class="line"> 80482dd:   83 c4 08                add    <span class="variable">$0x8</span>,%esp</span><br><span class="line"> 80482e0:   5b                      pop    %ebx</span><br><span class="line"> 80482e1:   c3                      ret</span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªå¯æ‰§è¡Œä»£ç æ®µå°†åœ¨éœ€è¦ç‰¹å®šçš„äº‹ä»¶æ—¶æ‰§è¡Œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬åº“çš„åˆå§‹åŒ–å’Œè¯¥ç¨‹åºæœ¬èº«ä¸»å…¥å£ç‚¹ã€‚</p><p>å¯¹äºé‚£äº›ç€è¿·äºåº•å±‚ç¼–ç¨‹ç»†èŠ‚çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½éå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå¯ç”¨äºç ”ç©¶ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨çš„è¾“å‡ºã€‚ç»†èŠ‚ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™æ®µä»£ç ä¸­æ‰€æ˜¾ç¤ºçš„è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥æ­ç¤ºæœ‰å…³æœ¬åœ°å¤„ç†å™¨æœ¬èº«è¿è¡Œæ–¹å¼çš„å¾ˆå¤šå†…å®¹ã€‚å¯¹è¯¥å¤„ç†å™¨åˆ¶é€ å•†æä¾›çš„æŠ€æœ¯æ–‡æ¡£è¿›è¡Œæ·±å…¥çš„ç ”ç©¶ï¼Œæ‚¨å¯ä»¥æ”¶é›†å…³äºä¸€äº›æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯å¯ä»¥æ·±å…¥åœ°äº†è§£å†…éƒ¨çš„è¿è¡Œæœºåˆ¶ï¼Œå› ä¸ºåŠŸèƒ½ç¨‹åºæä¾›äº†æ¸…æ™°çš„è¾“å‡ºã€‚</p><p>æ³¨è§£</p><p>å…³äºobjdumpå·¥å…·çš„å‚æ•°è¯´æ˜åŠæ›´å¤šç¤ºä¾‹è¯¦è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/objdump.html#objdump">objdump äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æ</a> ;</p><h4 id="readelf-äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æ"><a href="#readelf-äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æ" class="headerlink" title="readelf äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æ"></a>readelf äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æ</h4><p>è¿™ä¸ªå·¥å…·å’Œobjdumpå‘½ä»¤æä¾›çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¾ç¤ºçš„ä¿¡æ¯æ›´ä¸ºå…·ä½“ï¼Œå¹¶ä¸”å®ƒä¸ä¾èµ–BFDåº“(BFDåº“æ˜¯ä¸€ä¸ªGNUé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡å°±æ˜¯å¸Œæœ›é€šè¿‡ä¸€ç§ç»Ÿä¸€çš„æ¥å£æ¥å¤„ç†ä¸åŒçš„ç›®æ ‡æ–‡ä»¶ï¼‰ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -all a.out</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF32</span><br><span class="line">  Data:                              2<span class="string">&#x27;s complement, little endian</span></span><br><span class="line"><span class="string">  Version:                           1 (current)</span></span><br><span class="line"><span class="string">  OS/ABI:                            UNIX - System V</span></span><br><span class="line"><span class="string">  ABI Version:                       0</span></span><br><span class="line"><span class="string">  Type:                              EXEC (Executable file)</span></span><br><span class="line"><span class="string">  Machine:                           Intel 80386</span></span><br><span class="line"><span class="string">  Version:                           0x1</span></span><br><span class="line"><span class="string">  Entry point address:               0x8048330</span></span><br><span class="line"><span class="string">  Start of program headers:          52 (bytes into file)</span></span><br><span class="line"><span class="string">  Start of section headers:          4412 (bytes into file)</span></span><br><span class="line"><span class="string">  Flags:                             0x0</span></span><br><span class="line"><span class="string">  Size of this header:               52 (bytes)</span></span><br><span class="line"><span class="string">  Size of program headers:           32 (bytes)</span></span><br><span class="line"><span class="string">  Number of program headers:         9</span></span><br><span class="line"><span class="string">  Size of section headers:           40 (bytes)</span></span><br><span class="line"><span class="string">  Number of section headers:         30</span></span><br><span class="line"><span class="string">  Section header string table index: 27</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Section Headers:</span></span><br><span class="line"><span class="string">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span></span><br><span class="line"><span class="string">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span></span><br><span class="line"><span class="string">  [ 1] .interp           PROGBITS        08048154 000154 000013 00   A  0   0  1</span></span><br><span class="line"><span class="string">  [ 2] .note.ABI-tag     NOTE            08048168 000168 000020 00   A  0   0  4</span></span><br><span class="line"><span class="string">  [ 3] .note.gnu.build-i NOTE            08048188 000188 000024 00   A  0   0  4</span></span><br><span class="line"><span class="string">  [ 4] .gnu.hash         GNU_HASH        080481ac 0001ac 000020 04   A  5   0  4</span></span><br><span class="line"><span class="string">  [ 5] .dynsym           DYNSYM          080481cc 0001cc 000050 10   A  6   1  4</span></span><br><span class="line"><span class="string">  [ 6] .dynstr           STRTAB          0804821c 00021c 00004c 00   A  0   0  1</span></span><br><span class="line"><span class="string">  [ 7] .gnu.version      VERSYM          08048268 000268 00000a 02   A  5   0  2</span></span><br><span class="line"><span class="string">  [ 8] .gnu.version_r    VERNEED         08048274 000274 000020 00   A  6   1  4</span></span><br><span class="line"><span class="string">  [ 9] .rel.dyn          REL             08048294 000294 000008 08   A  5   0  4</span></span><br><span class="line"><span class="string">  [10] .rel.plt          REL             0804829c 00029c 000018 08   A  5  12  4</span></span><br><span class="line"><span class="string">  [11] .init             PROGBITS        080482b4 0002b4 00002e 00  AX  0   0  4</span></span><br><span class="line"><span class="string">  [12] .plt              PROGBITS        080482f0 0002f0 000040 04  AX  0   0 16</span></span><br><span class="line"><span class="string">  [13] .text             PROGBITS        08048330 000330 00018c 00  AX  0   0 16</span></span><br><span class="line"><span class="string">  [14] .fini             PROGBITS        080484bc 0004bc 00001a 00  AX  0   0  4</span></span><br><span class="line"><span class="string">  [15] .rodata           PROGBITS        080484d8 0004d8 000011 00   A  0   0  4</span></span><br><span class="line"><span class="string">  [16] .eh_frame_hdr     PROGBITS        080484ec 0004ec 000034 00   A  0   0  4</span></span><br><span class="line"><span class="string">  [17] .eh_frame         PROGBITS        08048520 000520 0000c4 00   A  0   0  4</span></span><br><span class="line"><span class="string">  [18] .ctors            PROGBITS        08049f14 000f14 000008 00  WA  0   0  4</span></span><br><span class="line"><span class="string">  [19] .dtors            PROGBITS        08049f1c 000f1c 000008 00  WA  0   0  4</span></span><br><span class="line"><span class="string">  [20] .jcr              PROGBITS        08049f24 000f24 000004 00  WA  0   0  4</span></span><br><span class="line"><span class="string">  [21] .dynamic          DYNAMIC         08049f28 000f28 0000c8 08  WA  6   0  4</span></span><br><span class="line"><span class="string">  [22] .got              PROGBITS        08049ff0 000ff0 000004 04  WA  0   0  4</span></span><br><span class="line"><span class="string">  [23] .got.plt          PROGBITS        08049ff4 000ff4 000018 04  WA  0   0  4</span></span><br><span class="line"><span class="string">  [24] .data             PROGBITS        0804a00c 00100c 000008 00  WA  0   0  4</span></span><br><span class="line"><span class="string">  [25] .bss              NOBITS          0804a014 001014 000008 00  WA  0   0  4</span></span><br><span class="line"><span class="string">  [26] .comment          PROGBITS        00000000 001014 00002a 01  MS  0   0  1</span></span><br><span class="line"><span class="string">  [27] .shstrtab         STRTAB          00000000 00103e 0000fc 00      0   0  1</span></span><br><span class="line"><span class="string">  [28] .symtab           SYMTAB          00000000 0015ec 000410 10     29  45  4</span></span><br><span class="line"><span class="string">  [29] .strtab           STRTAB          00000000 0019fc 0001f9 00      0   0  1</span></span><br><span class="line"><span class="string">  ...</span></span><br></pre></td></tr></table></figure><p>ELF Header ä¸ºè¯¥æ–‡ä»¶ä¸­æ‰€æœ‰æ®µå…¥å£æ˜¾ç¤ºäº†è¯¦ç»†çš„æ‘˜è¦ã€‚åœ¨åˆ—ä¸¾å‡ºè¿™äº› Header ä¸­çš„å†…å®¹ä¹‹å‰ï¼Œæ‚¨å¯ä»¥çœ‹åˆ° Header çš„å…·ä½“æ•°ç›®ã€‚åœ¨ç ”ç©¶ä¸€ä¸ªè¾ƒå¤§çš„ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œè¯¥ä¿¡æ¯å¯èƒ½éå¸¸æœ‰ç”¨ã€‚</p><p>é™¤äº†æ‰€æœ‰è¿™äº›æ®µä¹‹å¤–ï¼Œç¼–è¯‘å™¨å¯ä»¥å°†è°ƒè¯•ä¿¡æ¯æ”¾å…¥åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æ˜¾ç¤ºè¿™äº›ä¿¡æ¯ã€‚è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œä»”ç»†åˆ†æç¼–è¯‘å™¨çš„è¾“å‡ºï¼ˆå‡è®¾æ‚¨æ‰®æ¼”äº†è°ƒè¯•ç¨‹åºçš„è§’è‰²ï¼‰:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ readelf --debug-dump a.out | more</span><br></pre></td></tr></table></figure><p>è°ƒè¯•å·¥å…·ï¼Œå¦‚ GDBï¼Œå¯ä»¥è¯»å–è¿™äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶ä¸”å½“ç¨‹åºåœ¨è°ƒè¯•å™¨ä¸­è¿è¡Œçš„åŒæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å·¥å…·æ˜¾ç¤ºæ›´å…·æè¿°æ€§çš„æ ‡è®°ï¼Œè€Œä¸æ˜¯å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼–æ—¶çš„åŸå§‹åœ°å€å€¼ã€‚</p><p>æ³¨è§£</p><p>å…³äºreadelfå·¥å…·çš„å‚æ•°è¯´æ˜åŠæ›´å¤šç¤ºä¾‹è¯¦è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/readelf.html#readelf">readelf elfæ–‡ä»¶æ ¼å¼åˆ†æ</a> ;</p><h4 id="size-æŸ¥çœ‹ç¨‹åºå†…å­˜å ç”¨"><a href="#size-æŸ¥çœ‹ç¨‹åºå†…å­˜å ç”¨" class="headerlink" title="size æŸ¥çœ‹ç¨‹åºå†…å­˜å ç”¨"></a>size æŸ¥çœ‹ç¨‹åºå†…å­˜å ç”¨</h4><p>sizeè¿™ä¸ªå·¥å…·ç”¨æ¥æŸ¥çœ‹ç¨‹åºè¿è¡Œæ—¶å„ä¸ªæ®µçš„å®é™…å†…å­˜å ç”¨:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ size a.out</span><br><span class="line">text           data     bss     dec     hex filename</span><br><span class="line">1146            256       8    1410     582 a.out</span><br></pre></td></tr></table></figure><h4 id="file-æ–‡ä»¶ç±»å‹æŸ¥è¯¢"><a href="#file-æ–‡ä»¶ç±»å‹æŸ¥è¯¢" class="headerlink" title="file æ–‡ä»¶ç±»å‹æŸ¥è¯¢"></a>file æ–‡ä»¶ç±»å‹æŸ¥è¯¢</h4><p>è¿™ä¸ªå·¥å…·ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„ç±»å‹ï¼›</p><p>æ¯”å¦‚æˆ‘ä»¬åœ¨64ä½æœºå™¨ä¸Šå‘ç°äº†ä¸€ä¸ª32ä½çš„åº“ï¼Œé“¾æ¥ä¸ä¸Šï¼Œè¿™å°±æœ‰é—®é¢˜äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file a.out</span><br><span class="line">a.out: ELF 64-bit LSB executable, AMD x86-64, version 1 (SYSV), <span class="keyword">for</span> GNU/Linux 2.6.9, dynamically linked (uses shared libs), <span class="keyword">for</span> GNU/Linux 2.6.9, not stripped</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŸ¥çœ‹Coreæ–‡ä»¶æ˜¯ç”±å“ªä¸ªç¨‹åºç”Ÿæˆ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ file core.22355</span><br></pre></td></tr></table></figure><h4 id="strings-æŸ¥è¯¢æ•°æ®ä¸­çš„æ–‡æœ¬ä¿¡æ¯"><a href="#strings-æŸ¥è¯¢æ•°æ®ä¸­çš„æ–‡æœ¬ä¿¡æ¯" class="headerlink" title="strings æŸ¥è¯¢æ•°æ®ä¸­çš„æ–‡æœ¬ä¿¡æ¯"></a>strings æŸ¥è¯¢æ•°æ®ä¸­çš„æ–‡æœ¬ä¿¡æ¯</h4><p>ä¸€ä¸ªæ–‡ä»¶ä¸­åŒ…å«äºŒè¿›åˆ¶æ•°æ®å’Œæ–‡æœ¬æ•°æ®ï¼Œå¦‚æœåªéœ€è¦æŸ¥çœ‹å…¶æ–‡æœ¬ä¿¡æ¯ï¼Œä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¾ˆæ–¹ä¾¿ï¼›è¿‡æ»¤æ‰éå­—ç¬¦æ•°æ®ï¼Œå°†æ–‡æœ¬ä¿¡æ¯è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ strings &lt;objfile&gt;</span><br></pre></td></tr></table></figure><h4 id="fuser-æ˜¾ç¤ºæ–‡ä»¶ä½¿ç”¨è€…"><a href="#fuser-æ˜¾ç¤ºæ–‡ä»¶ä½¿ç”¨è€…" class="headerlink" title="fuser æ˜¾ç¤ºæ–‡ä»¶ä½¿ç”¨è€…"></a>fuser æ˜¾ç¤ºæ–‡ä»¶ä½¿ç”¨è€…</h4><p>æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨ä½¿ç”¨ç€æŒ‡å®šçš„file, file system æˆ–è€… socketsçš„è¿›ç¨‹ä¿¡æ¯;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ fuser -m -u redis-server</span><br><span class="line">redis-server: 11552rce(weber) 22912rce(weber) 25501rce(weber)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†<code>-m</code>å’Œ<code>-u</code>é€‰é¡¹ï¼Œç”¨æ¥æŸ¥æ‰¾æ‰€æœ‰æ­£åœ¨ä½¿ç”¨redis-serverçš„æ‰€æœ‰è¿›ç¨‹çš„PIDä»¥åŠè¯¥è¿›ç¨‹çš„OWNERï¼›</p><p>fuseré€šå¸¸è¢«ç”¨åœ¨è¯Šæ–­ç³»ç»Ÿçš„â€resource busyâ€é—®é¢˜ã€‚å¦‚æœä½ å¸Œæœ›killæ‰€æœ‰æ­£åœ¨ä½¿ç”¨æŸä¸€æŒ‡å®šçš„file, file system or socketsçš„è¿›ç¨‹çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨-ké€‰é¡¹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fuser â€“k /path/to/your/filename</span><br></pre></td></tr></table></figure><h4 id="xxd-åå…­è¿›åˆ¶æ˜¾ç¤ºæ•°æ®"><a href="#xxd-åå…­è¿›åˆ¶æ˜¾ç¤ºæ•°æ®" class="headerlink" title="xxd åå…­è¿›åˆ¶æ˜¾ç¤ºæ•°æ®"></a>xxd åå…­è¿›åˆ¶æ˜¾ç¤ºæ•°æ®</h4><p>ä»¥åå…­è¿›åˆ¶æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶ï¼Œåªæ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$xxd</span> a.out</span><br><span class="line">0000000: 7f45 4c46 0101 0100 0000 0000 0000 0000  .ELF............</span><br><span class="line">0000010: 0200 0300 0100 0000 3083 0408 3400 0000  ........0...4...</span><br><span class="line">0000020: 3c11 0000 0000 0000 3400 2000 0900 2800  &lt;.......4. ...(.</span><br><span class="line">0000030: 1e00 1b00 0600 0000 3400 0000 3480 0408  ........4...4...</span><br><span class="line">0000040: 3480 0408 2001 0000 2001 0000 0500 0000  4... ... .......</span><br><span class="line">0000050: 0400 0000 0300 0000 5401 0000 5481 0408  ........T...T...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="od-æŸ¥çœ‹ç‰¹æ®Šæ ¼å¼æ–‡ä»¶å†…å®¹"><a href="#od-æŸ¥çœ‹ç‰¹æ®Šæ ¼å¼æ–‡ä»¶å†…å®¹" class="headerlink" title="od æŸ¥çœ‹ç‰¹æ®Šæ ¼å¼æ–‡ä»¶å†…å®¹"></a>od æŸ¥çœ‹ç‰¹æ®Šæ ¼å¼æ–‡ä»¶å†…å®¹</h4><p>é€šå¸¸ä½¿ç”¨odå‘½ä»¤æŸ¥çœ‹ç‰¹æ®Šæ ¼å¼çš„æ–‡ä»¶å†…å®¹ã€‚é€šè¿‡æŒ‡å®šè¯¥å‘½ä»¤çš„ä¸åŒé€‰é¡¹å¯ä»¥ä»¥åè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶å’ŒASCIIç æ¥æ˜¾ç¤ºæ–‡ä»¶ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><p><code>-A</code> æŒ‡å®šåœ°å€åŸºæ•°ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>d åè¿›åˆ¶</li><li>o å…«è¿›åˆ¶ï¼ˆç³»ç»Ÿé»˜è®¤å€¼ï¼‰</li><li>x åå…­è¿›åˆ¶</li><li>n ä¸æ‰“å°ä½ç§»å€¼</li></ul><p><code>-t</code> æŒ‡å®šæ•°æ®çš„æ˜¾ç¤ºæ ¼å¼ï¼Œä¸»è¦çš„å‚æ•°æœ‰ï¼š</p><ul><li>c ASCIIå­—ç¬¦æˆ–åæ–œæ åºåˆ—</li><li>d æœ‰ç¬¦å·åè¿›åˆ¶æ•°</li><li>f æµ®ç‚¹æ•°</li><li>o å…«è¿›åˆ¶ï¼ˆç³»ç»Ÿé»˜è®¤å€¼ä¸º02ï¼‰</li><li>u æ— ç¬¦å·åè¿›åˆ¶æ•°</li><li>x åå…­è¿›åˆ¶æ•°</li></ul><p>é™¤äº†é€‰é¡¹cä»¥å¤–çš„å…¶ä»–é€‰é¡¹åé¢éƒ½å¯ä»¥è·Ÿä¸€ä¸ªåè¿›åˆ¶æ•°nï¼ŒæŒ‡å®šæ¯ä¸ªæ˜¾ç¤ºå€¼æ‰€åŒ…å«çš„å­—èŠ‚æ•°ã€‚</p><p>è¯´æ˜ï¼šodå‘½ä»¤ç³»ç»Ÿé»˜è®¤çš„æ˜¾ç¤ºæ–¹å¼æ˜¯å…«è¿›åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯è¯¥å‘½ä»¤çš„åç§°ç”±æ¥ï¼ˆOctal Dumpï¼‰ã€‚ä½†è¿™ä¸æ˜¯æœ€æœ‰ç”¨çš„æ˜¾ç¤ºæ–¹å¼ï¼Œç”¨ASCIIç å’Œåå…­è¿›åˆ¶ç»„åˆçš„æ–¹å¼èƒ½æä¾›æ›´æœ‰ä»·å€¼çš„ä¿¡æ¯è¾“å‡ºã€‚</p><p>ä»¥åå…­è¿›åˆ¶å’Œå­—ç¬¦åŒæ—¶æ˜¾ç¤º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ od -Ax -tcx4 a.c</span><br><span class="line">000000   <span class="comment">#   i   n   c   l   u   d   e       &lt;   s   t   d   i   o   .</span></span><br><span class="line">              636e6923        6564756c        74733c20        2e6f6964</span><br><span class="line">000010   h   &gt;  \n  \n   v   o   i   d       m   a   i   n   (   )  \n</span><br><span class="line">              0a0a3e68        64696f76        69616d20        0a29286e</span><br><span class="line">000020   &#123;  \n  \t   i   n   t       i       =       5   ;  \n  \t   p</span><br><span class="line">              69090a7b        6920746e        35203d20        70090a3b</span><br><span class="line">000030   r   i   n   t   f   (   <span class="string">&quot;   h   e   l   l   o   ,   %   d   &quot;</span></span><br><span class="line">              746e6972        68222866        6f6c6c65        2264252c</span><br><span class="line">000040   ,   i   )   ;  \n   &#125;  \n</span><br><span class="line">              3b29692c        000a7d0a</span><br><span class="line">000047</span><br></pre></td></tr></table></figure><p>ä»¥å­—ç¬¦æ–¹å¼æ˜¾ç¤º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ od -c a.c</span><br><span class="line">0000000   <span class="comment">#   i   n   c   l   u   d   e       &lt;   s   t   d   i   o   .</span></span><br><span class="line">0000020   h   &gt;  \n  \n   v   o   i   d       m   a   i   n   (   )  \n</span><br><span class="line">0000040   &#123;  \n  \t   i   n   t       i       =       5   ;  \n  \t   p</span><br><span class="line">0000060   r   i   n   t   f   (   <span class="string">&quot;   h   e   l   l   o   ,   %   d   &quot;</span></span><br><span class="line">0000100   ,   i   )   ;  \n   &#125;  \n</span><br><span class="line">0000107</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®è·µLinuxç¼–ç¨‹ä¹‹å£¹ - æ„å»º</title>
      <link href="/2015/07/16/Linux/Linux%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%A3%B9%20-%20%E6%9E%84%E5%BB%BA%20/"/>
      <url>/2015/07/16/Linux/Linux%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%A3%B9%20-%20%E6%9E%84%E5%BB%BA%20/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬æºä»£ç æä¾›çš„ç¨‹åºå®‰è£…éœ€è¦é€šè¿‡é…ç½®ã€ç¼–è¯‘ã€å®‰è£…ä¸‰ä¸ªæ­¥éª¤ï¼›</p><ol><li>é…ç½®åšçš„å·¥ä½œä¸»è¦æ˜¯æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦æ»¡è¶³è¦å®‰è£…è½¯ä»¶çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠè®¾ç½®ç¨‹åºå®‰è£…æ‰€éœ€è¦çš„åˆå§‹åŒ–ä¿¡æ¯ï¼Œæ¯”å¦‚å®‰è£…è·¯å¾„ï¼Œéœ€è¦å®‰è£…å“ªäº›ç»„ä»¶ï¼›é…ç½®å®Œæˆï¼Œä¼šç”Ÿæˆmakefileæ–‡ä»¶ä¾›ç¬¬äºŒæ­¥makeä½¿ç”¨ï¼›</li><li>ç¼–è¯‘æ˜¯å¯¹æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼›</li><li>å®‰è£…åšçš„å·¥ä½œå°±ç®€å•å¤šäº†ï¼Œå°±æ˜¯å°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°é…ç½®æ—¶è®¾ç½®çš„åˆå§‹è·¯å¾„ä¸‹ï¼›</li></ol><a id="more"></a><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æŸ¥è¯¢å¯ç”¨çš„é…ç½®é€‰é¡¹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>é…ç½®è·¯å¾„:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/snmp</span><br></pre></td></tr></table></figure><p><code>â€“prefix</code>æ˜¯é…ç½®ä½¿ç”¨çš„æœ€å¸¸ç”¨é€‰é¡¹ï¼Œè®¾ç½®ç¨‹åºå®‰è£…çš„è·¯å¾„ï¼›</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>ç¼–è¯‘ä½¿ç”¨makeç¼–è¯‘:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -f myMakefile</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>-f</code>é€‰é¡¹æ˜¾ç¤ºæŒ‡å®šéœ€è¦ç¼–è¯‘çš„makefileï¼›å¦‚æœå¾…ä½¿ç”¨makefileæ–‡ä»¶åœ¨å½“å‰è·¯å¾„ï¼Œä¸”æ–‡ä»¶åä¸ºä»¥ä¸‹å‡ ä¸ªï¼Œåˆ™ä¸ç”¨æ˜¾ç¤ºæŒ‡å®šï¼š</p><p>makefile Makefile</p><h4 id="makefileç¼–å†™çš„è¦ç‚¹"><a href="#makefileç¼–å†™çš„è¦ç‚¹" class="headerlink" title="makefileç¼–å†™çš„è¦ç‚¹"></a>makefileç¼–å†™çš„è¦ç‚¹</h4><ul><li>å¿…é¡»æ»¡è¶³ç¬¬ä¸€æ¡è§„åˆ™ï¼Œæ»¡è¶³ååœæ­¢</li><li>é™¤ç¬¬ä¸€æ¡è§„åˆ™ï¼Œå…¶ä»–æ— é¡ºåº</li></ul><h4 id="makefileä¸­çš„å…¨å±€è‡ªå˜é‡"><a href="#makefileä¸­çš„å…¨å±€è‡ªå˜é‡" class="headerlink" title="makefileä¸­çš„å…¨å±€è‡ªå˜é‡"></a>makefileä¸­çš„å…¨å±€è‡ªå˜é‡</h4><ul><li><code>$@</code>ç›®æ ‡æ–‡ä»¶å</li><li><code>@^</code>æ‰€æœ‰å‰æåï¼Œé™¤å‰¯æœ¬</li><li><code>@ï¼‹</code>æ‰€æœ‰å‰æåï¼Œå«å‰¯æœ¬</li><li><code>@ï¼œ</code>ä¸€ä¸ªå‰æå</li><li><code>@ï¼Ÿ</code>æ‰€æœ‰æ–°äºç›®æ ‡æ–‡ä»¶çš„å‰æå</li><li><code>@*</code>ç›®æ ‡æ–‡ä»¶çš„åŸºåç§°</li></ul><p>è¦ç³»ç»Ÿå­¦ä¹ makefileå¯ä»¥å‚è€ƒ <a href="http://scc.qibebt.cas.cn/docs/linux/base/%B8%FA%CE%D2%D2%BB%C6%F0%D0%B4Makefile-%B3%C2%F0%A9.pdf">è·Ÿæˆ‘ä¸€èµ·å­¦makefile</a></p><h4 id="CMakeå·¥å…·"><a href="#CMakeå·¥å…·" class="headerlink" title="CMakeå·¥å…·"></a>CMakeå·¥å…·</h4><p>CMakeæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å®‰è£…ï¼ˆç¼–è¯‘ï¼‰å·¥å…·ï¼Œå¯ä»¥ç”¨ç®€å•çš„è¯­å¥æ¥æè¿°æ‰€æœ‰å¹³å°çš„å®‰è£…(ç¼–è¯‘è¿‡ç¨‹)ã€‚ä»–èƒ½å¤Ÿè¾“å‡ºå„ç§å„æ ·çš„makefileæˆ–è€…projectæ–‡ä»¶ã€‚ä½¿ç”¨CMakeï¼Œèƒ½å¤Ÿä½¿ç¨‹åºå‘˜ä»å¤æ‚çš„ç¼–è¯‘è¿æ¥è¿‡ç¨‹ä¸­è§£è„±å‡ºæ¥ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªåä¸º CMakeLists.txt çš„æ–‡ä»¶æ¥æè¿°æ„å»ºè¿‡ç¨‹,å¯ä»¥ç”Ÿæˆæ ‡å‡†çš„æ„å»ºæ–‡ä»¶,å¦‚ Unix/Linux çš„ Makefile æˆ–Windows Visual C++ çš„ projects/workspaces ã€‚</p><h4 id="ç¼–è¯‘ä¾èµ–çš„åº“"><a href="#ç¼–è¯‘ä¾èµ–çš„åº“" class="headerlink" title="ç¼–è¯‘ä¾èµ–çš„åº“"></a>ç¼–è¯‘ä¾èµ–çš„åº“</h4><p>makefileç¼–è¯‘è¿‡ç¨‹ä¸­æ‰€ä¾èµ–çš„éæ ‡å‡†åº“å’Œå¤´æ–‡ä»¶è·¯å¾„éœ€è¦æ˜¾ç¤ºæŒ‡æ˜:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPPFLAGS -Iæ ‡è®°éæ ‡å‡†å¤´æ–‡ä»¶å­˜æ”¾è·¯å¾„</span><br><span class="line">LDFLAGS  -Læ ‡è®°éæ ‡å‡†åº“å­˜æ”¾è·¯å¾„</span><br></pre></td></tr></table></figure><p>å¦‚æœCPPFLAGSå’ŒLDFLAGSå·²åœ¨ç”¨æˆ·ç¯å¢ƒå˜é‡ä¸­è®¾ç½®å¹¶ä¸”å¯¼å‡ºï¼ˆä½¿ç”¨exportå…³é”®å­—ï¼‰ï¼Œå°±ä¸ç”¨å†æ˜¾ç¤ºæŒ‡å®šï¼›</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make -f myMakefile LDFLAGS=&#x27;-L/var/xxx/lib -L/opt/mysql/lib&#x27;</span><br><span class="line">    CPPFLAGS=&#x27;-I/usr/local/libcom/<span class="keyword">include</span> -I/usr/local/libpng/<span class="keyword">include</span>&#x27;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<strong>é“¾æ¥å¤šåº“æ—¶ï¼Œå¤šä¸ªåº“ä¹‹é—´å¦‚æœæœ‰ä¾èµ–ï¼Œéœ€è¦æ³¨æ„ä¹¦å†™çš„é¡ºåºï¼Œå³è¾¹æ˜¯å·¦è¾¹çš„å‰æï¼›</strong></p><h4 id="g-ç¼–è¯‘"><a href="#g-ç¼–è¯‘" class="headerlink" title="g++ç¼–è¯‘"></a>g++ç¼–è¯‘</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -o unixApp unixApp.o a.o b.o</span><br></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜ï¼š</p><ul><li><code>-o</code>:æŒ‡æ˜ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶</li><li><code>-g</code>ï¼šæ·»åŠ è°ƒè¯•ä¿¡æ¯</li><li><code>-E</code>: æŸ¥çœ‹ä¸­é—´æ–‡ä»¶</li></ul><p>åº”ç”¨ï¼šæŸ¥è¯¢å®å±•å¼€çš„ä¸­é—´æ–‡ä»¶ï¼š</p><p>åœ¨g++çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼Œæ·»åŠ  <code>-E</code>é€‰é¡¹ï¼Œç„¶åå»æ‰<code>-o</code>é€‰é¡¹ ï¼Œé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å³å¯:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -g -E unixApp.cpp  -I/opt/app/<span class="built_in">source</span> &gt; midfile</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢åº”ç”¨ç¨‹åºéœ€è¦é“¾æ¥çš„åº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ldd myprogrammer</span><br><span class="line">    libstdc++.so.6 =&gt; /usr/lib64/libstdc++.so.6 (0x00000039a7e00000)</span><br><span class="line">    libm.so.6 =&gt; /lib64/libm.so.6 (0x0000003996400000)</span><br><span class="line">    libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00000039a5600000)</span><br><span class="line">    libc.so.6 =&gt; /lib64/libc.so.6 (0x0000003995800000)</span><br><span class="line">    /lib64/ld-linux-x86-64.so.2 (0x0000003995400000)</span><br></pre></td></tr></table></figure><p>æ³¨è§£</p><p>å…³äºlddçš„ä½¿ç”¨ç»†èŠ‚ï¼Œå‚è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/ldd.html#ldd">ldd æŸ¥çœ‹ç¨‹åºä¾èµ–åº“</a></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å®‰è£…å°±æ˜¯å°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°é…ç½®æ—¶è®¾ç½®çš„åˆå§‹è·¯å¾„ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make install</span><br></pre></td></tr></table></figure><p>å…¶å® <strong>install</strong> å°±æ˜¯makefileä¸­çš„ä¸€ä¸ªè§„åˆ™ï¼Œæ‰“å¼€makefileæ–‡ä»¶åå¯ä»¥æŸ¥çœ‹ç¨‹åºå®‰è£…çš„æ‰€åšçš„å·¥ä½œï¼›</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸­çš„wget</title>
      <link href="/2015/06/21/Linux/Linux%E4%B8%AD%E7%9A%84wget/"/>
      <url>/2015/06/21/Linux/Linux%E4%B8%AD%E7%9A%84wget/</url>
      
        <content type="html"><![CDATA[<h2 id="wget-web-get"><a href="#wget-web-get" class="headerlink" title="wget - web get"></a>wget - web get</h2><p>Linuxç³»ç»Ÿä¸­çš„wgetæ˜¯ä¸€ä¸ªä¸‹è½½æ–‡ä»¶çš„å·¥å…·ï¼Œå®ƒç”¨åœ¨å‘½ä»¤è¡Œä¸‹ï¼Œæ˜¯æœ€å¸¸ç”¨çš„CLIå·¥å…·ä¹‹ä¸€ã€‚wgetéå¸¸ç¨³å®šï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæ”¯æŒHTTPï¼ŒHTTPSå’ŒFTPåè®®ï¼Œå¯ä»¥ä½¿ç”¨HTTPä»£ç†ã€‚</p><p>wget å¯ä»¥è·Ÿè¸ªHTMLé¡µé¢ä¸Šçš„é“¾æ¥ä¾æ¬¡ä¸‹è½½æ¥åˆ›å»ºè¿œç¨‹æœåŠ¡å™¨çš„æœ¬åœ°ç‰ˆæœ¬ï¼Œå®Œå…¨é‡å»ºåŸå§‹ç«™ç‚¹çš„ç›®å½•ç»“æ„ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºç½‘ç»œçˆ¬è™«å·¥å…·ã€‚</p><a id="more"></a><h2 id="å‘½ä»¤æ ¼å¼"><a href="#å‘½ä»¤æ ¼å¼" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h2><p>wget  å‚æ•°  URL </p><h2 id="å‘½ä»¤å‚æ•°ï¼š"><a href="#å‘½ä»¤å‚æ•°ï¼š" class="headerlink" title="å‘½ä»¤å‚æ•°ï¼š"></a>å‘½ä»¤å‚æ•°ï¼š</h2><h3 id="å¯åŠ¨å‚æ•°ï¼š"><a href="#å¯åŠ¨å‚æ•°ï¼š" class="headerlink" title="å¯åŠ¨å‚æ•°ï¼š"></a>å¯åŠ¨å‚æ•°ï¼š</h3><ul><li>-V, â€“version æ˜¾ç¤ºwgetçš„ç‰ˆæœ¬åé€€å‡º</li><li>-h, â€“help æ‰“å°è¯­æ³•å¸®åŠ©</li><li>-b, â€“background å¯åŠ¨åè½¬å…¥åå°æ‰§è¡Œ</li><li>-e, â€“execute=COMMAND æ‰§è¡Œâ€™.wgetrcâ€™æ ¼å¼çš„å‘½ä»¤ï¼Œwgetrcæ ¼å¼å‚è§/etc/wgetrcæˆ–~/.wgetrc</li></ul><h3 id="è®°å½•å’Œè¾“å…¥æ–‡ä»¶å‚æ•°"><a href="#è®°å½•å’Œè¾“å…¥æ–‡ä»¶å‚æ•°" class="headerlink" title="è®°å½•å’Œè¾“å…¥æ–‡ä»¶å‚æ•°"></a>è®°å½•å’Œè¾“å…¥æ–‡ä»¶å‚æ•°</h3><ul><li>-o, â€“output-file=FILE æŠŠè®°å½•å†™åˆ°FILEæ–‡ä»¶ä¸­</li><li>-a, â€“append-output=FILE æŠŠè®°å½•è¿½åŠ åˆ°FILEæ–‡ä»¶ä¸­</li><li>-d, â€“debug æ‰“å°è°ƒè¯•è¾“å‡º</li><li>-q, â€“quiet å®‰é™æ¨¡å¼(æ²¡æœ‰è¾“å‡º)</li><li>-v, â€“verbose å†—é•¿æ¨¡å¼(è¿™æ˜¯ç¼ºçœè®¾ç½®)</li><li>-nv, â€“non-verbose å…³æ‰å†—é•¿æ¨¡å¼ï¼Œä½†ä¸æ˜¯å®‰é™æ¨¡å¼</li><li>-i, â€“input-file=FILE ä¸‹è½½åœ¨FILEæ–‡ä»¶ä¸­å‡ºç°çš„URLs</li><li>-F, â€“force-html æŠŠè¾“å…¥æ–‡ä»¶å½“ä½œHTMLæ ¼å¼æ–‡ä»¶å¯¹å¾…</li><li>-B, â€“base=URL å°†URLä½œä¸ºåœ¨-F -iå‚æ•°æŒ‡å®šçš„æ–‡ä»¶ä¸­å‡ºç°çš„ç›¸å¯¹é“¾æ¥çš„å‰ç¼€</li></ul><p>â€“sslcertfile=FILE å¯é€‰å®¢æˆ·ç«¯è¯ä¹¦ â€“sslcertkey=KEYFILE å¯é€‰å®¢æˆ·ç«¯è¯ä¹¦çš„KEYFILE â€“egd-file=FILE æŒ‡å®šEGD socketçš„æ–‡ä»¶å</p><h3 id="ä¸‹è½½å‚æ•°"><a href="#ä¸‹è½½å‚æ•°" class="headerlink" title="ä¸‹è½½å‚æ•°"></a>ä¸‹è½½å‚æ•°</h3><ul><li>-bind-address=ADDRESS æŒ‡å®šæœ¬åœ°ä½¿ç”¨åœ°å€(ä¸»æœºåæˆ–IPï¼Œå½“æœ¬åœ°æœ‰å¤šä¸ªIPæˆ–åå­—æ—¶ä½¿ç”¨)</li><li>-t, â€“tries=NUMBER è®¾å®šæœ€å¤§å°è¯•é“¾æ¥æ¬¡æ•°(0 è¡¨ç¤ºæ— é™åˆ¶).</li><li>-O â€“output-document=FILE æŠŠæ–‡æ¡£å†™åˆ°FILEæ–‡ä»¶ä¸­</li><li>-nc, â€“no-clobber ä¸è¦è¦†ç›–å­˜åœ¨çš„æ–‡ä»¶æˆ–ä½¿ç”¨.#å‰ç¼€</li><li>-c, â€“continue æ¥ç€ä¸‹è½½æ²¡ä¸‹è½½å®Œçš„æ–‡ä»¶</li><li>-progress=TYPE è®¾å®šè¿›ç¨‹æ¡æ ‡è®°</li><li>-N, â€“timestamping ä¸è¦é‡æ–°ä¸‹è½½æ–‡ä»¶é™¤éæ¯”æœ¬åœ°æ–‡ä»¶æ–°</li><li>-S, â€“server-response æ‰“å°æœåŠ¡å™¨çš„å›åº”</li><li>-T, â€“timeout=SECONDS è®¾å®šå“åº”è¶…æ—¶çš„ç§’æ•°</li><li>-w, â€“wait=SECONDS ä¸¤æ¬¡å°è¯•ä¹‹é—´é—´éš”SECONDSç§’</li><li>-waitretry=SECONDS åœ¨é‡æ–°é“¾æ¥ä¹‹é—´ç­‰å¾…1â€¦SECONDSç§’</li><li>-random-wait åœ¨ä¸‹è½½ä¹‹é—´ç­‰å¾…0â€¦2*WAITç§’</li><li>-Y, -proxy=on/off æ‰“å¼€æˆ–å…³é—­ä»£ç†</li><li>-Q, -quota=NUMBER è®¾ç½®ä¸‹è½½çš„å®¹é‡é™åˆ¶</li><li>-limit-rate=RATE é™å®šä¸‹è½½è¾“ç‡</li></ul><h3 id="ç›®å½•å‚æ•°"><a href="#ç›®å½•å‚æ•°" class="headerlink" title="ç›®å½•å‚æ•°"></a>ç›®å½•å‚æ•°</h3><ul><li>-nd â€“no-directories ä¸åˆ›å»ºç›®å½•</li><li>-x, â€“force-directories å¼ºåˆ¶åˆ›å»ºç›®å½•</li><li>-nH, â€“no-host-directories ä¸åˆ›å»ºä¸»æœºç›®å½•</li><li>-P, â€“directory-prefix=PREFIX å°†æ–‡ä»¶ä¿å­˜åˆ°ç›®å½• PREFIX/â€¦</li><li>-cut-dirs=NUMBER å¿½ç•¥ NUMBERå±‚è¿œç¨‹ç›®å½•</li></ul><h3 id="HTTP-é€‰é¡¹å‚æ•°"><a href="#HTTP-é€‰é¡¹å‚æ•°" class="headerlink" title="HTTP é€‰é¡¹å‚æ•°"></a>HTTP é€‰é¡¹å‚æ•°</h3><ul><li>-http-user=USER è®¾å®šHTTPç”¨æˆ·åä¸º USER.</li><li>-http-passwd=PASS è®¾å®šhttpå¯†ç ä¸º PASS</li><li>-C, â€“cache=on/off å…è®¸/ä¸å…è®¸æœåŠ¡å™¨ç«¯çš„æ•°æ®ç¼“å­˜ (ä¸€èˆ¬æƒ…å†µä¸‹å…è®¸)</li><li>-E, â€“html-extension å°†æ‰€æœ‰text/htmlæ–‡æ¡£ä»¥.htmlæ‰©å±•åä¿å­˜</li><li>-ignore-length å¿½ç•¥ â€˜Content-Lengthâ€™å¤´åŸŸ</li><li>-header=STRING åœ¨headersä¸­æ’å…¥å­—ç¬¦ä¸² STRING</li><li>-proxy-user=USER è®¾å®šä»£ç†çš„ç”¨æˆ·åä¸º USER</li><li>proxy-passwd=PASS è®¾å®šä»£ç†çš„å¯†ç ä¸º PASS</li><li>referer=URL åœ¨HTTPè¯·æ±‚ä¸­åŒ…å« â€˜Referer: URLâ€™å¤´</li><li>-s, â€“save-headers ä¿å­˜HTTPå¤´åˆ°æ–‡ä»¶</li><li>-U, â€“user-agent=AGENT è®¾å®šä»£ç†çš„åç§°ä¸º AGENTè€Œä¸æ˜¯ Wget/VERSION</li><li>no-http-keep-alive å…³é—­ HTTPæ´»åŠ¨é“¾æ¥ (æ°¸è¿œé“¾æ¥)</li><li>cookies=off ä¸ä½¿ç”¨ cookies</li><li>load-cookies=FILE åœ¨å¼€å§‹ä¼šè¯å‰ä»æ–‡ä»¶ FILEä¸­åŠ è½½cookie</li><li>save-cookies=FILE åœ¨ä¼šè¯ç»“æŸåå°† cookiesä¿å­˜åˆ° FILEæ–‡ä»¶ä¸­</li></ul><h3 id="FTP-é€‰é¡¹å‚æ•°"><a href="#FTP-é€‰é¡¹å‚æ•°" class="headerlink" title="FTP é€‰é¡¹å‚æ•°"></a>FTP é€‰é¡¹å‚æ•°</h3><ul><li>-nr, â€“dont-remove-listing ä¸ç§»èµ° â€˜.listingâ€™æ–‡ä»¶</li><li>-g, â€“glob=on/off æ‰“å¼€æˆ–å…³é—­æ–‡ä»¶åçš„ globbingæœºåˆ¶</li><li>passive-ftp ä½¿ç”¨è¢«åŠ¨ä¼ è¾“æ¨¡å¼ (ç¼ºçœå€¼).</li><li>active-ftp ä½¿ç”¨ä¸»åŠ¨ä¼ è¾“æ¨¡å¼</li><li>retr-symlinks åœ¨é€’å½’çš„æ—¶å€™ï¼Œå°†é“¾æ¥æŒ‡å‘æ–‡ä»¶(è€Œä¸æ˜¯ç›®å½•)</li></ul><h3 id="é€’å½’ä¸‹è½½å‚æ•°"><a href="#é€’å½’ä¸‹è½½å‚æ•°" class="headerlink" title="é€’å½’ä¸‹è½½å‚æ•°"></a>é€’å½’ä¸‹è½½å‚æ•°</h3><ul><li><p>-r, â€“recursive é€’å½’ä¸‹è½½ï¼ï¼æ…ç”¨!</p></li><li><p>-l, â€“level=NUMBER æœ€å¤§é€’å½’æ·±åº¦ (inf æˆ– 0 ä»£è¡¨æ— ç©·)</p></li><li><p>-delete-after åœ¨ç°åœ¨å®Œæ¯•åå±€éƒ¨åˆ é™¤æ–‡ä»¶</p></li><li><p>-k, â€“convert-links è½¬æ¢éç›¸å¯¹é“¾æ¥ä¸ºç›¸å¯¹é“¾æ¥</p></li><li><p>-K, â€“backup-converted åœ¨è½¬æ¢æ–‡ä»¶Xä¹‹å‰ï¼Œå°†ä¹‹å¤‡ä»½ä¸º X.orig</p></li><li><p>-m, â€“mirror ç­‰ä»·äº -r -N -l inf -nr</p></li><li><p>-p, â€“page-requisites ä¸‹è½½æ˜¾ç¤ºHTMLæ–‡ä»¶çš„æ‰€æœ‰å›¾ç‰‡</p><p>â€‹    é€’å½’ä¸‹è½½ä¸­çš„åŒ…å«å’Œä¸åŒ…å«(accept/reject)ï¼š</p></li><li><p>-A, â€“accept=LIST åˆ†å·åˆ†éš”çš„è¢«æ¥å—æ‰©å±•åçš„åˆ—è¡¨</p></li><li><p>-R, â€“reject=LIST åˆ†å·åˆ†éš”çš„ä¸è¢«æ¥å—çš„æ‰©å±•åçš„åˆ—è¡¨</p></li><li><p>-D, â€“domains=LIST åˆ†å·åˆ†éš”çš„è¢«æ¥å—åŸŸçš„åˆ—è¡¨</p></li><li><p>-exclude-domains=LIST åˆ†å·åˆ†éš”çš„ä¸è¢«æ¥å—çš„åŸŸçš„åˆ—è¡¨</p></li><li><p>-follow-ftp è·Ÿè¸ªHTMLæ–‡æ¡£ä¸­çš„FTPé“¾æ¥</p></li><li><p>-follow-tags=LIST åˆ†å·åˆ†éš”çš„è¢«è·Ÿè¸ªçš„HTMLæ ‡ç­¾çš„åˆ—è¡¨</p></li><li><p>-G, â€“ignore-tags=LIST åˆ†å·åˆ†éš”çš„è¢«å¿½ç•¥çš„HTMLæ ‡ç­¾çš„åˆ—è¡¨</p></li><li><p>-H, â€“span-hosts å½“é€’å½’æ—¶è½¬åˆ°å¤–éƒ¨ä¸»æœº</p></li><li><p>-L, â€“relative ä»…ä»…è·Ÿè¸ªç›¸å¯¹é“¾æ¥</p></li><li><p>-I, â€“include-directories=LIST å…è®¸ç›®å½•çš„åˆ—è¡¨</p></li><li><p>-X, â€“exclude-directories=LIST ä¸è¢«åŒ…å«ç›®å½•çš„åˆ—è¡¨</p></li><li><p>-np, â€“no-parent ä¸è¦è¿½æº¯åˆ°çˆ¶ç›®å½•</p></li></ul><p>wget -S â€“spider url ä¸ä¸‹è½½åªæ˜¾ç¤ºè¿‡ç¨‹</p><h2 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h2><h3 id="å®ä¾‹1ï¼šä½¿ç”¨wgetä¸‹è½½å•ä¸ªæ–‡ä»¶"><a href="#å®ä¾‹1ï¼šä½¿ç”¨wgetä¸‹è½½å•ä¸ªæ–‡ä»¶" class="headerlink" title="å®ä¾‹1ï¼šä½¿ç”¨wgetä¸‹è½½å•ä¸ªæ–‡ä»¶"></a>å®ä¾‹1ï¼šä½¿ç”¨wgetä¸‹è½½å•ä¸ªæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> http://www.xxx.com/wordpress-3.1-zh_CN.zip</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šä»¥ä¸Šä¾‹å­ä»ç½‘ç»œä¸‹è½½ä¸€ä¸ªæ–‡ä»¶å¹¶ä¿å­˜åœ¨å½“å‰ç›®å½•ï¼Œåœ¨ä¸‹è½½çš„è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºè¿›åº¦æ¡ï¼ŒåŒ…å«ï¼ˆä¸‹è½½å®Œæˆç™¾åˆ†æ¯”ï¼Œå·²ç»ä¸‹è½½çš„å­—èŠ‚ï¼Œå½“å‰ä¸‹è½½é€Ÿåº¦ï¼Œå‰©ä½™ä¸‹è½½æ—¶é—´ï¼‰ã€‚</p><h3 id="å®ä¾‹2ï¼šä½¿ç”¨wget-Oä¸‹è½½å¹¶ä»¥ä¸åŒçš„æ–‡ä»¶åä¿å­˜"><a href="#å®ä¾‹2ï¼šä½¿ç”¨wget-Oä¸‹è½½å¹¶ä»¥ä¸åŒçš„æ–‡ä»¶åä¿å­˜" class="headerlink" title="å®ä¾‹2ï¼šä½¿ç”¨wget -Oä¸‹è½½å¹¶ä»¥ä¸åŒçš„æ–‡ä»¶åä¿å­˜"></a>å®ä¾‹2ï¼šä½¿ç”¨wget -Oä¸‹è½½å¹¶ä»¥ä¸åŒçš„æ–‡ä»¶åä¿å­˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> -O wordpress.zip http://www.xxx.com/download.aspx?id=1080</span><br></pre></td></tr></table></figure><p>wgeté»˜è®¤ä¼šä»¥æœ€åä¸€ä¸ªç¬¦åˆâ€/â€çš„åé¢çš„å­—ç¬¦æ¥å‘½ä»¤ï¼Œå¯¹äºåŠ¨æ€é“¾æ¥çš„ä¸‹è½½é€šå¸¸æ–‡ä»¶åä¼šä¸æ­£ç¡®ã€‚</p><h3 id="å®ä¾‹3ï¼šä½¿ç”¨wget-â€“limit-rateé™é€Ÿä¸‹è½½"><a href="#å®ä¾‹3ï¼šä½¿ç”¨wget-â€“limit-rateé™é€Ÿä¸‹è½½" class="headerlink" title="å®ä¾‹3ï¼šä½¿ç”¨wget â€“limit -rateé™é€Ÿä¸‹è½½"></a>å®ä¾‹3ï¼šä½¿ç”¨wget â€“limit -rateé™é€Ÿä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> --<span class="built_in">limit</span>-rate=300k http://www.xxx.com/wordpress-3.1-zh_CN.zip</span><br></pre></td></tr></table></figure><p>å½“ä½ æ‰§è¡Œwgetçš„æ—¶å€™ï¼Œå®ƒé»˜è®¤ä¼šå ç”¨å…¨éƒ¨å¯èƒ½çš„å®½å¸¦ä¸‹è½½ã€‚ä½†æ˜¯å½“ä½ å‡†å¤‡ä¸‹è½½ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œè€Œä½ è¿˜éœ€è¦ä¸‹è½½å…¶å®ƒæ–‡ä»¶æ—¶å°±æœ‰å¿…è¦é™é€Ÿäº†ã€‚</p><h3 id="å®ä¾‹4ï¼šä½¿ç”¨wget-cæ–­ç‚¹ç»­ä¼ "><a href="#å®ä¾‹4ï¼šä½¿ç”¨wget-cæ–­ç‚¹ç»­ä¼ " class="headerlink" title="å®ä¾‹4ï¼šä½¿ç”¨wget -cæ–­ç‚¹ç»­ä¼ "></a>å®ä¾‹4ï¼šä½¿ç”¨wget -cæ–­ç‚¹ç»­ä¼ </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> -c http://www.xxx.com/wordpress-3.1-zh_CN.zip</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨wget -cé‡æ–°å¯åŠ¨ä¸‹è½½ä¸­æ–­çš„æ–‡ä»¶ï¼Œå¯¹äºæˆ‘ä»¬ä¸‹è½½å¤§æ–‡ä»¶æ—¶çªç„¶ç”±äºç½‘ç»œç­‰åŸå› ä¸­æ–­éå¸¸æœ‰å¸®åŠ©ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¥ç€ä¸‹è½½è€Œä¸æ˜¯é‡æ–°ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ã€‚éœ€è¦ç»§ç»­ä¸­æ–­çš„ä¸‹è½½æ—¶å¯ä»¥ä½¿ç”¨-cå‚æ•°ã€‚</p><h3 id="å®ä¾‹5ï¼šä½¿ç”¨wget-båå°ä¸‹è½½"><a href="#å®ä¾‹5ï¼šä½¿ç”¨wget-båå°ä¸‹è½½" class="headerlink" title="å®ä¾‹5ï¼šä½¿ç”¨wget -båå°ä¸‹è½½"></a>å®ä¾‹5ï¼šä½¿ç”¨wget -båå°ä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> -b http://www.xxx.com/wordpress-3.1-zh_CN.zip</span><br><span class="line">Continuing <span class="keyword">in</span> background, pid 1840.</span><br><span class="line">Output will be written to <span class="string">&#x27;wget-log&#x27;</span>.</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸‹è½½éå¸¸å¤§çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°-bè¿›è¡Œåå°ä¸‹è½½ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯Ÿçœ‹ä¸‹è½½è¿›åº¦:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tail</span> -f wget-log</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹6ï¼šä¼ªè£…ä»£ç†åç§°ä¸‹è½½"><a href="#å®ä¾‹6ï¼šä¼ªè£…ä»£ç†åç§°ä¸‹è½½" class="headerlink" title="å®ä¾‹6ï¼šä¼ªè£…ä»£ç†åç§°ä¸‹è½½"></a>å®ä¾‹6ï¼šä¼ªè£…ä»£ç†åç§°ä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> --user-agent=<span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3497.81 Safari/537.36&quot;</span> http://www.xxx.com/wordpress-3.1-zh_CN.zip</span><br></pre></td></tr></table></figure><p>æœ‰äº›ç½‘ç«™èƒ½é€šè¿‡æ ¹æ®åˆ¤æ–­ä»£ç†åç§°ä¸æ˜¯æµè§ˆå™¨è€Œæ‹’ç»ä½ çš„ä¸‹è½½è¯·æ±‚ã€‚ä¸è¿‡ä½ å¯ä»¥é€šè¿‡â€“user-agentå‚æ•°ä¼ªè£…ã€‚</p><h3 id="å®ä¾‹7ï¼šä½¿ç”¨wget-iä¸‹è½½å¤šä¸ªæ–‡ä»¶"><a href="#å®ä¾‹7ï¼šä½¿ç”¨wget-iä¸‹è½½å¤šä¸ªæ–‡ä»¶" class="headerlink" title="å®ä¾‹7ï¼šä½¿ç”¨wget -iä¸‹è½½å¤šä¸ªæ–‡ä»¶"></a>å®ä¾‹7ï¼šä½¿ç”¨wget -iä¸‹è½½å¤šä¸ªæ–‡ä»¶</h3><p>é¦–å…ˆï¼Œä¿å­˜ä¸€ä»½ä¸‹è½½é“¾æ¥æ–‡ä»¶,æ¥ç€ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å’Œå‚æ•°-iä¸‹è½½:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> &gt; filelist.txt</span><br><span class="line">url1</span><br><span class="line">url2</span><br><span class="line">url3</span><br><span class="line">url4</span><br><span class="line"></span><br><span class="line"><span class="variable">$wget</span> -i filelist.txt</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹8ï¼šä½¿ç”¨wget-â€“mirroré•œåƒç½‘ç«™"><a href="#å®ä¾‹8ï¼šä½¿ç”¨wget-â€“mirroré•œåƒç½‘ç«™" class="headerlink" title="å®ä¾‹8ï¼šä½¿ç”¨wget â€“mirroré•œåƒç½‘ç«™"></a>å®ä¾‹8ï¼šä½¿ç”¨wget â€“mirroré•œåƒç½‘ç«™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> --mirror -p --convert-links -P ./LOCAL URL</span><br><span class="line"><span class="comment"># é•œåƒä¸‹è½½ ä¸‹è½½æ‰€æœ‰ä¸ºäº†htmlé¡µé¢ä¾èµ–æ–‡ä»¶ ä¸‹è½½åï¼Œè½¬æ¢æˆæœ¬åœ°çš„é“¾æ¥ ä¿å­˜æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•åˆ°æœ¬åœ°æŒ‡å®šç›®å½•</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> -c -r -np -k -L -p www.xxx.org/pub/path/</span><br><span class="line"><span class="comment">#æ–­ç‚¹ç»­ä¼  é€’å½’ä¸‹è½½ ä¸æœç´¢ä¸Šå±‚ç›®å½• å°†ç»å¯¹é“¾æ¥è½¬ä¸ºç›¸å¯¹é“¾æ¥ é€’å½’æ—¶ä¸è¿›å…¥å…¶å®ƒä¸»æœº ä¸‹è½½ç½‘é¡µæ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹9-ä½¿ç”¨wget-r-Aä¸‹è½½æŒ‡å®šæ ¼å¼æ–‡ä»¶"><a href="#å®ä¾‹9-ä½¿ç”¨wget-r-Aä¸‹è½½æŒ‡å®šæ ¼å¼æ–‡ä»¶" class="headerlink" title="å®ä¾‹9: ä½¿ç”¨wget -r -Aä¸‹è½½æŒ‡å®šæ ¼å¼æ–‡ä»¶"></a>å®ä¾‹9: ä½¿ç”¨wget -r -Aä¸‹è½½æŒ‡å®šæ ¼å¼æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> -r -A.pdf url</span><br></pre></td></tr></table></figure><ul><li><p>å¯ä»¥åœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨è¯¥åŠŸèƒ½ï¼š</p><p>ä¸‹è½½ä¸€ä¸ªç½‘ç«™çš„æ‰€æœ‰å›¾ç‰‡ä¸‹è½½ä¸€ä¸ªç½‘ç«™çš„æ‰€æœ‰è§†é¢‘ä¸‹è½½ä¸€ä¸ªç½‘ç«™çš„æ‰€æœ‰PDFæ–‡ä»¶</p></li></ul><h3 id="å®ä¾‹10ï¼šä½¿ç”¨wget-FTPä¸‹è½½"><a href="#å®ä¾‹10ï¼šä½¿ç”¨wget-FTPä¸‹è½½" class="headerlink" title="å®ä¾‹10ï¼šä½¿ç”¨wget FTPä¸‹è½½"></a>å®ä¾‹10ï¼šä½¿ç”¨wget FTPä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> ftp-url</span><br><span class="line"><span class="variable">$wget</span> --ftp-user=USERNAME --ftp-password=PASSWORD url</span><br></pre></td></tr></table></figure><ul><li><p>å¯ä»¥ä½¿ç”¨wgetæ¥å®Œæˆftpé“¾æ¥çš„ä¸‹è½½</p><p>ä½¿ç”¨wgetåŒ¿åftpä¸‹è½½ï¼šwget ftp-urlä½¿ç”¨wgetç”¨æˆ·åå’Œå¯†ç è®¤è¯çš„ftpä¸‹è½½:wget â€“ftp-user=USERNAME â€“ftp-password=PASSWORD url</p></li></ul><h2 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h2><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¯‘å®‰è£…:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf wget-1.9.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> wget-1.9.1</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxåŠ¨æ€åº“ç¼–è¯‘æŒ‡å—</title>
      <link href="/2015/06/18/Linux/Linux%E5%8A%A8%E6%80%81%E5%BA%93%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97/"/>
      <url>/2015/06/18/Linux/Linux%E5%8A%A8%E6%80%81%E5%BA%93%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>Linuxä¸‹åŠ¨æ€åº“æ–‡ä»¶çš„æ–‡ä»¶åå½¢å¦‚ <code>libxxx.so</code>ï¼Œå…¶ä¸­soæ˜¯ Shared Object çš„ç¼©å†™ï¼Œå³å¯ä»¥å…±äº«çš„ç›®æ ‡æ–‡ä»¶ã€‚</p><p>åœ¨é“¾æ¥åŠ¨æ€åº“ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå¹¶ä¸ä¼šæŠŠåŠ¨æ€åº“çš„ä»£ç å¤åˆ¶åˆ°æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œæ–‡ä»¶ä¸­è®°å½•å¯¹åŠ¨æ€åº“çš„å¼•ç”¨ã€‚</p><p>ç¨‹åºæ‰§è¡Œæ—¶ï¼Œå†å»åŠ è½½åŠ¨æ€åº“æ–‡ä»¶ã€‚å¦‚æœåŠ¨æ€åº“å·²ç»åŠ è½½ï¼Œåˆ™ä¸å¿…é‡å¤åŠ è½½ï¼Œä»è€Œèƒ½èŠ‚çœå†…å­˜ç©ºé—´ã€‚</p><p>Linuxä¸‹ç”Ÿæˆå’Œä½¿ç”¨åŠ¨æ€åº“çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ç¼–å†™æºæ–‡ä»¶ã€‚</li><li>å°†ä¸€ä¸ªæˆ–å‡ ä¸ªæºæ–‡ä»¶ç¼–è¯‘é“¾æ¥ï¼Œç”Ÿæˆå…±äº«åº“ã€‚</li><li>é€šè¿‡ <code>-L&lt;path&gt; -lxxx</code> çš„gccé€‰é¡¹é“¾æ¥ç”Ÿæˆçš„libxxx.soã€‚</li><li>æŠŠlibxxx.soæ”¾å…¥é“¾æ¥åº“çš„æ ‡å‡†è·¯å¾„ï¼Œæˆ–æŒ‡å®š <code>LD_LIBRARY_PATH</code>ï¼Œæ‰èƒ½è¿è¡Œé“¾æ¥äº†libxxx.soçš„ç¨‹åºã€‚</li></ol><a id="more"></a><h2 id="æºæ–‡ä»¶"><a href="#æºæ–‡ä»¶" class="headerlink" title="æºæ–‡ä»¶"></a>æºæ–‡ä»¶</h2><p>æ ·ä¾‹ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//max.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> n1, <span class="keyword">int</span> n2, <span class="keyword">int</span> n3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> max_num = n1;</span><br><span class="line">    max_num = max_num &lt; n2? n2: max_num;</span><br><span class="line">    max_num = max_num &lt; n3? n3: max_num;</span><br><span class="line">    <span class="keyword">return</span> max_num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…±äº«åº“"><a href="#å…±äº«åº“" class="headerlink" title="å…±äº«åº“"></a>å…±äº«åº“</h2><p>ç¼–è¯‘ç”Ÿæˆå…±äº«åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -fPIC -shared -o libmax.so max.c</span><br></pre></td></tr></table></figure><p> <code>-fPIC</code>æ˜¯ç¼–è¯‘é€‰é¡¹ï¼ŒPICæ˜¯ Position Independent Code çš„ç¼©å†™ï¼Œè¡¨ç¤ºè¦ç”Ÿæˆä½ç½®æ— å…³çš„ä»£ç ï¼Œè¿™æ˜¯åŠ¨æ€åº“éœ€è¦çš„ç‰¹æ€§ï¼› </p><p><code>-shared</code>æ˜¯é“¾æ¥é€‰é¡¹ï¼Œå‘Šè¯‰gccç”ŸæˆåŠ¨æ€åº“è€Œä¸æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><h2 id="ç¼–å†™å¤´æ–‡ä»¶"><a href="#ç¼–å†™å¤´æ–‡ä»¶" class="headerlink" title="ç¼–å†™å¤´æ–‡ä»¶"></a>ç¼–å†™å¤´æ–‡ä»¶</h2><p>ä¸ºäº†è®©ç”¨æˆ·çŸ¥é“æˆ‘ä»¬çš„åŠ¨æ€åº“ä¸­æœ‰å“ªäº›æ¥å£å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™å¯¹åº”çš„å¤´æ–‡ä»¶ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//max.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MAX_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MAX_H__</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> n1, <span class="keyword">int</span> n2, <span class="keyword">int</span> n3)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç¨‹åºtest.cå¼•ç”¨ç¼–è¯‘å¥½çš„libmax.so</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;max.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>, b = <span class="number">-2</span>, c = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;max among 10, -2 and 100 is %d.\n&quot;</span>, max(a, b, c));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc test.c -L. -lmax -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure></p><p><code>-lmax</code>è¡¨ç¤ºè¦é“¾æ¥<code>libmax.so</code></p><p><code>-L.</code>è¡¨ç¤ºæœç´¢è¦é“¾æ¥çš„åº“æ–‡ä»¶æ—¶åŒ…å«å½“å‰è·¯å¾„</p><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./<span class="built_in">test</span></span><br><span class="line">max among 10, -2 and 100 is 100.</span><br></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨åŒ–ç¼–è¯‘"><a href="#è‡ªåŠ¨åŒ–ç¼–è¯‘" class="headerlink" title="è‡ªåŠ¨åŒ–ç¼–è¯‘"></a>è‡ªåŠ¨åŒ–ç¼–è¯‘</h2><p>åˆ©ç”¨makeæ¥è¿›è¡Œè‡ªåŠ¨åŒ–ç¼–è¯‘</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: build test clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">build: libmax.so</span></span><br><span class="line"></span><br><span class="line"><span class="section">libmax.so: max.o</span></span><br><span class="line">gcc -o <span class="variable">$@</span>  -shared <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">max.o: max.c</span></span><br><span class="line">gcc -c -fPIC <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: test.c libmax.so</span></span><br><span class="line">gcc test.c -L. -lmax -o test</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">rm -f *.o *.so a.out</span><br></pre></td></tr></table></figure><p>ç”¨æ³•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ make build <span class="comment"># ç¼–è¯‘åŠ¨æ€åº“ libmax.so</span></span><br><span class="line">$ make <span class="built_in">test</span> <span class="comment"># ç”Ÿæˆtestå¯æ‰§è¡Œç¨‹åº</span></span><br><span class="line">$ make clean <span class="comment"># æ¸…ç†ç¼–è¯‘å’Œæµ‹è¯•ç»“æœ</span></span><br></pre></td></tr></table></figure></p><h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><p>ä¾‹ç¨‹è§æˆ‘çš„<a href="https://github.com/maywzh/Lab_dylibcompiler">Github</a></p><p>ç›¸å…³åšæ–‡ <a href="/Linuxé™æ€åº“ç¼–è¯‘æŒ‡å—/">Linuxé™æ€åº“ç¼–è¯‘æŒ‡å—</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ç¼–è¯‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨ç½‘ç»œå·¥å…·</title>
      <link href="/2015/05/12/Linux/Linux%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/"/>
      <url>/2015/05/12/Linux/Linux%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘ç»œå·¥å…·"><a href="#ç½‘ç»œå·¥å…·" class="headerlink" title="ç½‘ç»œå·¥å…·"></a>ç½‘ç»œå·¥å…·</h2><p>Linuxä¸­æä¾›äº†å¼ºå¤§çš„ç½‘ç»œå·¥å…·åŒ…ï¼Œç”¨äºç›‘æµ‹ç³»ç»Ÿä¸­çš„ç½‘ç»œé€šä¿¡çŠ¶æ€ã€‚</p><a id="more"></a><h2 id="æŸ¥è¯¢ç½‘ç»œæœåŠ¡å’Œç«¯å£"><a href="#æŸ¥è¯¢ç½‘ç»œæœåŠ¡å’Œç«¯å£" class="headerlink" title="æŸ¥è¯¢ç½‘ç»œæœåŠ¡å’Œç«¯å£"></a>æŸ¥è¯¢ç½‘ç»œæœåŠ¡å’Œç«¯å£</h2><p>netstat å‘½ä»¤ç”¨äºæ˜¾ç¤ºå„ç§ç½‘ç»œç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç½‘ç»œè¿æ¥ï¼Œè·¯ç”±è¡¨ï¼Œæ¥å£çŠ¶æ€ (Interface Statistics)ï¼Œmasquerade è¿æ¥ï¼Œå¤šæ’­æˆå‘˜ (Multicast Memberships) ç­‰ç­‰ã€‚</p><p>åˆ—å‡ºæ‰€æœ‰ç«¯å£ (åŒ…æ‹¬ç›‘å¬å’Œæœªç›‘å¬çš„):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$netstat</span> -a</span><br></pre></td></tr></table></figure><p>åˆ—å‡ºæ‰€æœ‰ tcp ç«¯å£:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$netstat</span> -at</span><br></pre></td></tr></table></figure><p>åˆ—å‡ºæ‰€æœ‰æœ‰ç›‘å¬çš„æœåŠ¡çŠ¶æ€:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$netstat</span> -l</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨netstatå·¥å…·æŸ¥è¯¢ç«¯å£:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$netstat</span> -antp | grep 6379</span><br><span class="line">tcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      25501/redis-server</span><br><span class="line"></span><br><span class="line"><span class="variable">$ps</span> 25501</span><br><span class="line">  PID TTY      STAT   TIME COMMAND</span><br><span class="line">25501 ?        Ssl   28:21 ./redis-server ./redis.conf</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€"><a href="#æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€"></a>æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€</h2><p>lsofï¼ˆlist open filesï¼‰æ˜¯ä¸€ä¸ªåˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶çš„å·¥å…·ã€‚åœ¨linuxç¯å¢ƒä¸‹ï¼Œä»»ä½•äº‹ç‰©éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡æ–‡ä»¶ä¸ä»…ä»…å¯ä»¥è®¿é—®å¸¸è§„æ•°æ®ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œè¿æ¥å’Œç¡¬ä»¶ã€‚æ‰€ä»¥å¦‚ä¼ è¾“æ§åˆ¶åè®® (TCP) å’Œç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) å¥—æ¥å­—ç­‰ï¼› åœ¨æŸ¥è¯¢ç½‘ç»œç«¯å£æ—¶ï¼Œç»å¸¸ä¼šç”¨åˆ°è¿™ä¸ªå·¥å…·ã€‚</p><p>æŸ¥è¯¢7902ç«¯å£ç°åœ¨è¿è¡Œä»€ä¹ˆç¨‹åº:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ†ä¸ºä¸¤æ­¥</span></span><br><span class="line"><span class="comment">#ç¬¬ä¸€æ­¥ï¼ŒæŸ¥è¯¢ä½¿ç”¨è¯¥ç«¯å£çš„è¿›ç¨‹çš„PIDï¼›</span></span><br><span class="line">    <span class="variable">$lsof</span> -i:7902</span><br><span class="line">    COMMAND   PID   USER   FD   TYPE    DEVICE SIZE NODE NAME</span><br><span class="line">    WSL     30294 tuapp    4u  IPv4 447684086       TCP 10.6.50.37:tnos-dp (LISTEN)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥åˆ°30294</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨pså·¥å…·æŸ¥è¯¢è¿›ç¨‹è¯¦æƒ…ï¼š</span></span><br><span class="line"><span class="variable">$ps</span> -ef | grep 30294</span><br><span class="line">tdev5  30294 26160  0 Sep10 ?        01:10:50 tdesl -k 43476</span><br><span class="line">root     22781 22698  0 00:54 pts/20   00:00:00 grep 11554</span><br></pre></td></tr></table></figure><p>æ³¨è§£</p><p>ä»¥ä¸Šä»‹ç»lsofå…³äºç½‘ç»œæ–¹é¢çš„åº”ç”¨ï¼Œè¿™ä¸ªå·¥å…·éå¸¸å¼ºå¤§ï¼Œéœ€è¦å¥½å¥½æŒæ¡ï¼Œè¯¦è§ <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/lsof.html#lsof">lsof ä¸€åˆ‡çš†æ–‡ä»¶</a> ;</p><h2 id="ç½‘ç»œè·¯ç”±"><a href="#ç½‘ç»œè·¯ç”±" class="headerlink" title="ç½‘ç»œè·¯ç”±"></a>ç½‘ç»œè·¯ç”±</h2><p>æŸ¥çœ‹è·¯ç”±çŠ¶æ€:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$route</span> -n</span><br></pre></td></tr></table></figure><p>å‘é€pingåŒ…åˆ°åœ°å€IP:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ping</span> IP</span><br></pre></td></tr></table></figure><p>æ¢æµ‹å‰å¾€åœ°å€IPçš„è·¯ç”±è·¯å¾„:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$traceroute</span> IP</span><br></pre></td></tr></table></figure><p>DNSæŸ¥è¯¢ï¼Œå¯»æ‰¾åŸŸådomainå¯¹åº”çš„IP:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$host</span> domain</span><br></pre></td></tr></table></figure><p>åå‘DNSæŸ¥è¯¢:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$host</span> IP</span><br></pre></td></tr></table></figure><h2 id="é•œåƒä¸‹è½½"><a href="#é•œåƒä¸‹è½½" class="headerlink" title="é•œåƒä¸‹è½½"></a>é•œåƒä¸‹è½½</h2><p>ç›´æ¥ä¸‹è½½æ–‡ä»¶æˆ–è€…ç½‘é¡µ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> url</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹:</p><ul><li>â€“limit-rate :ä¸‹è½½é™é€Ÿ</li><li>-oï¼šæŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼›è¾“å‡ºéƒ½å†™å…¥æ—¥å¿—ï¼›</li><li>-cï¼šæ–­ç‚¹ç»­ä¼ </li></ul><h2 id="ftp-sftp-lftp-ssh"><a href="#ftp-sftp-lftp-ssh" class="headerlink" title="ftp sftp lftp ssh"></a>ftp sftp lftp ssh</h2><p>SSHç™»é™†:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ssh</span> ID@host</span><br></pre></td></tr></table></figure><p>sshç™»é™†è¿œç¨‹æœåŠ¡å™¨hostï¼ŒIDä¸ºç”¨æˆ·åã€‚</p><p>ftp/sftpæ–‡ä»¶ä¼ è¾“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sftp</span> ID@host</span><br></pre></td></tr></table></figure><p>ç™»é™†æœåŠ¡å™¨hostï¼ŒIDä¸ºç”¨æˆ·åã€‚sftpç™»é™†åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›ä¸€æ­¥æ“ä½œï¼š</p><ul><li>get filename # ä¸‹è½½æ–‡ä»¶</li><li>put filename # ä¸Šä¼ æ–‡ä»¶</li><li>ls # åˆ—å‡ºhostä¸Šå½“å‰è·¯å¾„çš„æ‰€æœ‰æ–‡ä»¶</li><li>cd # åœ¨hostä¸Šæ›´æ”¹å½“å‰è·¯å¾„</li><li>lls # åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šå½“å‰è·¯å¾„çš„æ‰€æœ‰æ–‡ä»¶</li><li>lcd # åœ¨æœ¬åœ°ä¸»æœºæ›´æ”¹å½“å‰è·¯å¾„</li></ul><p>lftpåŒæ­¥æ–‡ä»¶å¤¹(ç±»ä¼¼rsyncå·¥å…·):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lftp -u user:pass host</span><br><span class="line">lftp user@host:~&gt; mirror -n</span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œå¤åˆ¶"><a href="#ç½‘ç»œå¤åˆ¶" class="headerlink" title="ç½‘ç»œå¤åˆ¶"></a>ç½‘ç»œå¤åˆ¶</h2><p>å°†æœ¬åœ°localpathæŒ‡å‘çš„æ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹ä¸»æœºçš„pathè·¯å¾„:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$scp</span> localpath ID@host:path</span><br></pre></td></tr></table></figure><p>ä»¥sshåè®®ï¼Œéå†ä¸‹è½½pathè·¯å¾„ä¸‹çš„æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œåˆ°æœ¬åœ°çš„localpath:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$scp</span> -r ID@site:path localpath</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç†è§£Linuxæƒé™ç³»ç»Ÿ</title>
      <link href="/2015/04/09/Linux/Linux%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F/"/>
      <url>/2015/04/09/Linux/Linux%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨å¤„ç†æœåŠ¡å™¨ä¸Šçš„issueï¼Œä¸­é—´é‡åˆ°æœ€å¤šçš„çš„å°±æ˜¯<code>Permission denied</code>é—®é¢˜ï¼Œè¿™å°±æ˜¯æƒé™é—®é¢˜ã€‚ä»Šå¤©å°±æ¥æ•´ç†ä¸€ä¸‹Linuxæ–‡ä»¶æƒé™ç³»ç»Ÿçš„çŸ¥è¯†ï¼Œä»æ ¹æœ¬ä¸Šå¡«æ‰è¿™ä¸ªå‘ã€‚</p><h2 id="Linux-æ–‡ä»¶æƒé™"><a href="#Linux-æ–‡ä»¶æƒé™" class="headerlink" title="Linux æ–‡ä»¶æƒé™"></a>Linux æ–‡ä»¶æƒé™</h2><p><strong>Linuxä¸­ï¼Œç›®å½•å’Œæ–‡ä»¶éƒ½è¢«è§†ä¸ºæ–‡ä»¶ã€‚</strong>Linuxä¸­æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å…¶å±æ€§ä¸æƒé™ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ls</code>å‘½ä»¤æ¥æŸ¥çœ‹</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls -al</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ–‡ä»¶çš„æœ€å‰é¢éƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶ç±»å‹å’Œæƒé™æè¿°ã€‚åé¢åˆ†åˆ«æ˜¯æ–‡ä»¶é“¾æ¥æ•°ï¼Œæ–‡ä»¶æ‹¥æœ‰è€…ï¼Œæ–‡ä»¶ç”¨æˆ·ç»„ï¼Œæ–‡ä»¶æœ€åä¿®æ”¹æ—¥æœŸå’Œåç§°ã€‚<code>.</code> ä»£è¡¨å½“å‰ç›®å½• <code>..</code> ä»£è¡¨ä¸Šä¸€çº§ç›®å½•ã€‚</p><h3 id="ç¬¬ä¸€æ ï¼š-æ–‡ä»¶ç±»å‹å’Œæƒé™"><a href="#ç¬¬ä¸€æ ï¼š-æ–‡ä»¶ç±»å‹å’Œæƒé™" class="headerlink" title="ç¬¬ä¸€æ ï¼š æ–‡ä»¶ç±»å‹å’Œæƒé™"></a>ç¬¬ä¸€æ ï¼š æ–‡ä»¶ç±»å‹å’Œæƒé™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> maywzh@M-Ubuntu î‚° /bin î‚° ls -al</span><br><span class="line">total 13412</span><br><span class="line">drwxr-xr-x  2 root root    4096 Sep 24 19:19 .</span><br><span class="line">drwxr-xr-x 24 root root    4096 Oct  4 06:12 ..</span><br><span class="line">-rwxr-xr-x  1 root root 1113504 Apr  5 02:30 bash</span><br><span class="line">-rwxr-xr-x  1 root root  748968 Aug 29 15:57 brltty</span><br><span class="line">-rwxr-xr-x  1 root root   34888 Jan 30  2017 bunzip2</span><br><span class="line">-rwxr-xr-x  1 root root 2022480 Dec 13  2017 busybox</span><br><span class="line">-rwxr-xr-x  1 root root   34888 Jan 30  2017 bzcat</span><br><span class="line">lrwxrwxrwx  1 root root       6 Sep 13 18:35 bzcmp -&gt; bzdiff</span><br><span class="line">-rwxr-xr-x  1 root root    2140 Jan 30  2017 bzdiff</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹ç¬¬ä¸€æ çš„ç±»å‹æƒé™æè¿°ç¬¦ï¼Œæ€»å…±æœ‰10ä¸ªå­—ç¬¦ã€‚</p><ul><li><p>ç¬¬ä¸€ä¸ªå­—ç¬¦ä»£è¡¨æ–‡ä»¶çš„ç±»å‹: ç›®å½•ã€æ–‡ä»¶ã€é“¾æ¥æ–‡ä»¶ã€è®¾å¤‡ç­‰ç­‰ã€‚</p><ul><li>å½“ä¸º[ d ]åˆ™æ˜¯ç›®å½•ï¼Œä¾‹å¦‚<a href="https://wizardforcel.gitbooks.io/vbird-linux-basic-4e/Text/index.html#table2.1.1">ä¸Šè¡¨</a>æ–‡ä»¶åä¸ºâ€œ.configâ€çš„é‚£ä¸€è¡Œï¼›</li><li>å½“ä¸º[ - ]åˆ™æ˜¯æ–‡ä»¶ï¼Œä¾‹å¦‚<a href="https://wizardforcel.gitbooks.io/vbird-linux-basic-4e/Text/index.html#table2.1.1">ä¸Šè¡¨</a>æ–‡ä»¶åä¸ºâ€œinitial-setup-ks.cfgâ€é‚£ä¸€è¡Œï¼›</li><li>è‹¥æ˜¯[ l ]åˆ™è¡¨ç¤ºä¸ºé“¾æ¥æ–‡ä»¶ï¼ˆlink fileï¼‰ï¼›</li><li>è‹¥æ˜¯[ b ]åˆ™è¡¨ç¤ºä¸ºè®¾å¤‡æ–‡ä»¶é‡Œé¢çš„å¯ä¾›å‚¨å­˜çš„å‘¨è¾¹è®¾å¤‡ï¼ˆå¯éšæœºå­˜å–è®¾å¤‡ï¼‰ï¼›</li><li>è‹¥æ˜¯[ c ]åˆ™è¡¨ç¤ºä¸ºè®¾å¤‡æ–‡ä»¶é‡Œé¢çš„åºåˆ—åŸ è®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡ï¼ˆä¸€æ¬¡æ€§è¯»å–è®¾å¤‡ï¼‰ã€‚</li></ul></li><li><p>æ¥ä¸‹æ¥çš„å­—ç¬¦ï¼Œä¸‰ä¸ªä¸ºä¸€ç»„ï¼Œåˆ†ä¸ºä¸‰ç»„ã€‚ä¸º<code>[r/-][w/-][x/-]</code>çš„ç»„åˆã€‚<code>[ r ]</code>ä»£è¡¨å¯è¯»ï¼ˆreadï¼‰ã€<code>[ w ]</code>ä»£è¡¨å¯å†™ï¼ˆwriteï¼‰ã€<code>[ x ]</code>ä»£è¡¨å¯æ‰§è¡Œï¼ˆexecuteï¼‰ã€‚ è¿™ä¸‰ä¸ªæƒé™çš„ä½ç½®ä¸ä¼šæ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œå°±ä¼šå‡ºç°å‡å·<code>[ - ]</code>ã€‚</p><ul><li>ç¬¬ä¸€ç»„ä¸ºâ€œæ–‡ä»¶æ‹¥æœ‰è€…æƒé™â€ï¼Œä¾‹å¦‚ä¸Šé¢çš„<code>bash</code>çš„æ–‡ä»¶æ‹¥æœ‰è€…ä¸º<code>root</code>ã€‚</li><li>ç¬¬äºŒç»„ä¸ºâ€œæœ¬ç¾¤ç»„è´¦å·æƒé™â€ï¼Œä¾‹å¦‚ä¸Šé¢çš„<code>bash</code>çš„æ–‡ä»¶ç¾¤ç»„ä¸º<code>root</code>ã€‚</li><li>ç¬¬ä¸‰ç»„ä¸ºâ€œéæœ¬äººéæœ¬ç¾¤ç»„å…¶ä»–å¸å·çš„æƒé™â€ã€‚</li></ul></li><li><p><strong>ä¹Ÿå¯ä»¥ç”¨ä¸‰ä¸ªæ•°å­—æ¥ä»£è¡¨æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ç»„çš„æƒé™ç»„åˆå†™æˆä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—ï¼Œ1ä»£è¡¨æœ‰æƒé™ï¼Œ0ä»£è¡¨æ— æƒé™ã€‚</strong></p><p><strong>ä¾‹å¦‚ <code>r-x</code>-&gt;<code>101</code>ï¼Œå†æŠŠè¿™ä¸ª101äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºåè¿›åˆ¶çš„5ï¼Œè¿™æ ·æˆ‘ä»¬ç”¨ä¸‰ä¸ªåè¿›åˆ¶æ•°å³å¯ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶çš„æƒé™é…ç½®ã€‚ä¾‹å¦‚ rw-r-xrâ€”å°±å¯ä»¥å†™æˆ<code>654</code>ã€‚</strong></p><h4 id=""><a href="#" class="headerlink" title=" "></a> </h4></li></ul><h3 id="ç¬¬äºŒæ ï¼š-æ–‡ä»¶åé“¾æ¥æ•°"><a href="#ç¬¬äºŒæ ï¼š-æ–‡ä»¶åé“¾æ¥æ•°" class="headerlink" title="ç¬¬äºŒæ ï¼š æ–‡ä»¶åé“¾æ¥æ•°"></a>ç¬¬äºŒæ ï¼š æ–‡ä»¶åé“¾æ¥æ•°</h3><p>æ¯ä¸ªæ–‡ä»¶çš„å…ƒä¿¡æ¯å®é™…ä¸Šæ˜¯è®°å½•åœ¨i-nodeä¸­çš„ï¼Œæ–‡ä»¶ååªæ˜¯åˆ«åè€Œå·²ã€‚ç›®å½•æ ‘å´ä½¿ç”¨æ–‡ä»¶åæ¥è®°å½•ã€‚æ¯ä¸ªæ–‡ä»¶åéƒ½ä¼šè¿æ¥åˆ°ä¸€ä¸ªi-nodeï¼Œä½†æ¯ä¸ªi-nodeå´å¯ä»¥é“¾æ¥ä¸æ­¢ä¸€ä¸ªæ–‡ä»¶åã€‚</p><p>è¿™ä¸€æ è®°å½•çš„å°±æ˜¯å¯¹åº”çš„i-nodeè¿æ¥åˆ°äº†å¤šå°‘ä¸ªä¸åŒçš„æ–‡ä»¶åã€‚</p><h3 id="ç¬¬ä¸‰ã€å››æ ï¼š-æ–‡ä»¶æ‹¥æœ‰è€…å’Œç¾¤ç»„"><a href="#ç¬¬ä¸‰ã€å››æ ï¼š-æ–‡ä»¶æ‹¥æœ‰è€…å’Œç¾¤ç»„" class="headerlink" title="ç¬¬ä¸‰ã€å››æ ï¼š æ–‡ä»¶æ‹¥æœ‰è€…å’Œç¾¤ç»„"></a>ç¬¬ä¸‰ã€å››æ ï¼š æ–‡ä»¶æ‹¥æœ‰è€…å’Œç¾¤ç»„</h3><h3 id="ç¬¬äº”æ ï¼šæ–‡ä»¶å®¹é‡å¤§å°"><a href="#ç¬¬äº”æ ï¼šæ–‡ä»¶å®¹é‡å¤§å°" class="headerlink" title="ç¬¬äº”æ ï¼šæ–‡ä»¶å®¹é‡å¤§å°"></a>ç¬¬äº”æ ï¼šæ–‡ä»¶å®¹é‡å¤§å°</h3><p>é»˜è®¤å•ä½ä¸ºByte</p><h3 id="ç¬¬å…­æ ï¼šæ–‡ä»¶åˆ›å»ºæ—¥æœŸæˆ–æœ€æ–°ä¿®æ”¹æ—¥æœŸ"><a href="#ç¬¬å…­æ ï¼šæ–‡ä»¶åˆ›å»ºæ—¥æœŸæˆ–æœ€æ–°ä¿®æ”¹æ—¥æœŸ" class="headerlink" title="ç¬¬å…­æ ï¼šæ–‡ä»¶åˆ›å»ºæ—¥æœŸæˆ–æœ€æ–°ä¿®æ”¹æ—¥æœŸ"></a>ç¬¬å…­æ ï¼šæ–‡ä»¶åˆ›å»ºæ—¥æœŸæˆ–æœ€æ–°ä¿®æ”¹æ—¥æœŸ</h3><h3 id="ç¬¬ä¸ƒæ ï¼šæ–‡ä»¶å"><a href="#ç¬¬ä¸ƒæ ï¼šæ–‡ä»¶å" class="headerlink" title="ç¬¬ä¸ƒæ ï¼šæ–‡ä»¶å"></a>ç¬¬ä¸ƒæ ï¼šæ–‡ä»¶å</h3><p>å¦‚æœæ–‡ä»¶åå‰é¢å¤šä¸€ä¸ª<code>.</code>åˆ™ä»£è¡¨è¯¥æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ã€‚å¯ç”¨<code>ls -a</code>æ¥æ˜¾ç¤ºéšè—æ–‡ä»¶</p><h2 id="æ”¹å˜æ–‡ä»¶å±æ€§ä¸æƒé™"><a href="#æ”¹å˜æ–‡ä»¶å±æ€§ä¸æƒé™" class="headerlink" title="æ”¹å˜æ–‡ä»¶å±æ€§ä¸æƒé™"></a>æ”¹å˜æ–‡ä»¶å±æ€§ä¸æƒé™</h2><h3 id="æ”¹å˜æ–‡ä»¶çš„æƒé™-chmodå‘½ä»¤"><a href="#æ”¹å˜æ–‡ä»¶çš„æƒé™-chmodå‘½ä»¤" class="headerlink" title="æ”¹å˜æ–‡ä»¶çš„æƒé™ - chmodå‘½ä»¤"></a>æ”¹å˜æ–‡ä»¶çš„æƒé™ - <code>chmod</code>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#u-user g-group o-others a-all +æ·»åŠ  -å»é™¤ =è®¾å®š </span></span><br><span class="line">chmod u+x,g+w file <span class="comment">#ä¸ºfileçš„æ‹¥æœ‰è€…åŠ ä¸Šå¯æ‰§è¡Œçš„æƒé™ï¼Œç¾¤ç»„åŠ ä¸Šå¯å†™çš„æƒé™</span></span><br><span class="line">chmod u=rwx,g=rw,o=r file <span class="comment">#è®¾ç½®fileçš„æ‹¥æœ‰è€…å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç¾¤ç»„å¯è¯»å¯å†™ï¼Œå…¶ä»–äººå¯è¯»</span></span><br><span class="line">chmod u=764 file <span class="comment">#è®¾ç½®fileçš„æ‹¥æœ‰è€…å¯è¯»å¯å†™å¯æ‰§è¡Œ(7=rwx),ç¾¤ç»„å¯è¯»å¯æ –(6=rw-)ï¼Œå…¶ä»–äººå¯è¯»(4=r--)</span></span><br><span class="line">chmod a+x <span class="comment">#è®¾ç½®u g o éƒ½å¯ä»¥æ‰§è¡Œ</span></span><br><span class="line">chmod o-r <span class="comment">#å»é™¤å…¶ä»–äººçš„è¯»æƒé™</span></span><br></pre></td></tr></table></figure><h3 id="æ”¹å˜æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œç¾¤ç»„-chownå‘½ä»¤"><a href="#æ”¹å˜æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œç¾¤ç»„-chownå‘½ä»¤" class="headerlink" title="æ”¹å˜æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œç¾¤ç»„ - chownå‘½ä»¤"></a>æ”¹å˜æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œç¾¤ç»„ - <code>chown</code>å‘½ä»¤</h3><p>ç”¨æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chown user1 file <span class="comment"># æŠŠfileçš„æ‹¥æœ‰è€…è®¾å®šä¸ºuser1 </span></span><br><span class="line">chown -R user1 dir <span class="comment"># æŠŠdirç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä»¥åŠæ¬¡ç›®å½•æ–‡ä»¶çš„æ‹¥æœ‰è€…éƒ½è®¾ç½®ä¸ºuser1</span></span><br><span class="line">chown -R user1:group1 file <span class="comment"># æŠŠfileçš„æ‹¥æœ‰è€…è®¾å®šä¸ºuser1 ç¾¤ç»„è®¾ç½®ä¸ºgroup1</span></span><br></pre></td></tr></table></figure><p>è¢«æ”¹å˜çš„ç”¨æˆ·å¿…é¡»åœ¨ç”¨æˆ·è´¦æˆ·é…ç½®æ–‡ä»¶<code>/etc/passed</code>ä¸­å­˜åœ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[maywzh@M-Ubuntu] ~$ cat /etc/passwd</span><br><span class="line">scin:x:4:534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:34:games:/usr/games:/usr/sbin/nologin</span><br></pre></td></tr></table></figure><p><code>/etc/passwd</code>çš„æ¯ä¸ªç”¨æˆ·ç»„ä¸€æ¡è®°å½•å æ®ä¸€è¡Œï¼Œè®°å½•æ ¼å¼<code>ç”¨æˆ·å:å£ä»¤:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:æ³¨é‡Šæ€§æè¿°:ä¸»ç›®å½•:ç™»å½•Shell</code></p><ul><li><p>ç”¨æˆ·å(login_name)ï¼šæ˜¯ä»£è¡¨ç”¨æˆ·è´¦å·çš„å­—ç¬¦ä¸²</p></li><li><p>å£ä»¤(passwd)ï¼šè¿™ä¸ªå­—æ®µå­˜æ”¾æ˜¯ç”¨æˆ·å£ä»¤çš„åŠ å¯†ä¸²ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œç›®å‰è®¸å¤šLinuxç³»ç»Ÿï¼ˆå¦‚SVR4ï¼‰éƒ½ä½¿ç”¨äº†shadowæŠ€æœ¯ï¼ŒæŠŠçœŸæ­£çš„åŠ å¯†åçš„ç”¨æˆ·å£ä»¤å­—å­˜æ”¾åˆ°<code>/etc/shadow</code>æ–‡ä»¶ä¸­ï¼Œè€Œåœ¨<code>/etc/passwd</code>æ–‡ä»¶çš„å£ä»¤å­—æ®µä¸­åªå­˜æ”¾ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ï¼Œä¾‹å¦‚â€œxâ€æˆ–è€…â€œ*â€ã€‚</p></li><li><p>ç”¨æˆ·æ ‡è¯†å·(UID)ï¼šç³»ç»Ÿå†…éƒ¨ç”¨å®ƒæ¥æ ‡è¯†ç”¨æˆ·ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å®ƒä¸ç”¨æˆ·åæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚å¦‚æœå‡ ä¸ªç”¨æˆ·åå¯¹åº”çš„ç”¨æˆ·æ ‡è¯†å·æ˜¯ä¸€æ ·çš„ï¼Œç³»ç»Ÿå†…éƒ¨å°†æŠŠå®ƒä»¬è§†ä¸ºåŒä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥æœ‰ä¸åŒçš„å£ä»¤ã€ä¸åŒçš„ä¸»ç›®å½•ä»¥åŠä¸åŒçš„ç™»å½•Shellç­‰ã€‚å–å€¼èŒƒå›´æ˜¯0-65535ã€‚0æ˜¯è¶…çº§ç”¨æˆ·rootçš„æ ‡è¯†å·ï¼Œ1-99ç”±ç³»ç»Ÿä¿ç•™ï¼Œä½œä¸ºç®¡ç†è´¦å·ï¼Œæ™®é€šç”¨æˆ·çš„æ ‡è¯†å·ä»100å¼€å§‹ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªç•Œé™æ˜¯500ã€‚</p></li><li><p>ç»„æ ‡è¯†å·(GID)ï¼šå­—æ®µè®°å½•çš„æ˜¯ç”¨æˆ·æ‰€å±çš„ç”¨æˆ·ç»„ã€‚å®ƒå¯¹åº”ç€/etc/groupæ–‡ä»¶ä¸­çš„ä¸€æ¡è®°å½•ã€‚</p></li><li><p>æ³¨é‡Šæ€§æè¿°(users)ï¼šå­—æ®µè®°å½•ç€ç”¨æˆ·çš„ä¸€äº›ä¸ªäººæƒ…å†µã€‚</p></li><li><p>ä¸»ç›®å½•(home_directory)ï¼šä¹Ÿå°±æ˜¯ç”¨æˆ·çš„èµ·å§‹å·¥ä½œç›®å½•ï¼Œå®ƒæ˜¯ç”¨æˆ·åœ¨ç™»å½•åˆ°ç³»ç»Ÿä¹‹åæ‰€å¤„çš„ç›®å½•ã€‚åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œå„ç”¨æˆ·çš„ä¸»ç›®å½•éƒ½è¢«ç»„ç»‡åœ¨åŒä¸€ä¸ªç‰¹å®šçš„ç›®å½•ä¸‹ï¼Œè€Œç”¨æˆ·ä¸»ç›®å½•çš„åç§°å°±æ˜¯è¯¥ç”¨æˆ·çš„ç™»å½•åã€‚å„ç”¨æˆ·å¯¹è‡ªå·±çš„ä¸»ç›®å½•æœ‰è¯»ã€å†™ã€æ‰§è¡Œï¼ˆæœç´¢ï¼‰æƒé™ï¼Œå…¶ä»–ç”¨æˆ·å¯¹æ­¤ç›®å½•çš„è®¿é—®æƒé™åˆ™æ ¹æ®å…·ä½“æƒ…å†µè®¾ç½®ã€‚</p></li><li><p>ç™»å½•Shell(Shell)ï¼šç”¨æˆ·ç™»å½•åï¼Œè¦å¯åŠ¨ä¸€ä¸ªShellè¿›ç¨‹ï¼Œè´Ÿè´£å°†ç”¨æˆ·çš„æ“ä½œä¼ ç»™å†…æ ¸ï¼Œå¸¸è§æœ‰sh,bash,zshç­‰ã€‚ä¸æŒ‡å®šShellï¼Œé‚£ä¹ˆç³»ç»Ÿä½¿ç”¨/bin/shã€‚ç”¨æˆ·çš„ç™»å½•Shellå¯ä»¥æŒ‡å®šä¸ºæŸä¸ªç‰¹å®šçš„ç¨‹åºã€‚åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶ç”¨æˆ·åªèƒ½è¿è¡ŒæŒ‡å®šçš„åº”ç”¨ç¨‹åºï¼Œåœ¨è¯¥åº”ç”¨ç¨‹åºè¿è¡Œç»“æŸåï¼Œç”¨æˆ·å°±è‡ªåŠ¨é€€å‡ºäº†ç³»ç»Ÿã€‚æœ‰äº›Linuxç³»ç»Ÿè¦æ±‚åªæœ‰é‚£äº›åœ¨ç³»ç»Ÿä¸­ç™»è®°äº†çš„ç¨‹åºæ‰èƒ½å‡ºç°åœ¨è¿™ä¸ªå­—æ®µä¸­ã€‚ä¾‹å¦‚å¯ä»¥ä¸ºgitåªé…ç½®gitç¨‹åºçš„æƒé™ã€‚</p></li></ul><h3 id="æ”¹å˜æ–‡ä»¶æ‰€å±ç¾¤ç»„-chgrpå‘½ä»¤"><a href="#æ”¹å˜æ–‡ä»¶æ‰€å±ç¾¤ç»„-chgrpå‘½ä»¤" class="headerlink" title="æ”¹å˜æ–‡ä»¶æ‰€å±ç¾¤ç»„ - chgrpå‘½ä»¤"></a>æ”¹å˜æ–‡ä»¶æ‰€å±ç¾¤ç»„ - chgrpå‘½ä»¤</h3><p>ç”¨æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chgrp group1 file <span class="comment"># æŠŠfileçš„ç¾¤ç»„è®¾å®šä¸ºgroup1</span></span><br><span class="line">chgrp -R group1 dir <span class="comment"># æŠŠdirç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä»¥åŠæ¬¡ç›®å½•æ–‡ä»¶çš„ç¾¤ç»„éƒ½è®¾ç½®ä¸ºgroup1</span></span><br></pre></td></tr></table></figure><p>è¢«æ”¹å˜çš„ç¾¤ç»„å¿…é¡»åœ¨ç¾¤ç»„é…ç½®æ–‡ä»¶<code>/etc/group</code>ä¸­å­˜åœ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[maywzh@M-Ubuntu] ~$ cat /etc/group</span><br><span class="line">tester:x:500:linuxsir</span><br><span class="line">charger:x:134:syslog,maywzh</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>/etc/group</code>çš„æ¯ä¸ªç”¨æˆ·ç»„ä¸€æ¡è®°å½•å æ®ä¸€è¡Œï¼Œè®°å½•æ ¼å¼<code>group_name:passwd:GID:user_list</code></p><p>ç¬¬ä¸€å­—æ®µï¼šç”¨æˆ·ç»„åç§°ï¼›<br>ç¬¬äºŒå­—æ®µï¼šç”¨æˆ·ç»„å¯†ç ï¼› xè¡¨ç¤ºæœªè®¾å¯†ç <br>ç¬¬ä¸‰å­—æ®µï¼šGID è¯¥ç”¨æˆ·ç»„ä¸‹çš„ç”¨æˆ·åŒ…æ‹¬ç”¨æˆ·åˆ—è¡¨ä¸­çš„ç”¨æˆ·GIDä¸ºè¯¥GIDçš„ç”¨æˆ·,é€šè¿‡<code>/etc/passwd</code>æŸ¥çœ‹<br>ç¬¬å››å­—æ®µï¼šç”¨æˆ·åˆ—è¡¨ï¼Œæ¯ä¸ªç”¨æˆ·ä¹‹é—´ç”¨,å·åˆ†å‰²ï¼›æœ¬å­—æ®µå¯ä»¥ä¸ºç©ºï¼›å¦‚æœå­—æ®µä¸ºç©ºè¡¨ç¤ºç”¨æˆ·ç»„ä¸ºGIDçš„ç”¨æˆ·åï¼› </p><p>å¯¹åº”çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gpasswd â€“a username groupname <span class="comment">#æŠŠæŸç”¨æˆ·åŠ å…¥åˆ°æŸä¸ªç»„ä¸­</span></span><br><span class="line">gpasswd â€“d username groupname <span class="comment">#æŠŠç»„ä¸­çš„æŸä¸ªç”¨æˆ·åˆ é™¤</span></span><br><span class="line">smbpasswd â€“a usernameÂ Â Â Â Â Â Â Â Â  <span class="comment">#åœ¨SMBä¸­åŠ å…¥ç”¨æˆ·</span></span><br><span class="line">smbpasswd â€“x usernameÂ Â Â Â Â Â Â Â Â  <span class="comment">#åœ¨ SMBä¸­åˆ é™¤ç”¨æˆ·</span></span><br></pre></td></tr></table></figure><h2 id="è¯¦è§£æƒé™"><a href="#è¯¦è§£æƒé™" class="headerlink" title="è¯¦è§£æƒé™"></a>è¯¦è§£æƒé™</h2><h3 id="è¯»-r"><a href="#è¯»-r" class="headerlink" title="è¯» - r"></a>è¯» - r</h3><p>æ–‡ä»¶ï¼šè¯»å–æ–‡ä»¶çš„å®é™…å†…å®¹ã€‚</p><p>ç›®å½•ï¼šå¯ä»¥æŸ¥è¯¢è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶åæ•°æ®ï¼Œä½¿ç”¨<code>ls</code>å‘½ä»¤æŠŠè¯¥ç›®å½•å†…å®¹åˆ—è¡¨æ˜¾ç¤ºå‡ºæ¥ã€‚</p><h3 id="å†™-w"><a href="#å†™-w" class="headerlink" title="å†™ - w"></a>å†™ - w</h3><p>æ–‡ä»¶: å¯ä»¥ç¼–è¾‘ã€æ–°å¢æˆ–è€…æ˜¯ä¿®æ”¹è¯¥æ–‡ä»¶çš„å†…å®¹ä½†ä¸å«åˆ é™¤è¯¥æ–‡ä»¶ã€‚<code>w</code>ä¸»è¦éƒ½æ˜¯é’ˆå¯¹â€œæ–‡ä»¶çš„å†…å®¹â€è€Œè¨€ï¼Œä¸æ–‡ä»¶æ–‡ä»¶åçš„å­˜åœ¨ä¸å¦æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºæ–‡ä»¶è®°å½•çš„æ˜¯å®é™…çš„æ•°æ®ã€‚</p><p>ç›®å½•ï¼šè¡¨ç¤ºå¯ä»¥ä¿®æ”¹ç›®å½•ç»“æ„æ¸…å•çš„æƒé™ï¼Œå³</p><ul><li>åˆ›å»ºæ–°çš„æ–‡ä»¶ä¸ç›®å½•ï¼›</li><li>åˆ é™¤å·²ç»å­˜åœ¨çš„æ–‡ä»¶ä¸ç›®å½•ï¼ˆä¸è®ºè¯¥æ–‡ä»¶çš„æƒé™ä¸ºä½•ï¼‰</li><li>å°†å·²å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œæ›´åï¼›</li><li>æ¬ç§»è¯¥ç›®å½•å†…çš„æ–‡ä»¶ã€ç›®å½•ä½ç½®ã€‚</li></ul><h3 id="æ‰§è¡Œ-x"><a href="#æ‰§è¡Œ-x" class="headerlink" title="æ‰§è¡Œ - x"></a>æ‰§è¡Œ - x</h3><p>æ–‡ä»¶ï¼šLinuxä¸­æ–‡ä»¶æ˜¯å¦èƒ½è¢«æ‰§è¡Œå°±æ˜¯ç”±<code>x</code>è¿™ä¸ªå­—æ®µæ¥æŒ‡å®šã€‚</p><p>ç›®å½•ï¼šä»£è¡¨ä½¿ç”¨è€…æ˜¯å¦èƒ½è¿›å…¥è¯¥ç›®å½•ä½œä¸ºå·¥ä½œç›®å½•ï¼Œå³<code>cd</code>åˆ°è¿™ä¸ªç›®å½•çš„æƒé™ã€‚</p><p>ä¾‹ï¼šå‡è®¾ç°åœ¨åœ¨ç³»ç»Ÿä½¿ç”¨ may è¿™ä¸ªå¸å·ï¼Œé‚£ä¹ˆè¿™ä¸ªå¸å·é’ˆå¯¹ /dir1, /dir1/file1, /dir2 è¿™ä¸‰ä¸ªæ–‡ä»¶åæ¥è¯´ï¼Œåˆ†åˆ«éœ€è¦â€œå“ªäº›æœ€å°çš„æƒé™â€æ‰èƒ½è¾¾æˆå„é¡¹ä»»åŠ¡ï¼Ÿ</p><div class="table-container"><table><thead><tr><th>æ“ä½œåŠ¨ä½œ</th><th>/dir1</th><th>/dir1/file1</th><th>/dir2</th><th>é‡ç‚¹</th></tr></thead><tbody><tr><td>è¯»å– file1 å†…å®¹</td><td>x</td><td>r</td><td>-</td><td>è¦èƒ½å¤Ÿè¿›å…¥ /dir1 æ‰èƒ½è¯»åˆ°é‡Œé¢çš„æ–‡ä»¶æ•°æ®</td></tr><tr><td>ä¿®æ”¹ file1 å†…å®¹</td><td>x</td><td>rw</td><td>-</td><td>èƒ½å¤Ÿè¿›å…¥ /dir1 ä¸”ä¿®æ”¹ file1 æ‰è¡Œ</td></tr><tr><td>æ‰§è¡Œ file1 å†…å®¹</td><td>x</td><td>rx</td><td>-</td><td>èƒ½å¤Ÿè¿›å…¥ /dir1 ä¸” file1 èƒ½è¿è¡Œæ‰è¡Œ</td></tr><tr><td>åˆ é™¤ file1 æ–‡ä»¶</td><td>wx</td><td>-</td><td>-</td><td>èƒ½å¤Ÿè¿›å…¥ /dir1 å…·æœ‰ç›®å½•ä¿®æ”¹çš„æƒé™å³å¯</td></tr><tr><td>å°† file1 å¤åˆ¶åˆ° /dir2</td><td>x</td><td>r</td><td>wx</td><td>è¦èƒ½å¤Ÿè¯» file1 ä¸”èƒ½å¤Ÿä¿®æ”¹ /dir2 å†…çš„æ•°æ®</td></tr></tbody></table></div><p>ä¸Šé¢çš„è¡¨æ ¼å½“ä¸­ï¼Œå¾ˆå¤šæ—¶å€™ /dir1 éƒ½ä¸å¿…æœ‰ r ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çŸ¥é“ /dir1 æ˜¯ä¸ªç›®å½•ï¼Œç±»ä¼¼äºæŠ½å±‰ã€‚é‚£ä¸ªæŠ½å±‰çš„ r ä»£è¡¨â€œè¿™ä¸ªæŠ½å±‰é‡Œé¢æœ‰ç¯å…‰â€ï¼Œ æ‰€ä»¥èƒ½çœ‹åˆ°æŠ½å±‰å†…çš„æ‰€æœ‰æ•°æ®åç§° ï¼ˆéå†…å®¹ï¼‰ã€‚ä½†æˆ‘ä»¬å·²ç»çŸ¥é“é‡Œé¢çš„æ•°æ®æ”¾åœ¨å“ªä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥å¯ä»¥ä¸éœ€è¦ç¯å…‰æ‘¸é»‘æ‹¿åˆ°è¯¥æ•°æ®ã€‚ å› æ­¤ï¼Œä¸Šé¢å¾ˆå¤šåŠ¨ä½œä¸­ï¼Œä½ åªè¦å…·æœ‰ x å³å¯ã€‚r æ˜¯éå¿…å¤‡çš„ï¼åªæ˜¯ï¼Œæ²¡æœ‰ r çš„è¯ï¼Œä½¿ç”¨ [tab] æ—¶ï¼Œå°±æ— æ³•è‡ªåŠ¨è¡¥å…¨æ–‡ä»¶åã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlçš„å¸¸ç”¨å‘½ä»¤</title>
      <link href="/2015/02/11/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BMysql%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2015/02/11/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BMysql%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>æ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„ç®€å•MySQLå‘½ä»¤ã€‚</p><a id="more"></a><h2 id="MySQLä»‹ç»"><a href="#MySQLä»‹ç»" class="headerlink" title="MySQLä»‹ç»"></a>MySQLä»‹ç»</h2><p>MySQL ä¸ºå…³ç³»å‹æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–æ•°ä¸ªè¡¨æ ¼ç»„æˆ</p><div class="table-container"><table><thead><tr><th>id</th><th>name</th><th>sex</th><th>age</th></tr></thead><tbody><tr><td>0</td><td>å¼ ä¸‰</td><td>m</td><td>23</td></tr><tr><td>1</td><td>æå››</td><td>f</td><td>35</td></tr><tr><td>2</td><td>ç‹äº”</td><td>m</td><td>20</td></tr><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td><td>â€¦</td></tr></tbody></table></div><p><strong>è¡¨å¤´(header)ï¼š</strong>æ¯ä¸€åˆ—çš„åç§°ï¼›<br><strong>åˆ—(col)ï¼š</strong> æ¯ä¸€åˆ—ç”¨æ¥æè¿°è¡¨ä¸­æ‰€æœ‰æ•°æ®é¡¹çš„æŸä¸ªå±æ€§ï¼›<br><strong>è¡Œ(row)ï¼š</strong>æ¯ä¸€è¡Œç”¨æ¥æè¿°æŸä¸ªæ•°æ®é¡¹çš„çš„æ‰€æœ‰å±æ€§ï¼›<br><strong>å€¼(value)ï¼š</strong>è¡Œçš„å…·ä½“ä¿¡æ¯, æ¯ä¸ªå€¼å¿…é¡»ä¸è¯¥åˆ—çš„æ•°æ®ç±»å‹ç›¸åŒï¼›</p><h2 id="ç™»å½•MySQL"><a href="#ç™»å½•MySQL" class="headerlink" title="ç™»å½•MySQL"></a>ç™»å½•MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 127.0.0.1 -u username -p</span><br><span class="line">mysql -D dbname -h hostname -u username -p</span><br><span class="line">mysql&gt; <span class="built_in">exit</span> </span><br><span class="line"><span class="comment"># é€€å‡º</span></span><br><span class="line">mysql&gt; quit <span class="comment"># é€€å‡º</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h2><p>å¯¹äºè¡¨çš„æ“ä½œéœ€è¦å…ˆè¿›å…¥åº“ use åº“åï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> testdb <span class="built_in">character</span> <span class="keyword">set</span> gbk; <span class="comment">-- åˆ›å»ºä¸€ä¸ªåä¸º testdb çš„æ•°æ®åº“ï¼Œæ•°æ®åº“å­—ç¬¦ç¼–ç æŒ‡å®šä¸º gbk</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> testdb;  <span class="comment">-- åˆ é™¤ testdb</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;        <span class="comment">-- æ˜¾ç¤ºæ•°æ®åº“åˆ—è¡¨ã€‚</span></span><br><span class="line"><span class="keyword">use</span> testdb;      <span class="comment">-- é€‰æ‹©åˆ›å»ºçš„æ•°æ®åº“people</span></span><br><span class="line"><span class="keyword">show</span> è¡¨å;       <span class="comment">-- æ˜¾ç¤ºsamp_dbä¸‹é¢æ‰€æœ‰çš„è¡¨åå­—</span></span><br><span class="line"><span class="keyword">describe</span> è¡¨å;   <span class="comment">-- æ˜¾ç¤ºæ•°æ®è¡¨çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> è¡¨å; <span class="comment">-- æ¸…ç©ºè¡¨ä¸­è®°å½•</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ•°æ®åº“è¡¨"><a href="#åˆ›å»ºæ•°æ®åº“è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®åº“è¡¨"></a>åˆ›å»ºæ•°æ®åº“è¡¨</h2><p>ä½¿ç”¨ create table è¯­å¥å¯å®Œæˆå¯¹è¡¨çš„åˆ›å»º, create table çš„å¸¸è§å½¢å¼:è¯­æ³•ï¼šcreate table è¡¨åç§°(åˆ—å£°æ˜)ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span> (  </span><br><span class="line"><span class="string">`id`</span>          <span class="built_in">int</span>(<span class="number">100</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT primary <span class="keyword">key</span>,  </span><br><span class="line"><span class="string">`password`</span>    <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ç”¨æˆ·å¯†ç &#x27;</span>,  </span><br><span class="line"><span class="string">`mobile`</span>         <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;æ‰‹æœºå·ç &#x27;</span>,  </span><br><span class="line"><span class="string">`create_at`</span>      <span class="built_in">timestamp</span>(<span class="number">6</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>(<span class="number">6</span>),  </span><br><span class="line"><span class="string">`update_at`</span>      <span class="built_in">timestamp</span>(<span class="number">6</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>(<span class="number">6</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>(<span class="number">6</span>),  </span><br><span class="line"><span class="comment">-- åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸é‡å¤  </span></span><br><span class="line"><span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_user_mobile(<span class="string">`mobile`</span>))</span><br><span class="line"><span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 </span><br><span class="line"><span class="keyword">COMMENT</span>=<span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ•°æ®ç±»å‹çš„å±æ€§è§£é‡Š</p><ul><li><strong>NULLï¼š</strong>æ•°æ®åˆ—å¯åŒ…å«NULLå€¼ï¼›</li><li><strong>NOT NULLï¼š</strong>æ•°æ®åˆ—ä¸å…è®¸åŒ…å«NULLå€¼ï¼›</li><li><strong>DEFAULTï¼š</strong>é»˜è®¤å€¼ï¼›</li><li><strong>PRIMARYï¼š</strong>KEY ä¸»é”®ï¼›</li><li><strong>AUTO_INCREMENTï¼š</strong>è‡ªåŠ¨é€’å¢ï¼Œé€‚ç”¨äºæ•´æ•°ç±»å‹ï¼›</li><li><strong>UNSIGNEDï¼š</strong>æ˜¯æŒ‡æ•°å€¼ç±»å‹åªèƒ½ä¸ºæ­£æ•°ï¼›</li><li><strong>CHARACTER SET nameï¼š</strong>æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†ï¼›</li><li><strong>COMMENTï¼š</strong>å¯¹è¡¨æˆ–è€…å­—æ®µè¯´æ˜ï¼›</li></ul><h2 id="CRUD-å¢åˆ æŸ¥æ”¹"><a href="#CRUD-å¢åˆ æŸ¥æ”¹" class="headerlink" title="CRUD - å¢åˆ æŸ¥æ”¹"></a>CRUD - å¢åˆ æŸ¥æ”¹</h2><h3 id="SELECT-æŸ¥"><a href="#SELECT-æŸ¥" class="headerlink" title="SELECT æŸ¥"></a>SELECT æŸ¥</h3><p>SELECT è¯­å¥ç”¨äºä»è¡¨ä¸­é€‰å–æ•°æ®ã€‚<br><strong>è¯­æ³•ï¼šSELECT åˆ—åç§° FROM è¡¨åç§°</strong> â€” é€‰æ‹©ç‰¹å®šçš„åˆ—<br><strong>è¯­æ³•ï¼šSELECT * FROM è¡¨åç§°</strong> â€” é€‰æ‹©æ‰€æœ‰çš„åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¡¨abc ä¸¤ä¸ª id  è¡¨abcä¸­ä¸åŒ…å« å­—æ®µa=b çš„ æŸ¥è¯¢å‡ºæ¥ï¼Œåªæ˜¾ç¤ºid</span></span><br><span class="line"><span class="keyword">SELECT</span> s.id <span class="keyword">from</span> station s <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="number">13</span>,<span class="number">14</span>) <span class="keyword">and</span> user_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">4</span>);</span><br><span class="line"><span class="comment">-- ä»è¡¨ Persons é€‰å– LastName åˆ—çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">SELECT</span> LastName <span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="comment">-- ç»“æœé›†ä¸­ä¼šè‡ªåŠ¨å»é‡å¤æ•°æ®</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Company <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="comment">-- è¡¨ Persons å­—æ®µ Id_P ç­‰äº Orders å­—æ®µ Id_P çš„å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">-- ç»“æœé›†æ˜¾ç¤º Personsè¡¨çš„ LastNameã€FirstNameå­—æ®µï¼ŒOrdersè¡¨çš„OrderNoå­—æ®µ</span></span><br><span class="line"><span class="keyword">SELECT</span> p.LastName, p.FirstName, o.OrderNo <span class="keyword">FROM</span> Persons p, Orders o <span class="keyword">WHERE</span> p.Id_P = o.Id_P </span><br></pre></td></tr></table></figure><h3 id="UPDATE-æ”¹"><a href="#UPDATE-æ”¹" class="headerlink" title="UPDATE æ”¹"></a>UPDATE æ”¹</h3><p>Update è¯­å¥ç”¨äºä¿®æ”¹è¡¨ä¸­çš„æ•°æ®ã€‚<br>è¯­æ³•ï¼šUPDATE è¡¨åç§° SET åˆ—åç§° = æ–°å€¼ WHERE åˆ—åç§° = æŸå€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- updateè¯­å¥è®¾ç½®å­—æ®µå€¼ä¸ºå¦ä¸€ä¸ªç»“æœå–å‡ºæ¥çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">-- ä»user2è¡¨ä¸­æŸ¥åˆ°nameä¸ºMickiå¯¹åº”çš„idï¼Œä¿®æ”¹userä¸­æ­¤idçš„nameå­—æ®µä¸ºuser1è¡¨ä¸­id=1çš„è¡¨é¡¹çš„nameå­—æ®µ</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> </span><br><span class="line"><span class="keyword">set</span> <span class="keyword">name</span> = (<span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> user1 <span class="keyword">where</span> user1 .id = <span class="number">1</span> )</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">id</span> = (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> user2 <span class="keyword">where</span> user2 .name=<span class="string">&#x27;Micki&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="INSERT-å¢"><a href="#INSERT-å¢" class="headerlink" title="INSERT å¢"></a>INSERT å¢</h3><p>INSERT INTO è¯­å¥ç”¨äºå‘è¡¨æ ¼ä¸­æ’å…¥æ–°çš„è¡Œã€‚<br>è¯­æ³•ï¼šINSERT INTO è¡¨åç§° VALUES (å€¼1, å€¼2,â€¦.)<br>è¯­æ³•ï¼šINSERT INTO è¡¨åç§° (åˆ—1, åˆ—2,â€¦) VALUES (å€¼1, å€¼2,â€¦.)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‘è¡¨ Persons æ’å…¥ä¸€æ¡å­—æ®µ FirstName = Andy å­—æ®µ Address = beijing</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons (FirstName, Address) <span class="keyword">VALUES</span> (<span class="string">&#x27;Andy&#x27;</span>, <span class="string">&#x27;beijing&#x27;</span>); </span><br></pre></td></tr></table></figure><h3 id="DELETE-åˆ "><a href="#DELETE-åˆ " class="headerlink" title="DELETE åˆ "></a>DELETE åˆ </h3><p>DELETE è¯­å¥ç”¨äºåˆ é™¤è¡¨ä¸­çš„è¡Œã€‚<br>è¯­æ³•ï¼šDELETE FROM è¡¨åç§° WHERE åˆ—åç§° = å€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ä¸åˆ é™¤table_nameè¡¨çš„æƒ…å†µä¸‹åˆ é™¤æ‰€æœ‰çš„è¡Œï¼Œæ¸…ç©ºè¡¨ã€‚</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="comment">-- æˆ–è€…</span></span><br><span class="line"><span class="keyword">DELETE</span> * <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="comment">-- åˆ é™¤ Personè¡¨å­—æ®µ FirstName = &#x27;Andy&#x27; </span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Person <span class="keyword">WHERE</span> FirstName = <span class="string">&#x27;Andy&#x27;</span> </span><br></pre></td></tr></table></figure><h2 id="åˆ—å¤„ç†"><a href="#åˆ—å¤„ç†" class="headerlink" title="åˆ—å¤„ç†"></a>åˆ—å¤„ç†</h2><h3 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT"></a>COUNT</h3><p>COUNT ç»Ÿè®¡ç¬¦åˆè¦æ±‚çš„è¡¨é¡¹æ•°(è¡Œæ•°)<br>è¯­æ³•ï¼šSELECT COUNT(â€œå­—æ®µåâ€) FROM â€œè¡¨æ ¼åâ€;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¡¨ stores ä¸­ store_name æ ä¸æ˜¯NULLçš„è¡¨é¡¹æ€»æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span> (Store_Name) <span class="keyword">FROM</span> stores <span class="keyword">WHERE</span> store_name <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>; </span><br><span class="line"><span class="comment">-- è·å– Persons è¡¨çš„æ€»æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">AS</span> totals <span class="keyword">FROM</span> Persons;</span><br><span class="line"><span class="comment">-- è·å–è¡¨ station å­—æ®µ user_id ç›¸åŒçš„æ€»æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> totals <span class="keyword">FROM</span> station <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id;</span><br></pre></td></tr></table></figure><h3 id="MAX"><a href="#MAX" class="headerlink" title="MAX"></a>MAX</h3><p>MAX å‡½æ•°è¿”å›ä¸€åˆ—ä¸­çš„æœ€å¤§å€¼ã€‚NULL å€¼ä¸åŒ…æ‹¬åœ¨è®¡ç®—ä¸­ã€‚<br>è¯­æ³•ï¼šSELECT MAX(â€œå­—æ®µåâ€) FROM â€œè¡¨æ ¼åâ€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ—å‡ºè¡¨ orders å­—æ®µ OrderPrice åˆ—æœ€å¤§å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">-- ç»“æœé›†åˆ—ä¸æ˜¾ç¤º OrderPrice æ˜¾ç¤º LargestOrderPrice</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(OrderPrice) <span class="keyword">AS</span> LargestOrderPrice <span class="keyword">FROM</span> orders</span><br></pre></td></tr></table></figure><h3 id="SUM"><a href="#SUM" class="headerlink" title="SUM"></a>SUM</h3><p>SUM ç”¨äºè®¡ç®—æŸä¸€åˆ—çš„å’Œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¡ç®— OrderPrice </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(OrderPrice) <span class="keyword">AS</span> totalprice <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure><h2 id="WHERE-æ¡ä»¶é™å®š"><a href="#WHERE-æ¡ä»¶é™å®š" class="headerlink" title="WHERE - æ¡ä»¶é™å®š"></a>WHERE - æ¡ä»¶é™å®š</h2><p>WHERE å­å¥ç”¨äºè§„å®šé€‰æ‹©çš„æ ‡å‡†ã€‚<br>è¯­æ³•ï¼šSELECT åˆ—åç§° FROM è¡¨åç§° WHERE åˆ— è¿ç®—ç¬¦ å€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä»è¡¨ Persons ä¸­é€‰å‡º Year å­—æ®µå¤§äº 1965 çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> <span class="keyword">Year</span>&gt;<span class="number">1965</span></span><br></pre></td></tr></table></figure><h3 id="AND-å’Œ-OR"><a href="#AND-å’Œ-OR" class="headerlink" title="AND å’Œ OR"></a>AND å’Œ OR</h3><p>AND â€“ ä¸ï¼› OR â€“ æˆ–ï¼›</p><h3 id="NOT"><a href="#NOT" class="headerlink" title="NOT"></a>NOT</h3><p>NOT â€“ ç”¨äºé€»è¾‘è¿ç®—è¯­å¥å‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_id, prod_name <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> <span class="keyword">NOT</span> vend_id = <span class="string">&#x27;DLL01&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name;</span><br></pre></td></tr></table></figure><h3 id="IN"><a href="#IN" class="headerlink" title="IN"></a>IN</h3><p>IN â€“ åœ¨é›†åˆä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä»è¡¨ Persons é€‰å– å­—æ®µ LastName ç­‰äº Amyã€Beck</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> LastName <span class="keyword">IN</span> (<span class="string">&#x27;Amy&#x27;</span>,<span class="string">&#x27;Beck&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="AS-åˆ«å"><a href="#AS-åˆ«å" class="headerlink" title="AS - åˆ«å"></a>AS - åˆ«å</h2><p>as â€“ åˆ«å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥æ‰¾å¹¶è®¾ç½®æŠŠEmployeeè¡¨æ ¼åˆ«åä¸º emp</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Employee <span class="keyword">AS</span> emp</span><br><span class="line"><span class="comment">-- å‘½åä¸€ä¸ªè¡¨ä¹‹åï¼Œå¯ä»¥åœ¨ä¸‹é¢ç”¨ emp ä»£æ›¿ Employee.</span></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ </span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp. <span class="keyword">SELECT</span> <span class="keyword">MAX</span>(OrderPrice) <span class="keyword">AS</span> LargestOrderPrice <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="comment">-- åˆ—å‡ºè¡¨ Orders å­—æ®µ OrderPrice åˆ—æœ€å¤§å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">-- ç»“æœé›†åˆ—ä¸æ˜¾ç¤º OrderPrice æ˜¾ç¤º LargestOrderPrice </span></span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºè¡¨ users_profile ä¸­çš„ name åˆ—</span></span><br><span class="line"><span class="keyword">SELECT</span> t.name <span class="keyword">from</span> (<span class="keyword">SELECT</span> * <span class="keyword">from</span> users_profile a) <span class="keyword">AS</span> t; </span><br><span class="line"><span class="comment">-- è¡¨ user_accounts å‘½ååˆ«å uaï¼Œè¡¨ users_profile å‘½ååˆ«å up</span></span><br><span class="line"><span class="comment">-- æ»¡è¶³æ¡ä»¶ è¡¨ user_accounts å­—æ®µ id ç­‰äº è¡¨ users_profile å­—æ®µ user_id-- ç»“æœé›†åªæ˜¾ç¤ºmobileã€nameä¸¤åˆ—</span></span><br><span class="line"><span class="keyword">SELECT</span> ua.mobile,up.name <span class="keyword">FROM</span> user_accounts <span class="keyword">as</span> ua <span class="keyword">INNER</span> <span class="keyword">JOIN</span> users_profile <span class="keyword">as</span> up <span class="keyword">ON</span> ua.id = up.user_id;</span><br></pre></td></tr></table></figure><h2 id="ORDER-BY-ç»“æœæ’åº"><a href="#ORDER-BY-ç»“æœæ’åº" class="headerlink" title="ORDER BY - ç»“æœæ’åº"></a>ORDER BY - ç»“æœæ’åº</h2><p>ORDER BY â€“ è¯­å¥ç”¨äºæ ¹æ®æŒ‡å®šçš„åˆ—å¯¹ç»“æœé›†è¿›è¡Œæ’åºã€‚<br>DESC â€“ æŒ‰ç…§é™åºæ’åºã€‚<br>ASC â€“ æŒ‰ç…§å‡åºæ’åºï¼ˆç¼ºçœé»˜è®¤ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Companyåœ¨è¡¨Ordersä¸­ä¸ºå­—æ¯ï¼Œåˆ™ä¼šä»¥å­—æ¯é¡ºåºæ˜¾ç¤ºå…¬å¸åç§°</span></span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company </span><br><span class="line"><span class="comment">-- åé¢è·Ÿä¸Š DESC åˆ™ä¸ºé™åºæ˜¾ç¤º</span></span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company <span class="keyword">DESC</span> </span><br><span class="line"><span class="comment">-- Companyä»¥é™åºæ˜¾ç¤ºå…¬å¸åç§°ï¼Œå¹¶OrderNumberä»¥é¡ºåºæ˜¾ç¤º</span></span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company <span class="keyword">DESC</span>, OrderNumber <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure><h2 id="GROUP-BY-ç»“æœåˆ†ç»„"><a href="#GROUP-BY-ç»“æœåˆ†ç»„" class="headerlink" title="GROUP BY - ç»“æœåˆ†ç»„"></a>GROUP BY - ç»“æœåˆ†ç»„</h2><p>ç”¨äºç»“æœåŸºäºæŸä¸€ä¸ªå±æ€§èšåˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è·å–è¡¨ station å­—æ®µ user_id ç›¸åŒçš„æ€»æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> totals <span class="keyword">FROM</span> station <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id;</span><br></pre></td></tr></table></figure><h2 id="JOIN-è”åˆæŸ¥è¯¢"><a href="#JOIN-è”åˆæŸ¥è¯¢" class="headerlink" title="JOIN - è”åˆæŸ¥è¯¢"></a>JOIN - è”åˆæŸ¥è¯¢</h2><p>ç”¨äºæ ¹æ®ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­çš„åˆ—ä¹‹é—´çš„å…³ç³»ï¼Œä»è¿™äº›è¡¨ä¸­æŸ¥è¯¢æ•°æ®ã€‚<br>JOINï¼šå¦‚æœè¡¨ä¸­æœ‰è‡³å°‘ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ<br>INNER JOINï¼šä¸¤è¡¨éƒ½å¿…é¡»åŒ¹é…ï¼Œè¿”å›ä¸¤è¡¨çš„è¡Œã€‚<br>LEFT JOINï¼šå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ<br>RIGHT JOINï¼šå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ<br>FULL JOINï¼šåªè¦å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œå°±è¿”å›è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.OrderNo </span><br><span class="line"><span class="keyword">FROM</span> PersonsINNER <span class="keyword">JOIN</span> OrdersON Persons.Id_P = Orders.Id_PORDER <span class="keyword">BY</span> Persons.LastName;</span><br></pre></td></tr></table></figure><h2 id="INDEX-ç´¢å¼•"><a href="#INDEX-ç´¢å¼•" class="headerlink" title="INDEX - ç´¢å¼•"></a>INDEX - ç´¢å¼•</h2><h3 id="æ™®é€šç´¢å¼•-INDEX"><a href="#æ™®é€šç´¢å¼•-INDEX" class="headerlink" title="æ™®é€šç´¢å¼•(INDEX)"></a>æ™®é€šç´¢å¼•(INDEX)</h3><p>è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD INDEX ç´¢å¼•åå­— ( å­—æ®µåå­— )</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- â€“ç›´æ¥åˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_user <span class="keyword">ON</span> <span class="keyword">user</span>(title)</span><br><span class="line"><span class="comment">-- â€“ä¿®æ”¹è¡¨ç»“æ„çš„æ–¹å¼æ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> (<span class="keyword">column</span>(<span class="keyword">length</span>))</span><br><span class="line"><span class="comment">-- ç»™ user è¡¨ä¸­çš„ nameå­—æ®µ æ·»åŠ æ™®é€šç´¢å¼•(INDEX)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`table`</span> <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name (<span class="keyword">name</span>)</span><br><span class="line"><span class="comment">-- â€“åˆ›å»ºè¡¨çš„æ—¶å€™åŒæ—¶åˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`table`</span> (    </span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT ,    </span><br><span class="line">    <span class="string">`title`</span> <span class="built_in">char</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="literal">NULL</span> ,    </span><br><span class="line">    <span class="string">`content`</span> <span class="built_in">text</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> ,    </span><br><span class="line">    <span class="string">`time`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> ,    </span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),    </span><br><span class="line">    <span class="keyword">INDEX</span> index_name (title(<span class="keyword">length</span>)))</span><br><span class="line"> <span class="comment">-- â€“åˆ é™¤ç´¢å¼•</span></span><br><span class="line"> <span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure><h3 id="ä¸»é”®ç´¢å¼•-PRIMARY-key"><a href="#ä¸»é”®ç´¢å¼•-PRIMARY-key" class="headerlink" title="ä¸»é”®ç´¢å¼•(PRIMARY key)"></a>ä¸»é”®ç´¢å¼•(PRIMARY key)</h3><p>è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD PRIMARY KEY (å­—æ®µåå­—)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»™ user è¡¨ä¸­çš„ idå­—æ®µ æ·»åŠ ä¸»é”®ç´¢å¼•(PRIMARY key)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> <span class="keyword">ADD</span> PRIMARY <span class="keyword">key</span> (<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure><h3 id="å”¯ä¸€ç´¢å¼•-UNIQUE"><a href="#å”¯ä¸€ç´¢å¼•-UNIQUE" class="headerlink" title="å”¯ä¸€ç´¢å¼•(UNIQUE)"></a>å”¯ä¸€ç´¢å¼•(UNIQUE)</h3><p>è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD UNIQUE (å­—æ®µåå­—)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»™ user è¡¨ä¸­çš„ creattime å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•(UNIQUE)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (creattime);</span><br></pre></td></tr></table></figure><h3 id="å…¨æ–‡ç´¢å¼•-FULLTEXT"><a href="#å…¨æ–‡ç´¢å¼•-FULLTEXT" class="headerlink" title="å…¨æ–‡ç´¢å¼•(FULLTEXT)"></a>å…¨æ–‡ç´¢å¼•(FULLTEXT)</h3><p>è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD FULLTEXT (å­—æ®µåå­—)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»™ user è¡¨ä¸­çš„ description å­—æ®µæ·»åŠ å…¨æ–‡ç´¢å¼•(FULLTEXT)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> <span class="keyword">ADD</span> FULLTEXT (description);</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å¤šåˆ—ç´¢å¼•"><a href="#æ·»åŠ å¤šåˆ—ç´¢å¼•" class="headerlink" title="æ·»åŠ å¤šåˆ—ç´¢å¼•"></a>æ·»åŠ å¤šåˆ—ç´¢å¼•</h3><p>è¯­æ³•ï¼šALTER TABLE table_name ADD INDEX index_name ( column1, column2, column3)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»™ user è¡¨ä¸­çš„ nameã€cityã€age å­—æ®µæ·»åŠ åå­—ä¸ºname_city_ageçš„æ™®é€šç´¢å¼•(INDEX)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">INDEX</span> name_city_age (<span class="keyword">name</span>(<span class="number">10</span>),city,age); </span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹ç´¢å¼•çš„æ—¶æœº"><a href="#å»ºç«‹ç´¢å¼•çš„æ—¶æœº" class="headerlink" title="å»ºç«‹ç´¢å¼•çš„æ—¶æœº"></a>å»ºç«‹ç´¢å¼•çš„æ—¶æœº</h3><p>åœ¨WHEREå’ŒJOINä¸­å‡ºç°çš„åˆ—éœ€è¦å»ºç«‹ç´¢å¼•ï¼š<br>MySQLåªå¯¹&lt;ï¼Œ&lt;=ï¼Œ=ï¼Œ&gt;ï¼Œ&gt;=ï¼ŒBETWEENï¼ŒINä½¿ç”¨ç´¢å¼•<br>æŸäº›æ—¶å€™çš„LIKEä¹Ÿä¼šä½¿ç”¨ç´¢å¼•ã€‚<br>åœ¨LIKEä»¥é€šé…ç¬¦%å’Œ_å¼€å¤´ä½œæŸ¥è¯¢æ—¶ï¼ŒMySQLä¸ä¼šä½¿ç”¨ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ­¤æ—¶å°±éœ€è¦å¯¹cityå’Œageå»ºç«‹ç´¢å¼•ï¼Œ</span></span><br><span class="line"><span class="comment">-- ç”±äºmytableè¡¨çš„userameä¹Ÿå‡ºç°åœ¨äº†JOINå­å¥ä¸­ï¼Œä¹Ÿæœ‰å¯¹å®ƒå»ºç«‹ç´¢å¼•çš„å¿…è¦ã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> t.Name  <span class="keyword">FROM</span> mytable t <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> mytable m <span class="keyword">ON</span> t.Name=m.username <span class="keyword">WHERE</span> m.age=<span class="number">20</span> <span class="keyword">AND</span> m.city=<span class="string">&#x27;ä¸Šæµ·&#x27;</span>; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mytable <span class="keyword">WHERE</span> username <span class="keyword">like</span><span class="string">&#x27;admin%&#x27;</span>; </span><br><span class="line"><span class="comment">-- è€Œä¸‹å¥å°±ä¸ä¼šä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mytable WHEREt <span class="keyword">Name</span> <span class="keyword">like</span><span class="string">&#x27;%admin&#x27;</span>; <span class="comment">-- å› æ­¤ï¼Œåœ¨ä½¿ç”¨LIKEæ—¶åº”æ³¨æ„ä»¥ä¸Šçš„åŒºåˆ«ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ³¨æ„"><a href="#ä½¿ç”¨æ³¨æ„" class="headerlink" title="ä½¿ç”¨æ³¨æ„"></a>ä½¿ç”¨æ³¨æ„</h2><ul><li>ç´¢å¼•ä¸ä¼šåŒ…å«æœ‰NULLå€¼çš„åˆ—</li><li>ä½¿ç”¨çŸ­ç´¢å¼•</li><li>ä¸è¦åœ¨åˆ—ä¸Šè¿›è¡Œè¿ç®— ç´¢å¼•ä¼šå¤±æ•ˆ</li></ul><h2 id="è¡¨ç»“æ„ä¿®æ”¹"><a href="#è¡¨ç»“æ„ä¿®æ”¹" class="headerlink" title="è¡¨ç»“æ„ä¿®æ”¹"></a>è¡¨ç»“æ„ä¿®æ”¹</h2><h3 id="æ·»åŠ åˆ—"><a href="#æ·»åŠ åˆ—" class="headerlink" title="æ·»åŠ åˆ—"></a>æ·»åŠ åˆ—</h3><p>è¯­æ³•ï¼šalter table è¡¨å add åˆ—å åˆ—æ•°æ®ç±»å‹ [after æ’å…¥ä½ç½®];<br>ç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨è¡¨studentsçš„æœ€åè¿½åŠ åˆ— address: </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students <span class="keyword">ADD</span> address <span class="built_in">CHAR</span>(<span class="number">60</span>);</span><br><span class="line"><span class="comment">-- åœ¨åä¸º age çš„åˆ—åæ’å…¥åˆ— birthday: </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students <span class="keyword">ADD</span> birthday <span class="built_in">DATE</span> <span class="keyword">after</span> age;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹åˆ—"><a href="#ä¿®æ”¹åˆ—" class="headerlink" title="ä¿®æ”¹åˆ—"></a>ä¿®æ”¹åˆ—</h3><p>è¯­æ³•ï¼šalter table è¡¨å change åˆ—åç§° åˆ—æ–°åç§° æ–°æ•°æ®ç±»å‹;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å°†è¡¨ tel åˆ—æ”¹åä¸º telphone: </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students <span class="keyword">CHANGE</span> tel telphone <span class="built_in">CHAR</span>(<span class="number">13</span>) <span class="keyword">default</span> <span class="string">&quot;-&quot;</span>;</span><br><span class="line"><span class="comment">-- å°† name åˆ—çš„æ•°æ®ç±»å‹æ”¹ä¸º char(16): </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students <span class="keyword">CHANGE</span> <span class="keyword">name</span> <span class="keyword">name</span> <span class="built_in">CHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤åˆ—"><a href="#åˆ é™¤åˆ—" class="headerlink" title="åˆ é™¤åˆ—"></a>åˆ é™¤åˆ—</h3><p>è¯­æ³•ï¼šalter table è¡¨å drop åˆ—åç§°;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤è¡¨studentsä¸­çš„ birthday åˆ—: </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students <span class="keyword">DROP</span> birthday;</span><br></pre></td></tr></table></figure><h3 id="é‡å‘½åè¡¨"><a href="#é‡å‘½åè¡¨" class="headerlink" title="é‡å‘½åè¡¨"></a>é‡å‘½åè¡¨</h3><p>è¯­æ³•ï¼šalter table è¡¨å rename æ–°è¡¨å;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é‡å‘½å students è¡¨ä¸º workmates: </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students <span class="keyword">RENAME</span> workmates;</span><br></pre></td></tr></table></figure><h3 id="æ¸…ç©ºè¡¨æ•°æ®"><a href="#æ¸…ç©ºè¡¨æ•°æ®" class="headerlink" title="æ¸…ç©ºè¡¨æ•°æ®"></a>æ¸…ç©ºè¡¨æ•°æ®</h3><p>è¯­æ³•ï¼šdelete from è¡¨å;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ¸…ç©ºè¡¨ä¸º workmates é‡Œé¢çš„æ•°æ®ï¼Œä¸åˆ é™¤è¡¨ã€‚ </span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> workmates;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ•´å¼ è¡¨"><a href="#åˆ é™¤æ•´å¼ è¡¨" class="headerlink" title="åˆ é™¤æ•´å¼ è¡¨"></a>åˆ é™¤æ•´å¼ è¡¨</h3><p>è¯­æ³•ï¼šdrop table è¡¨å;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤ workmates è¡¨: </span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> workmates;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ•´ä¸ªæ•°æ®åº“"><a href="#åˆ é™¤æ•´ä¸ªæ•°æ®åº“" class="headerlink" title="åˆ é™¤æ•´ä¸ªæ•°æ®åº“"></a>åˆ é™¤æ•´ä¸ªæ•°æ®åº“</h2><p>è¯­æ³•ï¼šdrop database æ•°æ®åº“å;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤ samp_db æ•°æ®åº“: </span></span><br><span class="line"><span class="keyword">DROP</span> DATEBASE samp_db;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxé™æ€åº“ç¼–è¯‘æŒ‡å—</title>
      <link href="/2015/01/17/Linux/Linux%E9%9D%99%E6%80%81%E5%BA%93%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97/"/>
      <url>/2015/01/17/Linux/Linux%E9%9D%99%E6%80%81%E5%BA%93%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>Linuxä¸Šçš„é™æ€åº“ï¼Œå…¶å®æ˜¯ç›®æ ‡æ–‡ä»¶çš„å½’æ¡£æ–‡ä»¶ã€‚<br>åœ¨Linuxä¸Šåˆ›å»ºé™æ€åº“çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å†™æºæ–‡ä»¶ï¼Œé€šè¿‡ <code>gcc -c xxx.c</code> ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚</li><li>ç”¨ <code>ar</code> å½’æ¡£ç›®æ ‡æ–‡ä»¶ï¼Œç”Ÿæˆé™æ€åº“ã€‚</li><li>é…åˆé™æ€åº“ï¼Œå†™ä¸€ä¸ªä½¿ç”¨é™æ€åº“ä¸­å‡½æ•°çš„å¤´æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨é™æ€åº“æ—¶ï¼Œåœ¨æºç ä¸­åŒ…å«å¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œé“¾æ¥æ—¶è®°å¾—é“¾æ¥è‡ªå·±çš„åº“ã€‚</li></ol><h2 id="æºæ–‡ä»¶"><a href="#æºæ–‡ä»¶" class="headerlink" title="æºæ–‡ä»¶"></a>æºæ–‡ä»¶</h2><p>print.c å’Œ math.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//print.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cout</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;%s\n&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//math.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆç›®æ ‡æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -c print.c math.c</span><br><span class="line">$ ls</span><br><span class="line">math.c  math.o  print.c print.o</span><br></pre></td></tr></table></figure><h2 id="å½’æ¡£"><a href="#å½’æ¡£" class="headerlink" title="å½’æ¡£"></a>å½’æ¡£</h2><p>ä½¿ç”¨<code>ar</code>å½’æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ar crv libmylib.a my_print.o my_math.o</span><br><span class="line">a - print.o</span><br><span class="line">a - math.o</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤ä¸­ crv æ˜¯ arçš„å‘½ä»¤é€‰é¡¹ï¼š</p><ul><li>c å¦‚æœéœ€è¦ç”Ÿæˆæ–°çš„åº“æ–‡ä»¶ï¼Œä¸è¦è­¦å‘Š</li><li>r ä»£æ›¿åº“ä¸­ç°æœ‰çš„æ–‡ä»¶æˆ–è€…æ’å…¥æ–°çš„æ–‡ä»¶</li><li>v è¾“å‡ºè¯¦ç»†ä¿¡æ¯</li></ul><p>é€šè¿‡ <code>ar t libmylib.a</code> å¯ä»¥æŸ¥çœ‹ <code>libmylib.a</code> ä¸­åŒ…å«çš„ç›®æ ‡æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬è¦ç”Ÿæˆçš„åº“çš„æ–‡ä»¶åå¿…é¡»å½¢å¦‚ <code>libxxx.a</code> ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨é“¾æ¥è¿™ä¸ªåº“æ—¶ï¼Œå°±å¯ä»¥ç”¨ <code>-lxxx</code>ã€‚<br>åè¿‡æ¥è®²ï¼Œå½“æˆ‘ä»¬å‘Šè¯‰ç¼–è¯‘å™¨ <code>-lxxx</code>æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šåœ¨æŒ‡å®šçš„ç›®å½•ä¸­æœç´¢ <code>libxxx.a</code> æˆ–æ˜¯ <code>libxxx.so</code>ã€‚</p><h2 id="å¤´æ–‡ä»¶"><a href="#å¤´æ–‡ä»¶" class="headerlink" title="å¤´æ–‡ä»¶"></a>å¤´æ–‡ä»¶</h2><p>å¤´æ–‡ä»¶å®šä¹‰äº† libmylib.a çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ç”¨æˆ·æ€ä¹ˆä½¿ç”¨ libmylib.aã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//my_lib.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MY_LIB_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MY_LIB_H__</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cout</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>åœ¨åŒä¸€ç›®å½•ä¸‹å»ºç«‹test.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;my_lib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = add(<span class="number">15</span>, <span class="number">-21</span>);</span><br><span class="line">    <span class="built_in">cout</span>(<span class="string">&quot;I am a func from mylib ...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc test.c -L. -lmylib -o <span class="built_in">test</span> <span class="comment"># åœ¨.ç›®å½•æœç´¢libmylib.aæˆ–libmylib.soæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¸­ <code>-L.</code> å‘Šè¯‰ gcc æœç´¢é“¾æ¥åº“æ—¶åŒ…å«å½“å‰è·¯å¾„ï¼Œ <code>-lmylib</code> å‘Šè¯‰ gcc ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºæ—¶è¦é“¾æ¥ <code>libmylib.a</code>ã€‚</p><p>è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./<span class="built_in">test</span></span><br><span class="line">I am a func from mylib ...</span><br></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨åŒ–ç¼–è¯‘"><a href="#è‡ªåŠ¨åŒ–ç¼–è¯‘" class="headerlink" title="è‡ªåŠ¨åŒ–ç¼–è¯‘"></a>è‡ªåŠ¨åŒ–ç¼–è¯‘</h2><p>åˆ©ç”¨makeæ¥è¿›è¡Œè‡ªåŠ¨åŒ–ç¼–è¯‘</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: build test clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">build: libmylib.a</span></span><br><span class="line"></span><br><span class="line"><span class="section">libmylib.a: math.o print.o</span></span><br><span class="line">ar crv <span class="variable">$@</span> math.o print.o</span><br><span class="line"></span><br><span class="line"><span class="section">math.o: math.c</span></span><br><span class="line">gcc -c math.c</span><br><span class="line"></span><br><span class="line"><span class="section">print.o: print.c</span></span><br><span class="line">gcc -c print.c</span><br><span class="line"></span><br><span class="line"><span class="section">test: test.c</span></span><br><span class="line">gcc test.c -L. -lmylib -o test</span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">rm -f *.o *.so *.a test</span><br></pre></td></tr></table></figure><p><code>make build</code> å°†ä¼šæ„å»º libmylib.aï¼Œ </p><p><code>make test</code> å°†ä¼šç”Ÿæˆé“¾æ¥ libmylib.a çš„ç¨‹åº,</p><p><code>make clean</code> å°†æ¸…ç†æ‰€æœ‰çš„ç¼–è¯‘ä¸­é—´æ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶</p><h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><p>ä¾‹ç¨‹è§<a href="https://github.com/maywzh/Lab_stlib_compiler">Github</a></p><p>ç›¸å…³åšæ–‡ <a href="/LinuxåŠ¨æ€åº“ç¼–è¯‘æŒ‡å—/">LinuxåŠ¨æ€åº“ç¼–è¯‘æŒ‡å—</a></p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ç¼–è¯‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸­çš„é‡å®šå‘</title>
      <link href="/2015/01/04/Linux/Linux%E4%B8%AD%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91/"/>
      <url>/2015/01/04/Linux/Linux%E4%B8%AD%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»ä¸€ä¸ªå‘½ä»¤è¯´èµ·"><a href="#ä»ä¸€ä¸ªå‘½ä»¤è¯´èµ·" class="headerlink" title="ä»ä¸€ä¸ªå‘½ä»¤è¯´èµ·"></a>ä»ä¸€ä¸ªå‘½ä»¤è¯´èµ·</h2><p>ç»å¸¸èƒ½ä»shellè„šæœ¬ä¸­çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cmd &gt;/dev/null 2&gt;&amp;1 <span class="comment">#cmdä»£è¡¨ä¸€ä¸ªå¯ä»¥è¾“å‡ºç»“æœçš„å‘½ä»¤</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h2><p>åœ¨ä½¿ç”¨shellå‘½ä»¤çš„æ—¶å€™ï¼Œæœ€å¸¸è§çš„æ˜¯é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œç»ˆç«¯æ˜¾ç¤ºå¤„ç†ç»“æœã€‚æœ‰çš„æ—¶å€™éœ€è¦å°†shellå‘½ä»¤çš„æ‰§è¡Œç»“æœå­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…è®©shellè¯»å–æŸä¸ªæ–‡ä»¶çš„å†…å®¹ä½œä¸ºè¾“å…¥ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨è¾“å…¥è¾“å‡ºçš„é‡å®šå‘åŠŸèƒ½ã€‚</p><p>é‡å®šå‘å°±æ˜¯æŒ‡æŠŠç¨‹åºçš„è¾“å…¥æºæˆ–è€…è¾“å‡ºåœ°å€ä¿®æ”¹ä¸ºæˆ‘ä»¬åˆ¶å®šçš„IOè®¾å¤‡æˆ–æ–‡ä»¶ã€‚å½“æ‰“å¼€shellå‘½ä»¤æ˜¯ï¼Œä¼šé»˜è®¤æ‰“å¼€3ä¸ªæ–‡ä»¶ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚</p><div class="table-container"><table><thead><tr><th>ç±»å‹</th><th>æ–‡ä»¶æè¿°ç¬¦</th><th>é»˜è®¤æƒ…å†µ</th><th>å¯¹åº”æ–‡ä»¶å¥æŸ„ä½ç½®</th></tr></thead><tbody><tr><td>æ ‡å‡†è¾“å…¥ï¼ˆstandard inputï¼‰</td><td>0</td><td>ä»é”®ç›˜è·å¾—è¾“å…¥</td><td>/proc/slef/fd/0</td></tr><tr><td>æ ‡å‡†è¾“å‡ºï¼ˆstandard outputï¼‰</td><td>1</td><td>è¾“å‡ºåˆ°å±å¹•ï¼ˆå³æ§åˆ¶å°ï¼‰</td><td>/proc/slef/fd/1</td></tr><tr><td>é”™è¯¯è¾“å‡ºï¼ˆerror outputï¼‰</td><td>2</td><td>è¾“å‡ºåˆ°å±å¹•ï¼ˆå³æ§åˆ¶å°ï¼‰</td><td>/proc/slef/fd/2</td></tr></tbody></table></div><p>åœ¨è¿™é‡Œï¼Œæ ¹æ®Linuxä¸€åˆ‡çš†æ–‡ä»¶çš„æ€æƒ³ï¼ŒæŠŠè¾“å…¥è¾“å‡ºè®¾å¤‡éƒ½è§†ä¸ºæ–‡ä»¶ã€‚</p><h3 id="è¾“å‡ºé‡å®šå‘"><a href="#è¾“å‡ºé‡å®šå‘" class="headerlink" title="è¾“å‡ºé‡å®šå‘"></a>è¾“å‡ºé‡å®šå‘</h3><p>è¾“å‡ºé‡å®šå‘åŸºæœ¬çš„ä¸€äº›å‘½ä»¤ï¼š</p><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>command &gt;filename</td><td>æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–°æ–‡ä»¶ä¸­</td></tr><tr><td>command 1&gt;filename</td><td>åŒä¸Š</td></tr><tr><td>command &gt;&gt;filename</td><td>æŠŠæ ‡å‡†è¾“å‡ºè¿½åŠ åˆ°æ–‡ä»¶ä¸­</td></tr><tr><td>command 1&gt;&gt;filename</td><td>åŒä¸Š</td></tr><tr><td>command 2&gt;filename</td><td>æŠŠæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ–°æ–‡ä»¶ä¸­</td></tr><tr><td>command 2&gt;&gt;filename</td><td>æŠŠæ ‡å‡†é”™è¯¯è¿½åŠ åˆ°æ–°æ–‡ä»¶ä¸­</td></tr></tbody></table></div><p>æˆ‘ä»¬ä½¿ç”¨<code>&gt;</code>æˆ–è€…<code>&gt;&gt;</code>å¯¹è¾“å‡ºè¿›è¡Œé‡å®šå‘ã€‚ç¬¦å·çš„å·¦è¾¹æ˜¯æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯ï¼Œå³è¾¹æ˜¯è¾“å‡ºç›®æ ‡ã€‚<code>&gt;</code> ä¼šè¦†ç›–åŸæœ‰çš„æ–‡ä»¶,<code>&gt;&gt;</code>åˆ™æ˜¯è¿½åŠ è¾“å‡ºã€‚ç”¨<code>1</code>å’Œ <code>2</code> å¯ä»¥æ˜¾å¼æŒ‡å®šæ˜¯æ ‡å‡†è¾“å‡ºè¿˜æ˜¯æ ‡å‡†é”™è¯¯ã€‚</p><p>ä¾‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ls . <span class="comment">#å½“å‰ç›®å½•åªæœ‰1.txtæ–‡ä»¶</span></span><br><span class="line">hello.txt  <span class="comment">#å†…å®¹æ˜¯hello</span></span><br><span class="line">$ cat hello.txt 1&gt; out <span class="comment">#æ­¤æ—¶outçš„å†…å®¹æ˜¯hello</span></span><br><span class="line">$ cat out</span><br><span class="line">hello</span><br><span class="line">$ cat world.txt &gt; out</span><br><span class="line">cat: world.txt: No such file or directory <span class="comment">#æ­¤æ—¶ç”±äºä¸å­˜åœ¨world.txtï¼Œå±å¹•ä¸Šå‡ºç°æ ‡å‡†é”™è¯¯è¾“å‡º</span></span><br><span class="line">$ cat world.txt 2&gt; err</span><br><span class="line">$ cat err </span><br><span class="line">cat: world.txt: No such file or directory <span class="comment">#æ ‡å‡†é”™è¯¯è¢«é‡å®šå‘åˆ°erræ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å…¥é‡å®šå‘"><a href="#è¾“å…¥é‡å®šå‘" class="headerlink" title="è¾“å…¥é‡å®šå‘"></a>è¾“å…¥é‡å®šå‘</h3><p>è¾“å…¥é‡å®šå‘çš„åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>command &lt;filename</td><td>ä»¥filenameæ–‡ä»¶ä½œä¸ºæ ‡å‡†è¾“å…¥</td></tr><tr><td>command 0&lt;filename</td><td>åŒä¸Š</td></tr><tr><td>command &lt;&lt;delimiter</td><td>ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å…¥ï¼Œç›´åˆ°é‡åˆ°delimiteråˆ†éš”ç¬¦</td></tr></tbody></table></div><p>æˆ‘ä»¬ä½¿ç”¨<code>&lt;</code>å¯¹è¾“å…¥åšé‡å®šå‘ï¼Œç¬¦å·å·¦è¾¹ç¼ºçœé»˜è®¤ä¸º0ã€‚</p><p>è¾“å…¥é‡å®šå‘å…¶å®å°±æ˜¯è®©æ–‡ä»¶è¾“å…¥ä»£æ›¿é”®ç›˜æ•²å‡»ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat  <span class="comment"># catçš„ä½œç”¨æ˜¯æŠŠè¾“å…¥ç›´æ¥å›æ˜¾åˆ°ç»ˆç«¯é‡Œ</span></span><br><span class="line">111</span><br><span class="line">111</span><br><span class="line">222</span><br><span class="line">222</span><br><span class="line">$ cat &lt;input <span class="comment">#input æ–‡ä»¶å†…å®¹ä¸º foo bar</span></span><br><span class="line">foo bar</span><br><span class="line">$ cat &gt;output &lt;input <span class="comment"># é‡å®šå‘è¾“å…¥ä¸ºinputæ–‡ä»¶ï¼Œé‡å®šå‘è¾“å‡ºä¸ºoutputæ–‡ä»¶ã€‚</span></span><br><span class="line">$ cat output</span><br><span class="line">foo bar </span><br></pre></td></tr></table></figure><h2 id="ç©ºè®¾å¤‡æ–‡ä»¶"><a href="#ç©ºè®¾å¤‡æ–‡ä»¶" class="headerlink" title="ç©ºè®¾å¤‡æ–‡ä»¶"></a>ç©ºè®¾å¤‡æ–‡ä»¶</h2><p>/dev/nullä»£è¡¨linuxçš„ç©ºè®¾å¤‡æ–‡ä»¶ï¼Œæ‰€æœ‰å¾€è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥çš„å†…å®¹éƒ½ä¼šä¸¢å¤±ï¼Œä¿—ç§°â€œé»‘æ´â€ã€‚é‚£ä¹ˆæ‰§è¡Œäº†<code>&gt;/dev/null</code>ä¹‹åï¼Œæ ‡å‡†è¾“å‡ºå°±ä¼šä¸å†å­˜åœ¨ï¼Œæ²¡æœ‰ä»»ä½•åœ°æ–¹èƒ½å¤Ÿæ‰¾åˆ°è¾“å‡ºçš„å†…å®¹ã€‚</p><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸æƒ³è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Œæƒ³è¦æŠ›å¼ƒæ ‡å‡†è¾“å‡ºï¼Œå°±ç”¨è¿™ç§æ–¹æ³•ã€‚</p><h2 id="æ‰©å±•ç”¨æ³•"><a href="#æ‰©å±•ç”¨æ³•" class="headerlink" title="æ‰©å±•ç”¨æ³•"></a>æ‰©å±•ç”¨æ³•</h2><h3 id="é‡å®šå‘ç»‘å®š"><a href="#é‡å®šå‘ç»‘å®š" class="headerlink" title="é‡å®šå‘ç»‘å®š"></a>é‡å®šå‘ç»‘å®š</h3><p>ç°åœ¨æ¥çœ‹çœ‹è¿™æ¡å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>è¿™å¥è¯çš„æ„æ€å…¶å®å°±é‡å®šå‘è¾“å‡ºåˆ°/dev/nullï¼Œç„¶åæŠŠæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºã€‚</p><p>å¦ä¸€ç§å†™æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd &amp;&gt; output.txt</span><br><span class="line">cmd &gt;&amp; output.txt  <span class="comment">#ä¸¤ä¸ªè¡¨è¾¾å¼ç­‰ä»·</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸¤è€…çš„ç»„åˆï¼Œæˆ‘ä»¬æŠŠæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ç»‘å®šåœ¨ä¸€èµ·æŠ›å¼ƒæ‰äº†ï¼Œå³å®ç°äº†ä¸è¾“å‡ºä»»ä½•ä¿¡æ¯ã€‚</p><h3 id="äº¤æ¢é¡ºåºçš„bug"><a href="#äº¤æ¢é¡ºåºçš„bug" class="headerlink" title="äº¤æ¢é¡ºåºçš„bug"></a>äº¤æ¢é¡ºåºçš„bug</h3><p>èƒ½å¦äº¤æ¢è¿™ä¸¤è€…çš„é¡ºåºå‘¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;/dev/null 2&gt;&amp;1 </span><br><span class="line">2&gt;&amp;1 &gt;/dev/null</span><br></pre></td></tr></table></figure><p>ä¸å¯ä»¥ï¼ç¬¬äºŒæ¡çš„å‘½ä»¤ä¼šæŠŠé”™è¯¯è¾“å‡ºç»‘å®šåˆ°ä¾æ—§æ˜¯é»˜è®¤è¾“å‡ºè®¾å¤‡çš„å±å¹•ä¸Šã€‚è€Œæ ‡å‡†è¾“å‡ºè¢«ä¸¢å¼ƒã€‚<br>å› ä¸ºlinuxåœ¨æ‰§è¡Œshellå‘½ä»¤ä¹‹å‰ï¼Œå°±ä¼šç¡®å®šå¥½æ‰€æœ‰çš„è¾“å…¥è¾“å‡ºä½ç½®ï¼Œå¹¶ä¸”ä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œé‡å®šå‘çš„å‘½ä»¤ã€‚</p><h3 id="åˆ†å¼€å†™çš„bug"><a href="#åˆ†å¼€å†™çš„bug" class="headerlink" title="åˆ†å¼€å†™çš„bug"></a>åˆ†å¼€å†™çš„bug</h3><p>èƒ½å¦æŠŠé”™è¯¯å’Œè¾“å‡ºå¹¶è¡Œè¾“å‡ºåˆ°ç©ºè®¾å¤‡å‘¢ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&gt;/dev/null 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>ä¹Ÿä¸å¯ä»¥ï¼</p><p>è¯•éªŒä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls a.txt b.txt &gt;out 2&gt;out</span></span><br><span class="line"><span class="comment"># cat out</span></span><br><span class="line">a.txt</span><br><span class="line">txt: No such file or directory <span class="comment">#æœ¬æ¥åº”è¯¥æ˜¯ b.txt: No such file or directoryï¼Œ å‡ºç°äº†å­—ç¬¦ç¼ºå¤±</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šä¸¢å¤±å­—ç¬¦ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¿™ç§å†™æ³•ä¼šå¯¼è‡´æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºæŠ¢å é‡å®šå‘åˆ°outçš„ç®¡é“ï¼Œå¯¼è‡´å†²çªã€è¦†ç›–ç­‰é—®é¢˜ã€‚è€Œä¸”ä¼šå¯¼è‡´è¾“å‡ºæ•ˆç‡è¾ƒä½ã€‚</p><h3 id="å…³äºnohup"><a href="#å…³äºnohup" class="headerlink" title="å…³äºnohup"></a>å…³äºnohup</h3><p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨<code>nohup command &amp;</code>å‘½ä»¤å½¢å¼æ¥å¯åŠ¨ä¸€äº›åå°ç¨‹åºï¼Œæ¯”å¦‚nodeæœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup node server.js &amp;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä¸è®©ä¸€äº›æ‰§è¡Œä¿¡æ¯è¾“å‡ºåˆ°å‰å°ï¼ˆæ§åˆ¶å°ï¼‰ï¼Œæˆ‘ä»¬è¿˜ä¼šåŠ ä¸Šåˆšæ‰æåˆ°çš„<code>&gt;/dev/null 2&gt;&amp;1</code>å‘½ä»¤æ¥ä¸¢å¼ƒæ‰€æœ‰çš„è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup node server.js &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
