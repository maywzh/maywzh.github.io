---
title: 聊聊科学上网
categories: 计算机网络
comments: false
date: 2018-07-17 17:00:35
tags:
  - 科学上网
---

因为有着上不存在的网站的刚需，本文先探讨GFW的原理，然后聊聊常见的科学上网的原理。至于具体怎么做，本文不会细谈。

![70e27677ly1feolod1irxj213y0qlneb](https://ws3.sinaimg.cn/large/006tNbRwgy1fwbdrn59thj313y0qlk7u.jpg)快递请放在门外，水费已交。 ⚈้̤͡ ˌ̫̮ ⚈้̤͡"

<!--more-->

## HTTP通信原理

大致分为以下几个步骤

- DNS解析域名得到server IP
- client向server端建立TCP连接
- client在TCP连接上发送HTTP Request包
- server在TCP连接上回送HTTP Response包
- client端浏览器解析HTTP Response包

具体可以参见[从 url 到页面发生了什么](https://blog.maywzh.com/%E4%BB%8Eurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/)。

## GFW原理探讨



![File-id=dcg7wxzv_13c5hxczck_b](https://raw.githubusercontent.com/maywzh/imagebed/master/img/20181017172525.png)  

根据[GFW技术评论](http://gfwrev.blogspot.com/2010/02/gfw.html)一文结合方校长的论文，可以推断，GFW在国际出口之前进行旁路监听。当有关键词的包通过GFW，GFW就会返回一个阻断相应包。具体响应机制有IP包过滤、连接欺骗、DNS劫持/污染等等。关键词识别是通过神经网络、概率模型等学习算法进行聚类、分类，基于此进行模式匹配。GFW会对特定模式的连接进行日志记录，即使不阻断连接，也会进行监听。

## DNS阶段

由于GFW的干扰，往往敏感服务无法得到正确的IP。

DNS分为TCP和UDP两种方式，默认为UDP。

### UDP

首先来分析一下UDP方式

用dig来检测dns。 

```bash
$ dig @8.8.8.8       
; <<>> DiG 9.10.6 <<>> @8.8.8.8 youtube.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 21097
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;youtube.com.			IN	A

;; ANSWER SECTION:
youtube.com.		199	IN	A	203.98.7.65

;; Query time: 28 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Wed Oct 17 18:19:57 CST 2018
;; MSG SIZE  rcvd: 45

```

